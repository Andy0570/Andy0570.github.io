<!DOCTYPE html>













<html class="theme-next gemini" lang="zh-CN">
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">




  
  
    
      
    
    
      
    
  <script src="//cdn.jsdelivr.net/npm/pace-js@1/pace.min.js"></script>
  <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/pace-js@1/themes/blue/pace-theme-minimal.css">



  
  
    
  
  <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/han-css@3/dist/han.min.css">













  
  
    
  
  <link rel="stylesheet" href="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.css">







  

<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/font-awesome@4/css/font-awesome.min.css">

<link rel="stylesheet" href="/css/main.css?v=7.1.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/panda/apple-touch-icon.png?v=7.1.0">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/panda/favicon-32x32.png?v=7.1.0">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/panda/favicon-16x16.png?v=7.1.0">


  <link rel="mask-icon" href="/images/panda/safari-pinned-tab.svg?v=7.1.0" color="#222">


  <link rel="manifest" href="/images/panda/site.webmanifest">


  <meta name="msapplication-config" content="/images/panda/browserconfig.xml">





<script id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '7.1.0',
    sidebar: {"position":"left","display":"post","offset":12,"onmobile":false,"dimmer":false},
    back2top: true,
    back2top_sidebar: false,
    fancybox: true,
    fastclick: true,
    lazyload: true,
    tabs: true,
    motion: {"enable":false,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '0E2AON8EZF',
      apiKey: '22fbefd84c8343239f5c04365b9728de',
      indexName: 'MyBlogPlatform',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  <meta name="description" content="æœ‰æ—¶å€™é˜³å…‰å¾ˆå¥½ æœ‰æ—¶å€™é˜³å…‰å¾ˆæš—">
<meta name="keywords" content="ç‹¬æœ¨èˆŸçš„æœ¨">
<meta property="og:type" content="website">
<meta property="og:title" content="ç‹¬æœ¨èˆŸçš„æœ¨">
<meta property="og:url" content="https://andy0570.com/page/12/index.html">
<meta property="og:site_name" content="ç‹¬æœ¨èˆŸçš„æœ¨">
<meta property="og:description" content="æœ‰æ—¶å€™é˜³å…‰å¾ˆå¥½ æœ‰æ—¶å€™é˜³å…‰å¾ˆæš—">
<meta property="og:locale" content="zh-CN">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="ç‹¬æœ¨èˆŸçš„æœ¨">
<meta name="twitter:description" content="æœ‰æ—¶å€™é˜³å…‰å¾ˆå¥½ æœ‰æ—¶å€™é˜³å…‰å¾ˆæš—">



  <link rel="alternate" href="/atom.xml" title="ç‹¬æœ¨èˆŸçš„æœ¨" type="application/atom+xml">



  
  
  <link rel="canonical" href="https://andy0570.com/page/12/">



<script id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>ç‹¬æœ¨èˆŸçš„æœ¨</title>
  






  <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?8229a094facca297f211d61323fd9fde";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>







  <noscript>
  <style>
  .use-motion .motion-element,
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-title { opacity: initial; }

  .use-motion .logo,
  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-CN">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <a href="https://github.com/andy0570" class="github-corner" aria-label="View source on GitHub"><svg width="80" height="80" viewbox="0 0 250 250" style="fill:#151513; color:#fff; position: absolute; top: 0; border: 0; right: 0;" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"/><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"/><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"/></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style>
    
    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">ç‹¬æœ¨èˆŸçš„æœ¨</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
      
        <p class="site-subtitle">iOS Developer</p>
      
    
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="åˆ‡æ¢å¯¼èˆªæ ">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home">

    
    
    
      
    

    
      
    

    <a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i> <br>é¦–é¡µ</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-categories">

    
    
    
      
    

    
      
    

    <a href="/categories/" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i> <br>åˆ†ç±»<span class="badge">14</span></a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-tags">

    
    
    
      
    

    
      
    

    <a href="/tags/" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i> <br>æ ‡ç­¾<span class="badge">37</span></a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">

    
    
    
      
    

    
      
    

    <a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i> <br>å½’æ¡£<span class="badge">316</span></a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-about">

    
    
    
      
    

    
      
    

    <a href="/about/" rel="section"><i class="menu-item-icon fa fa-fw fa-user"></i> <br>å…³äº</a>

  </li>

      
      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br>æœç´¢</a>
        </li>
      
    </ul>
  

  

  
    <div class="site-search">
      
  
  <div class="algolia-popup popup search-popup">
    <div class="algolia-search">
      <div class="algolia-search-input-icon">
        <i class="fa fa-search"></i>
      </div>
      <div class="algolia-search-input" id="algolia-search-input"></div>
    </div>

    <div class="algolia-results">
      <div id="algolia-stats"></div>
      <div id="algolia-hits"></div>
      <div id="algolia-pagination" class="algolia-pagination"></div>
    </div>

    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
  </div>




    </div>
  
</nav>



  



</div>
    </header>

    
  
  

  

  <a href="https://github.com/andy0570" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewbox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"/><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"/><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"/></svg></a>



    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
            

          
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://andy0570.com/2018/01/10/iOS æ¨¡å‹å±‚çš„ä¸¤ç§è®¾è®¡æ¨¡å¼/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ç‹¬æœ¨èˆŸçš„æœ¨">
      <meta itemprop="description" content="æœ‰æ—¶å€™é˜³å…‰å¾ˆå¥½ æœ‰æ—¶å€™é˜³å…‰å¾ˆæš—">
      <meta itemprop="image" content="https://blog-andy0570-1256077835.cos.ap-shanghai.myqcloud.com/site_Images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ç‹¬æœ¨èˆŸçš„æœ¨">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2018/01/10/iOS æ¨¡å‹å±‚çš„ä¸¤ç§è®¾è®¡æ¨¡å¼/" class="post-title-link" itemprop="url">iOS æ¨¡å‹å±‚çš„ä¸¤ç§è®¾è®¡æ¨¡å¼</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              

              
                
              

              <time title="åˆ›å»ºæ—¶é—´ï¼š2018-01-10 15:13:00" itemprop="dateCreated datePublished" datetime="2018-01-10T15:13:00+08:00">2018-01-10</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">æ›´æ–°äº</span>
                
                <time title="ä¿®æ”¹æ—¶é—´ï¼š2019-05-01 20:51:50" itemprop="dateModified" datetime="2019-05-01T20:51:50+08:00">2019-05-01</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/iOS/" itemprop="url" rel="index"><span itemprop="name">iOS</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          

          

          
            <div class="post-symbolscount">
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">æœ¬æ–‡å­—æ•°ï¼š</span>
                
                <span title="æœ¬æ–‡å­—æ•°">6.2k</span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">é˜…è¯»æ—¶é•¿ &asymp;</span>
                
                <span title="é˜…è¯»æ—¶é•¿">6 åˆ†é’Ÿ</span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body han-init-context" itemprop="articleBody">

      
      

      
        
          
            <p><img src="https://blog-andy0570-1256077835.cos.ap-shanghai.myqcloud.com/site_Images/075319.jpg" alt="å›¾ç‰‡æ¥è‡ªPixabay"></p>
<p>&lt;!-- more --&gt;</p>
<p>æ¨¡å‹å±‚ï¼ˆModelï¼‰çš„ä¸¤ç§è®¾è®¡æ–¹æ¡ˆï¼š</p>
<ul>
<li>ä½¿ç”¨è‡ªå®šä¹‰çš„åˆå§‹åŒ–å™¨ï¼›</li>
<li>ä½¿ç”¨ç”Ÿæˆå™¨æ¨¡å¼ï¼›</li>
</ul>
<h3>ä¸€ã€è‡ªå®šä¹‰åˆå§‹åŒ–å™¨</h3>
<p>è¿™æ˜¯è®¾è®¡æ¨¡å‹å±‚çš„å¸¸ç”¨æ–¹å¼ã€‚</p>
<p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line">// ---------------------------------------------------</span><br><span class="line">//  HQLUser.h</span><br><span class="line">// ---------------------------------------------------</span><br><span class="line">#import &lt;Foundation/Foundation.h&gt;</span><br><span class="line"></span><br><span class="line">@interface HQLUser : NSObject</span><br><span class="line"></span><br><span class="line">// å±æ€§çš„è®¾ç½®ï¼šå‘å¤–å±‚æš´éœ²çš„å±æ€§å°½é‡è®¾ç½®ä¸ºä¸å¯å˜(immutable)ã€åªè¯»ï¼ˆreadonlyï¼‰ </span><br><span class="line">@property (nonatomic, copy, readonly) NSString *userID;</span><br><span class="line">@property (nonatomic, copy, readonly) NSString *firstName;</span><br><span class="line">@property (nonatomic, copy, readonly) NSString *lastName;</span><br><span class="line">@property (nonatomic, copy, readonly) NSString *gender;</span><br><span class="line">@property (nonatomic, copy, readonly) NSDate *dateOfBirth;</span><br><span class="line">@property (nonatomic, copy, readonly) NSArray *albums;</span><br><span class="line"></span><br><span class="line">// æŒ‡å®šåˆå§‹åŒ–æ–¹æ³•</span><br><span class="line">- (instancetype)initWithUserID:(NSString *)userID</span><br><span class="line">                     firstName:(NSString *)firstName</span><br><span class="line">                      lastName:(NSString *)lastName</span><br><span class="line">                        gender:(NSString *)gender</span><br><span class="line">                   dateOfBirth:(NSDate *)dateOfBirth</span><br><span class="line">                        albums:(NSArray *)albums;</span><br><span class="line"></span><br><span class="line">@end</span><br><span class="line"></span><br><span class="line">// ---------------------------------------------------</span><br><span class="line">//  HQLUser.m</span><br><span class="line">// ---------------------------------------------------</span><br><span class="line">#import &quot;HQLUser.h&quot;</span><br><span class="line"></span><br><span class="line">@interface HQLUser ()</span><br><span class="line"></span><br><span class="line">// åœ¨å†…éƒ¨å°†å±æ€§é‡æ–°å°è£…ä¸º readwriteï¼Œè¿™æ ·å±æ€§åœ¨å†…éƒ¨å°±æ˜¯å¯è¯»å¯å†™çš„ã€‚</span><br><span class="line">@property (nonatomic, copy, readwrite) NSString *userID;</span><br><span class="line">@property (nonatomic, copy, readwrite) NSString *firstName;</span><br><span class="line">@property (nonatomic, copy, readwrite) NSString *lastName;</span><br><span class="line">@property (nonatomic, copy, readwrite) NSString *gender;</span><br><span class="line">@property (nonatomic, copy, readwrite) NSDate *dateOfBirth;</span><br><span class="line">@property (nonatomic, copy, readwrite) NSArray *albums;</span><br><span class="line"></span><br><span class="line">@end</span><br><span class="line"></span><br><span class="line">@implementation HQLUser</span><br><span class="line"></span><br><span class="line">- (instancetype)initWithUserID:(NSString *)userID</span><br><span class="line">                     firstName:(NSString *)firstName</span><br><span class="line">                      lastName:(NSString *)lastName</span><br><span class="line">                        gender:(NSString *)gender</span><br><span class="line">                   dateOfBirth:(NSDate *)dateOfBirth</span><br><span class="line">                        albums:(NSArray *)albums &#123;</span><br><span class="line">    if (self = [super init]) &#123;</span><br><span class="line">        _userID      = [userID copy];</span><br><span class="line">        _firstName   = [firstName copy];</span><br><span class="line">        _lastName    = [lastName copy];</span><br><span class="line">        _gender      = [gender copy];</span><br><span class="line">        _dateOfBirth = dateOfBirth;</span><br><span class="line">        _albums      = [albums copy];</span><br><span class="line">    &#125;</span><br><span class="line">    return self;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (instancetype)init &#123;</span><br><span class="line">    @throw [NSException exceptionWithName:@&quot;Method Undefined&quot;</span><br><span class="line">                                   reason:@&quot;Use Designated Initializer Method&quot;</span><br><span class="line">                                 userInfo:nil];</span><br><span class="line">    return nil;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@end</span><br></pre></td></tr></table></figure></p>
<p>è°ƒç”¨å¦‚ä¸‹ï¼š</p>
<p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">// ä½¿ç”¨è‡ªå®šä¹‰çš„åˆå§‹åŒ–å™¨    </span><br><span class="line">HQLUser *user = [[HQLUser alloc] initWithUserID:@&quot;1214138&quot; firstName:@&quot;Hello&quot; lastName:@&quot;Kitty&quot; gender:@&quot;man&quot; dateOfBirth:[NSDate date] albums:[NSArray array]];</span><br></pre></td></tr></table></figure></p>
<blockquote>
<p>ğŸ’¡
æŒ‡å®šåˆå§‹åŒ–æ–¹æ³•å’ŒéæŒ‡å®šåˆå§‹åŒ–æ–¹æ³•å¯ä»¥ç”¨å®æ¥è¿›è¡Œæ ‡è®°ï¼š</p>
<ul>
<li><strong>NS_DESIGNATED_INITIALIZER</strong></li>
<li><strong>NS_UNAVAILABLE</strong></li>
</ul>
</blockquote>
<p>è¿™ç§è®¾è®¡æ¨¡å¼çš„ç¼ºç‚¹ï¼š</p>
<ol>
<li>å¦‚æœç±»åŒ…å«çš„å±æ€§å¾ˆå¤šï¼ŒæŒ‡å®šåˆå§‹åŒ–æ–¹æ³•çš„æ–¹æ³•åä¼šå¾ˆé•¿ã€éæŒ‡å®šåˆå§‹åŒ–æ–¹æ³•çš„ä¸ªæ•°å°†ä¼šå¾ˆå¤šï¼›</li>
<li>å‘ä¸‹å…¼å®¹é—®é¢˜ï¼šå¦‚æœæ–°å¢ä¸€ä¸ªå±æ€§ï¼Œå°±éœ€è¦é‡æ„æŒ‡å®šåˆå§‹åŒ–æ–¹æ³•ï¼Œå› æ­¤ï¼Œæ–°ç‰ˆæ¨¡å‹æ— æ³•å®ç°å‘ä¸‹å…¼å®¹ï¼›</li>
</ol>
<h3>äºŒã€ç”Ÿæˆå™¨æ¨¡å¼</h3>
<p>éœ€è¦å¼•å…¥å¤–éƒ¨ç±»è¿›è¡Œç®¡ç†ã€‚ç”Ÿæˆå™¨æœ‰setteræ–¹æ³•ï¼Œä¹Ÿéœ€è¦æä¾›ä¸æ¨¡å‹æ•°æ®å®Œå…¨ä¸€è‡´çš„å­˜å‚¨ã€‚ç”Ÿæˆå™¨æœ€ç»ˆä¹Ÿä¼šä½¿ç”¨åˆå§‹åŒ–å™¨ã€‚</p>
<p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line">// ---------------------------------------------------</span><br><span class="line">//  HPUser.h</span><br><span class="line">// ---------------------------------------------------</span><br><span class="line"></span><br><span class="line">#import &lt;Foundation/Foundation.h&gt;</span><br><span class="line"></span><br><span class="line">@class HPUserBuilder;</span><br><span class="line">@class HPUser;</span><br><span class="line"></span><br><span class="line">typedef void(^HPUserBuilderBlock)(HPUserBuilder *builder);</span><br><span class="line"></span><br><span class="line">@interface HPUserBuilder : NSObject</span><br><span class="line"></span><br><span class="line">@property (nonatomic, copy) NSString *username;</span><br><span class="line">@property (nonatomic, copy) NSString *gender;</span><br><span class="line">@property (nonatomic, copy) NSDate *dateOfBirth;</span><br><span class="line"></span><br><span class="line">- (HPUser *)build;</span><br><span class="line">- (HPUserBuilder *)username:(NSString *)username;</span><br><span class="line">- (HPUserBuilder *)gender:(NSString *)gender;</span><br><span class="line">- (HPUserBuilder *)dateOfBirth:(NSDate *)dateOfBirth;</span><br><span class="line"></span><br><span class="line">@end</span><br><span class="line"></span><br><span class="line">@interface HPUser : NSObject</span><br><span class="line"></span><br><span class="line">@property (nonatomic, copy) NSString *username;</span><br><span class="line">@property (nonatomic, copy) NSString *gender;</span><br><span class="line">@property (nonatomic, copy) NSDate *dateOfBirth;</span><br><span class="line"></span><br><span class="line">- (instancetype)initWithBuilder:(HPUserBuilder *)builder;</span><br><span class="line">- (instancetype)initWithBlock:(HPUserBuilderBlock)block;</span><br><span class="line"></span><br><span class="line">@end</span><br><span class="line"></span><br><span class="line">// ---------------------------------------------------</span><br><span class="line">//  HPUser.m</span><br><span class="line">// ---------------------------------------------------</span><br><span class="line"></span><br><span class="line">#import &quot;HPUser.h&quot;</span><br><span class="line"></span><br><span class="line">@implementation HPUserBuilder</span><br><span class="line"></span><br><span class="line">- (HPUser *)build &#123;</span><br><span class="line">    // æ„é€ å™¨çš„åˆå§‹åŒ–æ–¹æ³•ï¼Œè°ƒç”¨çš„è¿˜æ˜¯æ¨¡å‹å±‚çš„æŒ‡å®šåˆå§‹åŒ–æ–¹æ³•</span><br><span class="line">    return [[HPUser alloc] initWithBuilder:self];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (HPUserBuilder *)username:(NSString *)username &#123;</span><br><span class="line">    _username = [username copy];</span><br><span class="line">    return self;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (HPUserBuilder *)gender:(NSString *)gender &#123;</span><br><span class="line">    _gender = [gender copy];</span><br><span class="line">    return self;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (HPUserBuilder *)dateOfBirth:(NSDate *)dateOfBirth &#123;</span><br><span class="line">    _dateOfBirth = dateOfBirth;</span><br><span class="line">    return self;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@end</span><br><span class="line"></span><br><span class="line">@implementation HPUser</span><br><span class="line"></span><br><span class="line">// æŒ‡å®šåˆå§‹åŒ–æ–¹æ³•</span><br><span class="line">- (instancetype)initWithBuilder:(HPUserBuilder *)builder &#123;</span><br><span class="line">    if (self = [super init]) &#123;</span><br><span class="line">        _username = builder.username;</span><br><span class="line">        _gender = builder.gender;</span><br><span class="line">        _dateOfBirth = builder.dateOfBirth;</span><br><span class="line">    &#125;</span><br><span class="line">    return self;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (instancetype)initWithBlock:(HPUserBuilderBlock)block &#123;</span><br><span class="line">    HPUserBuilder *builder = [[HPUserBuilder alloc] init];</span><br><span class="line">    block(builder);</span><br><span class="line">    // è¿”å›çš„æ˜¯æ„é€ å™¨çš„åˆå§‹åŒ–æ–¹æ³•</span><br><span class="line">    return [builder build];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@end</span><br></pre></td></tr></table></figure></p>
<p>ç”Ÿäº§å™¨æ¨¡å¼è§£å†³äº†è‡ªå®šä¹‰åˆå§‹åŒ–æ–¹æ³•çš„ä¸¤ä¸ªç¼ºç‚¹ï¼Œå®ƒçš„æ–¹æ³•åä¸ä¼šå¾ˆé•¿ã€ä¹Ÿè§£å†³äº†å‘ä¸‹çš„å…¼å®¹æ€§é—®é¢˜ï¼Œè°ƒç”¨å¦‚ä¸‹ï¼š</p>
<p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">// 1</span><br><span class="line">HPUserBuilder *builder = [[[[[HPUserBuilder alloc] init] username:@&quot;username&quot;] gender:@&quot;man&quot;] dateOfBirth:[NSDate date]];</span><br><span class="line">HPUser *usr = [[HPUser alloc] initWithBuilder:builder];</span><br><span class="line"></span><br><span class="line">// 2</span><br><span class="line">HPUser *user = [[HPUser alloc] initWithBlock:^(HPUserBuilder *builder) &#123;</span><br><span class="line">    builder.username    = @&quot;username&quot;;</span><br><span class="line">    builder.gender      = @&quot;man&quot;;</span><br><span class="line">    builder.dateOfBirth = [NSDate date];</span><br><span class="line">&#125;];</span><br></pre></td></tr></table></figure></p>
<p><strong>ç”Ÿæˆå™¨æ¨¡å¼</strong> å…¶å®å°±æ˜¯åœ¨æ™®é€šçš„ Model å±‚ä¹‹ä¸Šåˆå°è£…äº†ä¸€ä¸ªä¸­é—´å±‚ï¼Œè¿™ä¸ªä¸­é—´ç±»çš„å±æ€§å’Œ Model å±‚æ˜¯ä¸€æ ·çš„ã€‚<strong>æœ¬è´¨ä¸Šåˆ°æœ€åè¿˜æ˜¯è¦å»è°ƒç”¨ Model å±‚çš„æŒ‡å®šåˆå§‹åŒ–æ–¹æ³•</strong>ã€‚</p>
<p>ä½¿ç”¨æŒ‡å—ï¼š</p>
<ol>
<li>å½“ä½ çš„ Model å±‚ä¸­çš„å±æ€§å¾ˆå¤šã€æˆ–è€…åæœŸå¾ˆæœ‰å¯èƒ½æ–°å¢å…¶ä»–å±æ€§ï¼Œé‚£ä¹ˆä½¿ç”¨ç”Ÿæˆå™¨æ¨¡å¼å¯ä»¥è§£å†³å‘åçš„å…¼å®¹æ€§é—®é¢˜ï¼ˆModel å±‚æ–°å¢å±æ€§åï¼Œä½¿ç”¨äº†è¯¥ Model ç±»çš„å…¶ä»–åœ°æ–¹ä¸éœ€è¦å› ä¸º Model ç±»æŒ‡å®šåˆå§‹åŒ–æ–¹æ³•çš„æ”¹å˜è€Œè·Ÿç€ä¿®æ”¹ï¼‰ã€‚</li>
<li>å½“ä½ çš„ Model å±‚ä¸­çš„å±æ€§ä¸æ˜¯å¾ˆå¤šï¼ŒåæœŸä¹Ÿä¸å¤§å¯èƒ½æ–°å¢å±æ€§æ—¶ï¼Œä¸å¤ªé€‚åˆä½¿ç”¨ç”Ÿæˆå™¨æ¨¡å¼ï¼Œè¿™ç§æ¨¡å¼å‡ ä¹è¦å†™åŸæœ¬ 2 å€çš„ä»£ç é‡ï¼Œæœ‰ç§ä¸ºäº†å°è£…è€Œå°è£…çš„æ„Ÿè§‰ï¼Œä¼šå»¶é•¿æˆ‘ä»¬çš„å¼€å‘å‘¨æœŸï¼Œé™ä½å¼€å‘æ•ˆç‡ï¼Œæé«˜å¼€å‘æˆæœ¬ã€‚</li>
</ol>
<h3>æ€»ç»“</h3>
<p>ç”Ÿæˆå™¨æ¨¡å¼å¯ä»¥å¼•ç”¨ä¸€å¥ç»å…¸çš„è¯æ¥æ€»ç»“ï¼š</p>
<blockquote>
<p>All problems in computer science can be solved by another level of indirection.â€”â€”Butler Lampson</p>
<p>â€œè®¡ç®—æœºç§‘å­¦é¢†åŸŸçš„ä»»ä½•é—®é¢˜éƒ½å¯ä»¥é€šè¿‡å¢åŠ ä¸€ä¸ªé—´æ¥çš„ä¸­é—´å±‚æ¥è§£å†³â€</p>
</blockquote>
<h3>å‚è€ƒ</h3>
<ul>
<li>Gaurav Vaish. é«˜æ€§èƒ½iOSåº”ç”¨å¼€å‘ [M]. åŒ—äº¬ï¼šäººæ°‘é‚®ç”µå‡ºç‰ˆç¤¾ï¼Œ2017. 102-105</li>
<li><a href="http://holko.pl/2015/05/12/immutable-object-initialization/" target="_blank" rel="noopener">Improving Immutable Object Initialization in Objective-C</a></li>
<li><a href="http://mrpeak.cn/blog/ios-init/" target="_blank" rel="noopener">iOS åˆ›å»ºå¯¹è±¡çš„å§¿åŠ¿ @MrPeak</a></li>
</ul>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://andy0570.com/2018/01/09/iOS è·Ÿè¸ªå†…å­˜ã€CPUã€ç”µæ± ç”µé‡/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ç‹¬æœ¨èˆŸçš„æœ¨">
      <meta itemprop="description" content="æœ‰æ—¶å€™é˜³å…‰å¾ˆå¥½ æœ‰æ—¶å€™é˜³å…‰å¾ˆæš—">
      <meta itemprop="image" content="https://blog-andy0570-1256077835.cos.ap-shanghai.myqcloud.com/site_Images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ç‹¬æœ¨èˆŸçš„æœ¨">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2018/01/09/iOS è·Ÿè¸ªå†…å­˜ã€CPUã€ç”µæ± ç”µé‡/" class="post-title-link" itemprop="url">iOS è·Ÿè¸ªå†…å­˜ã€CPUã€ç”µæ± ç”µé‡</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              

              
                
              

              <time title="åˆ›å»ºæ—¶é—´ï¼š2018-01-09 11:00:00" itemprop="dateCreated datePublished" datetime="2018-01-09T11:00:00+08:00">2018-01-09</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">æ›´æ–°äº</span>
                
                <time title="ä¿®æ”¹æ—¶é—´ï¼š2019-05-01 20:51:30" itemprop="dateModified" datetime="2019-05-01T20:51:30+08:00">2019-05-01</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/iOS/" itemprop="url" rel="index"><span itemprop="name">iOS</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          

          

          
            <div class="post-symbolscount">
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">æœ¬æ–‡å­—æ•°ï¼š</span>
                
                <span title="æœ¬æ–‡å­—æ•°">4.6k</span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">é˜…è¯»æ—¶é•¿ &asymp;</span>
                
                <span title="é˜…è¯»æ—¶é•¿">4 åˆ†é’Ÿ</span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body han-init-context" itemprop="articleBody">

      
      

      
        
          
            <p><img src="https://blog-andy0570-1256077835.cos.ap-shanghai.myqcloud.com/site_Images/075036.png" alt="å›¾ç‰‡æ¥è‡ªPixabay"></p>
<p>&lt;!-- more --&gt;</p>
<h3>è·Ÿè¸ªå¯ç”¨å’Œå·²ç”¨çš„å†…å­˜æ–¹æ³•</h3>
<blockquote>
<p>ğŸ’¡åœ¨å‡ºç°ä½å†…å­˜è­¦å‘Šæ—¶å¯¹åº”ç”¨è¿›è¡ŒåŸ‹ç‚¹ï¼ŒåŒ…æ‹¬å†…å­˜çš„ä½¿ç”¨åŠç»Ÿè®¡ä¿¡æ¯ï¼Œå¹¶åœ¨åº”ç”¨é‡æ–°è¿è¡Œæ—¶å°†è¿™äº›ä¿¡æ¯ä¸ŠæŠ¥ç»™æœåŠ¡å™¨ã€‚ä½¿ç”¨è¿™äº›ä¿¡æ¯æ¥è¯†åˆ«å‡ºåº”ç”¨å‘ç”Ÿå†…å­˜æº¢å‡ºçš„å¸¸è§åœºæ™¯å’Œè¾¹ç¼˜æƒ…å†µã€‚</p>
</blockquote>
<h4>ç¤ºä¾‹ä»£ç </h4>
<p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">// HPMemoryAnalyzer.h</span><br><span class="line">#import &lt;Foundation/Foundation.h&gt;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> è·Ÿè¸ªå¯ç”¨å’Œå·²ç”¨çš„å†…å­˜</span><br><span class="line"> */</span><br><span class="line">@interface HPMemoryAnalyzer : NSObject</span><br><span class="line"></span><br><span class="line">vm_size_t getUsedMemory();</span><br><span class="line">vm_size_t getFreeMemory();</span><br><span class="line"></span><br><span class="line">@end</span><br><span class="line"></span><br><span class="line">// HPMemoryAnalyzer.m</span><br><span class="line">#import &quot;HPMemoryAnalyzer.h&quot;</span><br><span class="line">#import &lt;mach/mach.h&gt;</span><br><span class="line"></span><br><span class="line">vm_size_t getUsedMemory() &#123;</span><br><span class="line">    task_basic_info_data_t info;</span><br><span class="line">    mach_msg_type_number_t size = sizeof(info);</span><br><span class="line">    kern_return_t kerr = task_info(mach_task_self(), TASK_BASIC_INFO, (task_info_t)&amp;info, &amp;size);</span><br><span class="line">    </span><br><span class="line">    if (kerr == KERN_SUCCESS) &#123;</span><br><span class="line">        return info.resident_size;</span><br><span class="line">    &#125;else &#123;</span><br><span class="line">        return 0;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">vm_size_t getFreeMemory() &#123;</span><br><span class="line">    mach_port_t host = mach_host_self();</span><br><span class="line">    mach_msg_type_number_t size = sizeof(vm_statistics_data_t) / sizeof(integer_t);</span><br><span class="line">    vm_size_t pagesize;</span><br><span class="line">    vm_statistics_data_t vmstat;</span><br><span class="line">    </span><br><span class="line">    host_page_size(host, &amp;pagesize);</span><br><span class="line">    host_statistics(host, HOST_VM_INFO, (host_info_t)&amp;vmstat, &amp;size);</span><br><span class="line">    </span><br><span class="line">    return vmstat.free_count * pagesize;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@implementation HPMemoryAnalyzer</span><br><span class="line"></span><br><span class="line">@end</span><br></pre></td></tr></table></figure></p>
<p>å¦å¤–ï¼Œ<a href="https://github.com/ibireme/YYKit" target="_blank" rel="noopener">YYKit</a> æ¡†æ¶ä¸­ä¹Ÿé›†æˆäº†å…³äºè·å–åº”ç”¨å†…å­˜ä½¿ç”¨é‡ã€CPUä½¿ç”¨é‡çš„ç›¸å…³æ–¹æ³•ï¼š</p>
<p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line">// UIApplication+YYAdd.h</span><br><span class="line"></span><br><span class="line">/// Current thread real memory used in byte. (-1 when error occurs)</span><br><span class="line">@property (nonatomic, readonly) int64_t memoryUsage;</span><br><span class="line"></span><br><span class="line">/// Current thread CPU usage, 1.0 means 100%. (-1 when error occurs)</span><br><span class="line">@property (nonatomic, readonly) float cpuUsage;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">// UIApplication+YYAdd.m</span><br><span class="line">- (int64_t)memoryUsage &#123;</span><br><span class="line">    struct task_basic_info info;</span><br><span class="line">    mach_msg_type_number_t size = sizeof(info);</span><br><span class="line">    kern_return_t kern = task_info(mach_task_self(), TASK_BASIC_INFO, (task_info_t)&amp;info, &amp;size);</span><br><span class="line">    if (kern != KERN_SUCCESS) return -1;</span><br><span class="line">    return info.resident_size;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (float)cpuUsage &#123;</span><br><span class="line">    kern_return_t kr;</span><br><span class="line">    task_info_data_t tinfo;</span><br><span class="line">    mach_msg_type_number_t task_info_count;</span><br><span class="line">    </span><br><span class="line">    task_info_count = TASK_INFO_MAX;</span><br><span class="line">    kr = task_info(mach_task_self(), TASK_BASIC_INFO, (task_info_t)tinfo, &amp;task_info_count);</span><br><span class="line">    if (kr != KERN_SUCCESS) &#123;</span><br><span class="line">        return -1;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    thread_array_t thread_list;</span><br><span class="line">    mach_msg_type_number_t thread_count;</span><br><span class="line">    </span><br><span class="line">    thread_info_data_t thinfo;</span><br><span class="line">    mach_msg_type_number_t thread_info_count;</span><br><span class="line">    </span><br><span class="line">    thread_basic_info_t basic_info_th;</span><br><span class="line">    </span><br><span class="line">    kr = task_threads(mach_task_self(), &amp;thread_list, &amp;thread_count);</span><br><span class="line">    if (kr != KERN_SUCCESS) &#123;</span><br><span class="line">        return -1;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    long tot_sec = 0;</span><br><span class="line">    long tot_usec = 0;</span><br><span class="line">    float tot_cpu = 0;</span><br><span class="line">    int j;</span><br><span class="line">    </span><br><span class="line">    for (j = 0; j &lt; thread_count; j++) &#123;</span><br><span class="line">        thread_info_count = THREAD_INFO_MAX;</span><br><span class="line">        kr = thread_info(thread_list[j], THREAD_BASIC_INFO,</span><br><span class="line">                         (thread_info_t)thinfo, &amp;thread_info_count);</span><br><span class="line">        if (kr != KERN_SUCCESS) &#123;</span><br><span class="line">            return -1;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        basic_info_th = (thread_basic_info_t)thinfo;</span><br><span class="line">        </span><br><span class="line">        if (!(basic_info_th-&gt;flags &amp; TH_FLAGS_IDLE)) &#123;</span><br><span class="line">            tot_sec = tot_sec + basic_info_th-&gt;user_time.seconds + basic_info_th-&gt;system_time.seconds;</span><br><span class="line">            tot_usec = tot_usec + basic_info_th-&gt;system_time.microseconds + basic_info_th-&gt;system_time.microseconds;</span><br><span class="line">            tot_cpu = tot_cpu + basic_info_th-&gt;cpu_usage / (float)TH_USAGE_SCALE;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    kr = vm_deallocate(mach_task_self(), (vm_offset_t)thread_list, thread_count * sizeof(thread_t));</span><br><span class="line">    assert(kr == KERN_SUCCESS);</span><br><span class="line">    </span><br><span class="line">    return tot_cpu;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>é™¤äº† <strong>UIApplication+YYAdd</strong> ä¸­è¿™ä¸¤ä¸ªæ–¹æ³•ï¼Œä½ ä¼šå‘ç° <strong>UIDevice+YYAdd</strong> ä¸­è¿˜æœ‰æ›´ä¸°å¯Œçš„æ–¹æ³•ï¼ŒåŒ…æ‹¬è·å–è®¾å¤‡ä¿¡æ¯ã€ç£ç›˜ç©ºé—´ã€å†…å­˜ä¿¡æ¯ã€CPUä¿¡æ¯å­¦ã€‚</p>
<h3>ç”µæ± ç”µé‡ä¸ä»£ç æ„ŸçŸ¥</h3>
<p><img src="https://blog-andy0570-1256077835.cos.ap-shanghai.myqcloud.com/site_Images/075038.gif" alt></p>
<p>ä¸€ä¸ªæ™ºèƒ½çš„åº”ç”¨ä¼šè€ƒè™‘åˆ°ç”µæ± çš„ç”µé‡å’Œè‡ªèº«çš„çŠ¶æ€ï¼Œä»è€Œå†³å®šæ˜¯å¦è¦çœŸæ­£æ‰§è¡Œèµ„æºå¯†é›†æ¶ˆè€—å‹çš„æ“ä½œã€‚å¦å¤–ä¸€ä¸ªæœ‰ä»·å€¼çš„ç‚¹æ˜¯å¯¹å……ç”µçš„åˆ¤æ–­ï¼Œç¡®å®šè®¾å¤‡æ˜¯å¦å¤„äºå……ç”µçŠ¶æ€ã€‚
ä¾‹å¦‚ï¼šæ¯æ¬¡æ›´æ–°iOSç³»ç»Ÿæ—¶ï¼Œç³»ç»Ÿä¼šåˆ¤æ–­å½“å‰è®¾å¤‡ç”µé‡æ˜¯å¦ä½äº50%ï¼Œå¦‚æœä½äºè¿™ä¸ªå€¼ï¼Œç³»ç»Ÿæ˜¯ä¸ä¼šæ‰§è¡Œæ›´æ–°ç³»ç»Ÿçš„ä»»åŠ¡çš„ï¼Œå®ƒä¼šæç¤ºç”¨æˆ·å…ˆå……ç”µä¹‹åå†æ›´æ–°ç³»ç»Ÿã€‚</p>
<h4>ç¤ºä¾‹ä»£ç </h4>
<p>ä¼ å…¥æ‰§è¡Œç‰¹å®šæ“ä½œéœ€è¦çš„æœ€ä½ç”µé‡çº§åˆ«ã€‚è¯¥çº§åˆ«æ˜¯æµ®ç‚¹æ•°ï¼ŒèŒƒå›´åœ¨ 0ï½100 ä¹‹é—´ï¼ˆ100è¡¨ç¤ºç”µæ± å®Œå…¨å……æ»¡ï¼‰
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">-(<span class="built_in">BOOL</span>)shouldProceedWithMinLevel:(<span class="keyword">int</span>)minLevel</span><br><span class="line">&#123;</span><br><span class="line">	<span class="built_in">UIDevice</span> *device = [<span class="built_in">UIDevice</span> currentDevice];</span><br><span class="line">	device.batteryMonitoringEnabled = <span class="literal">YES</span>;</span><br><span class="line"></span><br><span class="line">	<span class="built_in">UIDeviceBatteryState</span> state = device.batteryState;</span><br><span class="line">	<span class="keyword">if</span>(state == <span class="built_in">UIDeviceBatteryStateCharging</span> || state == <span class="built_in">UIDeviceBatteryStateFull</span>) &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">YES</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">int</span> batteryLevel = (<span class="keyword">int</span>) (device.batteryLevel * <span class="number">100</span>);</span><br><span class="line">	<span class="keyword">if</span>(batteryLevel &gt;= minLevel) &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">YES</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="literal">NO</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3>è°¨æ…ä½¿ç”¨ç”µé‡çš„æœ€ä½³å®è·µ</h3>
<ul>
<li>æœ€å°åŒ–ç¡¬ä»¶ä½¿ç”¨ã€‚æ¢å¥è¯è¯´ï¼Œå°½å¯èƒ½æ™šåœ°ä¸ç¡¬ä»¶æ‰“äº¤é“ï¼Œå¹¶ä¸”ä¸€æ—¦å®Œæˆä»»åŠ¡ç«‹å³ç»“æŸä½¿ç”¨ã€‚</li>
<li>åœ¨è¿›è¡Œå¯†é›†å‹ä»»åŠ¡å‰ï¼Œæ£€æŸ¥ç”µæ± ç”µé‡å’Œå……ç”µçŠ¶æ€ã€‚</li>
<li>åœ¨ç”µé‡ä½æ—¶ï¼Œæç¤ºç”¨æˆ·æ˜¯å¦ç¡®å®šè¦æ‰§è¡Œä»»åŠ¡ï¼Œå¹¶åœ¨ç”¨æˆ·åŒæ„åå†æ‰§è¡Œã€‚</li>
<li>æˆ–æä¾›è®¾ç½®çš„é€‰é¡¹ï¼Œå…è®¸ç”¨æˆ·å®šä¹‰ç”µé‡çš„é˜ˆå€¼ï¼Œä»¥ä¾¿åœ¨æ‰§è¡Œå¯†é›†å‹æ“ä½œå‰æç¤ºç”¨æˆ·ã€‚</li>
</ul>
<h3>å‚è€ƒ</h3>
<ul>
<li>Gaurav Vaish. é«˜æ€§èƒ½iOSåº”ç”¨å¼€å‘ [M]. åŒ—äº¬ï¼šäººæ°‘é‚®ç”µå‡ºç‰ˆç¤¾ï¼Œ2017. 66-67</li>
</ul>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://andy0570.com/2018/01/04/iOS ç¼–ç¨‹ï¼šä¸€æ¬¡æˆªå–å­—ç¬¦ä¸²æ—¥æœŸç®—æ³•ä¼˜åŒ–å†ç¨‹/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ç‹¬æœ¨èˆŸçš„æœ¨">
      <meta itemprop="description" content="æœ‰æ—¶å€™é˜³å…‰å¾ˆå¥½ æœ‰æ—¶å€™é˜³å…‰å¾ˆæš—">
      <meta itemprop="image" content="https://blog-andy0570-1256077835.cos.ap-shanghai.myqcloud.com/site_Images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ç‹¬æœ¨èˆŸçš„æœ¨">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2018/01/04/iOS ç¼–ç¨‹ï¼šä¸€æ¬¡æˆªå–å­—ç¬¦ä¸²æ—¥æœŸç®—æ³•ä¼˜åŒ–å†ç¨‹/" class="post-title-link" itemprop="url">iOS ç¼–ç¨‹ï¼šä¸€æ¬¡æˆªå–å­—ç¬¦ä¸²æ—¥æœŸç®—æ³•ä¼˜åŒ–å†ç¨‹</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              

              
                
              

              <time title="åˆ›å»ºæ—¶é—´ï¼š2018-01-04 11:09:00" itemprop="dateCreated datePublished" datetime="2018-01-04T11:09:00+08:00">2018-01-04</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">æ›´æ–°äº</span>
                
                <time title="ä¿®æ”¹æ—¶é—´ï¼š2019-04-28 15:59:34" itemprop="dateModified" datetime="2019-04-28T15:59:34+08:00">2019-04-28</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Objective-C-ç¼–ç¨‹/" itemprop="url" rel="index"><span itemprop="name">Objective-C ç¼–ç¨‹</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          

          

          
            <div class="post-symbolscount">
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">æœ¬æ–‡å­—æ•°ï¼š</span>
                
                <span title="æœ¬æ–‡å­—æ•°">4.9k</span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">é˜…è¯»æ—¶é•¿ &asymp;</span>
                
                <span title="é˜…è¯»æ—¶é•¿">4 åˆ†é’Ÿ</span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body han-init-context" itemprop="articleBody">

      
      

      
        
          
            <p><img src="https://blog-andy0570-1256077835.cos.ap-shanghai.myqcloud.com/site_Images/075354.jpg" alt></p>
<p>&lt;!-- more --&gt;</p>
<h3>é—®é¢˜åˆ†æ</h3>
<ul>
<li>éœ€æ±‚ï¼šåœ¨UIé¡µé¢ä¸Šæ˜¾ç¤ºèµ·æ­¢å¹´æœˆã€‚</li>
<li>åå°æœåŠ¡å™¨è¿”å›çš„åŸå§‹å­—ç¬¦ä¸²ï¼š<code>201709â€”â€”â€”â€”â€”201709</code>ï¼Œåœ¨åå°è€å¤§å“¥çš„çœ¼é‡Œï¼Œè¿™ç§æ ¼å¼å½“ç„¶æ˜¯å®Œç¾çš„ğŸ¤·ğŸ»â€â™‚ï¸ï¼Œå¯åœ¨å‰ç«¯çœ¼é‡Œï¼Œå¦‚æœç›´æ¥æŠŠé…±ç´«çš„å­—ç¬¦ä¸²ç›´æ¥æ˜¾ç¤ºåœ¨é¡µé¢ä¸Šï¼Œæ˜¾ç¤ºç²—ç³™ï¼Œåˆéš¾è¯»ï¼Œç”¨æˆ·ä½“éªŒéå¸¸ç³Ÿç³•ï¼Œè¿æˆ‘è¿™æ ·æ¯«æ— å®¡ç¾æ„Ÿçš„ç¨‹åºçŒ¿éƒ½çœ‹ä¸ä¸‹å»äº†å¥½å§ã€‚</li>
<li>ä¼˜åŒ–åæ˜¾ç¤ºå­—ç¬¦ä¸²ï¼š<code>2017å¹´9æœˆ â‡€ 2017å¹´9æœˆ</code>ã€‚</li>
</ul>
<h3>æœ€åˆçš„æ–¹æ³•ï¼šç”¨æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…ï¼Œå†æˆªå–ï¼Œå¯èƒ½å­˜åœ¨è¾¹ç•Œæº¢å‡ºå¯¼è‡´å´©æºƒã€‚</h3>
<p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">// æ­£åˆ™è¡¨è¾¾å¼</span><br><span class="line">- (BOOL)validateExpensePeriod &#123;</span><br><span class="line">    NSString *regex = @&quot;^\\d&#123;6&#125;\\D+\\d&#123;6&#125;$&quot;;</span><br><span class="line">    NSPredicate *predicate = [NSPredicate predicateWithFormat:@&quot;SELF MATCHES %@&quot;,regex];</span><br><span class="line">    return [predicate evaluateWithObject:_expensePeriod];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// è¾“å…¥æ—¥æœŸæ ¼å¼</span><br><span class="line">- (NSDateFormatter *)inputDateFormatter &#123;</span><br><span class="line">    if (!_inputDateFormatter) &#123;</span><br><span class="line">        _inputDateFormatter = [[NSDateFormatter alloc] init];</span><br><span class="line">        _inputDateFormatter.dateFormat = @&quot;yyyyMM&quot;; // 201710</span><br><span class="line">    &#125;</span><br><span class="line">    return _inputDateFormatter;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// è¾“å‡ºæ—¥æœŸæ ¼å¼</span><br><span class="line">- (NSDateFormatter *)outputDateFormatter &#123;</span><br><span class="line">    if (!_outputDateFormatter) &#123;</span><br><span class="line">        _outputDateFormatter = [[NSDateFormatter alloc] init];</span><br><span class="line">        _outputDateFormatter.dateFormat = @&quot;yyyyå¹´MMM&quot;; // 2017å¹´10æœˆ</span><br><span class="line">    &#125;</span><br><span class="line">    return _outputDateFormatter;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// ...</span><br><span class="line"></span><br><span class="line">// å› ä¸ºåå°æœ‰æ—¶å€™ä¼šè¿”å›é¢„æ–™ä¹‹å¤–çš„å­—ç¬¦ä¸²ï¼Œå¦‚æœä»æŒ‰ç…§æ­£å¸¸é€»è¾‘æˆªå–ä¼šå¯¼è‡´è¾¹ç•Œæº¢å‡ºå´©æºƒâ€”â€”è¦èƒŒé”…çš„å“¦</span><br><span class="line">NSUInteger strLength = _expensePeriod.length;</span><br><span class="line">if (strLength &lt; 16 || ![self validateExpensePeriod]) &#123;</span><br><span class="line">    return _expensePeriod;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// æˆªå–å­—ç¬¦ä¸²ä¸­çš„å¼€å§‹æ—¥æœŸå’Œç»“æŸæ—¥æœŸ</span><br><span class="line">NSString *beginDateStr = [_expensePeriod substringToIndex:6];</span><br><span class="line">NSString *endDateStr = [_expensePeriod substringFromIndex:strLength-6];    </span><br><span class="line"></span><br><span class="line">// å°†å­—ç¬¦ä¸²è½¬æ¢ä¸º</span><br><span class="line">NSDate *beginDate = [self.inputDateFormatter dateFromString:beginDateStr];</span><br><span class="line">NSDate *endDate   = [self.inputDateFormatter dateFromString:endDateStr];</span><br><span class="line">if ((beginDate == nil) || (endDate == nil)) &#123;</span><br><span class="line">    return _expensePeriod;</span><br><span class="line">&#125;else &#123;</span><br><span class="line">    NSString *formartDateStr = [NSString stringWithFormat:@&quot;%@ â‡€ %@&quot;,</span><br><span class="line">                                [self.outputDateFormatter stringFromDate:beginDate],</span><br><span class="line">                                [self.outputDateFormatter stringFromDate:endDate]];</span><br><span class="line">    return formartDateStr;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3>ä¼˜åŒ–æ–¹æ³•ï¼Œæ­£åˆ™è¡¨è¾¾å¼è¿”å›æ‰€æœ‰åŒ¹é…ç»“æœçš„èŒƒå›´ï¼Œè‡ªåŠ¨æˆªå–ï¼Œå®ç°æˆåŠŸï¼Œæ–¹æ³•å¤ªè¿‡å¤æ‚</h3>
<p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">// æ ‡ç­¾æ–‡æœ¬å­—ç¬¦ä¸²</span><br><span class="line">- (NSString *)expensePeriodLabelText &#123;</span><br><span class="line">    // ä¼˜åŒ–æ˜¾ç¤ºèµ·æ­¢æ—¥æœŸ 201709----201709</span><br><span class="line">    NSUInteger strLength = _expensePeriod.length;</span><br><span class="line">    __block NSString *beginDateStr;</span><br><span class="line">    __block NSString *endDateStr;</span><br><span class="line">    </span><br><span class="line">    // æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…ç»“æœ</span><br><span class="line">    NSString *regex = @&quot;\\d&#123;6&#125;&quot;;</span><br><span class="line">    NSRegularExpression *regularExpression = [NSRegularExpression regularExpressionWithPattern:regex options:NSRegularExpressionCaseInsensitive error:nil];</span><br><span class="line">  	// æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…ï¼Œå°†ç»“æœè¿”å›åˆ°æ•°ç»„</span><br><span class="line">    NSArray *matches = [regularExpression matchesInString:_expensePeriod options:NSMatchingReportProgress range:NSMakeRange(0, strLength)];</span><br><span class="line">    if (matches.count &gt; 0 &amp;&amp; matches.count == 2) &#123;</span><br><span class="line">        [matches enumerateObjectsUsingBlock:^(NSTextCheckingResult *obj, NSUInteger idx, BOOL * _Nonnull stop) &#123;</span><br><span class="line">            // ç”¨åŒ¹é…ç»“æœçš„èŒƒå›´å»æˆªå–å­—ç¬¦ä¸²</span><br><span class="line">            if (idx == 0) &#123;</span><br><span class="line">                beginDateStr = [_expensePeriod substringWithRange:obj.range];</span><br><span class="line">            &#125;else &#123;</span><br><span class="line">                endDateStr = [_expensePeriod substringWithRange:obj.range];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;];</span><br><span class="line">    &#125;else &#123;</span><br><span class="line">        return _expensePeriod;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    NSDate *beginDate = [self.inputDateFormatter dateFromString:beginDateStr];</span><br><span class="line">    NSDate *endDate   = [self.inputDateFormatter dateFromString:endDateStr];</span><br><span class="line">    if ((beginDate == nil) || (endDate == nil)) &#123;</span><br><span class="line">        return _expensePeriod;</span><br><span class="line">    &#125;else &#123;</span><br><span class="line">        NSString *formartDateStr = [NSString stringWithFormat:@&quot;%@ â‡€ %@&quot;,</span><br><span class="line">                                    [self.outputDateFormatter stringFromDate:beginDate],</span><br><span class="line">                                    [self.outputDateFormatter stringFromDate:endDate]];</span><br><span class="line">        return formartDateStr;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3>å†ä¼˜åŒ–æ–¹æ³•ï¼Œä½¿ç”¨ YYKit æ–¹æ³•ï¼Œæ–¹æ³•ç›¸å¯¹ç®€æ´</h3>
<p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">- (NSString *)expensePeriodLabelText &#123;</span><br><span class="line">    __block NSMutableArray *mutableArray = [NSMutableArray arrayWithCapacity:2];</span><br><span class="line">    [_expensePeriod enumerateRegexMatches:@&quot;\\d&#123;6&#125;&quot; options:NSRegularExpressionCaseInsensitive usingBlock:^(NSString * _Nonnull match, NSRange matchRange, BOOL * _Nonnull stop) &#123;</span><br><span class="line">        [mutableArray addObject:match];</span><br><span class="line">    &#125;];</span><br><span class="line">    if (mutableArray.count != 2) &#123;</span><br><span class="line">        return _expensePeriod;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    NSDate *beginDate = [self.inputDateFormatter dateFromString:mutableArray.firstObject];</span><br><span class="line">    NSDate *endDate   = [self.inputDateFormatter dateFromString:mutableArray.lastObject];</span><br><span class="line">    if (!beginDate || !endDate) &#123;</span><br><span class="line">        return _expensePeriod;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    NSString *formartDateStr = [NSString stringWithFormat:@&quot;%@ â‡€ %@&quot;,</span><br><span class="line">                                [self.outputDateFormatter stringFromDate:beginDate],</span><br><span class="line">                                [self.outputDateFormatter stringFromDate:endDate]];</span><br><span class="line">    return formartDateStr;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>æœ€ç»ˆçš„æ•ˆæœï¼š</p>
<p><img src="http://upload-images.jianshu.io/upload_images/2648731-dd9478bfaa14c70d.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt></p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://andy0570.com/2017/12/29/iOS ç¼–ç¨‹ï¼šæ˜Ÿçº§è¯„ä»·åŠŸèƒ½çš„ä¸¤ç§å®ç°æ–¹å¼/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ç‹¬æœ¨èˆŸçš„æœ¨">
      <meta itemprop="description" content="æœ‰æ—¶å€™é˜³å…‰å¾ˆå¥½ æœ‰æ—¶å€™é˜³å…‰å¾ˆæš—">
      <meta itemprop="image" content="https://blog-andy0570-1256077835.cos.ap-shanghai.myqcloud.com/site_Images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ç‹¬æœ¨èˆŸçš„æœ¨">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2017/12/29/iOS ç¼–ç¨‹ï¼šæ˜Ÿçº§è¯„ä»·åŠŸèƒ½çš„ä¸¤ç§å®ç°æ–¹å¼/" class="post-title-link" itemprop="url">iOS ç¼–ç¨‹ï¼šæ˜Ÿçº§è¯„ä»·åŠŸèƒ½çš„ä¸¤ç§å®ç°æ–¹å¼</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              

              
                
              

              <time title="åˆ›å»ºæ—¶é—´ï¼š2017-12-29 13:17:00" itemprop="dateCreated datePublished" datetime="2017-12-29T13:17:00+08:00">2017-12-29</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">æ›´æ–°äº</span>
                
                <time title="ä¿®æ”¹æ—¶é—´ï¼š2019-05-01 21:51:11" itemprop="dateModified" datetime="2019-05-01T21:51:11+08:00">2019-05-01</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/iOS/" itemprop="url" rel="index"><span itemprop="name">iOS</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          

          

          
            <div class="post-symbolscount">
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">æœ¬æ–‡å­—æ•°ï¼š</span>
                
                <span title="æœ¬æ–‡å­—æ•°">11k</span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">é˜…è¯»æ—¶é•¿ &asymp;</span>
                
                <span title="é˜…è¯»æ—¶é•¿">10 åˆ†é’Ÿ</span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body han-init-context" itemprop="articleBody">

      
      

      
        
          
            <p><img src="https://blog-andy0570-1256077835.cos.ap-shanghai.myqcloud.com/site_Images/073232.jpg" alt="å›¾ç‰‡æ¥è‡ª Pixabay"></p>
<p>&lt;!-- more --&gt;</p>
<p>å¦‚ä½•åœ¨ iOS åº”ç”¨ä¸Šç”¨è‡ªå®šä¹‰è§†å›¾å®ç°æ˜Ÿçº§è¯„åˆ†åŠŸèƒ½å‘¢ï¼Ÿæœ€è¿‘ç ”ç©¶å­¦ä¹ äº†ä¸¤ä¸ªå®ç°æ–¹æ³•ï¼Œç°æ€»ç»“å¦‚ä¸‹ï¼š</p>
<h2>ä¸€ã€å®ç°æ–¹å¼ä¸€</h2>
<p>å‚è€ƒ Ray Wenderlich ç³»åˆ—æ•™ç¨‹ï¼š</p>
<p><a href="https://www.raywenderlich.com/1768/uiview-tutorial-for-ios-how-to-make-a-custom-uiview-in-ios-5-a-5-star-rating-view" target="_blank" rel="noopener">UIView Tutorial for iOS: How To Make a Custom UIView in iOS 5: A 5 Star Rating View</a></p>
<h3>1.Demo ç¤ºä¾‹</h3>
<p><img src="https://blog-andy0570-1256077835.cos.ap-shanghai.myqcloud.com/site_Images/073239.gif" alt></p>
<h3>2.å®ç°çš„åŠŸèƒ½ï¼š</h3>
<ol>
<li>å¯ä»»æ„è®¾ç½®æ˜Ÿæ˜Ÿæ•°é‡;</li>
<li>å¯ä»¥è®¾ç½®æ˜Ÿæ˜Ÿæ˜¯å¦å¯ç¼–è¾‘ã€æ˜Ÿæ˜Ÿçš„å·¦è¾¹è·ã€æ˜Ÿæ˜Ÿä¹‹é—´çš„é—´éš”ç­‰ï¼›</li>
<li>æ•´æ˜Ÿè¯„ä»·å’ŒåŠæ˜Ÿè¯„ä»·ï¼›</li>
<li><strong>ä¸ä»…ä»…æ˜¯ç‚¹å‡»è§¦æ‘¸å±å¹•è¯„åˆ†ï¼Œè¿˜å¯ä»¥å®ç°æ‰‹æŒ‡æŒ‰ä½å±å¹•æ»‘åŠ¨è¯„åˆ†;</strong></li>
<li>ç”¨ Delegate æ–¹å¼å®ç°å›è°ƒï¼›</li>
</ol>
<h3>3.è§†å›¾å±‚çº§</h3>
<p><img src="https://blog-andy0570-1256077835.cos.ap-shanghai.myqcloud.com/site_Images/073245.jpg" alt="è§†å›¾å±‚çº§"></p>
<p>è§†å›¾çš„å±‚çº§æ¯”è¾ƒç®€å•ï¼Œä¸€ä¸ªè‡ªå®šä¹‰ UIView å­ç±»å¯¹è±¡ï¼Œä¸Šé¢æ·»åŠ äº† 5 ä¸ªæ˜Ÿæ˜Ÿå›¾ç‰‡å¯¹è±¡ï¼Œå³ UIImageView å¯¹è±¡ã€‚</p>
<p>è¯„åˆ†å€¼ä¿®æ”¹æ—¶ï¼Œæˆ‘ä»¬éœ€è¦éå†è¿™5ä¸ª UIImageView å¯¹è±¡ï¼Œå¹¶å¯¹ä»–ä»¬çš„å›¾ç‰‡è¿›è¡Œç›¸åº”çš„æ›´æ”¹ã€‚</p>
<h3>4.å®ç°åŸç†ï¼šæ ¹æ® rating å€¼éå†è®¾ç½®æ¯ä¸ªæ˜Ÿæ˜Ÿå›¾æ¡ˆ</h3>
<p>è®²è§£ä¸€ä¸‹å¤§æ¦‚çš„å®ç°æ€è·¯ï¼Œå…·ä½“å†…å®¹å¯ä»¥å‚è€ƒæºç ï¼š<a href="https://github.com/Andy0570/CustomView" target="_blank" rel="noopener">GitHub</a></p>
<ol>
<li>é¦–å…ˆéœ€è¦ä¸‰å¼ æ˜Ÿæ˜Ÿå›¾ç‰‡ï¼šç©ºæ˜Ÿå›¾ç‰‡ã€åŠæ˜Ÿå›¾ç‰‡ã€å…¨æ˜Ÿå›¾ç‰‡ï¼š</li>
</ol>
<p><img src="https://blog-andy0570-1256077835.cos.ap-shanghai.myqcloud.com/site_Images/073248.jpg" alt="kermit_empty"><img src="https://blog-andy0570-1256077835.cos.ap-shanghai.myqcloud.com/site_Images/073250.jpg" alt="kermit_half"><img src="https://blog-andy0570-1256077835.cos.ap-shanghai.myqcloud.com/site_Images/073252.jpg" alt="kermit_full"></p>
<ol start="2">
<li>
<p>åˆå§‹åŒ–è®¾ç½®æœ€å¤§è¯„åˆ†æ•° <code>maxRating</code>ï¼ˆå³æ€»å…±çš„æ˜Ÿæ˜Ÿæ•°é‡ï¼‰æ—¶ï¼Œå°±æŠŠæ‰€æœ‰çš„ imageView æ·»åŠ åˆ°è§†å›¾ä¸Šï¼Œç„¶åå‘é€ <code>[self setNeedsLayout]</code> æ–¹æ³•è®©ç³»ç»Ÿå¸ƒå±€å­è§†å›¾ï¼ˆå³ <code>layoutSubviews</code>ï¼‰ï¼Œè®¡ç®—æ¯ä¸ª imageView çš„ä½ç½®å’Œå¤§å°ï¼š</p>
<p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line">/*</span><br><span class="line"> è®¾ç½®æœ€å¤§è¯„åˆ†æ•°ï¼Œå®ƒå†³å®šäº†æˆ‘ä»¬ä¼šæœ‰å¤šå°‘ä¸ª UIImageView å­è§†å›¾</span><br><span class="line"> åšäº†ä¸¤ä»¶äº‹ï¼š</span><br><span class="line"> 1.æ·»åŠ å›¾ç‰‡ï¼šæ ¹æ®æœ€å¤§è¯„åˆ†æ•°åˆå§‹åŒ–å›¾ç‰‡æ•°é‡ï¼Œç§»é™¤æ—§å›¾ç‰‡ï¼Œæ·»åŠ æ–°å›¾ç‰‡ã€‚</span><br><span class="line"> 2.åˆ·æ–°UIï¼Œè®¾ç½®å›¾ç‰‡å¤§å°ï¼šè°ƒç”¨ setNeedsLayout æ–¹æ³•åï¼Œç³»ç»Ÿä¼šè°ƒç”¨ layoutSubviews æ–¹æ³•æ¥è®¾ç½®æ¯ä¸ªå›¾ç‰‡çš„ä½ç½®å’Œå¤§å°ã€‚</span><br><span class="line"> */</span><br><span class="line">- (void)setMaxRating:(int)maxRating &#123;</span><br><span class="line">    _maxRating = maxRating;</span><br><span class="line">    </span><br><span class="line">    // ç§»é™¤æ‰€æœ‰æ—§çš„å›¾ç‰‡</span><br><span class="line">    for (int i = 0; i &lt; self.imageViews.count; i++) &#123;</span><br><span class="line">        UIImageView *imageView = (UIImageView *)[self.imageViews objectAtIndex:i];</span><br><span class="line">        [imageView removeFromSuperview];</span><br><span class="line">    &#125;</span><br><span class="line">    [self.imageViews removeAllObjects];</span><br><span class="line">    </span><br><span class="line">    // é‡æ–°æ·»åŠ æ–°çš„å›¾ç‰‡</span><br><span class="line">    for (int i = 0; i &lt; maxRating; i++) &#123;</span><br><span class="line">        UIImageView *imageView = [[UIImageView alloc] init];</span><br><span class="line">        imageView.contentMode = UIViewContentModeScaleAspectFit;</span><br><span class="line">        [self.imageViews addObject:imageView];</span><br><span class="line">        [self addSubview:imageView];</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    // é‡æ–°å¸ƒå±€ã€åˆ·æ–°UI</span><br><span class="line">    [self setNeedsLayout];</span><br><span class="line">    [self refresh];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// è®¾ç½®åˆé€‚çš„å­è§†å›¾å¤§å°</span><br><span class="line">- (void)layoutSubviews &#123;</span><br><span class="line">    [super layoutSubviews];</span><br><span class="line">    </span><br><span class="line">    if (!self.notSelectedImage) &#123;</span><br><span class="line">        return;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    /*</span><br><span class="line">     è®¾ç½®æ¯ä¸ªäº”è§’æ˜Ÿçš„å°ºå¯¸å¤§å°</span><br><span class="line">     è¿™é‡Œï¼Œæ•™ç¨‹ä¸­çš„è®¡ç®—æ–¹æ³•å¦‚ä¸‹ï¼Œè¯·ä»”ç»†çœ‹ï¼Œä»–çš„æ•°å­¦ä¼°è®¡æ˜¯ä½“è‚²è€å¸ˆæ•™çš„å§ã€‚ğŸ˜‚ğŸ˜‚ğŸ˜‚</span><br><span class="line">     float desiredImageWidth = (self.frame.size.width - (self.leftMargin*2) - (self.midMargin*self.imageViews.count)) / self.imageViews.count;</span><br><span class="line">     */</span><br><span class="line">    float desiredImageWidth = (self.frame.size.width - self.leftMargin*2 -(self.midMargin*(self.imageViews.count-1))) / self.imageViews.count;</span><br><span class="line">    float imageWidth = MAX(self.minImageSize.width, desiredImageWidth);</span><br><span class="line">    float imageHeight = MAX(self.minImageSize.height, desiredImageWidth);</span><br><span class="line">    for (int i = 0; i &lt; self.imageViews.count; i++) &#123;</span><br><span class="line">        </span><br><span class="line">        UIImageView *imageView = [self.imageViews objectAtIndex:i];</span><br><span class="line">        CGRect imageFrame = CGRectMake(self.leftMargin + i*(self.midMargin+imageWidth), 0, imageWidth, imageHeight);</span><br><span class="line">        imageView.frame = imageFrame;</span><br><span class="line">    </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
</li>
<li>
<p>ä»¥ä¸Šä¸¤ä¸ªæ­¥éª¤ä¸­ï¼Œæˆ‘ä»¬è®¾ç½®äº†æœ€å¤§è¯„åˆ†æ•°ã€æ·»åŠ å¹¶å¸ƒå±€å¥½äº†æ‰€æœ‰çš„ imageViewã€‚æ¥ä¸‹æ¥ï¼Œéœ€è¦æ¥æ”¶ç”¨æˆ·äº‹ä»¶ï¼Œæ ¹æ®ç”¨æˆ·æ‰‹æŒ‡è§¦æ‘¸çš„ä½ç½®è®¡ç®—è¯„åˆ†å€¼ <code>rating</code>:</p>
<p>é¦–å…ˆï¼Œè¦æ¥å—ç”¨æˆ·çš„è§¦æ‘¸äº‹ä»¶ï¼š</p>
<p>å› ä¸º <strong>UIView</strong> æ˜¯ <strong>UIResponder</strong> çš„å­ç±»ï¼Œæ‰€ä»¥è¦†ç›–ä»¥ä¸‹å››ä¸ªæ–¹æ³•å°±å¯ä»¥å¤„ç†å››ç§ä¸åŒçš„è§¦æ‘¸äº‹ä»¶ï¼š</p>
<p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">// â‘  ä¸€æ ¹æ‰‹æŒ‡æˆ–å¤šæ ¹æ‰‹æŒ‡è§¦æ‘¸å±å¹•</span><br><span class="line">- (void)touchesBegan:(NSSet&lt;UITouch *&gt; *)touches withEvent:(nullable UIEvent *)event;</span><br><span class="line"></span><br><span class="line">// â‘¡ ä¸€æ ¹æ‰‹æŒ‡æˆ–å¤šæ ¹æ‰‹æŒ‡åœ¨å±å¹•ä¸Šç§»åŠ¨ï¼ˆéšç€æ‰‹æŒ‡çš„ç§»åŠ¨ï¼Œç›¸å…³çš„å¯¹è±¡ä¼šæŒç»­å‘é€è¯¥æ¶ˆæ¯ï¼‰</span><br><span class="line">- (void)touchesMoved:(NSSet&lt;UITouch *&gt; *)touches withEvent:(nullable UIEvent *)event;</span><br><span class="line"></span><br><span class="line">// â‘¢ ä¸€æ ¹æ‰‹æŒ‡æˆ–å¤šæ ¹æ‰‹æŒ‡ç¦»å¼€å±å¹•</span><br><span class="line">- (void)touchesEnded:(NSSet&lt;UITouch *&gt; *)touches withEvent:(nullable UIEvent *)event;</span><br><span class="line"></span><br><span class="line">// â‘£ åœ¨è§¦æ‘¸æ“ä½œæ­£å¸¸ç»“æŸå‰ï¼ŒæŸä¸ªç³»ç»Ÿäº‹ä»¶ï¼ˆä¾‹å¦‚çªç„¶æ¥ç”µè¯ï¼‰æ‰“æ–­äº†è§¦æ‘¸è¿‡ç¨‹</span><br><span class="line">- (void)touchesCancelled:(NSSet&lt;UITouch *&gt; *)touches withEvent:(nullable UIEvent *)event;</span><br></pre></td></tr></table></figure></p>
<p>è¿™é‡Œæˆ‘ä»¬åªç”¨åˆ°äº†å‰ä¸‰ä¸ªæ–¹æ³•ï¼š</p>
<p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">- (void)touchesBegan:(NSSet&lt;UITouch *&gt; *)touches withEvent:(UIEvent *)event &#123;</span><br><span class="line">    UITouch *touch = [touches anyObject];</span><br><span class="line">    CGPoint touchLocation = [touch locationInView:self];</span><br><span class="line">    [self handleTouchAtLocation:touchLocation];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (void)touchesMoved:(NSSet&lt;UITouch *&gt; *)touches withEvent:(UIEvent *)event &#123;</span><br><span class="line">    UITouch *touch = [touches anyObject];</span><br><span class="line">    CGPoint touchLocation = [touch locationInView:self];</span><br><span class="line">    [self handleTouchAtLocation:touchLocation];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (void)touchesEnded:(NSSet&lt;UITouch *&gt; *)touches withEvent:(UIEvent *)event &#123;</span><br><span class="line">    [self.delegate rateView:self ratingDidChange:self.rating];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>æœ€æœ€é‡è¦çš„æ˜¯ï¼Œè®¡ç®—è¯„åˆ†å€¼çš„æ–¹æ³•ï¼š<strong>å°†å½“å‰æ‰‹æŒ‡è§¦æ‘¸ä½ç½®çš„ X å€¼ä¸æ¯ä¸ª <code>imageView</code> å®½åº¦çš„ä¸­ç‚¹ä½œæ¯”è¾ƒ</strong>ï¼š</p>
<p><img src="https://blog-andy0570-1256077835.cos.ap-shanghai.myqcloud.com/site_Images/073253.jpg" alt="äº”è§’æ˜Ÿ-2"></p>
<ol>
<li>å¦‚æœè§¦æ‘¸ä½ç½®çš„Xå€¼ &gt; å½“å‰å›¾ç‰‡å®½åº¦çš„ä¸­ç‚¹ï¼Œé‚£ <code>rating</code> å€¼å°±æ˜¯æ•´æ•°ï¼Œæ˜¯å…¨æ˜Ÿè¯„ä»·ã€‚</li>
<li>å¦‚æœ  è§¦æ‘¸ä½ç½®çš„Xå€¼ &lt;= å½“å‰å›¾ç‰‡å®½å¸¦çš„ä¸­ç‚¹ï¼Œå¹¶ä¸”è§¦æ‘¸ä½ç½®çš„Xå€¼ &gt; å½“å‰å›¾ç‰‡çš„èµ·å§‹å€¼ï¼Œé‚£ <code>rating</code> å€¼å°±æ˜¯ éæ•´æ•°ï¼ŒåŠæ˜Ÿè¯„ä»·ã€‚</li>
</ol>
<p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">// æ ¹æ®æ‰‹æŒ‡è§¦æ‘¸ä½ç½®ï¼Œè®¡ç®—å½“å‰è¯„åˆ†å€¼</span><br><span class="line">- (void)handleTouchAtLocation:(CGPoint)touchLocation &#123;</span><br><span class="line">    if (!self.editable) &#123;</span><br><span class="line">        return;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    float newRating = 0;</span><br><span class="line">    for (NSInteger i = self.imageViews.count - 1; i &gt;= 0 ; i--) &#123;</span><br><span class="line">        UIImageView *imageView = [self.imageViews objectAtIndex:i];</span><br><span class="line">        CGFloat originValue = imageView.frame.origin.x;</span><br><span class="line">        CGFloat midValue = originValue + imageView.frame.size.width / 2;</span><br><span class="line">                </span><br><span class="line">        if (touchLocation.x &gt; midValue) &#123;</span><br><span class="line">            newRating = i+1;</span><br><span class="line">            break;</span><br><span class="line">        &#125;else if ((touchLocation.x &gt; originValue) &amp;&amp; (touchLocation.x &lt;= midValue)) &#123;</span><br><span class="line">            newRating = i + 0.5;</span><br><span class="line">            break;</span><br><span class="line">        &#125;else &#123;</span><br><span class="line">            continue;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    self.rating = newRating;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (void)setRating:(float)rating &#123;</span><br><span class="line">    _rating = rating;</span><br><span class="line">    [self refresh]; // æ¯æ¬¡è¯„åˆ†å€¼æ”¹å˜ï¼Œå°±è°ƒç”¨åˆ·æ–°æ–¹æ³•ï¼Œé‡æ–°è®¾ç½® imageView.![Demo](StarRateView/image/Demo.gif)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
</li>
<li>
<p>ä¸Šé¢ä¸€ä¸ªæ­¥éª¤ï¼Œæˆ‘ä»¬å¾—åˆ°äº†è¯„åˆ†å€¼ã€‚æœ€åï¼Œæ¯æ¬¡ <code>rating</code> å€¼è¯¥æ”¹å˜ï¼Œå°±é‡æ–°è®¾ç½® imageView:</p>
<p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">// åˆ·æ–°è§†å›¾ï¼Œæ ¹æ®å½“å‰è¯„åˆ†ä¿®æ”¹å¯¹åº”çš„äº”è§’æ˜Ÿå›¾ç‰‡</span><br><span class="line">- (void)refresh &#123;</span><br><span class="line">    // ä»å·¦å¾€å³éå†æ¯ä¸ªå°æ˜Ÿæ˜Ÿ</span><br><span class="line">    for (int i = 0; i &lt; self.imageViews.count; i++) &#123;</span><br><span class="line">        UIImageView *imageView = [self.imageViews objectAtIndex:i];</span><br><span class="line">        if (self.rating &gt;= i+1) &#123;</span><br><span class="line">            // å¦‚æœ rating &gt;= è¯¥æ˜Ÿæ˜Ÿå›¾ç‰‡çš„ç´¢å¼•ï¼Œåˆ™è¯¥æ˜Ÿæ˜Ÿæ˜¯å…¨æ˜Ÿå›¾ç‰‡ã€‚</span><br><span class="line">            imageView.image = self.fullSelectedImage;</span><br><span class="line">        &#125;else if (self.rating &gt; i) &#123;</span><br><span class="line">            // å¦‚æœ rating &gt; ä¸Šä¸€ä¸ªå›¾ç‰‡ç´¢å¼•ï¼Œåˆ™è¯¥æ˜Ÿæ˜Ÿæ˜¯åŠæ˜Ÿå›¾ç‰‡ã€‚</span><br><span class="line">            imageView.image = self.halfSelectedImage;</span><br><span class="line">        &#125;else &#123;</span><br><span class="line">            // é»˜è®¤ï¼Œç©ºæ˜Ÿå›¾ç‰‡ã€‚</span><br><span class="line">            imageView.image = self.notSelectedImage;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
</li>
<li>
<p>æ•´ä¸ªå®ç°æ€è·¯å¤§è‡´å¦‚ä¸Šã€‚</p>
</li>
</ol>
<h2>å®ç°æ–¹å¼äºŒ</h2>
<p>å‚è€ƒ @XHJCoder çš„æºç ï¼š</p>
<p><a href="https://www.jianshu.com/p/f7ccfca4bf71" target="_blank" rel="noopener">ç®€ä¹¦ï¼šã€iOSã€‘å®ç°æ˜Ÿçº§è¯„åˆ†</a></p>
<h3>1.Demoç¤ºä¾‹</h3>
<p><img src="https://blog-andy0570-1256077835.cos.ap-shanghai.myqcloud.com/site_Images/073253.gif" alt></p>
<h3>2.å®ç°çš„åŠŸèƒ½</h3>
<ol>
<li>å¯ä»»æ„è®¾ç½®æ˜Ÿæ˜Ÿæ•°é‡;</li>
<li>æ”¯æŒåŠ¨ç”»ä¿®æ”¹è¯„è®ºï¼›</li>
<li>è¯„åˆ†æ ·å¼æ”¯æŒï¼šæ•´æ˜Ÿè¯„è®ºã€åŠæ˜Ÿè¯„è®ºã€ä¸å®Œæ•´æ˜Ÿæ˜Ÿè¯„è®ºï¼›</li>
<li>æ”¯æŒ block  å’Œ delegate ä¸¤ç§æ–¹å¼è¿”å›ä¿®æ”¹ç»“æœï¼›</li>
</ol>
<h3>3.å®ç°åŸç†ï¼Œæ ¹æ® rating å€¼æ•´ä½“ä¿®æ”¹è§†å›¾çš„ frame å®½åº¦</h3>
<p>æˆ‘å¯¹æºç  fork å¹¶è¿›è¡Œäº†ä¸€äº›ä¿®æ”¹ï¼š<a href="https://github.com/Andy0570/XHStarRateView" target="_blank" rel="noopener">XHStarRateView</a></p>
<p>ä¸‹é¢æ˜¯è§†å›¾çš„å±‚çº§ç»“æ„ï¼š</p>
<p><img src="https://blog-andy0570-1256077835.cos.ap-shanghai.myqcloud.com/site_Images/073255.jpg" alt="è§†å›¾å±‚çº§"></p>
<ul>
<li>backgroundStarView ã€foregroundStarView æ˜¯ UIView çš„å®ä¾‹å¯¹è±¡ã€‚</li>
<li>backgroundStarView è§†å›¾ä¸Šæ·»åŠ 5ä¸ªç°è‰²çš„ imageViewã€‚</li>
<li>foregroundStarView è§†å›¾ä¸Šæ·»åŠ 5ä¸ªé»„è‰²çš„ image Viewã€‚</li>
</ul>
<ol>
<li>
<p>åˆå§‹åŒ–æ—¶æ·»åŠ æ‰€æœ‰è§†å›¾:</p>
<p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">// æŒ‡å®šåˆå§‹åŒ–æ–¹æ³•</span><br><span class="line">- (instancetype)initWithFrame:(CGRect)frame</span><br><span class="line">                 numberOfStar:(NSInteger)numberOfStar</span><br><span class="line">                    rateStyle:(XHStarRateViewRateStye)rateStyle</span><br><span class="line">                  isAnimation:(BOOL)isAnimation</span><br><span class="line">                   completion:(XHStarRateViewRateCompletionBlock)completionBlock</span><br><span class="line">                     delegate:(id)delegate</span><br><span class="line">&#123;</span><br><span class="line">    if (self = [super initWithFrame:frame]) &#123;</span><br><span class="line">        _numberOfStar    = numberOfStar;</span><br><span class="line">        _rateStyle       = rateStyle;</span><br><span class="line">        _isAnimation     = isAnimation;</span><br><span class="line">        _completionBlock = completionBlock;</span><br><span class="line">        _delegate        = delegate;</span><br><span class="line">        [self createStarView];</span><br><span class="line">    &#125;</span><br><span class="line">    return self;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (void)createStarView &#123;</span><br><span class="line">    self.foregroundStarView = [self createStarViewWithImageNamed:KForegroundStarImage];</span><br><span class="line">    self.backgroundStarView = [self createStarViewWithImageNamed:KBackgroundStarImage];</span><br><span class="line">    </span><br><span class="line">    self.foregroundStarView.frame = CGRectMake(0, 0, self.bounds.size.width * _currentRating / _numberOfStar, self.bounds.size.height);</span><br><span class="line">    [self addSubview:self.backgroundStarView];</span><br><span class="line">    [self addSubview:self.foregroundStarView];</span><br><span class="line"></span><br><span class="line">    //...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (UIView *)createStarViewWithImageNamed:(NSString *)name &#123;</span><br><span class="line">    UIView *view = [[UIView alloc] initWithFrame:self.bounds];</span><br><span class="line">    view.clipsToBounds = YES;</span><br><span class="line">    view.backgroundColor = [UIColor clearColor];</span><br><span class="line">    for (NSInteger i = 0; i &lt; _numberOfStar; i ++) &#123;</span><br><span class="line">        UIImageView *imageView = [[UIImageView alloc] initWithImage:[UIImage imageNamed:name]];</span><br><span class="line">        imageView.frame = CGRectMake(i * self.bounds.size.width / _numberOfStar, 0, self.bounds.size.width / _numberOfStar, self.bounds.size.height);</span><br><span class="line">        imageView.contentMode = UIViewContentModeScaleAspectFit;</span><br><span class="line">        [view addSubview:imageView];</span><br><span class="line">    &#125;</span><br><span class="line">    return view;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
</li>
<li>
<p>ä½¿ç”¨ <strong>UITapGestureRecognizer</strong> å®ç°æ‰‹åŠ¿è¯†åˆ«å¹¶æ›´æ–° rating å€¼ï¼š</p>
<p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">- (void)createStarView &#123;</span><br><span class="line">	//...</span><br><span class="line">	</span><br><span class="line">    UITapGestureRecognizer *tapGesture = [[UITapGestureRecognizer alloc] initWithTarget:self action:@selector(userTapRateView:)];</span><br><span class="line">    tapGesture.numberOfTapsRequired = 1;</span><br><span class="line">    [self addGestureRecognizer:tapGesture];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// è¿™é‡Œé¢ç”¨åˆ°äº†ä¸¤ä¸ªæ•°å­¦å‡½æ•°</span><br><span class="line">// ceilf():è¿”å›å¤§äºæˆ–è€…ç­‰äºæŒ‡å®šè¡¨è¾¾å¼çš„æœ€å°æ•´æ•°ã€‚</span><br><span class="line">// roundf():è¿”å›å››èˆäº”å…¥çš„æ•´æ•°ã€‚</span><br><span class="line">- (void)userTapRateView:(UITapGestureRecognizer *)gesture &#123;</span><br><span class="line">    </span><br><span class="line">    CGPoint tapPoint = [gesture locationInView:self];</span><br><span class="line">    CGFloat offset = tapPoint.x;</span><br><span class="line">    CGFloat realRating = offset / (self.bounds.size.width / _numberOfStar);</span><br><span class="line"></span><br><span class="line">    switch (_rateStyle) &#123;</span><br><span class="line">        case XHStarRateViewRateStyeFullStar: &#123;</span><br><span class="line">            self.currentRating = ceilf(realRating);</span><br><span class="line">            break;</span><br><span class="line">        &#125;</span><br><span class="line">        case XHStarRateViewRateStyeHalfStar: &#123;</span><br><span class="line">            float round = roundf(realRating);</span><br><span class="line">            self.currentRating = (round &gt; realRating) ? round : (round + 0.5);</span><br><span class="line">            break;</span><br><span class="line">        &#125;</span><br><span class="line">        case XHStarRateViewRateStyeIncompleteStar: &#123;</span><br><span class="line">            self.currentRating = realRating;</span><br><span class="line">            break;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
</li>
<li>
<p>æ¯æ¬¡æ›´æ–° rating å€¼å°±ä¿®æ”¹ foregroundStarView çš„ frame å®½åº¦å®ç°åŠ¨ç”»æ•ˆæœã€‚</p>
<p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">- (void)layoutSubviews &#123;</span><br><span class="line">    [super layoutSubviews];</span><br><span class="line">    </span><br><span class="line">    CGFloat animationDuration = (self.isAnimation ? 0.2 : 0);</span><br><span class="line">    [UIView animateWithDuration:animationDuration animations:^&#123;</span><br><span class="line">        self.foregroundStarView.frame = CGRectMake(0, 0, self.bounds.size.width / self.numberOfStar * self.currentRating, self.bounds.size.height);</span><br><span class="line">    &#125;];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
</li>
<li>
<p>OKï¼Œç¬¬äºŒç§æ–¹æ³•å°±æ˜¯å®ç°å¦‚ä¸Šã€‚</p>
</li>
<li>
<p>ç¬¬äºŒç§æ–¹æ³•å°è£…å¾—ç›¸å¯¹ç¬¬ä¸€ç§æ–¹æ³•æ›´å¥½ä¸€äº›ï¼Œè°ƒç”¨ä¹Ÿå¾ˆæ–¹ä¾¿ï¼š</p>
<p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">/*</span><br><span class="line"> 1. Delegate æ–¹å¼åˆ›å»º</span><br><span class="line"> */</span><br><span class="line">XHStarRateView *starRateView = [[XHStarRateView alloc] initWithFrame:CGRectMake(20, 60, 200, 30)];</span><br><span class="line">starRateView.isAnimation = YES; // æœ‰åŠ¨ç”»</span><br><span class="line">starRateView.rateStyle = XHStarRateViewRateStyeIncompleteStar; //å…è®¸ä¸å®Œæ•´æ˜Ÿè¯„è®º</span><br><span class="line">starRateView.tag = 1;</span><br><span class="line">starRateView.delegate = self;</span><br><span class="line">[self.view addSubview:starRateView];</span><br><span class="line"></span><br><span class="line">/*</span><br><span class="line"> 2. åˆå§‹åŒ–æ–¹æ³•åˆ›å»º</span><br><span class="line"> åŠæ˜Ÿè¯„è®ºã€æ— åŠ¨ç”»</span><br><span class="line"> */</span><br><span class="line">XHStarRateView *starRateView2 = [[XHStarRateView alloc] initWithFrame:CGRectMake(20, 100, 200, 30)</span><br><span class="line">                                                         numberOfStar:5</span><br><span class="line">                                                            rateStyle:XHStarRateViewRateStyeHalfStar</span><br><span class="line">                                                          isAnimation:NO</span><br><span class="line">                                                             delegate:self];</span><br><span class="line">starRateView2.tag = 2;</span><br><span class="line">[self.view addSubview:starRateView2];</span><br><span class="line"></span><br><span class="line">/*</span><br><span class="line"> 3. block æ–¹æ³•1</span><br><span class="line"> é»˜è®¤è®¾ç½®ï¼šå®Œæ•´æ˜Ÿè¯„è®ºã€</span><br><span class="line"> */</span><br><span class="line">XHStarRateView *starRateView3 = [[XHStarRateView alloc] initWithFrame:CGRectMake(20, 140, 200, 30) completion:^(CGFloat currentScore) &#123;</span><br><span class="line">    NSLog(@&quot;3----  %f&quot;,currentScore);</span><br><span class="line">&#125;];</span><br><span class="line"></span><br><span class="line">[self.view addSubview:starRateView3];</span><br><span class="line"></span><br><span class="line">/*</span><br><span class="line"> 4. block æ–¹æ³•2</span><br><span class="line"> åŠæ˜Ÿè¯„è®ºã€æœ‰åŠ¨ç”»</span><br><span class="line"> */</span><br><span class="line">XHStarRateView *starRateView4 = [[XHStarRateView alloc] initWithFrame:CGRectMake(20, 180, 200, 30) numberOfStar:8 rateStyle:XHStarRateViewRateStyeHalfStar isAnimation:YES completion:^(CGFloat currentScore) &#123;</span><br><span class="line">    NSLog(@&quot;4----  %f&quot;,currentScore);</span><br><span class="line">&#125;];</span><br><span class="line">[self.view addSubview:starRateView4];</span><br></pre></td></tr></table></figure></p>
</li>
</ol>
<h3>ç¬¬ä¸‰æ–¹æ¡†æ¶</h3>
<ul>
<li><a href="https://github.com/akiroom/AXRatingView" target="_blank" rel="noopener">AXRatingView</a></li>
</ul>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://andy0570.com/2017/12/26/iOS å¤šçº¿ç¨‹ç¼–ç¨‹â€”â€”iOSå¼€å‘çš„ä¸€åº§å¤§å±±/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ç‹¬æœ¨èˆŸçš„æœ¨">
      <meta itemprop="description" content="æœ‰æ—¶å€™é˜³å…‰å¾ˆå¥½ æœ‰æ—¶å€™é˜³å…‰å¾ˆæš—">
      <meta itemprop="image" content="https://blog-andy0570-1256077835.cos.ap-shanghai.myqcloud.com/site_Images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ç‹¬æœ¨èˆŸçš„æœ¨">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2017/12/26/iOS å¤šçº¿ç¨‹ç¼–ç¨‹â€”â€”iOSå¼€å‘çš„ä¸€åº§å¤§å±±/" class="post-title-link" itemprop="url">iOS å¤šçº¿ç¨‹ç¼–ç¨‹â€”â€”iOSå¼€å‘çš„ä¸€åº§å¤§å±±</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              

              
                
              

              <time title="åˆ›å»ºæ—¶é—´ï¼š2017-12-26 17:54:00" itemprop="dateCreated datePublished" datetime="2017-12-26T17:54:00+08:00">2017-12-26</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">æ›´æ–°äº</span>
                
                <time title="ä¿®æ”¹æ—¶é—´ï¼š2019-05-01 22:08:10" itemprop="dateModified" datetime="2019-05-01T22:08:10+08:00">2019-05-01</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/iOS/" itemprop="url" rel="index"><span itemprop="name">iOS</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          

          

          
            <div class="post-symbolscount">
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">æœ¬æ–‡å­—æ•°ï¼š</span>
                
                <span title="æœ¬æ–‡å­—æ•°">27k</span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">é˜…è¯»æ—¶é•¿ &asymp;</span>
                
                <span title="é˜…è¯»æ—¶é•¿">24 åˆ†é’Ÿ</span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body han-init-context" itemprop="articleBody">

      
      

      
        
          
            <p><img src="https://blog-andy0570-1256077835.cos.ap-shanghai.myqcloud.com/site_Images/073257.jpg" alt="&amp;quot;å› ä¸ºå±±åœ¨é‚£é‡Œï¼&amp;quot;â€”â€”1924å¹´ï¼Œè‹±å›½ç™»å±±å®¶George Malloryå›ç­”ã€Šçº½çº¦æ—¶æŠ¥ã€‹&amp;quot;ä½ ä¸ºä»€ä¹ˆè¦æ”€ç™»ç å³°ï¼Ÿ&amp;quot;æ—¶è¯´çš„ä¸€å¥è¯"></p>
<p>&lt;!-- more --&gt;</p>
<h2>GCDç®€ä»‹</h2>
<blockquote>
<p>GCD æ˜¯ <code>libdispatch</code> çš„å¸‚åœºåç§°ï¼Œè€Œ libdispatch ä½œä¸º Apple çš„ä¸€ä¸ªåº“ï¼Œä¸ºå¹¶å‘ä»£ç åœ¨å¤šæ ¸ç¡¬ä»¶ï¼ˆiOS æˆ– OS X ï¼‰ä¸Šæ‰§è¡Œæä¾›æœ‰åŠ›æ”¯æŒã€‚å®ƒå…·æœ‰ä»¥ä¸‹ä¼˜ç‚¹ï¼š</p>
<ul>
<li>GCD èƒ½é€šè¿‡æ¨è¿Ÿæ˜‚è´µè®¡ç®—ä»»åŠ¡å¹¶åœ¨åå°è¿è¡Œå®ƒä»¬æ¥æ”¹å–„ä½ çš„åº”ç”¨çš„å“åº”æ€§èƒ½ã€‚</li>
<li>GCD æä¾›ä¸€ä¸ªæ˜“äºä½¿ç”¨çš„å¹¶å‘æ¨¡å‹è€Œä¸ä»…ä»…åªæ˜¯é”å’Œçº¿ç¨‹ï¼Œä»¥å¸®åŠ©æˆ‘ä»¬é¿å¼€å¹¶å‘é™·é˜±ã€‚</li>
<li>GCD å…·æœ‰åœ¨å¸¸è§æ¨¡å¼ï¼ˆä¾‹å¦‚å•ä¾‹ï¼‰ä¸Šç”¨æ›´é«˜æ€§èƒ½çš„åŸè¯­ä¼˜åŒ–ä½ çš„ä»£ç çš„æ½œåœ¨èƒ½åŠ›ã€‚</li>
</ul>
</blockquote>
<blockquote>
<p>ä¸ºäº†è®©å¼€å‘è€…æ›´åŠ å®¹æ˜“çš„ä½¿ç”¨è®¾å¤‡ä¸Šçš„å¤šæ ¸CPUï¼Œè‹¹æœåœ¨ OS X 10.6 å’Œ iOS 4 ä¸­å¼•å…¥äº† Grand Central Dispatchï¼ˆGCDï¼‰ã€‚Grand Central Dispatch (GCD) æ˜¯ Apple å¼€å‘çš„å¤šçº¿ç¨‹ç¼–ç¨‹è§£å†³æ–¹æ³•ã€‚</p>
<p>é€šè¿‡ GCDï¼Œå¼€å‘è€…ä¸ç”¨å†ç›´æ¥è·Ÿçº¿ç¨‹æ‰“äº¤é“äº†ï¼Œåªéœ€è¦å‘é˜Ÿåˆ—ä¸­æ·»åŠ ä»£ç å—å³å¯ï¼ŒGCD åœ¨åç«¯ç®¡ç†ç€ä¸€ä¸ª<a href="http://en.wikipedia.org/wiki/Thread_pool_pattern" target="_blank" rel="noopener">çº¿ç¨‹æ± </a>ã€‚GCD ä¸ä»…å†³å®šç€ä½ çš„ä»£ç å—å°†åœ¨å“ªä¸ªçº¿ç¨‹è¢«æ‰§è¡Œï¼Œå®ƒè¿˜æ ¹æ®å¯ç”¨çš„ç³»ç»Ÿèµ„æºå¯¹è¿™äº›çº¿ç¨‹è¿›è¡Œç®¡ç†ã€‚è¿™æ ·å¯ä»¥å°†å¼€å‘è€…ä»çº¿ç¨‹ç®¡ç†çš„å·¥ä½œä¸­è§£æ”¾å‡ºæ¥ï¼Œé€šè¿‡é›†ä¸­çš„ç®¡ç†çº¿ç¨‹ï¼Œæ¥ç¼“è§£å¤§é‡çº¿ç¨‹è¢«åˆ›å»ºçš„é—®é¢˜ã€‚</p>
<p>GCD å¸¦æ¥çš„å¦ä¸€ä¸ªé‡è¦æ”¹å˜æ˜¯ï¼Œä½œä¸ºå¼€å‘è€…å¯ä»¥å°†å·¥ä½œè€ƒè™‘ä¸ºä¸€ä¸ªé˜Ÿåˆ—ï¼Œè€Œä¸æ˜¯ä¸€å †çº¿ç¨‹ï¼Œè¿™ç§å¹¶è¡Œçš„æŠ½è±¡æ¨¡å‹æ›´å®¹æ˜“æŒæ¡å’Œä½¿ç”¨ã€‚</p>
<p>GCD å…¬å¼€æœ‰ 5 ä¸ªä¸åŒçš„é˜Ÿåˆ—ï¼šè¿è¡Œåœ¨ä¸»çº¿ç¨‹ä¸­çš„ main queueï¼Œ3 ä¸ªä¸åŒä¼˜å…ˆçº§çš„åå°é˜Ÿåˆ—ï¼Œä»¥åŠä¸€ä¸ªä¼˜å…ˆçº§æ›´ä½çš„åå°é˜Ÿåˆ—ï¼ˆç”¨äº I/Oï¼‰ã€‚ å¦å¤–ï¼Œå¼€å‘è€…å¯ä»¥åˆ›å»ºè‡ªå®šä¹‰é˜Ÿåˆ—ï¼šä¸²è¡Œæˆ–è€…å¹¶è¡Œé˜Ÿåˆ—ã€‚è‡ªå®šä¹‰é˜Ÿåˆ—éå¸¸å¼ºå¤§ï¼Œåœ¨è‡ªå®šä¹‰é˜Ÿåˆ—ä¸­è¢«è°ƒåº¦çš„æ‰€æœ‰ block æœ€ç»ˆéƒ½å°†è¢«æ”¾å…¥åˆ°ç³»ç»Ÿçš„å…¨å±€é˜Ÿåˆ—ä¸­å’Œçº¿ç¨‹æ± ä¸­ã€‚</p>
</blockquote>
<p><img src="https://blog-andy0570-1256077835.cos.ap-shanghai.myqcloud.com/site_Images/073259.png" alt="GCD é˜Ÿåˆ—"></p>
<h3>GCD ä¸ æ“ä½œé˜Ÿåˆ— ï¼ˆoperation queueï¼‰</h3>
<p>GCD æ˜¯çº¯ C çš„ APIï¼Œè€Œæ“ä½œé˜Ÿåˆ—åˆ™æ˜¯ Objective-C çš„å¯¹è±¡ã€‚</p>
<p>æ“ä½œé˜Ÿåˆ—åœ¨åº•å±‚æ˜¯ç”¨ GCD æ¥å®ç°çš„ã€‚</p>
<h2>è¿›ç¨‹ã€çº¿ç¨‹ã€é˜Ÿåˆ—ã€ä¸²è¡Œã€å¹¶å‘ã€åŒæ­¥ã€å¼‚æ­¥ã€å‚»å‚»åˆ†ä¸æ¸…æ¥š</h2>
<h3>Thread çº¿ç¨‹</h3>
<p><a href="http://zh.wikipedia.org/wiki/%E7%BA%BF%E7%A8%8B" target="_blank" rel="noopener">çº¿ç¨‹</a>ï¼ˆthreadï¼‰æ˜¯ç»„æˆè¿›ç¨‹çš„å­å•å…ƒï¼Œæ“ä½œç³»ç»Ÿçš„è°ƒåº¦å™¨å¯ä»¥å¯¹çº¿ç¨‹è¿›è¡Œå•ç‹¬çš„è°ƒåº¦ã€‚å®é™…ä¸Šï¼Œæ‰€æœ‰çš„å¹¶å‘ç¼–ç¨‹ API éƒ½æ˜¯æ„å»ºäºçº¿ç¨‹ä¹‹ä¸Šçš„ â€”â€” åŒ…æ‹¬ GCD å’Œæ“ä½œé˜Ÿåˆ—ï¼ˆoperation queuesï¼‰ã€‚</p>
<p>å¤šçº¿ç¨‹å¯ä»¥åœ¨å•æ ¸ CPU ä¸ŠåŒæ—¶ï¼ˆæˆ–è€…è‡³å°‘çœ‹ä½œåŒæ—¶ï¼‰è¿è¡Œã€‚æ“ä½œç³»ç»Ÿå°†å°çš„æ—¶é—´ç‰‡åˆ†é…ç»™æ¯ä¸€ä¸ªçº¿ç¨‹ï¼Œè¿™æ ·å°±èƒ½å¤Ÿè®©ç”¨æˆ·æ„Ÿè§‰åˆ°æœ‰å¤šä¸ªä»»åŠ¡åœ¨åŒæ—¶è¿›è¡Œã€‚å¦‚æœ CPU æ˜¯å¤šæ ¸çš„ï¼Œé‚£ä¹ˆçº¿ç¨‹å°±å¯ä»¥çœŸæ­£çš„ä»¥å¹¶å‘æ–¹å¼è¢«æ‰§è¡Œï¼Œä»è€Œå‡å°‘äº†å®ŒæˆæŸé¡¹æ“ä½œæ‰€éœ€è¦çš„æ€»æ—¶é—´ã€‚</p>
<h3>Synchronous vs. Asynchronous åŒæ­¥ vs. å¼‚æ­¥</h3>
<p>æè¿°ä¸€ä¸ªå‡½æ•°/æ–¹æ³•ä¸ä¸€ä¸ªä»»åŠ¡ä¹‹é—´çš„å…³ç³»ï¼Œè¯¥å‡½æ•°è¦æ±‚ä¸€ä¸ªä»»åŠ¡åœ¨GCDä¸‹æ‰§è¡Œã€‚</p>
<p>åŒæ­¥å‡½æ•°ï¼šæ–¹æ³•ä¼šåœ¨æŒ‡å®šçš„ä»»åŠ¡å®Œæˆä¹‹åæ‰è¿”å›ã€‚</p>
<p>å¼‚æ­¥å‡½æ•°ï¼šæ–¹æ³•ä¼šç«‹å³è¿”å›ï¼Œé¢„å®šçš„ä»»åŠ¡ä¼šå®Œæˆä½†ä¸ä¼šç­‰å¾…å®ƒå®Œæˆã€‚å› æ­¤ï¼Œä¸€ä¸ªå¼‚æ­¥å‡½æ•°ä¸ä¼šé˜»å¡å½“å‰çº¿ç¨‹å»æ‰§è¡Œä¸‹ä¸€ä¸ªå‡½æ•°ã€‚</p>
<p>åŒºåˆ«ï¼šæ–¹æ³•æ˜¯å¦ç«‹å³è¿”å›ã€‚</p>
<h3>Critical Section ä¸´ç•ŒåŒº</h3>
<p>å°±æ˜¯ä¸€æ®µä»£ç ä¸èƒ½è¢«å¹¶å‘æ‰§è¡Œï¼Œä¹Ÿå°±æ˜¯ï¼Œä¸¤ä¸ªçº¿ç¨‹ä¸èƒ½åŒæ—¶æ‰§è¡Œè¿™æ®µä»£ç ã€‚è¿™å¾ˆå¸¸è§ï¼Œå› ä¸ºä»£ç å»æ“ä½œä¸€ä¸ªå…±äº«èµ„æºï¼Œä¾‹å¦‚ä¸€ä¸ªå˜é‡è‹¥èƒ½è¢«å¹¶å‘è¿›ç¨‹è®¿é—®ï¼Œé‚£ä¹ˆå®ƒå¾ˆå¯èƒ½ä¼šå˜è´¨ï¼ˆè¯‘è€…æ³¨ï¼šå®ƒçš„å€¼å¯èƒ½è¢«åŠ¨æ€æ›´æ”¹äº†ä½†æ˜¯è¿˜æ²¡æœ‰è¿”å›ï¼‰</p>
<h3>Race Condition ç«æ€æ¡ä»¶</h3>
<p>è¿™ç§çŠ¶å†µæ˜¯æŒ‡åŸºäºç‰¹å®šåºåˆ—æˆ–æ—¶æœºçš„äº‹ä»¶çš„è½¯ä»¶ç³»ç»Ÿä»¥ä¸å—æ§åˆ¶çš„æ–¹å¼è¿è¡Œçš„è¡Œä¸ºï¼Œä¾‹å¦‚ç¨‹åºçš„å¹¶å‘ä»»åŠ¡æ‰§è¡Œçš„ç¡®åˆ‡é¡ºåºã€‚ç«æ€æ¡ä»¶å¯å¯¼è‡´æ— æ³•é¢„æµ‹çš„è¡Œä¸ºï¼Œè€Œä¸èƒ½é€šè¿‡ä»£ç æ£€æŸ¥ç«‹å³å‘ç°ã€‚</p>
<p>å…³äºç«æ€æ¡ä»¶æ›´å¥½çš„è¯ é‡Šå¯ä»¥å‚è€ƒ <a href="https://www.objccn.io/issue-2-1/" target="_blank" rel="noopener">objc.io</a> çš„ä¾‹å­ï¼š</p>
<p><img src="https://blog-andy0570-1256077835.cos.ap-shanghai.myqcloud.com/site_Images/073259-1.png" alt="ç«æ€æ¡ä»¶"></p>
<h3>Deadlock æ­»é”</h3>
<p>ä¸¤ä¸ªï¼ˆæˆ–æ›´å¤šï¼‰ä¸œè¥¿â€”â€”åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œæ˜¯çº¿ç¨‹â€”â€”æ‰€è°“çš„æ­»é”æ˜¯æŒ‡å®ƒä»¬éƒ½å¡ä½äº†ï¼Œå¹¶ç­‰å¾…å¯¹æ–¹å®Œæˆæˆ–æ‰§è¡Œå…¶å®ƒæ“ä½œã€‚ç¬¬ä¸€ä¸ªä¸èƒ½å®Œæˆæ˜¯å› ä¸ºå®ƒåœ¨ç­‰å¾…ç¬¬äºŒä¸ªçš„å®Œæˆã€‚ä½†ç¬¬äºŒä¸ªä¹Ÿä¸èƒ½å®Œæˆï¼Œå› ä¸ºå®ƒåœ¨ç­‰å¾…ç¬¬ä¸€ä¸ªçš„å®Œæˆã€‚ã€ä¸å†…å­˜ç®¡ç†çš„å¾ªç¯å¼•ç”¨é—®é¢˜ç±»ä¼¼ã€‘</p>
<h3>äº’æ–¥é”</h3>
<p><a href="http://en.wikipedia.org/wiki/Mutex" target="_blank" rel="noopener">äº’æ–¥</a>è®¿é—®çš„æ„æ€å°±æ˜¯åŒä¸€æ—¶åˆ»ï¼Œåªå…è®¸ä¸€ä¸ªçº¿ç¨‹è®¿é—®æŸä¸ªç‰¹å®šèµ„æºã€‚ä¸ºäº†ä¿è¯è¿™ä¸€ç‚¹ï¼Œæ¯ä¸ªå¸Œæœ›è®¿é—®å…±äº«èµ„æºçš„çº¿ç¨‹ï¼Œé¦–å…ˆéœ€è¦è·å¾—ä¸€ä¸ªå…±äº«èµ„æºçš„<a href="http://en.wikipedia.org/wiki/Lock_%28computer_science%29" target="_blank" rel="noopener">äº’æ–¥é”</a>ï¼Œä¸€æ—¦æŸä¸ªçº¿ç¨‹å¯¹èµ„æºå®Œæˆäº†æ“ä½œï¼Œå°±é‡Šæ”¾æ‰è¿™ä¸ªäº’æ–¥é”ï¼Œè¿™æ ·åˆ«çš„çº¿ç¨‹å°±æœ‰æœºä¼šè®¿é—®è¯¥å…±äº«èµ„æºäº†ã€‚</p>
<p><img src="https://blog-andy0570-1256077835.cos.ap-shanghai.myqcloud.com/site_Images/073303.png" alt="äº’æ–¥é”"></p>
<h3>ä¼˜å…ˆçº§åè½¬</h3>
<p>ä¼˜å…ˆçº§åè½¬æ˜¯æŒ‡ç¨‹åºåœ¨è¿è¡Œæ—¶ä½ä¼˜å…ˆçº§çš„ä»»åŠ¡é˜»å¡äº†é«˜ä¼˜å…ˆçº§çš„ä»»åŠ¡ï¼Œæœ‰æ•ˆçš„åè½¬äº†ä»»åŠ¡çš„ä¼˜å…ˆçº§ã€‚ç”±äº GCD æä¾›äº†æ‹¥æœ‰ä¸åŒä¼˜å…ˆçº§çš„åå°é˜Ÿåˆ—ï¼Œç”šè‡³åŒ…æ‹¬ä¸€ä¸ª I/O é˜Ÿåˆ—ï¼Œæ‰€ä»¥æˆ‘ä»¬æœ€å¥½äº†è§£ä¸€ä¸‹ä¼˜å…ˆçº§åè½¬çš„å¯èƒ½æ€§ã€‚</p>
<p>é«˜ä¼˜å…ˆçº§å’Œä½ä¼˜å…ˆçº§çš„ä»»åŠ¡ä¹‹é—´å…±äº«èµ„æºæ—¶ï¼Œå°±å¯èƒ½å‘ç”Ÿä¼˜å…ˆçº§åè½¬ã€‚å½“ä½ä¼˜å…ˆçº§çš„ä»»åŠ¡è·å¾—äº†å…±äº«èµ„æºçš„é”æ—¶ï¼Œè¯¥ä»»åŠ¡åº”è¯¥è¿…é€Ÿå®Œæˆï¼Œå¹¶é‡Šæ”¾æ‰é”ï¼Œè¿™æ ·é«˜ä¼˜å…ˆçº§çš„ä»»åŠ¡å°±å¯ä»¥åœ¨æ²¡æœ‰æ˜æ˜¾å»¶æ—¶çš„æƒ…å†µä¸‹ç»§ç»­æ‰§è¡Œã€‚ç„¶è€Œé«˜ä¼˜å…ˆçº§ä»»åŠ¡ä¼šåœ¨ä½ä¼˜å…ˆçº§çš„ä»»åŠ¡æŒæœ‰é”çš„æœŸé—´è¢«é˜»å¡ã€‚å¦‚æœè¿™æ—¶å€™æœ‰ä¸€ä¸ªä¸­ä¼˜å…ˆçº§çš„ä»»åŠ¡(è¯¥ä»»åŠ¡ä¸éœ€è¦é‚£ä¸ªå…±äº«èµ„æº)ï¼Œé‚£ä¹ˆå®ƒå°±æœ‰å¯èƒ½ä¼šæŠ¢å ä½ä¼˜å…ˆçº§ä»»åŠ¡è€Œè¢«æ‰§è¡Œï¼Œå› ä¸ºæ­¤æ—¶é«˜ä¼˜å…ˆçº§ä»»åŠ¡æ˜¯è¢«é˜»å¡çš„ï¼Œæ‰€ä»¥ä¸­ä¼˜å…ˆçº§ä»»åŠ¡æ˜¯ç›®å‰æ‰€æœ‰å¯è¿è¡Œä»»åŠ¡ä¸­ä¼˜å…ˆçº§æœ€é«˜çš„ã€‚æ­¤æ—¶ï¼Œä¸­ä¼˜å…ˆçº§ä»»åŠ¡å°±ä¼šé˜»å¡ç€ä½ä¼˜å…ˆçº§ä»»åŠ¡ï¼Œå¯¼è‡´ä½ä¼˜å…ˆçº§ä»»åŠ¡ä¸èƒ½é‡Šæ”¾æ‰é”ï¼Œè¿™ä¹Ÿå°±ä¼šå¼•èµ·é«˜ä¼˜å…ˆçº§ä»»åŠ¡ä¸€ç›´åœ¨ç­‰å¾…é”çš„é‡Šæ”¾ã€‚</p>
<p><img src="https://blog-andy0570-1256077835.cos.ap-shanghai.myqcloud.com/site_Images/073305.png" alt="ä¼˜å…ˆçº§åè½¬"></p>
<p>è§£å†³è¿™ä¸ªé—®é¢˜çš„æ–¹æ³•ï¼Œé€šå¸¸å°±æ˜¯ä¸è¦ä½¿ç”¨ä¸åŒçš„ä¼˜å…ˆçº§ã€‚é€šå¸¸æœ€åä½ éƒ½ä¼šä»¥è®©é«˜ä¼˜å…ˆçº§çš„ä»£ç ç­‰å¾…ä½ä¼˜å…ˆçº§çš„ä»£ç æ¥è§£å†³é—®é¢˜ã€‚<strong>å½“ä½ ä½¿ç”¨ GCD æ—¶ï¼Œæ€»æ˜¯ä½¿ç”¨é»˜è®¤çš„ä¼˜å…ˆçº§é˜Ÿåˆ—</strong>ï¼ˆç›´æ¥ä½¿ç”¨ï¼Œæˆ–è€…ä½œä¸ºç›®æ ‡é˜Ÿåˆ—ï¼‰ã€‚å¦‚æœä½ ä½¿ç”¨ä¸åŒçš„ä¼˜å…ˆçº§ï¼Œå¾ˆå¯èƒ½å®é™…æƒ…å†µä¼šè®©äº‹æƒ…å˜å¾—æ›´ç³Ÿç³•ã€‚</p>
<p>ä»ä¸­å¾—åˆ°çš„æ•™è®­æ˜¯ï¼Œä½¿ç”¨ä¸åŒä¼˜å…ˆçº§çš„å¤šä¸ªé˜Ÿåˆ—å¬èµ·æ¥è™½ç„¶ä¸é”™ï¼Œä½†æ¯•ç«Ÿæ˜¯çº¸ä¸Šè°ˆå…µã€‚å®ƒå°†è®©æœ¬æ¥å°±å¤æ‚çš„å¹¶è¡Œç¼–ç¨‹å˜å¾—æ›´åŠ å¤æ‚å’Œä¸å¯é¢„è§ã€‚å¦‚æœä½ åœ¨ç¼–ç¨‹ä¸­ï¼Œé‡åˆ°é«˜ä¼˜å…ˆçº§çš„ä»»åŠ¡çªç„¶æ²¡ç†ç”±åœ°å¡ä½äº†ï¼Œå¯èƒ½ä½ ä¼šæƒ³èµ·æœ¬æ–‡ï¼Œä»¥åŠé‚£ä¸ªç¾å›½å®‡èˆªå±€çš„å·¥ç¨‹å¸ˆä¹Ÿé‡åˆ°è¿‡çš„è¢«ç§°ä¸ºä¼˜å…ˆçº§åè½¬çš„é—®é¢˜ã€‚</p>
<h3>Thread Safe çº¿ç¨‹å®‰å…¨</h3>
<p>çº¿ç¨‹å®‰å…¨çš„ä»£ç èƒ½åœ¨å¤šçº¿ç¨‹æˆ–å¹¶å‘ä»»åŠ¡ä¸­è¢«å®‰å…¨åœ°è°ƒç”¨ï¼Œè€Œä¸ä¼šå¯¼è‡´ä»»ä½•é—®é¢˜ï¼ˆæ•°æ®æŸåï¼Œå´©æºƒç­‰ï¼‰ã€‚çº¿ç¨‹ä¸å®‰å…¨çš„ä»£ç åœ¨æŸä¸ªæ—¶åˆ»åªèƒ½åœ¨ä¸€ä¸ªä¸Šä¸‹æ–‡ä¸­è¿è¡Œã€‚ä¸€ä¸ªçº¿ç¨‹å®‰å…¨ä»£ç çš„ä¾‹å­æ˜¯ <code>NSDictionary</code> ã€‚ä½ å¯ä»¥åœ¨åŒä¸€æ—¶é—´åœ¨å¤šä¸ªçº¿ç¨‹ä¸­ä½¿ç”¨å®ƒè€Œä¸ä¼šæœ‰é—®é¢˜ã€‚ç›¸åï¼Œ<code>NSMutableDictionary</code> å°±ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œåº”è¯¥ä¿è¯ä¸€æ¬¡åªèƒ½æœ‰ä¸€ä¸ªçº¿ç¨‹è®¿é—®å®ƒã€‚</p>
<h3>Context Switch ä¸Šä¸‹æ–‡åˆ‡æ¢</h3>
<p>ä¸€ä¸ªä¸Šä¸‹æ–‡åˆ‡æ¢ï¼šåœ¨å•ä¸ªè¿›ç¨‹é‡Œåˆ‡æ¢æ‰§è¡Œä¸åŒçš„çº¿ç¨‹æ—¶å­˜å‚¨ä¸æ¢å¤æ‰§è¡ŒçŠ¶æ€çš„è¿‡ç¨‹ã€‚è¿™ä¸ªè¿‡ç¨‹åœ¨ç¼–å†™å¤šä»»åŠ¡åº”ç”¨æ—¶å¾ˆæ™®éï¼Œä½†ä¼šå¸¦æ¥ä¸€äº›é¢å¤–çš„å¼€é”€ã€‚</p>
<h3>Concurrency vs Parallelism å¹¶å‘ä¸å¹¶è¡Œ</h3>
<p>å¹¶å‘ä»£ç çš„ä¸åŒéƒ¨åˆ†å¯ä»¥â€œåŒæ­¥â€æ‰§è¡Œã€‚ç„¶è€Œï¼Œè¯¥æ€æ ·å‘ç”Ÿæˆ–æ˜¯å¦å‘ç”Ÿéƒ½å–å†³äºç³»ç»Ÿã€‚å¤šæ ¸è®¾å¤‡é€šè¿‡å¹¶è¡Œæ¥åŒæ—¶æ‰§è¡Œå¤šä¸ªçº¿ç¨‹ï¼›ç„¶è€Œï¼Œä¸ºäº†ä½¿å•æ ¸è®¾å¤‡ä¹Ÿèƒ½å®ç°è¿™ä¸€ç‚¹ï¼Œå®ƒä»¬å¿…é¡»å…ˆè¿è¡Œä¸€ä¸ªçº¿ç¨‹ï¼Œæ‰§è¡Œä¸€ä¸ªä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œç„¶åè¿è¡Œå¦ä¸€ä¸ªçº¿ç¨‹æˆ–è¿›ç¨‹ã€‚è¿™é€šå¸¸å‘ç”Ÿåœ°è¶³å¤Ÿå¿«ä»¥è‡´ç»™æˆ‘ä»¬å¹¶å‘æ‰§è¡Œåœ°é”™è§‰ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="https://blog-andy0570-1256077835.cos.ap-shanghai.myqcloud.com/site_Images/073306.png" alt></p>
<p>è™½ç„¶ä½ å¯ä»¥ç¼–å†™ä»£ç åœ¨ GCD ä¸‹å¹¶å‘æ‰§è¡Œï¼Œä½† GCD ä¼šå†³å®šæœ‰å¤šå°‘å¹¶è¡Œçš„éœ€æ±‚ã€‚<strong>å¹¶è¡Œè¦æ±‚å¹¶å‘ï¼Œä½†å¹¶å‘ä¸èƒ½ä¿è¯å¹¶è¡Œ</strong>ã€‚</p>
<h3>Queues é˜Ÿåˆ—</h3>
<p>GCD æä¾› <code>dispatch queues</code> æ¥å¤„ç†ä»£ç å—ï¼Œè¿™äº›é˜Ÿåˆ—ç®¡ç†ä½ æä¾›ç»™ GCD çš„ä»»åŠ¡å¹¶ç”¨ FIFO é¡ºåºæ‰§è¡Œè¿™äº›ä»»åŠ¡ã€‚è¿™å°±ä¿è¯äº†ç¬¬ä¸€ä¸ªè¢«æ·»åŠ åˆ°é˜Ÿåˆ—é‡Œçš„ä»»åŠ¡ä¼šæ˜¯é˜Ÿåˆ—ä¸­ç¬¬ä¸€ä¸ªå¼€å§‹çš„ä»»åŠ¡ï¼Œè€Œç¬¬äºŒä¸ªè¢«æ·»åŠ çš„ä»»åŠ¡å°†ç¬¬äºŒä¸ªå¼€å§‹ï¼Œå¦‚æ­¤ç›´åˆ°é˜Ÿåˆ—ç»“æŸã€‚</p>
<p>æ‰€æœ‰çš„è°ƒåº¦é˜Ÿåˆ—ï¼ˆdispatch queuesï¼‰è‡ªèº«éƒ½æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œä½ èƒ½ä»å¤šä¸ªçº¿ç¨‹å¹¶è¡Œçš„è®¿é—®å®ƒä»¬ã€‚å½“ä½ äº†è§£äº†è°ƒåº¦é˜Ÿåˆ—å¦‚ä½•ä¸ºä½ è‡ªå·±ä»£ç çš„ä¸åŒéƒ¨åˆ†æä¾›çº¿ç¨‹å®‰å…¨åï¼ŒGCDçš„ä¼˜ç‚¹å°±ä¼šæ˜¾è€Œæ˜“è§ã€‚å…³äºè¿™ä¸€ç‚¹çš„å…³é”®æ˜¯ï¼š<strong>é€‰æ‹©æ­£ç¡®ç±»å‹çš„è°ƒåº¦é˜Ÿåˆ—å’Œæ­£ç¡®çš„è°ƒåº¦å‡½æ•°æ¥æäº¤ä½ çš„å·¥ä½œ</strong>ã€‚</p>
<h4>Serial vs. Concurrent ä¸²è¡Œ vs. å¹¶å‘</h4>
<p>æè¿°å½“å‰ä»»åŠ¡ä¸å…¶å®ƒè¢«æ‰§è¡Œä»»åŠ¡ä¹‹é—´çš„å…³ç³»</p>
<p>ä¸²è¡Œé˜Ÿåˆ—ï¼šæ¯æ¬¡åªæœ‰ä¸€ä¸ªä»»åŠ¡è¢«æ‰§è¡Œï¼›</p>
<p>å¹¶å‘é˜Ÿåˆ—ï¼šåŒä¸€æ—¶é—´å¯ä»¥æœ‰å¤šä¸ªä»»åŠ¡è¢«æ‰§è¡Œã€‚</p>
<h4>Serial Queues ä¸²è¡Œé˜Ÿåˆ—</h4>
<p>ä¸²è¡Œé˜Ÿåˆ—ä¸­çš„ä»»åŠ¡ä¸€æ¬¡æ‰§è¡Œä¸€ä¸ªï¼Œæ¯ä¸ªä»»åŠ¡åªæœ‰åœ¨å‰ä¸€ä¸ªä»»åŠ¡å®Œæˆåæ‰ä¼šå¼€å§‹ã€‚è€Œä¸”ï¼Œä½ ä¸èƒ½ç¡®å®š Block ä»»åŠ¡æ‰§è¡Œçš„æ—¶é—´é•¿åº¦ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="https://blog-andy0570-1256077835.cos.ap-shanghai.myqcloud.com/site_Images/073308.png" alt></p>
<p>è¿™äº›ä»»åŠ¡çš„æ‰§è¡Œæ—¶æœºå—åˆ° GCD çš„æ§åˆ¶ï¼›å”¯ä¸€èƒ½ç¡®ä¿çš„äº‹æƒ…æ˜¯ï¼š <strong>GCD ä¸€æ¬¡åªæ‰§è¡Œä¸€ä¸ªä»»åŠ¡ï¼Œå¹¶ä¸”æŒ‰ç…§æˆ‘ä»¬æ·»åŠ åˆ°é˜Ÿåˆ—ä¸­çš„é¡ºåºæ¥æ‰§è¡Œã€‚</strong></p>
<p>ç”±äºåœ¨ä¸²è¡Œé˜Ÿåˆ—ä¸­ä¸ä¼šæœ‰ä¸¤ä¸ªä»»åŠ¡å¹¶å‘æ‰§è¡Œï¼Œå› æ­¤ä¸ä¼šå‡ºç°åŒæ—¶è®¿é—®ä¸´ç•ŒåŒºçš„é£é™©ï¼›ç›¸å¯¹äºè¿™äº›ä»»åŠ¡æ¥è¯´ï¼Œè¿™å°±ä»ç«æ€æ¡ä»¶ä¸‹ä¿æŠ¤äº†ä¸´ç•ŒåŒºã€‚æ‰€ä»¥å¦‚æœè®¿é—®ä¸´ç•ŒåŒºçš„å”¯ä¸€æ–¹å¼æ˜¯é€šè¿‡æäº¤åˆ°è°ƒåº¦é˜Ÿåˆ—çš„ä»»åŠ¡ï¼Œé‚£ä¹ˆä½ å°±ä¸éœ€è¦æ‹…å¿ƒä¸´ç•ŒåŒºçš„å®‰å…¨é—®é¢˜äº†ã€‚</p>
<h4>Concurrent Queues å¹¶å‘é˜Ÿåˆ—</h4>
<p>å¹¶å‘é˜Ÿåˆ—ä¸­çš„ä»»åŠ¡èƒ½å¾—åˆ°çš„ä¿è¯æ˜¯ï¼š<strong>å®ƒä»¬ä¼šæŒ‰ç…§è¢«æ·»åŠ çš„é¡ºåºå¼€å§‹æ‰§è¡Œ</strong>ï¼Œä½†è¿™å°±æ˜¯å…¨éƒ¨çš„ä¿è¯äº†ã€‚ä»»åŠ¡å¯èƒ½ä»¥ä»»æ„é¡ºåºå®Œæˆï¼Œä½ ä¸çŸ¥é“ä½•æ—¶å¼€å§‹æ‰§è¡Œä¸‹ä¸€ä¸ªä»»åŠ¡ï¼Œæˆ–è€…ä½•æ—¶æœ‰å¤šå°‘ Block ä»»åŠ¡åœ¨æ‰§è¡Œã€‚å†è¯´ä¸€éï¼Œè¿™å®Œå…¨å–å†³äº GCD ã€‚</p>
<p>ä¸‹å›¾å±•ç¤ºäº†ä¸€ä¸ªç¤ºä¾‹ä»»åŠ¡æ‰§è¡Œè®¡åˆ’ï¼ŒGCD ç®¡ç†ç€å››ä¸ªå¹¶å‘ä»»åŠ¡ï¼š</p>
<p><img src="https://blog-andy0570-1256077835.cos.ap-shanghai.myqcloud.com/site_Images/073308-1.png" alt></p>
<p>æ³¨æ„ Block 1ã€2 å’Œ 3 éƒ½æ˜¯ç«‹å³æ‰§è¡Œçš„ï¼Œä¸€ä¸ªæ¥ä¸€ä¸ªã€‚åœ¨ Block 0 å¼€å§‹åï¼ŒBlock 1ç­‰å¾…äº†å¥½ä¸€ä¼šå„¿æ‰å¼€å§‹ã€‚åŒæ ·ï¼Œ Block 3 åœ¨ Block 2 ä¹‹åæ‰å¼€å§‹ï¼Œä½†å®ƒå…ˆäº Block 2 å®Œæˆã€‚</p>
<p>ä½•æ—¶å¼€å§‹ä¸€ä¸ª Block å®Œå…¨å–å†³äº GCD ã€‚å¦‚æœä¸€ä¸ª Block çš„æ‰§è¡Œæ—¶é—´ä¸å¦ä¸€ä¸ªé‡å ï¼Œä¹Ÿæ˜¯ç”± GCD æ¥å†³å®šæ˜¯å¦å°†å…¶è¿è¡Œåœ¨å¦ä¸€ä¸ªä¸åŒçš„æ ¸å¿ƒä¸Šï¼Œå¦‚æœé‚£ä¸ªæ ¸å¿ƒå¯ç”¨ï¼Œå°±ç”¨ä¸Šä¸‹æ–‡åˆ‡æ¢çš„æ–¹å¼æ¥æ‰§è¡Œä¸åŒçš„ Block ã€‚</p>
<p>æœ‰è¶£çš„æ˜¯ï¼Œ GCD ç»™ä½ æä¾›äº†è‡³å°‘äº”ä¸ªç‰¹å®šçš„é˜Ÿåˆ—ï¼Œå¯æ ¹æ®é˜Ÿåˆ—ç±»å‹é€‰æ‹©ä½¿ç”¨ã€‚</p>
<h4>Queue Types é˜Ÿåˆ—ç±»å‹</h4>
<p>é¦–å…ˆï¼Œç³»ç»Ÿç»™ä½ æä¾›äº†ä¸€ä¸ªå«åš <code>ä¸»é˜Ÿåˆ—ï¼ˆmain queueï¼‰</code> çš„ç‰¹æ®Šé˜Ÿåˆ—ã€‚å’Œå…¶å®ƒä¸²è¡Œé˜Ÿåˆ—ä¸€æ ·ï¼Œè¯¥é˜Ÿåˆ—ä¸­çš„ä»»åŠ¡ä¸€æ¬¡åªèƒ½æ‰§è¡Œä¸€ä¸ªã€‚ç„¶è€Œï¼Œå®ƒèƒ½ä¿è¯æ‰€æœ‰çš„ä»»åŠ¡éƒ½åœ¨ä¸»çº¿ç¨‹æ‰§è¡Œï¼Œè€Œ**ä¸»çº¿ç¨‹æ˜¯å”¯ä¸€å¯ç”¨äºæ›´æ–° UI çš„çº¿ç¨‹ã€‚**è¿™ä¸ªé˜Ÿåˆ—ç”¨äºå‘é€æ¶ˆæ¯æˆ–é€šçŸ¥ç»™ <code>UIView</code> ã€å“åº”ç”¨æˆ·äº¤äº’ã€‚</p>
<p>åŒæ—¶ï¼Œç³»ç»Ÿç»™ä½ æä¾›äº†å‡ ä¸ªå¹¶å‘é˜Ÿåˆ—ã€‚å®ƒä»¬å«åš <code>å…¨å±€è°ƒåº¦é˜Ÿåˆ—ï¼ˆGlobal Dispatch Queuesï¼‰</code> ã€‚ç›®å‰çš„å››ä¸ªå…¨å±€é˜Ÿåˆ—æœ‰ç€ä¸åŒçš„ä¼˜å…ˆçº§ï¼š<code>background</code>ã€<code>low</code>ã€<code>default</code> ä»¥åŠ <code>high</code>ã€‚è¦çŸ¥é“ï¼ŒApple çš„ API ä¹Ÿä¼šä½¿ç”¨è¿™äº›é˜Ÿåˆ—ï¼Œæ‰€ä»¥ä½ æ·»åŠ çš„ä»»ä½•ä»»åŠ¡éƒ½ä¸ä¼šæ˜¯è¿™äº›é˜Ÿåˆ—ä¸­å”¯ä¸€çš„ä»»åŠ¡ã€‚</p>
<p>æœ€åï¼Œä½ ä¹Ÿå¯ä»¥åˆ›å»ºè‡ªå·±çš„ä¸²è¡Œé˜Ÿåˆ—æˆ–å¹¶å‘é˜Ÿåˆ—ã€‚è¿™å°±æ˜¯è¯´ï¼Œè‡³å°‘æœ‰<strong>äº”ä¸ªé˜Ÿåˆ—</strong>ä»»ä½ å¤„ç½®ï¼šä¸»é˜Ÿåˆ—ã€å››ä¸ªå…¨å±€è°ƒåº¦é˜Ÿåˆ—ï¼Œå†åŠ ä¸Šä»»ä½•ä½ è‡ªå·±åˆ›å»ºçš„é˜Ÿåˆ—ã€‚</p>
<p>ä»¥ä¸Šæ˜¯è°ƒåº¦é˜Ÿåˆ—çš„å¤§æ¡†æ¶ï¼</p>
<p>GCD çš„â€œè‰ºæœ¯â€å½’ç»“ä¸º<strong>é€‰æ‹©åˆé€‚é˜Ÿåˆ—çš„è°ƒåº¦å‡½æ•°ä»¥æäº¤ä½ çš„å·¥ä½œ</strong>ã€‚</p>
<h2>GCD æ–¹æ³•</h2>
<p>GCD æ˜¯çº¯ C çš„ APIï¼Œå¦‚æœä½ ä½¿ç”¨ MBProgressHUD æ¡†æ¶ï¼Œä½ ä¼šçœ‹åˆ°ä½¿ç”¨ GCD çš„è¿™ä¸ªç¤ºä¾‹ï¼š</p>
<p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">// åœ¨æ ¹è§†å›¾ä¸Šæ˜¾ç¤º HUD</span><br><span class="line">MBProgressHUD *hud = [MBProgressHUD showHUDAddedTo:self.navigationController.view animated:YES];</span><br><span class="line"></span><br><span class="line">// å¼‚æ­¥åå°çº¿ç¨‹æ‰§è¡Œï¼Œä½¿UIKitæœ‰æœºä¼šé‡æ–°ç»˜åˆ¶ HUD å¹¶æ·»åŠ åˆ°è§†å›¾å±‚æ¬¡ç»“æ„ä¸­ã€‚</span><br><span class="line">dispatch_async(dispatch_get_global_queue(QOS_CLASS_USER_INITIATED, 0), ^&#123;</span><br><span class="line"></span><br><span class="line">    // Do something useful in the background</span><br><span class="line">    [self doSomeWork];</span><br><span class="line"></span><br><span class="line">    // ä¸»çº¿ç¨‹æ‰§è¡Œï¼Œè¯·ç¡®ä¿å§‹ç»ˆåœ¨ä¸»çº¿ç¨‹ä¸Šæ›´æ–°UIï¼ˆåŒ…æ‹¬MBProgressHUDï¼‰ã€‚</span><br><span class="line">    dispatch_async(dispatch_get_main_queue(), ^&#123;</span><br><span class="line">        [hud hideAnimated:YES];</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p>
<h3>å…¨å±€é˜Ÿåˆ—ï¼Œ <code>dispatch_get_global_queue()</code></h3>
<p>å‡½æ•°ï¼š<code>dispatch_get_global_queue(long identifier, unsigned long flags)</code></p>
<ol>
<li>
<p>å‚æ•°ä¸€ï¼š<code>long identifier</code>ï¼šqos_class_t ä¸­å®šä¹‰çš„æœåŠ¡è´¨é‡æˆ–è€… dispatch_queue_priority_t ä¸­å®šä¹‰çš„é˜Ÿåˆ—ä¼˜å…ˆçº§ã€‚</p>
<ul>
<li>
<p><strong>dispatch_queue_priority_t</strong> ï¼šé˜Ÿåˆ—ä¼˜å…ˆçº§</p>
<p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">// æ´¾å‘åˆ°é˜Ÿåˆ—ä¸­çš„ä»»åŠ¡å°†ä»¥æœ€é«˜ä¼˜å…ˆçº§è¿è¡Œï¼Œæ­¤é˜Ÿåˆ—ä»»åŠ¡å°†ä¼šè¢«å®‰æ’åˆ°é»˜è®¤ä¼˜å…ˆçº§æˆ–è€…ä½ä¼˜å…ˆçº§çš„ä»»åŠ¡ä¹‹å‰è¿è¡Œã€‚</span><br><span class="line">#define DISPATCH_QUEUE_PRIORITY_HIGH 2</span><br><span class="line"></span><br><span class="line">// æ´¾å‘åˆ°é˜Ÿåˆ—ä¸­çš„ä»»åŠ¡å°†ä»¥é»˜è®¤ä¼˜å…ˆçº§è¿è¡Œï¼Œå³ï¼Œè¯¥ä»»åŠ¡å°†ä¼šåœ¨ã€æ‰€æœ‰é«˜ä¼˜å…ˆçº§ä»»åŠ¡å·²ç»è¢«è°ƒåº¦ä¹‹åï¼Œå¹¶ä¸”åœ¨æ‰€æœ‰ä½ä¼˜å…ˆçº§ä»»åŠ¡è¢«è°ƒåº¦ä¹‹å‰ã€‘è¢«è°ƒåº¦æ‰§è¡Œã€‚</span><br><span class="line">#define DISPATCH_QUEUE_PRIORITY_DEFAULT 0</span><br><span class="line"></span><br><span class="line">// æ´¾å‘åˆ°é˜Ÿåˆ—ä¸­çš„ä»»åŠ¡å°†ä»¥ä½ä¼˜å…ˆçº§è¿è¡Œï¼Œå³åœ¨æ‰€æœ‰é»˜è®¤ä¼˜å…ˆçº§å’Œé«˜ä¼˜å…ˆçº§ä»»åŠ¡å·²ç»è¢«æ‰§è¡Œä¹‹åï¼Œè¯¥é˜Ÿåˆ—ä¸­çš„ä»»åŠ¡å°†ä¼šè¢«è°ƒåº¦æ‰§è¡Œ</span><br><span class="line">#define DISPATCH_QUEUE_PRIORITY_LOW (-2)</span><br><span class="line"></span><br><span class="line">// æ´¾å‘åˆ°é˜Ÿåˆ—ä¸­çš„ä»»åŠ¡å°†ä»¥åå°ä¼˜å…ˆçº§è¿è¡Œï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨è°ƒåº¦äº†æ‰€æœ‰é«˜ä¼˜å…ˆçº§ä»»åŠ¡ä¹‹åï¼Œè¯¥é˜Ÿåˆ—ä¸­çš„ä»»åŠ¡å°†è¢«è°ƒåº¦æ‰§è¡Œï¼Œå¹¶ä¸”ç³»ç»Ÿå°†åœ¨å…·æœ‰æ ¹æ® setpriority çš„åå°çŠ¶æ€çš„çº¿ç¨‹ä¸Šè¿è¡Œè¯¥é˜Ÿåˆ—ä¸Šçš„ä»»åŠ¡ã€‚ï¼ˆç£ç›˜ I/O å—åˆ°é™åˆ¶ï¼Œçº¿ç¨‹çš„è°ƒåº¦ä¼˜å…ˆçº§è®¾ç½®ä¸ºæœ€ä½å€¼ï¼‰ã€‚</span><br><span class="line">#define DISPATCH_QUEUE_PRIORITY_BACKGROUND INT16_MIN</span><br></pre></td></tr></table></figure></p>
</li>
<li>
<p><strong>qos_class_t</strong>ï¼šæœåŠ¡è´¨é‡ï¼Œ<em>iOS 8.0 æ–°å¢</em></p>
<p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"> * Apple å»ºè®®æˆ‘ä»¬ä½¿ç”¨æœåŠ¡è´¨é‡ç±»åˆ«çš„å€¼æ¥æ ‡è®°å…¨å±€å¹¶å‘é˜Ÿåˆ—</span><br><span class="line"> *  - QOS_CLASS_USER_INTERACTIVE</span><br><span class="line"> *  - QOS_CLASS_USER_INITIATED</span><br><span class="line"> *  - QOS_CLASS_DEFAULT</span><br><span class="line"> *  - QOS_CLASS_UTILITY</span><br><span class="line"> *  - QOS_CLASS_BACKGROUND</span><br><span class="line"> *</span><br><span class="line"> * å…¨å±€å¹¶å‘é˜Ÿåˆ—ä»ç„¶å¯ä»¥é€šè¿‡ä¼˜å…ˆçº§æ¥è¯†åˆ«,å®ƒä¼šè¢«æ˜ å°„åˆ°ä»¥ä¸‹QOSç±»ï¼š</span><br><span class="line"> *  - DISPATCH_QUEUE_PRIORITY_HIGH:         QOS_CLASS_USER_INITIATED</span><br><span class="line"> *  - DISPATCH_QUEUE_PRIORITY_DEFAULT:      QOS_CLASS_DEFAULT</span><br><span class="line"> *  - DISPATCH_QUEUE_PRIORITY_LOW:          QOS_CLASS_UTILITY</span><br><span class="line"> *  - DISPATCH_QUEUE_PRIORITY_BACKGROUND:   QOS_CLASS_BACKGROUND</span><br><span class="line">   </span><br><span class="line"> /*!</span><br><span class="line"> * @constant QOS_CLASS_USER_INTERACTIVE</span><br><span class="line"> * @abstract è¯¥çº¿ç¨‹æ‰§è¡Œçš„æ˜¯ä¸ç”¨æˆ·äº¤äº’çš„å·¥ä½œ</span><br><span class="line"> * @discussion ä¸ç³»ç»Ÿä¸Šè¿è¡Œçš„å…¶ä»–å·¥ä½œç›¸æ¯”ï¼Œè¯¥å·¥ä½œè¢«è¦æ±‚ä»¥æœ€é«˜ä¼˜å…ˆçº§è¿è¡Œã€‚æŒ‡å®šè¿™ä¸ª QOS ç±»ä¼šè¯·æ±‚å‡ ä¹æ‰€æœ‰å¯ç”¨çš„ç³»ç»Ÿ CPU å’Œ I/O å¸¦å®½è¿è¡Œï¼Œç”šè‡³ä¸æƒœäº‰ç”¨èµ„æºã€‚</span><br><span class="line"> * è¿™ä¸æ˜¯ä¸€ä¸ªé€‚ç”¨äºå¤§å‹ä»»åŠ¡çš„èŠ‚èƒ½ QOS ç±»ã€‚ è¿™ä¸ª QOS ç±»çš„ä½¿ç”¨åº”é™äºä¸ç”¨æˆ·çš„å…³é”®äº¤äº’ï¼Œä¾‹å¦‚å¤„ç†ä¸»äº‹ä»¶å¾ªç¯ä¸­çš„äº‹ä»¶ï¼Œç»˜å›¾ï¼ŒåŠ¨ç”»ç­‰ã€‚</span><br><span class="line"> *</span><br><span class="line"> * @constant QOS_CLASS_USER_INITIATED</span><br><span class="line"> * @abstract è¯¥çº¿ç¨‹æ‰§è¡Œçš„å·¥ä½œçš„ QOS ç±»æ˜¯ç”±ç”¨æˆ·å‘èµ·çš„å¹¶ä¸”ç”¨æˆ·å¯èƒ½æ­£åœ¨ç­‰å¾…ç»“æœã€‚</span><br><span class="line"> * @discussion è¿™ç§å·¥ä½œçš„ä¼˜å…ˆçº§ä½äºå…³é”®çš„ç”¨æˆ·äº¤äº’å·¥ä½œï¼Œä½†æ¯”ç³»ç»Ÿä¸Šçš„å…¶ä»–å·¥ä½œè¦é«˜ã€‚ </span><br><span class="line"> * è¿™ä¸æ˜¯ä¸€ä¸ªé€‚ç”¨äºå¤§å‹ä»»åŠ¡çš„èŠ‚èƒ½ QOS ç±»ã€‚å®ƒçš„ä½¿ç”¨åº”è¯¥é™åˆ¶åœ¨è¶³å¤ŸçŸ­çš„æ—¶é—´å†…ï¼Œä»¥è‡³äºç”¨æˆ·ä¸å¤ªå¯èƒ½åœ¨ç­‰å¾…ç»“æœçš„æ—¶å€™åˆ‡æ¢ä»»åŠ¡ã€‚ å…¸å‹çš„ç”¨æˆ·å‘èµ·çš„é€šè¿‡æ˜¾ç¤ºå ä½ç¬¦å†…å®¹æˆ–æ¨¡æ€ç”¨æˆ·ç•Œé¢æ¥æŒ‡ç¤ºè¿›åº¦çš„å·¥ä½œã€‚</span><br><span class="line"> *</span><br><span class="line"> * @constant QOS_CLASS_DEFAULT</span><br><span class="line"> * @abstract ç³»ç»Ÿåœ¨ç¼ºå°‘æ›´å…·ä½“çš„QOSåˆ†ç±»ä¿¡æ¯çš„æƒ…å†µä¸‹ä½¿ç”¨çš„é»˜è®¤QOSåˆ†ç±»ã€‚</span><br><span class="line"> * @discussion è¿™ç§å·¥ä½œä¼˜å…ˆçº§ä½äºå…³é”®çš„ç”¨æˆ·äº¤äº’å’Œç”¨æˆ·å‘èµ·çš„å·¥ä½œï¼Œä½†æ¯”å®ç”¨å·¥å…·å’Œåå°ä»»åŠ¡è¦é«˜ã€‚ ç”±pthread_createï¼ˆï¼‰åˆ›å»ºçš„æ²¡æœ‰æŒ‡å®šQOSç±»çš„å±æ€§çš„çº¿ç¨‹å°†é»˜è®¤ä¸ºQOS_CLASS_DEFAULTã€‚ è¿™ä¸ªQOSç±»çš„å€¼å¹¶ä¸æ‰“ç®—ä½œä¸ºå·¥ä½œåˆ†ç±»ï¼Œåªæœ‰åœ¨ä¼ æ’­æˆ–æ¢å¤ç³»ç»Ÿæä¾›çš„QOSç±»å€¼æ—¶æ‰åº”è®¾ç½®ã€‚</span><br><span class="line"> *</span><br><span class="line"> * @constant QOS_CLASS_UTILITY</span><br><span class="line"> * @abstract è¯¥çº¿ç¨‹æ‰§è¡Œçš„å·¥ä½œçš„QOSç±»æˆ–è®¸å¯èƒ½ç”±ç”¨æˆ·å‘èµ·ï¼Œå¹¶ä¸”ç”¨æˆ·å¹¶ä¸æœŸå¾…ç«‹å³ç­‰å¾…ç»“æœã€‚</span><br><span class="line"> * @discussion è¿™ç§å·¥ä½œçš„ä¼˜å…ˆçº§ä½äºå…³é”®ç”¨æˆ·äº¤äº’å’Œç”¨æˆ·å¯åŠ¨çš„å·¥ä½œï¼Œä½†æ¯”ä½çº§ç³»ç»Ÿç»´æŠ¤ä»»åŠ¡è¦é«˜ã€‚ ä½¿ç”¨è¿™ä¸ªQOSçº§åˆ«è¡¨æ˜å·¥ä½œåº”è¯¥ä»¥èŠ‚èƒ½å’Œé«˜æ•ˆç‡çš„æ–¹å¼è¿è¡Œã€‚ æ•ˆç”¨å·¥ä½œçš„è¿›å±•å¯èƒ½ä¼šä¹Ÿå¯èƒ½ä¸ä¼šè¢«æŒ‡ç¤ºç»™ç”¨æˆ·ï¼Œä½†è¿™ç§å·¥ä½œçš„æ•ˆæœæ˜¯ç”¨æˆ·å¯è§çš„ã€‚</span><br><span class="line"> *</span><br><span class="line"> * @constant QOS_CLASS_BACKGROUND</span><br><span class="line"> * @abstract è¯¥çº¿ç¨‹æ‰§è¡Œçš„å·¥ä½œçš„QOSç±»ä¸æ˜¯ç”±ç”¨æˆ·å‘èµ·çš„ï¼Œå¹¶ä¸”ç”¨æˆ·å¯èƒ½ä¸çŸ¥é“ç»“æœã€‚</span><br><span class="line"> * @discussion è¿™é¡¹å·¥ä½œçš„ä¼˜å…ˆçº§ä½äºå…¶ä»–å·¥ä½œã€‚ ä½¿ç”¨è¿™ä¸ªQOSçº§åˆ«è¡¨æ˜å·¥ä½œåº”è¯¥ä»¥æœ€èŠ‚èƒ½ï¼Œæœ€é«˜æ•ˆçš„æ–¹å¼è¿›è¡Œã€‚</span><br><span class="line"> *</span><br><span class="line"> * @constant QOS_CLASS_UNSPECIFIED</span><br><span class="line"> * @abstract æŒ‡ç¤ºQOSç±»ä¿¡æ¯çš„ç¼ºå¤±æˆ–ç§»é™¤çš„QOSç±»å€¼ã€‚</span><br><span class="line"> * @discussion ä½œä¸ºAPIè¿”å›å€¼ï¼Œå¯èƒ½è¡¨ç¤ºçº¿ç¨‹æˆ–pthreadå±æ€§æ˜¯ä½¿ç”¨ä¸æ—§ç‰ˆAPIä¸å…¼å®¹æˆ–ä¸QOSç±»ç³»ç»Ÿå†²çªçš„é…ç½®ã€‚</span><br><span class="line"> */</span><br><span class="line"></span><br><span class="line">__QOS_ENUM(qos_class, unsigned int,</span><br><span class="line">	QOS_CLASS_USER_INTERACTIVE</span><br><span class="line">			__QOS_CLASS_AVAILABLE(macos(10.10), ios(8.0)) = 0x21,</span><br><span class="line">	QOS_CLASS_USER_INITIATED</span><br><span class="line">			__QOS_CLASS_AVAILABLE(macos(10.10), ios(8.0)) = 0x19,</span><br><span class="line">	QOS_CLASS_DEFAULT</span><br><span class="line">			__QOS_CLASS_AVAILABLE(macos(10.10), ios(8.0)) = 0x15,</span><br><span class="line">	QOS_CLASS_UTILITY</span><br><span class="line">			__QOS_CLASS_AVAILABLE(macos(10.10), ios(8.0)) = 0x11,</span><br><span class="line">	QOS_CLASS_BACKGROUND</span><br><span class="line">			__QOS_CLASS_AVAILABLE(macos(10.10), ios(8.0)) = 0x09,</span><br><span class="line">	QOS_CLASS_UNSPECIFIED</span><br><span class="line">			__QOS_CLASS_AVAILABLE(macos(10.10), ios(8.0)) = 0x00,</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">#undef __QOS_ENUM</span><br></pre></td></tr></table></figure></p>
</li>
</ul>
</li>
</ol>
<ol start="2">
<li>
<p>å‚æ•°äºŒï¼š<code>unsigned long flags</code></p>
<p>Apple ä¿ç•™ä»¥ä¾›å°†æ¥ä½¿ç”¨çš„å€¼ã€‚ ä¼ é€’é™¤é›¶ä»¥å¤–çš„ä»»ä½•å€¼éƒ½å¯èƒ½å¯¼è‡´è¿”å›å€¼ä¸ºNULLã€‚å› æ­¤ï¼Œ<strong>è¿™ä¸ªå€¼æˆ‘ä»¬åŠ¡å¿…è®¾ç½®ä¸º0</strong>ã€‚</p>
</li>
</ol>
<p>ä½¿ç”¨ç¤ºä¾‹ï¼š</p>
<p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">// å¼‚æ­¥åå°é˜Ÿåˆ—</span><br><span class="line">dispatch_queue_t global_queue = dispatch_get_global_queue(0, 0);</span><br><span class="line"></span><br><span class="line">dispatch_async(dispatch_get_global_queue(0, 0), ^&#123;</span><br><span class="line">   // å¼‚æ­¥åå°ä»»åŠ¡...</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p>
<h3>å¼‚æ­¥é˜Ÿåˆ—ï¼Œ <code>dispatch_async</code></h3>
<p>ä¸‰ç§æ–¹å¼ï¼š</p>
<h4>å¼‚æ­¥è‡ªå®šä¹‰ä¸²è¡Œé˜Ÿåˆ—</h4>
<p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">dispatch_queue_t my_queue = dispatch_queue_create(&quot;com.companyName.projectName.taskName&quot;, NULL); // ä¼ å‚ NULL ä»£è¡¨è¿™æ˜¯ä¸€ä¸ªä¸²è¡Œé˜Ÿåˆ—ã€‚</span><br><span class="line">dispatch_async(my_queue, ^&#123;</span><br><span class="line">    // å¼‚æ­¥è‡ªå®šä¹‰ä»»åŠ¡</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p>
<p>å½“ä½ æƒ³ä¸²è¡Œæ‰§è¡Œåå°ä»»åŠ¡å¹¶è¿½è¸ªå®ƒæ—¶å°±æ˜¯ä¸€ä¸ªå¥½é€‰æ‹©ã€‚è¿™æ¶ˆé™¤äº†èµ„æºäº‰ç”¨ï¼Œå› ä¸ºä½ çŸ¥é“ä¸€æ¬¡åªæœ‰ä¸€ä¸ªä»»åŠ¡åœ¨æ‰§è¡Œã€‚æ³¨æ„è‹¥ä½ éœ€è¦è·å–æŸä¸ªæ–¹æ³•çš„æ•°æ®ï¼Œä½ å¿…é¡»å†…è”å¦ä¸€ä¸ª Block æ¥æ‰¾å›å®ƒæˆ–è€ƒè™‘ä½¿ç”¨ <code>dispatch_sync</code>ã€‚</p>
<h4>å¼‚æ­¥ä¸»é˜Ÿåˆ—</h4>
<p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">dispatch_async(dispatch_get_main_queue(), ^&#123;</span><br><span class="line">    // å¼‚æ­¥ä¸»çº¿ç¨‹ä»»åŠ¡</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p>
<p>è¿™æ˜¯åœ¨ä¸€ä¸ªå¹¶å‘é˜Ÿåˆ—ä¸Šå®Œæˆä»»åŠ¡åæ›´æ–° UI çš„å…±åŒé€‰æ‹©ã€‚è¦è¿™æ ·åšï¼Œä½ å°†åœ¨ä¸€ä¸ª Block å†…éƒ¨ç¼–å†™å¦ä¸€ä¸ª Block ã€‚ä»¥åŠï¼Œå¦‚æœä½ åœ¨ä¸»é˜Ÿåˆ—è°ƒç”¨ <code>dispatch_async</code> åˆ°ä¸»é˜Ÿåˆ—ï¼Œä½ èƒ½ç¡®ä¿è¿™ä¸ªæ–°ä»»åŠ¡å°†åœ¨å½“å‰æ–¹æ³•å®Œæˆåçš„æŸä¸ªæ—¶é—´æ‰§è¡Œã€‚</p>
<h4>å¼‚æ­¥å…¨å±€é˜Ÿåˆ—</h4>
<p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">dispatch_async(dispatch_get_global_queue(0, 0), ^&#123;</span><br><span class="line">    // å¼‚æ­¥å¹¶å‘ä»»åŠ¡</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p>
<p>è¿™æ˜¯åœ¨åå°æ‰§è¡Œé UI å·¥ä½œçš„å…±åŒé€‰æ‹©ã€‚</p>
<h3>å»¶åæ‰§è¡Œä»»åŠ¡ï¼Œdispatch_after</h3>
<p>å»¶è¿Ÿ n ç§’æ‰§è¡Œï¼Œä½¿ç”¨ snippet ä»£ç å—ï¼š==dispatch_after==</p>
<p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">double delayInSeconds = 2.0;</span><br><span class="line">dispatch_after(dispatch_time(DISPATCH_TIME_NOW, (int64_t)(delayInSeconds * NSEC_PER_SEC)), dispatch_get_main_queue(), ^&#123;</span><br><span class="line">    // code to be executed after a specified delay</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p>
<p><code>dispatch_after</code> å¯ä»¥ä½¿ä»»åŠ¡å»¶åæ‰§è¡Œï¼Œç¼ºç‚¹æ˜¯æ— æ³•å–æ¶ˆ block ä¸­å°†è¦æ‰§è¡Œçš„ä»£ç ã€‚å¦‚æœä½ éœ€è¦ä¸€äº›äº‹æƒ…åœ¨æŸä¸ªç‰¹å®šçš„æ—¶åˆ»è¿è¡Œï¼Œé‚£ä¹ˆ <code>dispatch_after</code> æˆ–è®¸ä¼šæ˜¯ä¸ªå¥½çš„é€‰æ‹©ã€‚ç¡®ä¿åŒæ—¶è€ƒè™‘äº† <code>NSTimer</code>ï¼Œè¿™ä¸ªAPIè™½ç„¶æœ‰ç‚¹ç¬¨é‡ï¼Œä½†æ˜¯å®ƒå…è®¸ä½ å–æ¶ˆå®šæ—¶å™¨çš„è§¦å‘ã€‚</p>
<p>ä¸çŸ¥é“ä½•æ—¶é€‚åˆä½¿ç”¨ <code>dispatch_after</code> ï¼Ÿ</p>
<ul>
<li>è‡ªå®šä¹‰ä¸²è¡Œé˜Ÿåˆ—ï¼šåœ¨ä¸€ä¸ªè‡ªå®šä¹‰ä¸²è¡Œé˜Ÿåˆ—ä¸Šä½¿ç”¨ <code>dispatch_after</code> è¦å°å¿ƒã€‚ä½ æœ€å¥½åšæŒä½¿ç”¨ä¸»é˜Ÿåˆ—ã€‚</li>
<li>âœ…ä¸»é˜Ÿåˆ—ï¼ˆä¸²è¡Œï¼‰ï¼šæ˜¯ä½¿ç”¨ <code>dispatch_after</code> çš„å¥½é€‰æ‹©ï¼›Xcode æä¾›äº†ä¸€ä¸ªä¸é”™çš„ snippet æ¨¡ç‰ˆï¼ˆ==dispatch_after==ï¼‰ã€‚</li>
<li>å¹¶å‘é˜Ÿåˆ—ï¼šåœ¨å¹¶å‘é˜Ÿåˆ—ä¸Šä½¿ç”¨ <code>dispatch_after</code> ä¹Ÿè¦å°å¿ƒï¼›ä½ ä¼šè¿™æ ·åšå°±æ¯”è¾ƒç½•è§ã€‚è¿˜æ˜¯åœ¨ä¸»é˜Ÿåˆ—åšè¿™äº›æ“ä½œå§ã€‚</li>
</ul>
<p>å› æ­¤ï¼Œ<strong>å¼ºçƒˆå»ºè®®åœ¨ä¸»é˜Ÿåˆ—ä¸Šæ‰§è¡Œå»¶åä»»åŠ¡</strong>ã€‚</p>
<h3>å•æ¬¡æ‰§è¡Œï¼Œdispatch_once</h3>
<p><code>dispatch_once()</code> ä»¥çº¿ç¨‹å®‰å…¨çš„æ–¹å¼æ‰§è¡Œä¸”ä»…æ‰§è¡Œå…¶ä»£ç å—ä¸€æ¬¡ã€‚è¯•å›¾è®¿é—®ä¸´ç•ŒåŒºï¼ˆå³ä¼ é€’ç»™ <code>dispatch_once</code> çš„ä»£ç ï¼‰çš„ä¸åŒçš„çº¿ç¨‹ä¼šåœ¨ä¸´ç•ŒåŒºå·²æœ‰ä¸€ä¸ªçº¿ç¨‹çš„æƒ…å†µä¸‹è¢«é˜»å¡ï¼Œç›´åˆ°ä¸´ç•ŒåŒºå®Œæˆä¸ºæ­¢ã€‚</p>
<p>ä½¿ç”¨ snippet ä»£ç å—åˆ›å»ºï¼š==dispatch_once==</p>
<p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">static dispatch_once_t onceToken;</span><br><span class="line">dispatch_once(&amp;onceToken, ^&#123;</span><br><span class="line">    // code to be executed once</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p>
<p>è¯¥æ–¹æ³•å¸¸ç”¨äº<strong>å•ä¾‹ç±»</strong>åˆå§‹åŒ–ï¼Œå¯ä»¥é˜²æ­¢ç«æ€æ¡ä»¶å‘ç”Ÿï¼š</p>
<p>âä¸æ¨èçš„å•ä¾‹åˆ›å»ºæ–¹æ³•ï¼š</p>
<p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">+ (instancetype)sharedManager</span><br><span class="line">&#123;</span><br><span class="line">    static PhotoManager *sharedPhotoManager = nil;</span><br><span class="line">    if (!sharedPhotoManager) &#123;</span><br><span class="line">        sharedPhotoManager = [[PhotoManager alloc] init];</span><br><span class="line">        sharedPhotoManager-&gt;_photosArray = [NSMutableArray array];</span><br><span class="line">    &#125;</span><br><span class="line">    return sharedPhotoManager;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>åŸå› åœ¨äºï¼Œ**if æ¡ä»¶åˆ†æ”¯ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚**å¦‚æœè°ƒç”¨è¿™ä¸ªå•ä¾‹æ–¹æ³•å¤šæ¬¡ï¼Œç³»ç»Ÿå¯èƒ½å¯¹åˆ›å»ºå¤šä¸ªå®ä¾‹å¯¹è±¡â€”â€”ç«æ€æ¡ä»¶ã€‚</p>
<p>âœ…æ¨èçš„æ–¹æ³•ï¼š</p>
<p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">+ (instancetype)sharedManager</span><br><span class="line">&#123;</span><br><span class="line">    static PhotoManager *sharedPhotoManager = nil;</span><br><span class="line">    static dispatch_once_t onceToken;</span><br><span class="line">    dispatch_once(&amp;onceToken, ^&#123;</span><br><span class="line">        sharedPhotoManager = [[PhotoManager alloc] init];</span><br><span class="line">        sharedPhotoManager-&gt;_photosArray = [NSMutableArray array];</span><br><span class="line">    &#125;);</span><br><span class="line">    return sharedPhotoManager;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>###æ …æ ï¼Œdispatch_barriers</p>
<blockquote>
<p>Noteï¼šè¿™äº›ç§°è°“æŒ‡çš„éƒ½æ˜¯ dispatch_barriers å‡½æ•°ï¼šæ …æ ã€éšœç¢ã€å±éšœ...</p>
</blockquote>
<h4>è¯»å†™é—®é¢˜</h4>
<p>ç…§ç‰‡ç®¡ç†ç±»å¯ä»¥å¯¹ç…§ç‰‡æ‰§è¡Œ<strong>å†™</strong>æ–¹æ³•ï¼š</p>
<p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">- (void)addPhoto:(Photo *)photo &#123;</span><br><span class="line">    if (photo) &#123;</span><br><span class="line">        [_photosArray addObject:photo];</span><br><span class="line">        dispatch_async(dispatch_get_main_queue(), ^&#123;</span><br><span class="line">            [self postContentAddedNotification];</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>ä¹Ÿå¯ä»¥æ‰§è¡Œ<strong>è¯»</strong>æ–¹æ³•ï¼š</p>
<p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">- (NSArray *)photos &#123;</span><br><span class="line">    return _photosArray;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>âš ï¸é—®é¢˜åœ¨äºï¼Œè¿™ä¸¤ä¸ªæ–¹æ³•ä¸èƒ½æä¾›ä»»ä½•ä¿æŠ¤æªæ–½æ¥å¯¹æŠ—å½“ä¸€ä¸ªçº¿ç¨‹è°ƒç”¨è¯»æ–¹æ³• <code>photos</code> çš„åŒæ—¶å¦ä¸€ä¸ªçº¿ç¨‹è°ƒç”¨å†™æ–¹æ³• <code>addPhoto:</code> ã€‚</p>
<p>GCD é€šè¿‡ç”¨ <code>dispatch barriers</code> åˆ›å»ºä¸€ä¸ª<code>è¯»å†™é”</code> æä¾›äº†ä¸€ä¸ªä¼˜é›…çš„è§£å†³æ–¹æ¡ˆã€‚</p>
<p>Dispatch barriers æ˜¯ä¸€ç»„å‡½æ•°ï¼Œåœ¨å¹¶å‘é˜Ÿåˆ—ä¸Šå·¥ä½œæ—¶æ‰®æ¼”ä¸€ä¸ªä¸²è¡Œå¼çš„ç“¶é¢ˆã€‚ä½¿ç”¨ GCD çš„éšœç¢ï¼ˆbarrierï¼‰API ç¡®ä¿æäº¤çš„ Block åœ¨é‚£ä¸ªç‰¹å®šæ—¶é—´ä¸Šæ˜¯æŒ‡å®šé˜Ÿåˆ—ä¸Šå”¯ä¸€è¢«æ‰§è¡Œçš„æ¡ç›®ã€‚è¿™å°±æ„å‘³ç€æ‰€æœ‰çš„å…ˆäºè°ƒåº¦éšœç¢æäº¤åˆ°é˜Ÿåˆ—çš„æ¡ç›®å¿…èƒ½åœ¨è¿™ä¸ª Block æ‰§è¡Œå‰å®Œæˆã€‚</p>
<p>å½“è¿™ä¸ª Block çš„æ—¶æœºåˆ°è¾¾ï¼Œè°ƒåº¦éšœç¢æ‰§è¡Œè¿™ä¸ª Block å¹¶ç¡®ä¿åœ¨é‚£ä¸ªæ—¶é—´é‡Œé˜Ÿåˆ—ä¸ä¼šæ‰§è¡Œä»»ä½•å…¶å®ƒ Block ã€‚ä¸€æ—¦å®Œæˆï¼Œé˜Ÿåˆ—å°±è¿”å›åˆ°å®ƒé»˜è®¤çš„å®ç°çŠ¶æ€ã€‚ GCD æä¾›äº†åŒæ­¥å’Œå¼‚æ­¥ä¸¤ç§éšœç¢å‡½æ•°ã€‚</p>
<p>ä¸‹å›¾æ˜¾ç¤ºäº†éšœç¢å‡½æ•°å¯¹å¤šä¸ªå¼‚æ­¥é˜Ÿåˆ—çš„å½±å“ï¼š</p>
<p><img src="https://blog-andy0570-1256077835.cos.ap-shanghai.myqcloud.com/site_Images/073310.png" alt></p>
<p>æ³¨æ„åˆ°æ­£å¸¸éƒ¨åˆ†çš„æ“ä½œå°±å¦‚åŒä¸€ä¸ªæ­£å¸¸çš„å¹¶å‘é˜Ÿåˆ—ã€‚ä½†å½“éšœç¢æ‰§è¡Œæ—¶ï¼Œå®ƒæœ¬è´¨ä¸Šå°±å¦‚åŒä¸€ä¸ªä¸²è¡Œé˜Ÿåˆ—ã€‚ä¹Ÿå°±æ˜¯ï¼Œéšœç¢æ˜¯å”¯ä¸€åœ¨æ‰§è¡Œçš„äº‹ç‰©ã€‚åœ¨éšœç¢å®Œæˆåï¼Œé˜Ÿåˆ—å›åˆ°ä¸€ä¸ªæ­£å¸¸å¹¶å‘é˜Ÿåˆ—çš„æ ·å­ã€‚</p>
<p>ä¸‹é¢æ˜¯ä½ ä½•æ—¶ä¼šï¼Œæˆ–è€…ä¸ä¼šä½¿ç”¨éšœç¢å‡½æ•°çš„æƒ…å†µï¼š</p>
<ul>
<li>âè‡ªå®šä¹‰ä¸²è¡Œé˜Ÿåˆ—ï¼šä¸€ä¸ªå¾ˆåçš„é€‰æ‹©ï¼›éšœç¢ä¸ä¼šæœ‰ä»»ä½•å¸®åŠ©ï¼Œå› ä¸ºä¸ç®¡æ€æ ·ï¼Œä¸€ä¸ªä¸²è¡Œé˜Ÿåˆ—ä¸€æ¬¡åªæ‰§è¡Œä¸€ä¸ªæ“ä½œã€‚</li>
<li>âå…¨å±€å¹¶å‘é˜Ÿåˆ—ï¼šè¦å°å¿ƒï¼›è¿™å¯èƒ½ä¸æ˜¯æœ€å¥½çš„ä¸»æ„ï¼Œå› ä¸ºå…¶å®ƒç³»ç»Ÿå¯èƒ½åœ¨ä½¿ç”¨é˜Ÿåˆ—è€Œä¸”ä½ ä¸èƒ½å„æ–­å®ƒä»¬åªä¸ºä½ è‡ªå·±çš„ç›®çš„ã€‚</li>
<li>âœ…è‡ªå®šä¹‰å¹¶å‘é˜Ÿåˆ—ï¼šè¿™å¯¹äºåŸå­æˆ–ä¸´ç•ŒåŒºä»£ç æ¥è¯´æ˜¯æä½³çš„é€‰æ‹©ã€‚ä»»ä½•ä½ åœ¨è®¾ç½®æˆ–å®ä¾‹åŒ–çš„éœ€è¦çº¿ç¨‹å®‰å…¨çš„äº‹ç‰©éƒ½æ˜¯ä½¿ç”¨éšœç¢çš„æœ€ä½³å€™é€‰ã€‚</li>
</ul>
<p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">@property (nonatomic, strong) dispatch_queue_t concurrentPhotoQueue;</span><br><span class="line"></span><br><span class="line">//...</span><br><span class="line"></span><br><span class="line">/*</span><br><span class="line">1. â€œå†™æ“ä½œâ€å¯ä»¥æ”¾å…¥å¹¶å‘é˜Ÿåˆ—ï¼Œå› ä¸ºè®¾ç½®æ–¹æ³•å¹¶ä¸éœ€è¦è¿”å›å€¼ï¼›</span><br><span class="line">2. ä½¿ç”¨ dispatch_barrier å°†æ­¤å¹¶å‘é˜Ÿåˆ—åŠ é”ï¼Œä¿è¯ä»»ä¸€æ—¶åˆ»åªæœ‰ä¸€ä¸ªâ€œå†™æ“ä½œâ€åœ¨æ‰§è¡Œï¼›</span><br><span class="line">2. è‡ªå®šä¹‰å¹¶å‘é˜Ÿåˆ—ï¼Œè€Œä¸æ˜¯å…¨å±€å¹¶å‘é˜Ÿåˆ—çš„åŸå› æ˜¯ï¼šå…¨å±€é˜Ÿåˆ—ä¸­è¿˜å¯èƒ½æœ‰å…¶ä»–ä»»åŠ¡ï¼Œä¸€æ—¦åŠ é”å°±ä¼šé˜»å¡å…¶ä»–ä»»åŠ¡çš„æ­£å¸¸æ‰§è¡Œï¼Œä¸èƒ½ä¸ºäº†ä¸ªäººåˆ©ç›Šå½±å“å›½å®¶å˜›ï¼Œå› æ­¤æˆ‘ä»¬å¼€è¾Ÿä¸€ä¸ªæ–°çš„è‡ªå®šä¹‰å¹¶å‘é˜Ÿåˆ—ä¸“é—¨å¤„ç†è¿™ä¸ªé—®é¢˜ã€‚</span><br><span class="line">*/</span><br><span class="line">- (void)addPhoto:(Photo *)photo &#123;</span><br><span class="line">    if (photo) &#123;</span><br><span class="line">        dispatch_barrier_async(self.concurrentPhotoQueue, ^&#123;</span><br><span class="line">            [_photosArray addObject:photo];</span><br><span class="line">            dispatch_async(dispatch_get_main_queue(), ^&#123;</span><br><span class="line">                [self postContentAddedNotification];</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>âš ï¸  æ³¨æ„ï¼šå½“ä½¿ç”¨å¹¶å‘é˜Ÿåˆ—æ—¶ï¼Œè¦ç¡®ä¿æ‰€æœ‰çš„ <em>barrier</em> è°ƒç”¨éƒ½æ˜¯ <em>async</em> çš„ã€‚å¦‚æœä½ ä½¿ç”¨ <code>dispatch_barrier_sync</code> ï¼Œé‚£ä¹ˆä½ å¾ˆå¯èƒ½ä¼šä½¿ä½ è‡ªå·±ï¼ˆæ›´ç¡®åˆ‡çš„è¯´æ˜¯ï¼Œä½ çš„ä»£ç ï¼‰äº§ç”Ÿæ­»é”ã€‚å†™æ“ä½œ<em>éœ€è¦</em> barrierï¼Œå¹¶ä¸”<em>å¯ä»¥</em>æ˜¯ async çš„ã€‚</p>
<h3>è‡ªå®šä¹‰çº¿ç¨‹ï¼Œdispatch_queue_create()</h3>
<p>å‡½æ•°ï¼š<code>dispatch_queue_create(const char * _Nullable label, dispatch_queue_attr_t _Nullable attr)</code></p>
<p>å‚æ•°ä¸€ï¼š<code>const char * _Nullable label</code>ï¼Œè‡ªå®šä¹‰çº¿ç¨‹çš„æ ‡è¯†ç¬¦ï¼Œä¸€èˆ¬ä¸ºåå‘DNSåŸŸå</p>
<p>å‚æ•°äºŒï¼šæŒ‡å®šé˜Ÿåˆ—ç±»å‹ï¼ˆä¸²è¡Œ/å¹¶å‘é˜Ÿåˆ—ï¼‰ï¼Œå¯ä»¥ä¼ å…¥çš„å‚æ•°ç±»å‹å¦‚ä¸‹ï¼š</p>
<ul>
<li>ä¸²è¡Œï¼š<code>DISPATCH_QUEUE_SERIAL</code> ï¼šä¸€ä¸ªæŒ‰FIFOé¡ºåºè°ƒç”¨å—çš„è°ƒåº¦é˜Ÿåˆ—ã€‚</li>
<li>å¹¶å‘ï¼š<code>DISPATCH_QUEUE_CONCURRENT</code>ï¼šä½¿ç”¨ <code>DISPATCH_QUEUE_CONCURRENT</code> å±æ€§åˆ›å»ºçš„é˜Ÿåˆ—å¯ä»¥åŒæ—¶è°ƒç”¨å—ï¼ˆç±»ä¼¼äºå…¨å±€å¹¶å‘é˜Ÿåˆ—ï¼Œä½†å¯èƒ½ä¼šæœ‰æ›´å¤šçš„å¼€é”€ï¼‰ï¼Œå¹¶ä¸”ï¼Œå®ƒæ”¯æŒä½¿ç”¨è°ƒåº¦æ …æ  API ï¼ˆ<code>dispatch barriers</code> ï¼‰æäº¤çš„æ …æ å—ï¼Œä¾‹å¦‚ï¼Œ èƒ½å¤Ÿå®ç°é«˜æ•ˆçš„è¯»å†™å™¨æ–¹æ¡ˆã€‚</li>
</ul>
<blockquote>
<p>æ³¨æ„ï¼šå½“ä½ åœ¨ç½‘ä¸Šæœç´¢ä¾‹å­æ—¶ï¼Œä½ ä¼šç»å¸¸çœ‹äººä»¬ä¼ é€’ <code>0</code> æˆ–è€… <code>NULL</code> ç»™ <code>dispatch_queue_create</code> çš„ç¬¬äºŒä¸ªå‚æ•°ã€‚è¿™æ˜¯åˆ›å»ºä¸²è¡Œé˜Ÿåˆ—çš„è¿‡æ—¶æ–¹å¼ï¼›æ˜ç¡®ä½ çš„å‚æ•°æ€»æ˜¯æ›´å¥½ã€‚</p>
</blockquote>
<p>ä½¿ç”¨ <code>dispatch_queue_create</code> æ–¹æ³•</p>
<p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">dispatch_queue_t urls_queue = dispatch_queue_create(&quot;com.companyName.project.taskName&quot;, NULL);</span><br><span class="line">dispatch_async(urls_queue, ^&#123;</span><br><span class="line">  // your code</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p>
<p>ä¿®æ”¹ä½¿ç”¨è‡ªå®šä¹‰é˜Ÿåˆ—ï¼š</p>
<p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">@property (nonatomic, strong) dispatch_queue_t concurrentPhotoQueue;</span><br><span class="line"></span><br><span class="line">//...</span><br><span class="line">+ (instancetype)sharedManager</span><br><span class="line">&#123;</span><br><span class="line">    static PhotoManager *sharedPhotoManager = nil;</span><br><span class="line">    static dispatch_once_t onceToken;</span><br><span class="line">    dispatch_once(&amp;onceToken, ^&#123;</span><br><span class="line">        sharedPhotoManager = [[PhotoManager alloc] init];</span><br><span class="line">        sharedPhotoManager-&gt;_photosArray = [NSMutableArray array];</span><br><span class="line">        </span><br><span class="line">        // è‡ªå®šä¹‰å¹¶å‘é˜Ÿåˆ— </span><br><span class="line">        sharedPhotoManager -&gt; _concurrentPhotoQueue = dispatch_queue_create(&quot;com.selander.GooglyPuff.photoQueue&quot;, DISPATCH_QUEUE_CONCURRENT);</span><br><span class="line">    &#125;);</span><br><span class="line">    return sharedPhotoManager;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3>åŒæ­¥é˜Ÿåˆ—ï¼Œdispathc_sync</h3>
<p><code>dispatch_sync()</code> åŒæ­¥åœ°æäº¤å·¥ä½œå¹¶åœ¨è¿”å›å‰ç­‰å¾…å®ƒå®Œæˆã€‚ä½¿ç”¨ <code>dispatch_sync</code> è·Ÿè¸ªä½ çš„è°ƒåº¦éšœç¢å·¥ä½œï¼Œæˆ–è€…å½“ä½ éœ€è¦ç­‰å¾…æ“ä½œå®Œæˆåæ‰èƒ½ä½¿ç”¨ Block å¤„ç†è¿‡çš„æ•°æ®ã€‚å¦‚æœä½ ä½¿ç”¨ç¬¬äºŒç§æƒ…å†µåšäº‹ï¼Œä½ å°†ä¸æ—¶çœ‹åˆ°ä¸€ä¸ª <code>__block</code> å˜é‡å†™åœ¨ <code>dispatch_sync</code> èŒƒå›´ä¹‹å¤–ï¼Œä»¥ä¾¿è¿”å›æ—¶åœ¨ <code>dispatch_sync</code> ä½¿ç”¨å¤„ç†è¿‡çš„å¯¹è±¡ã€‚</p>
<p>ä½†ä½ éœ€è¦å¾ˆå°å¿ƒã€‚æƒ³åƒå¦‚æœä½ è°ƒç”¨ <code>dispatch_sync</code> å¹¶æ”¾åœ¨ä½ å·²è¿è¡Œç€çš„å½“å‰é˜Ÿåˆ—ã€‚è¿™ä¼šå¯¼è‡´æ­»é”ï¼Œå› ä¸ºè°ƒç”¨ä¼šä¸€ç›´ç­‰å¾…ç›´åˆ° Block å®Œæˆï¼Œä½† Block ä¸èƒ½å®Œæˆï¼ˆå®ƒç”šè‡³ä¸ä¼šå¼€å§‹ï¼ï¼‰ï¼Œç›´åˆ°å½“å‰å·²ç»å­˜åœ¨çš„ä»»åŠ¡å®Œæˆï¼Œè€Œå½“å‰ä»»åŠ¡æ— æ³•å®Œæˆï¼è¿™å°†è¿«ä½¿ä½ è‡ªè§‰äºä½ æ­£ä»å“ªä¸ªé˜Ÿåˆ—è°ƒç”¨â€”â€”ä»¥åŠä½ æ­£åœ¨ä¼ é€’è¿›å…¥å“ªä¸ªé˜Ÿåˆ—ã€‚</p>
<p>ä¸‹é¢æ˜¯ä¸€ä¸ªå¿«é€Ÿæ€»è§ˆï¼Œå…³äºåœ¨ä½•æ—¶ä»¥åŠä½•å¤„ä½¿ç”¨ <code>dispatch_sync</code> ï¼š</p>
<ul>
<li>è‡ªå®šä¹‰ä¸²è¡Œé˜Ÿåˆ—ï¼šåœ¨è¿™ä¸ªçŠ¶å†µä¸‹è¦éå¸¸å°å¿ƒï¼å¦‚æœä½ æ­£è¿è¡Œåœ¨ä¸€ä¸ªé˜Ÿåˆ—å¹¶è°ƒç”¨ <code>dispatch_sync</code> æ”¾åœ¨åŒä¸€ä¸ªé˜Ÿåˆ—ï¼Œé‚£ä½ å°±ç™¾åˆ†ç™¾åœ°åˆ›å»ºäº†ä¸€ä¸ªæ­»é”ï¼ˆåŒæ­¥é˜Ÿåˆ—åµŒå¥—ä¼šå¯¼è‡´æ­»é”é—®é¢˜ï¼ï¼ï¼ï¼‰</li>
<li>ä¸»é˜Ÿåˆ—ï¼ˆä¸²è¡Œï¼‰ï¼šåŒä¸Šé¢çš„ç†ç”±ä¸€æ ·ï¼Œå¿…é¡»éå¸¸å°å¿ƒï¼è¿™ä¸ªçŠ¶å†µåŒæ ·æœ‰æ½œåœ¨çš„å¯¼è‡´æ­»é”çš„æƒ…å†µã€‚</li>
<li>âœ…å¹¶å‘é˜Ÿåˆ—ï¼šè¿™æ‰æ˜¯åšåŒæ­¥å·¥ä½œçš„å¥½é€‰æ‹©ï¼Œä¸è®ºæ˜¯é€šè¿‡è°ƒåº¦éšœç¢ï¼Œæˆ–è€…éœ€è¦ç­‰å¾…ä¸€ä¸ªä»»åŠ¡å®Œæˆæ‰èƒ½æ‰§è¡Œè¿›ä¸€æ­¥å¤„ç†çš„æƒ…å†µã€‚</li>
</ul>
<p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">// å°†â€œè¯»æ“ä½œâ€æ”¾å…¥åŒæ­¥é˜Ÿåˆ—ï¼Œè¿™æ ·æ–¹æ³•å°±ä¸ä¼šç«‹å³è¿”å›äº†ï¼Œå®ƒä¼šç­‰å¾…æ‰§è¡Œâ€œè¯»æ“ä½œâ€å®Œæ¯•åæ‰è¿”å›ã€‚</span><br><span class="line">- (NSArray *)photos</span><br><span class="line">&#123;</span><br><span class="line">  // __block å…³é”®å­—å…è®¸å¯¹è±¡åœ¨ Block å†…å¯å˜ã€‚æ²¡æœ‰å®ƒï¼Œarray åœ¨ Block å†…éƒ¨å°±åªæ˜¯åªè¯»çš„ï¼Œä½ çš„ä»£ç ç”šè‡³ä¸èƒ½é€šè¿‡ç¼–è¯‘ã€‚</span><br><span class="line">    __block NSArray *array;</span><br><span class="line">    dispatch_sync(self.concurrentPhotoQueue, ^&#123;</span><br><span class="line">        array = [NSArray arrayWithArray:_photosArray];</span><br><span class="line">    &#125;);</span><br><span class="line">    return _photosArray;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>####å°ç»“ï¼šè¯»å†™çš„çº¿ç¨‹å®‰å…¨é—®é¢˜</p>
<p>ä¸€ã€ä»¥ä¸Šå‡ ä¸ªå‡½æ•°æ˜¯å¦‚ä½•è§£å†³è¯»å†™é—®é¢˜çš„å‘¢ï¼Ÿ</p>
<ol>
<li><strong>å†™æ–¹æ³•</strong>ï¼šå°†<strong>å†™æ“ä½œ</strong>æ”¾åœ¨ <code>dispatch_barrier_async</code> é˜»å¡å‡½æ•°ä¸­ï¼ŒåŒæ—¶ï¼Œè¯¥é˜»å¡å‡½æ•°è¿è¡Œåœ¨è‡ªå®šä¹‰å¹¶å‘é˜Ÿåˆ—ä¸­ï¼š<code>dispatch_queue_create(&quot;com.selander.GooglyPuff.photoQueue&quot;, DISPATCH_QUEUE_CONCURRENT)</code>ã€‚</li>
<li><strong>è¯»æ–¹æ³•</strong>ï¼šå°†<strong>è¯»æ“ä½œ</strong>æ”¾å…¥åŒæ­¥é˜Ÿåˆ— <code>dispatch_sync</code> ä¸­ï¼Œæ–¹æ³•ä¼šç­‰å¾…<strong>è¯»æ“ä½œ</strong>æ‰§è¡Œå®Œæ¯•åå†è¿”å›ï¼ŒåŒæ—¶ï¼Œè¯¥åŒæ­¥é˜Ÿåˆ—ä»ç„¶è¿è¡Œåœ¨è‡ªå®šä¹‰å¹¶å‘é˜Ÿåˆ—ä¸­ï¼šå› ä¸ºå¤šä¸ªè·å–æ–¹æ³•å¯ä»¥å¹¶å‘æ‰§è¡Œã€‚</li>
<li>è·å–æ–¹æ³•ä¸è®¾ç½®æ–¹æ³•ä¹‹é—´ä¸èƒ½å¹¶å‘æ‰§è¡Œï¼Œå› æ­¤æˆ‘ä»¬å°†ä»–ä»¬æ”¾åœ¨åŒä¸€ä¸ªè‡ªå®šä¹‰å¹¶å‘é˜Ÿåˆ—ä¸­ã€‚</li>
</ol>
<h3>dispatch_sync ä¸ dispatch_async çš„åŒºåˆ«</h3>
<ul>
<li><code>dispatch_sync</code>ï¼ŒåŒæ­¥é˜Ÿåˆ—ï¼Œå‡½æ•°ä¼šç­‰å¾…å®ƒè¿”å›åå†ç»§ç»­æ‰§è¡Œã€‚</li>
<li><code>dispatch_async</code>ï¼Œå¼‚æ­¥é˜Ÿåˆ—ï¼Œå‡½æ•°ä¼šç«‹å³è¿”å›ã€‚</li>
</ul>
<h4>dispatch_sync</h4>
<p><code>viewDidLoad</code> æ–¹æ³•ä¼šç­‰å¾…åŒæ­¥é˜Ÿåˆ—ä»»åŠ¡è¿”å›åå†ç»§ç»­æ‰§è¡Œã€‚</p>
<p><img src="https://blog-andy0570-1256077835.cos.ap-shanghai.myqcloud.com/site_Images/073311.gif" alt></p>
<h4>dispatch_async</h4>
<p><code>viewDidLoad</code> æ–¹æ³•ä¼šç«‹å³ç»§ç»­æ‰§è¡Œï¼Œä¸ä¼šç­‰å¾…å¼‚æ­¥é˜Ÿåˆ—ä»»åŠ¡è¿”å›ã€‚</p>
<p><img src="https://blog-andy0570-1256077835.cos.ap-shanghai.myqcloud.com/site_Images/073315.gif" alt></p>
<h3>è°ƒåº¦ç»„ï¼Œdispatch_group_t</h3>
<p>Dispatch Group ä¼šåœ¨æ•´ä¸ªç»„çš„ä»»åŠ¡éƒ½å®Œæˆæ—¶é€šçŸ¥ä½ ã€‚è¿™äº›ä»»åŠ¡å¯ä»¥æ˜¯åŒæ­¥çš„ï¼Œä¹Ÿå¯ä»¥æ˜¯å¼‚æ­¥çš„ï¼Œå³ä¾¿åœ¨ä¸åŒçš„é˜Ÿåˆ—ä¹Ÿè¡Œã€‚è€Œä¸”åœ¨æ•´ä¸ªç»„çš„ä»»åŠ¡éƒ½å®Œæˆæ—¶ï¼ŒDispatch Group å¯ä»¥ç”¨åŒæ­¥çš„æˆ–è€…å¼‚æ­¥çš„æ–¹å¼é€šçŸ¥ä½ ã€‚å› ä¸ºè¦ç›‘æ§çš„ä»»åŠ¡åœ¨ä¸åŒé˜Ÿåˆ—ï¼Œé‚£å°±ç”¨ä¸€ä¸ª <code>dispatch_group_t</code> çš„å®ä¾‹æ¥è®°ä¸‹è¿™äº›ä¸åŒçš„ä»»åŠ¡ã€‚</p>
<p>å½“ç»„ä¸­æ‰€æœ‰çš„äº‹ä»¶éƒ½å®Œæˆæ—¶ï¼ŒGCD çš„ API æä¾›äº†ä¸¤ç§é€šçŸ¥æ–¹å¼ã€‚</p>
<p>ç¤ºä¾‹ä»£ç ä¸€ï¼š</p>
<p><figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è®©åå° 2 ä¸ªçº¿ç¨‹å¹¶è¡Œæ‰§è¡Œï¼Œç„¶åç­‰ 2 ä¸ªçº¿ç¨‹éƒ½ç»“æŸåï¼Œå†æ±‡æ€»æ‰§è¡Œç»“æœã€‚</span></span><br><span class="line">dispatch_group_t group = dispatch_group_create();</span><br><span class="line">dispatch_group_async(group, dispatch_get_global_queue(<span class="number">0</span>, <span class="number">0</span>), ^&#123;</span><br><span class="line">    <span class="comment">// å¹¶è¡Œæ‰§è¡Œçº¿ç¨‹ä¸€</span></span><br><span class="line">&#125;);</span><br><span class="line">dispatch_group_async(group, dispatch_get_global_queue(<span class="number">0</span>, <span class="number">0</span>), ^&#123;</span><br><span class="line">    <span class="comment">// å¹¶è¡Œæ‰§è¡Œçº¿ç¨‹äºŒ</span></span><br><span class="line">&#125;);</span><br><span class="line">dispatch_group_notify(group, dispatch_get_global_queue(<span class="number">0</span>, <span class="number">0</span>), ^&#123;</span><br><span class="line">    <span class="comment">// æ±‡æ€»ç»“æœ</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p>
<p>å› ä¸ºä¸‹è½½ä»»åŠ¡æ˜¯åœ¨åå°æ‰§è¡Œçš„ï¼Œå®ƒä¼šç«‹å³è¿”å›ï¼Œå¦‚ä½•ç›‘å¬ä¸‹è½½å®Œæˆå¹¶åšä¸€äº›ä¸‹è½½å®Œæˆåçš„å¤„ç†ï¼Ÿä½¿ç”¨ <code>dispatch_group_t</code>ã€‚</p>
<p>ç¬¬ä¸€ç§æ˜¯ <code>dispatch_group_wait</code> ï¼Œå®ƒä¼šé˜»å¡å½“å‰çº¿ç¨‹ï¼Œç›´åˆ°ç»„é‡Œé¢æ‰€æœ‰çš„ä»»åŠ¡éƒ½å®Œæˆæˆ–è€…ç­‰åˆ°æŸä¸ªè¶…æ—¶å‘ç”Ÿã€‚</p>
<p>1âƒ£ï¸ <strong>dispatch_group_wait()</strong> å‡½æ•°ï¼Œä¼šé˜»å¡ä¸»çº¿ç¨‹ï¼š</p>
<p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">- (void)downloadPhotosWithCompletionBlock:(BatchPhotoDownloadingCompletionBlock)completionBlock</span><br><span class="line">&#123;</span><br><span class="line">    // å› ä¸º dispatch_group_wait() æ–¹æ³•ä¼šé˜»å¡ä¸»çº¿ç¨‹ï¼Œæ‰€ä»¥ä½¿ç”¨ dispatch_async() å°†æ•´ä¸ªæ–¹æ³•æ”¾å…¥åå°é˜Ÿåˆ—ä¸­ä»¥é¿å…é˜»å¡ä¸»çº¿ç¨‹ã€‚</span><br><span class="line">    dispatch_async(dispatch_get_global_queue(QOS_CLASS_USER_INTERACTIVE, 0), ^&#123; // 1</span><br><span class="line">        </span><br><span class="line">        __block NSError *error;</span><br><span class="line">        </span><br><span class="line">        // åˆ›å»ºä¸€ä¸ªä»»åŠ¡è°ƒåº¦ç»„</span><br><span class="line">        dispatch_group_t downloadGroup = dispatch_group_create(); // 2</span><br><span class="line">        </span><br><span class="line">        for (NSInteger i = 0; i &lt; 3; i++) &#123;</span><br><span class="line">            NSURL *url;</span><br><span class="line">            switch (i) &#123;</span><br><span class="line">                case 0:</span><br><span class="line">                    url = [NSURL URLWithString:kOverlyAttachedGirlfriendURLString];</span><br><span class="line">                    break;</span><br><span class="line">                case 1:</span><br><span class="line">                    url = [NSURL URLWithString:kSuccessKidURLString];</span><br><span class="line">                    break;</span><br><span class="line">                case 2:</span><br><span class="line">                    url = [NSURL URLWithString:kLotsOfFacesURLString];</span><br><span class="line">                    break;</span><br><span class="line">                default:</span><br><span class="line">                    break;</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            // dispatch_group_enter æ‰‹åŠ¨é€šçŸ¥ Dispatch Group ä»»åŠ¡å·²ç»å¼€å§‹ã€‚ä½ å¿…é¡»ä¿è¯ dispatch_group_enter å’Œ dispatch_group_leave æˆå¯¹å‡ºç°ï¼Œå¦åˆ™ä½ å¯èƒ½ä¼šé‡åˆ°è¯¡å¼‚çš„å´©æºƒé—®é¢˜ã€‚</span><br><span class="line">            dispatch_group_enter(downloadGroup); // 3</span><br><span class="line">            Photo *photo = [[Photo alloc] initwithURL:url</span><br><span class="line">                                  withCompletionBlock:^(UIImage *image, NSError *_error) &#123;</span><br><span class="line">                                      if (_error) &#123;</span><br><span class="line">                                          error = _error;</span><br><span class="line">                                      &#125;</span><br><span class="line">                                      dispatch_group_leave(downloadGroup); // 4</span><br><span class="line">                                  &#125;];</span><br><span class="line">            </span><br><span class="line">            [[PhotoManager sharedManager] addPhoto:photo];</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        // dispatch_group_wait ä¼šä¸€ç›´ç­‰å¾…ï¼Œç›´åˆ°ä»»åŠ¡å…¨éƒ¨å®Œæˆæˆ–è€…è¶…æ—¶ã€‚å¦‚æœåœ¨æ‰€æœ‰ä»»åŠ¡å®Œæˆå‰è¶…æ—¶äº†ï¼Œè¯¥å‡½æ•°ä¼šè¿”å›ä¸€ä¸ªéé›¶å€¼ã€‚ä½ å¯ä»¥å¯¹æ­¤è¿”å›å€¼åšæ¡ä»¶åˆ¤æ–­ä»¥ç¡®å®šæ˜¯å¦è¶…å‡ºç­‰å¾…å‘¨æœŸï¼›ç„¶è€Œï¼Œä½ åœ¨è¿™é‡Œç”¨ DISPATCH_TIME_FOREVER è®©å®ƒæ°¸è¿œç­‰å¾…ã€‚å®ƒçš„æ„æ€ï¼Œå‹¿åº¸ç½®ç–‘å°±æ˜¯ï¼Œæ°¸ï¼è¿œï¼ç­‰ï¼å¾…ï¼è¿™æ ·å¾ˆå¥½ï¼Œå› ä¸ºå›¾ç‰‡çš„åˆ›å»ºå·¥ä½œæ€»æ˜¯ä¼šå®Œæˆçš„ã€‚</span><br><span class="line">        dispatch_group_wait(downloadGroup, DISPATCH_TIME_FOREVER); // 5</span><br><span class="line">        </span><br><span class="line">        // æ­¤æ—¶æ­¤åˆ»ï¼Œä½ å·²ç»ç¡®ä¿äº†ï¼Œè¦ä¹ˆæ‰€æœ‰çš„å›¾ç‰‡ä»»åŠ¡éƒ½å·²å®Œæˆï¼Œè¦ä¹ˆå‘ç”Ÿäº†è¶…æ—¶ã€‚ç„¶åï¼Œä½ åœ¨ä¸»çº¿ç¨‹ä¸Šè¿è¡Œ completionBlock å›è°ƒã€‚è¿™ä¼šå°†å·¥ä½œæ”¾åˆ°ä¸»çº¿ç¨‹ä¸Šï¼Œå¹¶åœ¨ç¨åæ‰§è¡Œã€‚</span><br><span class="line">        dispatch_async(dispatch_get_main_queue(), ^&#123; // 6</span><br><span class="line">            if (completionBlock) &#123;</span><br><span class="line">                completionBlock(error);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>2âƒ£ï¸ <strong>dispatch_group_notify()</strong> å‡½æ•°ï¼Œå¼‚æ­¥æ‰§è¡Œï¼Œä¸ä¼šé˜»å¡ä¸»çº¿ç¨‹ï¼š</p>
<p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">- (void)downloadPhotosWithCompletionBlock:(BatchPhotoDownloadingCompletionBlock)completionBlock</span><br><span class="line">&#123;</span><br><span class="line">    __block NSError *error;</span><br><span class="line"></span><br><span class="line">    // åˆ›å»ºä¸€ä¸ªä»»åŠ¡è°ƒåº¦ç»„</span><br><span class="line">    dispatch_group_t downloadGroup = dispatch_group_create(); // 1</span><br><span class="line">    </span><br><span class="line">    for (NSInteger i = 0; i &lt; 3; i++) &#123;</span><br><span class="line">        NSURL *url;</span><br><span class="line">        switch (i) &#123;</span><br><span class="line">            case 0:</span><br><span class="line">                url = [NSURL URLWithString:kOverlyAttachedGirlfriendURLString];</span><br><span class="line">                break;</span><br><span class="line">            case 1:</span><br><span class="line">                url = [NSURL URLWithString:kSuccessKidURLString];</span><br><span class="line">                break;</span><br><span class="line">            case 2:</span><br><span class="line">                url = [NSURL URLWithString:kLotsOfFacesURLString];</span><br><span class="line">                break;</span><br><span class="line">            default:</span><br><span class="line">                break;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        dispatch_group_enter(downloadGroup); // 2</span><br><span class="line">        Photo *photo = [[Photo alloc] initwithURL:url</span><br><span class="line">                              withCompletionBlock:^(UIImage *image, NSError *_error) &#123;</span><br><span class="line">                                  if (_error) &#123;</span><br><span class="line">                                      error = _error;</span><br><span class="line">                                  &#125;</span><br><span class="line">                                  dispatch_group_leave(downloadGroup); // 3</span><br><span class="line">                              &#125;];</span><br><span class="line">        </span><br><span class="line">        [[PhotoManager sharedManager] addPhoto:photo];</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    // dispatch_group_notify ä»¥å¼‚æ­¥çš„æ–¹å¼å·¥ä½œã€‚å½“ Dispatch Group ä¸­æ²¡æœ‰ä»»ä½•ä»»åŠ¡æ—¶ï¼Œå®ƒå°±ä¼šæ‰§è¡Œå…¶ä»£ç ï¼Œé‚£ä¹ˆ completionBlock ä¾¿ä¼šè¿è¡Œã€‚ä½ è¿˜æŒ‡å®šäº†è¿è¡Œ completionBlock çš„é˜Ÿåˆ—ï¼Œæ­¤å¤„ï¼Œä¸»é˜Ÿåˆ—å°±æ˜¯ä½ æ‰€éœ€è¦çš„ã€‚</span><br><span class="line">    dispatch_group_notify(downloadGroup, dispatch_get_main_queue(), ^&#123; // 4</span><br><span class="line">        if (completionBlock) &#123;</span><br><span class="line">            completionBlock(error);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>å…³äºä½•æ—¶ä»¥åŠæ€æ ·ä½¿ç”¨æœ‰ç€ä¸åŒçš„é˜Ÿåˆ—ç±»å‹çš„ Dispatch Group ï¼š</p>
<ul>
<li>è‡ªå®šä¹‰ä¸²è¡Œé˜Ÿåˆ—ï¼šå®ƒå¾ˆé€‚åˆå½“ä¸€ç»„ä»»åŠ¡å®Œæˆæ—¶å‘å‡ºé€šçŸ¥ã€‚</li>
<li>ä¸»é˜Ÿåˆ—ï¼ˆä¸²è¡Œï¼‰ï¼šå®ƒä¹Ÿå¾ˆé€‚åˆè¿™æ ·çš„æƒ…å†µã€‚ä½†å¦‚æœä½ è¦åŒæ­¥åœ°ç­‰å¾…æ‰€æœ‰å·¥ä½œåœ°å®Œæˆï¼Œé‚£ä½ å°±ä¸åº”è¯¥ä½¿ç”¨å®ƒï¼Œå› ä¸ºä½ ä¸èƒ½é˜»å¡ä¸»çº¿ç¨‹ã€‚ç„¶è€Œï¼Œå¼‚æ­¥æ¨¡å‹æ˜¯ä¸€ä¸ªå¾ˆæœ‰å¸å¼•åŠ›çš„èƒ½ç”¨äºåœ¨å‡ ä¸ªè¾ƒé•¿ä»»åŠ¡ï¼ˆä¾‹å¦‚ç½‘ç»œè°ƒç”¨ï¼‰å®Œæˆåæ›´æ–° UI çš„æ–¹å¼ã€‚</li>
<li>å¹¶å‘é˜Ÿåˆ—ï¼šå®ƒä¹Ÿå¾ˆé€‚åˆ Dispatch Group å’Œå®Œæˆæ—¶é€šçŸ¥ã€‚</li>
</ul>
<h3>å¹¶å‘å¾ªç¯ã€è¿­ä»£æ‰§è¡Œï¼Œdispatch_apply</h3>
<p><code>dispatch_apply</code> è¡¨ç°å¾—å°±åƒä¸€ä¸ª <code>for</code> å¾ªç¯ï¼Œä½†å®ƒèƒ½å¹¶å‘åœ°æ‰§è¡Œä¸åŒçš„è¿­ä»£ã€‚è¿™ä¸ªå‡½æ•°æ˜¯åŒæ­¥çš„ï¼Œæ‰€ä»¥å’Œæ™®é€šçš„ <code>for</code> å¾ªç¯ä¸€æ ·ï¼Œå®ƒåªä¼šåœ¨æ‰€æœ‰å·¥ä½œéƒ½å®Œæˆåæ‰ä¼šè¿”å›ã€‚</p>
<p>å½“åœ¨ Block å†…è®¡ç®—ä»»ä½•ç»™å®šæ•°é‡çš„å·¥ä½œçš„æœ€ä½³è¿­ä»£æ•°é‡æ—¶ï¼Œå¿…é¡»è¦å°å¿ƒï¼Œå› ä¸ºè¿‡å¤šçš„è¿­ä»£å’Œæ¯ä¸ªè¿­ä»£åªæœ‰å°‘é‡çš„å·¥ä½œä¼šå¯¼è‡´å¤§é‡å¼€é”€ä»¥è‡´å®ƒèƒ½æŠµæ¶ˆä»»ä½•å› å¹¶å‘å¸¦æ¥çš„æ”¶ç›Šã€‚è€Œè¢«ç§°ä¸º<code>è·¨è¶Šå¼ï¼ˆstridingï¼‰</code>çš„æŠ€æœ¯å¯ä»¥åœ¨æ­¤å¸®åˆ°ä½ ï¼Œå³é€šè¿‡åœ¨æ¯ä¸ªè¿­ä»£é‡Œå¤šåšå‡ ä¸ªä¸åŒçš„å·¥ä½œã€‚</p>
<blockquote>
<p>è¯‘è€…æ³¨ï¼šå¤§æ¦‚å°±èƒ½å‡å°‘å¹¶å‘æ•°é‡å§ï¼Œä½œè€…æ˜¯æé†’å¤§å®¶æ³¨æ„å¹¶å‘çš„å¼€é”€ï¼Œè®°åœ¨å¿ƒé‡Œï¼</p>
</blockquote>
<p>é‚£ä½•æ—¶æ‰é€‚åˆç”¨ <code>dispatch_apply</code> å‘¢ï¼Ÿ</p>
<ul>
<li>è‡ªå®šä¹‰ä¸²è¡Œé˜Ÿåˆ—ï¼šä¸²è¡Œé˜Ÿåˆ—ä¼šå®Œå…¨æŠµæ¶ˆ <code>dispatch_apply</code> çš„åŠŸèƒ½ï¼›ä½ è¿˜ä¸å¦‚ç›´æ¥ä½¿ç”¨æ™®é€šçš„ <code>for</code> å¾ªç¯ã€‚</li>
<li>ä¸»é˜Ÿåˆ—ï¼ˆä¸²è¡Œï¼‰ï¼šä¸ä¸Šé¢ä¸€æ ·ï¼Œåœ¨ä¸²è¡Œé˜Ÿåˆ—ä¸Šä¸é€‚åˆä½¿ç”¨ <code>dispatch_apply</code> ã€‚è¿˜æ˜¯ç”¨æ™®é€šçš„ <code>for</code> å¾ªç¯å§ã€‚</li>
<li>âœ…å¹¶å‘é˜Ÿåˆ—ï¼šå¯¹äºå¹¶å‘å¾ªç¯æ¥è¯´æ˜¯å¾ˆå¥½é€‰æ‹©ï¼Œç‰¹åˆ«æ˜¯å½“ä½ éœ€è¦è¿½è¸ªä»»åŠ¡çš„è¿›åº¦æ—¶ã€‚</li>
</ul>
<p>ä½¿ç”¨ç¤ºä¾‹ï¼š</p>
<p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">- (void)downloadPhotosWithCompletionBlock:(BatchPhotoDownloadingCompletionBlock)completionBlock</span><br><span class="line">&#123;</span><br><span class="line">    __block NSError *error;</span><br><span class="line"></span><br><span class="line">    // åˆ›å»ºä¸€ä¸ªä»»åŠ¡è°ƒåº¦ç»„</span><br><span class="line">    dispatch_group_t downloadGroup = dispatch_group_create(); // 1</span><br><span class="line">    </span><br><span class="line">    // ä½¿ç”¨ dispatch_apply ä»£æ›¿ for (NSInteger i = 0; i &lt; 3; i++) å¾ªç¯</span><br><span class="line">    dispatch_apply(3, dispatch_get_global_queue(QOS_CLASS_USER_INTERACTIVE, 0), ^(size_t i) &#123;</span><br><span class="line">        NSURL *url;</span><br><span class="line">        switch (i) &#123;</span><br><span class="line">            case 0:</span><br><span class="line">                url = [NSURL URLWithString:kOverlyAttachedGirlfriendURLString];</span><br><span class="line">                break;</span><br><span class="line">            case 1:</span><br><span class="line">                url = [NSURL URLWithString:kSuccessKidURLString];</span><br><span class="line">                break;</span><br><span class="line">            case 2:</span><br><span class="line">                url = [NSURL URLWithString:kLotsOfFacesURLString];</span><br><span class="line">                break;</span><br><span class="line">            default:</span><br><span class="line">                break;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        dispatch_group_enter(downloadGroup); // 2</span><br><span class="line">        Photo *photo = [[Photo alloc] initwithURL:url</span><br><span class="line">                              withCompletionBlock:^(UIImage *image, NSError *_error) &#123;</span><br><span class="line">                                  if (_error) &#123;</span><br><span class="line">                                      error = _error;</span><br><span class="line">                                  &#125;</span><br><span class="line">                                  dispatch_group_leave(downloadGroup); // 3</span><br><span class="line">                              &#125;];</span><br><span class="line">        </span><br><span class="line">        [[PhotoManager sharedManager] addPhoto:photo];</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    // dispatch_group_notify ä»¥å¼‚æ­¥çš„æ–¹å¼å·¥ä½œã€‚å½“ Dispatch Group ä¸­æ²¡æœ‰ä»»ä½•ä»»åŠ¡æ—¶ï¼Œå®ƒå°±ä¼šæ‰§è¡Œå…¶ä»£ç ï¼Œé‚£ä¹ˆ completionBlock ä¾¿ä¼šè¿è¡Œã€‚ä½ è¿˜æŒ‡å®šäº†è¿è¡Œ completionBlock çš„é˜Ÿåˆ—ï¼Œæ­¤å¤„ï¼Œä¸»é˜Ÿåˆ—å°±æ˜¯ä½ æ‰€éœ€è¦çš„ã€‚</span><br><span class="line">    dispatch_group_notify(downloadGroup, dispatch_get_main_queue(), ^&#123; // 4</span><br><span class="line">        if (completionBlock) &#123;</span><br><span class="line">            completionBlock(error);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>å®é™…ä¸Šï¼Œåœ¨è¿™ä¸ªä¾‹å­é‡Œå¹¶ä¸å€¼å¾—ã€‚ä¸‹é¢æ˜¯åŸå› ï¼š</p>
<ul>
<li>ä½ åˆ›å»ºå¹¶è¡Œè¿è¡Œçº¿ç¨‹è€Œä»˜å‡ºçš„å¼€é”€ï¼Œå¾ˆå¯èƒ½æ¯”ç›´æ¥ä½¿ç”¨  <code>for</code> å¾ªç¯è¦å¤šã€‚è‹¥ä½ è¦ä»¥åˆé€‚çš„æ­¥é•¿è¿­ä»£éå¸¸å¤§çš„é›†åˆï¼Œé‚£æ‰åº”è¯¥è€ƒè™‘ä½¿ç”¨ <code>dispatch_apply</code>ã€‚</li>
<li>ä½ ç”¨äºåˆ›å»ºåº”ç”¨çš„æ—¶é—´æ˜¯æœ‰é™çš„â€”â€”é™¤éå®åœ¨å¤ªç³Ÿç³•å¦åˆ™ä¸è¦æµªè´¹æ—¶é—´å»æå‰ä¼˜åŒ–ä»£ç ã€‚å¦‚æœä½ è¦ä¼˜åŒ–ä»€ä¹ˆï¼Œé‚£å»ä¼˜åŒ–é‚£äº›æ˜æ˜¾å€¼å¾—ä½ ä»˜å‡ºæ—¶é—´çš„éƒ¨åˆ†ã€‚ä½ å¯ä»¥é€šè¿‡åœ¨ Instruments é‡Œåˆ†æä½ çš„åº”ç”¨ï¼Œæ‰¾å‡ºæœ€é•¿è¿è¡Œæ—¶é—´çš„æ–¹æ³•ã€‚çœ‹çœ‹ <a href="http://www.raywenderlich.com/23037/how-to-use-instruments-in-xcode" target="_blank" rel="noopener">å¦‚ä½•åœ¨ Xcode ä¸­ä½¿ç”¨ Instruments</a> å¯ä»¥å­¦åˆ°æ›´å¤šç›¸å…³çŸ¥è¯†ã€‚</li>
<li>é€šå¸¸æƒ…å†µä¸‹ï¼Œä¼˜åŒ–ä»£ç ä¼šè®©ä½ çš„ä»£ç æ›´åŠ å¤æ‚ï¼Œä¸åˆ©äºä½ è‡ªå·±å’Œå…¶ä»–å¼€å‘è€…é˜…è¯»ã€‚è¯·ç¡®ä¿æ·»åŠ çš„å¤æ‚æ€§èƒ½æ¢æ¥è¶³å¤Ÿå¤šçš„å¥½å¤„ã€‚</li>
</ul>
<p>è®°ä½ï¼Œä¸è¦åœ¨ä¼˜åŒ–ä¸Šå¤ªç–¯ç‹‚ã€‚ä½ åªä¼šè®©ä½ è‡ªå·±å’Œåæ¥è€…æ›´éš¾ä»¥è¯»æ‡‚ä½ çš„ä»£ç ã€‚</p>
<blockquote>
<p>ğŸ’¡ä½¿ç”¨çº¿ç¨‹å¹¶ä¸æ˜¯æ²¡æœ‰ä»£ä»·çš„ï¼Œçº¿ç¨‹ä¼šæœ‰<strong>åˆ›å»ºæ—¶çš„æ—¶é—´å¼€é”€</strong>ï¼Œè¿˜ä¼šæ¶ˆè€—å†…æ ¸çš„å†…å­˜ï¼Œå³<strong>åº”ç”¨çš„å†…å­˜ç©ºé—´</strong>ã€‚</p>
</blockquote>
<h3>ä¿¡å·é‡å‡½æ•°ï¼Œdispatch_semaphore_t</h3>
<p>ä¿¡å·é‡è®©ä½ æ§åˆ¶å¤šä¸ªæ¶ˆè´¹è€…å¯¹æœ‰é™æ•°é‡èµ„æºçš„è®¿é—®ã€‚ä¸¾ä¾‹æ¥è¯´ï¼Œå¦‚æœä½ åˆ›å»ºäº†ä¸€ä¸ªæœ‰ç€ä¸¤ä¸ªèµ„æºçš„ä¿¡å·é‡ï¼Œé‚£åŒæ—¶æœ€å¤šåªèƒ½æœ‰ä¸¤ä¸ªçº¿ç¨‹å¯ä»¥è®¿é—®ä¸´ç•ŒåŒºã€‚å…¶ä»–æƒ³ä½¿ç”¨èµ„æºçš„çº¿ç¨‹å¿…é¡»åœ¨ä¸€ä¸ªâ€¦ä½ çŒœåˆ°äº†å—ï¼Ÿâ€¦FIFOé˜Ÿåˆ—é‡Œç­‰å¾…ã€‚</p>
<p>...</p>
<h3>æ¯ç§’æ‰§è¡Œï¼Œdispatch_source</h3>
<p>å¸®åŠ©ä½ å»å“åº”æˆ–ç›‘æµ‹ Unix ä¿¡å·ã€æ–‡ä»¶æè¿°ç¬¦ã€Mach ç«¯å£ã€VFS èŠ‚ç‚¹ï¼Œä»¥åŠå…¶å®ƒæ™¦æ¶©çš„ä¸œè¥¿ã€‚</p>
<p>å¸¸ç”¨äº<strong>å€’è®¡æ—¶å™¨</strong>ï¼Œä½¿ç”¨ snippet ä»£ç å—ï¼š==dispatch_source==</p>
<p>ç¤ºä¾‹ä¸€ï¼š
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">// 60ç§’å€’è®¡æ—¶å®šæ—¶å™¨ï¼Œæ¯ç§’æ‰§è¡Œä¸€æ¬¡ï¼Œ</span><br><span class="line">double intervalInSeconds = 60.0; // æ—¶é—´é—´éš”</span><br><span class="line">dispatch_source_t timer = dispatch_source_create(DISPATCH_SOURCE_TYPE_TIMER, 0, 0, dispatch_get_main_queue());</span><br><span class="line">dispatch_source_set_timer(timer, DISPATCH_TIME_NOW, intervalInSeconds * NSEC_PER_SEC, 0 * NSEC_PER_SEC);</span><br><span class="line">dispatch_source_set_event_handler(timer, ^&#123;</span><br><span class="line">    // code to be executed when timer fires</span><br><span class="line">&#125;);</span><br><span class="line">dispatch_resume(timer);</span><br></pre></td></tr></table></figure></p>
<p>ç¤ºä¾‹äºŒï¼š
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">// ç‚¹å‡»â€œè·å–éªŒè¯ç æŒ‰é’®â€ï¼Œå¼€å¯60ç§’å€’è®¡æ—¶</span><br><span class="line">-(void)buttonCountDown:(UIButton *)button &#123;</span><br><span class="line">    button.enabled = NO;</span><br><span class="line">    </span><br><span class="line">    __block int timeout = 60; // å€’è®¡æ—¶æ—¶é—´</span><br><span class="line">    NSTimeInterval intervalInSeconds = 1.0; // æ‰§è¡Œæ—¶é—´é—´éš”</span><br><span class="line">    </span><br><span class="line">    dispatch_queue_t queue = dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0);</span><br><span class="line">    dispatch_source_t timer = dispatch_source_create(DISPATCH_SOURCE_TYPE_TIMER, 0, 0, queue);</span><br><span class="line">    dispatch_source_set_timer(timer, DISPATCH_TIME_NOW, intervalInSeconds * NSEC_PER_SEC, 0 * NSEC_PER_SEC);</span><br><span class="line">    dispatch_source_set_event_handler(timer, ^&#123;</span><br><span class="line">        if (timeout &lt;= 0) &#123;</span><br><span class="line">            dispatch_source_cancel(timer);</span><br><span class="line">            dispatch_async(dispatch_get_main_queue(), ^&#123;</span><br><span class="line">                button.enabled = YES;</span><br><span class="line">                [button setTitle:@&quot;é‡æ–°è·å–éªŒè¯ç &quot; forState:UIControlStateNormal];</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;else &#123;</span><br><span class="line">            dispatch_async(dispatch_get_main_queue(), ^&#123;</span><br><span class="line">                button.enabled = NO;</span><br><span class="line">                NSString *buttonTitle = [NSString stringWithFormat:@&quot;%dsåé‡æ–°å‘é€&quot;,timeout];</span><br><span class="line">                [button setTitle:buttonTitle forState:UIControlStateNormal];</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">        timeout --;</span><br><span class="line">    &#125;);</span><br><span class="line">    dispatch_resume(timer);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3>å‚è€ƒæ–‡çŒ®</h3>
<ul>
<li>
<p><a href="https://bestswifter.com/deep-gcd/" target="_blank" rel="noopener">æ·±å…¥ç†è§£GCD</a></p>
</li>
<li>
<p><a href="http://blog.devtang.com/2012/02/22/use-gcd/" target="_blank" rel="noopener">ä½¿ç”¨GCD @å”å·§</a></p>
<blockquote>
<p>ç®€å•æè¿°äº† blockã€GCD çš„å‡ ä¸ªæ–¹æ³•ã€‚</p>
</blockquote>
</li>
<li>
<p><a href="https://www.raywenderlich.com/4295/multithreading-and-grand-central-dispatch-on-ios-for-beginners-tutorial" target="_blank" rel="noopener">Ray Wenderlich: iOSç³»ç»Ÿä¸­çš„å¤šçº¿ç¨‹å’ŒGCDçš„åˆå­¦è€…æ•™ç¨‹</a></p>
<blockquote>
<p>Ray Wenderlich ç³»åˆ—çš„æ•™ç¨‹ï¼Œéå¸¸å€¼å¾—ä¸€çœ‹ï¼Œåªä¸è¿‡è¿™ç¯‡æ•™ç¨‹æ˜¯2011å¹´å†™çš„ï¼Œå¹´ä»£æœ‰äº›ä¹…è¿œï¼Œæ•™ç¨‹ä¸­è¿˜ä½¿ç”¨äº† ASIHTTPRequestï¼ˆä¸€ä¸ªå·²ç»åœæ­¢æ›´æ–°çš„ç½‘ç»œåº“ï¼Œç›®å‰æµè¡Œçš„æ˜¯ AFNetworkingï¼‰ï¼Œå‚è€ƒèµ·æ¥æœ‰äº›è´¹è§£ï¼Œæ•™ç¨‹çš„å¤§è‡´å†…å®¹æ€»ç»“å¦‚ä¸‹ï¼š</p>
<p>æ•™ç¨‹è®²è§£äº†ä¸€ä¸ª ImageGrabber åº”ç”¨ï¼Œå®ƒçš„åŠŸèƒ½æ˜¯æ‰“å¼€ HTML ç½‘é¡µï¼Œæ£€ç´¢å¹¶æŠ“å–æ‰€æœ‰å›¾ç‰‡çš„é“¾æ¥ï¼Œç„¶åå°†æ‰€æœ‰æŠ“å–åˆ°çš„å›¾ç‰‡æ˜¾ç¤ºåœ¨åˆ—è¡¨è§†å›¾ä¸Šã€‚å®ƒè¿˜å¯ä»¥ä¸‹è½½ zip æ–‡ä»¶ï¼Œå¹¶æå–å‡º zip æ–‡ä»¶å†…çš„å›¾åƒã€‚</p>
<p>ä½†æ˜¯ï¼Œå¦‚æœåº”ç”¨ç¨‹åºåœ¨ä¸»çº¿ç¨‹ä¸Šæ‰§è¡Œæ‰€æœ‰çš„æ“ä½œï¼šè§£æHTMLã€ä¸‹è½½å›¾ç‰‡ã€ä¸‹è½½å¹¶è§£å‹ zip æ–‡ä»¶ã€éå†å¹¶æå–å‡º zip æ–‡ä»¶ä¸­æ‰€æœ‰å›¾ç‰‡ã€‚è¿™æ ·ä¼šå¯¼è‡´ä¸»çº¿ç¨‹é˜»å¡é€ æˆUIç•Œé¢å¡é¡¿æˆ–è€…æ— æ³•å“åº”ç”¨æˆ·äº¤äº’ï¼Œç”¨æˆ·ä¸å¾—ä¸ç­‰å¾…å¤§é‡çš„æ—¶é—´ï¼Œä¹Ÿä¸çŸ¥é“åº”ç”¨ç¨‹åºæ˜¯å¦ä»ç„¶æ­£å¸¸å·¥ä½œï¼</p>
<p>ä¼˜åŒ–ä¸€ï¼šå¼‚æ­¥ä¸‹è½½ï¼Œå¹¶ä½¿ç”¨ NSNotification é€šçŸ¥æ›´æ–°UIã€‚</p>
<p>ä¼˜åŒ–äºŒï¼šä½¿ç”¨GCDå°†ä¸‹è½½å¹¶è§£å‹ zip æ–‡ä»¶çš„è€—æ—¶ä»»åŠ¡æ”¾åˆ°åå°çº¿ç¨‹æ‰§è¡Œã€‚</p>
<p>ä¸å»ºè®®ï¼šåœ¨ä¸»çº¿ç¨‹ä¸Šæ‰§è¡Œæ‰€æœ‰çš„ä»»åŠ¡ã€‚</p>
<p>æ¨èï¼šæŠŠä¸€ä¸ªè¿›ç¨‹åˆ†è§£æˆå¤šä¸ªçº¿ç¨‹æ‰§è¡Œã€‚ä¸»çº¿ç¨‹ç”¨äºæ›´æ–°UIï¼Œå“åº”ç”¨æˆ·äº‹ä»¶ï¼Œåå°çº¿ç¨‹ç”¨äºæ£€ç´¢HTMLé¡µé¢ã€ä¸‹è½½å¹¶è§£å‹ç¼©æ–‡ä»¶ã€‚</p>
</blockquote>
</li>
<li>
<p><a href="https://github.com/nixzhu/dev-blog/blob/master/2014-04-19-grand-central-dispatch-in-depth-part-1.md" target="_blank" rel="noopener">Ray Wenderlich: GCD æ·±å…¥ç†è§£ï¼šç¬¬ä¸€éƒ¨åˆ†</a></p>
<blockquote>
<p>â­ï¸â­ï¸â­ï¸</p>
</blockquote>
</li>
<li>
<p><a href="https://github.com/nixzhu/dev-blog/blob/master/2014-05-14-grand-central-dispatch-in-depth-part-2.md" target="_blank" rel="noopener">Ray Wenderlich: GCD æ·±å…¥ç†è§£ï¼šç¬¬äºŒéƒ¨åˆ†</a></p>
<blockquote>
<p>â­ï¸â­ï¸â­ï¸</p>
</blockquote>
</li>
<li>
<p><a href="https://www.raywenderlich.com/76341/use-nsoperation-nsoperationqueue-swift" target="_blank" rel="noopener">Ray Wenderlich: NSOperation and NSOperationQueue Tutorial in Swift</a></p>
</li>
<li>
<p><a href="http://blog.leichunfeng.com/blog/2015/07/29/ios-concurrency-programming-operation-queues/" target="_blank" rel="noopener">iOS å¹¶å‘ç¼–ç¨‹ä¹‹ Operation Queues</a></p>
</li>
<li>
<p><a href="http://subscribe.mail.10086.cn/subscribe/readAll.do?columnId=563&amp;itemId=3130310" target="_blank" rel="noopener">ioså¤šçº¿ç¨‹æ“ä½œï¼ˆå…­ï¼‰â€”â€” GCDå…¨å±€é˜Ÿåˆ—ä¸ä¸»é˜Ÿåˆ—</a></p>
<blockquote>
<p>å…¨å±€é˜Ÿåˆ—å‡½æ•°<code>dispatch_get_global_queue()</code>åŠå…¶å‚æ•°ã€‚</p>
</blockquote>
</li>
<li>
<p><a href="https://www.objccn.io/issues/" target="_blank" rel="noopener">Objcä¸­å›½æœŸåˆŠ ç¬¬äºŒæœŸï¼šå¹¶å‘ç¼–ç¨‹</a></p>
<blockquote>
<p>å¹¶å‘ç¼–ç¨‹é¢ä¸´çš„æŒ‘æˆ˜ï¼šèµ„æºå…±äº«å¯¼è‡´çš„ç«æ€æ¡ä»¶ã€äº’æ–¥é”ã€æ­»é”ã€èµ„æºé¥¥é¥¿ã€ä¼˜å…ˆçº§åè½¬ã€‚</p>
<p>æˆ‘ä»¬å»ºè®®é‡‡çº³çš„å®‰å…¨æ¨¡å¼æ˜¯è¿™æ ·çš„ï¼šä»ä¸»çº¿ç¨‹ä¸­æå–å‡ºè¦ä½¿ç”¨åˆ°çš„æ•°æ®ï¼Œå¹¶åˆ©ç”¨ä¸€ä¸ªæ“ä½œé˜Ÿåˆ—åœ¨åå°å¤„ç†ç›¸å…³çš„æ•°æ®ï¼Œæœ€åå›åˆ°ä¸»é˜Ÿåˆ—ä¸­æ¥å‘é€ä½ åœ¨åå°é˜Ÿåˆ—ä¸­å¾—åˆ°çš„ç»“æœã€‚ä½¿ç”¨è¿™ç§æ–¹å¼ï¼Œä½ ä¸éœ€è¦è‡ªå·±åšä»»ä½•é”æ“ä½œï¼Œè¿™ä¹Ÿå°±å¤§å¤§å‡å°‘äº†çŠ¯é”™è¯¯çš„å‡ ç‡ã€‚</p>
<p>Appleæ²¡æœ‰æŠŠ UIKit è®¾è®¡ä¸ºçº¿ç¨‹å®‰å…¨çš„ç±»æ˜¯æœ‰æ„ä¸ºä¹‹çš„ï¼Œå°†å…¶æ‰“é€ ä¸ºçº¿ç¨‹å®‰å…¨çš„è¯ä¼šä½¿å¾ˆå¤šæ“ä½œå˜æ…¢ã€‚è€Œäº‹å®ä¸Š UIKit æ˜¯å’Œä¸»çº¿ç¨‹ç»‘å®šçš„ï¼Œè¿™ä¸€ç‰¹ç‚¹ä½¿å¾—ç¼–å†™å¹¶å‘ç¨‹åºä»¥åŠä½¿ç”¨ UIKit ååˆ†å®¹æ˜“çš„ï¼Œä½ å”¯ä¸€éœ€è¦ç¡®ä¿çš„å°±æ˜¯<strong>å¯¹äº UIKit çš„è°ƒç”¨æ€»æ˜¯åœ¨ä¸»çº¿ç¨‹ä¸­æ¥è¿›è¡Œ</strong>ã€‚</p>
</blockquote>
</li>
<li>
<p><a href="https://developer.apple.com/library/content/documentation/Cocoa/Conceptual/Multithreading/ThreadSafetySummary/ThreadSafetySummary.html#//apple_ref/doc/uid/10000057i-CH12-SW1" target="_blank" rel="noopener">Apple: Threading Programming Guide</a></p>
<blockquote>
<p>è‹¹æœå®˜æ–¹æ–‡æ¡£ï¼Œæè¿°äº†OS X å’Œ iOS ä¸­ä¸€äº›å…³é”®æ¡†æ¶çš„é«˜çº§çº¿ç¨‹å®‰å…¨æ€§ã€‚</p>
</blockquote>
</li>
<li>
<p><a href="http://www.jianshu.com/p/7649fad15cdb" target="_blank" rel="noopener">iOSå¤šçº¿ç¨‹å…¨å¥—ï¼šçº¿ç¨‹ç”Ÿå‘½å‘¨æœŸï¼Œå¤šçº¿ç¨‹çš„å››ç§è§£å†³æ–¹æ¡ˆï¼Œçº¿ç¨‹å®‰å…¨é—®é¢˜ï¼ŒGCDçš„ä½¿ç”¨ï¼ŒNSOperationçš„ä½¿ç”¨</a></p>
</li>
<li>
<p>Matt Galloway. Effective Objective-C 2.0: ç¼–å†™é«˜è´¨é‡ iOS ä¸ OS X ä»£ç çš„52ä¸ªæœ‰æ•ˆæ–¹æ³•[M] .åŒ—äº¬: æœºæ¢°å·¥ä¸šå‡ºç‰ˆç¤¾ï¼Œ2014: 149-180.</p>
<blockquote>
<p><a href="https://www.jianshu.com/p/67492063fd49" target="_blank" rel="noopener">æˆ‘çš„ç¬”è®°</a></p>
<ul>
<li>ç¬¬41æ¡ï¼šå¤šç”¨æ´¾å‘é˜Ÿåˆ—ï¼Œå°‘ç”¨åŒæ­¥é”ã€‚</li>
</ul>
<p>è¿™ä¸€æ¡æ˜¯é’ˆå¯¹è¯»å†™çš„ç«æ€æ¡ä»¶è€Œè¨€çš„ã€‚ä½œè€…æ¨èä½¿ç”¨ GCD æ–¹æ³•ä¸­çš„åŒæ­¥é˜Ÿåˆ—ä»¥åŠæ …æ å—å®ç°åŒæ­¥è¯­ä¹‰ï¼Œè€Œä¸æ˜¯ @synchronized å—æˆ–è€… NSLock å¯¹è±¡ã€‚</p>
<ul>
<li>ç¬¬42æ¡ï¼šå¤šç”¨GCDï¼Œå°‘ç”¨ performSelector ç³»åˆ—æ–¹æ³•ã€‚</li>
</ul>
<p>performSelector ç³»åˆ—æ–¹æ³•æœ¬èº«æœ‰è®¸å¤šä¸è¶³ï¼šå†…å­˜ç®¡ç†æ–¹é¢æœ‰ç–å¿½ã€å¯å¤„ç†çš„æ–¹æ³•ä¹Ÿæœ‰å±€é™ã€‚</p>
<p>performSelector ç³»åˆ—æ–¹æ³•ä¸­æœ‰å»¶åæ‰§è¡Œé€‰æ‹©å­ï¼Œæˆ–è€…å°†å…¶æ”¾åœ¨å¦ä¸€ä¸ªçº¿ç¨‹ä¸Šæ‰§è¡Œçš„æ–¹æ³•ï¼Œè¿™äº›æˆ‘ä»¬éƒ½å¯ä»¥é€šè¿‡ GCD æä¾›çš„æ–¹æ³•æ¥æ›¿æ¢å®ç°ã€‚</p>
<ul>
<li>ç¬¬43æ¡ï¼šæŒæ¡ GCD åŠæ“ä½œé˜Ÿåˆ—çš„ä½¿ç”¨æ—¶æœºã€‚</li>
</ul>
<p>åœ¨è§£å†³å¤šçº¿ç¨‹ä¸ä»»åŠ¡ç®¡ç†é—®é¢˜æ—¶ï¼Œæ´¾å‘é˜Ÿåˆ—å¹¶éå”¯ä¸€æ–¹æ¡ˆã€‚</p>
<p>æ“ä½œé˜Ÿåˆ—æä¾›äº†ä¸€å¥—é«˜å±‚çš„ Objective-C APIï¼Œèƒ½å®ç°çº¯ GCD æ‰€å…·å¤‡çš„ç»å¤§éƒ¨åˆ†åŠŸèƒ½ï¼Œè€Œä¸”è¿˜èƒ½å®Œæˆä¸€äº›æ›´ä¸ºå¤æ‚çš„æ“ä½œï¼Œé‚£äº›æ“ä½œè‹¥æ”¹ç”¨GCDæ¥å®ç°ï¼Œåˆ™éœ€å¦å¤–ç¼–å†™ä»£ç ã€‚</p>
<ul>
<li>ç¬¬44æ¡ï¼šé€šè¿‡ Dispatch Group æœºåˆ¶ï¼Œæ ¹æ®ç³»ç»Ÿèµ„æºçŠ¶å†µæ¥æ‰§è¡Œä»»åŠ¡ã€‚</li>
<li>ç¬¬45æ¡ï¼šä½¿ç”¨ dispatch_once æ¥æ‰§è¡Œåªéœ€è¿è¡Œä¸€æ¬¡çš„çº¿ç¨‹å®‰å…¨ä»£ç ã€‚</li>
</ul>
<p>å•ä¾‹ç±»çš„åˆ›å»ºé—®é¢˜ã€‚</p>
<ul>
<li>ç¬¬46æ¡ï¼šä¸è¦ä½¿ç”¨ dispatch_get_current_queueã€‚</li>
</ul>
<p>dispatch_get_current_queue å‡½æ•°çš„è¡Œä¸ºå¸¸å¸¸ä¸å¼€å‘è€…æ‰€é¢„æœŸçš„ä¸åŒã€‚æ­¤å‡½æ•°å·²åºŸå¼ƒï¼Œåªåº”åšè°ƒè¯•ä¹‹ç”¨ã€‚</p>
<p>ç”±äºæ´¾å‘é˜Ÿåˆ—æ˜¯æŒ‰å±‚çº§æ¥ç»„ç»‡çš„ï¼Œæ‰€ä»¥æ— æ³•å•ç”¨æŸä¸ªé˜Ÿåˆ—å¯¹è±¡æ¥æè¿°å½“å‰é˜Ÿåˆ—è¿™ä¸€æ¦‚å¿µã€‚</p>
<p>dispatch_get_current_queue å‡½æ•°ç”¨äºè§£å†³ç”±ä¸å¯é‡å…¥çš„ä»£ç æ‰€å¼•å‘çš„æ­»é”ï¼Œç„¶è€Œèƒ½ç”¨æ­¤å‡½æ•°è§£å†³çš„é—®é¢˜ï¼Œé€šå¸¸ä¹Ÿèƒ½æ”¹ç”¨â€œé˜Ÿåˆ—ç‰¹å®šæ•°æ®â€æ¥è§£å†³ã€‚</p>
</blockquote>
</li>
<li>
<p>Gaurav Vaish. é«˜æ€§èƒ½ iOS åº”ç”¨å¼€å‘[M] .åŒ—äº¬: äººæ°‘é‚®ç”µå‡ºç‰ˆç¤¾ï¼Œ2017: 89-116.</p>
</li>
</ul>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://andy0570.com/2017/12/22/nullable ä¸ nonnull çš„ä½¿ç”¨/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ç‹¬æœ¨èˆŸçš„æœ¨">
      <meta itemprop="description" content="æœ‰æ—¶å€™é˜³å…‰å¾ˆå¥½ æœ‰æ—¶å€™é˜³å…‰å¾ˆæš—">
      <meta itemprop="image" content="https://blog-andy0570-1256077835.cos.ap-shanghai.myqcloud.com/site_Images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ç‹¬æœ¨èˆŸçš„æœ¨">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2017/12/22/nullable ä¸ nonnull çš„ä½¿ç”¨/" class="post-title-link" itemprop="url">nullable ä¸ nonnull çš„ä½¿ç”¨</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              

              
                
              

              <time title="åˆ›å»ºæ—¶é—´ï¼š2017-12-22 14:25:00" itemprop="dateCreated datePublished" datetime="2017-12-22T14:25:00+08:00">2017-12-22</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">æ›´æ–°äº</span>
                
                <time title="ä¿®æ”¹æ—¶é—´ï¼š2019-05-01 22:11:27" itemprop="dateModified" datetime="2019-05-01T22:11:27+08:00">2019-05-01</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Objective-C-ç¼–ç¨‹/" itemprop="url" rel="index"><span itemprop="name">Objective-C ç¼–ç¨‹</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          

          

          
            <div class="post-symbolscount">
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">æœ¬æ–‡å­—æ•°ï¼š</span>
                
                <span title="æœ¬æ–‡å­—æ•°">2.8k</span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">é˜…è¯»æ—¶é•¿ &asymp;</span>
                
                <span title="é˜…è¯»æ—¶é•¿">3 åˆ†é’Ÿ</span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body han-init-context" itemprop="articleBody">

      
      

      
        
          
            <p><img src="https://blog-andy0570-1256077835.cos.ap-shanghai.myqcloud.com/site_Images/071608.jpg" alt="ç”Ÿå‘½æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿç”Ÿå‘½æ˜¯æ—¶æ—¶åˆ»åˆ»ä¸çŸ¥å¦‚ä½•æ˜¯å¥½ã€‚"></p>
<p>&lt;!-- more --&gt;</p>
<h3>nullable ä¸ nonnull çš„åŒºåˆ«</h3>
<p><code>__nullable</code>:è¡¨ç¤ºå¯¹è±¡å¯ä»¥æ˜¯ NULL æˆ–è€… nilã€‚</p>
<p><code>__nonnull</code>:è¡¨ç¤ºå¯¹è±¡ä¸å¯ä»¥ä¸ºç©ºã€‚</p>
<p><code>__null_unspecified</code>ï¼šè¡¨ç¤ºå¯¹è±¡æœªæŒ‡å®šã€ä¸æ˜ç¡®ã€‚</p>
<p>å¦‚æœæ²¡æœ‰æ˜¾å¼å£°æ˜ï¼Œåˆ™è¡¨ç¤º <code>__nonnull</code> æˆ–è€…<code>_Null_unspecified</code> ï¼ˆä¸æ˜ç¡®ï¼‰</p>
<p>åœ¨ Xcode 7 ä¸­ï¼Œä¸ºäº†é¿å…ä¸ç¬¬ä¸‰æ–¹åº“çš„å†²çªï¼ŒApple æŠŠ <code>__nullable</code>/<code>__nonnull</code> æ”¹æˆäº† <code>_Nullable</code>/<code>_Nonnull</code>ï¼Œä¹Ÿæ”¯æŒæ²¡æœ‰ä¸‹åˆ’çº¿çš„å†™æ³•ï¼š<code>nullable</code>/<code>nonnull</code>ã€‚</p>
<h3>ä½¿ç”¨è§„èŒƒï¼š</h3>
<ol>
<li>å¯¹äºå±æ€§ã€æ–¹æ³•è¿”å›å€¼ã€æ–¹æ³•å‚æ•°çš„ä¿®é¥°ï¼Œä½¿ç”¨ <code>nonnull</code>/<code>nullable</code>ã€‚</li>
<li>å¯¹äº C å‡½æ•°çš„å‚æ•°ã€Blockçš„å‚æ•°ã€Blockè¿”å›å€¼ çš„ä¿®é¥°ï¼Œä½¿ç”¨ <code>_Nonnull</code>/<code>_Nullable</code>,å»ºè®®å¼ƒç”¨ <code>__nonnull</code>/<code>__nullable</code>ã€‚</li>
</ol>
<p>ä¸ºå®‰å…¨èµ·è§ï¼ŒApple åˆ¶å®šçš„ä½¿ç”¨è§„åˆ™ï¼š</p>
<ol>
<li>é€šè¿‡ typedef å®šä¹‰çš„ç±»å‹çš„ nullability ç‰¹æ€§é€šå¸¸ä¾èµ–äºä¸Šä¸‹æ–‡ï¼Œå³ä½¿æ˜¯åœ¨ Audited Regions ä¸­ï¼Œä¹Ÿä¸èƒ½å‡å®šå®ƒä¸º <code>nonnull</code> ï¼›</li>
<li>å¯¹äºå¤æ‚çš„æŒ‡é’ˆç±»å‹ï¼ˆå¦‚ id * ï¼‰å¿…é¡»æ˜¾å¼å»æŒ‡å®šæ˜¯ <code>nonnull</code> è¿˜æ˜¯ <code>nullable</code>ã€‚ä¾‹å¦‚ï¼ŒæŒ‡å®šä¸€ä¸ªæŒ‡å‘ <code>nullable</code> å¯¹è±¡çš„ <code>nonnull</code> æŒ‡é’ˆï¼Œå¯ä»¥ä½¿ç”¨ <code>__nullable id * __nonnul</code>l ï¼›</li>
<li>æˆ‘ä»¬ç»å¸¸ä½¿ç”¨çš„ <code>NSError **</code> é€šå¸¸æ˜¯è¢«å‡å®šä¸ºä¸€ä¸ªæŒ‡å‘ <code>nullable</code> NSError å¯¹è±¡çš„ <code>nullable</code> æŒ‡é’ˆã€‚</li>
</ol>
<h3>ä½¿ç”¨åŒºåˆ«</h3>
<p>å…±æœ‰ä¸‰ç§ç”¨æ³•ï¼š</p>
<ul>
<li><code>nonnull</code>ï¼Œ<code>nullable</code>, <code>null_unspecified</code></li>
<li><code>_Nonnull</code>ï¼Œ<code>_Nullable</code>ï¼Œ<code>_Null_unspecified</code>ï¼Œ</li>
<li><code>__nonnull</code>ï¼Œ<code>__nullable</code>ï¼Œ<code>__null_unspecified</code>ã€‚</li>
</ul>
<p>è¿™å‡ ç§ç”¨æ³•åœ¨å£°æ˜æ—¶çš„ä½ç½®åŒºåˆ«ï¼š</p>
<ol>
<li>å•ä¸‹åˆ’çº¿å’ŒåŒä¸‹åˆ’çº¿çš„éœ€è¦æ”¾åœ¨ç±»å‹å®šä¹‰ä¹‹åã€‚</li>
<li>æ— ä¸‹åˆ’çº¿çš„éœ€è¦æ”¾åœ¨ç±»å‹å®šä¹‰ä¹‹å‰ã€‚</li>
</ol>
<h3>ä½¿ç”¨ç¤ºä¾‹ï¼š</h3>
<h4>å£°æ˜å±æ€§</h4>
<p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">@property (nonatomic, copy, nullable) NSString *name;</span><br><span class="line">@property (nonatomic, copy) NSString *__nullable firstName;</span><br><span class="line">@property (nonatomic, copy) NSString *_Nullable lastName;</span><br></pre></td></tr></table></figure></p>
<h4>ä¿®é¥°æ–¹æ³•è¿”å›å€¼</h4>
<p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">- (nullable NSString *)method1;</span><br><span class="line">- (NSString *__nullable)method2;</span><br><span class="line">- (NSString *_Nullable)method3;</span><br></pre></td></tr></table></figure></p>
<h4>ä¿®é¥°æ–¹æ³•å‚æ•°</h4>
<p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">- (void)methodWithString1:(nullable NSString *)aString;</span><br><span class="line">- (void)methodWithString2:(NSString *__nullable)aString;</span><br><span class="line">- (void)methodWithString3:(NSString *_Nullable)aString;</span><br></pre></td></tr></table></figure></p>
<h4>ä¾‹å¤–æƒ…å†µ</h4>
<p>âš ï¸åŒæŒ‡é’ˆç±»å‹å¯¹è±¡ã€Block çš„è¿”å›å€¼ã€Block çš„ä¼ å…¥å‚æ•°ç­‰ï¼Œä¸èƒ½ç”¨ <code>nonnull</code>/<code>nullable</code> ä¿®é¥°ï¼Œåªèƒ½ç”¨å¸¦ä¸‹åˆ’çº¿çš„ <code>__nonnull</code>/<code>__nullable</code> æˆ–è€… <code>_Nonnull</code>/<code>_Nullable</code>ã€‚</p>
<p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">- (void)methodwithError1:(NSError * _Nullable * __null_unspecified)error;</span><br><span class="line">- (void)methodwithError2:(NSError * nullable * null_unspecified)error;</span><br></pre></td></tr></table></figure></p>
<h4>Block è¿”å›å€¼</h4>
<p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">- (void)methodWithBlock1:(nullable void(^)(void))block;</span><br><span class="line">// âš ï¸ ä»¥ä¸Š nullable ä¿®é¥°çš„æ˜¯æ–¹æ³•ä¼ å…¥å‚æ•°ï¼Œè¡¨ç¤ºä¼ å…¥çš„ Block å¯ä»¥ä¸ºç©ºï¼Œè€Œä¸æ˜¯ä¿®é¥° BlocK è¿”å›å€¼ã€‚</span><br><span class="line"></span><br><span class="line">- (void)methodWithBlock2:(void (^ _Nullable)(void))block;</span><br><span class="line">- (void)methodWithBlock3:(void (^ __nullable)(void))block;</span><br></pre></td></tr></table></figure></p>
<h4>Block ä¼ å…¥å‚æ•°</h4>
<p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">- (void)methodWithBlock21:(nullable id nonnull(^)(id nullable parameters))block;</span><br><span class="line">// âš ï¸ ä»¥ä¸Š nullable ä¿®é¥°çš„æ˜¯æ–¹æ³•ä¼ å…¥å‚æ•°ï¼Œè¡¨ç¤ºä¼ å…¥çš„ BlocK å¯ä»¥ä¸ºç©ºã€‚è€Œ __nonnull ç”¨äºä¿®é¥° Block è¿”å›å€¼ id ä¸èƒ½ä¸ºç©ºã€‚</span><br><span class="line"></span><br><span class="line">- (void)methodWithBlock22:(id  nonnull(^ nullable)(id _Nullable parameters))block;</span><br><span class="line">- (void)methodWithBlock23:(id  _Nonnull (^ _Nonnull)(id _Nullable parameters))block;</span><br></pre></td></tr></table></figure></p>
<h3>å® NS_ASSUME_NONNULL_BEGIN ä¸ NS_ASSUME_NONNULL_END</h3>
<p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">#import &lt;Foundation/Foundation.h&gt;</span><br><span class="line"></span><br><span class="line">// åœ¨è¿™ä¸¤ä¸ªå®ä¹‹é—´çš„ä»£ç ï¼Œæ‰€æœ‰ç®€å•æŒ‡é’ˆå¯¹è±¡éƒ½è¢«å‡å®šä¸º nonnull ï¼Œå› æ­¤æˆ‘ä»¬åªéœ€è¦å»æŒ‡å®šé‚£äº› nullable æŒ‡é’ˆå¯¹è±¡å³å¯ã€‚</span><br><span class="line">NS_ASSUME_NONNULL_BEGIN</span><br><span class="line"></span><br><span class="line">@interface MyObject : NSObject</span><br><span class="line"></span><br><span class="line">// é»˜è®¤ä¸º nonnull</span><br><span class="line">@property (nonatomic, copy) NSString *aString;</span><br><span class="line"></span><br><span class="line">// æ–¹æ³•è¿”å›å€¼é»˜è®¤ä¸º nonnull</span><br><span class="line">// æ–¹æ³•çš„å‚æ•°æ˜¾å¼å£°æ˜ä¸º nullabel,è¡¨ç¤ºå…¥å‚å¯ä»¥ä¸ºç©º</span><br><span class="line">- (id)methodWithString:(nullable NSString *)string;</span><br><span class="line"></span><br><span class="line">@end</span><br><span class="line"></span><br><span class="line">NS_ASSUME_NONNULL_END</span><br></pre></td></tr></table></figure></p>
<h3>å‚è€ƒ</h3>
<ul>
<li><a href="https://developer.apple.com/swift/blog/?id=25" target="_blank" rel="noopener">Apple Blog:Nullability and Objective-C</a></li>
<li><a href="https://stackoverflow.com/questions/32452889/difference-between-nullable-nullable-and-nullable-in-objective-c" target="_blank" rel="noopener">Difference between nullable, __nullable and _Nullable in Objective-C</a></li>
<li><a href="http://nshipster.cn/nil/" target="_blank" rel="noopener">nshipster: nil / Nil / NULL / NSNull</a></li>
</ul>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://andy0570.com/2017/12/22/ã€ŠObjective-C ç¼–ç¨‹ã€‹19.@property/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ç‹¬æœ¨èˆŸçš„æœ¨">
      <meta itemprop="description" content="æœ‰æ—¶å€™é˜³å…‰å¾ˆå¥½ æœ‰æ—¶å€™é˜³å…‰å¾ˆæš—">
      <meta itemprop="image" content="https://blog-andy0570-1256077835.cos.ap-shanghai.myqcloud.com/site_Images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ç‹¬æœ¨èˆŸçš„æœ¨">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2017/12/22/ã€ŠObjective-C ç¼–ç¨‹ã€‹19.@property/" class="post-title-link" itemprop="url">ã€ŠObjective-C ç¼–ç¨‹ã€‹19.@property</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              

              
                
              

              <time title="åˆ›å»ºæ—¶é—´ï¼š2017-12-22 10:55:00" itemprop="dateCreated datePublished" datetime="2017-12-22T10:55:00+08:00">2017-12-22</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">æ›´æ–°äº</span>
                
                <time title="ä¿®æ”¹æ—¶é—´ï¼š2019-05-01 21:16:06" itemprop="dateModified" datetime="2019-05-01T21:16:06+08:00">2019-05-01</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Objective-C-ç¼–ç¨‹/" itemprop="url" rel="index"><span itemprop="name">Objective-C ç¼–ç¨‹</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          

          

          
            <div class="post-symbolscount">
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">æœ¬æ–‡å­—æ•°ï¼š</span>
                
                <span title="æœ¬æ–‡å­—æ•°">1.8k</span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">é˜…è¯»æ—¶é•¿ &asymp;</span>
                
                <span title="é˜…è¯»æ—¶é•¿">2 åˆ†é’Ÿ</span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body han-init-context" itemprop="articleBody">

      
      

      
        
          
            <h1>å±æ€§</h1>
<h4>@property</h4>
<ul>
<li>å°½ç®¡å¯ä»¥ä½¿ç”¨obj-&gt;arrçš„å½¢å¼å»å¼ºåˆ¶è¯»å–å¯¹è±¡çš„æˆå‘˜å˜é‡ï¼Œä½†æ˜¯è‰¯å¥½çš„ç¼–ç¨‹å½¢å¼æ˜¯å¯¹å¤–ç•Œæä¾›æˆå‘˜å˜é‡çš„è¯»å†™æ¥å£ã€‚<strong>@property</strong> å…³é”®å­—æä¾›äº†å¤–ç•Œå¯¹æˆå‘˜å˜é‡çš„è®¿é—®æ¥å£ï¼Œ<strong>å…¶æœ¬è´¨æ˜¯è‡ªåŠ¨ä¸ºæŸä¸€ä¸ªå±æ€§ç”Ÿæˆsetå’Œgetæ–¹æ³•</strong>ã€‚</li>
<li>æ ¹æ®ä¸åŒçš„éœ€è¦ï¼Œå¯ä»¥æ·»åŠ  <strong>readonly</strong>ï¼ˆåªè¯»ï¼Œç›¸å½“äºåªæ·»åŠ getä¸æ·»åŠ setæ–¹æ³•ï¼‰æˆ–è€… <strong>readwrite</strong>ï¼ˆè¯»å†™ï¼Œå¦‚æœä¸æ·»åŠ åˆ™ä¸ºé»˜è®¤ï¼‰ï¼›</li>
<li>è¿˜æœ‰ä¸‰ç§èµ‹å€¼æ–¹å¼å¯é€‰ ï¼š<strong>assign</strong>ï¼ˆç›´æ¥èµ‹å€¼ï¼Œé€šå¸¸ç”¨äºåŸºæœ¬ç±»å‹ï¼‰ï¼Œ<strong>retain</strong>ï¼ˆé‡Šæ”¾æ—§å€¼ï¼Œå¢åŠ æ–°çš„retaincountï¼‰ï¼Œ<strong>copy</strong>ï¼ˆå¸¸ç”¨äºå­—ç¬¦ä¸²ï¼Œç”Ÿæˆä¸€ä¸ªæ–°çš„æ‹·è´ï¼‰.</li>
<li><strong>propertyçš„å±æ€§ç‰¹æ€§åªå¯¹setteræ–¹æ³•æœ‰æ•ˆï¼Œå¯¹getteræ–¹æ³•æ— æ•ˆ</strong></li>
</ul>
<p><strong>æ ¼å¼</strong>ï¼š</p>
<p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">@property (åŸå­æ€§Â©,å†…å­˜ç®¡ç†Â©,è¯»å†™æ€§Â©) NSString *string;</span><br></pre></td></tr></table></figure></p>
<p>&lt;!-- more --&gt;</p>
<h1>å±æ€§ç‰¹å¾</h1>
<ol>
<li>
<p>åŸå­æ€§</p>
<ul>
<li>
<p><strong>atomic</strong>(é»˜è®¤)ï¼šåŸå­æ€§</p>
<blockquote>
<p><strong>atomic</strong> æ„ä¸ºæ“ä½œæ˜¯åŸå­çš„ï¼Œæ„å‘³ç€åªæœ‰ä¸€ä¸ªçº¿ç¨‹è®¿é—®å®ä¾‹å˜é‡ã€‚atomicæ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œè‡³å°‘åœ¨å½“å‰çš„å­˜å–å™¨ä¸Šæ˜¯å®‰å…¨çš„ã€‚å®ƒæ˜¯ä¸€ä¸ªé»˜è®¤çš„ç‰¹æ€§ï¼Œä½†æ˜¯å¾ˆå°‘ä½¿ç”¨ï¼Œå› ä¸ºæ¯”è¾ƒå½±å“æ•ˆç‡ï¼Œè¿™è·ŸARMå¹³å°å’Œå†…éƒ¨é”æœºåˆ¶æœ‰å…³ã€‚</p>
</blockquote>
</li>
<li>
<p><strong>nonatomic</strong>ï¼š éåŸå­æ€§</p>
<blockquote>
<p><strong>nonatomic</strong> è·Ÿ <strong>atomic</strong> åˆšå¥½ç›¸åã€‚è¡¨ç¤ºéåŸå­çš„ï¼Œå¯ä»¥è¢«å¤šä¸ªçº¿ç¨‹è®¿é—®ã€‚å®ƒçš„æ•ˆç‡æ¯”atomicå¿«ã€‚ä½†ä¸èƒ½ä¿è¯åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹çš„å®‰å…¨æ€§ï¼Œåœ¨å•çº¿ç¨‹å’Œæ˜ç¡®åªæœ‰ä¸€ä¸ªçº¿ç¨‹è®¿é—®çš„æƒ…å†µä¸‹å¹¿æ³›ä½¿ç”¨ã€‚</p>
</blockquote>
</li>
</ul>
</li>
<li>
<p>å†…å­˜ç®¡ç†</p>
<ul>
<li>
<p><strong>assign</strong>ï¼ˆé»˜è®¤ï¼‰ï¼šå¯¹è±¡ä¹‹å¤–çš„ç±»å‹ä½¿ç”¨ï¼Œä¸€èˆ¬ç”¨æ¥ä¿®é¥°åŸºç¡€æ•°æ®ç±»å‹)ï¼›</p>
<blockquote>
<p>1âƒ£ï¸ ç”¨äºä¿®é¥°å€¼ç±»å‹ï¼ˆåŸºæœ¬æ•°æ®ç±»å‹ï¼‰ï¼Œå¦‚ï¼šintï¼Œfloatï¼Œdoubleï¼ŒCGFloatï¼Œ<strong>NSInteger</strong> ç­‰ã€‚è¿˜åŒ…æ‹¬ä¸å­˜åœ¨æ‰€æœ‰æƒå…³ç³»çš„å¯¹è±¡ï¼Œå¦‚ï¼š<strong>delegate</strong>ã€‚</p>
<p>ç›¸å¯¹äº <strong>assign</strong> ï¼Œæˆ‘ä»¬ä¸€èˆ¬ä½¿ç”¨ <strong>weak</strong> æ¥ä¿®é¥° <strong>delegate</strong>ï¼Œä¼šæ›´åŠ å®‰å…¨ã€‚</p>
</blockquote>
<blockquote>
<p>2âƒ£ï¸ assign ä¿®é¥°çš„å±æ€§ä¸ç‰µæ¶‰å†…å­˜ç®¡ç†ï¼Œä¸ä¼šè¢«å¼•ç”¨è®¡æ•°å™¨ç®¡ç†ã€‚</p>
</blockquote>
</li>
<li>
<p><strong>retain</strong>ï¼šä¿ç•™å¯¹è±¡ï¼›ï¼ˆæ‰€æœ‰çš„å¯¹è±¡ï¼Œéƒ½ä½¿ç”¨retainï¼‰</p>
<blockquote>
<p>åœ¨<code>setter</code>æ–¹æ³•ä¸­ï¼Œéœ€è¦å¯¹ä¼ å…¥çš„å¯¹è±¡è¿›è¡Œå¼•ç”¨è®¡æ•°åŠ 1çš„æ“ä½œã€‚
ç®€å•æ¥è¯´ï¼Œå°±æ˜¯å¯¹ä¼ å…¥çš„å¯¹è±¡æ‹¥æœ‰æ‰€æœ‰æƒï¼Œåªè¦å¯¹è¯¥å¯¹è±¡æ‹¥æœ‰æ‰€æœ‰æƒï¼Œè¯¥å¯¹è±¡å°±ä¸ä¼šè¢«é‡Šæ”¾ã€‚</p>
</blockquote>
</li>
<li>
<p><strong>copy</strong>ï¼šæ‹·è´å¯¹è±¡ï¼›<strong>NSString</strong>ï¼<strong>NSArray</strong> çš„å¯¹è±¡éƒ½ä½¿ç”¨<strong>copy</strong>å±æ€§ï¼›</p>
</li>
<li>
<p><strong>strong</strong>ï¼šå¼ºå¼•ç”¨</p>
<blockquote>
<p><strong>strong</strong> æ˜¯åœ¨IOSå¼•å…¥ARCçš„æ—¶å€™å¼•å…¥çš„å…³é”®å­—ï¼Œæ˜¯retainçš„ä¸€ä¸ªå¯é€‰çš„æ›¿ä»£ã€‚è¡¨ç¤ºå®ä¾‹å˜é‡å¯¹ä¼ å…¥çš„å¯¹è±¡è¦æœ‰æ‰€æœ‰æƒå…³ç³»ï¼Œå³å¼ºå¼•ç”¨ã€‚strongè·Ÿretainçš„æ„æ€ç›¸åŒå¹¶äº§ç”Ÿç›¸åŒçš„ä»£ç ï¼Œä½†æ˜¯è¯­æ„ä¸Šæ›´å¥½æ›´èƒ½ä½“ç°å¯¹è±¡çš„å…³ç³»ã€‚</p>
</blockquote>
</li>
<li>
<p><strong>weak</strong>ï¼šå¼±å¼•ç”¨ï¼Œä¸€èˆ¬ç”¨æ¥ä¿®é¥°å¯¹è±¡ã€‚</p>
<blockquote>
<p>é’ˆå¯¹å¯¹è±¡ç±»å‹ï¼Œåœ¨setteræ–¹æ³•ä¸­ï¼Œä¸ä¼šå¯¹ä¼ å…¥çš„å¯¹è±¡æ‰§è¡Œå¼•ç”¨è®¡æ•°å™¨+1çš„æ“ä½œã€‚ä¹Ÿå°±æ˜¯å¯¹ä¼ å…¥çš„å¯¹è±¡æ²¡æœ‰æ‰€æœ‰æƒï¼Œæ˜¯å¼±å¼•ç”¨ã€‚å¦å¤–å½“ä¼ å…¥çš„å¯¹è±¡å¼•ç”¨è®¡æ•°å™¨ä¸º0ï¼Œä¹Ÿå°±æ˜¯è¢«é‡Šæ”¾åï¼Œç”¨weakå£°æ˜çš„å®ä¾‹å˜é‡ä¼šæŒ‡å‘nilï¼Œå³ç©ºå¯¹è±¡ã€‚</p>
</blockquote>
</li>
<li>
<p><strong>unsafe_unretained:</strong></p>
<blockquote>
<p>1âƒ£ï¸ ä»å­—é¢ä¸Šæ¥çœ‹ï¼Œæˆ‘ä»¬å¯ä»¥æ‹†åˆ†æˆä¸¤éƒ¨åˆ†æ¥ç†è§£ï¼Œunretainedå’Œretainç›¸åï¼Œä¹Ÿå°±æ˜¯å’Œstrongç›¸åï¼Œå› æ­¤ç­‰åŒäºweakï¼Œå…¶å®ä¹Ÿæ˜¯ç”¨åœ¨iOS5ä¹‹å‰æ›¿ä»£weakä½¿ç”¨çš„ã€‚</p>
<p>2âƒ£ï¸ unsafeï¼Œä¸å®‰å…¨çš„ï¼Œå¦‚ä¸Šæ‰€è¿°ç­‰åŒäºweakçš„è¯é‚£åº”è¯¥æ˜¯å®‰å…¨çš„ï¼Œè¿™é‡Œä¸å®‰å…¨çš„æ˜¯æŒ‡å½“ä¼ å…¥çš„å¯¹è±¡è¢«é‡Šæ”¾åï¼Œä½¿ç”¨unsafe_unretainedä¿®é¥°çš„å˜é‡æ˜¯ä¸çŸ¥é“çš„ï¼Œä¹Ÿä¸ä¼šåƒweakä¸€æ ·æŒ‡å‘nilï¼Œæ‰€ä»¥æ­¤æ—¶è®¿é—®å¯èƒ½ä¼šå¼•èµ·crashã€‚å› æ­¤ï¼Œæ€»ç»“æ¥è¯´unsafe_unretainedä½œç”¨æ˜¯ç­‰åŒäºweakï¼Œä½†æ˜¯æ˜¯ä¸å®‰å…¨çš„ã€‚</p>
</blockquote>
</li>
</ul>
</li>
<li>
<p>è¯»å†™æ€§</p>
<ul>
<li>
<p><strong>readwrite</strong>ï¼ˆé»˜è®¤ï¼‰ï¼š</p>
<blockquote>
<p><code>readwrite</code>æ˜¯é»˜è®¤å€¼ï¼Œè¡¨ç¤ºè¯¥å±æ€§åŒæ—¶æ‹¥æœ‰<code>setter</code>å’Œ<code>getter</code>ã€‚</p>
</blockquote>
</li>
<li>
<p><strong>readonly</strong>ï¼šåªè¯»</p>
<blockquote>
<p><code>readonly</code>è¡¨ç¤ºåªæœ‰<code>getter</code>æ²¡æœ‰<code>setter</code>ã€‚</p>
</blockquote>
</li>
</ul>
</li>
</ol>
<h3>å‚è€ƒæ–‡ç« </h3>
<ul>
<li><a href="http://www.jianshu.com/p/74af03847e74" target="_blank" rel="noopener">æˆ‘æ‰€ç†è§£çš„å†…å­˜ç®¡ç†ï¼š4ã€propertyç›¸å…³ @æ¨æ·³å¼•</a></li>
<li><a href="http://www.jianshu.com/p/14552b4946c5" target="_blank" rel="noopener">ç†è§£@propertyä½¿ç”¨çš„å…³é”®å­— @MrLeoZou</a></li>
<li><a href="http://www.devtalking.com/articles/you-should-to-know-property/" target="_blank" rel="noopener">Objective-Cä¸­çš„@property @ç¨‹åºå‘˜è¯´</a></li>
<li><a href="https://segmentfault.com/a/1190000004943276" target="_blank" rel="noopener">Objective-C å†…å­˜ç®¡ç†â€”â€”ä½ éœ€è¦çŸ¥é“çš„ä¸€åˆ‡</a></li>
<li><a href="http://blog.devtang.com/2016/07/30/ios-memory-management/" target="_blank" rel="noopener">ç†è§£ iOS çš„å†…å­˜ç®¡ç† @å”å·§</a></li>
</ul>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://andy0570.com/2017/12/20/AFNetworkingâ€”â€”ä¼˜é›…çš„ç½‘ç»œæ¡†æ¶/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ç‹¬æœ¨èˆŸçš„æœ¨">
      <meta itemprop="description" content="æœ‰æ—¶å€™é˜³å…‰å¾ˆå¥½ æœ‰æ—¶å€™é˜³å…‰å¾ˆæš—">
      <meta itemprop="image" content="https://blog-andy0570-1256077835.cos.ap-shanghai.myqcloud.com/site_Images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ç‹¬æœ¨èˆŸçš„æœ¨">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2017/12/20/AFNetworkingâ€”â€”ä¼˜é›…çš„ç½‘ç»œæ¡†æ¶/" class="post-title-link" itemprop="url">AFNetworkingâ€”â€”ä¼˜é›…çš„ç½‘ç»œæ¡†æ¶</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              

              
                
              

              <time title="åˆ›å»ºæ—¶é—´ï¼š2017-12-20 17:06:00" itemprop="dateCreated datePublished" datetime="2017-12-20T17:06:00+08:00">2017-12-20</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">æ›´æ–°äº</span>
                
                <time title="ä¿®æ”¹æ—¶é—´ï¼š2019-05-01 21:33:12" itemprop="dateModified" datetime="2019-05-01T21:33:12+08:00">2019-05-01</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/iOS-å¼€æºæ¡†æ¶/" itemprop="url" rel="index"><span itemprop="name">iOS å¼€æºæ¡†æ¶</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          

          

          
            <div class="post-symbolscount">
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">æœ¬æ–‡å­—æ•°ï¼š</span>
                
                <span title="æœ¬æ–‡å­—æ•°">18k</span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">é˜…è¯»æ—¶é•¿ &asymp;</span>
                
                <span title="é˜…è¯»æ—¶é•¿">17 åˆ†é’Ÿ</span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body han-init-context" itemprop="articleBody">

      
      

      
        
          
            <ul>
<li>GitHubæºç :<a href="https://github.com/AFNetworking/AFNetworking" target="_blank" rel="noopener">AFNetworking</a></li>
<li>star:30000+</li>
</ul>
<h1>READMEæ–‡æ¡£</h1>
<p><img src="https://blog-andy0570-1256077835.cos.ap-shanghai.myqcloud.com/site_Images/072544.jpg" alt>
AFNetworking æ˜¯ä¸€ä¸ªé€‚ç”¨äº iOS ç³»ç»Ÿå’Œ Mac OS X ç³»ç»Ÿçš„ç½‘ç»œæ¡†æ¶ã€‚å®ƒå»ºç«‹åœ¨ <a href="http://developer.apple.com/library/mac/#documentation/Cocoa/Conceptual/URLLoadingSystem/URLLoadingSystem.html" target="_blank" rel="noopener">Foundation URL Loading System</a> ä¹‹ä¸Šï¼Œæ‰©å±•äº† Cocoa å¼ºå¤§çš„é«˜çº§ç½‘ç»œæŠ½è±¡ã€‚è®¾è®¡ç²¾è‰¯çš„æ¨¡å—åŒ–æ¶æ„ã€åŠŸèƒ½ä¸°å¯Œçš„ APIï¼Œè®©ä½ èƒ½å¤Ÿå®‰å¿ƒçš„ä½¿ç”¨ï¼Œè½»æ¾å®ç°å„ç§ç½‘ç»œè¯·æ±‚ï¼Œæ¯”å¦‚ GET è¯·æ±‚ï¼ŒPOST è¯·æ±‚ï¼Œä»¥åŠä¸Šä¼ å¤šå¼ å›¾ç‰‡ç­‰ã€‚</p>
<p>&lt;!-- more --&gt;</p>
<h2>å¦‚ä½•å¼€å§‹</h2>
<ul>
<li><a href="https://github.com/AFNetworking/AFNetworking/archive/master.zip" target="_blank" rel="noopener">Download AFNetworking</a> and try out the included Mac and iPhone example apps</li>
<li>Read the <a href="https://github.com/AFNetworking/AFNetworking/wiki/Getting-Started-with-AFNetworking" target="_blank" rel="noopener">&quot;Getting Started&quot; guide</a>, <a href="https://github.com/AFNetworking/AFNetworking/wiki/AFNetworking-FAQ" target="_blank" rel="noopener">FAQ</a>, or <a href="https://github.com/AFNetworking/AFNetworking/wiki" target="_blank" rel="noopener">other articles on the Wiki</a></li>
<li>Check out the <a href="http://cocoadocs.org/docsets/AFNetworking/" target="_blank" rel="noopener">documentation</a> for a comprehensive look at all of the APIs available in AFNetworking</li>
<li>Read the <a href="https://github.com/AFNetworking/AFNetworking/wiki/AFNetworking-3.0-Migration-Guide" target="_blank" rel="noopener">AFNetworking 3.0 Migration Guide</a> for an overview of the architectural changes from 2.0.</li>
</ul>
<h2>è®¨è®º</h2>
<ul>
<li>If you <strong>need help</strong>, use <a href="http://stackoverflow.com/questions/tagged/afnetworking" target="_blank" rel="noopener">Stack Overflow</a>. (Tag 'afnetworking')</li>
<li>If you'd like to <strong>ask a general question</strong>, use <a href="http://stackoverflow.com/questions/tagged/afnetworking" target="_blank" rel="noopener">Stack Overflow</a>.</li>
<li>If you <strong>found a bug</strong>, <em>and can provide steps to reliably reproduce it</em>, open an issue.</li>
<li>If you <strong>have a feature request</strong>, open an issue.</li>
<li>If you <strong>want to contribute</strong>, submit a pull request.</li>
</ul>
<h2>å®‰è£…</h2>
<p>AFNetworking æ”¯æŒåœ¨é¡¹ç›®ä¸­å®‰è£…åº“çš„å¤šç§æ–¹æ³•ã€‚</p>
<h2>CocoaPods å®‰è£…</h2>
<p><a href="http://cocoapods.org" target="_blank" rel="noopener">CocoaPods</a> is a dependency manager for Objective-C, which automates and simplifies the process of using 3rd-party libraries like AFNetworking in your projects. See the <a href="https://github.com/AFNetworking/AFNetworking/wiki/Getting-Started-with-AFNetworking" target="_blank" rel="noopener">&quot;Getting Started&quot; guide for more information</a>. You can install it with the following command:</p>
<p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ gem install cocoapods</span><br></pre></td></tr></table></figure></p>
<blockquote>
<p>CocoaPods 0.39.0+ is required to build AFNetworking 3.0.0+.</p>
</blockquote>
<h4>é…ç½®</h4>
<p>To integrate AFNetworking into your Xcode project using CocoaPods, specify it in your <code>Podfile</code>:</p>
<p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">source <span class="string">'https://github.com/CocoaPods/Specs.git'</span></span><br><span class="line">platform <span class="symbol">:ios</span>, <span class="string">'8.0'</span></span><br><span class="line"></span><br><span class="line">target <span class="string">'TargetName'</span> <span class="keyword">do</span></span><br><span class="line">pod <span class="string">'AFNetworking'</span>, <span class="string">'~&gt; 3.0'</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure></p>
<p>Then, run the following command:</p>
<p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ pod install</span><br></pre></td></tr></table></figure></p>
<h3>Carthage å®‰è£…</h3>
<p><a href="https://github.com/Carthage/Carthage" target="_blank" rel="noopener">Carthage</a> is a decentralized dependency manager that builds your dependencies and provides you with binary frameworks.</p>
<p>You can install Carthage with <a href="http://brew.sh/" target="_blank" rel="noopener">Homebrew</a> using the following command:</p>
<p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ brew update</span><br><span class="line">$ brew install carthage</span><br></pre></td></tr></table></figure></p>
<p>To integrate AFNetworking into your Xcode project using Carthage, specify it in your <code>Cartfile</code>:</p>
<p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">github &quot;AFNetworking/AFNetworking&quot; ~&gt; 3.0</span><br></pre></td></tr></table></figure></p>
<p>Run <code>carthage</code> to build the framework and drag the built <code>AFNetworking.framework</code> into your Xcode project.</p>
<h2>ç‰ˆæœ¬è¦æ±‚</h2>
<table>
<thead>
<tr>
<th style="text-align:center">AFNetworking Version</th>
<th style="text-align:center">Minimum iOS Target</th>
<th style="text-align:center">Minimum OS X Target</th>
<th style="text-align:center">Minimum watchOS Target</th>
<th style="text-align:center">Minimum tvOS Target</th>
<th style="text-align:center">Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">3.x</td>
<td style="text-align:center">iOS 7</td>
<td style="text-align:center">OS X 10.9</td>
<td style="text-align:center">watchOS 2.0</td>
<td style="text-align:center">tvOS 9.0</td>
<td style="text-align:center">Xcode 7+ is required. <code>NSURLConnectionOperation</code> support has been removed.</td>
</tr>
<tr>
<td style="text-align:center">2.6 -&gt; 2.6.3</td>
<td style="text-align:center">iOS 7</td>
<td style="text-align:center">OS X 10.9</td>
<td style="text-align:center">watchOS 2.0</td>
<td style="text-align:center">n/a</td>
<td style="text-align:center">Xcode 7+ is required.</td>
</tr>
<tr>
<td style="text-align:center">2.0 -&gt; 2.5.4</td>
<td style="text-align:center">iOS 6</td>
<td style="text-align:center">OS X 10.8</td>
<td style="text-align:center">n/a</td>
<td style="text-align:center">n/a</td>
<td style="text-align:center">Xcode 5+ is required. <code>NSURLSession</code> subspec requires iOS 7 or OS X 10.9.</td>
</tr>
<tr>
<td style="text-align:center">1.x</td>
<td style="text-align:center">iOS 5</td>
<td style="text-align:center">Mac OS X 10.7</td>
<td style="text-align:center">n/a</td>
<td style="text-align:center">n/a</td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:center">0.10.x</td>
<td style="text-align:center">iOS 4</td>
<td style="text-align:center">Mac OS X 10.6</td>
<td style="text-align:center">n/a</td>
<td style="text-align:center">n/a</td>
<td style="text-align:center"></td>
</tr>
</tbody>
</table>
<p>(OS X projects must support <a href="https://developer.apple.com/library/mac/#documentation/Cocoa/Conceptual/ObjCRuntimeGuide/Articles/ocrtVersionsPlatforms.html" target="_blank" rel="noopener">64-bit with modern Cocoa runtime</a>).</p>
<blockquote>
<p>Programming in Swift? Try <a href="https://github.com/Alamofire/Alamofire" target="_blank" rel="noopener">Alamofire</a> for a more conventional set of APIs.</p>
</blockquote>
<h2>ç»“æ„</h2>
<h3>NSURLSession</h3>
<ul>
<li><code>AFURLSessionManager</code></li>
<li><code>AFHTTPSessionManager</code></li>
</ul>
<h3>åºåˆ—åŒ–</h3>
<ul>
<li><code>&lt;AFURLRequestSerialization&gt;</code> è¯·æ±‚åºåˆ—åŒ–
<ul>
<li><code>AFHTTPRequestSerializer</code></li>
<li><code>AFJSONRequestSerializer</code></li>
<li><code>AFPropertyListRequestSerializer</code></li>
</ul>
</li>
<li><code>&lt;AFURLResponseSerialization&gt;</code> å“åº”åºåˆ—åŒ–
<ul>
<li><code>AFHTTPResponseSerializer</code></li>
<li><code>AFJSONResponseSerializer</code></li>
<li><code>AFXMLParserResponseSerializer</code></li>
<li><code>AFXMLDocumentResponseSerializer</code> <em>(Mac OS X)</em></li>
<li><code>AFPropertyListResponseSerializer</code></li>
<li><code>AFImageResponseSerializer</code></li>
<li><code>AFCompoundResponseSerializer</code></li>
</ul>
</li>
</ul>
<h3>å…¶ä»–åŠŸèƒ½</h3>
<ul>
<li><code>AFSecurityPolicy</code></li>
<li><code>AFNetworkReachabilityManager</code></li>
</ul>
<h4>ç»“æ„å›¾</h4>
<p><img src="https://blog-andy0570-1256077835.cos.ap-shanghai.myqcloud.com/site_Images/072545.jpg" alt="006tKfTcly1fj0ndu06qaj307f0bqmye.jpg"></p>
<h2>ç”¨æ³•</h2>
<h3>ä¸€ã€AFURLSessionManager</h3>
<ul>
<li><code>AFURLSessionManager</code> åˆ›å»ºå¹¶ç®¡ç† <code>NSURLSession</code> å¯¹è±¡ã€‚</li>
<li><code>NSURLSession</code> å¯¹è±¡åŸºäºæŒ‡å®šçš„ <code>NSURLSessionConfiguration</code> å¯¹è±¡ã€‚</li>
<li><code>NSURLSessionConfiguration</code> å¯¹è±¡éµå®ˆå¦‚ä¸‹åè®®ï¼š <code>&lt;NSURLSessionTaskDelegate&gt;</code>, <code>&lt;NSURLSessionDataDelegate&gt;</code>, <code>&lt;NSURLSessionDownloadDelegate&gt;</code>, å’Œ <code>&lt;NSURLSessionDelegate&gt;</code> ã€‚</li>
</ul>
<h4>NSURLSessionTask</h4>
<p><img src="https://blog-andy0570-1256077835.cos.ap-shanghai.myqcloud.com/site_Images/072547.jpg" alt></p>
<h4>NSURLSessionDelegate å§”æ‰˜åè®®</h4>
<p><img src="https://blog-andy0570-1256077835.cos.ap-shanghai.myqcloud.com/site_Images/072547-1.jpg" alt></p>
<h4>1.åˆ›å»ºä¸‹è½½ä»»åŠ¡</h4>
<p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">// 1.åˆ›å»º NSURLSessionConfiguration å¯¹è±¡</span><br><span class="line">NSURLSessionConfiguration *configuration = [NSURLSessionConfiguration defaultSessionConfiguration];</span><br><span class="line"></span><br><span class="line">// 2.åˆ›å»º AFURLSessionManager å¯¹è±¡</span><br><span class="line">AFURLSessionManager *manager = [[AFURLSessionManager alloc] initWithSessionConfiguration:configuration];</span><br><span class="line"></span><br><span class="line">// 3.åˆ›å»º NSURLã€NSURLRequest å¯¹è±¡</span><br><span class="line">NSURL *URL = [NSURL URLWithString:@&quot;http://example.com/download.zip&quot;];</span><br><span class="line">NSURLRequest *request = [NSURLRequest requestWithURL:URL];</span><br><span class="line"></span><br><span class="line">// 4.åˆ›å»º NSURLSessionDownloadTask å¯¹è±¡</span><br><span class="line">NSURLSessionDownloadTask *downloadTask = [manager downloadTaskWithRequest:request progress:nil destination:^NSURL *(NSURL *targetPath, NSURLResponse *response) &#123;</span><br><span class="line">    NSURL *documentsDirectoryURL = [[NSFileManager defaultManager] URLForDirectory:NSDocumentDirectory inDomain:NSUserDomainMask appropriateForURL:nil create:NO error:nil];</span><br><span class="line">    return [documentsDirectoryURL URLByAppendingPathComponent:[response suggestedFilename]];</span><br><span class="line">&#125; completionHandler:^(NSURLResponse *response, NSURL *filePath, NSError *error) &#123;</span><br><span class="line">    NSLog(@&quot;File downloaded to: %@&quot;, filePath);</span><br><span class="line">&#125;];</span><br><span class="line">// 5.å¼€å¯ä¸‹è½½ä»»åŠ¡</span><br><span class="line">[downloadTask resume];</span><br></pre></td></tr></table></figure></p>
<h4>2.åˆ›å»ºä¸Šä¼ ä»»åŠ¡</h4>
<p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">// 1.åˆ›å»º NSURLSessionConfiguration å¯¹è±¡</span><br><span class="line">NSURLSessionConfiguration *configuration = [NSURLSessionConfiguration defaultSessionConfiguration];</span><br><span class="line"></span><br><span class="line">// 2.åˆ›å»º AFURLSessionManager å¯¹è±¡</span><br><span class="line">AFURLSessionManager *manager = [[AFURLSessionManager alloc] initWithSessionConfiguration:configuration];</span><br><span class="line"></span><br><span class="line">// 3.åˆ›å»º NSURLã€NSURLRequest å¯¹è±¡</span><br><span class="line">NSURL *URL = [NSURL URLWithString:@&quot;http://example.com/upload&quot;];</span><br><span class="line">NSURLRequest *request = [NSURLRequest requestWithURL:URL];</span><br><span class="line"></span><br><span class="line">// 4.åˆ›å»º NSURLSessionUploadTask å¯¹è±¡</span><br><span class="line">NSURL *filePath = [NSURL fileURLWithPath:@&quot;file://path/to/image.png&quot;];</span><br><span class="line">NSURLSessionUploadTask *uploadTask = [manager uploadTaskWithRequest:request fromFile:filePath progress:nil completionHandler:^(NSURLResponse *response, id responseObject, NSError *error) &#123;</span><br><span class="line">    if (error) &#123;</span><br><span class="line">        NSLog(@&quot;Error: %@&quot;, error);</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        NSLog(@&quot;Success: %@ %@&quot;, response, responseObject);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;];</span><br><span class="line">// 5.å¼€å¯ä¸‹è½½ä»»åŠ¡</span><br><span class="line">[uploadTask resume];</span><br></pre></td></tr></table></figure></p>
<h4>3.åˆ›å»ºä¸€ä¸ªå•æ¬¡å«æœ‰å¤šä¸ªä¿¡æ¯çš„æœ‰è¿›åº¦æŒ‡ç¤ºçš„ä¸Šä¼ ä»»åŠ¡</h4>
<p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">// 1.åˆ›å»º NSMutableURLRequest å¯¹è±¡</span><br><span class="line">NSMutableURLRequest *request = [[AFHTTPRequestSerializer serializer] multipartFormRequestWithMethod:@&quot;POST&quot; URLString:@&quot;http://example.com/upload&quot; parameters:nil constructingBodyWithBlock:^(id&lt;AFMultipartFormData&gt; formData) &#123;</span><br><span class="line">    [formData appendPartWithFileURL:[NSURL fileURLWithPath:@&quot;file://path/to/image.jpg&quot;] name:@&quot;file&quot; fileName:@&quot;filename.jpg&quot; mimeType:@&quot;image/jpeg&quot; error:nil];</span><br><span class="line">&#125; error:nil];</span><br><span class="line"></span><br><span class="line">// 2.åˆ›å»º AFURLSessionManager å¯¹è±¡</span><br><span class="line">AFURLSessionManager *manager = [[AFURLSessionManager alloc] initWithSessionConfiguration:[NSURLSessionConfiguration defaultSessionConfiguration]];</span><br><span class="line"></span><br><span class="line">// 3.åˆ›å»º NSURLSessionUploadTask å¯¹è±¡</span><br><span class="line">NSURLSessionUploadTask *uploadTask;</span><br><span class="line">uploadTask = [manager</span><br><span class="line">              uploadTaskWithStreamedRequest:request</span><br><span class="line">              progress:^(NSProgress * _Nonnull uploadProgress) &#123;</span><br><span class="line">                  // æ­¤å¤„ä¸ä¼šåœ¨ä¸»çº¿ç¨‹ä¸Šå›è°ƒ</span><br><span class="line">                  // ä½ è¦è´Ÿè´£åœ¨ä¸»çº¿ç¨‹ä¸Šæ›´æ–° UI</span><br><span class="line">                  dispatch_async(dispatch_get_main_queue(), ^&#123;</span><br><span class="line">                      // Update the progress view</span><br><span class="line">                      [progressView setProgress:uploadProgress.fractionCompleted];</span><br><span class="line">                  &#125;);</span><br><span class="line">              &#125;</span><br><span class="line">              completionHandler:^(NSURLResponse * _Nonnull response, id  _Nullable responseObject, NSError * _Nullable error) &#123;</span><br><span class="line">                  if (error) &#123;</span><br><span class="line">                      NSLog(@&quot;Error: %@&quot;, error);</span><br><span class="line">                  &#125; else &#123;</span><br><span class="line">                      NSLog(@&quot;%@ %@&quot;, response, responseObject);</span><br><span class="line">                  &#125;</span><br><span class="line">              &#125;];</span><br><span class="line">// 4.å¼€å¯ä¸‹è½½ä»»åŠ¡</span><br><span class="line">[uploadTask resume];</span><br></pre></td></tr></table></figure></p>
<h4>4.åˆ›å»ºæ•°æ®ä»»åŠ¡</h4>
<p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">// 1.åˆ›å»º NSURLSessionConfiguration å¯¹è±¡</span><br><span class="line">NSURLSessionConfiguration *configuration = [NSURLSessionConfiguration defaultSessionConfiguration];</span><br><span class="line"></span><br><span class="line">// 2.åˆ›å»º AFURLSessionManager å¯¹è±¡</span><br><span class="line">AFURLSessionManager *manager = [[AFURLSessionManager alloc] initWithSessionConfiguration:configuration];</span><br><span class="line"></span><br><span class="line">// 3.åˆ›å»º NSURLã€NSURLRequest å¯¹è±¡</span><br><span class="line">NSURL *URL = [NSURL URLWithString:@&quot;http://httpbin.org/get&quot;];</span><br><span class="line">NSURLRequest *request = [NSURLRequest requestWithURL:URL];</span><br><span class="line"> </span><br><span class="line">// 4.åˆ›å»º NSURLSessionDataTask å¯¹è±¡</span><br><span class="line">NSURLSessionDataTask *dataTask = [manager dataTaskWithRequest:request completionHandler:^(NSURLResponse *response, id responseObject, NSError *error) &#123;</span><br><span class="line">    if (error) &#123;</span><br><span class="line">        NSLog(@&quot;Error: %@&quot;, error);</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        NSLog(@&quot;%@ %@&quot;, response, responseObject);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;];</span><br><span class="line"></span><br><span class="line">// 5.å¼€å¯ä¸‹è½½ä»»åŠ¡</span><br><span class="line">[dataTask resume];</span><br></pre></td></tr></table></figure></p>
<p>ä»ä½¿ç”¨ä¸Šçœ‹ï¼Œ<strong>AFURLSessionManager</strong> åªæ˜¯å°è£…äº†åŸç”Ÿçš„ <strong>NSURLSession</strong> å¯¹è±¡ï¼Œåˆ›å»ºç½‘ç»œè¯·æ±‚æ­¥éª¤æµç¨‹ä¸åŸç”Ÿæ–¹æ³•ï¼ˆä½¿ç”¨ <code>NSURLSession</code> ç±»ï¼‰ç±»ä¼¼ï¼š</p>
<p><img src="https://blog-andy0570-1256077835.cos.ap-shanghai.myqcloud.com/site_Images/072549.png" alt="AFURLSessionManager"></p>
<hr>
<h3>äºŒã€AFHTTPSessionManager</h3>
<p>ğŸ’¡è¯´æ˜ï¼šå®˜æ–¹ README æ–‡æ¡£ä¸­å¹¶æ²¡æœ‰ç»™å‡ºè¯¥ç±»çš„ç¤ºä¾‹ä»£ç ï¼Œè¿™é‡Œè¡¥å……ã€‚</p>
<p><strong>AFHTTPSessionManager</strong> æ˜¯ <strong>AFURLSessionManager</strong> çš„å­ç±»å¯¹è±¡ï¼Œå®ƒæä¾›äº†è¿›è¡Œ HTTP è¯·æ±‚çš„ä¾¿æ·æ–¹æ³•ã€‚å½“è®¾ç½®å¥½  <code>baseURL</code>  ï¼ˆæœåŠ¡å™¨åœ°å€ï¼‰æ—¶ï¼Œè¦å‘èµ· <code>GET</code>ã€<code>POST</code> ç­‰è¯·æ±‚ï¼Œä½ å¯ä»¥ä½¿ç”¨ä¸€äº›ä¾¿æ·æ–¹æ³•ï¼Œè€Œè¿™äº›ä¾¿æ·æ–¹æ³•åªéœ€è¦ä¼ å…¥ç›¸å¯¹è·¯å¾„å‚æ•°å³å¯ã€‚</p>
<p>æ€»ä¹‹ï¼Œ<strong>AFHTTPSessionManager</strong> æä¾›äº†å‘èµ· <strong>GET</strong>ã€<strong>HEAD</strong>ã€<strong>POST</strong>ã€<strong>PUT</strong>ã€<strong>PATCH</strong>ã€<strong>DELETE</strong> è¯·æ±‚çš„ä¾¿æ·è¯­æ³•ã€‚å®ƒè°ƒç”¨çš„æ˜¯çˆ¶ç±» <strong>AFURLSessionManager</strong> çš„ <strong>NSURLSessionDataTask</strong> ç±»å‹çš„ä»»åŠ¡ã€‚</p>
<p>è¿™ä¸ªç±»å¹¶æ²¡æœ‰å®ç°åƒ <strong>NSURLSessionUploadTask</strong>ã€<strong>NSURLSessionDownloadTask</strong>ã€<strong>NSURLSessionStreamTask</strong> ç±»å‹çš„ä»»åŠ¡ã€‚</p>
<p>åˆå§‹åŒ–æ–¹æ³•ï¼š</p>
<p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">+ (instancetype)manager;</span><br><span class="line">- (instancetype)initWithBaseURL:(nullable NSURL *)url;</span><br><span class="line">- (instancetype)initWithBaseURL:(nullable NSURL *)url</span><br><span class="line">           sessionConfiguration:(nullable NSURLSessionConfiguration *)configuration;</span><br></pre></td></tr></table></figure></p>
<p>å‘èµ· HTTP è¯·æ±‚ï¼š</p>
<p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">// GET</span><br><span class="line">- (nullable NSURLSessionDataTask *)GET:(NSString *)URLString</span><br><span class="line">                            parameters:(nullable id)parameters</span><br><span class="line">                              progress:(nullable void (^)(NSProgress *downloadProgress))downloadProgress</span><br><span class="line">                               success:(nullable void (^)(NSURLSessionDataTask *task, id _Nullable responseObject))success</span><br><span class="line">                               failure:(nullable void (^)(NSURLSessionDataTask * _Nullable task, NSError *error))failure;</span><br><span class="line"></span><br><span class="line">// HEAD</span><br><span class="line">- (nullable NSURLSessionDataTask *)HEAD:(NSString *)URLString</span><br><span class="line">                    parameters:(nullable id)parameters</span><br><span class="line">                       success:(nullable void (^)(NSURLSessionDataTask *task))success</span><br><span class="line">                       failure:(nullable void (^)(NSURLSessionDataTask * _Nullable task, NSError *error))failure;</span><br><span class="line"></span><br><span class="line">// POST</span><br><span class="line">- (nullable NSURLSessionDataTask *)POST:(NSString *)URLString</span><br><span class="line">                             parameters:(nullable id)parameters</span><br><span class="line">                               progress:(nullable void (^)(NSProgress *uploadProgress))uploadProgress</span><br><span class="line">                                success:(nullable void (^)(NSURLSessionDataTask *task, id _Nullable responseObject))success</span><br><span class="line">                                failure:(nullable void (^)(NSURLSessionDataTask * _Nullable task, NSError *error))failure;</span><br><span class="line"></span><br><span class="line">- (nullable NSURLSessionDataTask *)POST:(NSString *)URLString</span><br><span class="line">                             parameters:(nullable id)parameters</span><br><span class="line">              constructingBodyWithBlock:(nullable void (^)(id &lt;AFMultipartFormData&gt; formData))block</span><br><span class="line">                               progress:(nullable void (^)(NSProgress *uploadProgress))uploadProgress</span><br><span class="line">                                success:(nullable void (^)(NSURLSessionDataTask *task, id _Nullable responseObject))success</span><br><span class="line">                                failure:(nullable void (^)(NSURLSessionDataTask * _Nullable task, NSError *error))failure;</span><br><span class="line"></span><br><span class="line">// PUT</span><br><span class="line">- (nullable NSURLSessionDataTask *)PUT:(NSString *)URLString</span><br><span class="line">                   parameters:(nullable id)parameters</span><br><span class="line">                      success:(nullable void (^)(NSURLSessionDataTask *task, id _Nullable responseObject))success</span><br><span class="line">                      failure:(nullable void (^)(NSURLSessionDataTask * _Nullable task, NSError *error))failure;</span><br><span class="line"></span><br><span class="line">// PATCH</span><br><span class="line">- (nullable NSURLSessionDataTask *)PATCH:(NSString *)URLString</span><br><span class="line">                     parameters:(nullable id)parameters</span><br><span class="line">                        success:(nullable void (^)(NSURLSessionDataTask *task, id _Nullable responseObject))success</span><br><span class="line">                        failure:(nullable void (^)(NSURLSessionDataTask * _Nullable task, NSError *error))failure;</span><br><span class="line"></span><br><span class="line">// DELETE</span><br><span class="line">- (nullable NSURLSessionDataTask *)DELETE:(NSString *)URLString</span><br><span class="line">                      parameters:(nullable id)parameters</span><br><span class="line">                         success:(nullable void (^)(NSURLSessionDataTask *task, id _Nullable responseObject))success</span><br><span class="line">                         failure:(nullable void (^)(NSURLSessionDataTask * _Nullable task, NSError *error))failure;</span><br></pre></td></tr></table></figure></p>
<h4>ä¸€ã€GET è¯·æ±‚</h4>
<p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">// 1.åˆ›å»º AFHTTPSessionManager å¯¹è±¡</span><br><span class="line">AFHTTPSessionManager *manager = [AFHTTPSessionManager manager];</span><br><span class="line"></span><br><span class="line">// 2.æ„å»ºå‚æ•°ï¼Œparameters å‚æ•°å¯ä»¥ä¼  nil</span><br><span class="line">NSString *urlString = @&quot;https://www.google.com/login&quot;;</span><br><span class="line"></span><br><span class="line">// 3.Task ä»»åŠ¡</span><br><span class="line">[manager GET:urlString parameters:nil progress:^(NSProgress * _Nonnull downloadProgress) &#123;</span><br><span class="line">    // è¿›åº¦</span><br><span class="line">&#125; success:^(NSURLSessionDataTask * _Nonnull task, id  _Nullable responseObject) &#123;</span><br><span class="line">    // è¯·æ±‚æˆåŠŸ</span><br><span class="line">    // task:é€šè¿‡taskæ‹¿åˆ°å“åº”å¤´</span><br><span class="line">    // responseObject:è¯·æ±‚æˆåŠŸè¿”å›çš„å“åº”ç»“æœï¼ˆAFNå†…éƒ¨å·²ç»æŠŠå“åº”ä½“è½¬æ¢ä¸ºOCå¯¹è±¡ï¼Œé€šå¸¸æ˜¯å­—å…¸æˆ–æ•°ç»„)</span><br><span class="line">&#125; failure:^(NSURLSessionDataTask * _Nullable task, NSError * _Nonnull error) &#123;</span><br><span class="line">    // è¯·æ±‚å¤±è´¥</span><br><span class="line">    NSLog(@&quot;GET ERROR:%@&quot;,error.localizedDescription);</span><br><span class="line">&#125;];</span><br></pre></td></tr></table></figure></p>
<h4>äºŒã€POST è¯·æ±‚</h4>
<p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">// 1.åˆ›å»º AFHTTPSessionManager å¯¹è±¡</span><br><span class="line">AFHTTPSessionManager *manager = [AFHTTPSessionManager alloc]</span><br><span class="line">    initWithBaseURL:[NSURL URLWithString:@&quot;https://www.google.com&quot;]];</span><br><span class="line"></span><br><span class="line">// 2.æ„å»ºå‚æ•°</span><br><span class="line">NSString *relativePaths = @&quot;/login&quot;;</span><br><span class="line">NSDictionary *parameters = @&#123;</span><br><span class="line">                             @&quot;username&quot;:@&quot;admin&quot;,</span><br><span class="line">                             @&quot;password&quot;:@&quot;123456&quot;,</span><br><span class="line">                             &#125;;</span><br><span class="line">// 3.Task ä»»åŠ¡</span><br><span class="line">[manager POST:relativePaths parameters:parameters progress:^(NSProgress * _Nonnull uploadProgress) &#123;</span><br><span class="line">    // è¿›åº¦</span><br><span class="line">&#125; success:^(NSURLSessionDataTask * _Nonnull task, id  _Nullable responseObject) &#123;</span><br><span class="line">    // è¯·æ±‚æˆåŠŸ</span><br><span class="line">&#125; failure:^(NSURLSessionDataTask * _Nullable task, NSError * _Nonnull error) &#123;</span><br><span class="line">    // è¯·æ±‚å¤±è´¥</span><br><span class="line">&#125;]</span><br></pre></td></tr></table></figure></p>
<h4>å…¶ä»–è®¾ç½®</h4>
<h5>timeoutInterval è®¾ç½®è¯·æ±‚è¶…æ—¶æ—¶é—´ï¼Œé»˜è®¤ä¸º 60sï¼š</h5>
<p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">// è®¾ç½®è¯·æ±‚è¶…æ—¶æ—¶é—´ä¸º 10s</span><br><span class="line">[manager.requestSerializer willChangeValueForKey:@&quot;timeoutInterval&quot;];</span><br><span class="line">manager.requestSerializer.timeoutInterval = 10.f;</span><br><span class="line">[manager.requestSerializer didChangeValueForKey:@&quot;timeoutInterval&quot;];</span><br></pre></td></tr></table></figure></p>
<h5>ContentTypes ç±»å‹</h5>
<p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">// AFNé»˜è®¤æ¥æ”¶çš„ ContentTypes æœ‰ä»¥ä¸‹ä¸‰ç§ï¼š</span><br><span class="line">self.acceptableContentTypes = [NSSet setWithObjects:@&quot;application/json&quot;, @&quot;text/json&quot;, @&quot;text/javascript&quot;, nil];</span><br><span class="line"></span><br><span class="line">// å¦‚æœæœåŠ¡å™¨è¿”å›çš„ ContentTypes ç±»å‹ä¸º text/htmlï¼Œéœ€è¦è®¾ç½®å¦‚ä¸‹ï¼š</span><br><span class="line">manager.responseSerializer.acceptableContentTypes = [NSSet setWithObject:@&quot;text/html&quot;];</span><br></pre></td></tr></table></figure></p>
<h5>responseSerializer é»˜è®¤æŠŠæœåŠ¡å™¨è¿”å›çš„æ•°æ®å½“åšæ˜¯ JSON ç±»å‹å¹¶è‡ªåŠ¨è½¬åŒ–ä¸ºObjec</h5>
<p><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">// è®¾ç½®ä¸º <span class="keyword">XML</span> <span class="title">ç±»å‹ï¼Œæ­¤æ—¶è¿”å›çš„æ˜¯ NSXMLParser</span> ç±»å‹ï¼Œéœ€è¦æˆ‘ä»¬è‡ªå·±è§£æã€‚</span><br><span class="line">manager.responseSerializer = [AFXMLParserResponseSerializer serializer];</span><br><span class="line"></span><br><span class="line">// è®¾ç½®ä¸ºå…¶ä»–ç±»å‹</span><br><span class="line">manager.responseSerializer = [AFHTTPResponseSerializer serializer];</span><br></pre></td></tr></table></figure></p>
<h5>éªŒè¯SSLè¯ä¹¦</h5>
<p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">// éªŒè¯CNåŸŸå</span><br><span class="line">NSString *cerPath = [[NSBundle mainBundle] pathForResource:@&quot;server&quot; ofType:@&quot;cer&quot;];</span><br><span class="line">NSData *cerData = [NSData dataWithContentsOfFile:cerPath];</span><br><span class="line">manager.securityPolicy = [AFSecurityPolicy policyWithPinningMode:AFSSLPinningModeCertificate withPinnedCertificates:[[NSSet alloc]initWithObjects:cerData, nil]];</span><br><span class="line"></span><br><span class="line">// æ˜¯å¦ä¿¡ä»»å…·æœ‰æ— æ•ˆæˆ–è¿‡æœŸSSLè¯ä¹¦çš„æœåŠ¡å™¨ï¼ˆè‡ªå»ºè¯ä¹¦ï¼‰</span><br><span class="line">manager.securityPolicy.allowInvalidCertificates = YES;</span><br><span class="line"></span><br><span class="line">// æ˜¯å¦åœ¨è¯ä¹¦çš„CNå­—æ®µä¸­éªŒè¯åŸŸå</span><br><span class="line">manager.securityPolicy.validatesDomainName = NO;</span><br></pre></td></tr></table></figure></p>
<h3>è®¾ç½®çŠ¶æ€æ æ´»åŠ¨æŒ‡ç¤ºå™¨</h3>
<p>å¯ç”¨åï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨åœ¨åº”ç”¨ç¨‹åºå‘èµ·ç½‘ç»œè¯·æ±‚æ—¶ï¼Œåœ¨çŠ¶æ€æ æ˜¾ç¤ºæ—‹è½¬çš„èŠèŠ±ã€‚</p>
<ol>
<li>åœ¨é¡¹ç›®çš„ <code>AppDelegate.m</code> æ–‡ä»¶ä¸­å¯¼å…¥<code>AFNetworkActivityIndicatorManager.h</code> æ–‡ä»¶ï¼›</li>
<li>åœ¨<code>AppDelegate application:didFinishLaunchingWithOptions:</code>æ–¹æ³•ä¸­è®¾ç½®å¦‚ä¸‹ä»£ç ï¼š</li>
</ol>
<p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[[AFNetworkActivityIndicatorManager sharedManager] setEnabled:YES];</span><br></pre></td></tr></table></figure></p>
<hr>
<h3>è¯·æ±‚åºåˆ—åŒ–</h3>
<p>è¯·æ±‚åºåˆ—åŒ–é€šè¿‡å°†è¯·æ±‚å‚æ•°ç¼–ç ä¸ºæŸ¥è¯¢å­—ç¬¦ä¸²æˆ–è€… HTTP è¯·æ±‚ä½“,æ¥ä¸ºURLå­—ç¬¦ä¸²åˆ›å»ºè¯·æ±‚ã€‚</p>
<p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">NSString *URLString = @&quot;http://example.com&quot;;</span><br><span class="line">NSDictionary *parameters = @&#123;@&quot;foo&quot;: @&quot;bar&quot;, @&quot;baz&quot;: @[@1, @2, @3]&#125;;</span><br></pre></td></tr></table></figure></p>
<h4>ä¸€ã€ç¼–ç ä¸ºæŸ¥è¯¢å­—ç¬¦ä¸²</h4>
<p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">// GET</span><br><span class="line">[[AFHTTPRequestSerializer serializer] requestWithMethod:@&quot;GET&quot; URLString:URLString parameters:parameters error:nil];</span><br></pre></td></tr></table></figure></p>
<p><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET <span class="link">http://example.com?foo=bar&amp;baz</span>[<span class="string"></span>]=1&amp;baz[]=2&amp;baz[]=3</span><br></pre></td></tr></table></figure></p>
<h4>äºŒã€ç¼–ç ä¸ºURLè¡¨å•</h4>
<p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">// POST</span><br><span class="line">[[AFHTTPRequestSerializer serializer] requestWithMethod:@&quot;POST&quot; URLString:URLString parameters:parameters error:nil];</span><br></pre></td></tr></table></figure></p>
<pre><code>POST http://example.com/
Content-Type: application/x-www-form-urlencoded

foo=bar&amp;baz[]=1&amp;baz[]=2&amp;baz[]=3
</code></pre>
<h4>ä¸‰ã€ç¼–ç ä¸ºJSONå­—ç¬¦ä¸²</h4>
<p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">// AFJSONRequestSerializer</span><br><span class="line">[[AFJSONRequestSerializer serializer] requestWithMethod:@&quot;POST&quot; URLString:URLString parameters:parameters error:nil];</span><br></pre></td></tr></table></figure></p>
<pre><code>POST http://example.com/
Content-Type: application/json

{&quot;foo&quot;: &quot;bar&quot;, &quot;baz&quot;: [1,2,3]}
</code></pre>
<hr>
<h3>ç½‘ç»œçŠ¶æ€ç®¡ç†</h3>
<p><code>AFNetworkReachabilityManager</code> ç±»ç”¨äºç›‘æµ‹ WWAN å’Œ WiFi æ¥å£çš„ç½‘ç»œè”é€šæ€§ã€‚</p>
<ul>
<li>ä¸è¦ä¾æ®å®ƒæ¥å†³å®šæ˜¯å¦å‘èµ·ç½‘ç»œè¯·æ±‚ã€‚
<ul>
<li>ä½ åº”è¯¥å°è¯•å‘é€ç½‘ç»œè¯·æ±‚ã€‚</li>
</ul>
</li>
<li>ä½ å¯ä»¥ä¾æ®å®ƒæ¥é€‰æ‹©æ˜¯å¦è‡ªåŠ¨é‡æ–°å‘é€è¯·æ±‚ã€‚
<ul>
<li>è™½ç„¶å®ƒå¯èƒ½ä»ç„¶å¤±è´¥ï¼Œä½†å½“è¿æ¥å¯ç”¨æ—¶ï¼Œå¯è®¿é—®æ€§é€šçŸ¥æ˜¯é‡è¯•æŸäº›ä¸œè¥¿çš„å¥½æ—¶æœºã€‚</li>
</ul>
</li>
<li>å®ƒæ˜¯ä¸€ä¸ªåˆ¤æ–­ç½‘ç»œè¯·æ±‚å¤±è´¥åŸå› çš„å¾ˆå¥½ç”¨çš„å·¥å…·ã€‚
<ul>
<li>å½“ç½‘ç»œè¯·æ±‚å¤±è´¥æ—¶,å‘Šè¯‰ç”¨æˆ·ä»–ä»¬å·²ç»ç¦»çº¿,è¦æ¯”å‘Šè¯‰ä»–ä»¬ä¸€äº›æ¯”å¦‚â€è¯·æ±‚è¶…æ—¶â€ä¸€ç±»çš„å‡†ç¡®çš„é”™è¯¯æ›´å¥½ã€‚</li>
</ul>
</li>
</ul>
<p>See also <a href="https://developer.apple.com/videos/play/wwdc2012-706/" target="_blank" rel="noopener">WWDC 2012 session 706, &quot;Networking Best Practices.&quot;</a>.</p>
<h4>å…±äº«ç½‘ç»œçŠ¶æ€è¿é€šæ€§</h4>
<p>ç¤ºä¾‹ï¼š</p>
<p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">AFNetworkReachabilityManager *manager = [AFNetworkReachabilityManager sharedManager];</span><br><span class="line">[manager setReachabilityStatusChangeBlock:^(AFNetworkReachabilityStatus status) &#123;</span><br><span class="line">    switch (status) &#123;</span><br><span class="line">        case AFNetworkReachabilityStatusUnknown: &#123;</span><br><span class="line">            DDLogInfo(@&quot;ç½‘ç»œå¼‚å¸¸ï¼šæœªçŸ¥ç½‘ç»œ&quot;);</span><br><span class="line">            break;</span><br><span class="line">        &#125;</span><br><span class="line">        case AFNetworkReachabilityStatusNotReachable: &#123;</span><br><span class="line">            DDLogInfo(@&quot;ç½‘ç»œå¼‚å¸¸ï¼šæ²¡æœ‰ç½‘ç»œ&quot;);</span><br><span class="line">            break;</span><br><span class="line">        &#125;</span><br><span class="line">        case AFNetworkReachabilityStatusReachableViaWWAN: &#123;</span><br><span class="line">            DDLogInfo(@&quot;ç½‘ç»œçŠ¶æ€æ£€æµ‹ï¼šèœ‚çªç½‘ç»œ&quot;);</span><br><span class="line">            break;</span><br><span class="line">        &#125;</span><br><span class="line">        case AFNetworkReachabilityStatusReachableViaWiFi: &#123;</span><br><span class="line">            DDLogInfo(@&quot;ç½‘ç»œçŠ¶æ€æ£€æµ‹ï¼šWiFi&quot;);</span><br><span class="line">            break;                </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;];</span><br><span class="line">[networkReachabilityManager startMonitoring]; // å¼€å¯ç½‘ç»œæ£€æµ‹</span><br></pre></td></tr></table></figure></p>
<h4><s>åŸºäºç‰¹å®šåŸŸåçš„ç½‘ç»œè¿é€šæ€§</s></h4>
<hr>
<h3>å®‰å…¨ç­–ç•¥</h3>
<p><code>AFSecurityPolicy</code> åŸºäº X.509 æ•°å­—è¯ä¹¦å’Œå…¬é’¥æ¥ç¡®å®šæœåŠ¡å™¨æ˜¯å¦å¯ä¿¡ã€‚</p>
<p>å‘åº”ç”¨ç¨‹åºä¸­æ·»åŠ å›ºå®šçš„ SSL è¯ä¹¦æœ‰åŠ©äºé˜²æ­¢ä¸­é—´äººæ”»å‡»å’Œå…¶ä»–æ¼æ´ã€‚å¼ºçƒˆå»ºè®®å¤„ç†æ•æ„Ÿå®¢æˆ·æ•°æ®æˆ–è´¢åŠ¡ä¿¡æ¯çš„åº”ç”¨ç¨‹åºé€šè¿‡ HTTPS è¿æ¥æ¥å’ŒæœåŠ¡å™¨é€šä¿¡ã€‚</p>
<h4>å…è®¸æ— æ•ˆçš„ SSL è¯ä¹¦</h4>
<p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">AFHTTPSessionManager *manager = [AFHTTPSessionManager manager];</span><br><span class="line">manager.securityPolicy.allowInvalidCertificates = YES; // ç”Ÿäº§ç¯å¢ƒä¸å»ºè®®ä½¿ç”¨</span><br></pre></td></tr></table></figure></p>
<hr>
<h2>å•å…ƒæµ‹è¯•</h2>
<p>AFNetworking åœ¨ Tests å­ç›®å½•ä¸­åŒ…å«ä¸€å¥—å•å…ƒæµ‹è¯•ã€‚ è¿™äº›æµ‹è¯•å¯ä»¥ç®€å•åœ°æ‰§è¡Œæ‚¨æƒ³è¦æµ‹è¯•çš„å¹³å°æ¡†æ¶ä¸Šçš„æµ‹è¯•æ“ä½œã€‚</p>
<h2>è´¦æˆ·</h2>
<p>AFNetworking is owned and maintained by the <a href="http://alamofire.org" target="_blank" rel="noopener">Alamofire Software Foundation</a>.</p>
<p>AFNetworking was originally created by <a href="https://github.com/sco/" target="_blank" rel="noopener">Scott Raymond</a> and <a href="https://github.com/mattt/" target="_blank" rel="noopener">Mattt Thompson</a> in the development of <a href="http://en.wikipedia.org/wiki/Gowalla" target="_blank" rel="noopener">Gowalla for iPhone</a>.</p>
<p>AFNetworking's logo was designed by <a href="http://www.alandefibaugh.com/" target="_blank" rel="noopener">Alan Defibaugh</a>.</p>
<p>And most of all, thanks to AFNetworking's <a href="https://github.com/AFNetworking/AFNetworking/contributors" target="_blank" rel="noopener">growing list of contributors</a>.</p>
<h3>Security Disclosure</h3>
<p>If you believe you have identified a security vulnerability with AFNetworking, you should report it as soon as possible via email to security@alamofire.org. Please do not post it to a public issue tracker.</p>
<h2>License</h2>
<p>AFNetworking is released under the MIT license. See LICENSE for details.
tive-Cå¯¹è±¡ã€‚</p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://andy0570.com/2017/12/20/Reachabilityâ€”â€”ä¸€ä¸ªç”¨äºåˆ¤æ–­ç½‘ç»œå¯è¾¾æ€§çš„åº“/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ç‹¬æœ¨èˆŸçš„æœ¨">
      <meta itemprop="description" content="æœ‰æ—¶å€™é˜³å…‰å¾ˆå¥½ æœ‰æ—¶å€™é˜³å…‰å¾ˆæš—">
      <meta itemprop="image" content="https://blog-andy0570-1256077835.cos.ap-shanghai.myqcloud.com/site_Images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ç‹¬æœ¨èˆŸçš„æœ¨">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2017/12/20/Reachabilityâ€”â€”ä¸€ä¸ªç”¨äºåˆ¤æ–­ç½‘ç»œå¯è¾¾æ€§çš„åº“/" class="post-title-link" itemprop="url">Reachabilityâ€”â€”ä¸€ä¸ªç”¨äºåˆ¤æ–­ç½‘ç»œå¯è¾¾æ€§çš„åº“</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              

              
                
              

              <time title="åˆ›å»ºæ—¶é—´ï¼š2017-12-20 16:03:00" itemprop="dateCreated datePublished" datetime="2017-12-20T16:03:00+08:00">2017-12-20</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">æ›´æ–°äº</span>
                
                <time title="ä¿®æ”¹æ—¶é—´ï¼š2019-05-01 22:12:09" itemprop="dateModified" datetime="2019-05-01T22:12:09+08:00">2019-05-01</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/iOS-å¼€æºæ¡†æ¶/" itemprop="url" rel="index"><span itemprop="name">iOS å¼€æºæ¡†æ¶</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          

          

          
            <div class="post-symbolscount">
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">æœ¬æ–‡å­—æ•°ï¼š</span>
                
                <span title="æœ¬æ–‡å­—æ•°">6.7k</span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">é˜…è¯»æ—¶é•¿ &asymp;</span>
                
                <span title="é˜…è¯»æ—¶é•¿">6 åˆ†é’Ÿ</span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body han-init-context" itemprop="articleBody">

      
      

      
        
          
            <ul>
<li>GitHub:<a href="https://github.com/tonymillion/Reachability" target="_blank" rel="noopener">tonymillion/<strong>Reachability</strong></a></li>
<li>Star:6500+</li>
</ul>
<blockquote>
<p>é™„ä¸Š3ä¸ªç½‘ç»œå¯è¾¾æ€§åº“ï¼š</p>
<ol>
<li>Apple å®˜æ–¹Demoï¼š<a href="https://developer.apple.com/library/content/samplecode/Reachability/Introduction/Intro.html#//apple_ref/doc/uid/DTS40007324-Intro-DontLinkElementID_2" target="_blank" rel="noopener">Reachability</a></li>
<li>æœ¬é¡¹ç›®ï¼š<a href="https://github.com/tonymillion/Reachability" target="_blank" rel="noopener">tonymillion/<strong>Reachability</strong></a></li>
<li><a href="https://github.com/AFNetworking/AFNetworking" target="_blank" rel="noopener">AFNetworking</a> çš„ <code>AFNetworkReachabilityManager</code> ç±»</li>
</ol>
</blockquote>
<h1><strong>WARNING</strong> there have been reports of apps being rejected when Reachability is used in a framework. The only solution to this so far is to rename the class.</h1>
<blockquote>
<p>âš ï¸è¯¥ç±»åº“å¯èƒ½ä½¿ç”¨äº†ä¸Appleæºç ç›¸åŒçš„ç±»åï¼Œå› æ­¤æäº¤åº”ç”¨å®¡æ ¸æ—¶ï¼Œå¯èƒ½ä¼šè¢«æ‹’ç»ã€‚ç›®å‰ä¸ºæ­¢ï¼Œå”¯ä¸€çš„è§£å†³æ–¹æ³•å°±æ˜¯æ›´æ”¹ç±»åã€‚</p>
</blockquote>
<p>&lt;!-- more --&gt;</p>
<h1>Reachability</h1>
<p>è¿™æ˜¯ Apple çš„ <code>Reachability</code> ç±»çš„æ›¿ä»£å“ã€‚ å®ƒå…¼å®¹ARCï¼Œå®ƒä½¿ç”¨æ–°çš„ GCD æ–¹æ³•æ¥é€šçŸ¥ç½‘ç»œæ¥å£çš„å˜åŒ–ã€‚</p>
<p>é™¤äº†æ ‡å‡†çš„ <code>NSNotification</code> ä¹‹å¤–ï¼Œå®ƒè¿˜æ”¯æŒä½¿ç”¨ block å—å¤„ç†ç½‘ç»œå¯è¾¾æˆ–ä¸å¯è¾¾æ—¶çš„æƒ…å†µã€‚</p>
<p>æœ€åï¼Œä½ å¯ä»¥æŒ‡å®šæ˜¯å¦å°† WWAN è¿æ¥è§†ä¸ºâ€œå¯è¾¾â€ã€‚</p>
<p><em>åœ¨çœŸå®è®¾å¤‡ä¸Šæµ‹è¯•ä¹‹å‰ï¼Œè¯·ä¸è¦å¼€å¯ BUGS</em></p>
<p><strong>åœ¨ä½ å¼€å¯ä¸€ä¸ªå…³äº iOS6 / iOS5 ç‰ˆæœ¬çš„æ„å»ºé”™è¯¯ä¹‹å‰ï¼Œè¯·ä½¿ç”¨æ ‡ç­¾3.2æˆ–3.1ï¼Œå› ä¸ºå®ƒä»¬æ”¯æŒåˆ†é…ç±»å‹ã€‚</strong></p>
<h2>Requirements</h2>
<p>Once you have added the <code>.h/m</code> files to your project, simply:</p>
<ul>
<li>Go to the <code>Project-&gt;TARGETS-&gt;Build Phases-&gt;Link Binary With Libraries</code>.</li>
<li>Press the plus in the lower left of the list.</li>
<li>Add <code>SystemConfiguration.framework</code>.</li>
</ul>
<p>Boom, you're done.</p>
<h2>ç¤ºä¾‹</h2>
<h3>Blocks æ–¹æ³•ç¤ºä¾‹</h3>
<p>è¯¥ç¤ºä¾‹ä½¿ç”¨ blocks å—æ¥ç›‘å¬ç½‘ç»œæ¥å£çŠ¶æ€æ˜¯å¦æ”¹å˜ã€‚è¯¥ blocks å°†ä¼šåœ¨<strong>åå°çº¿ç¨‹</strong>è¢«è°ƒç”¨ï¼Œå› æ­¤ä½ éœ€è¦å°†UIæ›´æ–°åˆ‡æ¢åˆ°ä¸»çº¿ç¨‹ä¸­ã€‚</p>
<h4><strong>In</strong> Objective-C</h4>
<p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">// åˆ›å»º reachability å¯¹è±¡</span><br><span class="line">Reachability *reach = [Reachability reachabilityWithHostname:@&quot;www.google.com&quot;];</span><br><span class="line"></span><br><span class="line">// è®¾ç½®ç½‘ç»œå¯è¾¾çš„ blocks</span><br><span class="line">reach.reachableBlock = ^(Reachability*reach)</span><br><span class="line">&#123;</span><br><span class="line">	// è®°ä½è¿™é‡Œçš„ä»£ç ä¼šåœ¨åå°çº¿ç¨‹ä¸­è¢«è°ƒç”¨ï¼Œå¦‚æœä½ æƒ³è¦æ›´æ–°UIï¼Œä¸€å®šåˆ°åˆ‡æ¢åˆ°ä¸»çº¿ç¨‹ï¼š</span><br><span class="line">    dispatch_async(dispatch_get_main_queue(), ^&#123;</span><br><span class="line">        NSLog(@&quot;REACHABLE!&quot;);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">// è®¾ç½®ç½‘ç»œä¸å¯è¾¾çš„ blocks</span><br><span class="line">reach.unreachableBlock = ^(Reachability*reach)</span><br><span class="line">&#123;</span><br><span class="line">    NSLog(@&quot;UNREACHABLE!&quot;);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">// å¼€å¯ç›‘å¬</span><br><span class="line">[reach startNotifier];</span><br></pre></td></tr></table></figure></p>
<h3>In Swift 3</h3>
<p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Reachability</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> reach: <span class="type">Reachability?</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">application</span><span class="params">(<span class="number">_</span> application: UIApplication, didFinishLaunchingWithOptions launchOptions: [UIApplicationLaunchOptionsKey: <span class="keyword">Any</span>]?)</span></span> -&gt; <span class="type">Bool</span> &#123;</span><br><span class="line">        <span class="comment">// Allocate a reachability object</span></span><br><span class="line">        <span class="keyword">self</span>.reach = <span class="type">Reachability</span>.forInternetConnection()</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Set the blocks</span></span><br><span class="line">        <span class="keyword">self</span>.reach!.reachableBlock = &#123;</span><br><span class="line">            (reach: <span class="type">Reachability?</span>) -&gt; <span class="type">Void</span> <span class="keyword">in</span></span><br><span class="line">            </span><br><span class="line">            <span class="comment">// keep in mind this is called on a background thread</span></span><br><span class="line">            <span class="comment">// and if you are updating the UI it needs to happen</span></span><br><span class="line">            <span class="comment">// on the main thread, like this:</span></span><br><span class="line">            <span class="type">DispatchQueue</span>.main.async &#123;</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">"REACHABLE!"</span>)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">self</span>.reach!.unreachableBlock = &#123;</span><br><span class="line">            (reach: <span class="type">Reachability?</span>) -&gt; <span class="type">Void</span> <span class="keyword">in</span></span><br><span class="line">            <span class="built_in">print</span>(<span class="string">"UNREACHABLE!"</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">self</span>.reach!.startNotifier()</span><br><span class="line">    </span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3><code>NSNotification</code> é€šçŸ¥æ–¹æ³•ç¤ºä¾‹</h3>
<p>æ­¤ç¤ºä¾‹å°†ä½¿ç”¨ <code>NSNotification</code> æ¥é€šçŸ¥ç½‘ç»œè¿æ¥çŠ¶æ€çš„å˜åŒ–ã€‚ å®ƒä»¬å°†åœ¨ä¸»çº¿ç¨‹ä¸Šè¢«è°ƒç”¨ï¼Œå› æ­¤ä½ å¯ä»¥ä»è¯¥å‡½æ•°å†…éƒ¨è¿›è¡ŒUIæ›´æ–°ã€‚</p>
<p>æ­¤å¤–ï¼Œå®ƒè¦æ±‚<code>Reachability</code>å¯¹è±¡é»˜è®¤å°† WWANï¼ˆ3G / EDGE / CDMAï¼‰èœ‚çªç½‘ç»œè§†ä¸ºä¸å¯è¾¾çš„è¿æ¥ï¼ˆå¦‚æœä½ æ­£åœ¨ç¼–å†™è§†é¢‘æµåº”ç”¨ç¨‹åºï¼ˆä¾‹å¦‚ï¼Œç”¨äºä¿å­˜ç”¨æˆ·çš„æ•°æ®è®¡åˆ’ï¼‰ï¼Œåˆ™å¯ä»¥ä½¿ç”¨æ­¤åŠŸèƒ½ï¼‰ã€‚</p>
<h4>In Objective-C</h4>
<p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">// é€šè¿‡æŒ‡å®šåŸŸåçš„æ–¹å¼åˆ›å»º reachability å¯¹è±¡</span><br><span class="line">Reachability* reach = [Reachability reachabilityWithHostname:@&quot;www.google.com&quot;];</span><br><span class="line"></span><br><span class="line">// ä¸åˆ¤æ–­èœ‚çªç½‘ç»œæ˜¯å¦å¯ç”¨</span><br><span class="line">reach.reachableOnWWAN = NO;</span><br><span class="line"></span><br><span class="line">// Here we set up a NSNotification observer. The Reachability that caused the notification</span><br><span class="line">// is passed in the object parameter</span><br><span class="line">[[NSNotificationCenter defaultCenter] addObserver:self</span><br><span class="line">                                         selector:@selector(reachabilityChanged:)</span><br><span class="line">                                             name:kReachabilityChangedNotification</span><br><span class="line">                                           object:nil];</span><br><span class="line"></span><br><span class="line">[reach startNotifier];</span><br></pre></td></tr></table></figure></p>
<p>æ¥æ”¶é€šçŸ¥çš„æ–¹æ³•ï¼š</p>
<p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">-(void)reachabilityChanged:(NSNotification*)note</span><br><span class="line">&#123;</span><br><span class="line">    Reachability * reach = [note object];</span><br><span class="line">    if([reach isReachable])</span><br><span class="line">    &#123;</span><br><span class="line">        NSString * temp = [NSString stringWithFormat:@&quot;GOOGLE Notification Says Reachable(%@)&quot;, reach.currentReachabilityString];</span><br><span class="line">        NSLog(@&quot;%@&quot;, temp);</span><br><span class="line">    &#125;</span><br><span class="line">    else</span><br><span class="line">    &#123;</span><br><span class="line">        NSString * temp = [NSString stringWithFormat:@&quot;GOOGLE Notification Says Unreachable(%@)&quot;, reach.currentReachabilityString];</span><br><span class="line">        NSLog(@&quot;%@&quot;, temp);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h4>In Swift 3</h4>
<p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Reachability</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> reach: <span class="type">Reachability?</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">application</span><span class="params">(<span class="number">_</span> application: UIApplication, didFinishLaunchingWithOptions launchOptions: [UIApplicationLaunchOptionsKey: <span class="keyword">Any</span>]?)</span></span> -&gt; <span class="type">Bool</span> &#123;</span><br><span class="line">    <span class="comment">// Allocate a reachability object</span></span><br><span class="line">    <span class="keyword">self</span>.reach = <span class="type">Reachability</span>.forInternetConnection()</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// Tell the reachability that we DON'T want to be reachable on 3G/EDGE/CDMA</span></span><br><span class="line">    <span class="keyword">self</span>.reach!.reachableOnWWAN = <span class="literal">false</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// Here we set up a NSNotification observer. The Reachability that caused the notification</span></span><br><span class="line">    <span class="comment">// is passed in the object parameter</span></span><br><span class="line">    <span class="type">NotificationCenter</span>.<span class="keyword">default</span>.addObserver(</span><br><span class="line">        <span class="keyword">self</span>,</span><br><span class="line">        selector: #selector(reachabilityChanged),</span><br><span class="line">        name: <span class="type">NSNotification</span>.<span class="type">Name</span>.reachabilityChanged,</span><br><span class="line">        object: <span class="literal">nil</span></span><br><span class="line">    )</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">self</span>.reach!.startNotifier()</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">&#125;</span><br><span class="line">        </span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">reachabilityChanged</span><span class="params">(notification: NSNotification)</span></span> &#123;</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">self</span>.reach!.isReachableViaWiFi() || <span class="keyword">self</span>.reach!.isReachableViaWWAN() &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"Service avalaible!!!"</span>)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"No service avalaible!!!"</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2>Tell the world</h2>
<p>Head over to <a href="https://github.com/tonymillion/Reachability/wiki/Projects-using-Reachability" target="_blank" rel="noopener">Projects using Reachability</a> and add your project for &quot;Maximum Wins!&quot;.</p>
<h2>å°ç»“ï¼š</h2>
<ol>
<li>åˆ›å»º <strong>Reachability</strong> å¯¹è±¡çš„æ–¹æ³•æœ‰ä¸‰ç§ï¼š</li>
</ol>
<p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">+(instancetype)reachabilityWithHostName:(NSString*)hostname; // æŒ‡å®šåŸŸå</span><br><span class="line">+(instancetype)reachabilityForInternetConnection; // é€šç”¨ç½‘ç»œè¿æ¥</span><br><span class="line">+(instancetype)reachabilityWithAddress:(void *)hostAddress; // æŒ‡å®šåœ°å€</span><br><span class="line">+(instancetype)reachabilityForLocalWiFi; // æŒ‡å®šWi-Fiç½‘ç»œ</span><br></pre></td></tr></table></figure></p>
<ol start="2">
<li>
<p>å¯é€‰è®¾ç½®ï¼Œæ˜¯å¦å¿½è§†èœ‚çªç½‘ç»œå¯è¾¾æ€§</p>
<p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">@property (nonatomic, assign) BOOL reachableOnWWAN;</span><br></pre></td></tr></table></figure></p>
</li>
<li>
<p>ç›‘å¬ç½‘ç»œå¯è¾¾æ€§çš„æ–¹æ³•æœ‰ä¸¤ç§ï¼š</p>
<p>2.1 Blocks æ–¹å¼</p>
<p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">@property (nonatomic, copy) NetworkReachable    reachableBlock;</span><br><span class="line">@property (nonatomic, copy) NetworkUnreachable  unreachableBlock;</span><br></pre></td></tr></table></figure></p>
<p>2.2 é€šçŸ¥æ–¹å¼</p>
<p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[[NSNotificationCenter defaultCenter] addObserver:self </span><br><span class="line">                                         selector:@selector(reachabilityChanged:) </span><br><span class="line">                                             name:kReachabilityChangedNotification </span><br><span class="line">                                           object:nil];</span><br></pre></td></tr></table></figure></p>
</li>
<li>
<p>å¼€å§‹ã€åœæ­¢ç›‘å¬</p>
<p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">-(BOOL)startNotifier;</span><br><span class="line">-(void)stopNotifier;</span><br></pre></td></tr></table></figure></p>
</li>
</ol>
<h3>å®ä¾‹ä»£ç ï¼š</h3>
<p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">// ç½‘ç»œå¯è¾¾æ€§æ£€æŸ¥</span><br><span class="line">Reachability *reachability = [Reachability reachabilityWithHostName:URL_HOST];</span><br><span class="line">reachability.reachableBlock = ^(Reachability *reachability) &#123;</span><br><span class="line">    // 3.0s åæ‰§è¡ŒåŠ è½½ä»»åŠ¡</span><br><span class="line">    // é»˜è®¤æƒ…å†µä¸‹ï¼Œåˆ‡æ¢åˆ°ä¸»çº¿ç¨‹æ›´æ–°UIï¼Œè¿™é‡Œå»¶è¿Ÿ3ç§’æ˜¯ä¸ºäº†å¤šæ—‹è½¬ä¸€ä¼šèŠèŠ±ç”¨çš„ã€‚</span><br><span class="line">    dispatch_after(dispatch_time(DISPATCH_TIME_NOW, (int64_t)(3.0 * NSEC_PER_SEC)), dispatch_get_main_queue(), ^&#123;</span><br><span class="line">        // è¿æ¥æœåŠ¡å™¨</span><br><span class="line">        [self connectToServer];</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;;</span><br><span class="line">reachability.unreachableBlock = ^(Reachability *reachability) &#123;</span><br><span class="line">    dispatch_after(dispatch_time(DISPATCH_TIME_NOW, (int64_t)(3.0 * NSEC_PER_SEC)), dispatch_get_main_queue(), ^&#123;</span><br><span class="line">        self.emptyDescription = @&quot;æ— æ³•è®¿é—®æœåŠ¡å™¨ï¼Œè¯·ç¨åå†è¯•ã€‚&quot;;</span><br><span class="line">        self.displayEmptyDataSet = YES;</span><br><span class="line">        self.loading = NO;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;;</span><br><span class="line">[reachability startNotifier];</span><br></pre></td></tr></table></figure></p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://andy0570.com/2017/12/07/Tomcatå®‰è£…åŠé…ç½®/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ç‹¬æœ¨èˆŸçš„æœ¨">
      <meta itemprop="description" content="æœ‰æ—¶å€™é˜³å…‰å¾ˆå¥½ æœ‰æ—¶å€™é˜³å…‰å¾ˆæš—">
      <meta itemprop="image" content="https://blog-andy0570-1256077835.cos.ap-shanghai.myqcloud.com/site_Images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ç‹¬æœ¨èˆŸçš„æœ¨">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2017/12/07/Tomcatå®‰è£…åŠé…ç½®/" class="post-title-link" itemprop="url">Tomcatå®‰è£…åŠé…ç½®</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              

              
                
              

              <time title="åˆ›å»ºæ—¶é—´ï¼š2017-12-07 12:50:00" itemprop="dateCreated datePublished" datetime="2017-12-07T12:50:00+08:00">2017-12-07</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">æ›´æ–°äº</span>
                
                <time title="ä¿®æ”¹æ—¶é—´ï¼š2019-05-01 22:24:06" itemprop="dateModified" datetime="2019-05-01T22:24:06+08:00">2019-05-01</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/äº‘è®¡ç®—/" itemprop="url" rel="index"><span itemprop="name">äº‘è®¡ç®—</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          

          

          
            <div class="post-symbolscount">
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">æœ¬æ–‡å­—æ•°ï¼š</span>
                
                <span title="æœ¬æ–‡å­—æ•°">1.2k</span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">é˜…è¯»æ—¶é•¿ &asymp;</span>
                
                <span title="é˜…è¯»æ—¶é•¿">1 åˆ†é’Ÿ</span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body han-init-context" itemprop="articleBody">

      
      

      
        
          
            <p><a href="http://wiki.jikexueyuan.com/project/tomcat/" target="_blank" rel="noopener">Tomcat 8æƒå¨æŒ‡å—</a>
<a href="http://tomcat.apache.org/tomcat-8.0-doc/RUNNING.txt" target="_blank" rel="noopener">RUNNING.txt</a></p>
<h3>UNIX æŒ‡ä»¤è·¯å¾„</h3>
<table>
<thead>
<tr>
<th>UNIX æŒ‡ä»¤</th>
<th>æ³¨é‡Š</th>
</tr>
</thead>
<tbody>
<tr>
<td>/</td>
<td>æ ¹è·¯å¾„</td>
</tr>
<tr>
<td>./</td>
<td>å½“å‰è·¯å¾„</td>
</tr>
<tr>
<td>../</td>
<td>ä¸Šä¸€çº§è·¯å¾„</td>
</tr>
</tbody>
</table>
<p>&lt;!-- more --&gt;</p>
<h3>Tomcat ç›®å½•ç»“æ„åŠä½œç”¨</h3>
<table>
<thead>
<tr>
<th>ç›®å½•</th>
<th>æ³¨é‡Š</th>
</tr>
</thead>
<tbody>
<tr>
<td>$CATALINA_HOME</td>
<td>Tomcat å®‰è£…çš„æ ¹ç›®å½•</td>
</tr>
<tr>
<td>/bin</td>
<td>å­˜æ”¾ç”¨äºå¯åŠ¨åŠå…³é—­çš„æ–‡ä»¶ï¼Œä»¥åŠå…¶ä»–ä¸€äº›è„šæœ¬ã€‚å…¶ä¸­ï¼ŒUNIX ç³»ç»Ÿä¸“ç”¨çš„ <code>*.sh</code> æ–‡ä»¶åœ¨åŠŸèƒ½ä¸Šç­‰åŒäº Windows ç³»ç»Ÿä¸“ç”¨çš„ <code>*.bat</code> æ–‡ä»¶ã€‚å› ä¸º Win32 çš„å‘½ä»¤è¡Œç¼ºä¹æŸäº›åŠŸèƒ½ï¼Œæ‰€ä»¥åˆé¢å¤–åœ°åŠ å…¥äº†ä¸€äº›æ–‡ä»¶ã€‚</td>
</tr>
<tr>
<td>/conf</td>
<td>é…ç½®æ–‡ä»¶åŠç›¸å…³çš„ DTDã€‚å…¶ä¸­æœ€é‡è¦çš„æ–‡ä»¶æ˜¯ server.xmlï¼Œè¿™æ˜¯å®¹å™¨çš„ä¸»é…ç½®æ–‡ä»¶ã€‚</td>
</tr>
<tr>
<td>/lib</td>
<td>æ”¯æŒtomcatè½¯ä»¶è¿è¡Œçš„jaråŒ…ã€‚å…¶ä¸­è¿˜æœ‰æŠ€æœ¯æ”¯æŒåŒ…ï¼Œå¦‚servletï¼Œjsp</td>
</tr>
<tr>
<td>/logs</td>
<td>æ—¥å¿—æ–‡ä»¶çš„é»˜è®¤ç›®å½•ã€‚</td>
</tr>
<tr>
<td>/webapps</td>
<td>å­˜æ”¾ Web åº”ç”¨çš„ç›¸å…³æ–‡ä»¶ã€‚</td>
</tr>
<tr>
<td>/work</td>
<td>Webåº”ç”¨ç¨‹åºçš„ä¸´æ—¶å·¥ä½œç›®å½•ã€‚</td>
</tr>
<tr>
<td>/temp</td>
<td>JVMç”¨äºä¸´æ—¶æ–‡ä»¶çš„ç›®å½•ï¼ˆjava.io.tmpdirï¼‰</td>
</tr>
</tbody>
</table>
<h2>Mac ç³»ç»Ÿä¸‹ Tomcat å®‰è£…åŠé…ç½®</h2>
<h3>ä¸€ã€ä¸‹è½½</h3>
<p>ä¸‹è½½é¡µï¼šhttps://tomcat.apache.org/download-80.cgi</p>
<p>ä¸‹è½½æ–‡ä»¶åŒ…åï¼Œè§£å‹æ‹·è´åˆ°ï¼š<code>/Library</code>ï¼ˆMacintosh HD - èµ„æºåº“ï¼‰ ç›®å½•ä¸‹ï¼Œé‡å‘½åä¸º <code>Tomcat8524</code></p>
<p>åˆ‡æ¢åˆ° Tomcat çš„ bin ç›®å½•ä¸‹ï¼š<code>cd /Library/Tomcat8524/bin</code></p>
<p>ä¿®æ”¹æƒé™ï¼š<code>sudo chmod 755 ./*.sh</code></p>
<p>å¯åŠ¨ Tomcatï¼š<code>./startup.sh</code></p>
<p>æ§åˆ¶å°è¾“å‡ºæ—¥å¿—å¦‚ä¸‹ï¼š</p>
<p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Using <span class="string">CATALINA_BASE:</span>   <span class="regexp">/Library/</span>Tomcat8524</span><br><span class="line">Using <span class="string">CATALINA_HOME:</span>   <span class="regexp">/Library/</span>Tomcat8524</span><br><span class="line">Using <span class="string">CATALINA_TMPDIR:</span> <span class="regexp">/Library/</span>Tomcat8524/temp</span><br><span class="line">Using <span class="string">JRE_HOME:</span>        <span class="regexp">/Library/</span>Java<span class="regexp">/JavaVirtualMachines/</span>jdk1<span class="number">.8</span><span class="number">.0</span>_152.jdk<span class="regexp">/Contents/</span>Home</span><br><span class="line">Using <span class="string">CLASSPATH:</span>       <span class="regexp">/Library/</span>Tomcat8524<span class="regexp">/bin/</span>bootstrap.<span class="string">jar:</span><span class="regexp">/Library/</span>Tomcat8524<span class="regexp">/bin/</span>tomcat-juli.jar</span><br><span class="line">Tomcat started.</span><br></pre></td></tr></table></figure></p>
<p>æ‰“å¼€æµè§ˆå™¨è¾“å…¥ç½‘å€éªŒè¯ï¼š<code>http://localhost:8080</code></p>
<p>å…³é—­ Tomcatï¼š<code>./shutdown.sh</code></p>
<h3>å‚è€ƒ</h3>
<ul>
<li><a href="http://www.jb51.net/article/94201.htm" target="_blank" rel="noopener">Macç¯å¢ƒä¸‹é…ç½®tomcatçš„æ­¥éª¤è¯¦è§£</a></li>
</ul>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/11/"><i class="fa fa-angle-left" aria-label="ä¸Šä¸€é¡µ"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/11/">11</a><span class="page-number current">12</span><a class="page-number" href="/page/13/">13</a><span class="space">&hellip;</span><a class="page-number" href="/page/32/">32</a><a class="extend next" rel="next" href="/page/13/"><i class="fa fa-angle-right" aria-label="ä¸‹ä¸€é¡µ"></i></a>
  </nav>



          </div>
          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <div class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image" src="https://blog-andy0570-1256077835.cos.ap-shanghai.myqcloud.com/site_Images/avatar.png" alt="ç‹¬æœ¨èˆŸçš„æœ¨">
            
              <p class="site-author-name" itemprop="name">ç‹¬æœ¨èˆŸçš„æœ¨</p>
              <div class="site-description motion-element" itemprop="description">æœ‰æ—¶å€™é˜³å…‰å¾ˆå¥½ æœ‰æ—¶å€™é˜³å…‰å¾ˆæš—</div>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/">
                
                    <span class="site-state-item-count">316</span>
                    <span class="site-state-item-name">æ—¥å¿—</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-categories">
                  
                    
                      <a href="/categories/">
                    
                  
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">14</span>
                    <span class="site-state-item-name">åˆ†ç±»</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-tags">
                  
                    
                      <a href="/tags/">
                    
                  
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">36</span>
                    <span class="site-state-item-name">æ ‡ç­¾</span>
                  </a>
                </div>
              
            </nav>
          

          
            <div class="feed-link motion-element">
              <a href="/atom.xml" rel="alternate">
                <i class="fa fa-rss"></i>
                RSS
              </a>
            </div>
          

          

          
            <div class="links-of-author motion-element">
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                    
                  
                  <a href="https://github.com/Andy0570" title="GitHub &rarr; https://github.com/Andy0570" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i>GitHub</a>
                </span>
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                    
                  
                  <a href="mailto:andywhm@163.com" title="E-Mail &rarr; mailto:andywhm@163.com" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                </span>
              
            </div>
          

          
             <div class="cc-license motion-element" itemprop="license">
              
              
                
              
              
              
              <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" class="cc-opacity" rel="noopener" target="_blank"><img src="/images/cc-by-nc-sa.svg" alt="Creative Commons"></a>
             </div>
          

          
          

          
            
          
          

        </div>
      </div>

      

      

    </div>
  </aside>
  


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js">
</script>
<div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love" id="animate">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">ç‹¬æœ¨èˆŸçš„æœ¨</span>

  
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-area-chart"></i>
    </span>
    
    <span title="ç«™ç‚¹æ€»å­—æ•°">2.2m</span>
  

  
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    
    <span title="ç«™ç‚¹é˜…è¯»æ—¶é•¿">32:53</span>
  
</div>



  <span id="busuanzi_container_site_uv">
  æœ¬ç«™è®¿å®¢æ•°<span id="busuanzi_value_site_uv"></span>äººæ¬¡
  </span>
  <span class="post-meta-divider">|</span>

  <div class="powered-by">ç”± <a href="https://hexo.io" class="theme-link" rel="noopener" target="_blank">Hexo</a> å¼ºåŠ›é©±åŠ¨ v3.8.0</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">ä¸»é¢˜ â€“ <a href="https://theme-next.org" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> v7.1.0</div>




        








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

    

    
  </div>

  

<script>
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>





  



  






  



  
    
    
      
    
  
  <script color="17,119,176" opacity="0.5" zindex="-1" count="99" src="//cdn.jsdelivr.net/gh/theme-next/theme-next-canvas-nest@1/canvas-nest.min.js"></script>













  
  <script src="//cdn.jsdelivr.net/npm/jquery@2/dist/jquery.min.js"></script>

  
  <script src="//cdn.jsdelivr.net/npm/fastclick@1/lib/fastclick.min.js"></script>

  
  <script src="//cdn.jsdelivr.net/npm/jquery-lazyload@1/jquery.lazyload.min.js"></script>

  
  <script src="//cdn.jsdelivr.net/npm/velocity-animate@1/velocity.min.js"></script>

  
  <script src="//cdn.jsdelivr.net/npm/velocity-animate@1/velocity.ui.min.js"></script>

  
  <script src="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.js"></script>


  


  <script src="/js/utils.js?v=7.1.0"></script>

  <script src="/js/motion.js?v=7.1.0"></script>



  
  


  <script src="/js/affix.js?v=7.1.0"></script>

  <script src="/js/schemes/pisces.js?v=7.1.0"></script>




  

  


  <script src="/js/next-boot.js?v=7.1.0"></script>


  

  

  
  
  
    
  

  
    
      
    
  

  
  
  
    <script src="//cdn.jsdelivr.net/npm/quicklink@1/dist/quicklink.umd.js"></script>
    <script>
      
        window.addEventListener('load', () => {
      
        quicklink({
          timeout: 3000,
          priority: true,
          ignores: [uri => uri.includes('#'),uri => uri == 'https://andy0570.com/page/12/',]
        });
      
        });
      
    </script>
  


  



  



  
  
  
    
  
  <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/instantsearch.js@2/dist/instantsearch.min.css">

  
  
    
  
  <script src="//cdn.jsdelivr.net/npm/instantsearch.js@2/dist/instantsearch.js"></script>
  

  <script src="/js/algolia-search.js?v=7.1.0"></script>



  

  

  

  

  

  

  

  

  

  
  
  
    
  
  <script src="//cdn.jsdelivr.net/npm/pangu@4/dist/browser/pangu.min.js"></script>
  <script>pangu.spacingPage();</script>


  
  
  
    
  
  <script src="//cdn.jsdelivr.net/gh/theme-next/theme-next-bookmark@1/bookmark.min.js"></script>
  <script>
  
    bookmark.loadBookmark();
  
  </script>


  

  

  
  
</body>
</html>
