<!DOCTYPE html>












  


<html class="theme-next gemini use-motion" lang="zh-CN">
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">




  
  
    
      
    
    
      
    
  <script src="//cdn.jsdelivr.net/npm/pace-js@1/pace.min.js"></script>
  <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/pace-js@1/themes/blue/pace-theme-minimal.css">



  
  
    
  
  <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/han-css@3/dist/han.min.css">













  
  
    
  
  <link rel="stylesheet" href="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.css">







  

<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/font-awesome@4/css/font-awesome.min.css">

<link rel="stylesheet" href="/css/main.css?v=7.1.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/panda/apple-touch-icon.png?v=7.1.0">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/panda/favicon-32x32.png?v=7.1.0">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/panda/favicon-16x16.png?v=7.1.0">


  <link rel="mask-icon" href="/images/panda/safari-pinned-tab.svg?v=7.1.0" color="#222">


  <link rel="manifest" href="/images/panda/site.webmanifest">


  <meta name="msapplication-config" content="/images/panda/browserconfig.xml">





<script id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '7.1.0',
    sidebar: {"position":"left","display":"post","offset":12,"onmobile":false,"dimmer":false},
    back2top: true,
    back2top_sidebar: false,
    fancybox: true,
    fastclick: true,
    lazyload: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  <meta name="description" content="æœ‰æ—¶å€™é˜³å…‰å¾ˆå¥½ æœ‰æ—¶å€™é˜³å…‰å¾ˆæš—">
<meta name="keywords" content="ç‹¬æœ¨èˆŸçš„æœ¨">
<meta property="og:type" content="website">
<meta property="og:title" content="ç‹¬æœ¨èˆŸçš„æœ¨">
<meta property="og:url" content="https://andy0570.com/page/16/index.html">
<meta property="og:site_name" content="ç‹¬æœ¨èˆŸçš„æœ¨">
<meta property="og:description" content="æœ‰æ—¶å€™é˜³å…‰å¾ˆå¥½ æœ‰æ—¶å€™é˜³å…‰å¾ˆæš—">
<meta property="og:locale" content="zh-CN">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="ç‹¬æœ¨èˆŸçš„æœ¨">
<meta name="twitter:description" content="æœ‰æ—¶å€™é˜³å…‰å¾ˆå¥½ æœ‰æ—¶å€™é˜³å…‰å¾ˆæš—">



  <link rel="alternate" href="/atom.xml" title="ç‹¬æœ¨èˆŸçš„æœ¨" type="application/atom+xml">



  
  
  <link rel="canonical" href="https://andy0570.com/page/16/">



<script id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>ç‹¬æœ¨èˆŸçš„æœ¨</title>
  






  <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?8229a094facca297f211d61323fd9fde";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>







  <noscript>
  <style>
  .use-motion .motion-element,
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-title { opacity: initial; }

  .use-motion .logo,
  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-CN">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <a href="https://github.com/andy0570" class="github-corner" aria-label="View source on GitHub"><svg width="80" height="80" viewbox="0 0 250 250" style="fill:#151513; color:#fff; position: absolute; top: 0; border: 0; right: 0;" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"/><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"/><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"/></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style>
    
    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">ç‹¬æœ¨èˆŸçš„æœ¨</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
      
        <p class="site-subtitle">iOS Developer</p>
      
    
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="åˆ‡æ¢å¯¼èˆªæ ">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home">

    
    
    
      
    

    
      
    

    <a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i> <br>é¦–é¡µ</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-categories">

    
    
    
      
    

    
      
    

    <a href="/categories/" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i> <br>åˆ†ç±»<span class="badge">15</span></a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-tags">

    
    
    
      
    

    
      
    

    <a href="/tags/" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i> <br>æ ‡ç­¾<span class="badge">76</span></a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">

    
    
    
      
    

    
      
    

    <a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i> <br>å½’æ¡£<span class="badge">311</span></a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-about">

    
    
    
      
    

    
      
    

    <a href="/about/" rel="section"><i class="menu-item-icon fa fa-fw fa-user"></i> <br>å…³äº</a>

  </li>

      
      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br>æœç´¢</a>
        </li>
      
    </ul>
  

  

  
    <div class="site-search">
      
  
  <div class="algolia-popup popup search-popup">
    <div class="algolia-search">
      <div class="algolia-search-input-icon">
        <i class="fa fa-search"></i>
      </div>
      <div class="algolia-search-input" id="algolia-search-input"></div>
    </div>

    <div class="algolia-results">
      <div id="algolia-stats"></div>
      <div id="algolia-hits"></div>
      <div id="algolia-pagination" class="algolia-pagination"></div>
    </div>

    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
  </div>




    </div>
  
</nav>



  



</div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
            

          
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://andy0570.com/2017/09/03/å¤©å¤©å“å°iOS7ç”œç‚¹ Day2ï¼šAsset Catalog/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ç‹¬æœ¨èˆŸçš„æœ¨">
      <meta itemprop="description" content="æœ‰æ—¶å€™é˜³å…‰å¾ˆå¥½ æœ‰æ—¶å€™é˜³å…‰å¾ˆæš—">
      <meta itemprop="image" content="https://ws1.sinaimg.cn/large/006tNc79gy1g22m14458rj30u014xu0x.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ç‹¬æœ¨èˆŸçš„æœ¨">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2017/09/03/å¤©å¤©å“å°iOS7ç”œç‚¹ Day2ï¼šAsset Catalog/" class="post-title-link" itemprop="url">å¤©å¤©å“å°iOS7ç”œç‚¹ Day2ï¼šAsset Catalog</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              

              
                
              

              <time title="åˆ›å»ºæ—¶é—´ï¼š2017-09-03 16:02:00" itemprop="dateCreated datePublished" datetime="2017-09-03T16:02:00+08:00">2017-09-03</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">æ›´æ–°äº</span>
                
                <time title="ä¿®æ”¹æ—¶é—´ï¼š2019-04-17 15:23:38" itemprop="dateModified" datetime="2019-04-17T15:23:38+08:00">2019-04-17</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/iOS/" itemprop="url" rel="index"><span itemprop="name">iOS</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          
            <span id="/2017/09/03/å¤©å¤©å“å°iOS7ç”œç‚¹ Day2ï¼šAsset Catalog/" class="leancloud_visitors" data-flag-title="å¤©å¤©å“å°iOS7ç”œç‚¹ Day2ï¼šAsset Catalog">
              <span class="post-meta-divider">|</span>
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              
                <span class="post-meta-item-text">é˜…è¯»æ¬¡æ•°ï¼š</span>
              
                <span class="leancloud-visitors-count"></span>
            </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body han-init-context" itemprop="articleBody">

      
      

      
        
          
            <a id="more"></a>
<blockquote>
<p>Asset Catalogs (èµ„äº§åˆ†ç±»)ï¼Œå®ƒå¯ä»¥ç®¡ç†ç‰©ç†å›¾åƒæ–‡ä»¶å’Œè¿™äº›æ–‡ä»¶çš„ä¸Šä¸‹æ–‡ä¿¡æ¯ã€‚</p>
</blockquote>
<h3 id="å‚è€ƒï¼š"><a href="#å‚è€ƒï¼š" class="headerlink" title="å‚è€ƒï¼š"></a>å‚è€ƒï¼š</h3><ul>
<li><a href="https://github.com/ShinobiControls/iOS7-day-by-day" target="_blank" rel="noopener">GitHub æºç ï¼šshinobicontrols/iOS7-day-by-day</a></li>
<li><a href="http://blog.kingiol.com/2014/01/06/ios7-day-by-day-day1-nsurlsession/" target="_blank" rel="noopener">å¤©å¤©å“å°iOS7ç”œç‚¹ :: Day 1 :: NSURLSession</a></li>
<li><a href="[https://zhuanlan.zhihu.com/p/34474502](https://zhuanlan.zhihu.com/p/34474502">çŸ¥ä¹ä¸“æ ï¼šiOS æ¸©ä¹ ä¹‹è·¯ â€ Bundle â€œ</a><br>)</li>
</ul>
<h3 id="Asset-Catalog-èµ„äº§åˆ†ç±»"><a href="#Asset-Catalog-èµ„äº§åˆ†ç±»" class="headerlink" title="Asset Catalog - èµ„äº§åˆ†ç±»"></a>Asset Catalog - èµ„äº§åˆ†ç±»</h3><ul>
<li>èµ„äº§åˆ†ç±»ç›®å½•ç”±ä¸€äº›å›¾åƒçš„é›†åˆã€appå›¾æ ‡å’Œappå¯åŠ¨é¡µæ„æˆã€‚</li>
<li>æ–°å»ºå·¥ç¨‹æ—¶ï¼ŒXcode ä¼šè‡ªåŠ¨åˆ›å»ºä¸€ä¸ªåä¸º <code>Assets.xcassets</code> çš„æ–‡ä»¶å¤¹ã€‚</li>
<li><strong>Asset catalogs</strong> æ˜¯å­˜åœ¨åœ¨ç¡¬ç›˜ä¸Šé¢çš„ä¸€ä¸ªç›®å½•ï¼Œç”±Xcodeè¿›è¡Œç®¡ç†ã€‚å®ƒä»¥ç‰¹å®šçš„æ–¹å¼è¿›è¡Œæ–‡ä»¶çš„æ’åˆ—ï¼ŒåŒ…å«ä¸€ä¸ªjsonæ–‡ä»¶å­˜å‚¨ç›®å½•ç›¸å…³è”çš„å…ƒæ•°æ®:</li>
</ul>
<p><img src="http://upload-images.jianshu.io/upload_images/2648731-150af677a9501486.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt></p>
<h3 id="App-icons-and-launch-images"><a href="#App-icons-and-launch-images" class="headerlink" title="App icons and launch images"></a>App icons and launch images</h3><p><strong>Asset catalog</strong>(èµ„äº§åˆ†ç±»)é»˜è®¤è‡ªåŠ¨åˆ›å»ºï¼Œåä¸º<code>Assets.xcassets</code>,åŒ…å«<code>AppIcon</code>çš„å…¥å£ã€‚æä¾›äº†æ„å»ºåº”ç”¨çš„æ‰€æœ‰éœ€è¦çš„å›¾æ ‡çš„å°ºå¯¸ï¼š</p>
<p><code>LaunchImage</code> ç›®å½•éœ€è¦è‡ªå·±åˆ›å»ºï¼š<strong>é¼ æ ‡å³å‡»</strong> â€”â€” <strong>App Icons &amp; Launch Images</strong> â€”â€” <strong>New iOS Launch Image</strong></p>
<p><img src="http://upload-images.jianshu.io/upload_images/2648731-9e6e5f0f4a2bd48e.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt></p>
<h3 id="Custom-imagesets-è‡ªå®šä¹‰å›¾åƒé›†"><a href="#Custom-imagesets-è‡ªå®šä¹‰å›¾åƒé›†" class="headerlink" title="Custom imagesets - è‡ªå®šä¹‰å›¾åƒé›†"></a>Custom imagesets - è‡ªå®šä¹‰å›¾åƒé›†</h3><p>å’Œæ ‡å‡†çš„é›†åˆä¸€æ ·ï¼Œä½ å¯ä»¥ä½¿ç”¨ <code>asset catalogs</code> æ¥ç®¡ç†ä½ è‡ªå·±çš„å›¾ç‰‡ï¼Œå›¾ç‰‡éƒ½æ˜¯åŒ…å«åœ¨<code>ImageSet</code>ä¸­çš„ï¼Œå¹¶ä¸”å¯ä»¥ä½¿ç”¨ç®¡ç†å¯¹åº”çš„retinaå’Œéretinaå›¾åƒã€‚</p>
<p><img src="http://upload-images.jianshu.io/upload_images/2648731-c45211ef7b702134.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt></p>
<p>ä½¿ç”¨æ–¹æ³•ï¼š<code>UIImage:imageNamed:</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">UIImage *image = [UIImage imageNamed:@&quot;Australia&quot;];</span><br></pre></td></tr></table></figure>
<blockquote>
<p>ğŸ’¡ åŠ è½½å›¾ç‰‡è¿˜æ¶‰åŠåˆ°ç¼“å­˜é—®é¢˜ï¼Œå‚è€ƒä¹‹å‰å†™çš„æ–‡ç« ï¼š</p>
<p><a href="http://www.jianshu.com/p/9d858f073863" target="_blank" rel="noopener">UIImage ä½¿ç”¨Tips</a></p>
</blockquote>
<h3 id="Slicing-images-åˆ‡ç‰‡å›¾åƒ"><a href="#Slicing-images-åˆ‡ç‰‡å›¾åƒ" class="headerlink" title="Slicing images - åˆ‡ç‰‡å›¾åƒ"></a>Slicing images - åˆ‡ç‰‡å›¾åƒ</h3><p>Asset catalogs çš„å¦å¤–ä¸€ä¸ªä¸»è¦çš„ç‰¹æ€§å°±æ˜¯èƒ½å¤Ÿè®©å›¾åƒè¿›è¡Œåˆ‡ç‰‡å·¥ä½œï¼Œè‡ªä»iOS2å¼€å§‹ç¨‹åºå°±èƒ½å¤Ÿä½¿ç”¨åˆ‡ç‰‡çš„å›¾åƒäº†ï¼Œä½†æ˜¯Xcodeä¸­çš„è¿™ä¸ªæ–°ç‰¹æ€§ä¼šå˜å¾—éå¸¸çš„ç®€å•ã€‚</p>
<p>ä½¿ç”¨åˆ‡ç‰‡å˜æ¢å›¾åƒï¼Œæ˜¯åˆ›å»ºè™šæ‹Ÿçš„å…ƒç´ åŸºæœ¬çš„æŠ€æœ¯ã€‚ä¾‹å¦‚æŒ‰é’®ï¼Œéœ€è¦æ‹‰ä¼¸è¿™ä¸ªæŒ‰é’®å›¾ç‰‡çš„å¤§å°è¾¾åˆ°ä¸€ä¸ªæ–°çš„å¤§å°ï¼Œå¹¶ä¸”è¦è®¾ç½®è¾¹ç¼˜ä¸è¢«æ‹‰ä¼¸ï¼Œåªæ‹‰ä¼¸ä¸­é—´çš„éƒ¨åˆ†ã€‚</p>
<p>åœ¨ Asset catalog ä¸­å°±å¯ä»¥ä½¿ç”¨Xcodeæä¾›çš„åŠŸèƒ½è¿›è¡Œåˆ‡ç‰‡æ“ä½œäº†ï¼Œå¼€å¯åˆ‡ç‰‡åŠŸèƒ½ï¼Œåªéœ€è¦ç‚¹å‡»<code>Show Slicing</code>æŒ‰é’®,ä½ å¯ä»¥é€‰æ‹©æ°´å¹³ã€ç«–ç›´æˆ–è€…ä¸¤è€…éƒ½æ‹‰ä¼¸çš„æ–¹å¼,å¦‚æœä½ é€‰æ‹©ä¹‹åï¼Œå›¾åƒå°†ä¼šé‡æ–°åŠ è½½å¹¶ä¸”ä¸Šé¢ä¼šå‡ºç°æ‹‰ä¼¸è¾…åŠ©çº¿ï¼Œä½ å¯ä»¥é€šè¿‡æ‹–æ‹½è¾…åŠ©çº¿ï¼Œæ¥å®ç°è‡ªå·±éœ€è¦æ‹‰ä¼¸çš„æ•ˆæœã€‚</p>
<p><img src="http://upload-images.jianshu.io/upload_images/2648731-5c9dbd1c1d1cb5fc.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt></p>
<p>ä½¿ç”¨è¿™äº›åˆ‡ç‰‡å›¾åƒç¼–ç¨‹éå¸¸çš„ç®€å•ï¼Œå’Œä¹‹å‰ä¸€æ ·åˆ›å»ºä¸€ä¸ª<code>UIImage</code>å¯¹è±¡ï¼Œç„¶åå½“ä½ è°ƒæ•´<code>UIImageView</code>çš„å¤§å°ï¼Œå†…éƒ¨çš„imageå°±ä¼šè‡ªåŠ¨æ ¹æ®åˆ‡ç‰‡çš„å›¾åƒæ¥å˜æ¢å¤§å°ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">UIImage *btnImage = [UIImage imageNamed:@&quot;ButtonSlice&quot;];</span><br><span class="line"></span><br><span class="line">// Let&apos;s make 2</span><br><span class="line">UIImageView *iv = [[UIImageView alloc] initWithImage:btnImage];</span><br><span class="line">iv.bounds = CGRectMake(0, 0, 150, CGRectGetHeight(iv.bounds));</span><br><span class="line">iv.center = CGPointMake(CGRectGetWidth(self.view.bounds) / 2, 300);</span><br><span class="line">[self.view addSubview:iv];</span><br><span class="line"></span><br><span class="line">// And a stretched version</span><br><span class="line">iv = [[UIImageView alloc] initWithImage:btnImage];</span><br><span class="line">iv.bounds = CGRectMake(0, 0, 300, CGRectGetHeight(iv.bounds));</span><br><span class="line">iv.center = CGPointMake(CGRectGetWidth(self.view.bounds) / 2, 350);</span><br><span class="line">[self.view addSubview:iv];</span><br></pre></td></tr></table></figure>
<p><img src="http://upload-images.jianshu.io/upload_images/2648731-8432361523807bac.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt></p>
<h4 id="æ­¥éª¤è¯¦è§£ï¼š"><a href="#æ­¥éª¤è¯¦è§£ï¼š" class="headerlink" title="æ­¥éª¤è¯¦è§£ï¼š"></a>æ­¥éª¤è¯¦è§£ï¼š</h4><ol>
<li>ç‚¹å‡»<code>Show Slicing</code> æŒ‰é’®ï¼Ÿ</li>
</ol>
<p><img src="http://upload-images.jianshu.io/upload_images/2648731-cd88e8678434b63e.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt></p>
<ol start="2">
<li><p>é€‰æ‹©æ‹‰ä¼¸æ¨¡å¼ï¼š</p>
<p>æ”¯æŒä¸‰ç§æ¨¡å¼ï¼šæ°´å¹³æ‹‰ä¼¸ã€æ°´å¹³å’Œå‚ç›´åŒæ—¶æ‹‰ä¼¸ã€å‚ç›´æ‹‰ä¼¸ã€‚</p>
<p><img src="http://upload-images.jianshu.io/upload_images/2648731-f1909fb40c77e4ef.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt></p>
</li>
<li><p>è®¾ç½®æ‹‰ä¼¸å¥æŸ„ï¼š</p>
<p><img src="http://upload-images.jianshu.io/upload_images/2648731-b85d5761d488b606.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt></p>
</li>
<li><p>ä»£ç æ·»åŠ å›¾ç‰‡ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">UIImage *image = [UIImage imageNamed:@&quot;bird&quot;];</span><br><span class="line"></span><br><span class="line">// default</span><br><span class="line">UIImageView *imageView = [[UIImageView alloc] initWithImage:image];</span><br><span class="line">imageView.bounds = CGRectMake(0, 0, 50, 37.5);</span><br><span class="line">imageView.center = CGPointMake(CGRectGetWidth(self.view.bounds) / 2, 300);</span><br><span class="line">[self.view addSubview:imageView];</span><br><span class="line"></span><br><span class="line">// stretch</span><br><span class="line">UIImageView *stretchImgView = [[UIImageView alloc] initWithImage:image];</span><br><span class="line">stretchImgView.bounds = CGRectMake(0, 0, 100, 75);</span><br><span class="line">stretchImgView.center = CGPointMake(CGRectGetWidth(self.view.bounds) / 2, 400);</span><br><span class="line">[self.view addSubview:stretchImgView];</span><br></pre></td></tr></table></figure>
</li>
<li><p>æ•ˆæœï¼šç”¨ã€å¡«å……éƒ¨åˆ†ã€‘å»è¦†ç›–ã€å¯æ‰©å±•éƒ¨åˆ†ã€‘</p>
<p><img src="http://upload-images.jianshu.io/upload_images/2648731-015b0aee4eea6dde.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt></p>
</li>
</ol>
<h3 id="ImageOptim-è¶…å¥½ç”¨çš„å›¾åƒå‹ç¼©å·¥å…·"><a href="#ImageOptim-è¶…å¥½ç”¨çš„å›¾åƒå‹ç¼©å·¥å…·" class="headerlink" title="ImageOptim - è¶…å¥½ç”¨çš„å›¾åƒå‹ç¼©å·¥å…·"></a>ImageOptim - è¶…å¥½ç”¨çš„å›¾åƒå‹ç¼©å·¥å…·</h3><p><a href="https://imageoptim.com/mac" target="_blank" rel="noopener">ImageOptim</a> æ˜¯ä¸€ä¸ªå…è´¹çš„å›¾åƒå‹ç¼©å·¥å…·ã€‚iOS å·¥ç¨‹é»˜è®¤ä½¿ç”¨ pngcrush å‘½ä»¤æ¥å‹ç¼©æ•°æ®ï¼Œä¸è¿‡å…¶å‹ç¼©æ¯”ç‡ä¸æ˜¯å¾ˆé«˜ã€‚è€Œä½¿ç”¨ <strong>ImageOptim</strong> å¯ä»¥è¾¾åˆ°æœ€å¤§çš„å›¾ç‰‡å‹ç¼©æ•ˆæœã€‚</p>
<p>å®ç°åŸç†ï¼šä½¿ç”¨å„ç§å¼€æºçš„å›¾åƒå‹ç¼©å·¥å…·ï¼Œç„¶åå–å‹ç¼©æ•ˆæœæœ€å¥½çš„é‚£ä¸€ä¸ªã€‚</p>
<p>ä½¿ç”¨æ–¹æ³•ä¹Ÿéå¸¸ç®€å•ï¼šåœ¨ Finder ä¸­æ‰“å¼€å›¾ç‰‡æ‰€åœ¨çš„æ–‡ä»¶å¤¹ï¼Œå°†å›¾ç‰‡æ‹–æ‹½è¿› <strong>ImageOptim</strong> ç•Œé¢ä¸­å³å¯ã€‚</p>
<p>å…¶ä»–å›¾åƒå‹ç¼©å·¥å…·ï¼š</p>
<ul>
<li><a href="http://optimizilla.com/zh/" target="_blank" rel="noopener">Optimizilla</a> â€”â€”åœ¨çº¿å›¾åƒä¼˜åŒ–å‹ç¼©å™¨</li>
</ul>
<h3 id="é™„å½•ï¼š"><a href="#é™„å½•ï¼š" class="headerlink" title="é™„å½•ï¼š"></a>é™„å½•ï¼š</h3><p>æ‘˜è‡ªå®˜æ–¹äººæœºäº¤äº’æŒ‡å—ï¼š<a href="https://developer.apple.com/ios/human-interface-guidelines/#//apple_ref/doc/uid/TP40006556-CH27-SW1" target="_blank" rel="noopener">iOS Human Interface Guidelines</a></p>
<h4 id="å›¾ç‰‡å¤§å°å’Œåˆ†è¾¨ç‡ï¼ˆImage-Size-and-Resolutionï¼‰"><a href="#å›¾ç‰‡å¤§å°å’Œåˆ†è¾¨ç‡ï¼ˆImage-Size-and-Resolutionï¼‰" class="headerlink" title="å›¾ç‰‡å¤§å°å’Œåˆ†è¾¨ç‡ï¼ˆImage Size and Resolutionï¼‰"></a>å›¾ç‰‡å¤§å°å’Œåˆ†è¾¨ç‡ï¼ˆImage Size and Resolutionï¼‰</h4><table>
<thead>
<tr>
<th>è®¾å¤‡</th>
<th>æ¯”ä¾‹ç³»æ•°</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>iPhone 7 Plus and iPhone 6s Plus</strong></td>
<td>@3x</td>
</tr>
<tr>
<td><strong>å…¶ä½™é«˜åˆ†è¾¨ç‡çš„ iOS è®¾å¤‡</strong></td>
<td>@2x</td>
</tr>
</tbody>
</table>
<h5 id="App-Icon"><a href="#App-Icon" class="headerlink" title="App Icon"></a>App Icon</h5><table>
<thead>
<tr>
<th>è®¾å¤‡æˆ–çŠ¶å†µ</th>
<th>å›¾æ ‡å¤§å°</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>iPhone</strong></td>
<td>180px Ã— 180px (60pt Ã— 60pt @3x)</td>
</tr>
<tr>
<td></td>
<td>120px Ã— 120px (60pt Ã— 60pt @2x)</td>
</tr>
<tr>
<td><strong>iPad Pro</strong></td>
<td>167px Ã— 167px (83.5pt Ã— 83.5pt @2x)</td>
</tr>
<tr>
<td><strong>iPad, iPad mini</strong></td>
<td>152px Ã— 152px (76pt Ã— 76pt @2x)</td>
</tr>
<tr>
<td><strong>App Store</strong></td>
<td>1024px Ã— 1024px</td>
</tr>
</tbody>
</table>
<h5 id="Spotlight-Settings-and-Notification-Icons"><a href="#Spotlight-Settings-and-Notification-Icons" class="headerlink" title="Spotlight, Settings, and Notification Icons"></a>Spotlight, Settings, and Notification Icons</h5><h5 id="Spotlight"><a href="#Spotlight" class="headerlink" title="Spotlight"></a>Spotlight</h5><table>
<thead>
<tr>
<th>è®¾å¤‡</th>
<th>Spotlight å›¾æ ‡å¤§å°</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>iPhone</strong></td>
<td>120px Ã— 120px (40pt Ã— 40pt @3x)</td>
</tr>
<tr>
<td></td>
<td>80px Ã— 80px (40pt Ã— 40pt @2x)</td>
</tr>
<tr>
<td><strong>iPad Pro, iPad, iPad mini</strong></td>
<td>80px Ã— 80px (40pt Ã— 40pt @2x)</td>
</tr>
</tbody>
</table>
<hr>
<h5 id="Settings"><a href="#Settings" class="headerlink" title="Settings"></a>Settings</h5><table>
<thead>
<tr>
<th>è®¾å¤‡</th>
<th>Settings å›¾æ ‡å¤§å°</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>iPhone</strong></td>
<td>87px Ã— 87px (29pt Ã— 29pt @3x)</td>
</tr>
<tr>
<td></td>
<td>58px Ã— 58px (29pt Ã— 29pt @2x)</td>
</tr>
<tr>
<td><strong>iPad Pro, iPad, iPad mini</strong></td>
<td>58px Ã— 58px (29pt Ã— 29pt @2x)</td>
</tr>
</tbody>
</table>
<hr>
<h5 id="Notification"><a href="#Notification" class="headerlink" title="Notification"></a>Notification</h5><table>
<thead>
<tr>
<th>è®¾å¤‡</th>
<th>Notification å›¾æ ‡å¤§å°</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>iPhone</strong></td>
<td>60px Ã— 60px (20pt Ã— 20pt @3x)</td>
</tr>
<tr>
<td></td>
<td>40px Ã— 40px (20pt Ã— 20pt @2x)</td>
</tr>
<tr>
<td><strong>iPad Pro, iPad, iPad mini</strong></td>
<td>40px Ã— 40px (20pt Ã— 20pt @2x)</td>
</tr>
</tbody>
</table>
<h5 id="è‡ªå®šä¹‰å›¾æ ‡å¤§å°"><a href="#è‡ªå®šä¹‰å›¾æ ‡å¤§å°" class="headerlink" title="è‡ªå®šä¹‰å›¾æ ‡å¤§å°"></a>è‡ªå®šä¹‰å›¾æ ‡å¤§å°</h5><table>
<thead>
<tr>
<th></th>
<th>å¯¼èˆªæ å’Œå·¥å…·æ å›¾æ ‡å°ºå¯¸</th>
<th>æ ‡ç­¾æ å›¾æ ‡å°ºå¯¸</th>
</tr>
</thead>
<tbody>
<tr>
<td>æ¨è</td>
<td>75px Ã— 75px (25pt Ã— 25pt @3x)</td>
<td>75px Ã— 75px (25pt Ã— 25pt @3x)</td>
</tr>
<tr>
<td></td>
<td>50px Ã— 50px (25pt Ã— 25pt @2x)</td>
<td>50px Ã— 50px (25pt Ã— 25pt @2x)</td>
</tr>
<tr>
<td>æœ€å¤§</td>
<td>83px Ã— 83px (27.67pt Ã— 27.67pt @3x)</td>
<td>144px Ã— 96px (48pt Ã— 32pt @3x)</td>
</tr>
<tr>
<td></td>
<td>56px Ã— 56px (28pt Ã— 28pt @2x)</td>
<td>96px Ã— 64px (48pt Ã— 32pt @2x)</td>
</tr>
</tbody>
</table>
<h4 id="å¯åŠ¨ç”»é¢ï¼ˆLaunch-Screenï¼‰"><a href="#å¯åŠ¨ç”»é¢ï¼ˆLaunch-Screenï¼‰" class="headerlink" title="å¯åŠ¨ç”»é¢ï¼ˆLaunch Screenï¼‰"></a>å¯åŠ¨ç”»é¢ï¼ˆLaunch Screenï¼‰</h4><h5 id="é™æ€å¯åŠ¨ç”»é¢å›¾ç‰‡"><a href="#é™æ€å¯åŠ¨ç”»é¢å›¾ç‰‡" class="headerlink" title="é™æ€å¯åŠ¨ç”»é¢å›¾ç‰‡"></a>é™æ€å¯åŠ¨ç”»é¢å›¾ç‰‡</h5><table>
<thead>
<tr>
<th>è®¾å¤‡</th>
<th>Portrait size</th>
<th>Landscape size</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>iPhone 7 Plus, iPhone 6s Plus</strong></td>
<td>1242px Ã— 2208px</td>
<td>2208px Ã— 1242px</td>
</tr>
<tr>
<td><strong>iPhone 7, iPhone 6s</strong></td>
<td>750px Ã— 1334px</td>
<td>1334px Ã— 750px</td>
</tr>
<tr>
<td><strong>iPhone SE</strong></td>
<td>640px Ã— 1136px</td>
<td>1136px Ã— 640px</td>
</tr>
<tr>
<td><strong>12.9-inch iPad Pro</strong></td>
<td>2048px Ã— 2732px</td>
<td>2732px Ã— 2048px</td>
</tr>
<tr>
<td><strong>9.7-inch iPad Pro, iPad Air 2, iPad mini 4, iPad mini 2</strong></td>
<td>1536px Ã— 2048px</td>
<td>2048px Ã— 1536px</td>
</tr>
</tbody>
</table>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://andy0570.com/2017/09/01/å¤©å¤©å“å°iOS7ç”œç‚¹ Day1ï¼šNSURLSession/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ç‹¬æœ¨èˆŸçš„æœ¨">
      <meta itemprop="description" content="æœ‰æ—¶å€™é˜³å…‰å¾ˆå¥½ æœ‰æ—¶å€™é˜³å…‰å¾ˆæš—">
      <meta itemprop="image" content="https://ws1.sinaimg.cn/large/006tNc79gy1g22m14458rj30u014xu0x.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ç‹¬æœ¨èˆŸçš„æœ¨">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2017/09/01/å¤©å¤©å“å°iOS7ç”œç‚¹ Day1ï¼šNSURLSession/" class="post-title-link" itemprop="url">å¤©å¤©å“å°iOS7ç”œç‚¹ Day1ï¼šNSURLSession</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              

              
                
              

              <time title="åˆ›å»ºæ—¶é—´ï¼š2017-09-01 15:26:00" itemprop="dateCreated datePublished" datetime="2017-09-01T15:26:00+08:00">2017-09-01</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">æ›´æ–°äº</span>
                
                <time title="ä¿®æ”¹æ—¶é—´ï¼š2019-04-17 15:24:47" itemprop="dateModified" datetime="2019-04-17T15:24:47+08:00">2019-04-17</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/iOS/" itemprop="url" rel="index"><span itemprop="name">iOS</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          
            <span id="/2017/09/01/å¤©å¤©å“å°iOS7ç”œç‚¹ Day1ï¼šNSURLSession/" class="leancloud_visitors" data-flag-title="å¤©å¤©å“å°iOS7ç”œç‚¹ Day1ï¼šNSURLSession">
              <span class="post-meta-divider">|</span>
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              
                <span class="post-meta-item-text">é˜…è¯»æ¬¡æ•°ï¼š</span>
              
                <span class="leancloud-visitors-count"></span>
            </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body han-init-context" itemprop="articleBody">

      
      

      
        
          
            <a id="more"></a>
<p>ä¸ <strong>NSURLSession</strong> API ç›¸å…³çš„å†…å®¹ã€‚</p>
<h3 id="å‚è€ƒï¼š"><a href="#å‚è€ƒï¼š" class="headerlink" title="å‚è€ƒï¼š"></a>å‚è€ƒï¼š</h3><ul>
<li><a href="https://github.com/ShinobiControls/iOS7-day-by-day" target="_blank" rel="noopener">GitHub æºç ï¼šshinobicontrols/iOS7-day-by-day</a></li>
<li><a href="http://blog.kingiol.com/2014/01/06/ios7-day-by-day-day1-nsurlsession/" target="_blank" rel="noopener">å¤©å¤©å“å°iOS7ç”œç‚¹ :: Day 1 :: NSURLSession</a></li>
</ul>
<h3 id="NSURLSessionConfiguration"><a href="#NSURLSessionConfiguration" class="headerlink" title="NSURLSessionConfiguration"></a>NSURLSessionConfiguration</h3><p>åˆ›å»º <strong>NSURLSessionConfiguration</strong> å¯¹è±¡çš„ä¸‰ç§æ–¹å¼ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">// é»˜è®¤ä¼šè¯é…ç½®</span><br><span class="line">NSURLSessionConfiguration *defaultConfig = [NSURLSessionConfiguration defaultSessionConfiguration];</span><br><span class="line"></span><br><span class="line">// çŸ­æš‚ä¼šè¯é…ç½®,æ— ç¼“å­˜(caches),cookies,è¯ä¹¦(credentials)</span><br><span class="line">NSURLSessionConfiguration *ephemeralConfig = [NSURLSessionConfiguration ephemeralSessionConfiguration];</span><br><span class="line"></span><br><span class="line">// åå°ä¼šè¯é…ç½®</span><br><span class="line">NSURLSessionConfiguration *backgroundConfig = [NSURLSessionConfiguration backgroundSessionConfigurationWithIdentifier:@&quot;com.Apple.BackgroundDownload.BackgroundSession&quot;];</span><br></pre></td></tr></table></figure>
<h3 id="NSURLSession"><a href="#NSURLSession" class="headerlink" title="NSURLSession"></a>NSURLSession</h3><p>åˆ›å»º <strong>NSURLSession</strong> å¯¹è±¡çš„ä¸‰ç§æ–¹å¼ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">// 1. å•ä¾‹ç±»ä¼šè¯,ä¾¿æ·åˆ›å»ºæ–¹æ³•</span><br><span class="line">NSURLSession *sharedSession = [NSURLSession sharedSession];</span><br><span class="line"></span><br><span class="line">// 2. sessionWithConfiguration:</span><br><span class="line">// ä¸€èˆ¬ç”¨ Block å¤„ç†æœåŠ¡å™¨å›è°ƒæ—¶ä½¿ç”¨</span><br><span class="line">// é»˜è®¤ä¼šè¯</span><br><span class="line">NSURLSession *defaultSession = [NSURLSession sessionWithConfiguration:defaultConfig];</span><br><span class="line">// çŸ­æš‚ä¼šè¯</span><br><span class="line">NSURLSession *ephemeralSesson = [NSURLSession sessionWithConfiguration:ephemeralConfig];</span><br><span class="line">// åå°ä¼šè¯</span><br><span class="line">NSURLSession *backgroundSession = [NSURLSession sessionWithConfiguration:backgroundConfig];</span><br><span class="line"></span><br><span class="line">// 3. sessionWithConfiguration:delegate:delegateQueue:</span><br><span class="line">// éœ€è¦å®ç°å§”æ‰˜åè®®æˆ–è€…æŒ‡å®šçº¿ç¨‹çš„åˆ›å»ºæ–¹æ³•</span><br><span class="line">NSOperationQueue *operationQueue = [NSOperationQueue mainQueue];</span><br><span class="line">// é»˜è®¤ä¼šè¯</span><br><span class="line">NSURLSession *defalutSession1 = [NSURLSession sessionWithConfiguration:defaultConfig delegate:self delegateQueue:operationQueue];</span><br><span class="line">// çŸ­æš‚ä¼šè¯</span><br><span class="line">NSURLSession *ephemeralSesson1 = [NSURLSession sessionWithConfiguration:ephemeralConfig delegate:self delegateQueue:operationQueue];</span><br><span class="line">// åå°ä¼šè¯</span><br><span class="line">NSURLSession *backgroundSession1 = [NSURLSession sessionWithConfiguration:backgroundConfig delegate:self delegateQueue:operationQueue];</span><br></pre></td></tr></table></figure>
<h4 id="NSURLSessionTask"><a href="#NSURLSessionTask" class="headerlink" title="NSURLSessionTask"></a>NSURLSessionTask</h4><p>âš ï¸ åˆ›å»º <strong>NSURLSessionTask</strong> å¯¹è±¡æœ‰å››ç§ç§æ–¹å¼ï¼š</p>
<blockquote>
<ol>
<li>æ•°æ®ä»»åŠ¡(NSURLSessionDataTask)</li>
<li>ä¸Šä¼ ä»»åŠ¡(NSURLSessionUploadTask)</li>
<li>ä¸‹è½½ä»»åŠ¡(NSURLSessionDownloadTask)</li>
<li>æµä»»åŠ¡ï¼ˆNSURLSessionStreamTaskï¼‰ï¼šWWDC2015æ–°å¢ï¼Œæä¾› TCP/IP è¿æ¥æ¥å£ã€‚</li>
</ol>
</blockquote>
<p><img src="http://upload-images.jianshu.io/upload_images/2648731-7c60b3982ce6f2c8.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt></p>
<h4 id="NSURLSessionDelegate-å§”æ‰˜åè®®"><a href="#NSURLSessionDelegate-å§”æ‰˜åè®®" class="headerlink" title="NSURLSessionDelegate å§”æ‰˜åè®®"></a>NSURLSessionDelegate å§”æ‰˜åè®®</h4><p><img src="http://upload-images.jianshu.io/upload_images/2648731-5845fcbe4e8a35c5.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt></p>
<p>ç¤ºä¾‹ Demo</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br></pre></td><td class="code"><pre><span class="line">// *************************************************</span><br><span class="line">// SCViewController.h</span><br><span class="line">#import &lt;UIKit/UIKit.h&gt;</span><br><span class="line"></span><br><span class="line">@interface SCViewController : UIViewController</span><br><span class="line"></span><br><span class="line">@property (strong, nonatomic) NSURLSessionDownloadTask *resumableTask;   // å¯æ¢å¤ä»»åŠ¡</span><br><span class="line">@property (strong, nonatomic) NSURLSessionDownloadTask *backgroundTask;  // åå°ä»»åŠ¡</span><br><span class="line"></span><br><span class="line">@property (strong, nonatomic, readonly) NSURLSession *backgroundSession; // åå°ä¼šè¯</span><br><span class="line"></span><br><span class="line">@property (weak, nonatomic) IBOutlet UIImageView *imageView;</span><br><span class="line">@property (weak, nonatomic) IBOutlet UIProgressView *progressIndicator;</span><br><span class="line">@property (strong, nonatomic) IBOutletCollection(UIBarButtonItem) NSArray *startButtons;</span><br><span class="line"></span><br><span class="line">- (IBAction)startCancellable:(id)sender;  // å¼€å§‹ä»»åŠ¡</span><br><span class="line">- (IBAction)cancelCancellable:(id)sender; // å–æ¶ˆä»»åŠ¡</span><br><span class="line">- (IBAction)startResumable:(id)sender;    // æ¢å¤ä»»åŠ¡</span><br><span class="line">- (IBAction)startBackground:(id)sender;   // åå°ä»»åŠ¡</span><br><span class="line"></span><br><span class="line">@end</span><br><span class="line"></span><br><span class="line">// *************************************************</span><br><span class="line">// SCViewController.m</span><br><span class="line">#import &quot;SCViewController.h&quot;</span><br><span class="line">#import &quot;SCAppDelegate.h&quot;</span><br><span class="line"></span><br><span class="line">@interface SCViewController () &lt;NSURLSessionDownloadDelegate&gt; &#123;</span><br><span class="line">    NSURLSessionDownloadTask *cancellableTask; // å¯å–æ¶ˆä»»åŠ¡</span><br><span class="line">    NSURLSession *inProcessSession; // ç§æœ‰ä¼šè¯</span><br><span class="line">    NSData *partialDownload; // åå°ä¸‹è½½ä¸´æ—¶æ•°æ®</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@end</span><br><span class="line"></span><br><span class="line">@implementation SCViewController</span><br><span class="line"></span><br><span class="line">#pragma mark - Lifecycle</span><br><span class="line">- (void)viewDidLoad</span><br><span class="line">&#123;</span><br><span class="line">    [super viewDidLoad];</span><br><span class="line">	// ä» nib æ–‡ä»¶åŠ è½½è§†å›¾åï¼Œè¿›è¡Œé¢å¤–çš„åˆå§‹åŒ–å·¥ä½œ</span><br><span class="line">    self.progressIndicator.hidden = YES;</span><br><span class="line">    self.progressIndicator.progress = 0;</span><br><span class="line">    </span><br><span class="line">    // Make sure that we&apos;ve attached to the background session</span><br><span class="line">    self.backgroundSession.sessionDescription = @&quot;Background session&quot;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#pragma mark - Custom Accessors</span><br><span class="line">// åå°ä¼šè¯ï¼Œå•ä¾‹ç±»</span><br><span class="line">- (NSURLSession *)backgroundSession</span><br><span class="line">&#123;</span><br><span class="line">    static NSURLSession *backgroundSession = nil;</span><br><span class="line">    static dispatch_once_t onceToken;</span><br><span class="line">    dispatch_once(&amp;onceToken, ^&#123;</span><br><span class="line">        NSURLSessionConfiguration *config = [NSURLSessionConfiguration backgroundSessionConfigurationWithIdentifier:@&quot;com.shinobicontrols.BackgroundDownload.BackgroundSession&quot;];</span><br><span class="line">        backgroundSession = [NSURLSession sessionWithConfiguration:config</span><br><span class="line">                                                          delegate:self</span><br><span class="line">                                                     delegateQueue:nil];</span><br><span class="line">    &#125;);</span><br><span class="line">    return backgroundSession;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#pragma mark - IBActions</span><br><span class="line">// å¼€å§‹ä»»åŠ¡</span><br><span class="line">- (IBAction)startCancellable:(id)sender &#123;</span><br><span class="line">    if (!cancellableTask) &#123;</span><br><span class="line">        if(!inProcessSession) &#123;</span><br><span class="line">            // åˆ›å»ºé»˜è®¤ä¼šè¯</span><br><span class="line">            NSURLSessionConfiguration *sessionConfig = [NSURLSessionConfiguration defaultSessionConfiguration];</span><br><span class="line">            inProcessSession = [NSURLSession sessionWithConfiguration:sessionConfig</span><br><span class="line">                                                             delegate:self</span><br><span class="line">                                                        delegateQueue:nil];</span><br><span class="line">            inProcessSession.sessionDescription = @&quot;in-process NSURLSession&quot;;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        // Image CreativeCommons courtesy of flickr.com/charliematters</span><br><span class="line">        NSString *url = @&quot;http://farm6.staticflickr.com/5505/9824098016_0e28a047c2_b_d.jpg&quot;;</span><br><span class="line">        NSURLRequest *request = [NSURLRequest requestWithURL:[NSURL URLWithString:url]];</span><br><span class="line">        </span><br><span class="line">        // åˆ›å»ºå¯å–æ¶ˆä»»åŠ¡</span><br><span class="line">        cancellableTask = [inProcessSession downloadTaskWithRequest:request];</span><br><span class="line">        </span><br><span class="line">        [self setDownloadButtonsAsEnabled:NO];</span><br><span class="line">        self.imageView.hidden = YES;</span><br><span class="line">        </span><br><span class="line">        // å¼€å¯ä¸‹è½½ä»»åŠ¡</span><br><span class="line">        [cancellableTask resume];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// å–æ¶ˆä»»åŠ¡</span><br><span class="line">- (IBAction)cancelCancellable:(id)sender &#123;</span><br><span class="line">    if(cancellableTask) &#123;</span><br><span class="line">        // 1. å¯å–æ¶ˆä»»åŠ¡</span><br><span class="line">        [cancellableTask cancel];</span><br><span class="line">        cancellableTask = nil;</span><br><span class="line">    &#125; else if(self.resumableTask) &#123;</span><br><span class="line">        // 2. å¯æ¢å¤ä»»åŠ¡</span><br><span class="line">        [self.resumableTask cancelByProducingResumeData:^(NSData *resumeData) &#123;</span><br><span class="line">            // â‡ï¸ ç¼“å­˜å·²ä¸‹è½½æ•°æ®</span><br><span class="line">            partialDownload = resumeData;</span><br><span class="line">            self.resumableTask = nil;</span><br><span class="line">        &#125;];</span><br><span class="line">    &#125; else if(self.backgroundTask) &#123;</span><br><span class="line">        // 3. åå°ä»»åŠ¡</span><br><span class="line">        [self.backgroundTask cancel];</span><br><span class="line">        self.backgroundTask = nil;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// æ¢å¤ä»»åŠ¡</span><br><span class="line">- (IBAction)startResumable:(id)sender &#123;</span><br><span class="line">    if(!self.resumableTask) &#123;</span><br><span class="line">        if(!inProcessSession) &#123;</span><br><span class="line">            // åˆ›å»ºé»˜è®¤ä¼šè¯</span><br><span class="line">            NSURLSessionConfiguration *sessionConfig = [NSURLSessionConfiguration defaultSessionConfiguration];</span><br><span class="line">            inProcessSession = [NSURLSession sessionWithConfiguration:sessionConfig delegate:self delegateQueue:nil];</span><br><span class="line">            inProcessSession.sessionDescription = @&quot;in-process NSURLSession&quot;;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        if(partialDownload) &#123;</span><br><span class="line">            // 1. å¦‚æœå­˜åœ¨ç¼“å­˜æ•°æ®ï¼Œç»§ç»­ä¸‹è½½æ­¤ä»»åŠ¡</span><br><span class="line">            self.resumableTask = [inProcessSession downloadTaskWithResumeData:partialDownload];</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            // 2. å¦‚æœä¸å­˜åœ¨ç¼“å­˜ï¼Œæ–°å»ºå¯æ¢å¤ä»»åŠ¡</span><br><span class="line">            // Image CreativeCommons courtesy of flickr.com/charliematters</span><br><span class="line">            NSString *url = @&quot;http://farm3.staticflickr.com/2846/9823925914_78cd653ac9_b_d.jpg&quot;;</span><br><span class="line">            NSURLRequest *request = [NSURLRequest requestWithURL:[NSURL URLWithString:url]];</span><br><span class="line">            // åˆ›å»ºå¯æ¢å¤ä»»åŠ¡</span><br><span class="line">            self.resumableTask = [inProcessSession downloadTaskWithRequest:request];</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        [self setDownloadButtonsAsEnabled:NO];</span><br><span class="line">        self.imageView.hidden = YES;</span><br><span class="line">        </span><br><span class="line">        // å¼€å¯ä¸‹è½½ä»»åŠ¡</span><br><span class="line">        [self.resumableTask resume];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// å¼€å§‹åå°ä»»åŠ¡</span><br><span class="line">- (IBAction)startBackground:(id)sender &#123;</span><br><span class="line">    // Image CreativeCommons courtesy of flickr.com/charliematters</span><br><span class="line">    NSString *url = @&quot;http://farm3.staticflickr.com/2831/9823890176_82b4165653_b_d.jpg&quot;;</span><br><span class="line">    NSURLRequest *request = [NSURLRequest requestWithURL:[NSURL URLWithString:url]];</span><br><span class="line">    </span><br><span class="line">    // self.backgroundSession æ˜¯å•ä¾‹å¯¹è±¡</span><br><span class="line">    self.backgroundTask = [self.backgroundSession downloadTaskWithRequest:request];</span><br><span class="line">    </span><br><span class="line">    [self setDownloadButtonsAsEnabled:NO];</span><br><span class="line">    self.imageView.hidden = YES;</span><br><span class="line">    </span><br><span class="line">    // å¼€å¯ä¸‹è½½ä»»åŠ¡</span><br><span class="line">    [self.backgroundTask resume];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#pragma mark - Private</span><br><span class="line">- (void)setDownloadButtonsAsEnabled:(BOOL)enabled</span><br><span class="line">&#123;</span><br><span class="line">    // æ›´æ–°æŒ‰é’® enable çŠ¶æ€</span><br><span class="line">    for(UIBarButtonItem *btn in self.startButtons) &#123;</span><br><span class="line">        btn.enabled = enabled;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#pragma mark - NSURLSessionDownloadDelegate</span><br><span class="line"></span><br><span class="line">// è¿½è¸ªä¸‹è½½ä»»åŠ¡è¿›åº¦ï¼Œæ›´æ–°è¿›åº¦æ¡</span><br><span class="line">- (void)URLSession:(NSURLSession *)session downloadTask:(NSURLSessionDownloadTask *)downloadTask didWriteData:(int64_t)bytesWritten totalBytesWritten:(int64_t)totalBytesWritten totalBytesExpectedToWrite:(int64_t)totalBytesExpectedToWrite</span><br><span class="line">&#123;</span><br><span class="line">    double currentProgress = totalBytesWritten / (double)totalBytesExpectedToWrite;</span><br><span class="line">    dispatch_async(dispatch_get_main_queue(), ^&#123;</span><br><span class="line">        self.progressIndicator.hidden = NO;</span><br><span class="line">        self.progressIndicator.progress = currentProgress;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// æ¢å¤ä¸‹è½½åè°ƒç”¨</span><br><span class="line">- (void)URLSession:(NSURLSession *)session downloadTask:(NSURLSessionDownloadTask *)downloadTask didResumeAtOffset:(int64_t)fileOffset expectedTotalBytes:(int64_t)expectedTotalBytes</span><br><span class="line">&#123;</span><br><span class="line">    // Leave this for now</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// ä¸‹è½½ä»»åŠ¡æˆåŠŸåè°ƒç”¨</span><br><span class="line">- (void)URLSession:(NSURLSession *)session downloadTask:(NSURLSessionDownloadTask *)downloadTask didFinishDownloadingToURL:(NSURL *)location</span><br><span class="line">&#123;</span><br><span class="line">    // We&apos;ve successfully finished the download. Let&apos;s save the file</span><br><span class="line">    // ä¿å­˜åˆ°æ–‡ä»¶</span><br><span class="line">    NSFileManager *fileManager = [NSFileManager defaultManager];</span><br><span class="line">    </span><br><span class="line">    NSArray *URLs = [fileManager URLsForDirectory:NSDocumentDirectory inDomains:NSUserDomainMask];</span><br><span class="line">    NSURL *documentsDirectory = URLs[0];</span><br><span class="line">    </span><br><span class="line">    NSURL *destinationPath = [documentsDirectory URLByAppendingPathComponent:[location lastPathComponent]];</span><br><span class="line">    NSError *error;</span><br><span class="line">    </span><br><span class="line">    // å…ˆåˆ é™¤æ–‡ä»¶ä¸­å·²ç»å­˜åœ¨çš„ä»»ä½•æ–‡ä»¶</span><br><span class="line">    [fileManager removeItemAtURL:destinationPath error:NULL];</span><br><span class="line">    BOOL success = [fileManager copyItemAtURL:location toURL:destinationPath error:&amp;error];</span><br><span class="line">    </span><br><span class="line">    if (success) &#123;</span><br><span class="line">        // ä¿å­˜åˆ°æ–‡ä»¶åï¼Œæ›´æ–°ä¸»çº¿ç¨‹ UI</span><br><span class="line">        dispatch_async(dispatch_get_main_queue(), ^&#123;</span><br><span class="line">            UIImage *image = [UIImage imageWithContentsOfFile:[destinationPath path]];</span><br><span class="line">            self.imageView.image = image;</span><br><span class="line">            self.imageView.contentMode = UIViewContentModeScaleAspectFill;</span><br><span class="line">            self.imageView.hidden = NO;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;else &#123;</span><br><span class="line">        NSLog(@&quot;Couldn&apos;t copy the downloaded file&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    // â‡ï¸ ä¼šè¯ç½®ç©ºï¼Œè§£é™¤å¾ªç¯å¼•ç”¨</span><br><span class="line">    if(downloadTask == cancellableTask) &#123;</span><br><span class="line">        cancellableTask = nil;</span><br><span class="line">    &#125; else if (downloadTask == self.resumableTask) &#123;</span><br><span class="line">        self.resumableTask = nil;</span><br><span class="line">        partialDownload = nil;</span><br><span class="line">    &#125; else if (session == self.backgroundSession) &#123;</span><br><span class="line">        // åå°ä¼šè¯</span><br><span class="line">        self.backgroundTask = nil;</span><br><span class="line">        // Get hold of the app delegate</span><br><span class="line">        SCAppDelegate *appDelegate = (SCAppDelegate *)[[UIApplication sharedApplication] delegate];</span><br><span class="line">        if(appDelegate.backgroundURLSessionCompletionHandler) &#123;</span><br><span class="line">            // Need to copy the completion handler</span><br><span class="line">            void (^handler)() = appDelegate.backgroundURLSessionCompletionHandler;</span><br><span class="line">            appDelegate.backgroundURLSessionCompletionHandler = nil;</span><br><span class="line">            handler();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#pragma mark - NSURLSessionTaskDelegate</span><br><span class="line">// æ¯ä¸€ä¸ªä»»åŠ¡ç»“æŸçš„æ—¶å€™æ‰§è¡Œ-NSURLSessionDelegate,ä¸ç®¡ä»»åŠ¡æ˜¯ä¸æ˜¯æ­£å¸¸ç»“æŸ:</span><br><span class="line">- (void)URLSession:(NSURLSession *)session task:(NSURLSessionTask *)task didCompleteWithError:(NSError *)error &#123;</span><br><span class="line">    // ä¸»çº¿ç¨‹æ›´æ–° UI</span><br><span class="line">    dispatch_async(dispatch_get_main_queue(), ^&#123;</span><br><span class="line">        self.progressIndicator.hidden = YES;</span><br><span class="line">        [self setDownloadButtonsAsEnabled:YES];</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@end</span><br></pre></td></tr></table></figure>
<p>å¼€å¯åå°ä¸‹è½½ä»»åŠ¡æ—¶ï¼Œå³ä½¿å…³é—­äº†åº”ç”¨ç¨‹åºï¼Œè¿™ä¸ªä¸‹è½½ä»»åŠ¡ä¾ç„¶åœ¨åå°è¿è¡Œã€‚</p>
<p>å½“è¿™ä¸ªä¸‹è½½ä»»åŠ¡å®Œæˆåï¼ŒiOSå°†ä¼šé‡æ–°å¯åŠ¨appæ¥è®©ä»»åŠ¡çŸ¥é“ï¼Œå¯¹è¿™ä¸ªæˆ‘ä»¬ä¸å¿…æ”¾åœ¨å¿ƒä¸Šã€‚ä¸ºäº†è¾¾åˆ°è¿™ä¸ªç›®çš„ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨appçš„ä»£ç†ä¸­è°ƒç”¨ä¸‹é¢çš„ä»£ç :</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">- (void)application:(UIApplication *)application handleEventsForBackgroundURLSession:(NSString *)identifier completionHandler:(void (^)())completionHandler</span><br><span class="line">&#123;</span><br><span class="line">    self.backgroundURLSessionCompletionHandler = completionHandler;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="æ•ˆæœ"><a href="#æ•ˆæœ" class="headerlink" title="æ•ˆæœ"></a>æ•ˆæœ</h3><p><img src="http://upload-images.jianshu.io/upload_images/2648731-26ce50a3e3637801.gif?imageMogr2/auto-orient/strip" alt></p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://andy0570.com/2017/09/01/å¤©å¤©å“å°iOS7ç”œç‚¹ Day0ï¼šUIKit Dynamics/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ç‹¬æœ¨èˆŸçš„æœ¨">
      <meta itemprop="description" content="æœ‰æ—¶å€™é˜³å…‰å¾ˆå¥½ æœ‰æ—¶å€™é˜³å…‰å¾ˆæš—">
      <meta itemprop="image" content="https://ws1.sinaimg.cn/large/006tNc79gy1g22m14458rj30u014xu0x.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ç‹¬æœ¨èˆŸçš„æœ¨">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2017/09/01/å¤©å¤©å“å°iOS7ç”œç‚¹ Day0ï¼šUIKit Dynamics/" class="post-title-link" itemprop="url">å¤©å¤©å“å°iOS7ç”œç‚¹ Day0ï¼šUIKit Dynamics</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              

              
                
              

              <time title="åˆ›å»ºæ—¶é—´ï¼š2017-09-01 11:08:00" itemprop="dateCreated datePublished" datetime="2017-09-01T11:08:00+08:00">2017-09-01</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">æ›´æ–°äº</span>
                
                <time title="ä¿®æ”¹æ—¶é—´ï¼š2019-04-17 15:25:46" itemprop="dateModified" datetime="2019-04-17T15:25:46+08:00">2019-04-17</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/iOS/" itemprop="url" rel="index"><span itemprop="name">iOS</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          
            <span id="/2017/09/01/å¤©å¤©å“å°iOS7ç”œç‚¹ Day0ï¼šUIKit Dynamics/" class="leancloud_visitors" data-flag-title="å¤©å¤©å“å°iOS7ç”œç‚¹ Day0ï¼šUIKit Dynamics">
              <span class="post-meta-divider">|</span>
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              
                <span class="post-meta-item-text">é˜…è¯»æ¬¡æ•°ï¼š</span>
              
                <span class="leancloud-visitors-count"></span>
            </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body han-init-context" itemprop="articleBody">

      
      

      
        
          
            <a id="more"></a>
<p><strong>UIKit Dyanmics</strong> æ˜¯ <strong>UIKit</strong> ä¸‹çš„ä¸€ä¸ªäºŒç»´çš„ç‰©ç†å¼•æ“ã€‚</p>
<h3 id="å‚è€ƒï¼š"><a href="#å‚è€ƒï¼š" class="headerlink" title="å‚è€ƒï¼š"></a>å‚è€ƒï¼š</h3><ul>
<li><a href="https://github.com/ShinobiControls/iOS7-day-by-day" target="_blank" rel="noopener">GitHub æºç ï¼šshinobicontrols/iOS7-day-by-day</a></li>
<li><a href="http://blog.kingiol.com/archives/page/4/" target="_blank" rel="noopener">å¤©å¤©å“å°iOS7ç”œç‚¹ :: Day 0 :: UIKit Dynamics</a></li>
</ul>
<h3 id="å…³é”®çš„å‡ ä¸ªç±»"><a href="#å…³é”®çš„å‡ ä¸ªç±»" class="headerlink" title="å…³é”®çš„å‡ ä¸ªç±»:"></a>å…³é”®çš„å‡ ä¸ªç±»:</h3><h4 id="UIDynamicBehavior-æ¨¡æ‹Ÿå¯¹è±¡çš„è¡Œä¸º"><a href="#UIDynamicBehavior-æ¨¡æ‹Ÿå¯¹è±¡çš„è¡Œä¸º" class="headerlink" title="UIDynamicBehavior æ¨¡æ‹Ÿå¯¹è±¡çš„è¡Œä¸º"></a>UIDynamicBehavior æ¨¡æ‹Ÿå¯¹è±¡çš„è¡Œä¸º</h4><p><img src="http://upload-images.jianshu.io/upload_images/2648731-2e35531f5b99135f.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt></p>
<h4 id="UIDynamicAnimator-ç‰©ç†å¼•æ“"><a href="#UIDynamicAnimator-ç‰©ç†å¼•æ“" class="headerlink" title="UIDynamicAnimator ç‰©ç†å¼•æ“"></a>UIDynamicAnimator ç‰©ç†å¼•æ“</h4><p><strong>UIDynamicAnimator</strong> è‡ªå·±å¯ä»¥æ ¹æ®ä¸åŒçš„è¡Œä¸ºæ¥è®¡ç®—ä¸åŒå¯¹è±¡é—´çš„ç›¸äº’å½±å“ã€‚</p>
<p><img src="http://upload-images.jianshu.io/upload_images/2648731-085e701454c319f3.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt></p>
<p>ä½¿ç”¨æ–¹æ³•æ€»ç»“ï¼š</p>
<ol>
<li>ç”¨ <strong>UIDynamicBehavior</strong> çš„å­ç±»å¯¹è±¡è®¾ç½®ä¸åŒç‰©ä½“å„è‡ªçš„è¡Œä¸ºæˆ–è€…å®ƒä»¬é€šç”¨çš„è¡Œä¸ºï¼Œç„¶åå°†å®ƒä»¬æ·»åŠ åˆ° <strong>UIDynamicBehavior</strong> å®ä¾‹å¯¹è±¡ä¸Šï¼Œ</li>
<li>å°† <strong>UIDynamicBehavior</strong> å®ä¾‹å¯¹è±¡æ·»åŠ åˆ° <strong>UIDynamicAnimator</strong> ç‰©ç†å¼•æ“ä¸Šã€‚</li>
</ol>
<h3 id="Demoæºç ï¼šç‰›é¡¿æ‘†é’Ÿ"><a href="#Demoæºç ï¼šç‰›é¡¿æ‘†é’Ÿ" class="headerlink" title="Demoæºç ï¼šç‰›é¡¿æ‘†é’Ÿ"></a>Demoæºç ï¼šç‰›é¡¿æ‘†é’Ÿ</h3><p>è¯¥ Demo æ„å»ºä¸€ä¸ªç‰›é¡¿æ‘†é’Ÿæ¨¡æ‹Ÿé‡åŠ›å®éªŒã€‚<br><img src="http://upload-images.jianshu.io/upload_images/2648731-ebc9eb7b16f37eab.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt></p>
<h4 id="SCBallBearingView"><a href="#SCBallBearingView" class="headerlink" title="SCBallBearingView"></a>SCBallBearingView</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">// **********************************************</span><br><span class="line">#import &lt;UIKit/UIKit.h&gt;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> åœ†å½¢é’Ÿæ‘†çƒæ¨¡å‹</span><br><span class="line"> */</span><br><span class="line">@interface SCBallBearingView : UIView</span><br><span class="line">@end</span><br><span class="line"></span><br><span class="line">// **********************************************</span><br><span class="line">#import &quot;SCBallBearingView.h&quot;</span><br><span class="line">@import QuartzCore;</span><br><span class="line"></span><br><span class="line">@implementation SCBallBearingView</span><br><span class="line"></span><br><span class="line">- (id)initWithFrame:(CGRect)frame</span><br><span class="line">&#123;</span><br><span class="line">    self = [super initWithFrame:frame];</span><br><span class="line">    if (self) &#123;</span><br><span class="line">        // åˆå§‹åŒ–ä»£ç </span><br><span class="line">        self.backgroundColor = [UIColor lightGrayColor];</span><br><span class="line">        self.layer.cornerRadius = MIN(CGRectGetHeight(frame), CGRectGetWidth(frame)) / 2.0;</span><br><span class="line">        self.layer.borderColor = [UIColor grayColor].CGColor;</span><br><span class="line">        self.layer.borderWidth = 2;</span><br><span class="line">    &#125;</span><br><span class="line">    return self;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@end</span><br></pre></td></tr></table></figure>
<h4 id="â‡ï¸-SCNewtonsCradleView"><a href="#â‡ï¸-SCNewtonsCradleView" class="headerlink" title="â‡ï¸ SCNewtonsCradleView"></a>â‡ï¸ SCNewtonsCradleView</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br></pre></td><td class="code"><pre><span class="line">// **********************************************</span><br><span class="line">#import &lt;UIKit/UIKit.h&gt;</span><br><span class="line"></span><br><span class="line">@interface SCNewtonsCradleView : UIView</span><br><span class="line">@end</span><br><span class="line"></span><br><span class="line">// **********************************************</span><br><span class="line">#import &quot;SCNewtonsCradleView.h&quot;</span><br><span class="line">#import &quot;SCBallBearingView.h&quot;</span><br><span class="line"></span><br><span class="line">@implementation SCNewtonsCradleView &#123;</span><br><span class="line">    NSArray *_ballBearings;             // é’Ÿæ‘†çƒå®¹å™¨</span><br><span class="line">    UIDynamicAnimator *_animator;       // ç”¨äºæ§åˆ¶è¡Œä¸ºçš„ç‰©ç†å¼•æ“</span><br><span class="line">    UIPushBehavior *_userDragBehavior;  // æ‰‹åŠ¿çš„çº¿æ€§åŠ›é‡</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (id)initWithFrame:(CGRect)frame</span><br><span class="line">&#123;</span><br><span class="line">    self = [super initWithFrame:frame];</span><br><span class="line">    if (self) &#123;</span><br><span class="line">        // åˆå§‹åŒ–ä»£ç </span><br><span class="line">        [self createBallBearings];</span><br><span class="line">        [self applyDynamicBehaviors];</span><br><span class="line">        </span><br><span class="line">        // åˆå§‹åŒ–æ—¶æ–½åŠ æ¨åŠ›è®©é’Ÿæ‘†çƒæ‘‡æ‘†</span><br><span class="line">        _userDragBehavior = [[UIPushBehavior alloc] initWithItems:@[_ballBearings[0]] mode:UIPushBehaviorModeInstantaneous];</span><br><span class="line">        _userDragBehavior.pushDirection = CGVectorMake(-0.5, 0);</span><br><span class="line">        [_animator addBehavior:_userDragBehavior];</span><br><span class="line">    &#125;</span><br><span class="line">    return self;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 1.åˆ›å»º5ä¸ªé’Ÿæ‘†çƒ</span><br><span class="line">- (void)createBallBearings</span><br><span class="line">&#123;</span><br><span class="line">    NSMutableArray *bbArray = [NSMutableArray array];</span><br><span class="line">    NSUInteger numberBalls = 5;</span><br><span class="line">    CGFloat ballSize = CGRectGetWidth(self.bounds) / (3.0 * (numberBalls - 1));</span><br><span class="line">    </span><br><span class="line">    for (NSUInteger i=0; i&lt;numberBalls; i++) &#123;</span><br><span class="line">        // é’Ÿæ‘†çƒéœ€è¦è®¾ç½®å¾—è¶³å¤Ÿå°ï¼Œä½¿å®ƒä»¬ä¹‹é—´é™æ€æ‘†æ”¾æ—¶ä»ç•™æœ‰é—´éš™ã€‚</span><br><span class="line">        SCBallBearingView *bb = [[SCBallBearingView alloc] initWithFrame:CGRectMake(0, 0, ballSize - 1, ballSize - 1)];</span><br><span class="line">        </span><br><span class="line">        // æŠŠæ¯ä¸ªé’Ÿæ‘†çƒæ”¾åˆ°åˆé€‚çš„ä½ç½®</span><br><span class="line">        CGFloat x = CGRectGetWidth(self.bounds) / 3.0 + i * ballSize;</span><br><span class="line">        CGFloat y = CGRectGetHeight(self.bounds) / 2.0;</span><br><span class="line">        bb.center = CGPointMake(x, y);</span><br><span class="line">        </span><br><span class="line">        // ä¸ºæ¯ä¸ªé’Ÿæ‘†çƒæ·»åŠ ä¸€ä¸ªæ‰‹åŠ¿æ“ä½œï¼Œè¿™æ ·å¯ä»¥é€šè¿‡æ‰‹åŠ¿æ¥æ‘†å¼„é’Ÿæ‘†çƒæ¨¡å‹:</span><br><span class="line">        UIPanGestureRecognizer *gesture = [[UIPanGestureRecognizer alloc] initWithTarget:self action:@selector(handleBallBearingPan:)];</span><br><span class="line">        [bb addGestureRecognizer:gesture];</span><br><span class="line">        </span><br><span class="line">        // æŠŠé’Ÿæ‘†çƒæ·»åŠ è¿›æ•°ç»„ä¸­ï¼Œå¹¶æ·»åŠ ä¸ºå½“å‰é¡µé¢å­è§†å›¾</span><br><span class="line">        [bbArray addObject:bb];</span><br><span class="line">        [self addSubview:bb];</span><br><span class="line">    &#125;</span><br><span class="line">    _ballBearings = [NSArray arrayWithArray:bbArray];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#pragma mark - UIDynamics utility methods</span><br><span class="line">// 2.æ·»åŠ åŠ¨åŠ›è¡Œä¸º</span><br><span class="line">- (void)applyDynamicBehaviors</span><br><span class="line">&#123;</span><br><span class="line">    // åˆ›å»ºä¸€ä¸ªå¤åˆçš„è¡Œä¸ºé›†åˆ UIDynamicBehavior (å¯ä»¥åŒ…å«å¾ˆå¤šåŸºæœ¬è¡Œä¸º)</span><br><span class="line">    UIDynamicBehavior *behavior = [[UIDynamicBehavior alloc] init];</span><br><span class="line">    </span><br><span class="line">    // å°†æ¯ä¸ªçƒè½´æ‰¿å®‰è£…åˆ°å…¶æ¢è½´ç‚¹</span><br><span class="line">    for(id&lt;UIDynamicItem&gt; ballBearing in _ballBearings)</span><br><span class="line">    &#123;</span><br><span class="line">        // 2.1 ä¸ºæ¯ä¸ªé’Ÿæ‘†çƒæ·»åŠ è¿ç»“ç‰©è¡Œä¸º</span><br><span class="line">        UIDynamicBehavior *attachmentBehavior = [self createAttachmentBehaviorForBallBearing:ballBearing];</span><br><span class="line">        [behavior addChildBehavior:attachmentBehavior];</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    // 2.2 æ·»åŠ é‡åŠ›è¡Œä¸º</span><br><span class="line">    [behavior addChildBehavior:[self createGravityBehaviorForObjects:_ballBearings]];</span><br><span class="line">    </span><br><span class="line">    // 2.3 æ·»åŠ ç¢°æ’è¡Œä¸º</span><br><span class="line">    [behavior addChildBehavior:[self createCollisionBehaviorForObjects:_ballBearings]];</span><br><span class="line">    </span><br><span class="line">    // 2.4 æŒ‡å®šç¢°æ’çš„å¼¹æ€§</span><br><span class="line">    // ä½¿ç”¨ UIDynamicItemBehavior æ¥æŒ‡å®šç¢°æ’çš„å¼¹æ€§ã€‚</span><br><span class="line">    // dynamic item è¡Œä¸ºä¹Ÿå¯ä»¥è®¾ç½®çº¿æ€§å’Œè§’é€Ÿåº¦ï¼ŒæŠŠå®ƒä»¬æ·»åŠ åˆ°æ‰‹åŠ¿æ“ä½œä¸Šé¢æ˜¯ååˆ†æœ‰ç”¨çš„ã€‚</span><br><span class="line">    UIDynamicItemBehavior *itemBehavior = [[UIDynamicItemBehavior alloc] initWithItems:_ballBearings];</span><br><span class="line">    // è®¾ç½®äº†å…¶ä»–çš„å±æ€§</span><br><span class="line">    itemBehavior.elasticity = 1.0;    // å¼¹æ€§</span><br><span class="line">    itemBehavior.allowsRotation = NO; // rotation(æ—‹è½¬),è¿è¡Œæ—‹è½¬æ—¶ï¼Œå¯ä»¥æŒ‡å®šè§’é˜»åŠ›</span><br><span class="line">    itemBehavior.resistance = 2.f;    // resistance(é˜»å°¼ï¼Œç©ºæ°”äº§ç”Ÿçš„é˜»å°¼)</span><br><span class="line">    [behavior addChildBehavior:itemBehavior];</span><br><span class="line">    </span><br><span class="line">    // 2.5 åˆ›å»ºç‰©ç†å¼•æ“åŠ¨ç”»</span><br><span class="line">    // åˆ›å»ºç‰©ç†å¼•æ“æ¥æ§åˆ¶è¿™äº›è¡Œä¸ºï¼Œæ‰€ä»¥æˆ‘ä»¬å®šäº†ä¸€ä¸ªç±»çš„å…¨å±€å˜é‡(iVar):UIDynamicAnimator *_animator;</span><br><span class="line">    // UIDynamicAnimatorä»£è¡¨äº†æ¨¡æ‹ŸåŠ¨æ€ç³»ç»Ÿçš„ç‰©ç†å¼•æ“ï¼Œåœ¨è¿™é‡Œæˆ‘ä»¬åˆ›å»ºäº†å®ƒï¼Œå¹¶ä¸”æŒ‡å®šäº†å®ƒå‚ç…§çš„view(æ—¢æŒ‡å®šå®‡å®™ç©ºé—´),ä¹Ÿæ·»åŠ äº†æˆ‘ä»¬åˆ›å»ºçš„è¡Œä¸º.</span><br><span class="line">    _animator = [[UIDynamicAnimator alloc] initWithReferenceView:self];</span><br><span class="line">    // Add the composite behavior</span><br><span class="line">    [_animator addBehavior:behavior];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">// è¿ç»“ç‰©çš„è¡Œä¸º(attachment behavior)éœ€è¦æ·»åŠ åˆ°é’Ÿæ‘†çƒä¸Šé¢ï¼Œå®ƒä»£è¡¨äº†ç»³å­å¯¹å®ƒçš„ç‰µå¼•ä½œç”¨:</span><br><span class="line">- (UIDynamicBehavior *)createAttachmentBehaviorForBallBearing:(id&lt;UIDynamicItem&gt;)ballBearing</span><br><span class="line">&#123;</span><br><span class="line">    // UIAttachmentBehavior å®ä¾‹ä¼´éšä¸€ä¸ªåŠ¨æ€çš„å¯¹è±¡(ä¸€ä¸ªé”šç‚¹æˆ–è€…å¦å¤–çš„å¯¹è±¡),å®ƒä»¬æœ‰å…·ä½“çš„å±æ€§æ¥æ§åˆ¶ç»³å­å¯¹å®ƒçš„è¡Œä¸º - å…·ä½“å°±æ˜¯å®ƒçš„é¢‘ç¹æ€§ã€é˜»å°¼å’Œé•¿åº¦ã€‚é»˜è®¤çš„è®¾ç½®å°±æ˜¯ä¸€ä¸ªå®Œå…¨åˆšæ€§çš„è¿æ¥ç‰©(æ²¡æœ‰ä»»ä½•é•¿åº¦ä¼¸ç¼©å¼¹æ€§çš„ç‰©ä½“),åˆšæ€§çš„è¿æ¥ç‰©æ­£æ˜¯æˆ‘ä»¬çš„é’Ÿæ‘†çƒæ‰€éœ€è¦çš„ã€‚</span><br><span class="line">    </span><br><span class="line">    CGPoint anchor = ballBearing.center;</span><br><span class="line">    // é”šç‚¹åœ¨é’Ÿæ‘†çƒçš„æ­£ä¸Šæ–¹</span><br><span class="line">    anchor.y -= CGRectGetHeight(self.bounds) / 4.0;</span><br><span class="line">    </span><br><span class="line">    // åœ¨ç„ç‚¹ä¸Šæ–¹ç”»ä¸€ä¸ªç›’å­. è¿™ä¸æ˜¯è¡Œä¸ºçš„ä¸€éƒ¨åˆ†ï¼Œåªæ˜¯ä¸ºäº†è§†è§‰ä¸Šå¾ˆå¥½çœ‹</span><br><span class="line">    UIView *blueBox = [[UIView alloc] initWithFrame:CGRectMake(0, 0, 10, 10)];</span><br><span class="line">    blueBox.backgroundColor = [UIColor blueColor];</span><br><span class="line">    blueBox.center = anchor;</span><br><span class="line">    [self addSubview:blueBox];</span><br><span class="line">    </span><br><span class="line">    // 2.1 åˆ›å»ºè¿ç»“ç‰©è¡Œä¸º</span><br><span class="line">    UIAttachmentBehavior *behavior = [[UIAttachmentBehavior alloc] initWithItem:ballBearing</span><br><span class="line">                                                               attachedToAnchor:anchor];</span><br><span class="line">    return behavior;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (UIDynamicBehavior *)createGravityBehaviorForObjects:(NSArray *)objects</span><br><span class="line">&#123;</span><br><span class="line">    // 2.2 åˆ›å»ºé‡åŠ›è¡Œä¸º</span><br><span class="line">    // UIGravityBehavior ä»£è¡¨äº†å¯¹è±¡æœ¬èº«å’Œåœ°çƒä¹‹é—´çš„é‡åŠ›å¸å¼•åŠ›ï¼Œå®ƒæœ‰ä¸€äº›å±æ€§å…è®¸ä½ è®¾ç½®çŸ¢é‡çš„ä¸‡æœ‰å¼•åŠ›(å°±æ˜¯é‡åŠ›ç³»æ•°magnitudeå’Œæ–¹å‘direction),æˆ‘ä»¬è¿™é‡Œå¢åŠ äº†é‡åŠ›ç³»æ•°ï¼Œä½†æ˜¯ä¿æŒé‡åŠ›çš„æ–¹å‘åœ¨yè½´ä¸Šé¢ã€‚</span><br><span class="line">    UIGravityBehavior *gravity = [[UIGravityBehavior alloc] initWithItems:objects];</span><br><span class="line">    gravity.magnitude = 10; // è®¾ç½®é‡åŠ›ç³»æ•°</span><br><span class="line">    return gravity;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (UIDynamicBehavior *)createCollisionBehaviorForObjects:(NSArray *)objects</span><br><span class="line">&#123;</span><br><span class="line">    // 2.3 åˆ›å»ºç¢°æ’è¡Œä¸º</span><br><span class="line">    // å°†ç¢°æ’è¡Œä¸ºä½œç”¨åœ¨æ¨¡æ‹Ÿç³»ç»Ÿä¸­çš„æ‰€æœ‰å¯¹è±¡ä¸Šé¢ã€‚</span><br><span class="line">    // ç¢°æ’è¡Œä¸ºè¿˜å¯ä»¥ç”¨äºæ¨¡å‹å¯¹è±¡è¾¾åˆ°è¾¹ç•Œå¦‚è§†å›¾è¾¹ç•Œ,æˆ–ä»»æ„çš„è´å¡å°”æ›²çº¿è·¯å¾„çš„ç•Œé™ã€‚</span><br><span class="line">    return [[UICollisionBehavior alloc] initWithItems:objects];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#pragma mark - UIGestureRecognizer target method</span><br><span class="line">// å®ç°æ‰‹åŠ¿çš„å…·ä½“è¡Œä¸º</span><br><span class="line">// UIPushBehavior ä»£è¡¨ä¸€ä¸ªç®€å•çš„çº¿æ€§åŠ›é‡ä½œç”¨äºå¯¹è±¡ä¸Šé¢ã€‚å½“åŠ›æ¶ˆå¤±çš„æ—¶å€™ï¼Œæˆ‘ä»¬å°±å›æ”¶ä½œç”¨åœ¨é’Ÿæ‘†çƒä¸Šé¢çš„åŠ›,æˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ªç±»å…¨å±€å˜é‡(iVar) UIPushBehavior *_userDragBehvior,è¿™ä¸ªå˜é‡å¯æ˜¯åœ¨æ‰‹åŠ¿è§¦å‘å¼€å§‹çš„æ—¶å€™èµ‹å€¼ï¼Œéœ€è¦è®°å¾—æŠŠè¿™ä¸ªè¡Œä¸ºæ·»åŠ åˆ°dynamics animatorä¸­ï¼Œ æˆ‘ä»¬åŠ›çš„å¤§å°ä¸æ°´å¹³ä½ç§»æˆæ­£æ¯”ï¼Œ ä¸ºäº†è®©é’Ÿæ‘†çƒæ‘‡æ‘†ï¼Œæˆ‘ä»¬éœ€è¦åœ¨æ‰‹åŠ¿ç»“æŸçš„æ—¶å€™åˆ é™¤æ‰pushè¡Œä¸ºã€‚</span><br><span class="line"></span><br><span class="line">- (void)handleBallBearingPan:(UIPanGestureRecognizer *)recognizer</span><br><span class="line">&#123;</span><br><span class="line">    // æ‹–åŠ¨æ‰‹åŠ¿è§¦å‘æ—¶ï¼Œåˆ›å»ºä¸€ä¸ªæ‹–åŠ¨åŠ›</span><br><span class="line">    if (recognizer.state == UIGestureRecognizerStateBegan) &#123;</span><br><span class="line">        if(_userDragBehavior) &#123;</span><br><span class="line">            [_animator removeBehavior:_userDragBehavior];</span><br><span class="line">        &#125;</span><br><span class="line">        // å°† UIPushBehavior å¯¹è±¡æ·»åŠ åˆ° UIDynamicAnimator ç‰©ç†å¼•æ“ä¸Š</span><br><span class="line">        _userDragBehavior = [[UIPushBehavior alloc] initWithItems:@[recognizer.view] mode:UIPushBehaviorModeContinuous];</span><br><span class="line">        [_animator addBehavior:_userDragBehavior];</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    // è®¾ç½®åŠ›çš„å¤§å°,ä¸æ°´å¹³ä½ç§»æˆæ­£æ¯”</span><br><span class="line">    _userDragBehavior.pushDirection = CGVectorMake([recognizer translationInView:self].x / 10.f, 0);</span><br><span class="line">    </span><br><span class="line">    // æ‹–åŠ¨æ‰‹åŠ¿ç»“æŸæ—¶ï¼Œå›æ”¶ä½œç”¨åœ¨é’Ÿæ‘†çƒä¸Šé¢çš„åŠ›</span><br><span class="line">    if (recognizer.state == UIGestureRecognizerStateEnded) &#123;</span><br><span class="line">        [_animator removeBehavior:_userDragBehavior];</span><br><span class="line">        _userDragBehavior = nil;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å°†ç‰›é¡¿é’Ÿæ‘†çƒè§†å›¾æ·»åŠ åˆ°ä¸»é¡µï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">- (void)viewDidLoad</span><br><span class="line">&#123;</span><br><span class="line">    [super viewDidLoad];</span><br><span class="line">	// Do any additional setup after loading the view, typically from a nib.</span><br><span class="line">    _newtonsCradle = [[SCNewtonsCradleView alloc] initWithFrame:self.view.bounds];</span><br><span class="line">    [self.view addSubview:_newtonsCradle];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="åŠ¨ç”»æ•ˆæœ"><a href="#åŠ¨ç”»æ•ˆæœ" class="headerlink" title="åŠ¨ç”»æ•ˆæœ"></a>åŠ¨ç”»æ•ˆæœ</h3><p><img src="http://upload-images.jianshu.io/upload_images/2648731-18a1ff155672b720.gif?imageMogr2/auto-orient/strip" alt></p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://andy0570.com/2017/08/22/äºŒã€å¯¹è±¡ã€æ¶ˆæ¯ã€è¿è¡ŒæœŸ/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ç‹¬æœ¨èˆŸçš„æœ¨">
      <meta itemprop="description" content="æœ‰æ—¶å€™é˜³å…‰å¾ˆå¥½ æœ‰æ—¶å€™é˜³å…‰å¾ˆæš—">
      <meta itemprop="image" content="https://ws1.sinaimg.cn/large/006tNc79gy1g22m14458rj30u014xu0x.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ç‹¬æœ¨èˆŸçš„æœ¨">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2017/08/22/äºŒã€å¯¹è±¡ã€æ¶ˆæ¯ã€è¿è¡ŒæœŸ/" class="post-title-link" itemprop="url">äºŒã€å¯¹è±¡ã€æ¶ˆæ¯ã€è¿è¡ŒæœŸ</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              

              
                
              

              <time title="åˆ›å»ºæ—¶é—´ï¼š2017-08-22 14:10:00" itemprop="dateCreated datePublished" datetime="2017-08-22T14:10:00+08:00">2017-08-22</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">æ›´æ–°äº</span>
                
                <time title="ä¿®æ”¹æ—¶é—´ï¼š2019-04-16 00:11:18" itemprop="dateModified" datetime="2019-04-16T00:11:18+08:00">2019-04-16</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/ã€ŠEffective-Objective-C-2-0ã€‹/" itemprop="url" rel="index"><span itemprop="name">ã€ŠEffective Objective-C 2.0ã€‹</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          
            <span id="/2017/08/22/äºŒã€å¯¹è±¡ã€æ¶ˆæ¯ã€è¿è¡ŒæœŸ/" class="leancloud_visitors" data-flag-title="äºŒã€å¯¹è±¡ã€æ¶ˆæ¯ã€è¿è¡ŒæœŸ">
              <span class="post-meta-divider">|</span>
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              
                <span class="post-meta-item-text">é˜…è¯»æ¬¡æ•°ï¼š</span>
              
                <span class="leancloud-visitors-count"></span>
            </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body han-init-context" itemprop="articleBody">

      
      

      
        
          
            <h1 id="ã€ŠEffective-Objective-C-2-0-ç¼–å†™é«˜è´¨é‡iOSä¸OS-Xä»£ç çš„52ä¸ªæœ‰æ•ˆæ–¹æ³•-ã€‹å­¦ä¹ ç¬”è®°"><a href="#ã€ŠEffective-Objective-C-2-0-ç¼–å†™é«˜è´¨é‡iOSä¸OS-Xä»£ç çš„52ä¸ªæœ‰æ•ˆæ–¹æ³•-ã€‹å­¦ä¹ ç¬”è®°" class="headerlink" title="ã€ŠEffective Objective-C 2.0 ç¼–å†™é«˜è´¨é‡iOSä¸OS Xä»£ç çš„52ä¸ªæœ‰æ•ˆæ–¹æ³• ã€‹å­¦ä¹ ç¬”è®°"></a>ã€ŠEffective Objective-C 2.0 ç¼–å†™é«˜è´¨é‡iOSä¸OS Xä»£ç çš„52ä¸ªæœ‰æ•ˆæ–¹æ³• ã€‹å­¦ä¹ ç¬”è®°</h1><p><img src="http://upload-images.jianshu.io/upload_images/2648731-30062a72b4270bc7.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt></p>
<h2 id="ç¬¬2ç« -å¯¹è±¡ã€æ¶ˆæ¯ã€è¿è¡ŒæœŸ"><a href="#ç¬¬2ç« -å¯¹è±¡ã€æ¶ˆæ¯ã€è¿è¡ŒæœŸ" class="headerlink" title="ç¬¬2ç«  å¯¹è±¡ã€æ¶ˆæ¯ã€è¿è¡ŒæœŸ"></a>ç¬¬2ç«  å¯¹è±¡ã€æ¶ˆæ¯ã€è¿è¡ŒæœŸ</h2><p><strong>å¯¹è±¡</strong>ï¼šç”¨ <strong>Objective-C</strong> ç­‰é¢å‘å¯¹è±¡è¯­è¨€ç¼–ç¨‹æ—¶ï¼Œâ€œå¯¹è±¡â€ï¼ˆobject) æ˜¯ â€œåŸºæœ¬æ„é€ å•å…ƒâ€ï¼ˆbuilding block)ï¼Œå¼€å‘è€…å¯ä»¥é€šè¿‡å¯¹è±¡æ¥å­˜å‚¨å¹¶ä¼ é€’æ•°æ®ã€‚</p>
<p><strong>æ¶ˆæ¯ä¼ é€’</strong>ï¼ˆMessaging)ï¼šåœ¨å¯¹è±¡ä¹‹é—´ä¼ é€’æ•°æ®å¹¶æ‰§è¡Œä»»åŠ¡çš„è¿‡ç¨‹ã€‚</p>
<p><strong>Objective-C è¿è¡ŒæœŸç¯å¢ƒ</strong>ï¼šå½“åº”ç”¨ç¨‹åºè¿è¡Œèµ·æ¥ä»¥åï¼Œä¸ºå…¶æä¾›ç›¸å…³æ”¯æŒçš„ä»£ç å«åšâ€œObjective-C è¿è¡ŒæœŸç¯å¢ƒâ€ (Objective-C runtime)ï¼Œå®ƒæä¾›äº†ä¸€äº›ä½¿å¾—å¯¹è±¡ä¹‹é—´èƒ½å¤Ÿä¼ é€’æ¶ˆæ¯çš„é‡è¦å‡½æ•°ï¼Œå¹¶ä¸”åŒ…å«åˆ›å»º ç±»å®ä¾‹æ‰€ç”¨çš„å…¨éƒ¨é€»è¾‘ã€‚</p>
<h3 id="ç¬¬6æ¡ï¼šç†è§£â€œå±æ€§â€è¿™ä¸€æ¦‚å¿µ"><a href="#ç¬¬6æ¡ï¼šç†è§£â€œå±æ€§â€è¿™ä¸€æ¦‚å¿µ" class="headerlink" title="ç¬¬6æ¡ï¼šç†è§£â€œå±æ€§â€è¿™ä¸€æ¦‚å¿µ"></a>ç¬¬6æ¡ï¼šç†è§£â€œå±æ€§â€è¿™ä¸€æ¦‚å¿µ</h3><h4 id="propertyï¼šå±æ€§"><a href="#propertyï¼šå±æ€§" class="headerlink" title="@propertyï¼šå±æ€§"></a>@propertyï¼šå±æ€§</h4><p><strong>å±æ€§</strong>ï¼ˆpropertyï¼‰ç”¨äºå°è£…å¯¹è±¡ä¸­çš„æ•°æ®ã€‚è€Œ Objective-C å¯¹è±¡é€šå¸¸ä¼šæŠŠå…¶æ‰€éœ€è¦çš„æ•°æ®ä¿å­˜ä¸ºå„ç§å®ä¾‹å˜é‡ã€‚</p>
<p><strong>å®ä¾‹å˜é‡</strong> é€šè¿‡<strong>å­˜å–æ–¹æ³•</strong>ï¼ˆaccess methodï¼‰æ¥è®¿é—®ï¼š</p>
<ul>
<li><strong>è·å–æ–¹æ³•</strong>ï¼ˆgetterï¼‰ç”¨äºè¯»å–å˜é‡å€¼ã€‚</li>
<li><strong>è®¾ç½®æ–¹æ³•</strong>ï¼ˆsetterï¼‰ç”¨äºå†™å…¥å˜é‡å€¼ã€‚</li>
</ul>
<p>ç¼–å†™ Objectice-C ä»£ç æ—¶å¾ˆå°‘<strong>å®šä¹‰å®ä¾‹å˜é‡çš„ä½œç”¨åŸŸ</strong>ã€‚å› ä¸ºï¼šå¯¹è±¡å¸ƒå±€åœ¨ç¼–è¯‘æœŸå°±å·²ç»å›ºå®šäº†ï¼Œè®¿é—®å®ä¾‹å˜é‡æ—¶ï¼Œç¼–è¯‘å™¨ä¼šæŠŠå…¶æ›¿æ¢ä¸ºç¡¬ç¼–ç ï¼ˆhardcodeï¼‰çš„åç§»é‡ï¼ˆoffsetï¼‰ã€‚è¡¨ç¤ºè¯¥å˜é‡è·ç¦»å­˜æ”¾å¯¹è±¡çš„ å†…å­˜åŒºåŸŸçš„èµ·å§‹åœ°å€æœ‰å¤šè¿œã€‚</p>
<p>è®¿é—®å±æ€§ï¼Œå¯ä»¥ä½¿ç”¨<strong>ç‚¹è¯­æ³•</strong>ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">EOCPerson *person = [[EOCPerson alloc] init];</span><br><span class="line">person.firstName = @&quot;Chester&quot;; //Same as</span><br><span class="line">[person setFirstName:@&quot;Chester&quot;];</span><br><span class="line"></span><br><span class="line">NSString *lastName = person.lastName; //Same as</span><br><span class="line">NSString *lastName = [person lastName];</span><br></pre></td></tr></table></figure>
<p><strong>è‡ªåŠ¨åˆæˆ</strong>ï¼ˆautosynthesis)ï¼šä½¿ç”¨å±æ€§æ—¶ï¼Œç¼–è¯‘å™¨ä¼šè‡ªåŠ¨ç¼–å†™è®¿é—®å±æ€§æ‰€éœ€çš„æ–¹æ³•ï¼Œè‡ªåŠ¨å‘ç±»ä¸­æ·»åŠ é€‚å½“ç±»å‹çš„å®ä¾‹å˜é‡ã€‚</p>
<h4 id="synthesizeï¼šæŒ‡å®šå®ä¾‹å˜é‡çš„åå­—"><a href="#synthesizeï¼šæŒ‡å®šå®ä¾‹å˜é‡çš„åå­—" class="headerlink" title="@synthesizeï¼šæŒ‡å®šå®ä¾‹å˜é‡çš„åå­—"></a>@synthesizeï¼šæŒ‡å®šå®ä¾‹å˜é‡çš„åå­—</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">// å°†ç”Ÿæˆçš„å®ä¾‹å˜é‡å‘½åä¸º_myFirstNameä¸_myLastName</span><br><span class="line">@implementation EOCPerson</span><br><span class="line">@synthesize firstName = _myFirstName;</span><br><span class="line">@synthesize lastName  = _myLastName;</span><br><span class="line">@end</span><br></pre></td></tr></table></figure>
<h4 id="dynamic"><a href="#dynamic" class="headerlink" title="@dynamic"></a>@dynamic</h4><p>è‹¥ä¸æƒ³ä»¤ç¼–è¯‘å™¨è‡ªåŠ¨åˆæˆå­˜å–æ–¹æ³•ï¼Œåˆ™å¯ä»¥è‡ªå·±å®ç°ã€‚å¦‚æœä½ åªå®ç°äº†å…¶ä¸­ä¸€ä¸ªå­˜å–æ–¹æ³•ï¼Œé‚£ä¹ˆå¦å¤–ä¸€ä¸ªè¿˜æ˜¯ä¼šç”±ç¼–è¯‘å™¨æ¥åˆæˆã€‚è¿˜æœ‰ä¸€ç§åŠæ³•èƒ½é˜»æ­¢ç¼–è¯‘å™¨è‡ªåŠ¨åˆæˆå­˜å–æ–¹æ³•ï¼Œå°±æ˜¯ä½¿ç”¨ <strong>@dynamic</strong> å…³é”®å­—ï¼Œå®ƒä¼šå‘Šè¯‰ç¼–è¯‘å™¨ï¼šä¸è¦è‡ªåŠ¨åˆ›å»ºå®ç°å±æ€§æ‰€ç”¨çš„å®ä¾‹å˜ é‡ï¼Œä¹Ÿä¸è¦ä¸ºå…¶åˆ›å»ºå­˜å–æ–¹æ³•ã€‚</p>
<h4 id="å±æ€§ç‰¹è´¨"><a href="#å±æ€§ç‰¹è´¨" class="headerlink" title="å±æ€§ç‰¹è´¨"></a>å±æ€§ç‰¹è´¨</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">@property (nonatomic, copy, readonly) NSString *firstName;</span><br></pre></td></tr></table></figure>
<h5 id="åŸå­æ€§"><a href="#åŸå­æ€§" class="headerlink" title="åŸå­æ€§"></a>åŸå­æ€§</h5><ul>
<li><strong>atomic</strong>ï¼ˆé»˜è®¤ï¼‰</li>
<li><strong>nonatomic</strong>ï¼šéåŸå­æ€§ã€ä¸ä½¿ç”¨åŒæ­¥é”</li>
</ul>
<blockquote>
<p>atomic ä¸ nonatomic çš„åŒºåˆ«æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ</p>
<p>å…·å¤‡ atomic ç‰¹è´¨çš„è·å–æ–¹æ³•ä¼šé€šè¿‡é”å®šæœºåˆ¶æ¥ç¡®ä¿å…¶æ“ä½œçš„åŸå­æ€§ã€‚è¿™ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœä¸¤ä¸ªçº¿ç¨‹è¯»å†™åŒä¸€å±æ€§ï¼Œé‚£ä¹ˆä¸è®ºä½•æ—¶ï¼Œæ€»èƒ½çœ‹åˆ°æœ‰æ•ˆçš„å±æ€§å€¼ã€‚è‹¥æ˜¯ä¸åŠ é”çš„è¯ï¼ˆæˆ–è€…è¯´ä½¿ç”¨ nonatomic è¯­ä¹‰)ï¼Œé‚£ä¹ˆå½“å…¶ä¸­ä¸€ä¸ªçº¿ç¨‹æ­£åœ¨æ”¹å†™æŸå±æ€§å€¼æ—¶ï¼Œå¦å¤–ä¸€ä¸ªçº¿ç¨‹ä¹Ÿè®¸ä¼šçªç„¶é—¯å…¥ï¼ŒæŠŠå°šæœªä¿®æ”¹å¥½çš„å±æ€§å€¼è¯»å–å‡ºæ¥ã€‚ å‘ç”Ÿè¿™ç§æƒ…å†µæ—¶ï¼Œçº¿ç¨‹è¯»åˆ°çš„å±æ€§å€¼å¯èƒ½ä¸å¯¹ã€‚</p>
<p>å¦‚æœå¼€å‘è¿‡ iOS ç¨‹åºï¼Œä½ å°±ä¼šå‘ç°ï¼Œå…¶ä¸­æ‰€æœ‰å±æ€§éƒ½å£°æ˜ä¸º nonatomicã€‚è¿™æ ·åšçš„å†å²åŸå› æ˜¯ï¼šåœ¨ iOS ä¸­ä½¿ç”¨åŒæ­¥é”çš„å¼€é”€è¾ƒå¤§ï¼Œè¿™ä¼šå¸¦æ¥æ€§èƒ½é—®é¢˜ã€‚ä¸€èˆ¬æƒ…å†µä¸‹å¹¶ä¸è¦æ±‚å±æ€§å¿…é¡»æ˜¯â€œåŸå­çš„â€ï¼Œå› ä¸ºè¿™å¹¶ä¸èƒ½ä¿è¯â€œçº¿ç¨‹å®‰å…¨â€ï¼ˆthread safety)ï¼Œè‹¥è¦å®ç°â€œçº¿ç¨‹å®‰å…¨â€çš„æ“ä½œï¼Œè¿˜éœ€é‡‡ç”¨æ›´ä¸ºæ·±å±‚çš„é”å®šæœºåˆ¶æ‰è¡Œã€‚ä¾‹å¦‚ï¼Œä¸€ä¸ªçº¿ç¨‹åœ¨è¿ç»­å¤šæ¬¡è¯»å–æŸå±æ€§å€¼çš„è¿‡ç¨‹ä¸­æœ‰åˆ«çš„çº¿ç¨‹åœ¨åŒæ—¶æ”¹å†™è¯¥å€¼ï¼Œé‚£ä¹ˆå³ä¾¿å°†å±æ€§å£°æ˜ä¸º atomicï¼Œä¹Ÿè¿˜æ˜¯ä¼šè¯»åˆ°ä¸åŒçš„å±æ€§å€¼ã€‚ å› æ­¤ï¼Œå¼€å‘ iOS ç¨‹åºæ—¶ä¸€èˆ¬éƒ½ä¼šä½¿ç”¨ nonatomic å±æ€§ã€‚ä½†æ˜¯åœ¨å¼€å‘ Mac OS X ç¨‹åºæ—¶ï¼Œä½¿ç”¨ atomic å±æ€§é€šå¸¸éƒ½ä¸ä¼šæœ‰æ€§èƒ½ç“¶é¢ˆã€‚</p>
</blockquote>
<h5 id="è¯»å†™æ€§"><a href="#è¯»å†™æ€§" class="headerlink" title="è¯»å†™æ€§"></a>è¯»å†™æ€§</h5><ul>
<li><strong>readwrite</strong>ï¼šè‡ªåŠ¨ç”Ÿæˆ<strong>è·å–æ–¹æ³•</strong>ï¼ˆgetterï¼‰ä¸<strong>è®¾ç½®æ–¹æ³•</strong>ï¼ˆsetterï¼‰ã€‚</li>
<li><strong>readonly</strong>ï¼šåªç”Ÿæˆ<strong>è·å–æ–¹æ³•</strong>ï¼ˆgetterï¼‰ã€‚</li>
</ul>
<h5 id="å†…å­˜ç®¡ç†è¯­ä¹‰ï¼Œè¯¥ç‰¹è´¨åªå½±å“è®¾ç½®æ–¹æ³•ã€‚"><a href="#å†…å­˜ç®¡ç†è¯­ä¹‰ï¼Œè¯¥ç‰¹è´¨åªå½±å“è®¾ç½®æ–¹æ³•ã€‚" class="headerlink" title="å†…å­˜ç®¡ç†è¯­ä¹‰ï¼Œè¯¥ç‰¹è´¨åªå½±å“è®¾ç½®æ–¹æ³•ã€‚"></a>å†…å­˜ç®¡ç†è¯­ä¹‰ï¼Œè¯¥ç‰¹è´¨åªå½±å“è®¾ç½®æ–¹æ³•ã€‚</h5><ul>
<li><strong>assign</strong>ï¼šè®¾ç½®æ–¹æ³•åªä¼šæ‰§è¡Œé’ˆå¯¹â€œçº¯é‡ç±»å‹â€ï¼ˆscalar typeï¼Œä¾‹å¦‚ CGFloat æˆ– NSImeger ç­‰ï¼‰çš„ç®€å•èµ‹å€¼æ“ä½œã€‚</li>
<li><strong>strong</strong>ï¼šæ­¤ç‰¹è´¨è¡¨æ˜è¯¥å±æ€§å®šä¹‰äº†ä¸€ç§â€œæ‹¥æœ‰å…³ç³»â€ï¼ˆowning relationship)ã€‚ä¸ºè¿™ç§å±æ€§è®¾ç½®æ–°å€¼æ—¶ï¼Œè®¾ç½®æ–¹æ³•ä¼šå…ˆä¿ç•™æ–°å€¼ï¼Œå¹¶é‡Šæ”¾æ—§å€¼ï¼Œç„¶åå†å°†æ–°å€¼è®¾ç½®ä¸Šå»ã€‚</li>
<li><strong>weak</strong>ï¼šæ­¤ç‰¹è´¨è¡¨æ˜è¯¥å±æ€§å®šä¹‰äº†ä¸€ç§â€œéæ‹¥æœ‰å…³ç³»â€ï¼ˆnonowning relationship)ã€‚ä¸ºè¿™ç§å±æ€§è®¾ç½®æ–°å€¼æ—¶ï¼Œè®¾ç½®æ–¹æ³•æ—¢ä¸ä¿ç•™æ–°å€¼ï¼Œä¹Ÿä¸é‡Šæ”¾æ—§å€¼ã€‚æ­¤ç‰¹è´¨åŒ <strong>assign</strong> ç±»ä¼¼, ç„¶è€Œåœ¨å±æ€§æ‰€æŒ‡çš„å¯¹è±¡é­åˆ°æ‘§æ¯æ—¶ï¼Œå±æ€§å€¼ä¹Ÿä¼šæ¸…ç©ºï¼ˆnil out)ã€‚</li>
<li><strong>unsafe_unretained</strong>ï¼šæ­¤ç‰¹è´¨çš„è¯­ä¹‰å’Œ <strong>assign</strong> ç›¸åŒï¼Œä½†æ˜¯å®ƒé€‚ç”¨äºâ€œå¯¹è±¡ç±»å‹â€ï¼ˆobject type),è¯¥ç‰¹è´¨è¡¨è¾¾ä¸€ç§â€œéæ‹¥æœ‰å…³ç³»â€ï¼ˆâ€œä¸ä¿ç•™â€ï¼Œunretained),å½“ç›®æ ‡å¯¹è±¡é­åˆ°æ‘§æ¯ æ—¶ï¼Œå±æ€§å€¼ä¸ä¼šè‡ªåŠ¨æ¸…ç©ºï¼ˆâ€œä¸å®‰å…¨â€ï¼Œunsafe)ï¼Œè¿™ä¸€ç‚¹ä¸ <strong>weak</strong> æœ‰åŒºåˆ«ã€‚</li>
<li><strong>copy</strong>ï¼šæ­¤ç‰¹è´¨æ‰€è¡¨è¾¾çš„æ‰€å±å…³ç³»ä¸ <strong>strong</strong> ç±»ä¼¼ã€‚ç„¶è€Œè®¾ç½®æ–¹æ³•å¹¶ä¸ä¿ç•™æ–°å€¼ï¼Œè€Œæ˜¯å°†å…¶æ‹·è´ï¼ˆcopyï¼‰ã€‚å½“å±æ€§ç±»å‹ä¸º <code>NSString *</code> æ—¶ï¼Œç»å¸¸ç”¨æ­¤ç‰¹è´¨æ¥ä¿æŠ¤å…¶å°è£…æ€§ï¼Œä»¥è¿”å›ä¸å¯å˜å¯¹è±¡ã€‚æ¶‰åŠåˆ°æ·±æ‹·è´ä¸æµ…æ‹·è´çš„é—®é¢˜ã€‚</li>
</ul>
<h5 id="æ–¹æ³•å"><a href="#æ–¹æ³•å" class="headerlink" title="æ–¹æ³•å"></a>æ–¹æ³•å</h5><p>æŒ‡å®šå­˜å–æ–¹æ³•çš„æ–¹æ³•å</p>
<ul>
<li><p><code>getter=&lt;name&gt;</code></p>
<p>æŒ‡å®šâ€œè·å–æ–¹æ³•â€çš„æ–¹æ³•åï¼Œå¦‚ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">@property (nonatomic, getter=isOn) BOOL on;</span><br></pre></td></tr></table></figure>
</li>
<li><p><code>setter=&lt;name&gt;</code></p>
<p>æŒ‡å®šâ€œè®¾ç½®æ–¹æ³•â€çš„æ–¹æ³•åã€‚è¿™ç§ç”¨æ³•ä¸å¤ªå¸¸è§ã€‚</p>
</li>
</ul>
<h4 id="è¦ç‚¹"><a href="#è¦ç‚¹" class="headerlink" title="è¦ç‚¹"></a>è¦ç‚¹</h4><ul>
<li>å¯ä»¥é€šè¿‡ <strong>@property</strong> è¯­æ³•æ¥å®šä¹‰å¯¹è±¡ä¸­æ‰€å°è£…çš„æ•°æ®ã€‚</li>
<li>é€šè¿‡ â€œç‰¹è´¨â€ æ¥æŒ‡å®šå­˜å‚¨æ•°æ®æ‰€éœ€çš„æ­£ç¡®è¯­ä¹‰ã€‚</li>
<li>åœ¨è®¾ç½®å±æ€§æ‰€å¯¹åº”çš„å®ä¾‹å˜é‡æ—¶ï¼Œä¸€å®šè¦éµä»è¯¥å±æ€§æ‰€å£°æ˜çš„è¯­ä¹‰ã€‚</li>
<li>å¼€å‘iOSç¨‹åºæ—¶ï¼Œåº”è¯¥ä½¿ç”¨ <strong>nonatomic</strong> å±æ€§ï¼Œå› ä¸º <strong>atomic</strong> å±æ€§ä¼šä¸¥é‡å½±å“æ€§èƒ½ã€‚</li>
</ul>
<h3 id="ç¬¬7æ¡ï¼šåœ¨å¯¹è±¡å†…éƒ¨å°½é‡ç›´æ¥è®¿é—®å®ä¾‹å˜é‡"><a href="#ç¬¬7æ¡ï¼šåœ¨å¯¹è±¡å†…éƒ¨å°½é‡ç›´æ¥è®¿é—®å®ä¾‹å˜é‡" class="headerlink" title="ç¬¬7æ¡ï¼šåœ¨å¯¹è±¡å†…éƒ¨å°½é‡ç›´æ¥è®¿é—®å®ä¾‹å˜é‡"></a>ç¬¬7æ¡ï¼šåœ¨å¯¹è±¡å†…éƒ¨å°½é‡ç›´æ¥è®¿é—®å®ä¾‹å˜é‡</h3><p>â­ï¸ <strong>åˆç†çš„æ–¹æ¡ˆ</strong>ï¼šåœ¨<strong>å†™å…¥</strong>å®ä¾‹å˜é‡æ—¶ï¼Œé€šè¿‡å…¶<strong>è®¾ç½®æ–¹æ³•</strong>æ¥åšã€‚è€Œ<strong>è¯»å–</strong>å®ä¾‹å˜é‡æ—¶ï¼Œåˆ™<strong>ç›´æ¥è®¿é—®</strong>ä¹‹ã€‚</p>
<p><strong>ä¼˜ç‚¹</strong>ï¼šæ—¢èƒ½æé«˜è¯»å–æ“ä½œçš„é€Ÿåº¦ï¼Œåˆèƒ½æ§åˆ¶å¯¹å±æ€§çš„å†™å…¥æ“ä½œã€‚</p>
<p><strong>é€šè¿‡è®¾ç½®æ–¹æ³•æ¥å†™å…¥å®ä¾‹å˜é‡çš„åŸå› </strong>ï¼šèƒ½å¤Ÿç¡®ä¿ç›¸å…³å±æ€§çš„â€œå†…å­˜ç®¡ç†è¯­ä¹‰â€å¾—ä»¥è´¯å½»ã€‚</p>
<p><strong>é€‰ç”¨è¯¥æ–¹æ¡ˆçš„æ³¨æ„ç‚¹</strong>ï¼š</p>
<ul>
<li><strong>ç›´æ¥è®¿é—®å®ä¾‹å˜é‡</strong>ä¸ä¼šç»è¿‡ Objectice-C çš„æ–¹æ³•æ´¾å‘ï¼ˆmethod dispatchï¼‰ã€ä¸ä¼šè°ƒç”¨å…¶è®¾ç½®æ–¹æ³•ï¼ˆsetterï¼‰ã€ä¸ä¼šè§¦å‘é”®å€¼è§‚æµ‹ï¼ˆKVOï¼‰ã€‚</li>
<li>åœ¨åˆå§‹åŒ–æ–¹æ³•ä¸­ï¼Œæ€»æ˜¯åº”è¯¥ç›´æ¥è®¿é—®å®ä¾‹å˜é‡ï¼Œå› ä¸ºå­ç±»å¯èƒ½ä¼š<strong>è¦†å†™ï¼ˆoverrideï¼‰</strong>è®¾ç½®ï¼ˆsetterï¼‰æ–¹æ³•ã€‚</li>
<li>ä½¿ç”¨<strong>æƒ°æ€§åˆå§‹åŒ–ï¼ˆlazy initializationï¼‰</strong>æŠ€æœ¯æ—¶ï¼Œå¿…é¡»é€šè¿‡<strong>è·å–æ–¹æ³•</strong>æ¥<strong>è®¿é—®å±æ€§</strong>ã€‚</li>
</ul>
<h4 id="è¦ç‚¹-1"><a href="#è¦ç‚¹-1" class="headerlink" title="è¦ç‚¹"></a>è¦ç‚¹</h4><ul>
<li>åœ¨å¯¹è±¡å†…éƒ¨è¯»å–æ•°æ®æ—¶ï¼Œåº”è¯¥ç›´æ¥é€šè¿‡å®ä¾‹å˜é‡æ¥è¯»ï¼Œè€Œå†™å…¥æ•°æ®æ—¶ï¼Œåº”è¯¥é€šè¿‡å±æ€§æ¥å†™ã€‚</li>
<li>åœ¨åˆå§‹åŒ–æ–¹æ³•åŠ <code>dealloc</code> æ–¹æ³•ä¸­ï¼Œæ€»æ˜¯åº”è¯¥ç›´æ¥é€šè¿‡å®ä¾‹å˜é‡æ¥è¯»å†™æ•°æ®ã€‚</li>
<li>æœ‰æ—¶ä¼šä½¿ç”¨æƒ°æ€§åˆå§‹åŒ–æŠ€æœ¯é…ç½®æŸä»½æ•°æ®ï¼Œè¿™ç§æƒ…å†µä¸‹ï¼Œéœ€è¦é€šè¿‡å±æ€§æ¥è¯»å–æ•°æ®ã€‚</li>
</ul>
<h3 id="ç¬¬8æ¡ï¼šç†è§£â€œå¯¹è±¡ç­‰åŒæ€§â€è¿™ä¸€æ¦‚å¿µ"><a href="#ç¬¬8æ¡ï¼šç†è§£â€œå¯¹è±¡ç­‰åŒæ€§â€è¿™ä¸€æ¦‚å¿µ" class="headerlink" title="ç¬¬8æ¡ï¼šç†è§£â€œå¯¹è±¡ç­‰åŒæ€§â€è¿™ä¸€æ¦‚å¿µ"></a>ç¬¬8æ¡ï¼šç†è§£â€œå¯¹è±¡ç­‰åŒæ€§â€è¿™ä¸€æ¦‚å¿µ</h3><ul>
<li><code>==</code> æ“ä½œæ¯”è¾ƒçš„æ˜¯ä¸¤ä¸ªæŒ‡é’ˆæœ¬èº«ã€‚</li>
<li>åº”è¯¥ç”¨ NSObject åè®®ä¸­çš„ <code>isEqual</code>  æ–¹æ³•åˆ¤æ–­ä¸¤ä¸ªå¯¹è±¡çš„ç­‰åŒæ€§ã€‚</li>
</ul>
<p>NSObject åè®®ä¸­åˆ¤æ–­ä¸¤ä¸ªå¯¹è±¡çš„ç­‰åŒæ€§çš„å…³é”®æ–¹æ³•ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">// é»˜è®¤å®ç°ï¼šå½“ä¸”ä»…å½“å…¶â€œæŒ‡é’ˆå€¼&quot;å®Œå…¨ç›¸ç­‰æ—¶ï¼Œè¿™ä¸¤ä¸ªå¯¹è±¡æ‰ç›¸ç­‰ã€‚</span><br><span class="line">- (BOOL)isEqual:(id)object;</span><br><span class="line">@property (readonly) NSUInteger hash;</span><br></pre></td></tr></table></figure>
<p>å¯¹è±¡ç­‰åŒæ€§çº¦å®šï¼š</p>
<ol>
<li>å¦‚æœ <code>isEqual:</code> æ–¹æ³•åˆ¤å®šä¸¤ä¸ªå¯¹è±¡ç›¸ç­‰ï¼Œé‚£ä¹ˆå…¶ <code>hash</code> æ–¹æ³•ä¹Ÿå¿…é¡»è¿”å›åŒä¸€ä¸ªå€¼ã€‚</li>
<li>ä½†æ˜¯ï¼Œå¦‚æœä¸¤ä¸ªå¯¹è±¡çš„ <code>hash</code> æ–¹æ³•è¿”å›åŒä¸€ä¸ªå€¼ï¼Œå…¶ <code>isEqual:</code> æ–¹æ³•<strong>æœªå¿…ä¼š</strong>è®¤ä¸ºä¸¤è€…ç›¸ç­‰ã€‚</li>
</ol>
<h4 id="è¦†å†™-isEqualï¼š"><a href="#è¦†å†™-isEqualï¼š" class="headerlink" title="è¦†å†™ isEqualï¼š"></a>è¦†å†™ isEqualï¼š</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">- (BOOL)isEqual:(id)object &#123;</span><br><span class="line">    // 1.åˆ¤æ–­ä¸¤ä¸ªæŒ‡é’ˆæ˜¯å¦ç›¸ç­‰ï¼Œå³ä¸¤ä¸ªæŒ‡é’ˆæŒ‡å‘åŒä¸€ä¸ªå¯¹è±¡</span><br><span class="line">    if (self == object) return YES;</span><br><span class="line">    // 2.åˆ¤æ–­ä¸¤ä¸ªå¯¹è±¡æ˜¯å¦å±äºåŒä¸€ä¸ªç±»</span><br><span class="line">    //   è¿˜åº”è€ƒè™‘åˆ°ç»§æ‰¿ä½“ç³»ä¸­çš„ç­‰åŒæ€§é—®é¢˜</span><br><span class="line">    if ( [self class] != [object class]) return NO;</span><br><span class="line">    </span><br><span class="line">    // 3.åˆ¤æ–­æ¯ä¸ªå±æ€§æ˜¯å¦éƒ½ç›¸ç­‰</span><br><span class="line">    EOCPerson *otherPerson = (EOCPerson *)object;</span><br><span class="line">    if (![_firstName isEqualToString:otherPerson.firstName]) &#123;</span><br><span class="line">        return NO;</span><br><span class="line">    &#125;</span><br><span class="line">    if (![_lastName isEqualToString:otherPerson.lastName]) &#123;</span><br><span class="line">        return NO;</span><br><span class="line">    &#125;</span><br><span class="line">    if (_age != otherPerson.age) &#123;</span><br><span class="line">        return NO;</span><br><span class="line">    &#125;</span><br><span class="line">    return YES;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="è¦†å†™-hash"><a href="#è¦†å†™-hash" class="headerlink" title="è¦†å†™ hash"></a>è¦†å†™ hash</h4><p>è‹¥ä¸¤å¯¹è±¡ç›¸ç­‰ï¼Œåˆ™å…¶å“ˆå¸Œç  (hash) ä¹Ÿç›¸ç­‰ï¼Œä½†æ˜¯ä¸¤ä¸ªå“ˆå¸Œç ç›¸åŒçš„å¯¹è±¡å´æœªå¿…ç›¸ç­‰ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">/*</span><br><span class="line"> åœ¨ collection ä¸­ä½¿ç”¨è¿™ç§å¯¹è±¡å°†äº§ç”Ÿæ€§èƒ½é—®é¢˜ã€‚</span><br><span class="line"> </span><br><span class="line"> collection åœ¨æ£€ç´¢å“ˆå¸Œè¡¨ï¼ˆhash tableï¼‰æ—¶ï¼Œä¼šç”¨å¯¹è±¡çš„å“ˆå¸Œç åšç´¢å¼•ã€‚å‡å¦‚æŸä¸ª collection æ˜¯ç”¨ set å®ç°çš„ï¼Œ</span><br><span class="line"> é‚£ä¹ˆ set å¯èƒ½ä¼šæ ¹æ®å“ˆå¸Œç æŠŠå¯¹è±¡åˆ†è£…åˆ°ä¸åŒçš„æ•°ç»„ä¸­ã€‚åœ¨å‘ set ä¸­æ·»åŠ æ–°å¯¹è±¡æ—¶ï¼Œè¦æ ¹æ®å…¶å“ˆå¸Œç æ‰¾åˆ°ä¸ä¹‹ç›¸å…³çš„é‚£ä¸ª</span><br><span class="line"> æ•°ç»„ï¼Œä¾æ¬¡æ£€æŸ»å…¶ä¸­å„ä¸ªå…ƒç´ ï¼Œçœ‹æ•°ç»„ä¸­å·²æœ‰çš„å¯¹è±¡æ˜¯å¦å’Œå°†è¦æ·»åŠ çš„æ–°å¯¹è±¡ç›¸ç­‰ã€‚å¦‚æœç›¸ç­‰ï¼Œé‚£å°±è¯´æ˜è¦æ·»åŠ çš„å¯¹è±¡å·²ç»åœ¨</span><br><span class="line">  set é‡Œé¢äº†ã€‚ç”±æ­¤å¯çŸ¥ï¼Œå¦‚æœä»¤æ¯ä¸ªå¯¹è±¡éƒ½è¿”å›ç›¸åŒçš„å“ˆå¸Œç ï¼Œé‚£ä¹ˆåœ¨ set ä¸­å·²æœ‰ 1000000 ä¸ªå¯¹è±¡çš„æƒ…å†µä¸‹ï¼Œè‹¥æ˜¯ç»§</span><br><span class="line"> ç»­å‘å…¶ä¸­æ·»åŠ å¯¹è±¡ï¼Œåˆ™éœ€å°†è¿™ 1000000 ä¸ªå¯¹è±¡å…¨éƒ¨æ‰«æä¸€éã€‚</span><br><span class="line"> */</span><br><span class="line">- (NSUInteger)hash &#123;</span><br><span class="line">    return 1337;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/*</span><br><span class="line"> è¿™æ ·åšè¿˜éœ€è´Ÿæ‹…åˆ›å»ºå­—ç¬¦ä¸²çš„å¼€é”€ï¼Œæ‰€ä»¥æ¯”è¿”å›å•ä¸€å€¼è¦æ…¢ã€‚</span><br><span class="line"> æŠŠè¿™ç§å¯¹è±¡æ·»åŠ åˆ°collectionä¸­æ—¶ï¼Œä¹Ÿä¼šäº§ç”Ÿæ€§èƒ½é—®é¢˜</span><br><span class="line"> */</span><br><span class="line">- (NSUInteger)hash &#123;</span><br><span class="line">    NSString *stringToHash =</span><br><span class="line">        [NSString stringWithFormat:@&quot;%@:%@:%lu&quot;,</span><br><span class="line">            _firstName, _lastName, _age];</span><br><span class="line">    return [stringToHash hash];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">/*</span><br><span class="line"> æ­¤æ–¹æ³•æ—¢èƒ½ä¿æŒè¾ƒé«˜æ•ˆç‡ï¼Œåˆèƒ½ä½¿ç”Ÿæˆçš„å“ˆå¸Œç è‡³å°‘ä½äºä¸€å®šèŒƒå›´ä¹‹å†…ï¼Œè€Œä¸ä¼šè¿‡äºé¢‘ç¹åœ°é‡å¤ã€‚</span><br><span class="line"> */</span><br><span class="line">- (NSUInteger)hash &#123;</span><br><span class="line">    NSUInteger firstNameHash = [_firstName hash];</span><br><span class="line">    NSUInteger lastNameHash  = [_lastName hash];</span><br><span class="line">    NSUInteger ageHash       = _age;</span><br><span class="line">    return firstNameHash ^ lastNameHash ^ ageHash;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="ç‰¹å®šç±»æ‰€å…·æœ‰çš„ç­‰åŒæ€§åˆ¤æ–­æ–¹æ³•"><a href="#ç‰¹å®šç±»æ‰€å…·æœ‰çš„ç­‰åŒæ€§åˆ¤æ–­æ–¹æ³•" class="headerlink" title="ç‰¹å®šç±»æ‰€å…·æœ‰çš„ç­‰åŒæ€§åˆ¤æ–­æ–¹æ³•"></a>ç‰¹å®šç±»æ‰€å…·æœ‰çš„ç­‰åŒæ€§åˆ¤æ–­æ–¹æ³•</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">/** NSString */</span><br><span class="line">- (BOOL)isEqualToString:(NSString *)aString;</span><br><span class="line"></span><br><span class="line">/** NSArray */</span><br><span class="line">- (BOOL)isEqualToArray:(NSArray&lt;ObjectType&gt; *)otherArray;</span><br><span class="line"></span><br><span class="line">/** NSDictionary */</span><br><span class="line">- (BOOL)isEqualToDictionary:(NSDictionary&lt;KeyType, ObjectType&gt; *)otherDictionary;</span><br><span class="line"></span><br><span class="line">/** NSSet */</span><br><span class="line">- (BOOL)isEqualToSet:(NSSet&lt;ObjectType&gt; *)otherSet;</span><br></pre></td></tr></table></figure>
<h4 id="åˆ›å»ºè‡ªå®šä¹‰ç­‰åŒæ€§åˆ¤å®šæ–¹æ³•çš„åŸå› ï¼š"><a href="#åˆ›å»ºè‡ªå®šä¹‰ç­‰åŒæ€§åˆ¤å®šæ–¹æ³•çš„åŸå› ï¼š" class="headerlink" title="åˆ›å»ºè‡ªå®šä¹‰ç­‰åŒæ€§åˆ¤å®šæ–¹æ³•çš„åŸå› ï¼š"></a>åˆ›å»ºè‡ªå®šä¹‰ç­‰åŒæ€§åˆ¤å®šæ–¹æ³•çš„åŸå› ï¼š</h4><ol>
<li>æ— é¡»æ£€æµ‹å‚æ•°ç±»å‹ï¼Œèƒ½æå‡æ£€æµ‹é€Ÿåº¦ï¼›</li>
<li>ä»£ç æ›´ç¾è§‚ã€æ›´æ˜“è¯»ï¼Œç±»ä¼¼äº <code>isEqualToString:</code>ã€‚</li>
</ol>
<p><code>isEqual:</code> æ–¹æ³•å¸¸è§å®ç°æ–¹å¼ä¸ºï¼šå¦‚æœå—æµ‹çš„å‚æ•°ä¸æ¥æ”¶è¯¥æ¶ˆæ¯çš„å¯¹è±¡éƒ½å±äºåŒä¸€ä¸ªç±»ï¼Œé‚£ä¹ˆå°±è°ƒç”¨è‡ªå·²ç¼–å†™çš„åˆ¤å®šæ–¹æ³•ï¼Œå¦åˆ™å°±äº¤ç”±è¶…ç±»æ¥åˆ¤æ–­ã€‚</p>
<p>ç¤ºä¾‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">- (BOOL)isEqualToPerson:(EOCPerson *)otherPerson &#123;</span><br><span class="line">    // 1.1 åˆ¤æ–­ä¸¤ä¸ªæŒ‡é’ˆæ˜¯å¦ç›¸ç­‰ï¼Œå³ä¸¤ä¸ªæŒ‡é’ˆæŒ‡å‘åŒä¸€ä¸ªå¯¹è±¡</span><br><span class="line">    if (self == otherPerson) return YES;</span><br><span class="line">    </span><br><span class="line">    // 1.2 åˆ¤æ–­æ¯ä¸ªå±æ€§æ˜¯å¦éƒ½ç›¸ç­‰</span><br><span class="line">    if (![_firstName isEqualToString:otherPerson.firstName]) &#123;</span><br><span class="line">        return NO;</span><br><span class="line">    &#125;</span><br><span class="line">    if (![_lastName isEqualToString:otherPerson.lastName]) &#123;</span><br><span class="line">        return NO;</span><br><span class="line">    &#125;</span><br><span class="line">    if (_age != otherPerson.age) &#123;</span><br><span class="line">        return NO;</span><br><span class="line">    &#125;</span><br><span class="line">    return YES;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (BOOL)isEqual:(id)object &#123;</span><br><span class="line">    </span><br><span class="line">    // åˆ¤æ–­ä¸¤ä¸ªå¯¹è±¡æ˜¯å¦å±äºåŒä¸€ä¸ªç±»</span><br><span class="line">    if ( [self class] == [object class]) &#123;</span><br><span class="line">        // 1.åŒç±»ï¼Œè°ƒç”¨è‡ªå®šä¹‰åˆ¤å®šæ–¹æ³•</span><br><span class="line">        return [self isEqualToPerson:(EOCPerson *)object];</span><br><span class="line">    &#125;else &#123;</span><br><span class="line">        // 2.å¦åˆ™ï¼Œäº¤ç”±è¶…ç±»å¤„ç†</span><br><span class="line">        return [super isEqual:object];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="ç­‰åŒæ€§åˆ¤æ–­çš„æ‰§è¡Œæ·±åº¦"><a href="#ç­‰åŒæ€§åˆ¤æ–­çš„æ‰§è¡Œæ·±åº¦" class="headerlink" title="ç­‰åŒæ€§åˆ¤æ–­çš„æ‰§è¡Œæ·±åº¦"></a>ç­‰åŒæ€§åˆ¤æ–­çš„æ‰§è¡Œæ·±åº¦</h4><p>åˆ›å»ºç­‰åŒæ€§åˆ¤å®šæ–¹æ³•æ—¶ï¼Œéœ€è¦å†³å®šæ˜¯æ ¹æ®æ•´ä¸ªå¯¹è±¡æ¥åˆ¤æ–­ç­‰åŒæ€§ï¼Œè¿˜æ˜¯ä»…æ ¹æ®å…¶ä¸­å‡ ä¸ªå­—æ®µæ¥åˆ¤æ–­ã€‚</p>
<ul>
<li>æ·±åº¦ç­‰åŒæ€§åˆ¤æ–­ï¼ˆdeep equalityï¼‰;</li>
<li>æ ¹æ®è‡ªå®šä¹‰ç±»çš„ identifier æ ‡è¯†ç¬¦åˆ¤å®šã€‚</li>
</ul>
<h4 id="å®¹å™¨ä¸­å¯å˜ç±»çš„ç­‰åŒæ€§"><a href="#å®¹å™¨ä¸­å¯å˜ç±»çš„ç­‰åŒæ€§" class="headerlink" title="å®¹å™¨ä¸­å¯å˜ç±»çš„ç­‰åŒæ€§"></a>å®¹å™¨ä¸­å¯å˜ç±»çš„ç­‰åŒæ€§</h4><p>æŠŠæŸä¸ªå¯¹è±¡æ”¾å…¥ collection ä¹‹åï¼Œå°±ä¸åº”å†æ”¹å˜å…¶ï¼ˆè¿™ä¸ªå¯¹è±¡ï¼‰å“ˆå¸Œç äº†ã€‚å› ä¸ºå¦‚æœæŠŠæŸå¯¹è±¡æ”¾å…¥ set ä¹‹ååˆä¿®æ”¹å…¶å†…å®¹ï¼Œé‚£ä¹ˆåé¢çš„è¡Œä¸ºå°†å¾ˆéš¾é¢„æ–™ã€‚</p>
<h4 id="è¦ç‚¹-2"><a href="#è¦ç‚¹-2" class="headerlink" title="è¦ç‚¹"></a>è¦ç‚¹</h4><ul>
<li>è‹¥æƒ³æ£€æµ‹å¯¹è±¡çš„ç­‰åŒæ€§ï¼Œè¯·æä¾› <code>isEqual:</code> ä¸ <code>hash</code> æ–¹æ³•ã€‚</li>
<li>ç›¸åŒçš„å¯¹è±¡å¿…é¡»å…·æœ‰ç›¸åŒçš„hashç ï¼Œä½†æ˜¯ä¸¤ä¸ªhashç ç›¸åŒçš„å¯¹è±¡å´æœªå¿…ç›¸åŒã€‚</li>
<li>ä¸è¦ç›²ç›®çš„é€ä¸ªæ£€æµ‹æ¯æ¡å±æ€§ï¼Œè€Œæ˜¯åº”è¯¥ä¾ç…§å…·ä½“éœ€æ±‚æ¥åˆ¶å®šæ£€æµ‹æ–¹æ¡ˆã€‚</li>
<li>ç¼–å†™ <code>hash</code> æ–¹æ³•æ—¶ï¼Œåº”è¯¥ä½¿ç”¨è®¡ç®—é€Ÿåº¦å¿«è€Œä¸”å“ˆå¸Œç ç¢°æ’å‡ ç‡ä½çš„ç®—æ³•ã€‚</li>
</ul>
<h3 id="ç¬¬9æ¡ï¼šä»¥â€œç±»æ—æ¨¡å¼â€éšè—å®ç°ç»†èŠ‚"><a href="#ç¬¬9æ¡ï¼šä»¥â€œç±»æ—æ¨¡å¼â€éšè—å®ç°ç»†èŠ‚" class="headerlink" title="ç¬¬9æ¡ï¼šä»¥â€œç±»æ—æ¨¡å¼â€éšè—å®ç°ç»†èŠ‚"></a>ç¬¬9æ¡ï¼šä»¥â€œç±»æ—æ¨¡å¼â€éšè—å®ç°ç»†èŠ‚</h3><p><strong>ç±»æ—/ç±»åˆ«æ–¹æ³•</strong>ï¼ˆclass clusterï¼‰ï¼šå¯ä»¥éšè—â€œæŠ½è±¡åŸºç±»â€èƒŒåçš„å®ç°ç»†èŠ‚ã€‚</p>
<p>ä¾‹å¦‚ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">+ (instancetype)buttonWithType:(UIButtonType)buttonType;</span><br></pre></td></tr></table></figure>
<h4 id="åˆ›å»ºç±»æ—"><a href="#åˆ›å»ºç±»æ—" class="headerlink" title="åˆ›å»ºç±»æ—"></a>åˆ›å»ºç±»æ—</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">#import &lt;Foundation/Foundation.h&gt;</span><br><span class="line"></span><br><span class="line">/** å®šä¹‰æŠ½è±¡åŸºç±» */</span><br><span class="line">typedef NS_ENUM(NSUInteger, EOCEmployeeType) &#123;</span><br><span class="line">    EOCEmployeeTypeDeveloper,</span><br><span class="line">    EOCEmployeeTypeDesigner,</span><br><span class="line">    EOCEmployeeTypeFinance,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">@interface EOCEmployee : NSObject</span><br><span class="line"></span><br><span class="line">@property (nonatomic, copy) NSString *name;</span><br><span class="line">@property (nonatomic, assign) NSUInteger age;</span><br><span class="line"></span><br><span class="line">+ (EOCEmployee *)employeeWithType:(EOCEmployeeType)type;</span><br><span class="line">- (void)doADayWork;</span><br><span class="line"></span><br><span class="line">@end</span><br><span class="line"></span><br><span class="line">@implementation EOCEmployee</span><br><span class="line"></span><br><span class="line">+ (EOCEmployee *)employeeWithType:(EOCEmployeeType)type &#123;</span><br><span class="line">    switch (type) &#123;</span><br><span class="line">        case EOCEmployeeTypeDeveloper:</span><br><span class="line">            return [EOCEmployeeDeveloper new];</span><br><span class="line">            break;</span><br><span class="line">        case EOCEmployeeTypeDesigner:</span><br><span class="line">            return [EOCEmployeeDesigner new];</span><br><span class="line">            break;</span><br><span class="line">        case EOCEmployeeTypeFinance:</span><br><span class="line">            return [EOCEmployeeFinance new];</span><br><span class="line">            break;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (void)doADayWork &#123;</span><br><span class="line">    // Subclasses implement this</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@end</span><br></pre></td></tr></table></figure>
<p>å…¶ä¸­ï¼Œæ¯ä¸ªå®ä½“å­ç±»éƒ½ä»åŸºç±»ç»§æ‰¿è€Œæ¥</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">@interface EOCEmployeeDeveloper : EOCEmployee</span><br><span class="line">@end</span><br><span class="line"></span><br><span class="line">@implementation EOCEmployeeDeveloper</span><br><span class="line"></span><br><span class="line">- (void)doADayWork &#123;</span><br><span class="line">    [self writeCode];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@end</span><br></pre></td></tr></table></figure>
<h4 id="Cocoa-é‡Œçš„ç±»æ—"><a href="#Cocoa-é‡Œçš„ç±»æ—" class="headerlink" title="Cocoa é‡Œçš„ç±»æ—"></a>Cocoa é‡Œçš„ç±»æ—</h4><p>å¤§éƒ¨åˆ† collection ç±»éƒ½æ˜¯ç±»æ—ï¼Œå¦‚ <strong>NSArray</strong> åŠå…¶å¯å˜ç‰ˆæœ¬ <strong>NSMutableArray</strong>ã€‚</p>
<p>åˆ¤æ–­æŸä¸ªå¯¹è±¡æ˜¯å¦ä½äºç±»æ—ä¸­ï¼Œä½¿ç”¨ <code>isKindOfClass:</code> æ–¹æ³•ã€‚</p>
<h4 id="è¦ç‚¹-3"><a href="#è¦ç‚¹-3" class="headerlink" title="è¦ç‚¹"></a>è¦ç‚¹</h4><ul>
<li>ç±»æ—æ¨¡å¼å¯ä»¥æŠŠå®ç°ç»†èŠ‚éšè—åœ¨ä¸€å¥—ç®€å•çš„å…¬å…±æ¥å£åé¢ã€‚</li>
<li>ç³»ç»Ÿæ¡†æ¶ä¸­ç»å¸¸ä½¿ç”¨ç±»æ—ã€‚</li>
<li>ä»ç±»æ—çš„å…¬å…±æŠ½è±¡åŸºç±»ä¸­ç»§æ‰¿å­ç±»æ—¶è¦å½“å¿ƒï¼Œè‹¥æœ‰å¼€å‘æ–‡æ¡£ï¼Œåˆ™åº”é¦–å…ˆé˜…è¯»ã€‚</li>
</ul>
<h3 id="ç¬¬10æ¡ï¼šåœ¨æ—¢æœ‰ç±»ä¸­ä½¿ç”¨å…³è”å¯¹è±¡å­˜æ”¾è‡ªå®šä¹‰æ•°æ®"><a href="#ç¬¬10æ¡ï¼šåœ¨æ—¢æœ‰ç±»ä¸­ä½¿ç”¨å…³è”å¯¹è±¡å­˜æ”¾è‡ªå®šä¹‰æ•°æ®" class="headerlink" title="ç¬¬10æ¡ï¼šåœ¨æ—¢æœ‰ç±»ä¸­ä½¿ç”¨å…³è”å¯¹è±¡å­˜æ”¾è‡ªå®šä¹‰æ•°æ®"></a>ç¬¬10æ¡ï¼šåœ¨æ—¢æœ‰ç±»ä¸­ä½¿ç”¨å…³è”å¯¹è±¡å­˜æ”¾è‡ªå®šä¹‰æ•°æ®</h3><p>å…³è”å¯¹è±¡ï¼ˆAssociated Objectï¼‰ï¼š</p>
<ol>
<li><p>å¯ä»¥ç»™æŸå¯¹è±¡å…³è”è®¸å¤šå…¶ä»–å¯¹è±¡ï¼Œè¿™äº›å¯¹è±¡é€šè¿‡ <strong>é”®</strong> æ¥åŒºåˆ†ã€‚</p>
</li>
<li><p>å­˜å‚¨å¯¹è±¡å€¼çš„æ—¶å€™ï¼Œå¯ä»¥æŒ‡æ˜ <strong>å­˜å‚¨ç­–ç•¥</strong>ï¼ˆstorage policyï¼‰ï¼Œç”¨ä»¥ç»´æŠ¤ç›¸åº”çš„â€œå†…å­˜ç®¡ç†è¯­ä¹‰â€ã€‚å­˜å‚¨ç­–ç•¥ç”±åä¸º <code>objc_AssociationPolicy</code> çš„æšä¸¾æ‰€å®šä¹‰ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">typedef enum objc_AssociationPolicy : uintptr_t &#123;</span><br><span class="line">    OBJC_ASSOCIATION_ASSIGN = 0,</span><br><span class="line">    OBJC_ASSOCIATION_RETAIN_NONATOMIC = 1,</span><br><span class="line">    OBJC_ASSOCIATION_COPY_NONATOMIC = 3,</span><br><span class="line">    OBJC_ASSOCIATION_RETAIN = 01401,</span><br><span class="line">    OBJC_ASSOCIATION_COPY = 01403</span><br><span class="line">&#125; objc_AssociationPolicy;</span><br></pre></td></tr></table></figure>
<p>| å…³è”ç±»å‹                              | ç­‰æ•ˆçš„ @property å±æ€§ |<br>| :â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€“ | :â€”â€”â€”â€”â€” |<br>| OBJC_ASSOCIATION_ASSIGN           | assign           |<br>| OBJC_ASSOCIATION_RETAIN_NONATOMIC | nonatomicï¼Œretain |<br>| OBJC_ASSOCIATION_COPY_NONATOMIC   | nonatomicï¼Œcopy   |<br>| OBJC_ASSOCIATION_RETAIN           | retain           |<br>| OBJC_ASSOCIATION_COPY             | copy             |</p>
</li>
</ol>
<p>ç®¡ç†å…³è”å¯¹è±¡çš„æ–¹æ³•ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">// ä»¥ç»™å®šçš„é”®å’Œç­–ç•¥ä¸ºæŸå¯¹è±¡è®¾ç½®å…³è”å¯¹è±¡å€¼ã€‚</span><br><span class="line">void objc_setAssociatedObject(id object, const void *key, id value, objc_AssociationPolicy policy);</span><br><span class="line"></span><br><span class="line">// æ ¹æ®ç»™å®šçš„é”®ä»æŸå¯¹è±¡ä¸­è·å–ç›¸åº”çš„å…³è”å¯¹è±¡å€¼ã€‚</span><br><span class="line">id objc_getAssociatedObject(id object, const void *key);</span><br><span class="line"></span><br><span class="line">// ç§»é™¤æŒ‡å®šå¯¹è±¡çš„å…¨éƒ¨å…³è”å¯¹è±¡ã€‚</span><br><span class="line">void objc_removeAssociatedObjects(id object);</span><br></pre></td></tr></table></figure>
<blockquote>
<p>æˆ‘ä»¬å¯ä»¥æŠŠæŸå¯¹è±¡æƒ³è±¡æˆ <strong>NSDictionary</strong>ï¼ŒæŠŠå…³è”åˆ°è¯¥å¯¹è±¡çš„å€¼ç†è§£ä¸ºå­—å…¸ä¸­çš„æ¡ç›®ï¼Œäºæ˜¯ï¼Œå­˜å–å…³è”å¯¹è±¡çš„å€¼å°±ç›¸å½“äºåœ¨ <strong>NSDictionary</strong> å¯¹è±¡ä¸Šè°ƒç”¨ <code>[object setObject:value forKey:key]</code> ä¸ <code>[object objectForKey:key]</code> æ–¹æ³•ã€‚</p>
<p>ç„¶è€Œä¸¤è€…ä¹‹é—´æœ‰ä¸ªé‡è¦å·®åˆ«ï¼šè®¾ç½®å…³è”å¯¹è±¡æ—¶ç”¨çš„é”®ï¼ˆkeyï¼‰æ˜¯ä¸ª <strong>ä¸é€æ˜çš„æŒ‡é’ˆ</strong>ï¼ˆopaque pointerï¼‰ã€‚å¦‚æœåœ¨ä¸¤ä¸ªé”®ä¸Šè°ƒç”¨ <code>isEqual:</code> æ–¹æ³•çš„è¿”å›å€¼æ˜¯ YESï¼Œé‚£ä¹ˆ <strong>NSDictionary</strong> å°±è®¤ä¸ºäºŒè€…ç›¸ç­‰ï¼›ç„¶è€Œåœ¨è®¾ç½®å…³è”å¯¹è±¡å€¼æ—¶ï¼Œè‹¥æƒ³ä»¤ä¸¤ é”®åŒ¹é…åˆ°åŒä¸€ä¸ªå€¼ï¼Œåˆ™äºŒè€…å¿…é¡»æ˜¯å®Œå…¨ç›¸åŒçš„æŒ‡é’ˆæ‰è¡Œã€‚é‰´äºæ­¤ï¼Œ<strong>åœ¨è®¾ç½®å…³è”å¯¹è±¡å€¼æ—¶ï¼Œ é€šå¸¸ä½¿ç”¨é™æ€å…¨å±€å˜é‡åšé”®ã€‚</strong></p>
</blockquote>
<h4 id="è¦ç‚¹-4"><a href="#è¦ç‚¹-4" class="headerlink" title="è¦ç‚¹"></a>è¦ç‚¹</h4><ul>
<li>å¯ä»¥é€šè¿‡â€œå…³è”å¯¹è±¡â€æœºåˆ¶æ¥æŠŠä¸¤ä¸ªå¯¹è±¡è¿èµ·æ¥ã€‚</li>
<li>å®šä¹‰å…³è”å¯¹è±¡æ—¶å¯æŒ‡å®šå†…å­˜ç®¡ç†è¯­ä¹‰ï¼Œç”¨ä»¥æ¨¡ä»¿å®šä¹‰å±æ€§æ—¶æ‰€é‡‡ç”¨çš„â€œæ‹¥æœ‰å…³ç³»â€ä¸â€œéæ‹¥æœ‰å…³ç³»â€ã€‚</li>
<li>åªæœ‰åœ¨å…¶ä»–åšæ³•ä¸å¯è¡Œæ—¶æ‰åº”é€‰ç”¨å…³è”å¯¹è±¡ï¼Œå› ä¸ºè¿™ç§åšæ³•é€šå¸¸ä¼šå¼•å…¥éš¾äºæŸ¥æ‰¾çš„bugã€‚</li>
</ul>
<h3 id="ç¬¬11æ¡ï¼šç†è§£-objc-msgSend-çš„ä½œç”¨"><a href="#ç¬¬11æ¡ï¼šç†è§£-objc-msgSend-çš„ä½œç”¨" class="headerlink" title="ç¬¬11æ¡ï¼šç†è§£ objc_msgSend çš„ä½œç”¨"></a>ç¬¬11æ¡ï¼šç†è§£ objc_msgSend çš„ä½œç”¨</h3><blockquote>
<p>è¿è¡ŒæœŸç³»ç»Ÿå¦‚ä½•æŸ»æ‰¾å¹¶è°ƒç”¨æŸæ–¹æ³•çš„å®ç°ä»£ç ?</p>
</blockquote>
<ul>
<li>åœ¨ Objectice-C å¯¹è±¡ä¸Šè°ƒç”¨æ–¹æ³•ç§°ä¹‹ä¸º <strong>ä¼ é€’æ¶ˆæ¯</strong>ã€‚</li>
<li>æ¶ˆæ¯æœ‰ <strong>åç§°</strong>ï¼ˆnameï¼‰æˆ– <strong>é€‰æ‹©å­</strong>ï¼ˆselectorï¼‰ï¼Œå¯ä»¥æ¥å—å‚æ•°ã€ä¼ é€’è¿”å›å€¼ã€‚</li>
<li><strong>C</strong> è¯­è¨€ä½¿ç”¨ <strong>é™æ€ç»‘å®š</strong> çš„å‡½æ•°è°ƒç”¨æ–¹å¼ã€‚å³<strong>åœ¨ç¼–è¯‘æœŸå°±èƒ½å†³å®šè¿è¡Œæ—¶æ‰€åº”è°ƒç”¨çš„å‡½æ•°</strong>ã€‚</li>
<li><strong>åŠ¨æ€ç»‘å®š</strong>ï¼šéœ€è¦è°ƒç”¨çš„å‡½æ•°ç›´åˆ°è¿è¡ŒæœŸæ‰èƒ½ç¡®å®šã€‚</li>
</ul>
<blockquote>
<p>åœ¨ Objective-C ä¸­ï¼Œå¦‚æœå‘æŸå¯¹è±¡ä¼ é€’æ¶ˆæ¯ï¼Œé‚£å°±ä¼šä½¿ç”¨åŠ¨æ€ç»‘å®šæœºåˆ¶æ¥å†³å®šéœ€è¦è°ƒç”¨çš„æ–¹æ³•ã€‚åœ¨åº•å±‚ï¼Œæ‰€æœ‰æ–¹æ³•éƒ½æ˜¯æ™®é€šçš„ C è¯­è¨€å‡½æ•°ï¼Œç„¶è€Œå¯¹è±¡æ”¶åˆ°æ¶ˆæ¯ä¹‹åï¼Œç©¶ç«Ÿè¯¥è°ƒç”¨å“ªä¸ªæ–¹æ³•åˆ™å®Œå…¨äºè¿è¡ŒæœŸå†³å®šï¼Œç”šè‡³å¯ä»¥åœ¨ç¨‹åºè¿è¡Œæ—¶æ”¹å˜ï¼Œè¿™äº›ç‰¹æ€§ä½¿å¾— Objective-C æˆä¸ºä¸€é—¨çœŸæ­£çš„åŠ¨æ€è¯­è¨€ã€‚</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">/*</span><br><span class="line"> ç»™å¯¹è±¡å‘é€æ¶ˆæ¯</span><br><span class="line"></span><br><span class="line"> æ¥æ”¶è€…(receiver): someObject</span><br><span class="line"> é€‰æ‹©å­(selector): messageName</span><br><span class="line"> æ¶ˆæ¯(message): é€‰æ‹©å­ + å‚æ•°</span><br><span class="line"> */</span><br><span class="line">id returnValue = [someObject messageName:parameter];</span><br><span class="line"></span><br><span class="line">// ç¼–è¯‘å™¨çœ‹åˆ°ä¸Šé¢è¿™æ¡æ¶ˆæ¯åï¼Œå°†å…¶è½¬æ¢ä¸ºä¸€æ¡æ ‡å‡†çš„ C è¯­è¨€å‡½æ•°è°ƒç”¨ï¼Œ</span><br><span class="line">// æ‰€è°ƒç”¨çš„å‡½æ•°æ˜¯æ¶ˆæ¯ä¼ é€’æœºåˆ¶ä¸­çš„æ ¸å¿ƒå‡½æ•°ï¼Œå«åš objc_msgSend</span><br><span class="line">void objc_msgSend(void /* id self, SEL op, ... */ )</span><br><span class="line"></span><br><span class="line">// æ¶ˆæ¯æ´¾å‘ï¼›</span><br><span class="line">// æ–¹æ³•åˆ—è¡¨ï¼›</span><br><span class="line">// æ¶ˆæ¯è½¬å‘æœºåˆ¶ï¼›</span><br><span class="line">// å¿«é€Ÿæ˜ å°„è¡¨ï¼Œç¼“å­˜åŒ¹é…çš„æ–¹æ³•åç»“æœã€‚</span><br></pre></td></tr></table></figure>
<p>Objectice-C è¿è¡Œç¯å¢ƒçš„å…¶ä»–å‡½æ•°ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">/*</span><br><span class="line">  å¦‚æœå¾…å‘é€çš„æ¶ˆæ¯è¦è¿”å›ç»“æ„ä½“ï¼Œé‚£ä¹ˆå¯äº¤ç”±æ­¤å‡½æ•°å¤„ç†ã€‚</span><br><span class="line"></span><br><span class="line">  åªæœ‰å½“CPUçš„å¯„å­˜å™¨èƒ½å¤Ÿå®¹çº³å¾—ä¸‹æ¶ˆæ¯è¿”å›ç±»å‹æ—¶ï¼Œè¿™ä¸ªå‡½æ•°æ‰èƒ½å¤„ç†æ­¤æ¶ˆæ¯ã€‚</span><br><span class="line">  è‹¥æ˜¯è¿”å›å€¼æ— æ³•å®¹çº³äºCPUå¯„å­˜å™¨ä¸­ï¼ˆæ¯”å¦‚è¯´è¿”å›çš„ç»“æ„ä½“å¤ªå¤§äº†)ï¼Œé‚£ä¹ˆå°±ç”±å¦ä¸€ä¸ªå‡½æ•°æ‰§è¡Œæ´¾å‘ã€‚</span><br><span class="line">  æ­¤æ—¶ï¼Œé‚£ä¸ªå‡½æ•°ä¼šé€šè¿‡åˆ†é…åœ¨æ ˆä¸Šçš„æŸä¸ªå˜é‡æ¥å¤„ç†æ¶ˆæ¯æ‰€è¿”å›çš„ç»“æ„ä½“ã€‚</span><br><span class="line"> */</span><br><span class="line">void objc_msgSend_stret(id self, SEL op, ...);</span><br><span class="line"></span><br><span class="line">/*</span><br><span class="line"> å¦‚æœæ¶ˆæ¯è¿”å›çš„æ˜¯æµ®ç‚¹æ•°ï¼Œé‚£ä¹ˆå¯äº¤ç”±æ­¤å‡½æ•°å¤„ç†ã€‚</span><br><span class="line"> </span><br><span class="line"> åœ¨æŸäº›æ¶æ„çš„ CPU ä¸­è°ƒç”¨å‡½æ•°æ—¶ï¼Œéœ€è¦å¯¹ â€æµ®ç‚¹æ•°å¯„å­˜å™¨â€œï¼ˆfloating-point register)åšç‰¹æ®Šå¤„ç†ã€‚</span><br><span class="line"> ä¹Ÿå°±æ˜¯è¯´ï¼Œé€šå¸¸æ‰€ç”¨çš„ objc_msgSend åœ¨è¿™ç§æƒ…å†µä¸‹å¹¶ä¸åˆé€‚ã€‚</span><br><span class="line"> è¿™ä¸ªå‡½æ•°æ˜¯ä¸ºäº†å¤„ç† x86 ç­‰æ¶æ„ CPU ä¸­æŸäº›ä»¤äººç¨è§‰æƒŠè®¶çš„å¥‡æ€ªçŠ¶å†µã€‚</span><br><span class="line"> */</span><br><span class="line">long double objc_msgSend_fpret(id self, SEL op, ...);</span><br><span class="line"></span><br><span class="line">/*</span><br><span class="line"> å¦‚æœè¦ç»™è¶…ç±»å‘æ¶ˆæ¯ï¼Œä¾‹å¦‚ [super message:parameter],é‚£ä¹ˆå°±äº¤ç”±æ­¤å‡½æ•°å¤„ç†ã€‚</span><br><span class="line"> </span><br><span class="line"> ä¹Ÿæœ‰å¦å¤–ä¸¤ä¸ªä¸ objc_msgSend_stret å’Œ objc_msgSend_fpret ç­‰æ•ˆçš„å‡½æ•°ï¼Œ</span><br><span class="line"> ç”¨äºå¤„ç†å‘ç»™ super çš„ç›¸åº”æ¶ˆæ¯ã€‚</span><br><span class="line"> */</span><br><span class="line">id objc_msgSendSuper(struct objc_super *super, SEL op, ...);</span><br></pre></td></tr></table></figure>
<h4 id="è¦ç‚¹-5"><a href="#è¦ç‚¹-5" class="headerlink" title="è¦ç‚¹"></a>è¦ç‚¹</h4><ul>
<li>æ¶ˆæ¯ç”±æ¥å—è€…ï¼ŒselectoråŠå‚æ•°æ„æˆã€‚ç»™æŸå¯¹è±¡â€œå‘é€æ¶ˆæ¯â€ä¹Ÿå°±ç›¸å½“äºåœ¨è¯¥å¯¹è±¡ä¸Šè°ƒç”¨æ–¹æ³•ã€‚</li>
<li>å‘ç»™æŸå¯¹è±¡çš„å…¨éƒ¨æ¶ˆæ¯éƒ½è¦ç”±â€œåŠ¨æ€æ¶ˆæ¯æ´¾å‘ç³»ç»Ÿâ€æ¥å¤„ç†ï¼Œè¯¥ç³»ç»Ÿä¼šæŸ¥å‡ºå¯¹åº”çš„æ–¹æ³•ï¼Œå¹¶æ‰§è¡Œå…¶ä»£ç ã€‚</li>
</ul>
<h3 id="ç¬¬12æ¡ï¼šç†è§£æ¶ˆæ¯è½¬å‘æœºåˆ¶"><a href="#ç¬¬12æ¡ï¼šç†è§£æ¶ˆæ¯è½¬å‘æœºåˆ¶" class="headerlink" title="ç¬¬12æ¡ï¼šç†è§£æ¶ˆæ¯è½¬å‘æœºåˆ¶"></a>ç¬¬12æ¡ï¼šç†è§£æ¶ˆæ¯è½¬å‘æœºåˆ¶</h3><blockquote>
<p>æ¶ˆæ¯è½¬å‘çš„åŸç†ï¼Œå¦‚æœç±»æ— æ³•ç«‹å³å“åº”æŸä¸ªé€‰æ‹©å­, é‚£ä¹ˆå°±ä¼šå¯åŠ¨æ¶ˆæ¯è½¬å‘æµç¨‹ã€‚</p>
</blockquote>
<h4 id="æ¶ˆæ¯è½¬å‘æœºåˆ¶"><a href="#æ¶ˆæ¯è½¬å‘æœºåˆ¶" class="headerlink" title="æ¶ˆæ¯è½¬å‘æœºåˆ¶"></a>æ¶ˆæ¯è½¬å‘æœºåˆ¶</h4><blockquote>
<p>åœ¨ç¼–è¯‘æœŸå‘ç±»å‘é€äº†å…¶æ— æ³•è§£è¯»çš„æ¶ˆæ¯å¹¶ä¸ä¼šæŠ¥é”™ï¼Œå› ä¸ºåœ¨è¿è¡ŒæœŸå¯ä»¥ç»§ç»­å‘ç±»ä¸­æ·»åŠ æ–¹æ³•ï¼Œæ‰€ä»¥ ç¼–è¯‘å™¨åœ¨ç¼–è¯‘æ—¶è¿˜æ— æ³•ç¡®çŸ¥ç±»ä¸­åˆ°åº•ä¼šä¸ä¼šæœ‰æŸä¸ªæ–¹æ³•å®ç°ã€‚</p>
<p>å½“å¯¹è±¡æ¥æ”¶åˆ°æ— æ³•è§£è¯»çš„æ¶ˆæ¯åï¼Œå°±ä¼šå¯åŠ¨ <strong>æ¶ˆæ¯è½¬å‘</strong>ï¼ˆmessage forwardingï¼‰æœºåˆ¶ï¼Œç¨‹åºå‘˜å¯ç»ç”±æ­¤è¿‡ç¨‹å‘Šè¯‰å¯¹è±¡åº”è¯¥å¦‚ä½•å¤„ç†æœªçŸ¥æ¶ˆæ¯ã€‚</p>
</blockquote>
<p>æ¶ˆæ¯è½¬å‘çš„ä¸¤ä¸ªé˜¶æ®µï¼š</p>
<p>ç¬¬ä¸€é˜¶æ®µï¼Œ<strong>åŠ¨æ€æ–¹æ³•è§£æ</strong>ï¼ˆdynamic method resolutionï¼‰ï¼šå…ˆå¾è¯¢æ¥æ”¶è€…ï¼Œæ‰€å±çš„ç±»ï¼Œçœ‹å…¶æ˜¯å¦èƒ½åŠ¨æ€æ·»åŠ æ–¹æ³•ï¼Œä»¥å¤„ç†å½“å‰è¿™ä¸ª<strong>æœªçŸ¥çš„é€‰æ‹©å­</strong>ï¼ˆunknown selectorï¼‰ã€‚</p>
<p>ç¬¬äºŒé˜¶æ®µï¼Œæ¶‰åŠ<strong>å®Œæ•´çš„æ¶ˆæ¯è½¬å‘æœºåˆ¶</strong>ï¼ˆfull forwarding mechanism)ã€‚å¦‚æœè¿è¡ŒæœŸç³»ç»Ÿå·²ç»æŠŠç¬¬ä¸€é˜¶æ®µæ‰§è¡Œå®Œäº†ï¼Œé‚£ä¹ˆæ¥æ”¶è€…è‡ªå·±å°±æ— æ³•å†ä»¥åŠ¨æ€æ–°å¢æ–¹æ³•çš„æ‰‹æ®µæ¥å“åº”åŒ…å«è¯¥é€‰æ‹©å­çš„æ¶ˆæ¯äº†ã€‚æ­¤æ—¶ï¼Œè¿è¡ŒæœŸç³»ç»Ÿä¼šè¯·æ±‚æ¥æ”¶è€…ä»¥å…¶ä»–æ‰‹æ®µæ¥å¤„ç†ä¸æ¶ˆæ¯ç›¸å…³çš„æ–¹æ³•è°ƒç”¨ã€‚ç»†åˆ†ä¸ºä¸¤å°æ­¥ï¼š</p>
<ul>
<li>é¦–å…ˆï¼Œè¯·æ¥æ”¶è€…çœ‹çœ‹æœ‰æ²¡æœ‰å…¶ä»–å¯¹è±¡èƒ½å¤„ç†è¿™æ¡æ¶ˆæ¯ã€‚è‹¥æœ‰ï¼Œåˆ™è¿è¡ŒæœŸç³»ç»Ÿä¼šæŠŠæ¶ˆæ¯è½¬ç»™é‚£ä¸ªå¯¹è±¡ï¼Œäºæ˜¯æ¶ˆæ¯è½¬å‘è¿‡ç¨‹ç»“æŸï¼Œä¸€åˆ‡å¦‚å¸¸ã€‚</li>
<li>è‹¥æ²¡æœ‰<strong>å¤‡æ´çš„æ¥æ”¶è€…</strong>ï¼ˆreplacement receiver)ï¼Œåˆ™å¯åŠ¨å®Œæ•´çš„æ¶ˆæ¯è½¬å‘æœºåˆ¶ï¼Œè¿è¡ŒæœŸç³»ç»Ÿä¼šæŠŠä¸æ¶ˆæ¯æœ‰å…³çš„å…¨éƒ¨ç»†èŠ‚éƒ½å°è£…åˆ° <strong>NSInvocation</strong> å¯¹è±¡ä¸­ï¼Œå†ç»™æ¥æ”¶è€…æœ€åä¸€æ¬¡æœºä¼šï¼Œä»¤å…¶è®¾æ³•è§£å†³å½“å‰ è¿˜æœªå¤„ç†çš„è¿™æ¡æ¶ˆæ¯ã€‚</li>
</ul>
<h4 id="åŠ¨æ€æ–¹æ³•è§£æ"><a href="#åŠ¨æ€æ–¹æ³•è§£æ" class="headerlink" title="åŠ¨æ€æ–¹æ³•è§£æ"></a>åŠ¨æ€æ–¹æ³•è§£æ</h4><p>å¯¹è±¡åœ¨æ”¶åˆ°æ— æ³•è§£è¯»çš„æ¶ˆæ¯åï¼Œé¦–å…ˆå°†è°ƒç”¨å…¶æ‰€å±ç±»çš„ä¸‹åˆ—ç±»æ–¹æ³•ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">+ (BOOL)resolveInstanceMethod:(SEL)sel;</span><br></pre></td></tr></table></figure>
<p>è¯¥æ–¹æ³•çš„å‚æ•°å°±æ˜¯é‚£ä¸ªæœªçŸ¥çš„é€‰æ‹©å­ï¼Œå…¶è¿”å›å€¼ä¸º Boolean ç±»å‹ï¼Œè¡¨ç¤ºè¿™ä¸ªç±»æ˜¯å¦èƒ½æ–°å¢ä¸€ä¸ªå®ä¾‹æ–¹æ³•ç”¨ä»¥å¤„ç†æ­¤é€‰æ‹©å­ã€‚åœ¨ç»§ç»­å¾€ä¸‹æ‰§è¡Œè½¬å‘æœºåˆ¶ä¹‹å‰ï¼Œæœ¬ç±»æœ‰æœºä¼šæ–°å¢ä¸€ä¸ªå¤„ç†æ­¤é€‰æ‹©å­çš„æ–¹æ³•ã€‚å‡å¦‚å°šæœªå®ç°çš„æ–¹æ³•ä¸æ˜¯<strong>å®ä¾‹æ–¹æ³•</strong>è€Œæ˜¯<strong>ç±»æ–¹æ³•</strong>ï¼Œé‚£ä¹ˆè¿è¡ŒæœŸç³»ç»Ÿå°±ä¼šè°ƒ ç”¨å¦å¤–ä¸€ä¸ªæ–¹æ³•ï¼Œè¯¥æ–¹æ³•ä¸ <code>resolvelnstanceMethod:</code> ç±»ä¼¼ï¼Œå«åš <code>resolveClassMethod:</code>ã€‚</p>
<p><strong>ä½¿ç”¨è¿™ç§åŠæ³•çš„å‰æ</strong>ï¼šç›¸å…³æ–¹æ³•çš„å®ç°ä»£ç å·²ç»å†™å¥½ï¼Œåªç­‰ç€è¿è¡Œçš„æ—¶å€™åŠ¨æ€æ’åœ¨ç±»é‡Œé¢å°±å¯ä»¥äº†ã€‚æ­¤æ–¹æ¡ˆå¸¸ç”¨æ¥å®ç° <strong>@dynamic</strong> å±æ€§ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">id autoDictioanryGetter(id self, SEL _cmd);</span><br><span class="line">void autoDictionarySetter(id self, SEL _cmd, id value);</span><br><span class="line"></span><br><span class="line">+ (BOOL)resolveInstanceMethod:(SEL)sel &#123;</span><br><span class="line">    NSString *selectorString = NSStringFromSelector(sel);</span><br><span class="line">    if ( /** selector is from a @dynamic property */ ) &#123;</span><br><span class="line">        if ([selectorString hasPrefix:@&quot;set&quot;]) &#123;</span><br><span class="line">            class_addMethod(self,</span><br><span class="line">                            sel,</span><br><span class="line">                            (IMP)autoDictionarySetter,</span><br><span class="line">                            &quot;v@:@&quot;);</span><br><span class="line">        &#125;else &#123;</span><br><span class="line">            class_addMethod(self,</span><br><span class="line">                            sel,</span><br><span class="line">                            (IMP)autoDictioanryGetter,</span><br><span class="line">                            &quot;@@:&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">        return YES;</span><br><span class="line">    &#125;</span><br><span class="line">    return [super resolveInstanceMethod:sel];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="å¤‡æ´æ¥æ”¶è€…"><a href="#å¤‡æ´æ¥æ”¶è€…" class="headerlink" title="å¤‡æ´æ¥æ”¶è€…"></a>å¤‡æ´æ¥æ”¶è€…</h4><p>å½“å‰æ¥æ”¶è€…è¿˜æœ‰ç¬¬äºŒæ¬¡æœºä¼šèƒ½å¤„ç†æœªçŸ¥çš„é€‰æ‹©å­ï¼Œåœ¨è¿™ä¸€æ­¥ä¸­ï¼Œè¿è¡ŒæœŸç³»ç»Ÿä¼šé—®å®ƒï¼šèƒ½ä¸èƒ½æŠŠè¿™æ¡æ¶ˆæ¯è½¬ç»™å…¶ä»–æ¥æ”¶è€…æ¥å¤„ç†ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">- (id)forwardingTargetForSelector:(SEL)aSelector;</span><br></pre></td></tr></table></figure>
<p>è¯¥æ–¹æ³•å‚æ•°ä»£è¡¨æœªçŸ¥çš„é€‰æ‹©å­ï¼Œè‹¥å½“å‰æ¥æ”¶è€…èƒ½æ‰¾åˆ°å¤‡æ´å¯¹è±¡ï¼Œåˆ™å°†å…¶è¿”å›ï¼Œè‹¥æ‰¾ä¸åˆ°ï¼Œ å°±è¿”å›nilã€‚é€šè¿‡æ­¤æ–¹æ¡ˆï¼Œæˆ‘ä»¬å¯ä»¥ç”¨ â€œç»„åˆâ€ï¼ˆcompositionï¼‰æ¥æ¨¡æ‹Ÿå‡º â€œå¤šé‡ç»§æ‰¿â€ï¼ˆmultiple inheritanceï¼‰çš„æŸäº›ç‰¹æ€§ã€‚åœ¨ä¸€ä¸ªå¯¹è±¡å†…éƒ¨ï¼Œå¯èƒ½è¿˜æœ‰ä¸€ç³»åˆ—å…¶ä»–å¯¹è±¡ï¼Œè¯¥å¯¹è±¡å¯ç»ç”±æ­¤æ–¹æ³•å°†èƒ½å¤Ÿå¤„ç†æŸé€‰æ‹©å­çš„ç›¸å…³å†…éƒ¨å¯¹è±¡è¿”å›ï¼Œè¿™æ ·çš„è¯ï¼Œåœ¨å¤–ç•Œçœ‹æ¥ï¼Œå¥½åƒæ˜¯è¯¥å¯¹è±¡äº²è‡ªå¤„ç†äº†è¿™äº›æ¶ˆæ¯ä¼¼çš„ã€‚</p>
<h4 id="å®Œæ•´çš„æ¶ˆæ¯è½¬å‘æœºåˆ¶"><a href="#å®Œæ•´çš„æ¶ˆæ¯è½¬å‘æœºåˆ¶" class="headerlink" title="å®Œæ•´çš„æ¶ˆæ¯è½¬å‘æœºåˆ¶"></a>å®Œæ•´çš„æ¶ˆæ¯è½¬å‘æœºåˆ¶</h4><p>é¦–å…ˆåˆ›å»º <strong>NSInvocation</strong> å¯¹è±¡ï¼ŒæŠŠä¸å°šæœªå¤„ç†çš„é‚£æ¡æ¶ˆæ¯æœ‰å…³çš„å…¨éƒ¨ç»†èŠ‚éƒ½å°äºå…¶ä¸­ã€‚ æ­¤å¯¹è±¡åŒ…å«é€‰æ‹©å­ã€ç›®æ ‡ï¼ˆtargetï¼‰åŠå‚æ•°ã€‚åœ¨è§¦å‘ <strong>NSInvocation</strong> å¯¹è±¡æ—¶ï¼Œâ€œæ¶ˆæ¯æ´¾å‘ç³»ç»Ÿâ€ (message-dispatch systemï¼‰å°†äº²è‡ªå‡ºé©¬ï¼ŒæŠŠæ¶ˆæ¯æŒ‡æ´¾ç»™ç›®æ ‡å¯¹è±¡ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">- (void)forwardInvocation:(NSInvocation *)anInvocation;</span><br></pre></td></tr></table></figure>
<p>è¿™ä¸ªæ–¹æ³•å¯ä»¥å®ç°å¾—å¾ˆç®€å•ï¼šåªéœ€æ”¹å˜è°ƒç”¨ç›®æ ‡ï¼Œä½¿æ¶ˆæ¯åœ¨æ–°ç›®æ ‡ä¸Šå¾—ä»¥è°ƒç”¨å³å¯ã€‚ç„¶è€Œè¿™æ ·å®ç°å‡ºæ¥çš„æ–¹æ³•ä¸â€œå¤‡æ´æ¥æ”¶è€…â€æ–¹æ¡ˆæ‰€å®ç°çš„æ–¹æ³•ç­‰æ•ˆï¼Œæ‰€ä»¥å¾ˆå°‘æœ‰äººé‡‡ç”¨è¿™ä¹ˆç®€å•çš„å®ç°æ–¹å¼ã€‚</p>
<p>æ¯”è¾ƒæœ‰ç”¨çš„å®ç°æ–¹å¼ä¸ºï¼šåœ¨è§¦å‘æ¶ˆæ¯å‰ï¼Œå…ˆä»¥æŸç§æ–¹å¼æ”¹å˜æ¶ˆæ¯å†…å®¹ï¼Œæ¯”å¦‚è¿½åŠ å¦å¤–ä¸€ä¸ªå‚æ•°ï¼Œæˆ–æ˜¯æ”¹æ¢é€‰æ‹©å­ï¼Œç­‰ç­‰ã€‚</p>
<h4 id="æ¶ˆæ¯è½¬å‘å…¨æµç¨‹"><a href="#æ¶ˆæ¯è½¬å‘å…¨æµç¨‹" class="headerlink" title="æ¶ˆæ¯è½¬å‘å…¨æµç¨‹"></a>æ¶ˆæ¯è½¬å‘å…¨æµç¨‹</h4><p><img src="http://upload-images.jianshu.io/upload_images/2648731-10ed9ec668fbef9e.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt></p>
<p>æ¥æ”¶è€…åœ¨æ¯ä¸€æ­¥ä¸­å‡æœ‰æœºä¼šå¤„ç†æ¶ˆæ¯ã€‚æ­¥éª¤è¶Šå¾€åï¼Œå¤„ç†æ¶ˆæ¯çš„ä»£ä»·å°±è¶Šå¤§ã€‚æœ€å¥½èƒ½åœ¨ç¬¬ä¸€æ­¥å°±å¤„ç†å®Œï¼Œè¿™æ ·çš„è¯ï¼Œè¿è¡ŒæœŸç³»ç»Ÿå°±å¯ä»¥å°†æ­¤æ–¹æ³•ç¼“å­˜èµ·æ¥äº†ã€‚å¦‚æœè¿™ä¸ªç±»çš„å®ä¾‹ç¨åè¿˜æ”¶åˆ°åŒåé€‰æ‹©å­ï¼Œé‚£ä¹ˆæ ¹æœ¬æ— é¡»å¯åŠ¨æ¶ˆæ¯è½¬å‘æµç¨‹ã€‚è‹¥æƒ³åœ¨ç¬¬ä¸‰æ­¥é‡ŒæŠŠæ¶ˆæ¯è½¬ç»™å¤‡æ´çš„æ¥æ”¶è€…ï¼Œé‚£è¿˜ä¸å¦‚æŠŠè½¬å‘æ“ä½œæå‰åˆ°ç¬¬äºŒæ­¥ã€‚å› ä¸ºç¬¬ä¸‰æ­¥åªæ˜¯ä¿®æ”¹äº†è°ƒç”¨ç›®æ ‡ï¼Œè¿™é¡¹æ”¹åŠ¨æ”¾åœ¨ç¬¬äºŒæ­¥æ‰§è¡Œä¼šæ›´ä¸ºç®€å•ï¼Œä¸ç„¶çš„è¯ï¼Œè¿˜å¾—åˆ›å»ºå¹¶å¤„ç†å®Œæ•´çš„ <strong>NSInvocation</strong> ã€‚</p>
<h4 id="ä»¥å®Œæ•´çš„ä¾‹å­æ¼”ç¤ºåŠ¨æ€æ–¹æ³•è§£æ"><a href="#ä»¥å®Œæ•´çš„ä¾‹å­æ¼”ç¤ºåŠ¨æ€æ–¹æ³•è§£æ" class="headerlink" title="ä»¥å®Œæ•´çš„ä¾‹å­æ¼”ç¤ºåŠ¨æ€æ–¹æ³•è§£æ"></a>ä»¥å®Œæ•´çš„ä¾‹å­æ¼”ç¤ºåŠ¨æ€æ–¹æ³•è§£æ</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br></pre></td><td class="code"><pre><span class="line">// *************************************************************</span><br><span class="line">//  EOCAutoDictionary.h</span><br><span class="line">#import &lt;Foundation/Foundation.h&gt;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> ä»¥åŠ¨æ€æ–¹æ³•è§£æå®ç° @dynamic å±æ€§</span><br><span class="line"> </span><br><span class="line"> ç¼–å†™ä¸€ä¸ªç±»ä¼¼äºâ€œå­—å…¸â€çš„å¯¹è±¡ï¼Œå®ƒé‡Œé¢å¯ä»¥å®¹çº³å…¶ä»–å¯¹è±¡ï¼Œåªä¸è¿‡å¼€å‘è€…è¦ç›´æ¥é€šè¿‡å±æ€§æ¥å­˜å–å…¶ä¸­çš„æ•°æ®ã€‚</span><br><span class="line"> è®¾è®¡æ€è·¯æ˜¯ï¼šç”±å¼€å‘è€…æ¥æ·»åŠ å±æ€§å®šä¹‰ï¼Œå¹¶å°†å…¶å£°æ˜ä¸º @dynamicï¼Œè€Œç±»åˆ™ä¼šè‡ªåŠ¨å¤„ç†ç›¸å…³å±æ€§å€¼çš„å­˜æ”¾ä¸è·å–æ“ä½œã€‚</span><br><span class="line"> */</span><br><span class="line">@interface EOCAutoDictionary : NSObject</span><br><span class="line">@property (nonatomic, strong) NSString *string;</span><br><span class="line">@property (nonatomic, strong) NSNumber *number;</span><br><span class="line">@property (nonatomic, strong) NSDate *date;</span><br><span class="line">@property (nonatomic, strong) id opaqueObject;</span><br><span class="line">@end</span><br><span class="line"></span><br><span class="line">// *************************************************************</span><br><span class="line">//  EOCAutoDictionary.m</span><br><span class="line">#import &quot;EOCAutoDictionary.h&quot;</span><br><span class="line">#import &lt;objc/runtime.h&gt;</span><br><span class="line"></span><br><span class="line">@interface EOCAutoDictionary ()</span><br><span class="line">/** åœ¨ç±»çš„å†…éƒ¨ï¼Œæ¯ä¸ªå±æ€§çš„å€¼éƒ½å­˜æ”¾åœ¨å­—å…¸é‡Œ */</span><br><span class="line">@property (nonatomic, strong) NSMutableDictionary *backingStore;</span><br><span class="line">@end</span><br><span class="line"></span><br><span class="line">/** getter å‡½æ•° */</span><br><span class="line">id autoDictioanryGetter(id self, SEL _cmd) &#123;</span><br><span class="line">    // ä»å¯¹è±¡ä¸­è·å–å­˜å‚¨å™¨</span><br><span class="line">    EOCAutoDictionary *typeSelf = (EOCAutoDictionary *)self;</span><br><span class="line">    NSMutableDictionary *backingStore = typeSelf.backingStore;</span><br><span class="line">    </span><br><span class="line">    // å­—å…¸çš„ key æ˜¯ selector çš„åå­—</span><br><span class="line">    NSString *key = NSStringFromSelector(_cmd);</span><br><span class="line">    </span><br><span class="line">    // Return the value</span><br><span class="line">    return [backingStore objectForKey:key];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/** Setter å‡½æ•° */</span><br><span class="line">void autoDictionarySetter(id self, SEL _cmd, id value) &#123;</span><br><span class="line">    // ä»å¯¹è±¡ä¸­è·å–å­˜å‚¨å™¨</span><br><span class="line">    EOCAutoDictionary *typeSelf = (EOCAutoDictionary *)self;</span><br><span class="line">    NSMutableDictionary *backingStore =  typeSelf.backingStore;</span><br><span class="line">    </span><br><span class="line">    /** </span><br><span class="line">     *  selector çš„åç§°æ ¼å¼åƒè¿™æ ·ï¼š&quot;setOpaqueObject:&quot;</span><br><span class="line">     *  æˆ‘ä»¬éœ€è¦ç§»é™¤ &quot;set&quot;ï¼Œ&quot;:&quot;ï¼Œå¹¶ä¸”å°†é¦–å­—æ¯å°å†™</span><br><span class="line">     */</span><br><span class="line">    NSString *selectorString = NSStringFromSelector(_cmd);</span><br><span class="line">    NSMutableString *key = [selectorString mutableCopy];</span><br><span class="line">    </span><br><span class="line">    // ç§»é™¤æœ«å°¾çš„ â€œ:â€</span><br><span class="line">    [key deleteCharactersInRange:NSMakeRange(key.length - 1, 1)];</span><br><span class="line">    </span><br><span class="line">    // ç§»é™¤ â€œsetâ€ å‰ç¼€</span><br><span class="line">    [key deleteCharactersInRange:NSMakeRange(0, 3)];</span><br><span class="line">    </span><br><span class="line">    // é¦–å­—æ¯å°å†™</span><br><span class="line">    NSString *lowercaseFirstChar = [[key substringToIndex:1] lowercaseString];</span><br><span class="line">    [key replaceCharactersInRange:NSMakeRange(0, 1)</span><br><span class="line">                       withString:lowercaseFirstChar];</span><br><span class="line">    </span><br><span class="line">    if (value) &#123;</span><br><span class="line">        [backingStore setObject:value forKey:key];</span><br><span class="line">    &#125;else &#123;</span><br><span class="line">        [backingStore removeObjectForKey:key];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@implementation EOCAutoDictionary</span><br><span class="line">/** ç¦æ­¢ç¼–è¯‘å™¨è‡ªåŠ¨ç”Ÿæˆå®ä¾‹å˜é‡å’Œå­˜å–æ–¹æ³• */</span><br><span class="line">@dynamic string, number, date, opaqueObject;</span><br><span class="line"></span><br><span class="line">- (instancetype)init &#123;</span><br><span class="line">    if (self = [super init]) &#123;</span><br><span class="line">        _backingStore = [NSMutableDictionary new];</span><br><span class="line">    &#125;</span><br><span class="line">    return self;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">+ (BOOL)resolveInstanceMethod:(SEL)sel &#123;</span><br><span class="line">    NSString *selectorString = NSStringFromSelector(sel);</span><br><span class="line">    if ([selectorString hasPrefix:@&quot;set&quot;]) &#123;</span><br><span class="line">        // å‘ç±»ä¸­åŠ¨æ€åœ°æ·»åŠ æ–¹æ³•ï¼Œç”¨ä»¥å¤„ç†ç»™å®šçš„é€‰æ‹©å­</span><br><span class="line">        // ç¬¬ä¸‰ä¸ªå‚æ•°ä¸ºå‡½æ•°æŒ‡é’ˆï¼ŒæŒ‡å‘å¾…æ·»åŠ çš„æ–¹æ³•</span><br><span class="line">        // æœ€åä¸€ä¸ªå‚æ•°è¡¨ç¤ºå¾…æ·»åŠ æ–¹æ³•çš„ç±»å‹ç¼–ç </span><br><span class="line">        class_addMethod(self,</span><br><span class="line">                        sel,</span><br><span class="line">                        (IMP)autoDictionarySetter,</span><br><span class="line">                        &quot;v@:@&quot;);</span><br><span class="line">    &#125;else &#123;</span><br><span class="line">        class_addMethod(self,</span><br><span class="line">                        sel,</span><br><span class="line">                        (IMP)autoDictioanryGetter,</span><br><span class="line">                        &quot;@@:&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    return YES;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@end</span><br></pre></td></tr></table></figure>
<p>ä½¿ç”¨ <strong>EOCAutoDictionary</strong>:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">EOCAutoDictionary *dict = [EOCAutoDictionary new];</span><br><span class="line">dict.date = [NSDate dateWithTimeIntervalSince1970:475372800];</span><br><span class="line">NSLog(@&quot;dict.date = %@&quot;,dict.date);</span><br><span class="line">// dict.date = Thu Jan 24 08:00:00 1985</span><br></pre></td></tr></table></figure>
<blockquote>
<p><strong>CoreAnimation</strong> æ¡†æ¶ä¸­çš„ <strong>CALayer</strong> ç±»ä½¿ç”¨äº†ä¸æœ¬ä¾‹ç›¸ä¼¼çš„å®ç°æ–¹å¼ï¼Œè¿™ä½¿å¾— <strong>CALayer</strong> æˆä¸º <strong>å…¼å®¹äºé”®å€¼ç¼–ç çš„</strong>ï¼ˆkey-value-coding-compliantï¼‰å®¹å™¨ç±»ï¼Œ ä¹Ÿå°±ç­‰äºè¯´ï¼Œèƒ½å¤Ÿå‘é‡Œé¢éšæ„æ·»åŠ å±æ€§ï¼Œç„¶åä»¥é”®å€¼å¯¹çš„å½¢å¼æ¥è®¿é—®ã€‚äºæ˜¯ï¼Œå¼€å‘è€…å°±å¯ä»¥å‘å…¶ä¸­æ–°å¢è‡ªå®šä¹‰çš„å±æ€§äº†ï¼Œè¿™äº›å±æ€§å€¼çš„å­˜å‚¨å·¥ä½œç”±åŸºç±»ç›´æ¥è´Ÿè´£ï¼Œæˆ‘ä»¬åªéœ€åœ¨ <strong>CALayer</strong> çš„å­ç±»ä¸­å®šä¹‰æ–°å±æ€§å³å¯ã€‚</p>
</blockquote>
<h4 id="è¦ç‚¹-6"><a href="#è¦ç‚¹-6" class="headerlink" title="è¦ç‚¹"></a>è¦ç‚¹</h4><ul>
<li>è‹¥å¯¹è±¡æ— æ³•å“åº”æŸä¸ª selectorï¼Œåˆ™è¿›å…¥æ¶ˆæ¯è½¬å‘æµç¨‹ã€‚</li>
<li>é€šè¿‡è¿è¡ŒæœŸçš„åŠ¨æ€æ–¹æ³•è§£æåŠŸèƒ½ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨éœ€è¦ç”¨åˆ°æŸä¸ªæ–¹æ³•æ—¶å†å°†å…¶åŠ å…¥ç±»ä¸­ã€‚</li>
<li>å¯¹è±¡å¯ä»¥å°†å…¶æ— æ³•è§£è¯»çš„æŸäº› selector è½¬äº¤ç»™å…¶ä»–å¯¹è±¡å¤„ç†ã€‚</li>
<li>ç»è¿‡ä¸Šè¿°ä¸¤æ­¥åï¼Œå¦‚æœè¿˜æ˜¯æ²¡åŠæ³•å¤„ç† selectorï¼Œé‚£å°±å¯åŠ¨å®Œæ•´çš„æ¶ˆæ¯è½¬å‘æœºåˆ¶ã€‚</li>
</ul>
<h3 id="ç¬¬13æ¡ï¼šç”¨â€œæ–¹æ³•è°ƒé…æŠ€æœ¯â€è°ƒè¯•â€œé»‘ç›’æ–¹æ³•â€"><a href="#ç¬¬13æ¡ï¼šç”¨â€œæ–¹æ³•è°ƒé…æŠ€æœ¯â€è°ƒè¯•â€œé»‘ç›’æ–¹æ³•â€" class="headerlink" title="ç¬¬13æ¡ï¼šç”¨â€œæ–¹æ³•è°ƒé…æŠ€æœ¯â€è°ƒè¯•â€œé»‘ç›’æ–¹æ³•â€"></a>ç¬¬13æ¡ï¼šç”¨â€œæ–¹æ³•è°ƒé…æŠ€æœ¯â€è°ƒè¯•â€œé»‘ç›’æ–¹æ³•â€</h3><blockquote>
<p>Objective-C å¯¹è±¡æ”¶åˆ°æ¶ˆæ¯ä¹‹åï¼Œç©¶ç«Ÿä¼šè°ƒç”¨ä½•ç§æ–¹æ³•éœ€è¦åœ¨è¿è¡ŒæœŸæ‰èƒ½è§£æå‡ºæ¥ã€‚</p>
<p><strong>æ–¹æ³•è°ƒé…</strong>ï¼ˆmethod swizzlingï¼‰ï¼šä¸ç»™å®šçš„é€‰æ‹©å­åç§°ç›¸å¯¹åº”çš„æ–¹æ³•ä¹Ÿå¯ä»¥åœ¨è¿è¡ŒæœŸæ”¹å˜ã€‚</p>
<p>æ­¤ç‰¹æ€§çš„ä¼˜åŠ¿ï¼š</p>
<ol>
<li>æ—¢ä¸éœ€è¦æºä»£ç ï¼Œä¹Ÿä¸éœ€è¦é€šè¿‡ç»§æ‰¿å­ç±»æ¥è¦†å†™æ–¹æ³•å°±èƒ½æ”¹å˜è¿™ä¸ªç±»æœ¬èº«çš„åŠŸèƒ½ã€‚</li>
<li>æ–°çš„åŠŸèƒ½å°†åœ¨æœ¬ç±»çš„æ‰€æœ‰å®ä¾‹ä¸­ç”Ÿæ•ˆï¼Œè€Œä¸æ˜¯ä»…é™äºè¦†å†™äº†ç›¸å…³æ–¹æ³•çš„é‚£äº›å­ç±»å®ä¾‹ã€‚</li>
</ol>
</blockquote>
<h4 id="åŸç†"><a href="#åŸç†" class="headerlink" title="åŸç†"></a>åŸç†</h4><p>ç±»çš„æ–¹æ³•åˆ—è¡¨ä¼šæŠŠé€‰æ‹©å­çš„åç§°æ˜ å°„åˆ°ç›¸å…³çš„æ–¹æ³•å®ç°ä¹‹ä¸Šï¼Œä½¿å¾— <strong>åŠ¨æ€æ¶ˆæ¯æ´¾å‘ç³»ç»Ÿ</strong> èƒ½å¤Ÿæ®æ­¤æ‰¾åˆ°åº”è¯¥è°ƒç”¨çš„æ–¹æ³•ã€‚è¿™äº›æ–¹æ³•å‡ä»¥å‡½æ•°æŒ‡é’ˆçš„å½¢å¼æ¥è¡¨ç¤ºï¼Œè¿™ç§æŒ‡é’ˆå«åš IMPã€‚</p>
<p><img src="http://upload-images.jianshu.io/upload_images/2648731-ce52a126501763e8.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt></p>
<p>è€Œ Objective-C è¿è¡ŒæœŸç³»ç»Ÿæä¾›çš„æ–¹æ³•å¯ä»¥æ“ä½œè¿™å¼ æ–¹æ³•åˆ—è¡¨ã€‚å¼€å‘è€…å¯ä»¥å‘å…¶ä¸­æ–°å¢é€‰æ‹©å­ï¼Œä¹Ÿå¯ä»¥æ”¹å˜æŸé€‰æ‹©å­æ‰€å¯¹åº”çš„æ–¹æ³•å®ç°ï¼Œè¿˜å¯ä»¥äº¤æ¢ä¸¤ä¸ªé€‰æ‹©å­æ‰€æ˜ å°„åˆ°çš„æŒ‡é’ˆã€‚</p>
<p><img src="http://upload-images.jianshu.io/upload_images/2648731-2e77df73ca622d08.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">// è·å¾—æ–¹æ³•å®ç°</span><br><span class="line">Method class_getInstanceMethod(Class cls, SEL name);</span><br><span class="line"></span><br><span class="line">// äº’æ¢ä¸¤ä¸ªæ–¹æ³•å®ç°</span><br><span class="line">void method_exchangeImplementations(Method m1, Method m2);</span><br></pre></td></tr></table></figure>
<p>ç¤ºä¾‹ä¸€ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">// äº’æ¢ä¸¤ä¸ªæ–¹æ³•å®ç°</span><br><span class="line">Method originalMethod =</span><br><span class="line">    class_getClassMethod([NSString class],</span><br><span class="line">                         @selector(lowercaseString));</span><br><span class="line">Method swappedMethod =</span><br><span class="line">    class_getClassMethod([NSString class],</span><br><span class="line">                         @selector(uppercaseString));</span><br><span class="line">method_exchangeImplementations(originalMethod, swappedMethod);</span><br></pre></td></tr></table></figure>
<p>ç¤ºä¾‹äºŒï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">// *************************************************************</span><br><span class="line">//  NSString+EOCMyAdditions.h</span><br><span class="line">#import &lt;Foundation/Foundation.h&gt;</span><br><span class="line"></span><br><span class="line">@interface NSString (EOCMyAdditions)</span><br><span class="line">- (NSString *)eoc_myLowercaseString;</span><br><span class="line">@end</span><br><span class="line"></span><br><span class="line">// *************************************************************</span><br><span class="line">//  NSString+EOCMyAdditions.m</span><br><span class="line">#import &quot;NSString+EOCMyAdditions.h&quot;</span><br><span class="line"></span><br><span class="line">@implementation NSString (EOCMyAdditions)</span><br><span class="line">- (NSString *)eoc_myLowercaseString &#123;</span><br><span class="line">    NSString *lowercase = [self eoc_myLowercaseString];</span><br><span class="line">    NSLog(@&quot;%@ =&gt; %@&quot;, self, lowercase);</span><br><span class="line">    return lowercase;</span><br><span class="line">&#125;</span><br><span class="line">@end</span><br><span class="line"></span><br><span class="line">// *************************************************************</span><br><span class="line">// åœ¨è¿è¡ŒæœŸï¼Œeoc_myLowercaseString æ‹©å­å®é™…ä¸Šå¯¹åº”äºåŸæœ‰çš„ owercaseString æ³•å®ç°ã€‚</span><br><span class="line">Method originalMethod =</span><br><span class="line">class_getClassMethod([NSString class],</span><br><span class="line">                     @selector(lowercaseString));</span><br><span class="line">Method swappedMethod =</span><br><span class="line">class_getClassMethod([NSString class],</span><br><span class="line">                     @selector(eoc_myLowercaseString));</span><br><span class="line">method_exchangeImplementations(originalMethod, swappedMethod);</span><br></pre></td></tr></table></figure>
<blockquote>
<p>é€šè¿‡æ­¤æ–¹æ¡ˆï¼Œå¼€å‘è€…å¯ä»¥ä¸ºé‚£äº› <strong>å®Œå…¨ä¸çŸ¥é“å…¶å…·ä½“å®ç°çš„</strong>ï¼ˆcompletely opaque, â€œå®Œå…¨ä¸é€æ˜çš„â€ï¼‰é»‘ç›’æ–¹æ³•å¢åŠ æ—¥å¿—è®°å½•åŠŸèƒ½ï¼Œè¿™éå¸¸æœ‰åŠ©äºç¨‹åºè°ƒè¯•ã€‚</p>
<p>ç„¶è€Œï¼Œæ­¤åšæ³•åªåœ¨è°ƒè¯•ç¨‹åºæ—¶æœ‰ç”¨ã€‚å¾ˆå°‘æœ‰äººåœ¨è°ƒè¯•ç¨‹åºä¹‹å¤–çš„åœºåˆç”¨ä¸Šè¿° <strong>æ–¹æ³•è°ƒé…æŠ€æœ¯</strong> æ¥æ°¸ä¹…æ”¹åŠ¨æŸä¸ªç±»çš„åŠŸèƒ½ã€‚ä¸èƒ½ä»…ä»…å› ä¸º Objective-C è¯­è¨€é‡Œæœ‰è¿™ä¸ªç‰¹æ€§å°±ä¸€å®šè¦ç”¨å®ƒã€‚è‹¥æ˜¯æ»¥ç”¨ï¼Œåè€Œä¼šä»¤ä»£ç å˜å¾—ä¸æ˜“è¯»æ‡‚ä¸”éš¾äºç»´æŠ¤ã€‚</p>
</blockquote>
<h4 id="è¦ç‚¹-7"><a href="#è¦ç‚¹-7" class="headerlink" title="è¦ç‚¹"></a>è¦ç‚¹</h4><ul>
<li>åœ¨ runtime è¿è¡ŒæœŸï¼Œå¯ä»¥å‘ç±»ä¸­æ–°å¢æˆ–æ›¿æ¢ selector æ‰€å¯¹åº”çš„æ–¹æ³•å®ç°ã€‚</li>
<li>ä½¿ç”¨å¦ä¸€ä»½å®ç°æ¥æ›¿æ¢åŸæœ‰çš„æ–¹æ³•å®ç°ï¼Œè¿™é“å·¥åºå«åšæ–¹æ³•è°ƒé…ï¼ˆmethod swizzlingï¼‰ï¼Œå¼€å‘è€…å¸¸ç”¨æ­¤æŠ€æœ¯å‘åŸæœ‰å®ç°ä¸­æ·»åŠ åŠŸèƒ½ã€‚</li>
<li>ä¸€èˆ¬æ¥è¯´ï¼Œåªæœ‰è°ƒè¯•ç¨‹åºçš„æ—¶å€™æ‰éœ€è¦åœ¨ runtime ä¸­ä¿®æ”¹æ–¹æ³•å®ç°ï¼Œè¿™ç§åšæ³•ä¸å®œæ»¥ç”¨ã€‚</li>
</ul>
<h3 id="ç¬¬14æ¡ï¼šç†è§£â€œç±»å¯¹è±¡â€çš„ç”¨æ„"><a href="#ç¬¬14æ¡ï¼šç†è§£â€œç±»å¯¹è±¡â€çš„ç”¨æ„" class="headerlink" title="ç¬¬14æ¡ï¼šç†è§£â€œç±»å¯¹è±¡â€çš„ç”¨æ„"></a>ç¬¬14æ¡ï¼šç†è§£â€œç±»å¯¹è±¡â€çš„ç”¨æ„</h3><ul>
<li>å¯¹è±¡ç±»å‹å¹¶éåœ¨ç¼–è¯‘æœŸå°±ç»‘å®šå¥½äº†ï¼Œè€Œæ˜¯è¦åœ¨è¿è¡ŒæœŸæŸ»æ‰¾ã€‚</li>
<li><strong>id</strong> æ˜¯ç‰¹æ®Šç±»å‹ï¼Œå®ƒèƒ½æŒ‡ä»£ä»»æ„çš„ Objective-C å¯¹è±¡ç±»å‹ã€‚</li>
<li><strong>åœ¨è¿è¡ŒæœŸæ£€è§†å¯¹è±¡ç±»å‹</strong> è¿™ä¸€æ“ä½œä¹Ÿå«åš <strong>ç±»å‹ä¿¡æ¯æŸ»è¯¢</strong>ã€‚</li>
<li>åœ¨ç¨‹åºä¸­ä¸è¦ç›´æ¥æ¯”è¾ƒå¯¹è±¡æ‰€å±çš„ç±»ï¼Œæ˜æ™ºçš„åšæ³•æ˜¯è°ƒç”¨<strong>ç±»å‹ä¿¡æ¯æŸ»è¯¢æ–¹æ³•</strong>ã€‚</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">// æ­¤ç»“æ„ä½“å­˜æ”¾ç±»çš„å…ƒæ•°æ®</span><br><span class="line">struct objc_class &#123;</span><br><span class="line">    Class isa  OBJC_ISA_AVAILABILITY;</span><br><span class="line"></span><br><span class="line">#if !__OBJC2__</span><br><span class="line">    // å®šä¹‰æœ¬ç±»çš„è¶…ç±»</span><br><span class="line">    Class super_class                                        OBJC2_UNAVAILABLE;</span><br><span class="line">    const char *name                                         OBJC2_UNAVAILABLE;</span><br><span class="line">    long version                                             OBJC2_UNAVAILABLE;</span><br><span class="line">    long info                                                OBJC2_UNAVAILABLE;</span><br><span class="line">    long instance_size                                       OBJC2_UNAVAILABLE;</span><br><span class="line">    struct objc_ivar_list *ivars                             OBJC2_UNAVAILABLE;</span><br><span class="line">    struct objc_method_list **methodLists                    OBJC2_UNAVAILABLE;</span><br><span class="line">    struct objc_cache *cache                                 OBJC2_UNAVAILABLE;</span><br><span class="line">    struct objc_protocol_list *protocols                     OBJC2_UNAVAILABLE;</span><br><span class="line">#endif</span><br><span class="line"></span><br><span class="line">&#125; OBJC2_UNAVAILABLE;</span><br></pre></td></tr></table></figure>
<ul>
<li>æ¯ä¸ªå¯¹è±¡ç»“æ„ä½“çš„é¦–ä¸ªæˆå‘˜æ˜¯ Class ç±»çš„å˜é‡ã€‚è¯¥å˜é‡å®šä¹‰äº†å¯¹è±¡æ‰€å±çš„ç±», é€šå¸¸ç§°ä¸º <code>is a</code> æŒ‡é’ˆã€‚</li>
<li><code>superclass</code> æŒ‡é’ˆç¡®ç«‹äº†ç»§æ‰¿å…³ç³»ï¼Œè€Œ <code>isa</code> æŒ‡é’ˆæè¿°äº†å®ä¾‹æ‰€å±çš„ç±»ã€‚</li>
</ul>
<h4 id="åœ¨ç±»ç»§æ‰¿ä½“ç³»ä¸­æŸ¥è¯¢ç±»å‹ä¿¡æ¯"><a href="#åœ¨ç±»ç»§æ‰¿ä½“ç³»ä¸­æŸ¥è¯¢ç±»å‹ä¿¡æ¯" class="headerlink" title="åœ¨ç±»ç»§æ‰¿ä½“ç³»ä¸­æŸ¥è¯¢ç±»å‹ä¿¡æ¯"></a>åœ¨ç±»ç»§æ‰¿ä½“ç³»ä¸­æŸ¥è¯¢ç±»å‹ä¿¡æ¯</h4><p>ç±»å‹ä¿¡æ¯æŸ»è¯¢æ–¹æ³•ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">// å¯¹è±¡æ˜¯å¦ä¸ºæŸç±»æˆ–å…¶æ´¾ç”Ÿç±»çš„å®ä¾‹</span><br><span class="line">- (BOOL)isKindOfClass:(Class)aClass;</span><br><span class="line"></span><br><span class="line">// å¯¹è±¡æ˜¯å¦ä¸ºæŸä¸ªç‰¹å®šç±»çš„å®ä¾‹</span><br><span class="line">- (BOOL)isMemberOfClass:(Class)aClass;</span><br></pre></td></tr></table></figure>
<p>ç¤ºä¾‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">NSMutableDictionary *dict = [NSMutableDictionary new];</span><br><span class="line"></span><br><span class="line">[dict isMemberOfClass:[NSDictionary class]]; // NO</span><br><span class="line">[dict isMemberOfClass:[NSMutableDictionary class]]; // NO,ç±»æ—æ¨¡å¼â€¼ï¸</span><br><span class="line">[dict isKindOfClass:[NSDictionary class]]; // YES</span><br><span class="line">[dict isKindOfClass:[NSMutableDictionary class]]; // YES</span><br><span class="line">[dict isKindOfClass:[NSArray class]]; // NO</span><br></pre></td></tr></table></figure>
<p>ä¸¤è€…çš„åŒºåˆ«ï¼š<code>isMemberOfClass:</code> ä¸èƒ½æ£€æµ‹ä»»ä½•çš„ç±»éƒ½æ˜¯åŸºäº <strong>NSObject</strong> ç±»è¿™ä¸€äº‹å®ï¼Œè€Œ <code>isKindOfClass:</code> å¯ä»¥ã€‚</p>
<p>ç¤ºä¾‹äºŒï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">// æ ¹æ®æ•°ç»„ä¸­å­˜å‚¨çš„å¯¹è±¡ç”Ÿæˆä»¥é€—å·åˆ†éš”çš„å­—ç¬¦ä¸²</span><br><span class="line">- (NSString *)commaSeparatedStringFromObjects:(NSArray *)array &#123;</span><br><span class="line">    NSMutableString *string = [NSMutableString new];</span><br><span class="line">    [array enumerateObjectsUsingBlock:^(id  _Nonnull obj, NSUInteger idx, BOOL * _Nonnull stop) &#123;</span><br><span class="line">        if ([obj isKindOfClass:[NSString class]]) &#123;</span><br><span class="line">            [string appendFormat:@&quot;%@,&quot;, obj];</span><br><span class="line">        &#125;else if ([obj isKindOfClass:[NSNumber class]]) &#123;</span><br><span class="line">            [string appendFormat:@&quot;%d,&quot;, [obj intValue]];</span><br><span class="line">        &#125;else if ([obj isKindOfClass:[NSData class]]) &#123;</span><br><span class="line">            NSString *base64Encoded = [obj base64EncodedStringWithOptions:NSDataBase64Encoding64CharacterLineLength];</span><br><span class="line">            [string appendFormat:@&quot;%@,&quot;, base64Encoded];</span><br><span class="line">        &#125;else &#123;</span><br><span class="line">            // Type not support</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;];</span><br><span class="line">    return string;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="ç±»å‹ä¿¡æ¯æŸ¥è¯¢æ–¹æ³•-amp-class-æ–¹æ³•"><a href="#ç±»å‹ä¿¡æ¯æŸ¥è¯¢æ–¹æ³•-amp-class-æ–¹æ³•" class="headerlink" title="ç±»å‹ä¿¡æ¯æŸ¥è¯¢æ–¹æ³• &amp; class æ–¹æ³•"></a>ç±»å‹ä¿¡æ¯æŸ¥è¯¢æ–¹æ³• &amp; <code>class</code> æ–¹æ³•</h4><figure class="highlight smali"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">// ä½¿ç”¨ class æ–¹æ³•ä¹Ÿå¯ä»¥ç²¾ç¡®åˆ¤æ–­å‡ºå¯¹è±¡æ˜¯å¦ä¸ºæŸç±»å®ä¾‹</span><br><span class="line">id object;</span><br><span class="line">if ([object class] == [NSString class]) &#123;</span><br><span class="line">    // object is an<span class="built_in"> instance </span>of NSString</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ç±»å‹ä¿¡æ¯æŸ¥è¯¢æ–¹æ³•å¯ä»¥æ­£ç¡®å¤„ç†é‚£äº›ä½¿ç”¨äº†æ¶ˆæ¯ä¼ é€’æœºåˆ¶çš„å¯¹è±¡ã€‚</p>
<blockquote>
<p>æŸä¸ªå¯¹è±¡å¯èƒ½ä¼šæŠŠå…¶æ”¶åˆ°çš„æ‰€æœ‰é€‰æ‹©å­éƒ½è½¬å‘ç»™å¦å¤–ä¸€ä¸ªå¯¹è±¡ã€‚è¿™æ ·çš„å¯¹è±¡å«åš <strong>ä»£ç†</strong> ï¼ˆproxyï¼‰ï¼Œæ­¤ç§å¯¹è±¡å‡ä»¥ <strong>NSProxy</strong> ä¸ºæ ¹ç±»ã€‚</p>
<p>é€šå¸¸æƒ…å†µä¸‹ï¼Œå¦‚æœåœ¨æ­¤ç§ä»£ç†å¯¹è±¡ä¸Šè°ƒç”¨ <code>class</code> æ–¹æ³•ï¼Œé‚£ä¹ˆè¿”å›çš„æ˜¯ä»£ç†å¯¹è±¡æœ¬èº«ï¼ˆæ­¤ç±»æ˜¯ <strong>NSProxy</strong> çš„å­ç±»)ï¼Œè€Œéæ¥å—çš„ä»£ç†çš„å¯¹è±¡æ‰€å±çš„ç±»ã€‚</p>
<p>ç„¶è€Œï¼Œè‹¥æ˜¯æ”¹ç”¨ <code>isKindOfClass:</code> è¿™æ ·çš„ç±»å‹ä¿¡æ¯æŸ»è¯¢æ–¹æ³•ï¼Œé‚£ä¹ˆä»£ç†å¯¹è±¡å°±ä¼šæŠŠè¿™æ¡æ¶ˆæ¯è½¬ç»™ <strong>æ¥å—ä»£ç†çš„å¯¹è±¡</strong>ï¼ˆproxied object)ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œè¿™æ¡æ¶ˆæ¯çš„è¿”å›å€¼ä¸ç›´æ¥åœ¨æ¥å—ä»£ç†çš„å¯¹è±¡ä¸Šé¢æŸ»è¯¢å…¶ç±»å‹æ‰€å¾—çš„ç»“æœç›¸åŒã€‚å› æ­¤ï¼Œè¿™æ ·æŸ»å‡ºæ¥çš„ç±»å¯¹è±¡ä¸é€šè¿‡ <code>class</code> æ–¹æ³•æ‰€è¿”å›çš„é‚£ä¸ªç±»å¯¹è±¡ä¸åŒï¼Œ<code>class</code>æ–¹æ³•æ‰€è¿”å›çš„ç±»è¡¨ç¤ºå‘èµ·ä»£ç†çš„å¯¹è±¡ï¼Œè€Œéæ¥å—ä»£ç†çš„å¯¹è±¡ã€‚</p>
</blockquote>
<h4 id="è¦ç‚¹-8"><a href="#è¦ç‚¹-8" class="headerlink" title="è¦ç‚¹"></a>è¦ç‚¹</h4><ul>
<li>æ¯ä¸ªå®ä¾‹éƒ½æœ‰ä¸€ä¸ªæŒ‡å‘ Class å¯¹è±¡çš„æŒ‡é’ˆï¼Œç”¨ä»¥è¡¨æ˜å…¶ç±»å‹ï¼Œè€Œè¿™äº› Class å¯¹è±¡åˆ™æ„æˆäº†ç±»çš„ç»§æ‰¿ä½“ç³»ã€‚</li>
<li>å¦‚æœå¯¹è±¡ç±»å‹æ— æ³•åœ¨ç¼–è¯‘æœŸç¡®å®šï¼Œé‚£ä¹ˆå°±åº”è¯¥ä½¿ç”¨ç±»å‹ä¿¡æ¯æŸ¥è¯¢æ–¹æ³•æ¥æ¢çŸ¥ã€‚</li>
<li>å°½é‡ä½¿ç”¨ç±»å‹ä¿¡æ¯æŸ¥è¯¢æ–¹æ³•æ¥ç¡®å®šå¯¹è±¡ç±»å‹ï¼Œè€Œä¸è¦ç›´æ¥æ¯”è¾ƒç±»å¯¹è±¡ï¼Œå› ä¸ºæŸäº›å¯¹è±¡å¯èƒ½å®ç°äº†æ¶ˆæ¯è½¬å‘åŠŸèƒ½ã€‚</li>
</ul>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://andy0570.com/2017/08/21/ä¸ƒã€ç³»ç»Ÿæ¡†æ¶/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ç‹¬æœ¨èˆŸçš„æœ¨">
      <meta itemprop="description" content="æœ‰æ—¶å€™é˜³å…‰å¾ˆå¥½ æœ‰æ—¶å€™é˜³å…‰å¾ˆæš—">
      <meta itemprop="image" content="https://ws1.sinaimg.cn/large/006tNc79gy1g22m14458rj30u014xu0x.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ç‹¬æœ¨èˆŸçš„æœ¨">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2017/08/21/ä¸ƒã€ç³»ç»Ÿæ¡†æ¶/" class="post-title-link" itemprop="url">ä¸ƒã€ç³»ç»Ÿæ¡†æ¶</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              

              
                
              

              <time title="åˆ›å»ºæ—¶é—´ï¼š2017-08-21 10:56:00" itemprop="dateCreated datePublished" datetime="2017-08-21T10:56:00+08:00">2017-08-21</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">æ›´æ–°äº</span>
                
                <time title="ä¿®æ”¹æ—¶é—´ï¼š2019-04-16 00:13:36" itemprop="dateModified" datetime="2019-04-16T00:13:36+08:00">2019-04-16</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/ã€ŠEffective-Objective-C-2-0ã€‹/" itemprop="url" rel="index"><span itemprop="name">ã€ŠEffective Objective-C 2.0ã€‹</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          
            <span id="/2017/08/21/ä¸ƒã€ç³»ç»Ÿæ¡†æ¶/" class="leancloud_visitors" data-flag-title="ä¸ƒã€ç³»ç»Ÿæ¡†æ¶">
              <span class="post-meta-divider">|</span>
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              
                <span class="post-meta-item-text">é˜…è¯»æ¬¡æ•°ï¼š</span>
              
                <span class="leancloud-visitors-count"></span>
            </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body han-init-context" itemprop="articleBody">

      
      

      
        
          
            <h1 id="ã€ŠEffective-Objective-C-2-0-ç¼–å†™é«˜è´¨é‡iOSä¸OS-Xä»£ç çš„52ä¸ªæœ‰æ•ˆæ–¹æ³•-ã€‹å­¦ä¹ ç¬”è®°"><a href="#ã€ŠEffective-Objective-C-2-0-ç¼–å†™é«˜è´¨é‡iOSä¸OS-Xä»£ç çš„52ä¸ªæœ‰æ•ˆæ–¹æ³•-ã€‹å­¦ä¹ ç¬”è®°" class="headerlink" title="ã€ŠEffective Objective-C 2.0  ç¼–å†™é«˜è´¨é‡iOSä¸OS Xä»£ç çš„52ä¸ªæœ‰æ•ˆæ–¹æ³• ã€‹å­¦ä¹ ç¬”è®°"></a>ã€ŠEffective Objective-C 2.0  ç¼–å†™é«˜è´¨é‡iOSä¸OS Xä»£ç çš„52ä¸ªæœ‰æ•ˆæ–¹æ³• ã€‹å­¦ä¹ ç¬”è®°</h1><p><img src="http://upload-images.jianshu.io/upload_images/2648731-7dcb0ad568b4fb8b.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt></p>
<h2 id="ç¬¬7ç« -ç³»ç»Ÿæ¡†æ¶"><a href="#ç¬¬7ç« -ç³»ç»Ÿæ¡†æ¶" class="headerlink" title="ç¬¬7ç«  ç³»ç»Ÿæ¡†æ¶"></a>ç¬¬7ç«  ç³»ç»Ÿæ¡†æ¶</h2><h3 id="ç¬¬47æ¡ï¼šç†Ÿæ‚‰ç³»ç»Ÿæ¡†æ¶"><a href="#ç¬¬47æ¡ï¼šç†Ÿæ‚‰ç³»ç»Ÿæ¡†æ¶" class="headerlink" title="ç¬¬47æ¡ï¼šç†Ÿæ‚‰ç³»ç»Ÿæ¡†æ¶"></a>ç¬¬47æ¡ï¼šç†Ÿæ‚‰ç³»ç»Ÿæ¡†æ¶</h3><p><strong>æ¡†æ¶</strong>ï¼šå°†ä¸€ç³»åˆ—ä»£ç å°è£…ä¸ºåŠ¨æ€åº“ï¼ˆdynamic library)ï¼Œå¹¶åœ¨å…¶ä¸­æ”¾å…¥æè¿°å…¶æ¥å£çš„å¤´æ–‡ä»¶ã€‚</p>
<p><strong>é™æ€åº“</strong>ï¼šæœ‰æ—¶ä¸º iOS å¹³å°æ„å»ºçš„ç¬¬ä¸‰æ–¹æ¡†æ¶æ‰€ä½¿ç”¨çš„æ˜¯é™æ€åº“ï¼ˆstatic library)ï¼Œè¿™æ˜¯å› ä¸º iOS åº”ç”¨ç¨‹åºä¸å…è®¸åœ¨å…¶ä¸­åŒ…å«åŠ¨æ€åº“ã€‚è¿™äº›ä¸œè¥¿ä¸¥æ ¼æ¥è®²å¹¶ä¸æ˜¯çœŸæ­£çš„æ¡†æ¶ï¼Œç„¶è€Œä¹Ÿç»å¸¸è§†ä¸ºæ¡†æ¶ã€‚ä¸è¿‡ï¼Œæ‰€æœ‰ iOS å¹³å°çš„ç³»ç»Ÿæ¡†æ¶ä»ç„¶ä½¿ç”¨åŠ¨æ€åº“ã€‚</p>
<ul>
<li><p><strong>Cocoa</strong>ï¼šåœ¨ä¸º Mac OS X æˆ– iOS ç³»ç»Ÿå¼€å‘â€œå¸¦å›¾å½¢ç•Œé¢çš„åº”ç”¨ç¨‹åºâ€ï¼ˆgraphical application)æ—¶ï¼Œä¼šç”¨åˆ°åä¸º<strong>Cocoa</strong> çš„æ¡†æ¶ï¼Œåœ¨iOSä¸Šç§°ä¸º <strong>Cocoa Touch</strong>ã€‚</p>
</li>
<li><p><strong>Foundation</strong>ï¼šå®ƒæ˜¯æ‰€æœ‰ Objectice-C åº”ç”¨ç¨‹åºçš„åŸºç¡€ã€‚<strong>Foundation</strong> æ¡†æ¶ä¸­çš„ç±»ä½¿ç”¨ <strong>NS</strong> å‰ç¼€ã€‚</p>
</li>
<li><p><strong>CoreFoundation</strong>ï¼šä»æŠ€æœ¯ä¸Šè®²ï¼Œ<strong>CoreFoundation</strong> æ¡†æ¶ä¸æ˜¯ Objective-C æ¡†æ¶ï¼Œä½†å®ƒå´æ˜¯ç¼–å†™ Objectice-C åº”ç”¨ç¨‹åºæ—¶æ‰€åº”ç†Ÿæ‚‰çš„é‡è¦æ¡†æ¶ï¼Œ <strong>Foundation</strong> æ¡†æ¶ä¸­çš„è®¸å¤šåŠŸèƒ½ï¼Œéƒ½å¯ä»¥åœ¨æ­¤æ¡†æ¶ä¸­æ‰¾åˆ°å¯¹åº”çš„ C è¯­è¨€ APIã€‚</p>
<blockquote>
<p><strong>æ— ç¼æ¡¥æ¥</strong>ï¼ˆtoll- free bridging )åŠŸèƒ½:</p>
<p>æŠŠ <strong>CoreFoundation</strong> ä¸­çš„ C è¯­è¨€æ•°æ®ç»“æ„å¹³æ»‘è½¬æ¢ä¸º <strong>Foundation</strong> ä¸­çš„ Objective-C å¯¹è±¡ï¼Œä¹Ÿå¯ä»¥åå‘è½¬æ¢ã€‚</p>
<p>æ— ç¼æ¡¥æ¥æŠ€æœ¯æ‰€å®ç°çš„ä»£ç å¯ä»¥ä½¿è¿è¡ŒæœŸç³»ç»ŸæŠŠ <strong>CoreFoundation</strong> æ¡†æ¶ä¸­çš„å¯¹è±¡è§†ä¸ºæ™®é€šçš„ Objective-C å¯¹è±¡ã€‚</p>
<p>ä¾‹å¦‚ï¼šNSString  &lt;â€”&gt; CFString</p>
</blockquote>
</li>
<li><p><strong>CFNetwork</strong>ï¼šæ­¤æ¡†æ¶æä¾›äº† C è¯­è¨€çº§åˆ«çš„ç½‘ç»œé€šä¿¡èƒ½åŠ›ï¼Œå®ƒå°† <strong>BSDå¥—æ¥å­—</strong>ï¼ˆBSD socketï¼‰æŠ½è±¡æˆæ˜“äºä½¿ç”¨çš„ç½‘ç»œæ¥å£ã€‚è€Œ <strong>Foundation</strong> åˆ™å°†è¯¥æ¡†æ¶é‡Œçš„éƒ¨åˆ†å†…å®¹å°è£…ä¸º Objective-C è¯­è¨€çš„æ¥å£ï¼Œä»¥ä¾¿è¿›è¡Œç½‘ç»œé€šä¿¡ï¼Œä¾‹å¦‚å¯ä»¥ç”¨ <strong>NSURLConnection</strong> ä» URL ä¸­ä¸‹è½½æ•°æ®ã€‚</p>
</li>
<li><p><strong>CoreAudio</strong>ï¼šè¯¥æ¡†æ¶æ‰€æä¾›çš„ C è¯­è¨€ API å¯ç”¨æ¥æ“ä½œè®¾å¤‡ä¸Šçš„éŸ³é¢‘ç¡¬ä»¶ã€‚è¿™ä¸ªæ¡†æ¶å±äºæ¯”è¾ƒéš¾ç”¨çš„é‚£ç§ï¼Œå› ä¸ºéŸ³é¢‘å¤„ç†æœ¬èº«å°±å¾ˆå¤æ‚ã€‚æ‰€å¹¸ç”±è¿™å¥— API å¯ä»¥æŠ½è±¡å‡ºå¦å¤–ä¸€ å¥— Objective-C å¼ APIï¼Œç”¨åè€…æ¥å¤„ç†éŸ³é¢‘é—®é¢˜ä¼šæ›´ç®€å•äº›ã€‚</p>
</li>
<li><p><strong>AVFoundation</strong>ï¼šæ­¤æ¡†æ¶æ‰€æä¾›çš„ Objective-C å¯¹è±¡å¯ç”¨æ¥å›æ”¾å¹¶å½•åˆ¶éŸ³é¢‘åŠè§†é¢‘ï¼Œæ¯”å¦‚èƒ½å¤Ÿåœ¨ UIè§†å›¾ç±»é‡Œæ’­æ”¾è§†é¢‘ã€‚</p>
</li>
<li><p><strong>CoreData</strong>ï¼šæ­¤æ¡†æ¶æ‰€æä¾›çš„ Objective-C æ¥å£å¯å°†å¯¹è±¡æ”¾äººæ•°æ®åº“ï¼Œä¾¿äºæŒä¹…ä¿å­˜ã€‚ <strong>CoreData</strong> ä¼šå¤„ç†æ•°æ®çš„è·å–åŠå­˜å‚¨äº‹å®œï¼Œè€Œä¸”å¯ä»¥è·¨è¶Š Mac OS X åŠ iOS å¹³å°ã€‚</p>
</li>
<li><p><strong>CoreText</strong>ï¼šæ­¤æ¡†æ¶æä¾›çš„ C è¯­è¨€æ¥å£å¯ä»¥é«˜æ•ˆæ‰§è¡Œæ–‡å­—æ’ç‰ˆåŠæ¸²æŸ“æ“ä½œã€‚</p>
</li>
</ul>
<p>Objective-C ç¼–ç¨‹çš„é‡è¦ç‰¹æ€§ï¼šç»å¸¸éœ€è¦ä½¿ç”¨åº•å±‚çš„ C è¯­è¨€çº§ APIã€‚ç”¨ C è¯­è¨€æ¥å®ç° API çš„å¥½å¤„æ˜¯ï¼Œå¯ä»¥ç»•è¿‡ Objective-C çš„è¿è¡ŒæœŸç³»ç»Ÿï¼Œä»è€Œæå‡æ‰§è¡Œé€Ÿåº¦ã€‚</p>
<p>è¯»è€…å¯èƒ½ä¼šç¼–å†™ä½¿ç”¨ UI æ¡†æ¶çš„ Mac OS X æˆ– iOS åº”ç”¨ç¨‹åºã€‚è¿™ä¸¤ä¸ªå¹³å°çš„æ ¸å¿ƒ UI æ¡†æ¶åˆ†åˆ«å«åš <strong>AppKit</strong> åŠ <strong>UIKit</strong> ,å®ƒä»¬éƒ½æä¾›äº†æ„å»ºåœ¨ <strong>Foundation</strong> ä¸ <strong>CoreFoundation</strong> ä¹‹ä¸Šçš„ Objective-C ç±»ã€‚æ¡†æ¶é‡Œå«æœ‰ UI å…ƒç´ ï¼Œä¹Ÿå«æœ‰ç²˜åˆæœºåˆ¶ï¼Œä»¤å¼€å‘è€…å¯å°†æ‰€æœ‰ç›¸å…³å†…å®¹ç»„è£…ä¸ºåº”ç”¨ç¨‹åºã€‚åœ¨è¿™äº›ä¸»è¦çš„ UI æ¡†æ¶ä¹‹ä¸‹ï¼Œæ˜¯ <strong>CoreAnimation</strong> ä¸ <strong>CoreGraphics</strong> æ¡†æ¶ã€‚</p>
<ul>
<li><strong>CoreAnimation</strong> æ˜¯ç”¨ Objective-C è¯­è¨€å†™æˆçš„ï¼Œå®ƒæä¾›äº†ä¸€äº›å·¥å…·ï¼Œè€Œ UI æ¡†æ¶åˆ™ç”¨è¿™äº›å·¥å…·æ¥æ¸²æŸ“å›¾å½¢å¹¶æ’­æ”¾åŠ¨ç”»ã€‚å¼€å‘è€…ç¼–ç¨‹æ—¶å¯èƒ½ä»æ¥ä¸ä¼šæ·±å…¥åˆ°è¿™ç§çº§åˆ«ï¼Œä¸è¿‡çŸ¥é“è¯¥æ¡†æ¶æ€»æ˜¯å¥½çš„ã€‚<strong>CoreAnimation</strong> æœ¬èº«å¹¶ä¸æ˜¯æ¡†æ¶ï¼Œå®ƒæ˜¯ <strong>QuartzCore</strong> æ¡†æ¶çš„ä¸€éƒ¨åˆ†ã€‚ç„¶è€Œåœ¨æ¡†æ¶çš„å›½åº¦é‡Œï¼Œ<strong>CoreAnimation</strong> ä»åº”ç®—ä½œâ€œä¸€ç­‰å…¬æ°‘â€ï¼ˆfirst-class citizen)ã€‚</li>
<li><strong>CoreGraphics</strong> æ¡†æ¶ä»¥ C è¯­è¨€å†™æˆï¼Œå…¶ä¸­æä¾›äº† 2D æ¸²æŸ“æ‰€å¿…å¤‡çš„æ•°æ®ç»“æ„ä¸å‡½æ•°ã€‚ä¾‹å¦‚, å…¶ä¸­å®šä¹‰äº† CGPointã€CGSizeã€CGRect ç­‰æ•°æ®ç»“æ„ï¼Œè€Œ <strong>UllKit</strong> æ¡†æ¶ä¸­çš„ <strong>UlView</strong> ç±»åœ¨ç¡®å®šè§†å›¾æ§ä»¶ä¹‹é—´çš„ç›¸å¯¹ä½ç½®æ—¶ï¼Œè¿™äº›æ•°æ®ç»“æ„éƒ½è¦ç”¨åˆ°ã€‚</li>
</ul>
<p>è¿˜æœ‰å¾ˆå¤šæ¡†æ¶æ„å»ºåœ¨ UI æ¡†æ¶ä¹‹ä¸Šï¼Œæ¯”æ–¹è¯´ <strong>MapKit</strong> æ¡†æ¶ï¼Œå®ƒå¯ä»¥ä¸º iOS ç¨‹åºæä¾›åœ°å›¾åŠŸèƒ½ã€‚åˆæ¯”å¦‚ <strong>Social</strong> æ¡†æ¶ï¼Œå®ƒä¸º Mac OS X åŠ iOS ç¨‹åºæä¾›äº†ç¤¾äº¤ç½‘ç»œï¼ˆsocial networking) åŠŸèƒ½ã€‚å¼€å‘è€…é€šå¸¸ä¼šå°†è¿™äº›æ¡†æ¶ä¸æ“ä½œç³»ç»Ÿå¹³å°æ‰€å¯¹åº”çš„æ ¸å¿ƒ UI æ¡†æ¶ç»“åˆèµ·æ¥ä½¿ç”¨ã€‚</p>
<p>æ€»çš„æ¥è¯´ï¼Œè®¸å¤šæ¡†æ¶éƒ½æ˜¯å®‰è£… Mac OS X ä¸ iOS ç³»ç»Ÿæ—¶çš„æ ‡å‡†é…ç½®ã€‚æ‰€ä»¥ï¼Œåœ¨æ‰“ç®—ç¼–å†™æ–°çš„å·¥å…·ç±»ä¹‹å‰ï¼Œæœ€å¥½åœ¨ç³»ç»Ÿæ¡†æ¶é‡Œæœä¸€ä¸‹ï¼Œé€šå¸¸éƒ½æœ‰å†™å¥½çš„ç±»å¯ä¾›ç›´æ¥ä½¿ç”¨ã€‚</p>
<h4 id="è¦ç‚¹"><a href="#è¦ç‚¹" class="headerlink" title="è¦ç‚¹"></a>è¦ç‚¹</h4><ul>
<li>è®¸å¤šç³»ç»Ÿæ¡†æ¶éƒ½å¯ä»¥ç›´æ¥ä½¿ç”¨ã€‚å…¶ä¸­æœ€é‡è¦çš„æ˜¯ <strong>Foundation</strong> ä¸ <strong>CoreFoundation</strong>ï¼Œè¿™ä¸¤ä¸ªæ¡†æ¶æä¾›äº†æ„å»ºåº”ç”¨ç¨‹åºæ‰€éœ€çš„è®¸å¤šæ ¸å¿ƒåŠŸèƒ½ã€‚</li>
<li>å¾ˆå¤šå¸¸è§ä»»åŠ¡éƒ½èƒ½ç”¨æ¡†æ¶æ¥åšï¼Œä¾‹å¦‚éŸ³é¢‘ä¸è§†é¢‘å¤„ç†ã€ç½‘ç»œé€šä¿¡ã€æ•°æ®ç®¡ç†ç­‰ã€‚</li>
</ul>
<ul>
<li>è¯·è®°ä½ï¼Œ<strong>ç”¨çº¯ C å†™æˆçš„æ¡†æ¶ä¸ç”¨ Objective-C å†™æˆçš„ä¸€æ ·é‡è¦ï¼Œè‹¥æƒ³æˆä¸ºä¼˜ç§€çš„ Objective-C å¼€å‘è€…ï¼Œåº”è¯¥æŒæ¡ C è¯­è¨€çš„æ ¸å¿ƒæ¦‚å¿µ</strong>ã€‚</li>
</ul>
<h3 id="ç¬¬48æ¡ï¼šå¤šç”¨å—æšä¸¾ï¼Œå°‘ç”¨-for-å¾ªç¯"><a href="#ç¬¬48æ¡ï¼šå¤šç”¨å—æšä¸¾ï¼Œå°‘ç”¨-for-å¾ªç¯" class="headerlink" title="ç¬¬48æ¡ï¼šå¤šç”¨å—æšä¸¾ï¼Œå°‘ç”¨ for å¾ªç¯"></a>ç¬¬48æ¡ï¼šå¤šç”¨å—æšä¸¾ï¼Œå°‘ç”¨ for å¾ªç¯</h3><p>å®ç°æšä¸¾çš„æ–¹æ³•ï¼š</p>
<ol>
<li>æ ‡å‡†çš„ C è¯­è¨€å¾ªç¯ï¼›</li>
<li>Objective-C 1.0 çš„ <strong>NSEnumerator</strong> æ–¹æ³•ï¼›</li>
<li>Objective-C 2.0 çš„å¿«é€Ÿéå†æ³•ï¼ˆfast enumeration)ã€‚</li>
<li>åŸºäºå—çš„éå†æ–¹å¼ã€‚</li>
</ol>
<h4 id="for-å¾ªç¯"><a href="#for-å¾ªç¯" class="headerlink" title="for å¾ªç¯"></a>for å¾ªç¯</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">/** NSArray */</span><br><span class="line">NSArray *array;</span><br><span class="line">for (int i = 0; i &lt; array.count; i++) &#123;</span><br><span class="line">    id object = array[i];</span><br><span class="line">    // Do something with &apos;object&apos;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/** NSDictionary */</span><br><span class="line">NSDictionary *dictionary;</span><br><span class="line">NSArray *keys = [dictionary allKeys];</span><br><span class="line">for (int i = 0; i &lt; keys.count; i++) &#123;</span><br><span class="line">    id key = keys[i];</span><br><span class="line">    id value = dictionary[key];</span><br><span class="line">    // Do something with &apos;key&apos; and &apos;value&apos;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/** NSSet */</span><br><span class="line">NSSet *set;</span><br><span class="line">NSArray *objects = [set allObjects];</span><br><span class="line">for (int i = 0; i &lt; objects.count; i++) &#123;</span><br><span class="line">    id object = object[i];</span><br><span class="line">    // Do something with &apos;object&apos;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>æ ¹æ®å®šä¹‰ï¼Œå­—å…¸ä¸setéƒ½æ˜¯â€œæ— åºçš„â€ï¼ˆimoniered)ï¼Œæ‰€ä»¥æ— æ³•æ ¹æ®ç‰¹å®šçš„æ•´æ•°ä¸‹æ ‡æ¥ç›´æ¥è®¿é—®å…¶ä¸­çš„å€¼ã€‚äºæ˜¯ï¼Œå°±éœ€è¦å…ˆè·å–å­—å…¸é‡Œçš„æ‰€æœ‰é”®æˆ–æ˜¯seté‡Œçš„æ‰€æœ‰å¯¹è±¡ï¼Œè¿™ä¸¤ç§æƒ…å†µä¸‹ï¼Œéƒ½å¯ä»¥åœ¨è·å–åˆ°çš„æœ‰åºæ•°ç»„ä¸Šéå†ï¼Œä»¥ä¾¿å€Ÿæ­¤è®¿é—®åŸå­—å…¸åŠåŸsetä¸­çš„å€¼ã€‚åˆ›å»ºè¿™ä¸ªé™„åŠ æ•°ç»„ä¼šæœ‰é¢å¤–å¼€é”€ï¼Œè€Œä¸”è¿˜ä¼šå¤šåˆ›å»ºä¸€ä¸ªæ•°ç»„å¯¹è±¡ï¼Œå®ƒä¼šä¿ç•™collectionä¸­çš„æ‰€æœ‰å…ƒç´ å¯¹è±¡ã€‚</p>
</blockquote>
<h4 id="ä½¿ç”¨-Objective-C-1-0-çš„-NSEnumerator-éå†"><a href="#ä½¿ç”¨-Objective-C-1-0-çš„-NSEnumerator-éå†" class="headerlink" title="ä½¿ç”¨ Objective-C 1.0 çš„ NSEnumerator éå†"></a>ä½¿ç”¨ Objective-C 1.0 çš„ NSEnumerator éå†</h4><p><strong>NSEnumerator.h</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">typedef struct &#123;</span><br><span class="line">    unsigned long state;</span><br><span class="line">    id __unsafe_unretained _Nullable * _Nullable itemsPtr;</span><br><span class="line">    unsigned long * _Nullable mutationsPtr;</span><br><span class="line">    unsigned long extra[5];</span><br><span class="line">&#125; NSFastEnumerationState;</span><br><span class="line"></span><br><span class="line">@protocol NSFastEnumeration</span><br><span class="line"></span><br><span class="line">- (NSUInteger)countByEnumeratingWithState:(NSFastEnumerationState *)state objects:(id __unsafe_unretained _Nullable [_Nonnull])buffer count:(NSUInteger)len;</span><br><span class="line"></span><br><span class="line">@end</span><br><span class="line"></span><br><span class="line">@interface NSEnumerator&lt;ObjectType&gt; : NSObject &lt;NSFastEnumeration&gt;</span><br><span class="line"></span><br><span class="line">//â‡ï¸ è¿”å›æšä¸¾é‡Œçš„ä¸‹ä¸ªå¯¹è±¡ã€‚æ¯æ¬¡è°ƒç”¨è¯¥æ–¹æ³•æ—¶ï¼Œå…¶å†…éƒ¨æ•°æ®ç»“æ„éƒ½ä¼šæ›´æ–°ï¼Œä½¿å¾—ä¸‹æ¬¡è°ƒç”¨æ–¹æ³•æ—¶èƒ½è¿”å›ä¸‹ä¸ªå¯¹è±¡ã€‚ç­‰åˆ°æšä¸¾ä¸­çš„å…¨éƒ¨å¯¹è±¡éƒ½å·²è¿”å›ä¹‹åï¼Œå†è°ƒç”¨å°±å°†è¿”å›nilï¼Œè¿™è¡¨ç¤ºè¾¾åˆ°æšä¸¾æœ«ç«¯äº†ã€‚</span><br><span class="line">- (nullable ObjectType)nextObject;</span><br><span class="line"></span><br><span class="line">@end</span><br><span class="line"></span><br><span class="line">@interface NSEnumerator&lt;ObjectType&gt; (NSExtendedEnumerator)</span><br><span class="line"></span><br><span class="line">@property (readonly, copy) NSArray&lt;ObjectType&gt; *allObjects;</span><br><span class="line"></span><br><span class="line">@end</span><br></pre></td></tr></table></figure>
<p>ä½¿ç”¨ç¤ºä¾‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">/** NSArray */</span><br><span class="line">NSArray *array;</span><br><span class="line">NSEnumerator *enumerator = [array objectEnumerator];</span><br><span class="line">id object;</span><br><span class="line">while ((object = [enumerator nextObject]) != nil) &#123;</span><br><span class="line">    // Do something with &apos;object&apos;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/** NSDictionary */</span><br><span class="line">NSDictionary *dictionary;</span><br><span class="line">NSEnumerator *enumerator = [dictionary keyEnumerator];</span><br><span class="line">id key;</span><br><span class="line">while ((key = [enumerator nextObject]) != nil) &#123;</span><br><span class="line">    id value = dictionary[key];</span><br><span class="line">    // Do something with &apos;key&apos; and &apos;value&apos;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/** NSSet */</span><br><span class="line">NSSet *set;</span><br><span class="line">NSEnumerator *enumerator = [set objectEnumerator];</span><br><span class="line">id object;</span><br><span class="line">while ((object = [enumerator nextObject]) != nil) &#123;</span><br><span class="line">    // Do something with &apos;object&apos;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><p>ä¼˜ç‚¹ï¼šä¸è®ºéå†å“ªç§ collectionï¼Œéƒ½å¯ä»¥é‡‡ç”¨è¿™å¥—ç›¸ä¼¼çš„è¯­æ³•ã€‚</p>
</li>
<li><p><strong>NSEnumerator</strong> è¿˜æœ‰å¤šç§â€œæšä¸¾å™¨â€ï¼ˆenumerator) å¯ä¾›ä½¿ç”¨ï¼Œå¦‚åå‘éå†æ•°ç»„ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">/** NSArray */</span><br><span class="line">NSArray *array;</span><br><span class="line">// reverseObjectEnumeratorï¼šåå‘éå†æ•°ç»„</span><br><span class="line">NSEnumerator *enumerator = [array reverseObjectEnumerator];</span><br><span class="line">id object;</span><br><span class="line">while ((object = [enumerator nextObject]) != nil) &#123;</span><br><span class="line">    // Do something with &apos;object&apos;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="å¿«é€Ÿéå†"><a href="#å¿«é€Ÿéå†" class="headerlink" title="å¿«é€Ÿéå†"></a>å¿«é€Ÿéå†</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">/** NSArray */</span><br><span class="line">NSArray *array;</span><br><span class="line">for (id object in array) &#123;</span><br><span class="line">    // Do something with &apos;object&apos;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/** NSDictionary */</span><br><span class="line">NSDictionary *dictionary;</span><br><span class="line">for (id key in dictionary) &#123;</span><br><span class="line">    id value = dictionary[key];</span><br><span class="line">    // Do something with &apos;key&apos; and &apos;value&apos;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/** NSSet */</span><br><span class="line">NSSet *set;</span><br><span class="line">for (id object in set) &#123;</span><br><span class="line">    // Do something with &apos;object&apos;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å¦‚æœæŸä¸ªç±»çš„å¯¹è±¡æ”¯æŒå¿«é€Ÿéå†ï¼Œé‚£ä¹ˆå°±å¯ä»¥å®£ç§°è‡ªå·±éµä»åä¸º <strong>NSFastEmimeraticm</strong> çš„åè®®ï¼Œä»è€Œä»¤å¼€å‘è€…å¯ä»¥é‡‡ç”¨æ­¤è¯­æ³•æ¥è¿­ä»£è¯¥å¯¹è±¡ã€‚</p>
<p><strong>è¯¥æ–¹æ³•å…è®¸ç±»å®ä¾‹åŒæ—¶è¿”å›å¤šä¸ªå¯¹è±¡ï¼Œä½¿å¾—å¾ªç¯éå†æ“ä½œæ›´ä¸ºé«™æ•ˆã€‚</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">@protocol NSFastEnumeration</span><br><span class="line"></span><br><span class="line">- (NSUInteger)countByEnumeratingWithState:(NSFastEnumerationState *)state</span><br><span class="line">                                  objects:(id __unsafe_unretained _Nullable [_Nonnull])buffer</span><br><span class="line">                                    count:(NSUInteger)len;</span><br><span class="line"></span><br><span class="line">@end</span><br></pre></td></tr></table></figure>
<h4 id="åŸºäºå—çš„éå†æ–¹å¼"><a href="#åŸºäºå—çš„éå†æ–¹å¼" class="headerlink" title="åŸºäºå—çš„éå†æ–¹å¼"></a>åŸºäºå—çš„éå†æ–¹å¼</h4><p><strong>æ–¹æ³•åˆ—è¡¨</strong>:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">/** NSArray */</span><br><span class="line">- (void)enumerateObjectsUsingBlock:(void (NS_NOESCAPE ^)(ObjectType obj, NSUInteger idx, BOOL *stop))block;</span><br><span class="line">- (void)enumerateObjectsWithOptions:(NSEnumerationOptions)opts usingBlock:(void (NS_NOESCAPE ^)(ObjectType obj, NSUInteger idx, BOOL *stop))block;</span><br><span class="line">- (void)enumerateObjectsAtIndexes:(NSIndexSet *)s options:(NSEnumerationOptions)opts usingBlock:(void (NS_NOESCAPE ^)(ObjectType obj, NSUInteger idx, BOOL *stop))block;</span><br><span class="line"></span><br><span class="line">/** NSDictionary */</span><br><span class="line">- (void)enumerateKeysAndObjectsUsingBlock:(void (NS_NOESCAPE ^)(KeyType key, ObjectType obj, BOOL *stop))block;</span><br><span class="line">- (void)enumerateKeysAndObjectsWithOptions:(NSEnumerationOptions)opts usingBlock:(void (NS_NOESCAPE ^)(KeyType key, ObjectType obj, BOOL *stop))block;</span><br><span class="line"></span><br><span class="line">/** NSSet */</span><br><span class="line">- (void)enumerateObjectsUsingBlock:(void (NS_NOESCAPE ^)(ObjectType obj, BOOL *stop))block;</span><br><span class="line">- (void)enumerateObjectsWithOptions:(NSEnumerationOptions)opts usingBlock:(void (NS_NOESCAPE ^)(ObjectType obj, BOOL *stop))block;</span><br></pre></td></tr></table></figure>
<p>ç¤ºä¾‹ä»£ç ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">/** NSArray */</span><br><span class="line">NSArray *array;</span><br><span class="line">[array enumerateObjectsUsingBlock:^(id  _Nonnull obj, NSUInteger idx, BOOL * _Nonnull stop) &#123;</span><br><span class="line">    // Do something with &apos;object&apos;</span><br><span class="line">    if (shouldStop) &#123;</span><br><span class="line">        *stop = YES;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;];</span><br><span class="line"></span><br><span class="line">/** NSDictionary */</span><br><span class="line">NSDictionary *dictionary;</span><br><span class="line">[dictionary enumerateKeysAndObjectsUsingBlock:^(id  _Nonnull key, id  _Nonnull obj, BOOL * _Nonnull stop) &#123;</span><br><span class="line">    // Do something with &apos;key&apos; and &apos;value&apos;</span><br><span class="line">    if (shouldStop) &#123;</span><br><span class="line">        *stop = YES;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;];</span><br><span class="line"></span><br><span class="line">/** NSSet */</span><br><span class="line">NSSet *set;</span><br><span class="line">[set enumerateObjectsUsingBlock:^(id  _Nonnull obj, BOOL * _Nonnull stop) &#123;</span><br><span class="line">    // Do something with &apos;object&apos;</span><br><span class="line">    if (shouldStop) &#123;</span><br><span class="line">        *stop = YES;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;];</span><br></pre></td></tr></table></figure>
<p>æ­¤æ–¹å¼çš„ä¼˜ç‚¹ï¼š</p>
<ol>
<li><p>éå†æ—¶å¯ä»¥ç›´æ¥ä»å—é‡Œè·å–æ›´å¤šä¿¡æ¯ã€‚</p>
</li>
<li><p>èƒ½å¤Ÿä¿®æ”¹å—çš„æ–¹æ³•ç­¾åï¼Œä»¥å…è¿›è¡Œç±»å‹è½¬æ¢æ“ä½œï¼Œä»æ•ˆæœä¸Šè®²ï¼Œç›¸å½“äºæŠŠæœ¬æ¥éœ€è¦æ‰§è¡Œçš„ç±»å‹è½¬æ¢æ“ä½œäº¤ç»™å—æ–¹æ³•ç­¾åæ¥åšã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">// for-in éå†ï¼š</span><br><span class="line">NSDictionary *dictionary;</span><br><span class="line">for (NSString *key in dictionary) &#123;</span><br><span class="line">    NSString *object = (NSString *)dictionary[key];</span><br><span class="line">    // Do something with &apos;key&apos; and &apos;value&apos;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// åŸºäºå—çš„éå†ï¼Œå¯ä»¥åœ¨å—æ–¹æ³•ç­¾åä¸­ç›´æ¥è½¬æ¢æ•°æ®ç±»å‹ï¼š</span><br><span class="line">[dictionary enumerateKeysAndObjectsUsingBlock:^(NSString *key, NSString *obj, BOOL *stop) &#123;</span><br><span class="line">    // Do something with &apos;key&apos; and &apos;value&apos;</span><br><span class="line">&#125;];</span><br></pre></td></tr></table></figure>
</li>
<li><p>åå‘éå†ï¼šè®¾ç½® <strong>NSEnumerationOptions</strong> é€‰é¡¹ä¸º <code>NSEnumerationReverse</code>ã€‚</p>
</li>
<li><p>å¹¶è¡Œæ‰§è¡Œï¼šè®¾ç½® <strong>NSEnumerationOptions</strong> é€‰é¡¹ä¸º <code>NSEnumerationConcurrent</code>ã€‚</p>
</li>
</ol>
<h4 id="è¦ç‚¹-1"><a href="#è¦ç‚¹-1" class="headerlink" title="è¦ç‚¹"></a>è¦ç‚¹</h4><ul>
<li>éå† collection æœ‰4ç§æ–¹å¼ã€‚æœ€åŸºæœ¬çš„åŠæ³•æ˜¯ <strong>for å¾ªç¯</strong>ï¼Œå…¶æ¬¡æ˜¯ <strong>NSEnumerator</strong> éå†æ–¹æ³•åŠ<strong>å¿«é€Ÿéå†æ³•</strong>ï¼Œæœ€æ–°ã€æœ€å…ˆè¿›çš„æ–¹å¼åˆ™æ˜¯ <strong>å—æšä¸¾æ³•</strong>ã€‚</li>
<li><strong>å—æšä¸¾æ³•</strong> æœ¬èº«å°±èƒ½é€šè¿‡ GCD æ¥å¹¶å‘æ‰§è¡Œéå†æ“ä½œï¼Œæ— éœ€å¦è¡Œç¼–å†™ä»£ç ã€‚è€Œé‡‡ç”¨å…¶ä»–éå†æ–¹å¼åˆ™æ— æ³•è½»æ˜“å®ç°è¿™ä¸€ç‚¹ã€‚</li>
<li>è‹¥æå‰çŸ¥é“å¾…éå†çš„ collection å«æœ‰ä½•ç§å¯¹è±¡ï¼Œåˆ™åº”ä¿®æ”¹å—ç­¾åï¼ŒæŒ‡å‡ºå¯¹è±¡çš„å…·ä½“ç±»å‹ã€‚</li>
</ul>
<h3 id="ç¬¬49æ¡ï¼šå¯¹è‡ªå®šä¹‰å…¶å†…å­˜ç®¡ç†è¯­ä¹‰çš„-collection-ä½¿ç”¨æ— ç¼æ¡¥æ¥"><a href="#ç¬¬49æ¡ï¼šå¯¹è‡ªå®šä¹‰å…¶å†…å­˜ç®¡ç†è¯­ä¹‰çš„-collection-ä½¿ç”¨æ— ç¼æ¡¥æ¥" class="headerlink" title="ç¬¬49æ¡ï¼šå¯¹è‡ªå®šä¹‰å…¶å†…å­˜ç®¡ç†è¯­ä¹‰çš„ collection ä½¿ç”¨æ— ç¼æ¡¥æ¥"></a>ç¬¬49æ¡ï¼šå¯¹è‡ªå®šä¹‰å…¶å†…å­˜ç®¡ç†è¯­ä¹‰çš„ collection ä½¿ç”¨æ— ç¼æ¡¥æ¥</h3><p><strong>æ— ç¼æ¡¥æ¥</strong>ï¼šå¯ä»¥åœ¨å®šä¹‰äº <strong>Foundation</strong> æ¡†æ¶ä¸­çš„ Objective-C ç±»å’Œå®šä¹‰äº <strong>CoreFoundation</strong> æ¡†æ¶ä¸­çš„ C æ•°æ®ç»“æ„ä¹‹é—´äº’ç›¸è½¬æ¢ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">// NSArray â†’ CFArray</span><br><span class="line">NSArray *anNSArray = @[@1, @2, @3, @4, @5];</span><br><span class="line">// CFArray éœ€è¦é€šè¿‡ CFArrayRef æ¥å¼•ç”¨ï¼Œ</span><br><span class="line">// CFArrayRef æ˜¯æŒ‡å‘ struct__CFArray çš„æŒ‡é’ˆ</span><br><span class="line">CFArrayRef aCFArray = (__bridge CFArrayRef)anNSArray;</span><br><span class="line">NSLog(@&quot;Size of array = %li&quot;, CFArrayGetCount(aCFArray));</span><br></pre></td></tr></table></figure>
<h4 id="æ¡¥å¼è½¬æ¢"><a href="#æ¡¥å¼è½¬æ¢" class="headerlink" title="æ¡¥å¼è½¬æ¢"></a>æ¡¥å¼è½¬æ¢</h4><ul>
<li><code>__bridge</code> å‘Šè¯‰ARC (å‚è§ç¬¬30æ¡ï¼‰å¦‚ä½•å¤„ç†è½¬æ¢æ‰€æ¶‰åŠçš„ Objective-C å¯¹è±¡ã€‚</li>
<li><code>__bridge</code> æœ¬èº«çš„æ„æ€æ˜¯ï¼šARC ä»ç„¶å…·å¤‡è¿™ä¸ª Objective-C å¯¹è±¡çš„æ‰€æœ‰æƒã€‚è€Œ <code>__bridge_ retained</code> åˆ™ä¸ä¹‹ç›¸åï¼Œæ„å‘³ç€ ARC å°†äº¤å‡ºå¯¹è±¡çš„æ‰€æœ‰æƒã€‚</li>
<li>åå‘è½¬æ¢å¯é€šè¿‡ <code>__bridge_transfer</code> æ¥å®ç°ã€‚</li>
</ul>
<h4 id="éœ€è¦ä½¿ç”¨æ— ç¼æ¡¥æ¥çš„åŸå› ï¼š"><a href="#éœ€è¦ä½¿ç”¨æ— ç¼æ¡¥æ¥çš„åŸå› ï¼š" class="headerlink" title="éœ€è¦ä½¿ç”¨æ— ç¼æ¡¥æ¥çš„åŸå› ï¼š"></a>éœ€è¦ä½¿ç”¨æ— ç¼æ¡¥æ¥çš„åŸå› ï¼š</h4><ul>
<li><strong>Foundation</strong> æ¡†æ¶ä¸­çš„ Objective-C ç±»æ‰€å…·å¤‡çš„æŸäº›åŠŸèƒ½ï¼Œæ˜¯ <strong>CoreFoundation</strong> æ¡†æ¶ä¸­çš„ C è¯­è¨€æ•°æ®ç»“æ„æ‰€ä¸å…·å¤‡çš„ã€‚</li>
<li><p>åœ¨ä½¿ç”¨ <strong>Foundation</strong> æ¡†æ¶ä¸­çš„å­—å…¸å¯¹è±¡æ—¶ä¼šé‡åˆ°ä¸€ä¸ªå¤§é—®é¢˜ï¼Œé‚£å°±æ˜¯å…¶é”®çš„å†…å­˜ç®¡ç†è¯­ä¹‰ä¸ºâ€œæ‹·è´â€ï¼Œè€Œå€¼çš„è¯­ä¹‰å´æ˜¯â€œä¿ç•™â€ã€‚é™¤éä½¿ç”¨å¼ºå¤§çš„æ— ç¼æ¡¥æ¥æŠ€æœ¯ï¼Œå¦åˆ™æ— æ³•æ”¹å˜å…¶è¯­ä¹‰ã€‚</p>
<p>åˆ›å»º <strong>CFMutableDictionary</strong> æ—¶ï¼Œå¯ä»¥é€šè¿‡ä¸‹åˆ—æ–¹æ³•æ¥æŒ‡å®šé”®å’Œå€¼çš„å†…å­˜ç®¡ç†è¯­ä¹‰:</p>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">CFMutableDictionaryRef CFDictionaryCreateMutable(</span><br><span class="line">    CFAllocatorRef allocator,</span><br><span class="line">    CFIndex capacity,</span><br><span class="line">    const CFDictionaryKeyCallBacks *keyCallBacks,</span><br><span class="line">    const CFDictionaryValueCallBacks *valueCallBacks</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<ul>
<li><p><code>CFAllocatorRef</code>ï¼šå°†è¦ä½¿ç”¨çš„å†…å­˜åˆ†é…å™¨ï¼ˆallocator) ã€‚<strong>CoreFoundation</strong> å¯¹è±¡é‡Œçš„æ•°æ®ç»“æ„éœ€è¦å ç”¨å†…å­˜ï¼Œè€Œåˆ†é…å™¨è´Ÿè´£åˆ†é…åŠå›æ”¶è¿™äº›å†…å­˜ã€‚å¼€å‘è€…é€šå¸¸ä¸ºè¿™ä¸ªå‚æ•°ä¼ äºº <strong>NULL</strong>ï¼Œè¡¨ç¤ºé‡‡ç”¨é»˜è®¤çš„åˆ†é…å™¨ã€‚</p>
</li>
<li><p><code>CFIndex</code>ï¼šå®šä¹‰å­—å…¸çš„åˆå§‹å¤§å°ã€‚å®ƒå¹¶ä¸ä¼šé™åˆ¶å­—å…¸çš„æœ€å¤§å®¹æ™¯ï¼Œåªæ˜¯å‘åˆ†é…å™¨æç¤ºä¸€å¼€å§‹åº”è¯¥åˆ†é…å¤šå°‘å†…å­˜ã€‚å‡å¦‚è¦åˆ›å»ºçš„å­—å…¸å«æœ‰10ä¸ªå¯¹è±¡ï¼Œé‚£å°±å‘è¯¥å‚æ•°ä¼ å…¥10ã€‚</p>
</li>
<li><p>æœ€åä¸¤ä¸ªå‚æ•°å€¼å¾—æ³¨æ„ã€‚å®ƒä»¬å®šä¹‰äº†è®¸å¤šå›è°ƒå‡½æ•°ï¼Œç”¨äºæŒ‡ç¤ºå­—å…¸ä¸­çš„é”®å’Œå€¼åœ¨é‡åˆ°å„ç§äº‹ä»¶æ—¶åº”è¯¥æ‰§è¡Œä½•ç§æ“ä½œã€‚è¿™ä¸¤ä¸ªå‚æ•°éƒ½æ˜¯æŒ‡å‘ç»“æ„ä½“çš„æŒ‡é’ˆï¼ŒäºŒè€…æ‰€å¯¹åº”çš„ç»“æ„ä½“å¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">typedef struct &#123;</span><br><span class="line">    CFIndex				version;</span><br><span class="line">    CFDictionaryRetainCallBack		retain;</span><br><span class="line">    CFDictionaryReleaseCallBack		release;</span><br><span class="line">    CFDictionaryCopyDescriptionCallBack	copyDescription;</span><br><span class="line">    CFDictionaryEqualCallBack		equal;</span><br><span class="line">    CFDictionaryHashCallBack		hash;</span><br><span class="line">&#125; CFDictionaryKeyCallBacks;</span><br><span class="line"></span><br><span class="line">typedef struct &#123;</span><br><span class="line">    CFIndex				version;</span><br><span class="line">    CFDictionaryRetainCallBack		retain;</span><br><span class="line">    CFDictionaryReleaseCallBack		release;</span><br><span class="line">    CFDictionaryCopyDescriptionCallBack	copyDescription;</span><br><span class="line">    CFDictionaryEqualCallBack		equal;</span><br><span class="line">&#125; CFDictionaryValueCallBacks;</span><br><span class="line"></span><br><span class="line">/*</span><br><span class="line"> * versionå‚æ•°ç›®å‰åº”è®¾ä¸º0ã€‚å½“å‰ç¼–ç¨‹æ—¶æ€»æ˜¯å–è¿™ä¸ªå€¼ï¼Œä¸è¿‡å°†æ¥è‹¹æœå…¬å¸ä¹Ÿè®¸ä¼šä¿®æ”¹æ­¤ç»“æ„ä½“ï¼Œæ‰€ä»¥</span><br><span class="line"> * è¦é¢„ç•™è¯¥å€¼ä»¥è¡¨ç¤ºç‰ˆæœ¬å·ã€‚è¿™ä¸ªå‚æ•°å¯ä»¥ç”¨äºæ£€æµ‹æ–°ç‰ˆä¸æ—§ç‰ˆæ•°æ®ç»“æ„ä¹‹é—´æ˜¯å¦å…¼å®¹ã€‚</span><br><span class="line"> * ç»“æ„ä½“ä¸­çš„å…¶ä½™æˆå‘˜éƒ½æ˜¯å‡½æ•°æŒ‡é’ˆï¼Œå®ƒä»¬å®šä¹‰äº†å½“å„ç§äº‹ä»¶å‘ç”Ÿæ—¶åº”è¯¥é‡‡ç”¨å“ªä¸ªå‡½æ•°æ¥æ‰§è¡Œç›¸å…³ä»»åŠ¡ã€‚</span><br><span class="line"> */</span><br></pre></td></tr></table></figure>
<blockquote>
<p>åº•å±‚å®ç°æœ‰ç‚¹å¤æ‚ï¼Œæš‚ç¼“ç ”ç©¶ğŸ˜‚</p>
</blockquote>
</li>
</ul>
<h4 id="è¦ç‚¹-2"><a href="#è¦ç‚¹-2" class="headerlink" title="è¦ç‚¹"></a>è¦ç‚¹</h4><ul>
<li>é€šè¿‡æ— ç¼æ¡¥æ¥æŠ€æœ¯ï¼Œå¯ä»¥åœ¨ <strong>Foundation</strong> æ¡†æ¶ä¸­çš„ Objective-C å¯¹è±¡ä¸ <strong>CoreFoundation</strong> æ¡†æ¶ä¸­çš„ C è¯­è¨€æ•°æ®ç»“æ„ä¹‹å‰æ¥å›è½¬æ¢ã€‚</li>
<li>åœ¨ <strong>CoreFoundation</strong> å±‚é¢åˆ›å»º collection æ—¶ï¼Œå¯ä»¥æŒ‡å®šè®¸å¤šå›è°ƒå‡½æ•°ï¼Œè¿™äº›å‡½æ•°è¡¨ç¤ºæ­¤ collection åº”å¦‚ä½•å¤„ç†å…¶å…ƒç´ ã€‚ç„¶åï¼Œå¯è¿ç”¨æ— ç¼æ¡¥æ¥æŠ€æœ¯ï¼Œå°†å…¶è½¬æ¢æˆå…·å¤‡ç‰¹æ®Šå†…å­˜ç®¡ç†è¯­ä¹‰çš„ Objective-C collectionã€‚</li>
</ul>
<h3 id="ç¬¬50æ¡ï¼šæ„å»ºç¼“å­˜æ—¶é€‰ç”¨-NSCache-è€Œé-NSDictionary"><a href="#ç¬¬50æ¡ï¼šæ„å»ºç¼“å­˜æ—¶é€‰ç”¨-NSCache-è€Œé-NSDictionary" class="headerlink" title="ç¬¬50æ¡ï¼šæ„å»ºç¼“å­˜æ—¶é€‰ç”¨ NSCache è€Œé NSDictionary"></a>ç¬¬50æ¡ï¼šæ„å»ºç¼“å­˜æ—¶é€‰ç”¨ NSCache è€Œé NSDictionary</h3><ul>
<li><strong>NSCache</strong> èƒœè¿‡ <strong>NSDictionary</strong> ä¹‹å¤„åœ¨äºï¼Œå½“ç³»ç»Ÿèµ„æºå°†è¦è€—å°½æ—¶ï¼Œå®ƒå¯ä»¥è‡ªåŠ¨åˆ å‡ç¼“å­˜ã€‚</li>
<li><strong>NSCache</strong> è¿˜ä¼šå…ˆè¡Œåˆ å‡ <strong>æœ€ä¹…æœªä½¿ç”¨çš„ï¼ˆlease recently used) å¯¹è±¡</strong>ã€‚</li>
<li><strong>NSCache</strong> å¹¶ä¸ä¼šâ€œæ‹·è´â€é”®ï¼Œè€Œæ˜¯ä¼šâ€œä¿ç•™â€å®ƒã€‚åŸå› åœ¨äºï¼Œå¾ˆå¤šæ—¶å€™ï¼Œé”®éƒ½æ˜¯ç”±ä¸æ”¯æŒæ‹·è´æ“ä½œçš„å¯¹è±¡æ¥å……å½“çš„ã€‚</li>
<li><strong>NSCache</strong> æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚åœ¨å¼€å‘è€…è‡ªå·±ä¸ç¼–å†™åŠ é”ä»£ç çš„å‰æä¸‹ï¼Œ å¤šä¸ªçº¿ç¨‹ä¾¿å¯ä»¥åŒæ—¶è®¿é—®<strong>NSCache</strong>ã€‚å¯¹ç¼“å­˜æ¥è¯´ï¼Œçº¿ç¨‹å®‰å…¨é€šå¸¸å¾ˆé‡è¦ï¼Œå› ä¸ºå¼€å‘è€…å¯èƒ½è¦åœ¨æŸä¸ªçº¿ç¨‹ä¸­è¯»å–æ•°æ®ï¼Œæ­¤æ—¶å¦‚æœå‘ç°ç¼“å­˜é‡Œæ‰¾ä¸åˆ°æŒ‡å®šçš„é”®ï¼Œé‚£ä¹ˆå°±è¦ä¸‹è½½è¯¥é”®æ‰€å¯¹åº”çš„æ•°æ®äº†ã€‚è€Œä¸‹è½½å®Œæ•°æ®ä¹‹åæ‰€è¦æ‰§è¡Œçš„å›è°ƒå‡½æ•°ï¼Œæœ‰å¯èƒ½ä¼šæ”¾åœ¨èƒŒæ™¯çº¿ç¨‹ä¸­è¿è¡Œï¼Œè¿™æ ·çš„è¯ï¼Œå°±ç­‰äºæ˜¯ç”¨å¦å¤–ä¸€ä¸ªçº¿ç¨‹æ¥å†™å…¥ç¼“å­˜äº†ã€‚</li>
<li>å¼€å‘è€…å¯ä»¥æ“æ§ç¼“å­˜åˆ å‡å…¶å†…å®¹çš„æ—¶æœºã€‚æœ‰ä¸¤ä¸ªä¸ç³»ç»Ÿèµ„æºç›¸å…³çš„å°ºåº¦å¯ä¾›è°ƒæ•´ï¼Œå…¶ä¸€æ˜¯ç¼“å­˜ä¸­çš„å¯¹è±¡æ€»æ•°ï¼Œå…¶äºŒæ˜¯æ‰€æœ‰å¯¹è±¡çš„â€œæ€»å¼€é”€â€ï¼ˆoverall cost)ã€‚</li>
</ul>
<p>ç¤ºä¾‹ä»£ç ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line">// EOCNetworkFetcher.h</span><br><span class="line">#import &lt;Foundation/Foundation.h&gt;</span><br><span class="line"></span><br><span class="line">// Network fetcher class</span><br><span class="line">typedef void(^EOCNetworkFetcherCompletionHandler)</span><br><span class="line">                                (NSData *data);</span><br><span class="line"></span><br><span class="line">@interface EOCNetworkFetcher : NSObject</span><br><span class="line">@property (nonatomic, strong, readonly) NSURL *url;</span><br><span class="line">- (instancetype)initWithURL:(NSURL *)url;</span><br><span class="line">- (void)startWithCompletionHandler:</span><br><span class="line">            (EOCNetworkFetcherCompletionHandler)completion;</span><br><span class="line">@end</span><br><span class="line"></span><br><span class="line">// EOCNetworkFetcher.m</span><br><span class="line">#import &quot;EOCNetworkFetcher.h&quot;</span><br><span class="line"></span><br><span class="line">@implementation EOCNetworkFetcher &#123;</span><br><span class="line">    NSCache *_cache;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (instancetype)init &#123;</span><br><span class="line">    if (self = [super init]) &#123;</span><br><span class="line">        _cache = [NSCache new];</span><br><span class="line">        </span><br><span class="line">        // Cache a maximu of 100 URLs</span><br><span class="line">        // å¯ç¼“å­˜çš„æ€»å¯¹è±¡æ•°ç›®ä¸Šé™</span><br><span class="line">        _cache.countLimit = 100;</span><br><span class="line">        </span><br><span class="line">        /**</span><br><span class="line">         * The size in bytes of data is used as the cost,</span><br><span class="line">         * å¼€é”€å€¼ ä»¥ å­—èŠ‚ ä¸ºå•ä½</span><br><span class="line">         * so this sets a cost limit of 5MB</span><br><span class="line">         * å› æ­¤éœ€è¦å°† MB æ¢ç®—ä¸º å­—èŠ‚</span><br><span class="line">         */</span><br><span class="line">        _cache.totalCostLimit = 5 * 1024 * 1024;</span><br><span class="line">    &#125;</span><br><span class="line">    return self;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (instancetype)initWithURL:(NSURL *)url &#123;</span><br><span class="line">    if (self = [super init]) &#123;</span><br><span class="line">        _url = url;</span><br><span class="line">    &#125;</span><br><span class="line">    return self;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (void)downloadDataForURL:(NSURL *)url &#123;</span><br><span class="line">    NSData *cacheData = [_cache objectForKey:url];</span><br><span class="line">    if (cacheData) &#123;</span><br><span class="line">        // Cache hit</span><br><span class="line">        [self useData:cacheData];</span><br><span class="line">    &#125;else &#123;</span><br><span class="line">        // Cache miss,ç¼“å­˜ä¸­æ²¡æœ‰è®¿é—®è€…æ‰€éœ€çš„æ•°æ®</span><br><span class="line">        EOCNetworkFetcher *fetcher = [[EOCNetworkFetcher alloc] initWithURL:url];</span><br><span class="line">        [fetcher startWithCompletionHandler:^(NSData *data) &#123;</span><br><span class="line">            [self useData:data];</span><br><span class="line">        &#125;];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><p><strong>NSPurgeableData</strong> ç±»ï¼Œ<strong>NSMutableData</strong> çš„å­ç±»ã€‚å¦‚æœæŸä¸ªå¯¹è±¡æ‰€å çš„å†…å­˜èƒ½å¤Ÿæ ¹æ®éœ€è¦éšæ—¶ä¸¢å¼ƒï¼Œé‚£ä¹ˆå°±å¯ä»¥å®ç° <strong>NSDiscardableContent</strong> åè®®æ‰€å®šä¹‰çš„æ¥å£ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">- (void)downloadDataForURL:(NSURL *)url &#123;</span><br><span class="line">    NSPurgeableData *cacheData = [_cache objectForKey:url];</span><br><span class="line">    if (cacheData) &#123;</span><br><span class="line">        // Stop the data being purged</span><br><span class="line">        [cacheData beginContentAccess];</span><br><span class="line">        </span><br><span class="line">        // Use the cached data</span><br><span class="line">        [self useData:cacheData];</span><br><span class="line">        </span><br><span class="line">        // Mark that the data may be purged again</span><br><span class="line">        [cacheData endContentAccess];</span><br><span class="line">    &#125;else &#123;</span><br><span class="line">        // Cache miss</span><br><span class="line">        EOCNetworkFetcher *fetcher = [[EOCNetworkFetcher alloc] initWithURL:url];</span><br><span class="line">        [fetcher startWithCompletionHandler:^(NSData *data) &#123;</span><br><span class="line">            NSPurgeableData *purgeableData = [NSPurgeableData dataWithData:data];</span><br><span class="line">            [_cache setObject:purgeableData</span><br><span class="line">                       forKey:url</span><br><span class="line">                         cost:purgeableData.length];</span><br><span class="line">            </span><br><span class="line">            // Don&apos;t need to beginContentAccess as it begins</span><br><span class="line">            // with access already marked</span><br><span class="line">            </span><br><span class="line">            // Use the retrieved data</span><br><span class="line">            [self useData:data];</span><br><span class="line">            </span><br><span class="line">            // Mark that the data may be purged now</span><br><span class="line">            [cacheData endContentAccess];</span><br><span class="line">        &#125;];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="è¦ç‚¹-3"><a href="#è¦ç‚¹-3" class="headerlink" title="è¦ç‚¹"></a>è¦ç‚¹</h4><ul>
<li>å®ç°ç¼“å­˜æ—¶åº”é€‰ç”¨ <strong>NSCache</strong> è€Œé <strong>NSDictionary</strong> å¯¹è±¡ã€‚å› ä¸º <strong>NSCache</strong> å¯ä»¥æä¾›ä¼˜é›…çš„è‡ªåŠ¨åˆ å‡åŠŸèƒ½ï¼Œè€Œä¸”æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œæ­¤å¤–ï¼Œå®ƒä¸å­—å…¸ä¸åŒï¼Œå¹¶ä¸ä¼šæ‹·è´é”®ã€‚</li>
<li>å¯ä»¥ç»™ <strong>NSCache</strong> å¯¹è±¡è®¾ç½®ä¸Šé™ï¼Œç”¨ä»¥é™åˆ¶ç¼“å­˜ä¸­çš„å¯¹è±¡æ€»ä¸ªæ•°åŠæ€»æˆæœ¬ï¼Œè€Œè¿™äº›å°ºåº¦åˆ™å®šä¹‰äº†ç¼“å­˜åˆ å‡å…¶ä¸­å¯¹è±¡çš„æ—¶æœºã€‚ä½†æ˜¯ç»å¯¹ä¸è¦æŠŠè¿™äº›å°ºåº¦å½“æˆå¯é çš„ç¡¬é™åˆ¶ï¼Œä»–ä»¬ä»…å¯¹ <strong>NSCache</strong> èµ·æŒ‡å¯¼ä½œç”¨ã€‚</li>
<li>å°† <strong>NSPurgeableData</strong> ä¸ <strong>NSCache</strong> æ­é…ä½¿ç”¨ï¼Œå¯å®ç°è‡ªåŠ¨æ¸…é™¤æ•°æ®çš„åŠŸèƒ½ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå½“<strong>NSPurgeableData</strong> å¯¹è±¡æ‰€å å†…å­˜ä¸ºç³»ç»Ÿä¸¢å¼ƒæ—¶ï¼Œè¯¥å¯¹è±¡è‡ªèº«ä¹Ÿä¼šä»ç¼“å­˜ä¸­ç§»é™¤ã€‚</li>
<li>å¦‚æœç¼“å­˜ä½¿ç”¨å¾—å½“ã€‚é‚£ä¹ˆåº”ç”¨ç¨‹åºçš„å“åº”é€Ÿåº¦å°±èƒ½æé«˜ã€‚åªæœ‰é‚£ç§é‡æ–°è®¡ç®—èµ·æ¥å¾ˆè´¹äº‹çš„æ•°æ®ï¼Œæ‰å€¼å¾—æ”¾å…¥ç¼“å­˜ï¼Œæ¯”å¦‚é‚£äº›éœ€è¦ä»ç½‘ç»œè·å–æˆ–ä»ç£ç›˜è¯»å–çš„æ•°æ®ã€‚</li>
</ul>
<h3 id="ç¬¬51æ¡ï¼šç²¾ç®€-initialize-ä¸-load-çš„å®ç°ä»£ç "><a href="#ç¬¬51æ¡ï¼šç²¾ç®€-initialize-ä¸-load-çš„å®ç°ä»£ç " class="headerlink" title="ç¬¬51æ¡ï¼šç²¾ç®€ initialize ä¸ load çš„å®ç°ä»£ç "></a>ç¬¬51æ¡ï¼šç²¾ç®€ initialize ä¸ load çš„å®ç°ä»£ç </h3><h4 id="load-æ–¹æ³•"><a href="#load-æ–¹æ³•" class="headerlink" title="load æ–¹æ³•"></a>load æ–¹æ³•</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">+ (void)load;</span><br></pre></td></tr></table></figure>
<ul>
<li>å¯¹äºåŠ å…¥è¿è¡ŒæœŸç³»ç»Ÿä¸­çš„æ¯ä¸ªç±»ï¼ˆclass) åŠåˆ†ç±»ï¼ˆcategory) æ¥è¯´ï¼Œå¿…å®šä¼šè°ƒç”¨æ­¤æ–¹æ³•ï¼Œè€Œä¸”ä»…è°ƒç”¨ä¸€æ¬¡ã€‚å½“åŒ…å«ç±»æˆ–åˆ†ç±»çš„ç¨‹åºåº“è½½å…¥ç³»ç»Ÿæ—¶ï¼Œå°±ä¼šæ‰§è¡Œæ­¤æ–¹æ³•ï¼Œè€Œè¿™é€šå¸¸å°±æ˜¯æŒ‡åº”ç”¨ç¨‹åºå¯åŠ¨çš„æ—¶å€™ï¼Œè‹¥ç¨‹åºæ˜¯ä¸ºiOSå¹³å°è®¾è®¡çš„ï¼Œåˆ™è‚¯å®šä¼šåœ¨æ­¤æ—¶æ‰§è¡Œã€‚</li>
<li>å¦‚æœåˆ†ç±»å’Œå…¶æ‰€å±çš„ç±»éƒ½å®šä¹‰äº† <code>load</code> æ–¹æ³•ï¼Œåˆ™å…ˆè°ƒç”¨ç±»é‡Œçš„ï¼Œå†è°ƒç”¨åˆ†ç±»é‡Œçš„ã€‚</li>
<li>åœ¨ <code>load</code> æ–¹æ³•ä¸­ä½¿ç”¨å…¶ä»–ç±»æ˜¯ä¸å®‰å…¨çš„ã€‚</li>
<li>ä¸éµå¾ªç»§æ‰¿è§„åˆ™ã€‚å¦‚æœæŸä¸ªç±»æœ¬èº«æ²¡å®ç° <code>load</code> æ–¹æ³•ï¼Œé‚£ä¹ˆä¸ç®¡å…¶å„çº§è¶…ç±»æ˜¯å¦å®ç°æ­¤æ–¹æ³•ï¼Œç³»ç»Ÿéƒ½ä¸ä¼šè°ƒç”¨ã€‚æ­¤å¤–ï¼Œåˆ†ç±»å’Œå…¶æ‰€å±çš„ç±»é‡Œï¼Œéƒ½å¯èƒ½å‡ºç° <code>load</code> æ–¹æ³•ã€‚æ­¤æ—¶ä¸¤ç§å®ç°ä»£ç éƒ½ä¼šè°ƒç”¨ï¼Œç±»çš„å®ç°è¦æ¯”åˆ†ç±»çš„å®ç°å…ˆæ‰§è¡Œã€‚</li>
<li>è€Œä¸” <code>load</code> æ–¹æ³•åŠ¡å¿…å®ç°å¾—ç²¾ç®€ä¸€äº›ï¼Œä¹Ÿå°±æ˜¯è¦å°½é‡å‡å°‘å…¶æ‰€æ‰§è¡Œçš„æ“ä½œï¼Œå› ä¸ºæ•´ä¸ªåº”ç”¨ç¨‹åºåœ¨æ‰§è¡Œ <code>load</code> æ–¹æ³•æ—¶éƒ½ä¼šé˜»å¡ã€‚åº”ç”¨ç¨‹åºå¿…é¡»é˜»å¡å¹¶ç­‰ç€æ‰€æœ‰ç±»çš„ <code>load</code> éƒ½æ‰§è¡Œå®Œï¼Œæ‰èƒ½ç»§ç»­ã€‚</li>
<li><code>load</code> æ–¹æ³•çœŸæ­£ç”¨é€”ä»…åœ¨äºè°ƒè¯•ç¨‹åºï¼Œæ¯”å¦‚å¯ä»¥åœ¨åˆ†ç±»é‡Œç¼–å†™æ­¤æ–¹æ³•ï¼Œç”¨æ¥åˆ¤æ–­è¯¥åˆ†ç±»æ˜¯å¦å·²ç»æ­£ç¡®è½½å…¥ç³»ç»Ÿä¸­ã€‚ä¹Ÿè®¸æ­¤æ–¹æ³•ä¸€åº¦å¾ˆæœ‰ç”¨å¤„ï¼Œä½†ç°åœ¨å®Œå…¨å¯ä»¥è¯´ï¼šæ—¶ä¸‹ç¼–å†™ Objective-C ä»£ç æ—¶, ä¸éœ€è¦ç”¨å®ƒã€‚</li>
</ul>
<h4 id="initialize-æ–¹æ³•"><a href="#initialize-æ–¹æ³•" class="headerlink" title="initialize æ–¹æ³•"></a>initialize æ–¹æ³•</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">+ (void)initialize;</span><br></pre></td></tr></table></figure>
<ul>
<li>å¯¹äºæ¯ä¸ªç±»æ¥è¯´ï¼Œè¯¥æ–¹æ³•ä¼šåœ¨ç¨‹åºé¦–æ¬¡ç”¨è¯¥ç±»ä¹‹å‰è°ƒç”¨ï¼Œä¸”åªè°ƒç”¨ä¸€æ¬¡ã€‚å®ƒæ˜¯ç”±è¿è¡ŒæœŸç³»ç»Ÿæ¥è°ƒç”¨çš„ï¼Œç»ä¸åº”è¯¥é€šè¿‡ä»£ç ç›´æ¥è°ƒç”¨ã€‚</li>
<li>å®ƒæ˜¯â€œæƒ°æ€§è°ƒç”¨çš„â€ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œåªæœ‰å½“ç¨‹åºç”¨åˆ°äº†ç›¸å…³çš„ç±»æ—¶ï¼Œæ‰ä¼šè°ƒç”¨ã€‚</li>
<li>è¿è¡ŒæœŸç³»ç»Ÿåœ¨æ‰§è¡Œè¯¥æ–¹æ³•æ—¶ï¼Œæ˜¯å¤„äºæ­£å¸¸çŠ¶æ€çš„ã€‚è€Œä¸”ï¼Œè¿è¡ŒæœŸç³»ç»Ÿä¹Ÿèƒ½ç¡®ä¿ <code>initialize</code> æ–¹æ³•ä¸€å®šä¼šåœ¨<strong>çº¿ç¨‹å®‰å…¨çš„ç¯å¢ƒ</strong>ä¸­æ‰§è¡Œã€‚</li>
<li>éµå¾ªç»§æ‰¿è§„åˆ™ã€‚<code>initialize</code> æ–¹æ³•ä¸å…¶ä»–æ¶ˆæ¯ä¸€æ ·ï¼Œå¦‚æœæŸä¸ªç±»æœªå®ç°å®ƒï¼Œè€Œå…¶è¶…ç±»å®ç°äº†ï¼Œé‚£ä¹ˆå°±ä¼šè¿è¡Œè¶…ç±»çš„å®ç°ä»£ç ã€‚</li>
</ul>
<h4 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h4><ul>
<li>è¿™ä¸¤ä¸ªæ–¹æ³•çš„å®ç°ä»£ç è¦å°½é‡ç²¾ç®€ã€‚åœ¨é‡Œé¢è®¾ç½®ä¸€äº›çŠ¶æ€ï¼Œä½¿æœ¬ç±»èƒ½å¤Ÿæ­£å¸¸è¿ä½œå°±å¯ä»¥äº†ï¼Œä¸è¦æ‰§è¡Œè€—æ—¶å¤ªä¹…æˆ–éœ€è¦åŠ é”çš„ä»»åŠ¡ã€‚</li>
<li>å¼€å‘è€…æ— æ³•æ§åˆ¶ç±»çš„åˆå§‹åŒ–æ—¶æœºã€‚</li>
<li>å¦‚æœæŸä¸ªç±»çš„å®ç°ä»£ç å¾ˆå¤æ‚ï¼Œé‚£ä¹ˆå…¶ä¸­å¯èƒ½ä¼šç›´æ¥æˆ–é—´æ¥ç”¨åˆ°å…¶ä»–ç±»ã€‚</li>
<li><code>initialize</code> æ–¹æ³•åªåº”è¯¥ç”¨æ¥è®¾ç½®å†…éƒ¨æ•°æ®ã€‚è‹¥æŸä¸ªå…¨å±€çŠ¶æ€æ— æ³•åœ¨ç¼–è¯‘æœŸåˆå§‹åŒ–ï¼Œåˆ™å¯ä»¥æ”¾åœ¨ <code>initialize</code> é‡Œæ¥åšã€‚</li>
</ul>
<h4 id="è¦ç‚¹-4"><a href="#è¦ç‚¹-4" class="headerlink" title="è¦ç‚¹"></a>è¦ç‚¹</h4><ul>
<li>åœ¨åŠ è½½é˜¶æ®µï¼Œå¦‚æœå®ç°äº† <code>load</code> æ–¹æ³•ï¼Œé‚£ä¹ˆç³»ç»Ÿå°±ä¼šè°ƒç”¨å®ƒã€‚åˆ†ç±»é‡Œä¹Ÿå¯ä»¥å®šä¹‰æ­¤æ–¹æ³•ï¼Œç±»çš„ <code>load</code>æ–¹æ³•è¦æ¯”åˆ†ç±»ä¸­çš„å…ˆè°ƒç”¨ã€‚ä¸å…¶ä»–æ–¹æ³•ä¸åŒï¼Œ<code>load</code> æ–¹æ³•ä¸å‚ä¸è¦†å†™æœºåˆ¶ã€‚</li>
<li>é¦–æ¬¡ä½¿ç”¨æŸä¸ªç±»ä¹‹å‰ï¼Œç³»ç»Ÿä¼šå‘å…¶å‘é€ <code>initialize</code> æ¶ˆæ¯ã€‚ç”±äºæ­¤æ–¹æ³•éµä»æ™®é€šçš„è¦†å†™è§„åˆ™ï¼Œæ‰€ä»¥é€šå¸¸åº”è¯¥åœ¨é‡Œé¢åˆ¤æ–­å½“å‰è¦åˆå§‹åŒ–çš„æ˜¯å“ªä¸ªç±»ã€‚</li>
<li><code>load</code>ä¸<code>initialize</code>æ–¹æ³•éƒ½åº”è¯¥å®ç°çš„ç²¾ç®€ä¸€äº›ï¼Œè¿™æœ‰åŠ©äºä¿æŒåº”ç”¨ç¨‹åºçš„å“åº”èƒ½åŠ›ï¼Œä¹Ÿèƒ½å‡å°‘å¼•å…¥ä¾èµ–ç¯çš„å‡ ç‡ã€‚</li>
<li>æ— æ³•åœ¨ç¼–è¯‘æœŸè®¾å®šçš„å…¨å±€å¸¸é‡ï¼Œå¯ä»¥æ”¾åœ¨<code>initialize</code>æ–¹æ³•é‡Œåˆå§‹åŒ–ã€‚</li>
</ul>
<h3 id="ç¬¬52æ¡ï¼šåˆ«å¿˜äº†-NSTimer-ä¼šä¿ç•™å…¶ç›®æ ‡å¯¹è±¡"><a href="#ç¬¬52æ¡ï¼šåˆ«å¿˜äº†-NSTimer-ä¼šä¿ç•™å…¶ç›®æ ‡å¯¹è±¡" class="headerlink" title="ç¬¬52æ¡ï¼šåˆ«å¿˜äº† NSTimer ä¼šä¿ç•™å…¶ç›®æ ‡å¯¹è±¡"></a>ç¬¬52æ¡ï¼šåˆ«å¿˜äº† NSTimer ä¼šä¿ç•™å…¶ç›®æ ‡å¯¹è±¡</h3><ul>
<li><strong>Foundation</strong> æ¡†æ¶ä¸­æœ‰ä¸ªç±»å«åš <strong>NSTimer</strong> ï¼Œå¼€å‘è€…å¯ä»¥æŒ‡å®šç»å¯¹çš„æ—¥æœŸä¸æ—¶é—´ï¼Œä»¥ä¾¿åˆ°æ—¶æ‰§è¡Œä»»åŠ¡ï¼Œä¹Ÿå¯ä»¥æŒ‡å®šæ‰§è¡Œä»»åŠ¡çš„ç›¸å¯¹å»¶è¿Ÿæ—¶é—´ã€‚è®¡æ—¶å™¨è¿˜å¯ä»¥é‡å¤è¿è¡Œä»»åŠ¡ï¼Œæœ‰ä¸ªä¸ä¹‹ç›¸å…³è”çš„â€œé—´éš”å€¼â€ï¼ˆinterval) å¯ç”¨æ¥æŒ‡å®šä»»åŠ¡çš„è§¦å‘é¢‘ç‡ã€‚</li>
<li>åªæœ‰æŠŠè®¡æ—¶å™¨æ”¾åœ¨è¿è¡Œå¾ªç¯é‡Œï¼Œå®ƒæ‰èƒ½æ­£å¸¸è§¦å‘ä»»åŠ¡ã€‚</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">+ (NSTimer *)scheduledTimerWithTimeInterval:(NSTimeInterval)ti</span><br><span class="line">                                     target:(id)aTarget</span><br><span class="line">                                   selector:(SEL)aSelector</span><br><span class="line">                                   userInfo:(nullable id)userInfo</span><br><span class="line">                                    repeats:(BOOL)yesOrNo;</span><br></pre></td></tr></table></figure>
<ul>
<li><p>ç”¨æ­¤æ–¹æ³•åˆ›å»ºå‡ºæ¥çš„è®¡æ—¶å™¨ï¼Œä¼šåœ¨æŒ‡å®šçš„é—´éš”æ—¶é—´ä¹‹åæ‰§è¡Œä»»åŠ¡ã€‚ä¹Ÿå¯ä»¥ä»¤å…¶åå¤æ‰§è¡Œä»»åŠ¡ï¼Œç›´åˆ°å¼€å‘è€…ç¨åå°†å…¶æ‰‹åŠ¨å…³é—­ä¸ºæ­¢ã€‚targetä¸selectorå‚æ•°è¡¨ç¤ºè®¡æ—¶å™¨å°†åœ¨å“ªä¸ªå¯¹è±¡ä¸Šè°ƒç”¨å“ªä¸ªæ–¹æ³•ã€‚è®¡æ—¶å™¨ä¼šä¿ç•™å…¶ç›®æ ‡å¯¹è±¡ï¼Œç­‰åˆ°è‡ªèº«â€œå¤±æ•ˆâ€æ—¶å†é‡Šæ”¾æ­¤å¯¹è±¡ã€‚è°ƒç”¨ <code>invalidate</code> æ–¹æ³•å¯ä»¤è®¡æ—¶å™¨å¤±æ•ˆï¼›æ‰§è¡Œå®Œç›¸å…³ä»»åŠ¡ä¹‹åï¼Œä¸€æ¬¡æ€§çš„è®¡æ—¶å™¨ä¹Ÿä¼šå¤±æ•ˆã€‚å¼€å‘è€…è‹¥å°†è®¡æ—¶å™¨è®¾ç½®æˆé‡å¤æ‰§è¡Œæ¨¡å¼ï¼Œé‚£ä¹ˆå¿…é¡»è‡ªå·±è°ƒç”¨ <code>invalidate</code> æ–¹æ³•ï¼Œæ‰èƒ½ä»¤å…¶åœæ­¢ã€‚</p>
</li>
<li><p>ç”±äºè®¡æ—¶å™¨ä¼šä¿ç•™å…¶ç›®æ ‡å¯¹è±¡ï¼Œæ‰€ä»¥åå¤æ‰§è¡Œä»»åŠ¡é€šå¸¸ä¼šå¯¼è‡´åº”ç”¨ç¨‹åºå‡ºé—®é¢˜ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œè®¾ç½®æˆé‡å¤æ‰§è¡Œæ¨¡å¼çš„é‚£ç§è®¡æ—¶å™¨ï¼Œå¾ˆå®¹æ˜“å¼•äººâ€œä¿ç•™ç¯â€ã€‚</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//  EOCClass.h</span></span><br><span class="line"><span class="meta">#import <span class="meta-string">&lt;Foundation/Foundation.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">EOCClass</span> : <span class="title">NSObject</span></span></span><br><span class="line">- (<span class="keyword">void</span>)startPolling;</span><br><span class="line">- (<span class="keyword">void</span>)stopPolling;</span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//  EOCClass.m</span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"EOCClass.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">EOCClass</span> </span>&#123;</span><br><span class="line">    <span class="comment">// â‡ï¸ EOCClass â†’ _pollTimer</span></span><br><span class="line">    <span class="built_in">NSTimer</span> *_pollTimer;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">instancetype</span>)init &#123;</span><br><span class="line">    <span class="keyword">return</span> [<span class="keyword">super</span> init];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)dealloc &#123;</span><br><span class="line">    [_pollTimer invalidate];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)startPolling &#123;</span><br><span class="line">    <span class="comment">// â‡ï¸ _pollTimer â†’ EOCClass</span></span><br><span class="line">    _pollTimer =</span><br><span class="line">    [<span class="built_in">NSTimer</span> scheduledTimerWithTimeInterval:<span class="number">5.0</span></span><br><span class="line">                                     target:<span class="keyword">self</span></span><br><span class="line">                                   selector:<span class="keyword">@selector</span>(p_doPoll)</span><br><span class="line">                                   userInfo:<span class="literal">nil</span></span><br><span class="line">                                    repeats:<span class="literal">YES</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)stopPolling &#123;</span><br><span class="line">    [_pollTimer invalidate];</span><br><span class="line">    _pollTimer = <span class="literal">nil</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)p_doPoll &#123;</span><br><span class="line">    <span class="comment">// Poll the resource</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p>è§£å†³å¼•ç”¨å¾ªç¯æ–¹æ³•ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">//  NSTimer+EOCBlocksSupport.h</span><br><span class="line">#import &lt;Foundation/Foundation.h&gt;</span><br><span class="line"></span><br><span class="line">@interface NSTimer (EOCBlocksSupport)</span><br><span class="line"></span><br><span class="line">+ (NSTimer *)eoc_scheduledTimerWithTimeInterval:(NSTimeInterval)interval</span><br><span class="line">                                          block:(void(^)())block</span><br><span class="line">                                        repeats:(BOOL)repeats;</span><br><span class="line">@end</span><br><span class="line"></span><br><span class="line">//  NSTimer+EOCBlocksSupport.m</span><br><span class="line">#import &quot;NSTimer+EOCBlocksSupport.h&quot;</span><br><span class="line"></span><br><span class="line">@implementation NSTimer (EOCBlocksSupport)</span><br><span class="line"></span><br><span class="line">+ (NSTimer *)eoc_scheduledTimerWithTimeInterval:(NSTimeInterval)interval</span><br><span class="line">                                          block:(void(^)())block</span><br><span class="line">                                        repeats:(BOOL)repeats &#123;</span><br><span class="line">    return [self scheduledTimerWithTimeInterval:interval</span><br><span class="line">                                         target:self</span><br><span class="line">                                       selector:@selector(eoc_blockInvoke:) userInfo:[block copy] repeats:repeats];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">+ (void)eoc_blockInvoke:(NSTimer *)timer &#123;</span><br><span class="line">    void (^block)() = timer.userInfo;</span><br><span class="line">    if (block) &#123;</span><br><span class="line">        block();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@end</span><br></pre></td></tr></table></figure>
<p>å°†è®¡æ—¶å™¨æ‰€åº”æ‰§è¡Œçš„ä»»åŠ¡å°è£…æˆ block ã€‚åœ¨è°ƒç”¨è®¡æ—¶å™¨å‡½æ•°æ—¶ï¼ŒæŠŠå®ƒä½œä¸º userlnfo å‚æ•°ä¼ è¿›å»ã€‚è¯¥å‚æ•°å¯ç”¨æ¥å­˜æ”¾ä¸é€æ˜å€¼(opaque value)ï¼Œåªè¦è®¡æ—¶å™¨è¿˜æœ‰æ•ˆï¼Œå°±ä¼šä¸€ç›´ä¿ç•™ç€å®ƒã€‚ä¼ äººå‚æ•°æ—¶è¦é€šè¿‡ copy æ–¹æ³•å°† block æ‹·è´åˆ°â€œå †â€ä¸Šï¼ˆå‚è§ç¬¬37æ¡)ï¼Œå¦åˆ™ç­‰åˆ°ç¨åè¦æ‰§è¡Œå®ƒçš„æ—¶å€™ï¼Œè¯¥å—å¯èƒ½å·²ç»æ— æ•ˆäº†ã€‚è®¡æ—¶å™¨ç°åœ¨çš„ target æ˜¯ NSTimer ç±»å¯¹è±¡ï¼Œè¿™æ˜¯ä¸ªå•ä¾‹ï¼Œå› æ­¤è®¡æ—¶å™¨æ˜¯å¦ä¼šä¿ç•™å®ƒï¼Œå…¶å®éƒ½æ— æ‰€è°“ã€‚æ­¤å¤„ä¾ç„¶æœ‰ä¿ç•™ç¯ï¼Œç„¶è€Œå› ä¸ºç±»å¯¹è±¡ï¼ˆclassobject)æ— é¡»å›æ”¶ï¼Œæ‰€ä»¥ä¸ç”¨æ‹…å¿ƒã€‚</p>
<p>ä¼˜åŒ–ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">- (void)startPolling &#123;</span><br><span class="line">    __weak EOCClass *weakSelf = self;</span><br><span class="line">    _pollTimer =</span><br><span class="line">    [NSTimer eoc_scheduledTimerWithTimeInterval:5.0</span><br><span class="line">                                          block:^&#123;</span><br><span class="line">                                              EOCClass *strongSelf = weakSelf;</span><br><span class="line">                                              [strongSelf p_doPoll];</span><br><span class="line">                                          &#125;</span><br><span class="line">                                        repeats:YES];</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="iOS-10-0-ä¸­å·²ç»å¼•å…¥äº†è¯¥æ–¹æ³•"><a href="#iOS-10-0-ä¸­å·²ç»å¼•å…¥äº†è¯¥æ–¹æ³•" class="headerlink" title="iOS 10.0 ä¸­å·²ç»å¼•å…¥äº†è¯¥æ–¹æ³•"></a>iOS 10.0 ä¸­å·²ç»å¼•å…¥äº†è¯¥æ–¹æ³•</h4><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">+ (<span class="built_in">NSTimer</span> *)timerWithTimeInterval:(<span class="built_in">NSTimeInterval</span>)interval repeats:(<span class="built_in">BOOL</span>)repeats block:(<span class="keyword">void</span> (^)(<span class="built_in">NSTimer</span> *timer))block;</span><br><span class="line"></span><br><span class="line">+ (<span class="built_in">NSTimer</span> *)scheduledTimerWithTimeInterval:(<span class="built_in">NSTimeInterval</span>)interval repeats:(<span class="built_in">BOOL</span>)repeats block:(<span class="keyword">void</span> (^)(<span class="built_in">NSTimer</span> *timer))block;</span><br></pre></td></tr></table></figure>
<h4 id="è¦ç‚¹-5"><a href="#è¦ç‚¹-5" class="headerlink" title="è¦ç‚¹"></a>è¦ç‚¹</h4><ul>
<li>NSTimer å¯¹è±¡ä¼šä¿ç•™å…¶ç›®æ ‡ï¼Œç›´åˆ°è®¡æ—¶å™¨æœ¬èº«å¤±æ•ˆä¸ºæ­¢ï¼Œè°ƒç”¨ <code>invalidate</code> æ–¹æ³•å¯ä»¤è®¡æ—¶å™¨å¤±æ•ˆï¼Œå¦å¤–ï¼Œä¸€æ¬¡æ€§çš„è®¡æ—¶å™¨åœ¨è§¦å‘å®Œä»»åŠ¡ä¹‹åä¹Ÿä¼šå¤±æ•ˆã€‚</li>
<li>åå¤æ‰§è¡Œä»»åŠ¡çš„è®¡æ—¶å™¨ï¼Œå¾ˆå®¹æ˜“å¼•å…¥ä¿ç•™ç¯ï¼Œå¦‚æœè¿™ç§è®¡æ—¶å™¨çš„ç›®æ ‡å¯¹è±¡åˆä¿ç•™äº†è®¡æ—¶å™¨æœ¬èº«ï¼Œé‚£è‚¯å®šä¼šå¯¼è‡´å¾ªç¯å¼•ç”¨ã€‚è¿™ç§å¾ªç¯å¼•ç”¨ï¼Œå¯èƒ½æ˜¯ç›´æ¥å‘ç”Ÿçš„ï¼Œä¹Ÿå¯èƒ½æ˜¯é€šè¿‡å¯¹è±¡å›¾é‡Œçš„å…¶ä»–å¯¹è±¡é—´æ¥å‘ç”Ÿçš„ã€‚</li>
<li>å¯ä»¥æ‰©å…… NSTimer çš„åŠŸèƒ½ï¼Œç”¨å—æ¥æ‰“ç ´å¾ªç¯å¼•ç”¨ã€‚ä¸è¿‡ï¼Œé™¤é NSTimer å°†æ¥åœ¨å…¬å…±æ¥å£é‡Œæä¾›æ­¤åŠŸèƒ½ï¼Œå¦åˆ™å¿…é¡»åˆ›å»ºåˆ†ç±»ï¼Œå°†ç›¸å…³å®ç°ä»£ç åŠ å…¥å…¶ä¸­ã€‚</li>
</ul>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://andy0570.com/2017/08/20/å…­ã€å—ä¸å¤§ä¸­æ¢æ´¾å‘/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ç‹¬æœ¨èˆŸçš„æœ¨">
      <meta itemprop="description" content="æœ‰æ—¶å€™é˜³å…‰å¾ˆå¥½ æœ‰æ—¶å€™é˜³å…‰å¾ˆæš—">
      <meta itemprop="image" content="https://ws1.sinaimg.cn/large/006tNc79gy1g22m14458rj30u014xu0x.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ç‹¬æœ¨èˆŸçš„æœ¨">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2017/08/20/å…­ã€å—ä¸å¤§ä¸­æ¢æ´¾å‘/" class="post-title-link" itemprop="url">å…­ã€å—ä¸å¤§ä¸­æ¢æ´¾å‘</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              

              
                
              

              <time title="åˆ›å»ºæ—¶é—´ï¼š2017-08-20 15:36:00" itemprop="dateCreated datePublished" datetime="2017-08-20T15:36:00+08:00">2017-08-20</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">æ›´æ–°äº</span>
                
                <time title="ä¿®æ”¹æ—¶é—´ï¼š2019-04-16 00:13:09" itemprop="dateModified" datetime="2019-04-16T00:13:09+08:00">2019-04-16</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/ã€ŠEffective-Objective-C-2-0ã€‹/" itemprop="url" rel="index"><span itemprop="name">ã€ŠEffective Objective-C 2.0ã€‹</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          
            <span id="/2017/08/20/å…­ã€å—ä¸å¤§ä¸­æ¢æ´¾å‘/" class="leancloud_visitors" data-flag-title="å…­ã€å—ä¸å¤§ä¸­æ¢æ´¾å‘">
              <span class="post-meta-divider">|</span>
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              
                <span class="post-meta-item-text">é˜…è¯»æ¬¡æ•°ï¼š</span>
              
                <span class="leancloud-visitors-count"></span>
            </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body han-init-context" itemprop="articleBody">

      
      

      
        
          
            <h1 id="ã€ŠEffective-Objective-C-2-0-ç¼–å†™é«˜è´¨é‡iOSä¸OS-Xä»£ç çš„52ä¸ªæœ‰æ•ˆæ–¹æ³•-ã€‹å­¦ä¹ ç¬”è®°"><a href="#ã€ŠEffective-Objective-C-2-0-ç¼–å†™é«˜è´¨é‡iOSä¸OS-Xä»£ç çš„52ä¸ªæœ‰æ•ˆæ–¹æ³•-ã€‹å­¦ä¹ ç¬”è®°" class="headerlink" title="ã€ŠEffective Objective-C 2.0  ç¼–å†™é«˜è´¨é‡iOSä¸OS Xä»£ç çš„52ä¸ªæœ‰æ•ˆæ–¹æ³• ã€‹å­¦ä¹ ç¬”è®°"></a>ã€ŠEffective Objective-C 2.0  ç¼–å†™é«˜è´¨é‡iOSä¸OS Xä»£ç çš„52ä¸ªæœ‰æ•ˆæ–¹æ³• ã€‹å­¦ä¹ ç¬”è®°</h1><p><img src="http://upload-images.jianshu.io/upload_images/2648731-87bda0c1063653a9.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt></p>
<h2 id="ç¬¬6ç« -å—ä¸å¤§ä¸­æ¢æ´¾å‘"><a href="#ç¬¬6ç« -å—ä¸å¤§ä¸­æ¢æ´¾å‘" class="headerlink" title="ç¬¬6ç«  å—ä¸å¤§ä¸­æ¢æ´¾å‘"></a>ç¬¬6ç«  å—ä¸å¤§ä¸­æ¢æ´¾å‘</h2><blockquote>
<p>blockã€å—ã€Blockå—è¯­ä¹‰ç›¸åŒã€‚</p>
</blockquote>
<p> <strong>block</strong> æ˜¯ä¸€ç§å¯åœ¨ Cã€C++ åŠ Objective-C ä»£ç ä¸­ä½¿ç”¨çš„â€œè¯æ³•é—­åŒ…â€ï¼ˆlexical closure)ï¼Œå€Ÿç”±æ­¤æœºåˆ¶ï¼Œå¼€å‘è€…å¯å°†ä»£ç åƒå¯¹è±¡ä¸€æ ·ä¼ é€’ï¼Œä»¤å…¶åœ¨ä¸åŒç¯å¢ƒï¼ˆcontextï¼‰ä¸‹è¿è¡Œã€‚è¿˜æœ‰ä¸ªå…³é”®çš„åœ°æ–¹æ˜¯ï¼Œåœ¨å®šä¹‰ block çš„èŒƒå›´å†…ï¼Œå®ƒå¯ä»¥è®¿é—®åˆ°å…¶ä¸­çš„å…¨éƒ¨å˜é‡ã€‚</p>
<p><strong>GCD</strong> æ˜¯ä¸€ç§ä¸ block æœ‰å…³çš„æŠ€æœ¯ï¼Œå®ƒæä¾›äº†å¯¹çº¿ç¨‹çš„æŠ½è±¡ï¼Œè€Œè¿™ç§æŠ½è±¡åˆ™åŸºäºâ€œæ´¾å‘é˜Ÿåˆ—â€ (dispatch queue) ã€‚å¼€å‘è€…å¯å°†å—æ’å…¥é˜Ÿåˆ—ä¸­ï¼Œç”±GCDè´Ÿè´£å¤„ç†æ‰€æœ‰è°ƒåº¦äº‹å®œã€‚GCDä¼šæ ¹æ®ç³»ç»Ÿèµ„æºæƒ…å†µï¼Œé€‚æ—¶åœ°åˆ›å»ºã€å¤ç”¨ã€æ‘§æ¯åå°çº¿ç¨‹ï¼ˆbackground thread)ï¼Œä»¥ä¾¿å¤„ç†æ¯ä¸ªé˜Ÿåˆ—ã€‚ æ­¤å¤–ï¼Œä½¿ç”¨GCDè¿˜å¯ä»¥æ–¹ä¾¿åœ°å®Œæˆå¸¸è§ç¼–ç¨‹ä»»åŠ¡ï¼Œæ¯”å¦‚ç¼–å†™ â€œåªæ‰§è¡Œä¸€æ¬¡çš„çº¿ç¨‹å®‰å…¨ä»£ç â€ (thread-safe single-code execution)ï¼Œæˆ–è€…æ ¹æ®å¯ç”¨çš„ç³»ç»Ÿèµ„æºæ¥å¹¶å‘æ‰§è¡Œå¤šä¸ªæ“ä½œã€‚</p>
<h3 id="ç¬¬37æ¡ï¼šç†è§£â€œå—â€è¿™ä¸€æ¦‚å¿µ"><a href="#ç¬¬37æ¡ï¼šç†è§£â€œå—â€è¿™ä¸€æ¦‚å¿µ" class="headerlink" title="ç¬¬37æ¡ï¼šç†è§£â€œå—â€è¿™ä¸€æ¦‚å¿µ"></a>ç¬¬37æ¡ï¼šç†è§£â€œå—â€è¿™ä¸€æ¦‚å¿µ</h3><h4 id="å—çš„åŸºç¡€çŸ¥è¯†"><a href="#å—çš„åŸºç¡€çŸ¥è¯†" class="headerlink" title="å—çš„åŸºç¡€çŸ¥è¯†"></a>å—çš„åŸºç¡€çŸ¥è¯†</h4><p><img src="http://upload-images.jianshu.io/upload_images/2648731-36c35369377855f8.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt></p>
<p>ç®€å•çš„ blockï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">^&#123;</span><br><span class="line">    //Block implementation here</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>block è¯­æ³•ç»“æ„ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">typedef returnType(^name)(arguments);</span><br></pre></td></tr></table></figure>
<p>å®šä¹‰ä¸€ä¸ªåä¸º someBlock çš„å˜é‡ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">void (^someBlock)() = ^&#123;</span><br><span class="line">    //Block implementation here</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>â‡ï¸ blockçš„å¼ºå¤§ä¹‹å¤„ï¼šåœ¨ block å†…éƒ¨å¯ä»¥è®¿é—® blockå¤–éƒ¨å˜é‡ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">// å°†å˜é‡å£°æ˜ä¸º __block ä¹‹åæ‰å¯ä»¥åœ¨ Block å†…éƒ¨å¯¹æ­¤å˜é‡è¿›è¡Œä¿®æ”¹</span><br><span class="line">__block int additional = 5;</span><br><span class="line">// å£°æ˜Blockå—</span><br><span class="line">int (^addBlock)(int a, int b) = ^(int a, int b) &#123;</span><br><span class="line">    additional = 10;</span><br><span class="line">    return a + b + additional;</span><br><span class="line">&#125;;</span><br><span class="line">// ä½¿ç”¨Blockå—</span><br><span class="line">int add = addBlock(2, 5);</span><br></pre></td></tr></table></figure>
<ul>
<li><p>å¦‚æœblockæ‰€æ•è·çš„å˜é‡æ˜¯å¯¹è±¡ç±»å‹ï¼Œé‚£ä¹ˆå°±ä¼šè‡ªåŠ¨ä¿ç•™å®ƒã€‚ç³»ç»Ÿåœ¨é‡Šæ”¾è¿™ä¸ªå—çš„æ—¶å€™ï¼Œä¹Ÿä¼šå°†å…¶ä¸€å¹¶é‡Šæ”¾ã€‚</p>
</li>
<li><p><strong>blockæœ¬èº«å¯è§†ä¸ºå¯¹è±¡</strong>ï¼Œå®ƒä¹Ÿæœ‰å¼•ç”¨è®¡æ•°ã€‚</p>
</li>
<li><p>å¦‚æœå°†blockå®šä¹‰åœ¨ Objective-C ç±»çš„å®ä¾‹æ–¹æ³•ä¸­ï¼Œé‚£ä¹ˆé™¤äº†å¯ä»¥è®¿é—®ç±»çš„æ‰€æœ‰å®ä¾‹å˜ç«¥ä¹‹å¤–ï¼Œè¿˜å¯ä»¥ä½¿ç”¨ <code>self</code> å˜é‡ã€‚blockæ€»èƒ½ä¿®æ”¹å®ä¾‹å˜é‡ï¼Œæ‰€ä»¥åœ¨å£°æ˜æ—¶æ— é¡»åŠ  <code>_block</code>ã€‚ä¸è¿‡ï¼Œå¦‚æœé€šè¿‡è¯»å†™æ“ä½œæ•è·äº†å®ä¾‹å˜é‡ï¼Œé‚£ä¹ˆä¹Ÿä¼šè‡ªåŠ¨æŠŠ <code>self</code> å˜é‡ä¸€å¹¶æ•è·ï¼Œå› ä¸ºå®ä¾‹å˜é‡æ˜¯ä¸<code>self</code>æ‰€æŒ‡ä»£çš„å®ä¾‹å…³è”åœ¨ä¸€èµ·çš„ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">- (void)anInstanceMethod &#123;</span><br><span class="line">    //...</span><br><span class="line">    void (^someBlock)() = ^&#123;</span><br><span class="line">        _anInstanceVariable = @&quot;Something&quot;;</span><br><span class="line">        NSLog(@&quot;_anInstanceVariable = %@&quot;,_anInstanceVariable);</span><br><span class="line">    &#125;;</span><br><span class="line">    //...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>åœ¨blockä¸­ï¼Œç›´æ¥è®¿é—®å®ä¾‹å˜é‡å’Œé€šè¿‡ <code>self</code> æ¥è®¿é—®æ˜¯ç­‰æ•ˆçš„ã€‚</p>
</li>
<li><p><code>self</code>  ä¹Ÿæ˜¯ä¸ªå¯¹è±¡ï¼Œå› è€Œblockåœ¨æ•è·å®ƒæ—¶ä¹Ÿä¼šå°†å…¶ä¿ç•™ã€‚å¦‚æœ <code>self</code> æ‰€æŒ‡ä»£çš„é‚£ä¸ªå¯¹è±¡åŒæ—¶ä¹Ÿä¿ç•™äº†å—ï¼Œé‚£ä¹ˆè¿™ç§æƒ…å†µé€šå¸¸å°±ä¼šå¯¼è‡´<strong>å¼•ç”¨å¾ªç¯</strong>ã€‚</p>
</li>
</ul>
<h4 id="å—çš„å†…éƒ¨ç»“æ„"><a href="#å—çš„å†…éƒ¨ç»“æ„" class="headerlink" title="å—çš„å†…éƒ¨ç»“æ„"></a>å—çš„å†…éƒ¨ç»“æ„</h4><p>blockå¯¹è±¡åœ¨æ ˆä¸­çš„ç»“æ„ï¼š</p>
<p><img src="http://upload-images.jianshu.io/upload_images/2648731-b34a08b1ea34a3de.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt></p>
<p>å¯¹åº”çš„ç»“æ„ä½“å®šä¹‰ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">struct Block_descriptor &#123;</span><br><span class="line">    unsigned long int reserved;</span><br><span class="line">    unsigned long int size;</span><br><span class="line">    void (*copy)(void *dst, void *src);</span><br><span class="line">    void (*dispose)(void *);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">struct Block_layout &#123;</span><br><span class="line">    void *isa;</span><br><span class="line">    int flags;</span><br><span class="line">    int reserved;</span><br><span class="line">    void (*invoke)(void *, ...);</span><br><span class="line">    struct Block_descriptor *descriptor;</span><br><span class="line">    /* Imported variables. */</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<ul>
<li><code>isa</code>æŒ‡é’ˆï¼šæŒ‡å‘è¡¨æ˜è¯¥blockç±»å‹çš„ç±»ã€‚</li>
<li><code>flags</code>ï¼šæŒ‰bitä½è¡¨ç¤ºä¸€äº›blockçš„é™„åŠ ä¿¡æ¯ï¼Œæ¯”å¦‚åˆ¤æ–­blockç±»å‹ã€åˆ¤æ–­blockå¼•ç”¨è®¡æ•°ã€åˆ¤æ–­blockæ˜¯å¦éœ€è¦æ‰§è¡Œè¾…åŠ©å‡½æ•°ç­‰ã€‚</li>
<li><code>reserved</code>ï¼šä¿ç•™å˜é‡ï¼Œæˆ‘çš„ç†è§£æ˜¯è¡¨ç¤ºblockå†…éƒ¨çš„å˜é‡æ•°ã€‚</li>
<li><code>invoke</code>ï¼šå‡½æ•°æŒ‡é’ˆï¼ŒæŒ‡å‘å…·ä½“çš„blockå®ç°çš„å‡½æ•°è°ƒç”¨åœ°å€ã€‚</li>
<li><code>descriptor</code>ï¼šblockçš„é™„åŠ æè¿°ä¿¡æ¯ï¼Œæ¯”å¦‚ä¿ç•™å˜é‡æ•°ã€blockå¯¹è±¡çš„å¤§å°ã€è¿›è¡Œ<code>copy</code>æˆ–<code>dispose</code>çš„è¾…åŠ©å‡½æ•°æŒ‡é’ˆã€‚</li>
<li><code>variables</code>ï¼šå³æ•è·åˆ°çš„å˜é‡ï¼Œå› ä¸ºblockæœ‰é—­åŒ…æ€§ï¼Œæ‰€ä»¥å¯ä»¥è®¿é—®blockå¤–éƒ¨çš„å±€éƒ¨å˜é‡ã€‚è¿™äº›<code>variables</code>å°±æ˜¯å¤åˆ¶åˆ°ç»“æ„ä½“ä¸­çš„å¤–éƒ¨å±€éƒ¨å˜é‡æˆ–å˜é‡çš„åœ°å€ã€‚</li>
</ul>
<h4 id="å…¨å±€å—ã€æ ˆå—åŠå †å—"><a href="#å…¨å±€å—ã€æ ˆå—åŠå †å—" class="headerlink" title="å…¨å±€å—ã€æ ˆå—åŠå †å—"></a>å…¨å±€å—ã€æ ˆå—åŠå †å—</h4><ul>
<li>è™½ç„¶ block æ˜¯å¯¹è±¡ï¼Œä½†æ˜¯å…¶æ‰€å çš„å†…å­˜åŒºåŸŸæ˜¯åˆ†é…åœ¨<strong>æ ˆ</strong>ä¸­çš„ã€‚è¿™å°±æ˜¯è¯´ï¼Œå—åªåœ¨å®šä¹‰å®ƒçš„é‚£ä¸ªèŒƒå›´å†…æœ‰æ•ˆã€‚</li>
<li>ç»™ block å¯¹è±¡å‘é€ <code>copy</code> æ¶ˆæ¯å¯ä»¥æŠŠ Block ä»<strong>æ ˆ</strong>å¤åˆ¶åˆ°<strong>å †</strong>ã€‚æ‹·è´åçš„å—ï¼Œå¯ä»¥åœ¨å®šä¹‰å®ƒçš„é‚£ä¸ªèŒƒå›´ä¹‹å¤–ä½¿ç”¨ã€‚</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">void (^block)();</span><br><span class="line">if (/** condition */) &#123;</span><br><span class="line">    block = [^&#123;</span><br><span class="line">        NSLog(@&quot;Block A&quot;);</span><br><span class="line">    &#125; copy];</span><br><span class="line">&#125;else &#123;</span><br><span class="line">    block = [^&#123;</span><br><span class="line">        NSLog(@&quot;Block B&quot;);</span><br><span class="line">    &#125; copy];</span><br><span class="line">&#125;</span><br><span class="line">block();</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>å…¨å±€å—</strong>ï¼ˆglobal blockï¼‰ä¸ä¼šæ•æ‰ä»»ä½•çŠ¶æ€ï¼ˆæ¯”å¦‚å¤–å›´çš„å˜é‡ç­‰)ï¼Œè¿è¡Œæ—¶ä¹Ÿæ— é¡»æœ‰çŠ¶æ€æ¥å‚ä¸ã€‚å—æ‰€ä½¿ç”¨çš„æ•´ä¸ªå†…å­˜åŒºåŸŸï¼Œåœ¨ç¼–è¯‘æœŸå·²ç»å®Œå…¨ç¡®å®šäº†ï¼Œå› æ­¤ï¼Œå…¨å±€å—å¯ä»¥å£°æ˜åœ¨å…¨å±€å†…å­˜é‡Œï¼Œè€Œä¸éœ€è¦åœ¨æ¯æ¬¡ç”¨åˆ°çš„æ—¶å€™äºæ ˆä¸­åˆ›å»ºã€‚å¦å¤–ï¼Œå…¨å±€å—çš„æ‹·è´æ“ä½œæ˜¯ä¸ªç©ºæ“ä½œï¼Œå› ä¸ºå…¨å±€å—å†³ä¸å¯èƒ½ä¸ºç³»ç»Ÿæ‰€å›æ”¶ã€‚è¿™ç§å—å®é™…ä¸Šç›¸å½“äºå•ä¾‹ã€‚ä¸‹é¢å°±æ˜¯ä¸ªå…¨å±€å—ï¼š</li>
</ul>
<figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">void (^<span class="keyword">block) </span>() = ^&#123;</span><br><span class="line">	NSLog(@<span class="string">"This is a block"</span>)<span class="comment">;</span></span><br><span class="line">)ï¼›</span><br></pre></td></tr></table></figure>
<ul>
<li>å…¨å±€çš„é™æ€ blockï¼š <code>_NSConcreteGlobalBlock</code>ç±»å‹çš„blockè¦ä¹ˆæ˜¯ç©ºblockï¼Œè¦ä¹ˆæ˜¯ä¸è®¿é—®ä»»ä½•å¤–éƒ¨å˜é‡çš„blockã€‚å®ƒæ—¢ä¸åœ¨æ ˆä¸­ï¼Œä¹Ÿä¸åœ¨å †ä¸­ï¼Œæˆ‘ç†è§£ä¸ºå®ƒå¯èƒ½åœ¨å†…å­˜çš„å…¨å±€åŒºã€‚</li>
<li>ä¿å­˜åœ¨æ ˆä¸­çš„blockï¼š<code>_NSConcreteStackBlock</code>ç±»å‹çš„blockæœ‰é—­åŒ…è¡Œä¸ºï¼Œä¹Ÿå°±æ˜¯æœ‰è®¿é—®å¤–éƒ¨å˜é‡ï¼Œå¹¶ä¸”è¯¥blockåªä¸”åªæœ‰æœ‰ä¸€æ¬¡æ‰§è¡Œï¼Œå› ä¸ºæ ˆä¸­çš„ç©ºé—´æ˜¯å¯é‡å¤ä½¿ç”¨çš„ï¼Œæ‰€ä»¥å½“æ ˆä¸­çš„blockæ‰§è¡Œä¸€æ¬¡ä¹‹åå°±è¢«æ¸…é™¤å‡ºæ ˆäº†ï¼Œæ‰€ä»¥æ— æ³•å¤šæ¬¡ä½¿ç”¨ã€‚</li>
<li>ä¿å­˜åœ¨å †ä¸­çš„blockï¼š<code>_NSConcreteMallocBlock</code>ç±»å‹çš„blockæœ‰é—­åŒ…è¡Œä¸ºï¼Œå¹¶ä¸”è¯¥blockéœ€è¦è¢«å¤šæ¬¡æ‰§è¡Œã€‚å½“éœ€è¦å¤šæ¬¡æ‰§è¡Œæ—¶ï¼Œå°±ä¼šæŠŠè¯¥blockä»æ ˆä¸­å¤åˆ¶åˆ°å †ä¸­ï¼Œä¾›ä»¥å¤šæ¬¡æ‰§è¡Œã€‚</li>
</ul>
<h4 id="è¦ç‚¹"><a href="#è¦ç‚¹" class="headerlink" title="è¦ç‚¹"></a>è¦ç‚¹</h4><ul>
<li>Clang æ˜¯å¼€å‘ Mac OS X åŠ iOS ç¨‹åºæ‰€ç”¨çš„ç¼–è¯‘å™¨ã€‚</li>
<li>blockå— æ˜¯ Cã€C++ã€Objective-C ä¸­çš„è¯æ³•é—­åŒ…ã€‚</li>
<li>blockå— å¯æ¥æ”¶å‚æ•°ï¼Œä¹Ÿå¯è¿”å›å€¼ã€‚</li>
<li>blockå— å¯ä»¥åˆ†é…åœ¨æ ˆæˆ–å †ä¸Šï¼Œä¹Ÿå¯ä»¥æ˜¯å…¨å±€çš„ã€‚åˆ†é…åœ¨æ ˆä¸Šçš„ blockå— å¯æ‹·è´åˆ°å †é‡Œï¼Œè¿™æ ·çš„è¯ï¼Œå°±å’Œæ ‡å‡†çš„Objective-Cå¯¹è±¡ä¸€æ ·ï¼Œå…·å¤‡å¼•ç”¨è®¡æ•°äº†ã€‚</li>
</ul>
<h3 id="ç¬¬38æ¡ï¼šä¸ºå¸¸ç”¨çš„å—ç±»å‹åˆ›å»º-typedef"><a href="#ç¬¬38æ¡ï¼šä¸ºå¸¸ç”¨çš„å—ç±»å‹åˆ›å»º-typedef" class="headerlink" title="ç¬¬38æ¡ï¼šä¸ºå¸¸ç”¨çš„å—ç±»å‹åˆ›å»º typedef"></a>ç¬¬38æ¡ï¼šä¸ºå¸¸ç”¨çš„å—ç±»å‹åˆ›å»º typedef</h3><p>ä»£ç å—ä¾¿æ·å†™æ³•ï¼š<code>typedefBlock</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">typedef &lt;#returnType#&gt;(^&lt;#name#&gt;)(&lt;#arguments#&gt;);</span><br></pre></td></tr></table></figure>
<p>ç¤ºä¾‹ä¸€ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">// å®šä¹‰ Block å—</span><br><span class="line">typedef int(^EOCSomeBlock)(BOOL flag, int value);</span><br><span class="line"></span><br><span class="line">// ä½¿ç”¨ Block å—</span><br><span class="line">EOCSomeBlock blcok = ^(BOOL flag, int value) &#123;</span><br><span class="line">    // Implementation</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>ç¤ºä¾‹äºŒï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">typedef void(^EOCCompletionHandler)(NSData *data, NSError *error);</span><br><span class="line"></span><br><span class="line">// æ–¹æ³•ä½¿ç”¨ Blockå— ä½œä¸ºå‚æ•°</span><br><span class="line">- (void)startingWithCompletionHandler:(EOCCompletionHandler)completion;</span><br></pre></td></tr></table></figure>
<p>â‡ï¸ ä½¿ç”¨ <strong>typedef</strong> ç±»å‹å®šä¹‰è¿˜ä¾¿äºé‡æ„ block çš„ç±»å‹ç­¾åã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">// æ–°å¢ä¸€ä¸ªå‚æ•°ï¼Œç”¨ä»¥è¡¨ç¤ºå®Œæˆä»»åŠ¡æ‰€èŠ±çš„æ—¶é—´</span><br><span class="line">typedef void(^EOCCompletionHandler)</span><br><span class="line">        (NSData *data, NSTimeInterval duration, NSError *error);</span><br></pre></td></tr></table></figure>
<h4 id="è¦ç‚¹-1"><a href="#è¦ç‚¹-1" class="headerlink" title="è¦ç‚¹"></a>è¦ç‚¹</h4><ul>
<li>ä»¥ <strong>typedef</strong> é‡æ–°å®šä¹‰ block ç±»å‹ï¼Œå¯ä»¥ä»¤ block å˜é‡ç”¨èµ·æ¥æ›´åŠ ç®€å•ã€‚</li>
<li>å®šä¹‰æ–°ç±»å‹æ—¶åº”éµå¾ªç°æœ‰çš„å‘½åä¹ æƒ¯ï¼Œå‹¿ä½¿å…¶åç§°ä¸åˆ«çš„çš„ç±»å‹ç›¸å†²çªã€‚</li>
<li>ä¸å¦¨ä¸ºåŒä¸€ä¸ª block ç­¾åå®šä¹‰å¤šä¸ªç±»å‹åˆ«åã€‚å¦‚æœè¦é‡æ„çš„ä»£ç ä½¿ç”¨äº† block ç±»å‹çš„æŸä¸ªåˆ«åï¼Œé‚£ä¹ˆåªéœ€ä¿®æ”¹ç›¸åº”çš„ <strong>typedef</strong> ä¸­çš„ block ç­¾åå³å¯ï¼Œæ— éœ€æ”¹åŠ¨å…¶ä»– <strong>typedef</strong>ã€‚</li>
</ul>
<h3 id="ç¬¬39æ¡ï¼šç”¨-handler-å—é™ä½ä»£ç åˆ†æ•£ç¨‹åº¦"><a href="#ç¬¬39æ¡ï¼šç”¨-handler-å—é™ä½ä»£ç åˆ†æ•£ç¨‹åº¦" class="headerlink" title="ç¬¬39æ¡ï¼šç”¨ handler å—é™ä½ä»£ç åˆ†æ•£ç¨‹åº¦"></a>ç¬¬39æ¡ï¼šç”¨ handler å—é™ä½ä»£ç åˆ†æ•£ç¨‹åº¦</h3><p>ä¸ºç”¨æˆ·ç•Œé¢ç¼–ç æ—¶ï¼Œä¸€ç§å¸¸ç”¨çš„èŒƒå¼å°±æ˜¯â€œå¼‚æ­¥æ‰§è¡Œä»»åŠ¡â€ï¼ˆperform task asynchronously)ã€‚è¿™ç§èŒƒå¼çš„å¥½å¤„åœ¨äºï¼šå¤„ç†ç”¨æˆ·ç•Œé¢çš„æ˜¾ç¤ºåŠè§¦æ‘¸æ“ä½œæ‰€ç”¨çš„çº¿ç¨‹ï¼Œä¸ä¼šå› ä¸ºè¦æ‰§è¡ŒI/Oæˆ–ç½‘ç»œé€šä¿¡è¿™ç±»è€—æ—¶çš„ä»»åŠ¡è€Œé˜»å¡ã€‚è¿™ä¸ªçº¿ç¨‹é€šå¸¸ç§°ä¸ºä¸»çº¿ç¨‹ï¼ˆmain thread)ã€‚</p>
<p>å¼‚æ­¥æ–¹æ³•åœ¨æ‰§è¡Œå®Œä»»åŠ¡ä¹‹åï¼Œéœ€è¦ä»¥æŸç§æ‰‹æ®µé€šçŸ¥ç›¸å…³ä»£ç ã€‚å®ç°æ­¤åŠŸèƒ½æœ‰å¾ˆå¤šåŠæ³•ã€‚å¸¸ç”¨çš„æŠ€å·§æ˜¯è®¾è®¡ä¸€ä¸ªå§”æ‰˜åè®®ï¼ˆå‚è§ç¬¬23æ¡)ï¼Œä»¤å…³æ³¨æ­¤äº‹ä»¶çš„å¯¹è±¡éµä»è¯¥åè®®ã€‚å¯¹è±¡æˆä¸ºdelegateä¹‹åï¼Œå°±å¯ä»¥åœ¨ç›¸å…³äº‹ä»¶å‘ç”Ÿæ—¶ï¼ˆä¾‹å¦‚æŸä¸ªå¼‚æ­¥ä»»åŠ¡æ‰§è¡Œå®Œæ¯•æ—¶ï¼‰å¾—åˆ°é€šçŸ¥äº†ã€‚</p>
<p><strong>Delegate</strong> æ¨¡å¼ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">#import &lt;Foundation/Foundation.h&gt;</span><br><span class="line">@class EOCNetworkFetcher;</span><br><span class="line"></span><br><span class="line">@protocol EOCNetworkFetcherDelegate &lt;NSObject&gt;</span><br><span class="line">- (void)networkFetcher:(EOCNetworkFetcher *)fetcher</span><br><span class="line">        didFinishWithData:(NSData *)data;</span><br><span class="line">@end</span><br><span class="line"></span><br><span class="line">@interface EOCNetworkFetcher : NSObject</span><br><span class="line">@property (nonatomic, weak) id&lt;EOCNetworkFetcherDelegate&gt; delegate;</span><br><span class="line">- (instancetype)initWithURL:(NSURL *)url;</span><br><span class="line">- (void)start;</span><br><span class="line">@end</span><br><span class="line"></span><br><span class="line">// å…¶ä»–ç±»å®ç° delegate åè®®ï¼š</span><br><span class="line">- (void)fetchFooData &#123;</span><br><span class="line">    NSURL *url = [[NSURL alloc] initWithString:</span><br><span class="line">                  @&quot;https://www.pinterest.com&quot;];</span><br><span class="line">    EOCNetworkFetcher *fetcher =</span><br><span class="line">        [[EOCNetworkFetcher alloc] initWithURL:url];</span><br><span class="line">    fetcher.delegate = self;</span><br><span class="line">    [fetcher start];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (void)networkFetcher:(EOCNetworkFetcher *)fetcher didFinishWithData:(NSData *)data &#123;</span><br><span class="line">    // deal with data</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>block</strong> æ¨¡å¼ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">#import &lt;Foundation/Foundation.h&gt;</span><br><span class="line"></span><br><span class="line">typedef void(^EOCNetworkFetcherCompletionHandler)(NSData *data);</span><br><span class="line"></span><br><span class="line">@interface EOCNetworkFetcher : NSObject</span><br><span class="line">- (instancetype)initWithURL:(NSURL *)url;</span><br><span class="line">- (void)startWithCompletionHandler:</span><br><span class="line">            (EOCNetworkFetcherCompletionHandler)handler;</span><br><span class="line">@end</span><br><span class="line">  </span><br><span class="line">// å…¶ä»–ç±»è·å–æ•°æ®ï¼š</span><br><span class="line">- (void)fetchFooData &#123;</span><br><span class="line">    NSURL *url = [[NSURL alloc] initWithString:</span><br><span class="line">                  @&quot;https://www.pinterest.com&quot;];</span><br><span class="line">    EOCNetworkFetcher *fetcher =</span><br><span class="line">        [[EOCNetworkFetcher alloc] initWithURL:url];</span><br><span class="line">    // è°ƒç”¨ start æ–¹æ³•æ—¶ç›´æ¥ä»¥å†…è”å½¢å¼å®šä¹‰ Completion Handlerã€‚</span><br><span class="line">    [fetcher startWithCompletionHandler:^(NSData *data) &#123;</span><br><span class="line">        // deal with data</span><br><span class="line">    &#125;];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>â‡ï¸ç›¸æ¯”äºå§”æ‰˜æ¨¡å¼ï¼Œblock å¯ä»¥ä½¿ä»£ç æ›´æ¸…æ™°æ•´æ´ã€API æ›´ç´§è‡´ã€é€»è¾‘å…³è”æ€§æ›´å¼ºã€‚</p>
<p>å§”æ‰˜æ¨¡å¼æœ‰ä¸ªç¼ºç‚¹ï¼šå¦‚æœç±»è¦åˆ†åˆ«ä½¿ç”¨å¤šä¸ªè·å–å™¨ä¸‹è½½ä¸åŒæ•°æ®ï¼Œé‚£ä¹ˆå°±å¾—åœ¨ delegate å›è°ƒæ–¹æ³•é‡Œæ ¹æ®ä¼ å…¥çš„è·å–å™¨å‚æ•°æ¥åˆ‡æ¢ã€‚</p>
<p>è€Œä½¿ç”¨ block æ¥å†™çš„å¥½å¤„æ˜¯ï¼šæ— é¡»ä¿å­˜è·å–å™¨ï¼Œä¹Ÿæ— é¡»åœ¨å›è°ƒæ–¹æ³•é‡Œåˆ‡æ¢ã€‚æ¯ä¸ªcompletion handlerçš„ä¸šåŠ¡é€»è¾‘éƒ½æ˜¯å’Œç›¸å…³çš„è·å–å™¨å¯¹è±¡ä¸€èµ·æ¥å®šä¹‰çš„ã€‚</p>
<h4 id="1-åˆ†åˆ«ç”¨ä¸¤ä¸ªå¤„ç†ç¨‹åºæ¥å¤„ç†æ“ä½œå¤±è´¥å’Œæ“ä½œæˆåŠŸ"><a href="#1-åˆ†åˆ«ç”¨ä¸¤ä¸ªå¤„ç†ç¨‹åºæ¥å¤„ç†æ“ä½œå¤±è´¥å’Œæ“ä½œæˆåŠŸ" class="headerlink" title="1. åˆ†åˆ«ç”¨ä¸¤ä¸ªå¤„ç†ç¨‹åºæ¥å¤„ç†æ“ä½œå¤±è´¥å’Œæ“ä½œæˆåŠŸ"></a>1. åˆ†åˆ«ç”¨ä¸¤ä¸ªå¤„ç†ç¨‹åºæ¥å¤„ç†æ“ä½œå¤±è´¥å’Œæ“ä½œæˆåŠŸ</h4><p>è¿™ç§APIè®¾è®¡é£æ ¼å¾ˆå¥½ï¼Œç”±äºæˆåŠŸå’Œå¤±è´¥çš„æƒ…å†µè¦åˆ†åˆ«å¤„ç†ï¼Œæ‰€ä»¥è°ƒç”¨æ­¤APIçš„ä»£ç ä¹Ÿå°±ä¼šæŒ‰ç…§é€»è¾‘ï¼ŒæŠŠåº”å¯¹æˆåŠŸå’Œå¤±è´¥æƒ…å†µçš„ä»£ç åˆ†å¼€æ¥å†™ï¼Œè¿™å°†ä»¤ä»£ç æ›´æ˜“è¯»æ‡‚ã€‚è€Œä¸”ï¼Œè‹¥æœ‰éœ€è¦ï¼Œè¿˜å¯ä»¥æŠŠå¤„ç†å¤±è´¥æƒ…å†µæˆ–æˆåŠŸæƒ…å†µæ‰€ç”¨çš„ä»£ç çœç•¥ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">#import &lt;Foundation/Foundation.h&gt;</span><br><span class="line"></span><br><span class="line">typedef void(^EOCNetworkFetcherCompletionHandler)(NSData *data);</span><br><span class="line">typedef void(^EOCNetworkFetcherErrorHandler)(NSError *error);</span><br><span class="line"></span><br><span class="line">@interface EOCNetworkFetcher : NSObject</span><br><span class="line">- (instancetype)initWithURL:(NSURL *)url;</span><br><span class="line">- (void)startWithCompletionHandler:</span><br><span class="line">            (EOCNetworkFetcherCompletionHandler)handler</span><br><span class="line">                    failureHandler:</span><br><span class="line">            (EOCNetworkFetcherErrorHandler)failure;</span><br><span class="line">@end</span><br><span class="line"></span><br><span class="line">// å…¶ä»–ç±»ä½¿ç”¨ï¼š</span><br><span class="line">- (void)fetchFooData &#123;</span><br><span class="line">    NSURL *url = [[NSURL alloc] initWithString:</span><br><span class="line">                  @&quot;https://www.pinterest.com&quot;];</span><br><span class="line">    EOCNetworkFetcher *fetcher =</span><br><span class="line">        [[EOCNetworkFetcher alloc] initWithURL:url];</span><br><span class="line">    [fetcher startWithCompletionHandler:^(NSData *data) &#123;</span><br><span class="line">        // deal with data</span><br><span class="line">        </span><br><span class="line">    &#125; failureHandler:^(NSError *error) &#123;</span><br><span class="line">        // deal with error</span><br><span class="line">        </span><br><span class="line">    &#125;];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="2-æŠŠå¤„ç†å¤±è´¥æ‰€éœ€ä»£ç ä¸å¤„ç†æˆåŠŸæ‰€ç”¨ä»£ç ï¼Œéƒ½å°è£…åˆ°åŒä¸€ä¸ª-completion-handle-å—é‡Œ"><a href="#2-æŠŠå¤„ç†å¤±è´¥æ‰€éœ€ä»£ç ä¸å¤„ç†æˆåŠŸæ‰€ç”¨ä»£ç ï¼Œéƒ½å°è£…åˆ°åŒä¸€ä¸ª-completion-handle-å—é‡Œ" class="headerlink" title="2. æŠŠå¤„ç†å¤±è´¥æ‰€éœ€ä»£ç ä¸å¤„ç†æˆåŠŸæ‰€ç”¨ä»£ç ï¼Œéƒ½å°è£…åˆ°åŒä¸€ä¸ª completion handle å—é‡Œ"></a>2. æŠŠå¤„ç†å¤±è´¥æ‰€éœ€ä»£ç ä¸å¤„ç†æˆåŠŸæ‰€ç”¨ä»£ç ï¼Œéƒ½å°è£…åˆ°åŒä¸€ä¸ª completion handle å—é‡Œ</h5><p>ç¼ºç‚¹ï¼šç”±äºå…¨éƒ¨é€»è¾‘éƒ½å†™åœ¨ä¸€èµ·ï¼Œå¯¼è‡´å—ä»£ç å†—é•¿å¤æ‚ã€‚</p>
<p>ä¼˜ç‚¹ï¼šèƒ½æŠŠæ‰€æœ‰ä¸šåŠ¡é€»è¾‘éƒ½æ”¾åœ¨ä¸€èµ·ä½¿å…¶æ›´åŠ çµæ´»ã€‚ä¾‹å¦‚ï¼Œåœ¨ä¼ å…¥é”™è¯¯ä¿¡æ¯æ—¶ï¼Œå¯ä»¥æŠŠæ•°æ®ä¹Ÿä¼ è¿›æ¥ã€‚æœ‰æ—¶æ•°æ®æ­£ä¸‹è½½åˆ°ä¸€åŠï¼Œçªç„¶ç½‘ç»œæ•…éšœäº†ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¯ä»¥æŠŠæ•°æ®åŠç›¸å…³çš„é”™è¯¯éƒ½å›ä¼ ç»™å—ã€‚è¿™æ ·çš„è¯ï¼Œcompletion handler å°±èƒ½æ®æ­¤åˆ¤æ–­é—®é¢˜å¹¶é€‚å½“å¤„ç†äº†ï¼Œè€Œä¸”è¿˜å¯åˆ©ç”¨å·²ä¸‹è½½å¥½çš„è¿™éƒ¨åˆ†æ•°æ®åšäº›äº‹æƒ…ã€‚</p>
<p>æ€»ä½“æ¥è¯´ï¼Œç¬”è€…å»ºè®®ä½¿ç”¨åŒä¸€ä¸ªå—æ¥å¤„ç†æˆåŠŸä¸å¤±è´¥æƒ…å†µã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">#import &lt;Foundation/Foundation.h&gt;</span><br><span class="line"></span><br><span class="line">typedef void(^EOCNetworkFetcherCompletionHandler)</span><br><span class="line">                                (NSData *data, NSError *error);</span><br><span class="line"></span><br><span class="line">@interface EOCNetworkFetcher : NSObject</span><br><span class="line">- (instancetype)initWithURL:(NSURL *)url;</span><br><span class="line">- (void)startWithCompletionHandler:</span><br><span class="line">            (EOCNetworkFetcherCompletionHandler)handler;</span><br><span class="line">@end</span><br><span class="line"></span><br><span class="line">// å…¶ä»–ç±»ä½¿ç”¨ï¼š</span><br><span class="line">- (void)fetchFooData &#123;</span><br><span class="line">    NSURL *url = [[NSURL alloc] initWithString:</span><br><span class="line">                  @&quot;https://www.pinterest.com&quot;];</span><br><span class="line">    EOCNetworkFetcher *fetcher =</span><br><span class="line">        [[EOCNetworkFetcher alloc] initWithURL:url];</span><br><span class="line">    // éœ€è¦åœ¨å—ä»£ç ä¸­æ£€æµ‹ä¼ äººçš„errorå˜é‡ï¼Œå¹¶ä¸”è¦æŠŠæ‰€æœ‰é€»è¾‘ä»£ç éƒ½æ”¾åœ¨ä¸€å¤„</span><br><span class="line">    [fetcher startWithCompletionHandler:^(NSData *data, NSError *error) &#123;</span><br><span class="line">        if (error) &#123;</span><br><span class="line">            // handle failure</span><br><span class="line">        &#125;else &#123;</span><br><span class="line">            // handle success</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åŸºäº handler æ¥è®¾è®¡APIè¿˜æœ‰ä¸ªåŸå› ï¼Œå°±æ˜¯æŸäº›ä»£ç å¿…é¡»è¿è¡Œåœ¨ç‰¹å®šçš„çº¿ç¨‹ä¸Šï¼Œæ¯”å¦‚ï¼ŒCocoa ä¸ Cocoa Touch ä¸­çš„ UI æ“ä½œå¿…é¡»åœ¨ä¸»çº¿ç¨‹ä¸Šæ‰§è¡Œï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">// NSNotificationCenter</span><br><span class="line">- (id &lt;NSObject&gt;)addObserverForName:(nullable NSNotificationName)name</span><br><span class="line">                             object:(nullable id)obj</span><br><span class="line">                              queue:(nullable NSOperationQueue *)queue</span><br><span class="line">                         usingBlock:(void (^)(NSNotification *note))block;</span><br></pre></td></tr></table></figure>
<h4 id="è¦ç‚¹-2"><a href="#è¦ç‚¹-2" class="headerlink" title="è¦ç‚¹"></a>è¦ç‚¹</h4><ul>
<li>åœ¨åˆ›å»ºå¯¹è±¡æ—¶ï¼Œä½¿ç”¨å†…è”çš„ handler å—å°†ç›¸å…³ä¸šåŠ¡é€»è¾‘ä¸€å¹¶å£°æ˜ã€‚</li>
<li>åœ¨æœ‰å¤šä¸ªå®ä¾‹éœ€è¦ç›‘æ§æ—¶ï¼Œå¦‚æœé‡‡ç”¨å§”æ‰˜æ¨¡å¼ï¼Œé‚£ä¹ˆç»å¸¸éœ€è¦æ ¹æ®ä¼ å…¥çš„å¯¹è±¡æ¥åˆ‡æ¢ï¼Œè€Œè‹¥æ”¹ç”¨ handler å—æ¥å®ç°ï¼Œåˆ™å¯ç›´æ¥å°† block ä¸ç›¸å…³å¯¹è±¡æ”¾åœ¨ä¸€èµ·ã€‚</li>
<li>è®¾è®¡ API æ—¶å¦‚æœç”¨åˆ°äº† handler å—ï¼Œé‚£ä¹ˆå¯ä»¥å¢åŠ ä¸€ä¸ªå‚æ•°ï¼Œä½¿è°ƒç”¨è€…å¯é€šè¿‡æ­¤å‚æ•°æ¥å†³å®šåº”è¯¥æŠŠ block å®‰æ’åœ¨å“ªä¸ªé˜Ÿåˆ—ä¸Šæ‰§è¡Œã€‚</li>
</ul>
<h3 id="ç¬¬40æ¡ï¼šç”¨å—å¼•ç”¨å…¶æ‰€å±å¯¹è±¡æ—¶ä¸è¦å‡ºç°ä¿ç•™ç¯"><a href="#ç¬¬40æ¡ï¼šç”¨å—å¼•ç”¨å…¶æ‰€å±å¯¹è±¡æ—¶ä¸è¦å‡ºç°ä¿ç•™ç¯" class="headerlink" title="ç¬¬40æ¡ï¼šç”¨å—å¼•ç”¨å…¶æ‰€å±å¯¹è±¡æ—¶ä¸è¦å‡ºç°ä¿ç•™ç¯"></a>ç¬¬40æ¡ï¼šç”¨å—å¼•ç”¨å…¶æ‰€å±å¯¹è±¡æ—¶ä¸è¦å‡ºç°ä¿ç•™ç¯</h3><p>ä½¿ç”¨ block å¾ˆå®¹æ˜“å¯¼è‡´å¾ªç¯å¼•ç”¨ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line">//  EOCNetworkFetcher.h</span><br><span class="line">#import &lt;Foundation/Foundation.h&gt;</span><br><span class="line"></span><br><span class="line">typedef void(^EOCNetworkFetcherCompletionHandler)</span><br><span class="line">                                (NSData *data);</span><br><span class="line"></span><br><span class="line">@interface EOCNetworkFetcher : NSObject</span><br><span class="line">@property (nonatomic, strong, readonly) NSURL *url;</span><br><span class="line">- (instancetype)initWithURL:(NSURL *)url;</span><br><span class="line">- (void)startWithCompletionHandler:</span><br><span class="line">            (EOCNetworkFetcherCompletionHandler)completion;</span><br><span class="line">@end</span><br><span class="line"></span><br><span class="line">//  EOCNetworkFetcher.m</span><br><span class="line">#import &quot;EOCNetworkFetcher.h&quot;</span><br><span class="line"></span><br><span class="line">@interface EOCNetworkFetcher ()</span><br><span class="line">@property (nonatomic, strong, readwrite) NSURL *url;</span><br><span class="line">@property (nonatomic, copy)</span><br><span class="line">            EOCNetworkFetcherCompletionHandler completionHandler;</span><br><span class="line">@property (nonatomic, strong) NSData *downloadData;</span><br><span class="line">@end</span><br><span class="line"></span><br><span class="line">@implementation EOCNetworkFetcher</span><br><span class="line"></span><br><span class="line">- (instancetype)initWithURL:(NSURL *)url &#123;</span><br><span class="line">    if (self = [super init]) &#123;</span><br><span class="line">        _url = url;</span><br><span class="line">    &#125;</span><br><span class="line">    return self;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (void)startWithCompletionHandler:</span><br><span class="line">        (EOCNetworkFetcherCompletionHandler)completion &#123;</span><br><span class="line">    self.completionHandler = completion;</span><br><span class="line">    // å¼€å¯ç½‘ç»œè¯·æ±‚</span><br><span class="line">    // è®¾ç½® downloadData å±æ€§</span><br><span class="line">    // ä¸‹è½½å®Œæˆåï¼Œä»¥å›è°ƒæ–¹å¼æ‰§è¡Œ Block</span><br><span class="line">    [self p_requestCompleted];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// ä¸ºäº†èƒ½åœ¨ä¸‹è½½å®Œæˆåé€šè¿‡ p_requestCompleted æ–¹æ³•æ‰§è¡Œè°ƒç”¨è€…æ‰€æŒ‡å®šçš„å—ï¼Œ</span><br><span class="line">// éœ€è¦æŠŠ completion handler ä¿å­˜åˆ°å®ä¾‹å˜é‡</span><br><span class="line">// â‡ï¸ _networkFetcher â†’ _completionHandler</span><br><span class="line">- (void)p_requestCompleted &#123;</span><br><span class="line">    if (_completionHandler) &#123;</span><br><span class="line">        _completionHandler(_downloadData);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@end</span><br><span class="line"></span><br><span class="line">// æŸä¸ªç±»å¯èƒ½ä¼šåˆ›å»ºä»¥ä¸Šç½‘ç»œæ•°æ®è·å–å™¨å¯¹è±¡ï¼Œå¹¶ç”¨å…¶ä»URLä¸­ä¸‹è½½æ•°æ®ï¼š</span><br><span class="line">@implementation EOCDataModel &#123;</span><br><span class="line">    // â‡ï¸ EOCDataModel â†’ _networkFetcher</span><br><span class="line">    EOCNetworkFetcher *_networkFetcher;</span><br><span class="line">    NSData *_fetchedData;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (void)downloadData &#123;</span><br><span class="line">    NSURL *url = [[NSURL alloc] initWithString:@&quot;http://www.example.com&quot;];</span><br><span class="line">    _networkFetcher = [[EOCNetworkFetcher alloc] initWithURL:url];</span><br><span class="line">    [_networkFetcher startWithCompletionHandler:^(NSData *data) &#123;</span><br><span class="line">        </span><br><span class="line">        NSLog(@&quot;Request URL %@ finished&quot;,_networkFetcher.url);</span><br><span class="line">        // å› ä¸º completion handler å—è¦è®¾ç½® _fetchedData å®ä¾‹å˜é‡,æ‰€ä»¥å®ƒå¿…é¡»æ•è· self å˜é‡ï¼Œè€Œ self æŒ‡å‘ EOCDataModel ç±»</span><br><span class="line">        // â‡ï¸ _completionHandler â†’ EOCDataModel</span><br><span class="line">        _fetchedData = data;</span><br><span class="line">      </span><br><span class="line">        // ğŸ’¡ç­‰ completion handler å—æ‰§è¡Œå®Œæ¯•åï¼Œå†æ‰“ç ´ä¿ç•™ç¯ï¼Œä»¥ä¾¿ä½¿è·å–å™¨å¯¹è±¡åœ¨handler å—æ‰§è¡ŒæœŸé—´ä¿æŒå­˜æ´»çŠ¶æ€ã€‚</span><br><span class="line">        _networkFetcher = nil;</span><br><span class="line">    &#125;];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>é—®é¢˜ï¼š</p>
<ul>
<li>åœ¨ä¸Šä¾‹ä¸­ï¼Œå”¯æœ‰ completion handler è¿è¡Œè¿‡åï¼Œæ–¹èƒ½è§£é™¤ä¿ç•™ç¯ã€‚è‹¥æ˜¯completion handlerâ€”ç›´ä¸è¿è¡Œï¼Œé‚£ä¹ˆä¿ç•™ç¯å°±æ— æ³•æ‰“ç ´ï¼Œäºæ˜¯å†…å­˜å°±ä¼šæ³„æ¼ã€‚</li>
<li>å¦‚æœ completion handler å—æ‰€å¼•ç”¨çš„å¯¹è±¡æœ€ç»ˆåˆå¼•ç”¨äº†è¿™ä¸ªå—æœ¬èº«ï¼Œé‚£ä¹ˆå°±ä¼šå‡ºç°ä¿ç•™ç¯ã€‚</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">- (void)downloadData &#123;</span><br><span class="line">    NSURL *url = [[NSURL alloc] initWithString:</span><br><span class="line">                  @&quot;http://www.example.com&quot;];</span><br><span class="line">    EOCNetworkFetcher *networkFetcher = [[EOCNetworkFetcher alloc] initWithURL:url];</span><br><span class="line">    [networkFetcher startWithCompletionHandler:^(NSData *data) &#123;</span><br><span class="line">        // completionHandler â†’ networkFetcher.url</span><br><span class="line">        // networkFetcher â†’ completionHandler</span><br><span class="line">        NSLog(@&quot;Request URL %@ finished&quot;,networkFetcher.url);</span><br><span class="line">        _fetchedData = data;</span><br><span class="line">    &#125;];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è§£å†³æ–¹æ³•ï¼šè·å–å™¨å¯¹è±¡ä¹‹æ‰€ä»¥è¦æŠŠ completion handler å—ä¿å­˜åœ¨å±æ€§é‡Œé¢ï¼Œå…¶å”¯ä¸€ç›®çš„å°±æ˜¯æƒ³ç¨åä½¿ç”¨è¿™ä¸ªå—ã€‚å¯æ˜¯ï¼Œè·å–å™¨ä¸€æ—¦è¿è¡Œè¿‡ completion handler ä¹‹åï¼Œå°±æ²¡æœ‰å¿…è¦å†ä¿ç•™å®ƒäº†ã€‚æ‰€ä»¥ï¼Œåªéœ€å°† <code>p_requestCompleted</code> æ–¹æ³•æŒ‰å¦‚ä¸‹æ–¹å¼ä¿®æ”¹å³å¯ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">- (void)p_requestCompleted &#123;</span><br><span class="line">    if (_completionHandler) &#123;</span><br><span class="line">        _completionHandler(_downloadData);</span><br><span class="line">    &#125;</span><br><span class="line">    self.completionHandler = nil; // â‡ï¸</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¦æƒ³æ¸…æ¥šå—å¯èƒ½ä¼šæ•è·å¹¶ä¿ç•™å“ªäº›å¯¹ è±¡ã€‚å¦‚æœè¿™äº›å¯¹è±¡åˆç›´æ¥æˆ–é—´æ¥ä¿ç•™äº†å—ï¼Œé‚£ä¹ˆå°±è¦è€ƒè™‘æ€æ ·åœ¨é€‚å½“çš„æ—¶æœºè§£é™¤ä¿ç•™ç¯ã€‚</p>
<h4 id="è¦ç‚¹-3"><a href="#è¦ç‚¹-3" class="headerlink" title="è¦ç‚¹"></a>è¦ç‚¹</h4><ul>
<li>å¦‚æœ block æ‰€æ•è·çš„å¯¹è±¡ç›´æ¥æˆ–é—´æ¥çš„ä¿ç•™äº† block æœ¬èº«ï¼Œé‚£ä¹ˆå°±å¾—å½“å¿ƒå¾ªç¯å¼•ç”¨çš„é—®é¢˜ã€‚</li>
<li>ä¸€å®šè¦æ‰¾ä¸ªé€‚å½“çš„æ—¶æœºè§£é™¤å¾ªç¯å¼•ç”¨ï¼Œè€Œä¸èƒ½æŠŠè´£ä»»æ¨ç»™ API çš„è°ƒç”¨è€…ã€‚</li>
</ul>
<h3 id="ç¬¬41æ¡ï¼šå¤šç”¨æ´¾å‘é˜Ÿåˆ—ï¼Œå°‘ç”¨åŒæ­¥é”"><a href="#ç¬¬41æ¡ï¼šå¤šç”¨æ´¾å‘é˜Ÿåˆ—ï¼Œå°‘ç”¨åŒæ­¥é”" class="headerlink" title="ç¬¬41æ¡ï¼šå¤šç”¨æ´¾å‘é˜Ÿåˆ—ï¼Œå°‘ç”¨åŒæ­¥é”"></a>ç¬¬41æ¡ï¼šå¤šç”¨æ´¾å‘é˜Ÿåˆ—ï¼Œå°‘ç”¨åŒæ­¥é”</h3><p>ä½¿ç”¨åŒæ­¥é”å®ç°åŒæ­¥æœºåˆ¶ï¼š</p>
<ol>
<li><p><strong>@synchronized</strong> åŒæ­¥å—ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">- (void)synchronizedMethod &#123;</span><br><span class="line">    @synchronized (self) &#123;</span><br><span class="line">        // ...</span><br><span class="line">        // æ ¹æ®ç»™å®šå¯¹è±¡ï¼Œè‡ªåŠ¨åˆ›å»ºä¸€ä¸ªé”ï¼Œå¹¶ç­‰å¾…å—ä¸­çš„ä»£ç æ‰§è¡Œå®Œæ¯•ã€‚</span><br><span class="line">        // æ»¥ç”¨ @synchronized (self) ä¼šé™ä½ä»£ç æ•ˆç‡</span><br><span class="line">        </span><br><span class="line">    &#125;   // æ‰§è¡Œåˆ°è¿™æ®µä»£ç ç»“å°¾å¤„ï¼Œé‡Šæ”¾é”ã€‚</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>NSRecursiveLock</strong> é€’å½’é”</p>
<ul>
<li>çº¿ç¨‹èƒ½å¤Ÿå¤šæ¬¡æŒæœ‰è¯¥é”ï¼Œ è€Œä¸ä¼šå‡ºç°æ­»é”ï¼ˆdeadlock)ç°è±¡ã€‚</li>
<li>åœ¨æç«¯æƒ…å†µä¸‹ï¼ŒåŒæ­¥å—ä¼šå¯¼è‡´æ­»é”ã€‚</li>
</ul>
</li>
</ol>
<h4 id="GCDï¼šä¸²è¡Œå¹¶å‘é˜Ÿåˆ—"><a href="#GCDï¼šä¸²è¡Œå¹¶å‘é˜Ÿåˆ—" class="headerlink" title="GCDï¼šä¸²è¡Œå¹¶å‘é˜Ÿåˆ—"></a>GCDï¼šä¸²è¡Œå¹¶å‘é˜Ÿåˆ—</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">@implementation HQLBlockObject &#123;</span><br><span class="line">    dispatch_queue_t _syncQueue;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">    // è‡ªå®šä¹‰å¹¶å‘é˜Ÿåˆ—</span><br><span class="line">    // âš ï¸æ³¨æ„åˆ°ï¼Œæ–‡ç« ä¸­æ­¤å¤„ä½œè€…ä½¿ç”¨çš„æ˜¯å…¨å±€å¹¶å‘é˜Ÿåˆ—ï¼Œè€Œåœ¨ Ray Wenderlich çš„GCDç³»åˆ—æ•™ç¨‹ä¸­ä½¿ç”¨çš„æ˜¯è‡ªå®šä¹‰å¹¶å‘é˜Ÿåˆ—ï¼šåŸå› åœ¨äºï¼šå…¨å±€é˜Ÿåˆ—ä¸­è¿˜å¯èƒ½æœ‰å…¶ä»–ä»»åŠ¡æ­£åœ¨æ‰§è¡Œï¼Œä¸€æ—¦åŠ é”å°±ä¼šé˜»å¡å…¶ä»–ä»»åŠ¡çš„æ­£å¸¸æ‰§è¡Œï¼Œå› æ­¤æˆ‘ä»¬å¼€è¾Ÿä¸€ä¸ªæ–°çš„è‡ªå®šä¹‰å¹¶å‘é˜Ÿåˆ—ä¸“é—¨å¤„ç†è¿™ä¸ªé—®é¢˜ã€‚</span><br><span class="line">    _syncQueue = dispatch_queue_create(&quot;com.effectiveobjectivec.syncQueue&quot;, DISPATCH_QUEUE_CONCURRENT);</span><br><span class="line"></span><br><span class="line">- (NSString *)someString &#123;</span><br><span class="line">    __block NSString *localSomeString;</span><br><span class="line">    dispatch_sync(_syncQueue, ^&#123;</span><br><span class="line">        localSomeString = _someString;</span><br><span class="line">    &#125;);</span><br><span class="line">    return localSomeString;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (void)setSomeString:(NSString *)someString &#123;</span><br><span class="line">    dispatch_barrier_async(_syncQueue, ^&#123;</span><br><span class="line">        _someString = someString;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æŠŠè®¾ç½®æ“ä½œä¸è·å–æ“ä½œéƒ½å®‰æ’åœ¨åºåˆ—åŒ–çš„é˜Ÿåˆ—é‡Œæ‰§è¡Œï¼Œè¿™æ ·çš„è¯ï¼Œæ‰€æœ‰é’ˆå¯¹å±æ€§çš„è®¿é—®æ“ä½œå°±éƒ½åŒæ­¥äº†ã€‚</p>
<h4 id="æ …æ å—"><a href="#æ …æ å—" class="headerlink" title="æ …æ å—"></a>æ …æ å—</h4><p>åœ¨é˜Ÿåˆ—ä¸­ï¼Œæ …æ å—å¿…é¡»å•ç‹¬æ‰§è¡Œï¼Œä¸èƒ½ä¸å…¶ä»–å—å¹¶è¡Œã€‚è¿™åªå¯¹<strong>å¹¶å‘é˜Ÿåˆ—</strong>æœ‰æ„ä¹‰ï¼Œå› ä¸ºä¸²è¡Œé˜Ÿåˆ—ä¸­çš„å—æ€»æ˜¯æŒ‰é¡ºåºé€ä¸ªæ¥æ‰§è¡Œçš„ã€‚å¹¶å‘é˜Ÿåˆ—å¦‚æœå‘ç°æ¥ä¸‹æ¥è¦å¤„ç†çš„å—æ˜¯ä¸ªæ …æ å— (barrier block) ï¼Œé‚£ä¹ˆå°±ä¸€ç›´è¦ç­‰å½“å‰æ‰€æœ‰å¹¶å‘å—éƒ½æ‰§è¡Œå®Œæ¯•ï¼Œæ‰ä¼šå•ç‹¬æ‰§è¡Œè¿™ä¸ªæ …æ å—ã€‚å¾…æ …æ å—æ‰§è¡Œè¿‡åï¼Œå†æŒ‰æ­£å¸¸æ–¹å¼ç»§ç»­å‘ä¸‹å¤„ç†ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">dispatch_barrier_sync(dispatch_queue_t  _Nonnull queue, ^&#123;</span><br><span class="line"></span><br><span class="line">&#125;)</span><br><span class="line">dispatch_barrier_async(dispatch_queue_t  _Nonnull queue, ^&#123;</span><br><span class="line"></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">- (NSString *)someString &#123;</span><br><span class="line">    // åå°æ‰§è¡Œ</span><br><span class="line">    _syncQueue = dispatch_get_global_queue(0, 0);</span><br><span class="line">    </span><br><span class="line">    __block NSString *localSomeString;</span><br><span class="line">    // åŒæ­¥åå°é˜Ÿåˆ—</span><br><span class="line">    dispatch_sync(_syncQueue, ^&#123;</span><br><span class="line">        localSomeString = _someString;</span><br><span class="line">    &#125;);</span><br><span class="line">    return localSomeString;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (void)setSomeString:(NSString *)someString &#123;</span><br><span class="line">    // å¼‚æ­¥æ …æ é˜Ÿåˆ—</span><br><span class="line">    dispatch_barrier_async(_syncQueue, ^&#123;</span><br><span class="line">       _someString = someString;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="http://upload-images.jianshu.io/upload_images/2648731-7c49a2d5fc91fe88.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt></p>
<h4 id="è¦ç‚¹-4"><a href="#è¦ç‚¹-4" class="headerlink" title="è¦ç‚¹"></a>è¦ç‚¹</h4><ul>
<li>æ´¾å‘é˜Ÿåˆ—å¯ç”¨æ¥è¡¨è¿°åŒæ­¥è¯­ä¹‰ï¼Œè¿™ç§åšæ³•è¦æ¯”ä½¿ç”¨ @synchronized å—æˆ– NSLock å¯¹è±¡æ›´ç®€å•ã€‚</li>
<li>å°†åŒæ­¥ä¸å¼‚æ­¥æ´¾å‘ç»“åˆèµ·æ¥ï¼Œå¯ä»¥å®ç°ä¸æ™®é€šåŠ é”æœºåˆ¶ä¸€æ ·çš„åŒæ­¥è¡Œä¸ºï¼Œè€Œè¿™ä¹ˆåšå´ä¸ä¼šé˜»å¡æ‰§è¡Œå¼‚æ­¥æ´¾å‘çš„çº¿ç¨‹ã€‚</li>
<li>ä½¿ç”¨åŒæ­¥é˜Ÿåˆ—åŠæ …æ å—ï¼Œå¯ä»¥ä»¤åŒæ­¥è¡Œä¸ºæ›´åŠ é«˜æ•ˆã€‚</li>
</ul>
<h3 id="ç¬¬42æ¡ï¼šå¤šç”¨GCDï¼Œå°‘ç”¨-performSelector-ç³»åˆ—æ–¹æ³•"><a href="#ç¬¬42æ¡ï¼šå¤šç”¨GCDï¼Œå°‘ç”¨-performSelector-ç³»åˆ—æ–¹æ³•" class="headerlink" title="ç¬¬42æ¡ï¼šå¤šç”¨GCDï¼Œå°‘ç”¨ performSelector ç³»åˆ—æ–¹æ³•"></a>ç¬¬42æ¡ï¼šå¤šç”¨GCDï¼Œå°‘ç”¨ performSelector ç³»åˆ—æ–¹æ³•</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">// æ¥å—çš„å‚æ•°å°±æ˜¯è¦æ‰§è¡Œçš„é€‰æ‹©å­</span><br><span class="line">- (id)performSelector:(SEL)aSelector;</span><br></pre></td></tr></table></figure>
<p>è¯¥æ–¹æ³•ä¸ç›´æ¥è°ƒç”¨é€‰æ‹©å­ç­‰æ•ˆï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[self performSelector:@selector(selectorMethod)];</span><br><span class="line">[self selectorMethod];</span><br></pre></td></tr></table></figure>
<p>ç‰¹ç‚¹ï¼šç¼–è¯‘å™¨è¦ç­‰åˆ°è¿è¡ŒæœŸæ‰èƒ½çŸ¥é“æ‰§è¡Œçš„é€‰æ‹©å­ã€‚å¯ä»¥åœ¨åŠ¨æ€ç»‘å®šä¹‹ä¸Šå†æ¬¡ä½¿ç”¨åŠ¨æ€ç»‘å®šï¼Œå› è€Œå¯ä»¥å®ç°å‡ºä¸‹é¢è¿™ç§åŠŸèƒ½:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">SEL selector;</span><br><span class="line">if ( /** condition A */ ) &#123;</span><br><span class="line">    selector = @selector(foo);</span><br><span class="line">&#125;else if ( /** condition B */ ) &#123;</span><br><span class="line">    selector = @selector(bar);</span><br><span class="line">&#125;else &#123;</span><br><span class="line">    selector = @selector(baz);</span><br><span class="line">&#125;</span><br><span class="line">[self performSelector:selector];</span><br></pre></td></tr></table></figure>
<p>ä¸æ¨èä½¿ç”¨ <code>performSelector</code> æ–¹æ³•çš„åŸå› ï¼š</p>
<p>âš ï¸ ARC ä¸‹ä¼šå¼•èµ·å†…å­˜æ³„æ¼ï¼šç¼–è¯‘å™¨å¹¶ä¸çŸ¥é“å°†è¦æ‰§è¡Œçš„é€‰æ‹©å­æ˜¯ä»€ä¹ˆï¼Œå› æ­¤ï¼Œä¹Ÿå°±ä¸äº†è§£å…¶æ–¹æ³•ç­¾ååŠè¿”å›å€¼ï¼Œç”šè‡³è¿æ˜¯å¦æœ‰è¿”å›å€¼éƒ½ä¸æ¸…æ¥šï¼Œè€Œç”±äºç¼–è¯‘å™¨ä¸çŸ¥é“æ–¹æ³•åï¼Œæ‰€ä»¥å°±æ²¡åŠæ³•è¿ç”¨ARCçš„å†…å­˜ç®¡ç†è§„åˆ™æ¥åˆ¤å®šè¿”å›å€¼æ˜¯ä¸æ˜¯åº”è¯¥é‡Šæ”¾ã€‚é‰´äºæ­¤ï¼ŒARCé‡‡ç”¨äº†æ¯”è¾ƒè°¨æ…çš„åšæ³•ï¼Œå°±æ˜¯ä¸æ·»åŠ é‡Šæ”¾æ“ä½œã€‚ç„¶è€Œè¿™ä¹ˆåšå¯èƒ½å¯¼è‡´å†…å­˜æ³„æ¼ï¼Œå› ä¸ºæ–¹æ³•åœ¨è¿”å›å¯¹è±¡æ—¶å¯èƒ½å·²ç»å°†å…¶ä¿ç•™äº†ã€‚</p>
<p>å³ä½¿ä½¿ç”¨é™æ€åˆ†æå™¨ï¼Œä¹Ÿå¾ˆéš¾ä¾¦æµ‹åˆ°éšåçš„å†…å­˜æ³„æ¼ã€‚</p>
<p>âš ï¸è¿”å›å€¼åªèƒ½æ˜¯ void æˆ–å¯¹è±¡ç±»å‹ï¼Œ<code>performSelector</code> æ–¹æ³•çš„è¿”å›å€¼ç±»å‹æ˜¯ idã€‚å¦‚æœæƒ³è¿”å›æ•´æ•°æˆ–æµ®ç‚¹æ•°ç­‰ç±»å‹çš„å€¼ï¼Œé‚£ä¹ˆå°±éœ€è¦æ‰§è¡Œä¸€äº›å¤æ‚çš„è½¬æ¢æ“ä½œäº†ï¼Œè€Œè¿™ç§è½¬æ¢å¾ˆå®¹æ˜“å‡ºé”™ã€‚</p>
<p>å¦‚æœè¿”å†‹å€¼çš„ç±»å‹ä¸ºCè¯­è¨€ç»“æ„ä½“ï¼Œåˆ™ä¸å¯ä»¥ä½¿ç”¨ <code>performSelector</code> æ–¹æ³•ã€‚</p>
<p>âš ï¸<code>performSelector</code> æ–¹æ³•è¿˜æœ‰è¯¸å¤šå±€é™æ€§ï¼Œä¼ å…¥çš„å‚æ•°ç±»å‹å¿…é¡»æ˜¯å¯¹è±¡ç±»å‹ä¸”æœ€å¤šåªèƒ½æ¥å—2ä¸ªå‚æ•°ã€å…·å¤‡å»¶åæ‰§è¡Œçš„æ–¹æ³•æ— æ³•å¤„ç†å¸¦æœ‰2ä¸ªå‚æ•°çš„é€‰æ‹©å­ã€‚</p>
<p>ä¸‹é¢æ˜¯å‡ ä¸ªä½¿ç”¨ Block çš„æ›¿ä»£æ–¹æ¡ˆï¼š</p>
<h4 id="å»¶åæ‰§è¡Œ"><a href="#å»¶åæ‰§è¡Œ" class="headerlink" title="å»¶åæ‰§è¡Œ"></a>å»¶åæ‰§è¡Œ</h4><p>âœ…æ¨èï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">double delayInSeconds = 5.0;</span><br><span class="line">dispatch_time_t popTime = dispatch_time(DISPATCH_TIME_NOW,</span><br><span class="line">                                        delayInSeconds *NSEC_PER_SEC);</span><br><span class="line">dispatch_after(popTime, dispatch_get_main_queue(), ^&#123;</span><br><span class="line">    [self doSomething];</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>âåå¯¹ï¼š</p>
<figure class="highlight scheme"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[<span class="name">self</span> performSelector:@selector(<span class="name">doSomething</span>)</span><br><span class="line">             withObject:nil</span><br><span class="line">             afterDelay:5.0]<span class="comment">;</span></span><br></pre></td></tr></table></figure>
<h4 id="ä¸»çº¿ç¨‹æ‰§è¡Œ"><a href="#ä¸»çº¿ç¨‹æ‰§è¡Œ" class="headerlink" title="ä¸»çº¿ç¨‹æ‰§è¡Œ"></a>ä¸»çº¿ç¨‹æ‰§è¡Œ</h4><p>âœ…æ¨èï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">// åŒæ­¥ä¸»çº¿ç¨‹ï¼ˆwaitUntilDone:YESï¼‰</span><br><span class="line">dispatch_sync(dispatch_get_main_queue(), ^&#123;</span><br><span class="line">    [self doSomething];</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">// å¼‚æ­¥ä¸»çº¿ç¨‹ï¼ˆwaitUntilDone:NOï¼‰</span><br><span class="line">dispatch_async(dispatch_get_main_queue(), ^&#123;</span><br><span class="line">    [self doSomething];</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>âåå¯¹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[self performSelectorOnMainThread:@selector(doSomething)</span><br><span class="line">                       withObject:nil</span><br><span class="line">                    waitUntilDone:NO];</span><br></pre></td></tr></table></figure>
<h4 id="è¦ç‚¹-5"><a href="#è¦ç‚¹-5" class="headerlink" title="è¦ç‚¹"></a>è¦ç‚¹</h4><ul>
<li><code>performSelector</code> ç³»åˆ—æ–¹æ³•åœ¨å†…å­˜ç®¡ç†æ–¹é¢å®¹æ˜“æœ‰ç–å¤±ã€‚å®ƒæ— æ³•ç¡®å®šå°†è¦æ‰§è¡Œçš„ selector å…·ä½“æ˜¯ä»€ä¹ˆï¼Œå› è€ŒARCç¼–è¯‘å™¨å°±æ— æ³•æ’å…¥é€‚å½“çš„å†…å­˜ç®¡ç†æ–¹æ³•ã€‚</li>
<li><code>performSelector</code>  ç³»åˆ—æ–¹æ³•æ‰€èƒ½å¤„ç†çš„ selector å¤ªè¿‡å±€é™äº†ï¼Œselector çš„è¿”å›å€¼ç±»å‹åŠå‘é€ç»™æ–¹æ³•çš„å‚æ•°ä¸ªæ•°éƒ½å—åˆ°é™åˆ¶ã€‚</li>
<li>å¦‚æœæƒ³æŠŠä»»åŠ¡æ”¾åœ¨å¦ä¸€ä¸ªçº¿ç¨‹ä¸Šæ‰§è¡Œï¼Œé‚£ä¹ˆæœ€å¥½ä¸è¦ç”¨ <code>performSelector</code> ç³»åˆ—æ–¹æ³•è€Œæ˜¯åº”è¯¥æŠŠä»»åŠ¡å°è£…åˆ° block é‡Œç„¶åè°ƒç”¨ GCD æœºåˆ¶çš„ç›¸å…³æ–¹æ³•æ¥å®ç°ã€‚</li>
</ul>
<h3 id="ç¬¬43æ¡ï¼šæŒæ¡-GCD-åŠæ“ä½œé˜Ÿåˆ—çš„ä½¿ç”¨æ—¶æœº"><a href="#ç¬¬43æ¡ï¼šæŒæ¡-GCD-åŠæ“ä½œé˜Ÿåˆ—çš„ä½¿ç”¨æ—¶æœº" class="headerlink" title="ç¬¬43æ¡ï¼šæŒæ¡ GCD åŠæ“ä½œé˜Ÿåˆ—çš„ä½¿ç”¨æ—¶æœº"></a>ç¬¬43æ¡ï¼šæŒæ¡ GCD åŠæ“ä½œé˜Ÿåˆ—çš„ä½¿ç”¨æ—¶æœº</h3><h4 id="GCD-amp-NSOperation"><a href="#GCD-amp-NSOperation" class="headerlink" title="GCD &amp; NSOperation"></a>GCD &amp; NSOperation</h4><ul>
<li><p>GCD æ˜¯çº¯ C çš„ APIï¼Œè€Œ NSOperationï¼ˆæ“ä½œé˜Ÿåˆ—ï¼‰åˆ™æ˜¯ Objective-C çš„å¯¹è±¡ã€‚</p>
</li>
<li><p>åœ¨GCDä¸­ï¼Œä»»åŠ¡ç”¨ Block æ¥è¡¨ç¤ºï¼Œè€Œ Block æ˜¯ä¸ªè½»é‡çº§æ•°æ®ç»“æ„ï¼ˆå‚è§ç¬¬37æ¡ï¼‰ã€‚ä¸ä¹‹ç›¸åï¼Œâ€œæ“ä½œâ€ï¼ˆoperation) åˆ™æ˜¯ä¸ªæ›´ä¸ºé‡é‡çº§çš„ Objective-C å¯¹è±¡</p>
</li>
<li><p>ç”¨ NSOperationQueue ç±»çš„ <code>addOperationWithBlock:</code> æ–¹æ³•æ­é… NSBlockOperation ç±»æ¥ä½¿ç”¨æ“ä½œé˜Ÿåˆ—ï¼Œå…¶è¯­æ³•ä¸çº¯ GCD æ–¹å¼éå¸¸ç±»ä¼¼ã€‚ä½¿ç”¨ NSOperation åŠ NSOperationQueue çš„å¥½å¤„å¦‚ä¸‹ï¼š</p>
<ul>
<li>å–æ¶ˆæŸä¸ªæ“ä½œã€‚è¿è¡Œä»»åŠ¡ä¹‹å‰, å¯ä»¥åœ¨ NSOperation å¯¹è±¡ä¸Šè°ƒç”¨ <code>cancel</code> æ–¹æ³•å–æ¶ˆä»»åŠ¡æ‰§è¡Œã€‚</li>
<li>æŒ‡å®šæ“ä½œé—´çš„ä¾èµ–å…³ç³»ã€‚</li>
<li>é€šè¿‡é”®å€¼è§‚æµ‹æœºåˆ¶ï¼ˆç®€ç§° KVOï¼‰ç›‘æ§ NSOperation å¯¹è±¡çš„å±æ€§ã€‚</li>
<li>æŒ‡å®šæ“ä½œçš„ä¼˜å…ˆçº§ã€‚æ“ä½œçš„ä¼˜å…ˆçº§è¡¨ç¤ºæ­¤æ“ä½œä¸é˜Ÿåˆ—ä¸­å…¶ä»–æ“ä½œä¹‹é—´çš„ä¼˜å…ˆå…³ ç³»ã€‚ä¼˜å…ˆçº§é«˜çš„æ“ä½œå…ˆæ‰§è¡Œï¼Œä¼˜å…ˆçº§ä½çš„åæ‰§è¡Œã€‚</li>
<li>é‡ç”¨ NSOperation å¯¹è±¡ã€‚</li>
</ul>
</li>
<li><p>æ“ä½œé˜Ÿåˆ—æœ‰å¾ˆå¤šåœ°æ–¹èƒœè¿‡æ´¾å‘é˜Ÿåˆ—ã€‚æ“ä½œé˜Ÿåˆ—æä¾›äº†å¤šç§é¢„è®¾çš„æ‰§è¡Œä»»åŠ¡çš„æ–¹å¼ï¼Œå¼€å‘è€…å¯ä»¥ç›´æ¥ä½¿ç”¨ã€‚</p>
</li>
<li><p>æœ‰ä¸€ä¸ªAPIé€‰ç”¨äº†æ“ä½œé˜Ÿåˆ—è€Œéæ´¾å‘é˜Ÿåˆ—ï¼Œè¿™å°±æ˜¯ NSNotificationCemerï¼Œå¼€å‘è€…å¯é€šè¿‡å…¶ä¸­çš„æ–¹æ³•æ¥æ³¨å†Œç›‘å¬å™¨ï¼Œä»¥ä¾¿åœ¨å‘ç”Ÿç›¸å…³äº‹ä»¶æ—¶å¾—åˆ°é€šçŸ¥ï¼Œè€Œè¿™ä¸ªæ–¹æ³•æ¥å—çš„å‚æ•°æ˜¯å—ï¼Œä¸æ˜¯é€‰æ‹©å­ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">- (id &lt;NSObject&gt;)addObserverForName:(nullable NSNotificationName)name</span><br><span class="line">                             object:(nullable id)obj</span><br><span class="line">                              queue:(nullable NSOperationQueue *)queue</span><br><span class="line">                         usingBlock:(void (^)(NSNotification *note))bloc;</span><br></pre></td></tr></table></figure>
</li>
<li><p>åº”è¯¥å°½å¯èƒ½é€‰ç”¨é«˜å±‚APIï¼Œåªåœ¨ç¡®æœ‰å¿…è¦æ—¶æ‰æ±‚åŠ©äºåº•å±‚ã€‚ç¬”è€…ä¹ŸåŒæ„è¿™ä¸ªè¯´æ³•ï¼Œä½†æˆ‘å¹¶ä¸ç›²ä»ã€‚æŸäº›åŠŸèƒ½ç¡®å®å¯ä»¥ç”¨é«˜å±‚çš„Objective-Cæ–¹æ³•æ¥åšï¼Œä½†è¿™å¹¶ä¸ç­‰äºè¯´å®ƒå°±ä¸€å®šæ¯”åº•å±‚å®ç°æ–¹æ¡ˆå¥½ã€‚è¦æƒ³ç¡®å®šå“ªç§æ–¹æ¡ˆæ›´ä½³ï¼Œæœ€å¥½è¿˜æ˜¯æµ‹è¯•ä¸€ä¸‹æ€§èƒ½ã€‚</p>
</li>
</ul>
<h4 id="è¦ç‚¹-6"><a href="#è¦ç‚¹-6" class="headerlink" title="è¦ç‚¹"></a>è¦ç‚¹</h4><ul>
<li>åœ¨è§£å†³å¤šçº¿ç¨‹ä¸ä»»åŠ¡ç®¡ç†é—®é¢˜æ—¶ï¼Œæ´¾å‘é˜Ÿåˆ—å¹¶éå”¯ä¸€æ–¹æ¡ˆã€‚</li>
<li>æ“ä½œé˜Ÿåˆ—æä¾›äº†ä¸€å¥—é«˜å±‚çš„ Objective-C APIï¼Œèƒ½å®ç°çº¯ GCD æ‰€å…·å¤‡çš„ç»å¤§éƒ¨åˆ†åŠŸèƒ½ï¼Œè€Œä¸”è¿˜èƒ½å®Œæˆä¸€äº›æ›´ä¸ºå¤æ‚çš„æ“ä½œï¼Œé‚£äº›æ“ä½œè‹¥æ”¹ç”¨GCDæ¥å®ç°ï¼Œåˆ™éœ€å¦å¤–ç¼–å†™ä»£ç ã€‚</li>
</ul>
<h3 id="ç¬¬44æ¡ï¼šé€šè¿‡-Dispatch-Group-æœºåˆ¶ï¼Œæ ¹æ®ç³»ç»Ÿèµ„æºçŠ¶å†µæ¥æ‰§è¡Œä»»åŠ¡"><a href="#ç¬¬44æ¡ï¼šé€šè¿‡-Dispatch-Group-æœºåˆ¶ï¼Œæ ¹æ®ç³»ç»Ÿèµ„æºçŠ¶å†µæ¥æ‰§è¡Œä»»åŠ¡" class="headerlink" title="ç¬¬44æ¡ï¼šé€šè¿‡ Dispatch Group æœºåˆ¶ï¼Œæ ¹æ®ç³»ç»Ÿèµ„æºçŠ¶å†µæ¥æ‰§è¡Œä»»åŠ¡"></a>ç¬¬44æ¡ï¼šé€šè¿‡ Dispatch Group æœºåˆ¶ï¼Œæ ¹æ®ç³»ç»Ÿèµ„æºçŠ¶å†µæ¥æ‰§è¡Œä»»åŠ¡</h3><p><strong>dispatch group</strong> æ˜¯ GCD çš„ä¸€é¡¹ç‰¹æ€§ï¼Œèƒ½å¤ŸæŠŠä»»åŠ¡åˆ†ç»„ã€‚è°ƒç”¨è€…å¯ä»¥ç­‰å¾…è¿™ç»„ä»»åŠ¡æ‰§è¡Œå®Œæ¯•ï¼Œä¹Ÿå¯ä»¥åœ¨æä¾›å›è°ƒå‡½æ•°ä¹‹åç»§ç»­å¾€ä¸‹æ‰§è¡Œï¼Œè¿™ç»„ä»»åŠ¡å®Œæˆæ—¶ï¼Œè°ƒç”¨è€…ä¼šå¾—åˆ°é€šçŸ¥ã€‚è¿™ä¸ªåŠŸèƒ½æœ‰è®¸å¤šç”¨é€”ï¼Œå…¶ä¸­æœ€é‡è¦ã€æœ€å€¼å¾—æ³¨æ„çš„ç”¨æ³•ï¼Œå°±æ˜¯<strong>æŠŠå°†è¦å¹¶å‘æ‰§è¡Œçš„å¤šä¸ªä»»åŠ¡åˆä¸ºä¸€ç»„</strong>ï¼Œäºæ˜¯è°ƒç”¨è€…å°±å¯ä»¥çŸ¥é“è¿™äº›ä»»åŠ¡ä½•æ—¶æ‰èƒ½å…¨éƒ¨æ‰§è¡Œå®Œæ¯•ã€‚æ¯”æ–¹è¯´ï¼Œå¯ä»¥æŠŠå‹ç¼©ä¸€ç³»åˆ—æ–‡ä»¶çš„ä»»åŠ¡è¡¨ç¤ºæˆ <strong>dispatch group</strong>ã€‚</p>
<p>åˆ›å»ºåŠä½¿ç”¨ <strong>dispatch group</strong>ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">dispatch_group_t group = dispatch_group_create();</span><br><span class="line">dispatch_group_async(group, dispatch_get_global_queue(0, 0), ^&#123;</span><br><span class="line">    // å¹¶è¡Œæ‰§è¡Œçš„çº¿ç¨‹ä¸€</span><br><span class="line">&#125;);</span><br><span class="line">dispatch_group_async(group, dispatch_get_global_queue(0, 0), ^&#123;</span><br><span class="line">    // å¹¶è¡Œæ‰§è¡Œçš„çº¿ç¨‹äºŒ</span><br><span class="line">&#125;);</span><br><span class="line">dispatch_group_notify(group, dispatch_get_global_queue(0, 0), ^&#123;</span><br><span class="line">   // æ±‡æ€»ç»“æœ</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>ç»™ä»»åŠ¡ç¼–ç»„çš„ä¸¤ç§æ–¹æ³•ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">// 1.æ¯” dispatch_async å¤šä¸€ä¸ªå‚æ•°ï¼Œç”¨äºè¡¨ç¤ºå¾…æ‰§è¡Œçš„å—æ‰€å½’å±çš„ç»„</span><br><span class="line">dispatch_group_async(dispatch_group_t group,</span><br><span class="line">                     dispatch_queue_t queue,</span><br><span class="line">                     dispatch_block_t block);</span><br><span class="line"></span><br><span class="line">// 2.dispatch_group_enterã€dispatch_group_leave éœ€è¦æˆå¯¹ä½¿ç”¨</span><br><span class="line">dispatch_group_enter(dispatch_group_t group); // ä½¿åˆ†ç»„é‡Œæ­£è¦æ‰§è¡Œçš„ä»»åŠ¡æ•°é€’å¢ï¼Œ</span><br><span class="line">dispatch_group_leave(dispatch_group_t group); // ä½¿åˆ†ç»„é‡Œæ­£è¦æ‰§è¡Œçš„ä»»åŠ¡æ•°é€’å‡.</span><br></pre></td></tr></table></figure>
<p><strong>dispatch_group_wait</strong> å‡½æ•°ç”¨äºç­‰å¾… <strong>dispatch group</strong> æ‰§è¡Œå®Œæ¯•ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">dispatch_group_wait(dispatch_group_t group, </span><br><span class="line">                    dispatch_time_t timeout);</span><br></pre></td></tr></table></figure>
<p>ç¤ºä¾‹ï¼š</p>
<p>ä»¤æ•°ç»„ä¸­çš„æ¯ä¸ªå¯¹è±¡éƒ½æ‰§è¡ŒæŸé¡¹ä»»åŠ¡ï¼Œå¹¶ä¸”ç­‰å¾…æ‰€æœ‰ä»»åŠ¡æ‰§è¡Œå®Œæ¯•:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">dispatch_queue_t queue =</span><br><span class="line">    dispatch_get_global_queue(QOS_CLASS_DEFAULT, 0);</span><br><span class="line">dispatch_group_t group = dispatch_group_create();</span><br><span class="line">for (id object in collection) &#123;</span><br><span class="line">    dispatch_group_async(group, queue, ^&#123;</span><br><span class="line">        [object performTask];</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">dispatch_group_wait(group, DISPATCH_TIME_FOREVER);</span><br><span class="line">// ä»»åŠ¡æ‰§è¡Œå®Œæ¯•åç»§ç»­æ“ä½œ</span><br><span class="line"></span><br><span class="line">// è‹¥å½“å‰çº¿ç¨‹ä¸åº”é˜»å¡ï¼Œåˆ™å¯ä»¥ä½¿ç”¨ dispatch_group_notify ä»£æ›¿ dispatch_group_wait</span><br><span class="line">dispatch_queue_t notifyQueue = dispatch_get_main_queue();</span><br><span class="line">dispatch_group_notify(group, notifyQueue, ^&#123;</span><br><span class="line">    // ä»»åŠ¡æ‰§è¡Œå®Œæ¯•åç»§ç»­æ“ä½œ</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>å¼€å‘è€…æœªå¿…æ€»éœ€è¦ä½¿ç”¨ <strong>dispatch group</strong>ã€‚æœ‰æ—¶å€™é‡‡ç”¨å•ä¸ªé˜Ÿåˆ—æ­é…æ ‡å‡†çš„å¼‚æ­¥æ´¾å‘ï¼Œä¹Ÿå¯å®ç°åŒæ ·æ•ˆæœï¼š</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è‡ªå®šä¹‰ä¸²è¡Œé˜Ÿåˆ—</span></span><br><span class="line"><span class="built_in">dispatch_queue_t</span> queue =</span><br><span class="line">    dispatch_queue_create(<span class="string">"com.effecitveobjectivec.queue"</span>, <span class="literal">NULL</span>);</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">id</span> object <span class="keyword">in</span> collection) &#123;</span><br><span class="line">    <span class="built_in">dispatch_async</span>(queue, ^&#123;</span><br><span class="line">        [object performTask];</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">dispatch_async</span>(queue, ^&#123;</span><br><span class="line">    <span class="comment">// ä»»åŠ¡æ‰§è¡Œå®Œæ¯•åç»§ç»­æ“ä½œ</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<blockquote>
<p>æ ¹æ®ç³»ç»Ÿèµ„æºçŠ¶å†µæ¥æ‰§è¡Œä»»åŠ¡ï¼š</p>
<p>ä¸ºäº†æ‰§è¡Œé˜Ÿåˆ—ä¸­çš„å—ï¼Œ<strong>GCDä¼šåœ¨é€‚å½“çš„æ—¶æœºè‡ªåŠ¨åˆ›å»ºæ–°çº¿ç¨‹æˆ–å¤ç”¨æ—§çº¿ç¨‹ã€‚</strong>å¦‚æœä½¿ç”¨å¹¶å‘é˜Ÿåˆ—ï¼Œé‚£ä¹ˆå…¶ä¸­æœ‰å¯èƒ½ä¼šæœ‰å¤šä¸ªçº¿ç¨‹ï¼Œè¿™ä¹Ÿå°±æ„å‘³ç€å¤šä¸ªå—å¯ä»¥å¹¶å‘æ‰§è¡Œã€‚åœ¨å¹¶å‘é˜Ÿåˆ—ä¸­ï¼Œæ‰§è¡Œä»»åŠ¡æ‰€ç”¨çš„å¹¶å‘çº¿ç¨‹æ•°é‡ï¼Œå–å†³äºå„ç§å› ç´ ï¼Œè€ŒGCDä¸»è¦æ˜¯æ ¹æ®ç³»ç»Ÿèµ„æºçŠ¶å†µæ¥åˆ¤å®šè¿™äº›å› ç´ çš„ã€‚å‡å¦‚CPUæœ‰å¤šä¸ªæ ¸å¿ƒï¼Œå¹¶ä¸”é˜Ÿåˆ—ä¸­æœ‰å¤§é‡ä»»åŠ¡ç­‰å¾…æ‰§è¡Œï¼Œé‚£ä¹ˆGCDå°±å¯èƒ½ä¼šç»™è¯¥é˜Ÿåˆ—é…å¤‡å¤šä¸ªçº¿ç¨‹ã€‚é€šè¿‡dispatch groupæ‰€æä¾›çš„è¿™ç§ç®€ä¾¿æ–¹å¼ï¼Œæ—¢å¯ä»¥å¹¶å‘æ‰§è¡Œä¸€ç³»åˆ—ç»™å®šçš„ä»»åŠ¡ï¼Œåˆèƒ½åœ¨å…¨éƒ¨ä»»åŠ¡ç»“æŸæ—¶å¾—åˆ°é€šçŸ¥ã€‚ç”±äºGCD æœ‰å¹¶å‘é˜Ÿåˆ—æœºåˆ¶ï¼Œæ‰€ä»¥èƒ½å¤Ÿæ ¹æ®å¯ç”¨çš„ç³»ç»Ÿèµ„æºçŠ¶å†µæ¥å¹¶å‘æ‰§è¡Œä»»åŠ¡ã€‚è€Œå¼€å‘è€…åˆ™å¯ä»¥ä¸“æ³¨äºä¸šåŠ¡é€»è¾‘ä»£ç ï¼Œæ— é¡»å†ä¸ºäº†å¤„ç†å¹¶å‘ä»»åŠ¡è€Œç¼–å†™å¤æ‚çš„è°ƒåº¦å™¨ã€‚</p>
</blockquote>
<p>éå†æŸä¸ª collection ï¼Œå¹¶åœ¨å…¶æ¯ä¸ªå…ƒç´ ä¸Šæ‰§è¡Œä»»åŠ¡ï¼Œè€Œè¿™ä¹Ÿå¯ä»¥ç”¨å¦å¤–ä¸€ä¸ª GCD å‡½æ•°æ¥å®ç°ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">dispatch_apply(size_t iterations,</span><br><span class="line">               dispatch_queue_t queue,</span><br><span class="line">               void (^block)(size_t));</span><br></pre></td></tr></table></figure>
<p>æ­¤å‡½æ•°ä¼šå°†å—åå¤æ‰§è¡Œä¸€å®šçš„æ¬¡æ•°ï¼Œæ¯æ¬¡ä¼ ç»™å—çš„å‚æ•°å€¼éƒ½ä¼šé€’å¢ï¼Œä»0å¼€å§‹ï¼Œç›´è‡³ â€œ iterations-1 â€ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">// è‡ªå®šä¹‰ä¸²è¡Œé˜Ÿåˆ—</span><br><span class="line">dispatch_queue_t queue =</span><br><span class="line">    dispatch_queue_create(&quot;com.effecitveobjectivec.queue&quot;, NULL);    </span><br><span class="line">dispatch_apply(10, queue, ^(size_t) &#123;</span><br><span class="line">    // Perform Taskï¼š0~9</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>ä¸ for å¾ªç¯ä¸åŒçš„æ˜¯ï¼Œ <strong>diSpatch_apply</strong> æ‰€ç”¨çš„é˜Ÿåˆ—å¯ä»¥æ˜¯å¹¶å‘é˜Ÿåˆ—ã€‚ä½†æ˜¯ <strong>diSpatch_apply</strong>  ä¼šæŒç»­é˜»å¡ï¼Œç›´åˆ°æ‰€æœ‰ä»»åŠ¡éƒ½æ‰§è¡Œå®Œæ¯•ä¸ºæ­¢ã€‚</p>
<p>å‡å¦‚æŠŠå—æ´¾ç»™äº†å½“å‰é˜Ÿåˆ—ï¼ˆæˆ–è€…ä½“ç³»ä¸­é«˜äºå½“å‰é˜Ÿåˆ—çš„æŸä¸ªä¸²è¡Œé˜Ÿåˆ—)ï¼Œå°±å°†å¯¼è‡´æ­»é”ã€‚è‹¥æƒ³åœ¨åå°æ‰§è¡Œä»»åŠ¡ï¼Œåˆ™åº”ä½¿ç”¨ <strong>dispatch group</strong>ã€‚</p>
<h4 id="è¦ç‚¹-7"><a href="#è¦ç‚¹-7" class="headerlink" title="è¦ç‚¹"></a>è¦ç‚¹</h4><ul>
<li>ä¸€ç³»åˆ—ä»»åŠ¡å¯å½’å…¥ä¸€ä¸ª <strong>dispatch group</strong> ä¹‹ä¸­ã€‚å¼€å‘è€…å¯ä»¥åœ¨è¿™ç»„ä»»åŠ¡æ‰§è¡Œå®Œæ¯•æ—¶è·å¾—é€šçŸ¥ã€‚</li>
<li>é€šè¿‡ <strong>dispatch group</strong>ï¼Œå¯ä»¥åœ¨å¹¶å‘å¼æ´¾å‘é˜Ÿåˆ—é‡ŒåŒæ—¶æ‰§è¡Œå¤šé¡¹ä»»åŠ¡ã€‚æ­¤æ—¶GCDä¼šæ ¹æ®ç³»ç»Ÿèµ„æºçŠ¶å†µæ¥è°ƒåº¦è¿™äº›å¹¶å‘æ‰§è¡Œçš„ä»»åŠ¡ã€‚å¼€å‘è€…è‹¥è‡ªå·±æ¥å®ç°æ­¤åŠŸèƒ½ï¼Œåˆ™éœ€ç¼–å†™å¤§é‡ä»£ç ã€‚</li>
</ul>
<h3 id="ç¬¬45æ¡ï¼šä½¿ç”¨-dispatch-once-æ¥æ‰§è¡Œåªéœ€è¿è¡Œä¸€æ¬¡çš„çº¿ç¨‹å®‰å…¨ä»£ç "><a href="#ç¬¬45æ¡ï¼šä½¿ç”¨-dispatch-once-æ¥æ‰§è¡Œåªéœ€è¿è¡Œä¸€æ¬¡çš„çº¿ç¨‹å®‰å…¨ä»£ç " class="headerlink" title="ç¬¬45æ¡ï¼šä½¿ç”¨ dispatch_once æ¥æ‰§è¡Œåªéœ€è¿è¡Œä¸€æ¬¡çš„çº¿ç¨‹å®‰å…¨ä»£ç "></a>ç¬¬45æ¡ï¼šä½¿ç”¨ dispatch_once æ¥æ‰§è¡Œåªéœ€è¿è¡Œä¸€æ¬¡çš„çº¿ç¨‹å®‰å…¨ä»£ç </h3><p>å•ä¾‹æ¨¡å¼ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">+ (instancetype)sharedInstance &#123;</span><br><span class="line">    static EOCClass *sharedInstance = nil;</span><br><span class="line">    // ä¸ºä¿è¯çº¿ç¨‹å®‰å…¨ï¼Œå°†åˆ›å»ºå•ä¾‹å®ä¾‹çš„ä»£ç åŒ…è£¹åœ¨åŒæ­¥å—é‡Œã€‚</span><br><span class="line">    @synchronized (self) &#123;</span><br><span class="line">        if (!sharedInstance) &#123;</span><br><span class="line">            sharedInstance = [[self alloc] init];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    return sharedInstance;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>dispatch_once</strong> å‡½æ•°ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">_dispatch_once(dispatch_once_t *predicate,</span><br><span class="line">		       dispatch_block_t block)</span><br></pre></td></tr></table></figure>
<p>è¯¥å‡½æ•°ä¿è¯ç›¸å…³çš„å—å¿…å®šä¼šæ‰§è¡Œï¼Œä¸”ä»…æ‰§è¡Œä¸€æ¬¡ã€‚é¦–æ¬¡è°ƒç”¨è¯¥å‡½æ•°æ—¶ï¼Œå¿…ç„¶ä¼šæ‰§è¡Œå—ä¸­çš„ä»£ç ï¼Œæœ€é‡è¦çš„ä¸€ç‚¹åœ¨äºï¼Œ<strong>æ­¤æ“ä½œå®Œå…¨æ˜¯çº¿ç¨‹å®‰å…¨çš„</strong>ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">+ (instancetype)sharedInstance &#123;</span><br><span class="line">    static EOCClass *sharedInstance = nil;</span><br><span class="line">    static dispatch_once_t onceToken;</span><br><span class="line">    dispatch_once(&amp;onceToken, ^&#123;</span><br><span class="line">        sharedInstance = [[self alloc] init];</span><br><span class="line">    &#125;);</span><br><span class="line">    return sharedInstance;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>ä½¿ç”¨ <strong>dispatch_once</strong> å¯ä»¥ç®€åŒ–ä»£ç å¹¶ä¸”å½»åº•ä¿è¯çº¿ç¨‹å®‰å…¨ã€‚</li>
<li>ç”±äºæ¯æ¬¡è°ƒç”¨æ—¶éƒ½å¿…é¡»ä½¿ç”¨å®Œå…¨ç›¸åŒçš„æ ‡è®°, æ‰€ä»¥æ ‡è®°è¦å£°æ˜æˆ <strong>static</strong>ã€‚æŠŠè¯¥å˜é‡å®šä¹‰åœ¨<strong>static</strong>ä½œç”¨åŸŸä¸­ï¼Œå¯ä»¥ä¿è¯ç¼–è¯‘å™¨åœ¨æ¯æ¬¡æ‰§è¡Œ <code>sharedlnstance</code> æ–¹æ³•æ—¶éƒ½ä¼šå¤ç”¨è¿™ä¸ªå˜é‡ï¼Œè€Œä¸ä¼šåˆ›å»ºæ–°å˜é‡ã€‚</li>
<li>æ­¤å¤–ï¼Œ<strong>dispatch_once</strong> æ›´é«˜æ•ˆã€‚ <strong>@synchronized</strong> ä½¿ç”¨äº†é‡é‡çº§çš„åŒæ­¥æœºåˆ¶ï¼Œæ¯æ¬¡è¿è¡Œä»£ç å‰éƒ½è¦è·å–é”ã€‚è€Œ <strong>dispatch_once</strong>  é‡‡ç”¨åŸå­è®¿é—®ï¼ˆatomic accessï¼‰æ¥æŸ¥è¯¢æ ‡è®°ï¼Œä»¥åˆ¤æ–­å…¶æ‰€å¯¹åº”çš„ä»£ç åŸæ¥æ˜¯å¦å·²ç»æ‰§è¡Œè¿‡ã€‚</li>
</ul>
<h4 id="è¦ç‚¹-8"><a href="#è¦ç‚¹-8" class="headerlink" title="è¦ç‚¹"></a>è¦ç‚¹</h4><ul>
<li>ç»å¸¸éœ€è¦ç¼–å†™åªéœ€æ‰§è¡Œä¸€æ¬¡çš„çº¿ç¨‹å®‰å…¨ä»£ç ã€‚é€šè¿‡ GCD æ‰€æä¾›çš„ <strong>dispatch_once</strong> å‡½æ•°ï¼Œå¾ˆå®¹æ˜“å°±èƒ½å®ç°æ­¤åŠŸèƒ½ã€‚</li>
<li>æ ‡è®°åº”è¯¥å£°æ˜åœ¨ <strong>static</strong> æˆ– <strong>global</strong> ä½œç”¨åŸŸä¸­ï¼Œè¿™æ ·çš„è¯ï¼Œåœ¨æŠŠåªéœ€æ‰§è¡Œä¸€æ¬¡çš„ block ä¼ ç»™<strong>dispatch_once</strong> å‡½æ•°æ—¶ï¼Œä¼ è¿›å»çš„æ ‡è®°ä¹Ÿæ˜¯ç›¸åŒçš„ã€‚</li>
</ul>
<h3 id="ç¬¬46æ¡ï¼šä¸è¦ä½¿ç”¨-dispatch-get-current-queue"><a href="#ç¬¬46æ¡ï¼šä¸è¦ä½¿ç”¨-dispatch-get-current-queue" class="headerlink" title="ç¬¬46æ¡ï¼šä¸è¦ä½¿ç”¨ dispatch_get_current_queue"></a>ç¬¬46æ¡ï¼šä¸è¦ä½¿ç”¨ dispatch_get_current_queue</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">// æ­¤å‡½æ•°è¿”å›å½“å‰æ­£åœ¨æ‰§è¡Œä»£ç çš„é˜Ÿåˆ—ã€‚</span><br><span class="line">// This function is deprecated and will be removed in a future release.</span><br><span class="line">dispatch_get_current_queue(void);</span><br></pre></td></tr></table></figure>
<p>âš ï¸ iOSç³»ç»Ÿä»6.0ç‰ˆæœ¬èµ·ï¼Œå·²ç»æ­£å¼å¼ƒç”¨æ­¤å‡½æ•°äº†ã€‚</p>
<h4 id="è¦ç‚¹-9"><a href="#è¦ç‚¹-9" class="headerlink" title="è¦ç‚¹"></a>è¦ç‚¹</h4><ul>
<li>dispatch_get_current_queue å‡½æ•°çš„è¡Œä¸ºå¸¸å¸¸ä¸å¼€å‘è€…æ‰€é¢„æœŸçš„ä¸åŒã€‚æ­¤å‡½æ•°å·²åºŸå¼ƒï¼Œåªåº”åšè°ƒè¯•ä¹‹ç”¨ã€‚</li>
<li>ç”±äºæ´¾å‘é˜Ÿåˆ—æ˜¯æŒ‰å±‚çº§æ¥ç»„ç»‡çš„ï¼Œæ‰€ä»¥æ— æ³•å•ç”¨æŸä¸ªé˜Ÿåˆ—å¯¹è±¡æ¥æè¿°å½“å‰é˜Ÿåˆ—è¿™ä¸€æ¦‚å¿µã€‚</li>
<li>dispatch_get_current_queue å‡½æ•°ç”¨äºè§£å†³ç”±ä¸å¯é‡å…¥çš„ä»£ç æ‰€å¼•å‘çš„æ­»é”ï¼Œç„¶è€Œèƒ½ç”¨æ­¤å‡½æ•°è§£å†³çš„é—®é¢˜ï¼Œé€šå¸¸ä¹Ÿèƒ½æ”¹ç”¨â€œé˜Ÿåˆ—ç‰¹å®šæ•°æ®â€æ¥è§£å†³ã€‚</li>
</ul>
<h3 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h3><ul>
<li><a href="http://www.devtalking.com/articles/you-should-know-block/" target="_blank" rel="noopener">Objective-Cä¸­çš„Block @ç¨‹åºå‘˜è¯´</a></li>
<li><a href="https://onevcat.com/2011/11/objc-block/" target="_blank" rel="noopener">Objective-Cä¸­çš„Block @onevcat</a></li>
<li><a href="http://blog.devtang.com/2012/02/22/use-gcd/" target="_blank" rel="noopener">ä½¿ç”¨GCD @å”å·§</a></li>
<li><a href="http://www.cocoachina.com/ios/20160129/15170.html" target="_blank" rel="noopener">èµ·åº•å¤šçº¿ç¨‹åŒæ­¥é”(iOS)</a></li>
</ul>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://andy0570.com/2017/08/17/äº”ã€å†…å­˜ç®¡ç†/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ç‹¬æœ¨èˆŸçš„æœ¨">
      <meta itemprop="description" content="æœ‰æ—¶å€™é˜³å…‰å¾ˆå¥½ æœ‰æ—¶å€™é˜³å…‰å¾ˆæš—">
      <meta itemprop="image" content="https://ws1.sinaimg.cn/large/006tNc79gy1g22m14458rj30u014xu0x.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ç‹¬æœ¨èˆŸçš„æœ¨">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2017/08/17/äº”ã€å†…å­˜ç®¡ç†/" class="post-title-link" itemprop="url">äº”ã€å†…å­˜ç®¡ç†</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              

              
                
              

              <time title="åˆ›å»ºæ—¶é—´ï¼š2017-08-17 13:19:00" itemprop="dateCreated datePublished" datetime="2017-08-17T13:19:00+08:00">2017-08-17</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">æ›´æ–°äº</span>
                
                <time title="ä¿®æ”¹æ—¶é—´ï¼š2019-04-16 00:12:40" itemprop="dateModified" datetime="2019-04-16T00:12:40+08:00">2019-04-16</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/ã€ŠEffective-Objective-C-2-0ã€‹/" itemprop="url" rel="index"><span itemprop="name">ã€ŠEffective Objective-C 2.0ã€‹</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          
            <span id="/2017/08/17/äº”ã€å†…å­˜ç®¡ç†/" class="leancloud_visitors" data-flag-title="äº”ã€å†…å­˜ç®¡ç†">
              <span class="post-meta-divider">|</span>
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              
                <span class="post-meta-item-text">é˜…è¯»æ¬¡æ•°ï¼š</span>
              
                <span class="leancloud-visitors-count"></span>
            </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body han-init-context" itemprop="articleBody">

      
      

      
        
          
            <h1 id="ã€ŠEffective-Objective-C-2-0-ç¼–å†™é«˜è´¨é‡iOSä¸OS-Xä»£ç çš„52ä¸ªæœ‰æ•ˆæ–¹æ³•-ã€‹å­¦ä¹ ç¬”è®°"><a href="#ã€ŠEffective-Objective-C-2-0-ç¼–å†™é«˜è´¨é‡iOSä¸OS-Xä»£ç çš„52ä¸ªæœ‰æ•ˆæ–¹æ³•-ã€‹å­¦ä¹ ç¬”è®°" class="headerlink" title="ã€ŠEffective Objective-C 2.0  ç¼–å†™é«˜è´¨é‡iOSä¸OS Xä»£ç çš„52ä¸ªæœ‰æ•ˆæ–¹æ³• ã€‹å­¦ä¹ ç¬”è®°"></a>ã€ŠEffective Objective-C 2.0  ç¼–å†™é«˜è´¨é‡iOSä¸OS Xä»£ç çš„52ä¸ªæœ‰æ•ˆæ–¹æ³• ã€‹å­¦ä¹ ç¬”è®°</h1><p><img src="http://upload-images.jianshu.io/upload_images/2648731-bc415805a22122ac.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt></p>
<h2 id="ç¬¬5ç« -å†…å­˜ç®¡ç†"><a href="#ç¬¬5ç« -å†…å­˜ç®¡ç†" class="headerlink" title="ç¬¬5ç«  å†…å­˜ç®¡ç†"></a>ç¬¬5ç«  å†…å­˜ç®¡ç†</h2><h3 id="ç¬¬29æ¡ï¼šç†è§£å¼•ç”¨è®¡æ•°"><a href="#ç¬¬29æ¡ï¼šç†è§£å¼•ç”¨è®¡æ•°" class="headerlink" title="ç¬¬29æ¡ï¼šç†è§£å¼•ç”¨è®¡æ•°"></a>ç¬¬29æ¡ï¼šç†è§£å¼•ç”¨è®¡æ•°</h3><ul>
<li><p>Objectice-C è¯­è¨€ä½¿ç”¨å¼•ç”¨è®¡æ•°æ¥ç®¡ç†å†…å­˜ï¼Œæ¯ä¸ªå¯¹è±¡éƒ½æœ‰ä¸€ä¸ªå¯ä»¥é€’å¢æˆ–é€’å‡çš„è®¡æ•°å™¨ã€‚</p>
</li>
<li><p>ä½¿ç”¨ ARC æ—¶ï¼Œæ‰€æœ‰ä¸å¼•ç”¨è®¡æ•°æœ‰å…³çš„æ–¹æ³•éƒ½æ— æ³•ç¼–è¯‘ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">- (instancetype)retain OBJC_ARC_UNAVAILABLE;</span><br><span class="line">- (oneway void)release OBJC_ARC_UNAVAILABLE;</span><br><span class="line">- (instancetype)autorelease OBJC_ARC_UNAVAILABLE;</span><br><span class="line">- (NSUInteger)retainCount OBJC_ARC_UNAVAILABLE;</span><br><span class="line"></span><br><span class="line">- (struct _NSZone *)zone OBJC_ARC_UNAVAILABLE;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="å¼•ç”¨è®¡æ•°å·¥ä½œåŸç†"><a href="#å¼•ç”¨è®¡æ•°å·¥ä½œåŸç†" class="headerlink" title="å¼•ç”¨è®¡æ•°å·¥ä½œåŸç†"></a>å¼•ç”¨è®¡æ•°å·¥ä½œåŸç†</h4><ul>
<li>å¯¹è±¡æœ‰ä¸ª<strong>è®¡æ•°å™¨</strong>ï¼Œè¡¨ç¤ºå½“å‰æœ‰å¤šå°‘ä¸ªäº‹ç‰©æƒ³ä»¤æ­¤å¯¹è±¡ç»§ç»­å­˜æ´»ã€‚è¿™åœ¨ Objective-C ä¸­å«åš <strong>ä¿ç•™è®¡æ•°</strong>ï¼ˆretain countï¼‰æˆ–è€… <strong>å¼•ç”¨è®¡æ•°</strong>ï¼ˆreference countï¼‰ã€‚</li>
<li>å¯¹è±¡åˆ›å»ºå‡ºæ¥æ—¶ï¼Œå…¶å¼•ç”¨è®¡æ•°<strong>è‡³å°‘</strong>ä¸º1ã€‚</li>
<li>ä¸åº”è¯¥è¯´å¼•ç”¨è®¡æ•°ä¸€å®šæ˜¯æŸä¸ªå€¼ï¼Œè€Œåº”è¯¥è¯´æ‰§è¡Œçš„æ“ä½œé€’å¢/é€’å‡äº†è¯¥è®¡æ•°ã€‚</li>
<li>åœ¨ iOS åº”ç”¨ç¨‹åºä¸­ï¼Œæ ¹å¯¹è±¡ä¸º <strong>UIApplication</strong> å•ä¾‹å¯¹è±¡ã€‚</li>
</ul>
<p><strong>NSObject</strong> åè®®å£°æ˜äº†ä¸‰ä¸ªæ–¹æ³•ç”¨äºæ“ä½œè®¡æ•°å™¨ï¼š</p>
<ol>
<li><code>retain</code> :é€’å¢å¼•ç”¨è®¡æ•°ã€‚</li>
<li><code>release</code> : é€’å‡å¼•ç”¨è®¡æ•°ã€‚</li>
<li><code>autorelease</code>: å¾…ç¨åæ¸…ç†â€œè‡ªåŠ¨é‡Šæ”¾æ± â€ï¼ˆautorelease poolï¼‰æ—¶ï¼Œå†é€’å‡å¼•ç”¨è®¡æ•°ã€‚</li>
</ol>
<p><img src="http://upload-images.jianshu.io/upload_images/2648731-bc5fcaab7de857c0.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">NSMutableArray *array = [[NSMutableArray alloc] init];</span><br><span class="line"></span><br><span class="line">NSNumber *number = [[NSNumber alloc] initWithInt:1337]; // retainCount &gt;= 1</span><br><span class="line">[array addObject:number]; // retainCount &gt;= 2</span><br><span class="line">[number release]; // retainCount &gt;= 1</span><br><span class="line">number = nil;  // é¿å…æ‚¬æŒ‚æŒ‡é’ˆï¼ˆæŒ‡å‘æ— æ•ˆå¯¹è±¡çš„æŒ‡é’ˆï¼‰</span><br><span class="line"></span><br><span class="line">// do somethind with &quot;array&quot;</span><br><span class="line">[array release];</span><br></pre></td></tr></table></figure>
<h4 id="å±æ€§å­˜å–æ–¹æ³•ä¸­çš„å†…å­˜ç®¡ç†"><a href="#å±æ€§å­˜å–æ–¹æ³•ä¸­çš„å†…å­˜ç®¡ç†" class="headerlink" title="å±æ€§å­˜å–æ–¹æ³•ä¸­çš„å†…å­˜ç®¡ç†"></a>å±æ€§å­˜å–æ–¹æ³•ä¸­çš„å†…å­˜ç®¡ç†</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">// strong å±æ€§ï¼š</span><br><span class="line">- (void)setFoo:(id)foo &#123;</span><br><span class="line">    // é¡ºåºå¾ˆé‡è¦ï¼Œå¦‚æœå…ˆ releaseï¼Œåˆ™æ­¤å¯¹è±¡å°†è¢«æ°¸ä¹…å›æ”¶</span><br><span class="line">    [foo retain];   // å…ˆä¿ç•™æ–°å€¼ã€‚</span><br><span class="line">    [_foo release]; // å†é‡Šæ”¾æ—§å€¼ã€‚</span><br><span class="line">    _foo = foo;     // æ›´æ–°å®ä¾‹å˜é‡ï¼Œä»¤å…¶æŒ‡å‘æ–°å€¼ã€‚</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="è‡ªåŠ¨é‡Šæ”¾æ± "><a href="#è‡ªåŠ¨é‡Šæ”¾æ± " class="headerlink" title="è‡ªåŠ¨é‡Šæ”¾æ± "></a>è‡ªåŠ¨é‡Šæ”¾æ± </h4><ul>
<li><code>autorelease</code>  æ–¹æ³•ä¼šåœ¨ç¨åé€’å‡è®¡æ•°ï¼Œé€šå¸¸æ˜¯åœ¨ä¸‹ä¸€æ¬¡ <strong>äº‹ä»¶å¾ªç¯</strong>ï¼ˆevent loopï¼‰æ—¶é€’å‡ã€‚</li>
<li><code>autorelease</code>  èƒ½å»¶é•¿å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸï¼Œä¿è¯å¯¹è±¡åœ¨ <strong>è·¨è¶Šæ–¹æ³•è°ƒç”¨è¾¹ç•Œ</strong> åä¾ç„¶å¯ä»¥å­˜æ´»ä¸€æ®µæ—¶é—´ã€‚</li>
</ul>
<p>ç¤ºä¾‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">- (NSString *)stringValue &#123;</span><br><span class="line">    NSString *str = [[NSString alloc]</span><br><span class="line">                        initWithFormat:@&quot;I am this:%@&quot;,self]; // retainCount &gt;= 1</span><br><span class="line">    return str; // retainCount &gt;= 2</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ­¤å¤„éœ€è¦ä½¿ç”¨ <code>autorelease</code> é‡Šæ”¾å¯¹è±¡ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">- (NSString *)stringValue &#123;</span><br><span class="line">    NSString *str = [[NSString alloc]</span><br><span class="line">                        initWithFormat:@&quot;I am this:%@&quot;,self];</span><br><span class="line">    return [str autorelease];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="å¼•ç”¨å¾ªç¯-ä¿ç•™ç¯"><a href="#å¼•ç”¨å¾ªç¯-ä¿ç•™ç¯" class="headerlink" title="å¼•ç”¨å¾ªç¯/ä¿ç•™ç¯"></a>å¼•ç”¨å¾ªç¯/ä¿ç•™ç¯</h4><p>å¼•ç”¨å¾ªç¯ï¼šå‘ˆç¯çŠ¶ç›¸äº’å¼•ç”¨çš„å¤šä¸ªå¯¹è±¡ï¼Œå†…å­˜æ— æ³•æ­£å¸¸é‡Šæ”¾ï¼Œå¯¼è‡´å†…å­˜æ³„æ¼ã€‚</p>
<p>è§£å†³æ–¹æ³•ï¼šå¼±å¼•ç”¨ï¼ˆweak referenceï¼‰ã€ä»å¤–ç•Œå‘½ä»¤å¾ªç¯ä¸­çš„æŸä¸ªå¯¹è±¡ä¸å†ä¿ç•™å¦å¤–ä¸€ä¸ªå¯¹è±¡ã€‚</p>
<p><img src="http://upload-images.jianshu.io/upload_images/2648731-14d7c85c188b8660.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt></p>
<h4 id="è¦ç‚¹"><a href="#è¦ç‚¹" class="headerlink" title="è¦ç‚¹"></a>è¦ç‚¹</h4><ul>
<li>å¼•ç”¨è®¡æ•°æœºåˆ¶é€šè¿‡å¯ä»¥é€’å¢é€’å‡çš„è®¡æ•°å™¨æ¥ç®¡ç†å†…å­˜ã€‚å¯¹è±¡åˆ›å»ºå¥½åï¼Œå…¶ä¿ç•™è®¡æ•°è‡³å°‘ä¸º1ã€‚è‹¥ä¿ç•™è®¡æ•°ä¸ºæ­£ï¼Œåˆ™å¯¹è±¡ç»§ç»­å­˜æ´»ã€‚å½“ä¿ç•™è®¡æ•°é™ä¸º0æ—¶ï¼Œå¯¹è±¡å°±è¢«é”€æ¯äº†ã€‚</li>
<li>åœ¨å¯¹è±¡ç”Ÿå‘½æœŸä¸­ï¼Œå…¶ä½™å¯¹è±¡é€šè¿‡å¼•ç”¨æ¥ä¿ç•™æˆ–é‡Šæ”¾æ­¤å¯¹è±¡ã€‚ä¿ç•™ä¸é‡Šæ”¾æ“ä½œåˆ†åˆ«ä¼šé€’å¢åŠé€’å‡ä¿ç•™è®¡æ•°ã€‚</li>
</ul>
<h3 id="ç¬¬30æ¡ï¼šä»¥-ARC-ç®€åŒ–å¼•ç”¨è®¡æ•°"><a href="#ç¬¬30æ¡ï¼šä»¥-ARC-ç®€åŒ–å¼•ç”¨è®¡æ•°" class="headerlink" title="ç¬¬30æ¡ï¼šä»¥ ARC ç®€åŒ–å¼•ç”¨è®¡æ•°"></a>ç¬¬30æ¡ï¼šä»¥ ARC ç®€åŒ–å¼•ç”¨è®¡æ•°</h3><ul>
<li>ARC åŸç†ï¼šé™æ€åˆ†æå™¨ï¼ˆstatic analyzerï¼‰å¯ä»¥æŸ¥æ˜å†…å­˜ç®¡ç†é—®é¢˜ï¼Œä¹Ÿå¯ä»¥é¢„å…ˆåŠ å…¥é€‚å½“çš„ä¿ç•™æˆ–é‡Šæ”¾æ“ä½œä»¥é¿å…å†…å­˜ç®¡ç†é—®é¢˜ã€‚</li>
<li>åœ¨ ARC ä¸­ï¼Œä¸èƒ½ç›´æ¥è°ƒç”¨ <code>retain</code>ã€<code>release</code>ã€<code>autorelease</code>ã€<code>dealloc</code> æ–¹æ³•ã€‚</li>
<li>ARC ä¼šç›´æ¥è°ƒç”¨åº•å±‚ C è¯­è¨€å‡½æ•°è‡ªåŠ¨ç®¡ç†å†…å­˜ã€‚</li>
<li>ARC ä¼šè‡ªåŠ¨è°ƒç”¨â€œä¿ç•™â€ä¸â€œé‡Šæ”¾â€æ–¹æ³•ã€‚</li>
<li>ARC åŒ…å«è¿è¡ŒæœŸç»„ä»¶ã€‚</li>
</ul>
<h4 id="ä½¿ç”¨-ARC-æ—¶å¿…é¡»éµå¾ªçš„æ–¹æ³•å‘½åè§„åˆ™"><a href="#ä½¿ç”¨-ARC-æ—¶å¿…é¡»éµå¾ªçš„æ–¹æ³•å‘½åè§„åˆ™" class="headerlink" title="ä½¿ç”¨ ARC æ—¶å¿…é¡»éµå¾ªçš„æ–¹æ³•å‘½åè§„åˆ™"></a>ä½¿ç”¨ ARC æ—¶å¿…é¡»éµå¾ªçš„æ–¹æ³•å‘½åè§„åˆ™</h4><p>è‹¥æ–¹æ³•åä»¥ä¸‹åˆ—è¯è¯­å¼€å¤´ï¼Œåˆ™å…¶è¿”å›çš„å¯¹è±¡å½’è°ƒç”¨è€…æ‰€æœ‰ï¼š</p>
<ul>
<li>alloc</li>
<li>new</li>
<li>copy</li>
<li>mutableCopy</li>
</ul>
<p><strong>å½’è°ƒç”¨è€…æ‰€æœ‰</strong>ï¼šã€è°ƒç”¨ä¸Šè¿°å››ç§æ–¹æ³•çš„é‚£æ®µä»£ç ã€‘è¦è´Ÿè´£ã€é‡Šæ”¾æ–¹æ³•æ‰€è¿”å›çš„å¯¹è±¡ã€‘ã€‚</p>
<h4 id="å˜é‡çš„å†…å­˜ç®¡ç†è¯­ä¹‰"><a href="#å˜é‡çš„å†…å­˜ç®¡ç†è¯­ä¹‰" class="headerlink" title="å˜é‡çš„å†…å­˜ç®¡ç†è¯­ä¹‰"></a>å˜é‡çš„å†…å­˜ç®¡ç†è¯­ä¹‰</h4><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œæ¯ä¸ªå˜é‡éƒ½æ˜¯æŒ‡å‘å¯¹è±¡çš„å¼ºå¼•ç”¨ã€‚</p>
<p>ä¿®é¥°ç¬¦ï¼š</p>
<ul>
<li><code>__strong</code>ï¼šé»˜è®¤è¯­ä¹‰ï¼Œä¿ç•™æ­¤å€¼ã€‚</li>
<li><code>__unsafe_unretained</code>ï¼šä¸ä¿ç•™æ­¤å€¼ï¼Œè¿™ä¹ˆåšå¯èƒ½ä¸å®‰å…¨ï¼Œå› ä¸ºç­‰åˆ°å†æ¬¡ä½¿ç”¨å˜é‡æ—¶ï¼Œå…¶å¯¹è±¡å¯èƒ½å·²ç»å›æ”¶äº†ã€‚</li>
<li><code>__weak</code>ï¼šä¸ä¿ç•™æ­¤å€¼ï¼Œä½†æ˜¯å˜é‡å¯ä»¥å®‰å…¨ä½¿ç”¨ï¼Œå› ä¸ºå¦‚æœç³»ç»ŸæŠŠè¿™ä¸ªå¯¹è±¡å›æ”¶äº†ï¼Œé‚£ä¹ˆå˜é‡ä¹Ÿä¼šè‡ªåŠ¨æ¸…ç©ºã€‚</li>
<li><code>__autoreleasing</code>ï¼šæŠŠå¯¹è±¡â€œæŒ‰å¼•ç”¨ä¼ é€’â€ç»™æ–¹æ³•æ—¶ï¼Œä½¿ç”¨è¿™ä¸ªç‰¹æ®Šçš„ä¿®é¥°ç¬¦ã€‚æ­¤å€¼åœ¨æ–¹æ³•è¿”å›æ—¶è‡ªåŠ¨é‡Šæ”¾ã€‚</li>
</ul>
<h4 id="ARC-å¦‚ä½•æ¸…ç†å®ä¾‹å˜é‡"><a href="#ARC-å¦‚ä½•æ¸…ç†å®ä¾‹å˜é‡" class="headerlink" title="ARC å¦‚ä½•æ¸…ç†å®ä¾‹å˜é‡"></a>ARC å¦‚ä½•æ¸…ç†å®ä¾‹å˜é‡</h4><ul>
<li><p>ARC ä¼šå€Ÿç”¨ Objectice-C++ çš„ä¸€é¡¹ç‰¹æ€§æ¥ç”Ÿæˆæ¸…ç†ä¾‹ç¨‹ã€‚</p>
</li>
<li><p>ARC ä¼šè‡ªåŠ¨ç”Ÿæˆå›æ”¶å¯¹è±¡æ—¶æ‰€æ‰§è¡Œçš„ä»£ç ã€‚</p>
</li>
<li><p><strong>CoreFoundation</strong> å¯¹è±¡ä¸å½’ ARC ç®¡ç†ï¼Œå¼€å‘è€…å¿…é¡»é€‚æ—¶è°ƒç”¨ <code>CFRetain/CFRelease</code>ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">- (void)dealloc &#123;</span><br><span class="line">    CFRelease(coreFoundationObject);</span><br><span class="line">    free(_heapAllocatedMemoryBlob);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="è¦†å†™å†…å­˜ç®¡ç†æ–¹æ³•"><a href="#è¦†å†™å†…å­˜ç®¡ç†æ–¹æ³•" class="headerlink" title="è¦†å†™å†…å­˜ç®¡ç†æ–¹æ³•"></a>è¦†å†™å†…å­˜ç®¡ç†æ–¹æ³•</h4><p>åœ¨ ARC ç¯å¢ƒä¸‹ä¸è¦è¦†å†™ <code>release</code> æ–¹æ³•ã€‚</p>
<h4 id="è¦ç‚¹-1"><a href="#è¦ç‚¹-1" class="headerlink" title="è¦ç‚¹"></a>è¦ç‚¹</h4><ul>
<li>æœ‰ ARC ä¹‹åï¼Œç¨‹åºå‘˜å°±æ— é¡»æ‹…å¿ƒå†…å­˜ç®¡ç†é—®é¢˜äº†ã€‚ä½¿ç”¨ ARC æ¥ç¼–ç¨‹ï¼Œå¯çœå»ç±»ä¸­çš„è®¸å¤š â€œæ ·æ¿ä»£ç â€ã€‚</li>
<li>ARC ç®¡ç†å¯¹è±¡ç”Ÿå‘½æœŸçš„åŠæ³•åŸºæœ¬ä¸Šå°±æ˜¯ï¼šåœ¨åˆé€‚çš„åœ°æ–¹æ’å…¥â€ä¿ç•™â€åŠâ€é‡Šæ”¾â€æ“ä½œã€‚åœ¨ ARC ç¯å¢ƒä¸‹ï¼Œå˜é‡çš„å†…å­˜ç®¡ç†è¯­ä¹‰å¯ä»¥é€šè¿‡<strong>ä¿®é¥°ç¬¦</strong>æŒ‡æ˜ï¼Œè€ŒåŸæ¥åˆ™éœ€è¦æ‰‹å·¥æ‰§è¡Œâ€ä¿ç•™â€åŠâ€é‡Šæ”¾â€æ“ä½œã€‚</li>
<li>ç”±æ–¹æ³•æ‰€è¿”å›çš„å¯¹è±¡ï¼Œå…¶å†…å­˜ç®¡ç†è¯­ä¹‰æ€»æ˜¯é€šè¿‡æ–¹æ³•åæ¥ä½“ç°ã€‚ARC å°†æ­¤ç¡®å®šä¸ºå¼€å‘è€…å¿…é¡»éµå®ˆçš„è§„åˆ™ã€‚</li>
<li>ARC åªè´Ÿè´£ç®¡ç† Objective-C å¯¹è±¡çš„å†…å­˜ã€‚å°¤å…¶è¦æ³¨æ„ï¼š<strong>CoreFoundation</strong> å¯¹è±¡ä¸å½’ ARC ç®¡ç†ï¼Œå¼€å‘è€…å¿…é¡»é€‚æ—¶è°ƒç”¨ <code>CFRetain/CFRelease</code>ã€‚</li>
</ul>
<h3 id="ç¬¬31æ¡ï¼šåœ¨-dealloc-æ–¹æ³•ä¸­åªé‡Šæ”¾å¼•ç”¨å¹¶è§£é™¤ç›‘å¬"><a href="#ç¬¬31æ¡ï¼šåœ¨-dealloc-æ–¹æ³•ä¸­åªé‡Šæ”¾å¼•ç”¨å¹¶è§£é™¤ç›‘å¬" class="headerlink" title="ç¬¬31æ¡ï¼šåœ¨ dealloc æ–¹æ³•ä¸­åªé‡Šæ”¾å¼•ç”¨å¹¶è§£é™¤ç›‘å¬"></a>ç¬¬31æ¡ï¼šåœ¨ dealloc æ–¹æ³•ä¸­åªé‡Šæ”¾å¼•ç”¨å¹¶è§£é™¤ç›‘å¬</h3><ul>
<li><code>dealloc</code>  æ–¹æ³•ä¸»è¦ç”¨äºé‡Šæ”¾å¯¹è±¡æ‰€æ‹¥æœ‰çš„å¼•ç”¨ï¼ˆå³é‡Šæ”¾æ‰€æœ‰ Objectice-C å¯¹è±¡ï¼‰ï¼ŒARC ä¼šé€šè¿‡è‡ªåŠ¨ç”Ÿæˆçš„ .cxx_destruct æ–¹æ³•åœ¨ <code>dealloc</code> ä¸­è‡ªåŠ¨æ·»åŠ é‡Šæ”¾ä»£ç ã€‚</li>
<li>é Objectice-C å¯¹è±¡ï¼ˆå¦‚ <strong>CoreFoundation</strong> å¯¹è±¡ï¼‰åˆ™å¿…é¡»æ‰‹å·¥é‡Šæ”¾ã€‚</li>
<li>è¿˜éœ€è¦æ¸…ç†è§‚æµ‹è¡Œä¸ºï¼ˆobservation behaviorï¼‰ï¼Œæ³¨é”€é€šçŸ¥ã€‚</li>
<li>å¼€é”€è¾ƒå¤§æˆ–ç³»ç»Ÿå†…ç¨€ç¼ºèµ„æºä¸åº”åœ¨ <code>dealloc</code> ä¸­é‡Šæ”¾ï¼Œå½“åº”ç”¨ç¨‹åºç”¨å®Œèµ„æºååº”åŠæ—¶é‡Šæ”¾ï¼Œè¿˜æœ‰ä¸€ä¸ªåŸå› æ˜¯ï¼šç³»ç»Ÿå¹¶ä¸ä¿è¯æ¯ä¸ªåˆ›å»ºå‡ºæ¥çš„å¯¹è±¡çš„ <code>dealloc</code> éƒ½ä¼šæ‰§è¡Œã€‚</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">- (void)dealloc &#123;</span><br><span class="line">    CFRelease(coreFoundationObject);</span><br><span class="line">    [[NSNotificationCenter defaultCenter] removeObserver:self];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><p>å¦‚æœå¯¹è±¡ç®¡ç†ç€æŸäº›èµ„æºï¼Œé‚£ä¹ˆåœ¨ <code>dealloc</code> æ–¹æ³•ä¸­ä¹Ÿè¦è°ƒç”¨â€œæ¸…ç†æ–¹æ³•â€ï¼Œä»¥é˜²å¼€å‘è€…å¿˜è®°æ¸…ç†è¿™äº›èµ„æºã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">- (void)close &#123;</span><br><span class="line">    /** clean up resoureces */</span><br><span class="line">    _close = YES;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (void)dealloc &#123;</span><br><span class="line">    if (!_close) &#123;</span><br><span class="line">        NSLog(@&quot;ERROR:close was not called before dealloc&quot;);</span><br><span class="line">        [self close];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="è¦ç‚¹-2"><a href="#è¦ç‚¹-2" class="headerlink" title="è¦ç‚¹"></a>è¦ç‚¹</h4><ul>
<li>åœ¨ <code>dealloc</code> æ–¹æ³•é‡Œï¼Œåº”è¯¥åšçš„äº‹æƒ…å°±æ˜¯é‡Šæ”¾æŒ‡å‘å…¶å®ƒå¯¹è±¡çš„å¼•ç”¨ï¼Œå¹¶å–æ¶ˆåŸæ¥è®¢é˜…çš„â€é”®å€¼è§‚æµ‹â€ï¼ˆKVOï¼‰æˆ– <strong>NSNotificationCenter</strong> ç­‰é€šçŸ¥ï¼Œä¸è¦åšå…¶ä»–äº‹æƒ…ã€‚</li>
<li>å¦‚æœå¯¹è±¡æŒæœ‰æ–‡ä»¶æè¿°ç¬¦ç­‰ç³»ç»Ÿèµ„æºï¼Œé‚£ä¹ˆåº”è¯¥ä¸“é—¨ç¼–å†™ä¸€ä¸ªæ–¹æ³•æ¥é‡Šæ”¾æ­¤ç§èµ„æºã€‚è¿™æ ·çš„ç±»è¦å’Œå…¶ä½¿ç”¨è€…çº¦å®šï¼šç”¨å®Œèµ„æºåå¿…é¡»è°ƒç”¨ <code>close</code> æ–¹æ³•ã€‚</li>
<li>æ‰§è¡Œå¼‚æ­¥ä»»åŠ¡çš„æ–¹æ³•ä¸åº”åœ¨ <code>dealloc</code> é‡Œè°ƒç”¨ï¼›åªèƒ½åœ¨æ­£å¸¸çŠ¶æ€ä¸‹æ‰§è¡Œçš„é‚£äº›æ–¹æ³•ä¹Ÿä¸åº”åœ¨ <code>dealloc</code> é‡Œè°ƒç”¨ï¼Œå› ä¸ºæ­¤æ—¶å¯¹è±¡å·²å¤„äºæ­£åœ¨å›æ”¶çš„çŠ¶æ€äº†ã€‚</li>
</ul>
<h3 id="ç¬¬32æ¡ï¼šç¼–å†™â€œå¼‚å¸¸å®‰å…¨ä»£ç â€æ—¶ç•™æ„å†…å­˜ç®¡ç†é—®é¢˜"><a href="#ç¬¬32æ¡ï¼šç¼–å†™â€œå¼‚å¸¸å®‰å…¨ä»£ç â€æ—¶ç•™æ„å†…å­˜ç®¡ç†é—®é¢˜" class="headerlink" title="ç¬¬32æ¡ï¼šç¼–å†™â€œå¼‚å¸¸å®‰å…¨ä»£ç â€æ—¶ç•™æ„å†…å­˜ç®¡ç†é—®é¢˜"></a>ç¬¬32æ¡ï¼šç¼–å†™â€œå¼‚å¸¸å®‰å…¨ä»£ç â€æ—¶ç•™æ„å†…å­˜ç®¡ç†é—®é¢˜</h3><ul>
<li>åœ¨ Objective-C ä¸­ï¼Œå¼‚å¸¸åªåº”åœ¨å‘ç”Ÿä¸¥é‡é”™è¯¯åæŠ›å‡ºï¼ˆå‚è§ç¬¬21æ¡ï¼‰ã€‚</li>
<li>åœ¨ <code>try</code> å—ä¸­ï¼Œå¦‚æœå…ˆä¿ç•™äº†æŸä¸ªå¯¹è±¡ï¼Œé‡Šæ”¾å®ƒä¹‹å‰åˆæŠ›å‡ºäº†å¼‚å¸¸ï¼Œå°±ä¼šå¯¼è‡´å†…å­˜æ³„æ¼ã€‚è€Œä¸” ARC ä¸ä¼šè‡ªåŠ¨å¤„ç†è¿™ä¸ªé—®é¢˜ã€‚</li>
<li>å¯ä»¥åœ¨ç¼–è¯‘å™¨ä¸­å¼€å¯ <code>-fobjc-arc-exceptions</code>ï¼ˆé»˜è®¤å…³é—­ï¼‰ï¼Œ è®© ARC ç”Ÿæˆå®‰å…¨å¤„ç†å¼‚å¸¸æ‰€ç”¨çš„é™„åŠ ä»£ç ã€‚</li>
<li>Objective-C++æ¨¡å¼ä¸‹ï¼Œç¼–è¯‘å™¨ä¼šè‡ªåŠ¨æ‰“å¼€ <code>-fobjc-arc-exceptions</code>æ ‡å¿—ã€‚</li>
</ul>
<h4 id="è¦ç‚¹-3"><a href="#è¦ç‚¹-3" class="headerlink" title="è¦ç‚¹"></a>è¦ç‚¹</h4><ul>
<li>æ•è·å¼‚å¸¸æ—¶ï¼Œä¸€å®šè¦æ³¨æ„å°† try å—å†…æ‰€åˆ›ç«‹çš„å¯¹è±¡æ¸…ç†å¹²å‡€ã€‚</li>
<li>åœ¨é»˜è®¤æƒ…å†µä¸‹ï¼ŒARC ä¸ç”Ÿæˆå®‰å…¨å¤„ç†å¼‚å¸¸æ‰€éœ€çš„æ¸…ç†ä»£ç ã€‚å¼€å¯ç¼–è¯‘å™¨æ ‡å¿—åï¼Œå¯ç”Ÿæˆè¿™ç§ä»£ç ï¼Œä¸è¿‡ä¼šå¯¼è‡´åº”ç”¨ç¨‹åºå˜å¤§ï¼Œè€Œä¸”ä¼šé™ä½è¿è¡Œæ•ˆç‡ã€‚</li>
</ul>
<h3 id="ç¬¬33æ¡ï¼šä»¥å¼±å¼•ç”¨é¿å…ä¿ç•™ç¯"><a href="#ç¬¬33æ¡ï¼šä»¥å¼±å¼•ç”¨é¿å…ä¿ç•™ç¯" class="headerlink" title="ç¬¬33æ¡ï¼šä»¥å¼±å¼•ç”¨é¿å…ä¿ç•™ç¯"></a>ç¬¬33æ¡ï¼šä»¥å¼±å¼•ç”¨é¿å…ä¿ç•™ç¯</h3><p><img src="http://upload-images.jianshu.io/upload_images/2648731-6fe8b8ec7b16342f.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt></p>
<ul>
<li>å‡ ä¸ªå¯¹è±¡ç›¸äº’å¼•ç”¨ä¼šå¯¼è‡´å¼•ç”¨å¾ªç¯é€ æˆå†…å­˜æ³„éœ²ã€‚</li>
<li>é¿å…å¼•ç”¨å¾ªç¯çš„æœ€ä½³æ–¹å¼å°±æ˜¯å¼±å¼•ç”¨ï¼ˆweakï¼‰ã€‚</li>
<li>unsafe_unretainedï¼ˆä¸ä¿ç•™ä¹Ÿä¸é‡Šæ”¾ï¼‰ã€assignï¼ˆé€šå¸¸åªç”¨äºæ•´ä½“ç±»å‹ï¼Œå¦‚ intã€floatã€ç»“æ„ä½“ç­‰ï¼‰ã€weakï¼ˆå±æ€§è¢«å›æ”¶åä¼šè‡ªåŠ¨è®¾ç½®ä¸ºnilï¼‰ ä¹‹é—´çš„åŒºåˆ«ï¼Ÿ</li>
</ul>
<p><img src="http://upload-images.jianshu.io/upload_images/2648731-394995e450c46083.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt></p>
<h4 id="è¦ç‚¹-4"><a href="#è¦ç‚¹-4" class="headerlink" title="è¦ç‚¹"></a>è¦ç‚¹</h4><ul>
<li>å°†æŸäº›å¼•ç”¨è®¾ä¸º <code>weak</code>ï¼Œå¯é¿å…å‡ºç°å¼•ç”¨å¾ªç¯ã€‚</li>
<li><code>weak</code> å¼•ç”¨å¯ä»¥è‡ªåŠ¨æ¸…ç©ºï¼Œä¹Ÿå¯ä»¥ä¸è‡ªåŠ¨æ¸…ç©ºã€‚è‡ªåŠ¨æ¸…ç©ºæ˜¯éšç€ARCè€Œå¼•å…¥çš„æ–°ç‰¹æ€§ï¼Œç”± runtime æ¥å®ç°ï¼Œåœ¨å…·å¤‡è‡ªåŠ¨æ¸…ç©ºåŠŸèƒ½çš„å¼±å¼•ç”¨ä¸Šï¼Œå¯ä»¥éšæ„è¯»å–å…¶æ•°æ®ï¼Œå› ä¸ºè¿™ç§å¼•ç”¨ä¸ä¼šæŒ‡å‘å·²ç»å›æ”¶è¿‡çš„å¯¹è±¡ã€‚</li>
</ul>
<h3 id="ç¬¬34æ¡ï¼šä»¥â€œè‡ªåŠ¨é‡Šæ”¾æ± â€é™ä½å†…å­˜å³°å€¼"><a href="#ç¬¬34æ¡ï¼šä»¥â€œè‡ªåŠ¨é‡Šæ”¾æ± â€é™ä½å†…å­˜å³°å€¼" class="headerlink" title="ç¬¬34æ¡ï¼šä»¥â€œè‡ªåŠ¨é‡Šæ”¾æ± â€é™ä½å†…å­˜å³°å€¼"></a>ç¬¬34æ¡ï¼šä»¥â€œè‡ªåŠ¨é‡Šæ”¾æ± â€é™ä½å†…å­˜å³°å€¼</h3><p><strong>è‡ªåŠ¨é‡Šæ”¾æ± ï¼ˆautorelease poolï¼‰</strong>ï¼šå­˜æ”¾éœ€è¦åœ¨ç¨åæŸä¸ªæ—¶åˆ»é‡Šæ”¾çš„å¯¹è±¡ã€‚</p>
<p>é‡Šæ”¾å¯¹è±¡çš„ä¸¤ç§æ–¹å¼ï¼š</p>
<ol>
<li>è°ƒç”¨ <code>release</code> æ–¹æ³•ï¼Œä½¿å…¶å¼•ç”¨è®¡æ•°ç«‹å³é€’å‡ï¼›</li>
<li>è°ƒç”¨ <code>autorelease</code> æ–¹æ³•ï¼Œå°†å¯¹è±¡åŠ å…¥è‡ªåŠ¨é‡Šæ”¾æ± ä¸­ã€‚æ¸…ç©ºè‡ªåŠ¨é‡Šæ”¾æ± æ—¶ï¼Œç³»ç»Ÿä¼šå‘å…¶ä¸­çš„å¯¹è±¡å‘é€ <code>release</code> æ¶ˆæ¯ï¼›</li>
</ol>
<p>åˆ›å»ºè‡ªåŠ¨é‡Šæ”¾æ± è¯­æ³•ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">@autoreleasepool &#123;</span><br><span class="line">   // ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ç¨‹åºå‘˜æ— éœ€è‡ªå·±åˆ›å»ºè‡ªåŠ¨é‡Šæ”¾æ± ï¼Œç³»ç»Ÿè‡ªåŠ¨åˆ›å»ºçš„çº¿ç¨‹ä¸­é»˜è®¤æœ‰è‡ªåŠ¨é‡Šæ”¾æ± ã€‚é™¤äº† <code>main</code> å‡½æ•°ä¸­ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">int main(int argc, char * argv[]) &#123;</span><br><span class="line">    @autoreleasepool &#123;</span><br><span class="line">        return UIApplicationMain(argc, argv, nil, NSStringFromClass([AppDelegate class]));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è‡ªåŠ¨é‡Šæ”¾æ± çš„åµŒå¥—ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">@autoreleasepool &#123;</span><br><span class="line">    NSString *string = [NSString stringWithFormat:@&quot;hello&quot;];</span><br><span class="line">    @autoreleasepool &#123;</span><br><span class="line">        NSNumber *number = [NSNumber numberWithInteger:1];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>â‡ï¸åµŒå¥—è‡ªåŠ¨é‡Šæ”¾æ± å¯ä»¥æ§åˆ¶åº”ç”¨ç¨‹åºçš„å†…å­˜å³°å€¼ï¼Œä½¿å…¶ä¸è‡³è¿‡é«˜ã€‚</p>
<p><strong>å†…å­˜å³°å€¼ï¼ˆhigh-memory waterlineï¼‰</strong>ï¼šåº”ç”¨ç¨‹åºåœ¨æŸä¸ªç‰¹å®šæ—¶æ®µå†…çš„æœ€å¤§å†…å­˜ç”¨é‡ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">NSArray *databaseRecords = /** ... */ ;</span><br><span class="line">NSMutableArray *people = [NSMutableArray new];</span><br><span class="line">// å°†å¾ªç¯å†…çš„ä»£ç åŒ…è£¹åœ¨è‡ªåŠ¨é‡Šæ”¾æ± ä¸­</span><br><span class="line">// ç³»ç»Ÿå°±ä¼šåœ¨å—æœ«å°¾é‡Šæ”¾å¯¹è±¡ï¼Œè€Œä¸æ˜¯åœ¨ä¸»çº¿ç¨‹é›†ä¸­é‡Šæ”¾ã€‚</span><br><span class="line">for (NSDictionary *record in databaseRecords) &#123;</span><br><span class="line">    @autoreleasepool &#123;</span><br><span class="line">        EOCPerson *person = [[EOCPerson alloc] initWithRecord:record];</span><br><span class="line">        [people addObject:person];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>â‡ï¸æ˜¯å¦åº”è¯¥ä½¿ç”¨è‡ªåŠ¨é‡Šæ”¾æ± ä¼˜åŒ–æ•ˆç‡è¿˜åº”è§†æƒ…å†µè€Œå®šï¼Œå› ä¸ºåˆ›å»ºè‡ªåŠ¨é‡Šæ”¾æ± æœ¬èº«ä¹Ÿæœ‰ä¸€å®šçš„å¼€é”€ã€‚</p>
<p><strong>@autoreleasepool</strong> è¯­æ³•çš„å¦ä¸€ä¸ªå¥½å¤„ï¼šæ¯ä¸ªè‡ªåŠ¨é‡Šæ”¾æ± å‡æœ‰å…¶èŒƒå›´ï¼Œå¯ä»¥é¿å…æ— æ„é—´è¯¯ç”¨åœ¨è‡ªåŠ¨é‡Šæ”¾æ± ä¸­å·²ç»è¢«ç³»ç»Ÿå›æ”¶çš„å¯¹è±¡ã€‚</p>
<h4 id="è¦ç‚¹-5"><a href="#è¦ç‚¹-5" class="headerlink" title="è¦ç‚¹"></a>è¦ç‚¹</h4><ul>
<li>è‡ªåŠ¨é‡Šæ”¾æ± æ’å¸ƒåœ¨æ ˆä¸­ï¼Œå¯¹è±¡æ”¶åˆ° <code>autorelease</code> æ¶ˆæ¯åï¼Œç³»ç»Ÿå°†å…¶æ”¾å…¥æœ€é¡¶ç«¯çš„æ± é‡Œã€‚</li>
<li>åˆç†è¿ç”¨è‡ªåŠ¨é‡Šæ”¾æ± ï¼Œå¯é™ä½åº”ç”¨ç¨‹åºçš„å†…å­˜å³°å€¼ã€‚</li>
<li><strong>@autoreleasepool</strong> è¿™ç§æ–°å¼å†™æ³•èƒ½åˆ›å»ºå‡ºæ›´ä¸ºè½»ä¾¿çš„è‡ªåŠ¨é‡Šæ”¾æ± ã€‚</li>
</ul>
<h3 id="ç¬¬35æ¡ï¼šç”¨â€œåƒµå°¸å¯¹è±¡â€è°ƒè¯•å†…å­˜ç®¡ç†é—®é¢˜"><a href="#ç¬¬35æ¡ï¼šç”¨â€œåƒµå°¸å¯¹è±¡â€è°ƒè¯•å†…å­˜ç®¡ç†é—®é¢˜" class="headerlink" title="ç¬¬35æ¡ï¼šç”¨â€œåƒµå°¸å¯¹è±¡â€è°ƒè¯•å†…å­˜ç®¡ç†é—®é¢˜"></a>ç¬¬35æ¡ï¼šç”¨â€œåƒµå°¸å¯¹è±¡â€è°ƒè¯•å†…å­˜ç®¡ç†é—®é¢˜</h3><p>å‘ä¸šå·²å›æ”¶çš„å¯¹è±¡å‘é€æ¶ˆæ¯æ˜¯ä¸å®‰å…¨çš„ï¼Œå¯è¡Œä¸å¦å®Œå…¨å–å†³äº<strong>å¯¹è±¡æ‰€å å†…å­˜æœ‰æ²¡æœ‰ä¸ºå…¶ä»–å†…å®¹æ‰€è¦†å†™</strong>ã€‚</p>
<h4 id="è°ƒè¯•å†…å­˜ç®¡ç†çš„æœ€ä½³æ–¹å¼ï¼šåƒµå°¸å¯¹è±¡ï¼ˆZombie-Objectï¼‰"><a href="#è°ƒè¯•å†…å­˜ç®¡ç†çš„æœ€ä½³æ–¹å¼ï¼šåƒµå°¸å¯¹è±¡ï¼ˆZombie-Objectï¼‰" class="headerlink" title="è°ƒè¯•å†…å­˜ç®¡ç†çš„æœ€ä½³æ–¹å¼ï¼šåƒµå°¸å¯¹è±¡ï¼ˆZombie Objectï¼‰"></a>è°ƒè¯•å†…å­˜ç®¡ç†çš„æœ€ä½³æ–¹å¼ï¼šåƒµå°¸å¯¹è±¡ï¼ˆZombie Objectï¼‰</h4><p>â‡ï¸åŸç†ï¼šå¯ç”¨åƒµå°¸å¯¹è±¡è°ƒè¯•åŠŸèƒ½ä¹‹åï¼Œè¿è¡ŒæœŸç³»ç»Ÿä¼šæŠŠæ‰€æœ‰å·²ç»å›æ”¶çš„å®ä¾‹è½¬åŒ–æˆç‰¹æ®Šçš„â€åƒµå°¸å¯¹è±¡â€ï¼Œè€Œä¸ä¼šçœŸæ­£å›æ”¶å®ƒä»¬ã€‚è¿™ç§å¯¹è±¡æ‰€åœ¨çš„æ ¸å¿ƒå†…å­˜æ— æ³•é‡ç”¨ï¼Œå› æ­¤ä¸å¯èƒ½é­åˆ°è¦†å†™ã€‚åƒµå°¸å¯¹è±¡æ”¶åˆ°æ¶ˆæ¯åï¼Œä¼šæŠ›å‡ºå¼‚å¸¸ï¼Œå…¶ä¸­å‡†ç¡®è¯´æ˜äº†å‘é€è¿‡æ¥çš„æ¶ˆæ¯ï¼Œå¹¶æè¿°äº†å›æ”¶ä¹‹å‰çš„é‚£ä¸ªå¯¹è±¡ã€‚</p>
<p>å°† <strong>NszombieEnabled</strong> ç¯å¢ƒå˜é‡è®¾ä¸º <strong>YES</strong>, å³å¯å¼€å¯æ­¤åŠŸèƒ½ã€‚</p>
<p>â‡ï¸ä½ç½®ï¼šXcodeèœå•æ  â†’ Product â†’ Scheme â†’ Edit Scheme â†’ Run â†’ Diagnosticsè¯Šæ–­é€‰é¡¹ â†’ Memory Management â†’ å‹¾é€‰ Zombie Objectsã€‚</p>
<p><img src="http://upload-images.jianshu.io/upload_images/2648731-c7669b832c47ed88.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt></p>
<p>âš ï¸ APP æ‰“åŒ…å‘å¸ƒä¹‹å‰ä¸€å®šè¦å–æ¶ˆæ­¤å‹¾é€‰ï¼</p>
<h4 id="è¦ç‚¹-6"><a href="#è¦ç‚¹-6" class="headerlink" title="è¦ç‚¹"></a>è¦ç‚¹</h4><ul>
<li>ç³»ç»Ÿåœ¨å›æ”¶å¯¹è±¡æ—¶ï¼Œå¯ä»¥ä¸å°†å…¶çœŸçš„å›æ”¶ï¼Œè€Œæ˜¯æŠŠå®ƒè½¬åŒ–ä¸ºåƒµå°¸å¯¹è±¡ã€‚é€šè¿‡ç¯å¢ƒå˜é‡ <strong>NSZombieEnabled</strong> å¯å¼€å¯æ­¤åŠŸèƒ½ã€‚</li>
<li>ç³»ç»Ÿä¼šä¿®æ”¹å¯¹è±¡çš„ isa æŒ‡é’ˆï¼Œä»¤å…¶æŒ‡å‘ç‰¹æ®Šçš„åƒµå°¸ç±»ï¼Œä»è€Œä½¿è¯¥å¯¹è±¡å˜ä¸ºåƒµå°¸å¯¹è±¡ã€‚åƒµå°¸ç±»èƒ½å¤Ÿå“åº”æ‰€æœ‰çš„selectorï¼Œå“åº”æ–¹å¼ä¸ºï¼šæ‰“å°ä¸€æ¡åŒ…å«æ¶ˆæ¯å†…å®¹åŠå…¶æ¥å—è€…çš„æ¶ˆæ¯ï¼Œç„¶åç»ˆæ­¢åº”ç”¨ç¨‹åºã€‚</li>
</ul>
<h3 id="ç¬¬36æ¡ï¼šä¸è¦ä½¿ç”¨-retainCount"><a href="#ç¬¬36æ¡ï¼šä¸è¦ä½¿ç”¨-retainCount" class="headerlink" title="ç¬¬36æ¡ï¼šä¸è¦ä½¿ç”¨ retainCount"></a>ç¬¬36æ¡ï¼šä¸è¦ä½¿ç”¨ retainCount</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">- (NSUInteger)retainCount OBJC_ARC_UNAVAILABLE; // æŸ¥è¯¢å¯¹è±¡å½“å‰çš„ä¿ç•™è®¡æ•°</span><br></pre></td></tr></table></figure>
<p>â‡ï¸ <code>retainCount</code> æ‰€è¿”å›çš„ä¿ç•™è®¡æ•°åªæ˜¯æŸä¸ªç»™å®šæ—¶é—´ç‚¹ä¸Šçš„å€¼ï¼Œè¯¥æ–¹æ³•å¹¶æœªè€ƒè™‘åˆ°è‡ªåŠ¨é‡Šæ”¾æ± çš„æƒ…å†µã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">// é”™è¯¯ç¤ºä¾‹ï¼š</span><br><span class="line">while ([object retainConut]) &#123;</span><br><span class="line">    [object release]</span><br><span class="line">&#125;</span><br><span class="line">// é”™è¯¯ä¸€ï¼šæ²¡æœ‰è€ƒè™‘åˆ°åç»­çš„è‡ªåŠ¨é‡Šæ”¾æ“ä½œï¼›</span><br><span class="line">// é”™è¯¯äºŒï¼šretainConut å¯èƒ½æ°¸è¿œä¸è¿”å›0ï¼›</span><br></pre></td></tr></table></figure>
<h4 id="è¦ç‚¹-7"><a href="#è¦ç‚¹-7" class="headerlink" title="è¦ç‚¹"></a>è¦ç‚¹</h4><ul>
<li>å¯¹è±¡çš„ä¿ç•™è®¡æ•°çœ‹ä¼¼æœ‰ç”¨ï¼Œå®åˆ™ä¸ç„¶ï¼Œå› ä¸ºä»»ä½•ç»™å®šæ—¶é—´ç‚¹ä¸Šçš„â€ç»å¯¹ä¿ç•™è®¡æ•°â€ï¼ˆabsoulte retain countï¼‰éƒ½æ— æ³•åæ˜ å¯¹è±¡ç”Ÿå‘½æœŸçš„å…¨è²Œã€‚</li>
<li>å¼•å…¥ ARC åï¼Œ<code>retainCount</code> æ–¹æ³•å°±æ­£å¼åºŸæ­¢äº†ï¼Œåœ¨ ARC ä¸‹è°ƒç”¨è¯¥æ–¹æ³•ä¼šå¯¼è‡´ç¼–è¯‘å™¨æŠ¥é”™ã€‚</li>
</ul>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://andy0570.com/2017/08/15/å››ã€åè®®ä¸åˆ†ç±»/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ç‹¬æœ¨èˆŸçš„æœ¨">
      <meta itemprop="description" content="æœ‰æ—¶å€™é˜³å…‰å¾ˆå¥½ æœ‰æ—¶å€™é˜³å…‰å¾ˆæš—">
      <meta itemprop="image" content="https://ws1.sinaimg.cn/large/006tNc79gy1g22m14458rj30u014xu0x.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ç‹¬æœ¨èˆŸçš„æœ¨">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2017/08/15/å››ã€åè®®ä¸åˆ†ç±»/" class="post-title-link" itemprop="url">å››ã€åè®®ä¸åˆ†ç±»</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              

              
                
              

              <time title="åˆ›å»ºæ—¶é—´ï¼š2017-08-15 16:54:00" itemprop="dateCreated datePublished" datetime="2017-08-15T16:54:00+08:00">2017-08-15</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">æ›´æ–°äº</span>
                
                <time title="ä¿®æ”¹æ—¶é—´ï¼š2019-04-16 00:12:19" itemprop="dateModified" datetime="2019-04-16T00:12:19+08:00">2019-04-16</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/ã€ŠEffective-Objective-C-2-0ã€‹/" itemprop="url" rel="index"><span itemprop="name">ã€ŠEffective Objective-C 2.0ã€‹</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          
            <span id="/2017/08/15/å››ã€åè®®ä¸åˆ†ç±»/" class="leancloud_visitors" data-flag-title="å››ã€åè®®ä¸åˆ†ç±»">
              <span class="post-meta-divider">|</span>
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              
                <span class="post-meta-item-text">é˜…è¯»æ¬¡æ•°ï¼š</span>
              
                <span class="leancloud-visitors-count"></span>
            </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body han-init-context" itemprop="articleBody">

      
      

      
        
          
            <h1 id="ã€ŠEffective-Objective-C-2-0-ç¼–å†™é«˜è´¨é‡iOSä¸OS-Xä»£ç çš„52ä¸ªæœ‰æ•ˆæ–¹æ³•-ã€‹å­¦ä¹ ç¬”è®°"><a href="#ã€ŠEffective-Objective-C-2-0-ç¼–å†™é«˜è´¨é‡iOSä¸OS-Xä»£ç çš„52ä¸ªæœ‰æ•ˆæ–¹æ³•-ã€‹å­¦ä¹ ç¬”è®°" class="headerlink" title="ã€ŠEffective Objective-C 2.0  ç¼–å†™é«˜è´¨é‡iOSä¸OS Xä»£ç çš„52ä¸ªæœ‰æ•ˆæ–¹æ³• ã€‹å­¦ä¹ ç¬”è®°"></a>ã€ŠEffective Objective-C 2.0  ç¼–å†™é«˜è´¨é‡iOSä¸OS Xä»£ç çš„52ä¸ªæœ‰æ•ˆæ–¹æ³• ã€‹å­¦ä¹ ç¬”è®°</h1><p><img src="http://upload-images.jianshu.io/upload_images/2648731-6096cbfd905b1eb0.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt></p>
<h2 id="ç¬¬4ç« -åè®®ä¸åˆ†ç±»"><a href="#ç¬¬4ç« -åè®®ä¸åˆ†ç±»" class="headerlink" title="ç¬¬4ç«  åè®®ä¸åˆ†ç±»"></a>ç¬¬4ç«  åè®®ä¸åˆ†ç±»</h2><h3 id="ç¬¬23æ¡ï¼šé€šè¿‡å§”æ‰˜ä¸æ•°æ®æºåè®®è¿›è¡Œå¯¹è±¡é—´é€šä¿¡"><a href="#ç¬¬23æ¡ï¼šé€šè¿‡å§”æ‰˜ä¸æ•°æ®æºåè®®è¿›è¡Œå¯¹è±¡é—´é€šä¿¡" class="headerlink" title="ç¬¬23æ¡ï¼šé€šè¿‡å§”æ‰˜ä¸æ•°æ®æºåè®®è¿›è¡Œå¯¹è±¡é—´é€šä¿¡"></a>ç¬¬23æ¡ï¼šé€šè¿‡å§”æ‰˜ä¸æ•°æ®æºåè®®è¿›è¡Œå¯¹è±¡é—´é€šä¿¡</h3><h4 id="å§”æ‰˜æ¨¡å¼ï¼ˆDelegate-patternï¼‰"><a href="#å§”æ‰˜æ¨¡å¼ï¼ˆDelegate-patternï¼‰" class="headerlink" title="å§”æ‰˜æ¨¡å¼ï¼ˆDelegate patternï¼‰"></a>å§”æ‰˜æ¨¡å¼ï¼ˆDelegate patternï¼‰</h4><p>ä¸»æ—¨ï¼šå®šä¹‰ä¸€å¥—æ¥å£ï¼ŒæŸä¸ªå¯¹è±¡è‹¥æƒ³æ¥å—å¦ä¸€ä¸ªå¯¹è±¡çš„å§”æ‰˜ï¼Œåˆ™éœ€è¦éµä»æ­¤æ¥å£ï¼Œä»¥ä¾¿æˆä¸ºå…¶â€œå§”æ‰˜å¯¹è±¡â€ï¼ˆdelegateï¼‰ã€‚è€Œè¿™â€œå¦ä¸€ä¸ªå¯¹è±¡â€åˆ™å¯ä»¥ç»™å…¶å§”æ‰˜å¯¹è±¡å›ä¼ ä¸€äº›ä¿¡æ¯ï¼Œä¹Ÿå¯ä»¥åœ¨å‘ç”Ÿç›¸å…³äº‹ä»¶æ—¶é€šçŸ¥å§”æ‰˜å¯¹è±¡ã€‚</p>
<h5 id="EOCNetworkFetcherDelegate-h"><a href="#EOCNetworkFetcherDelegate-h" class="headerlink" title="EOCNetworkFetcherDelegate.h"></a>EOCNetworkFetcherDelegate.h</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">#import &lt;Foundation/Foundation.h&gt;</span><br><span class="line">@class EOCNetworkFetcher;</span><br><span class="line"></span><br><span class="line">// å§”æ‰˜åè®®åé€šå¸¸æ˜¯åœ¨ç›¸å…³ç±»ååé¢åŠ ä¸Š Delegateã€‚</span><br><span class="line">// å§”æ‰˜æ¨¡å¼:å¯¹è±¡æŠŠåº”å¯¹æŸä¸ªè¡Œä¸ºçš„è´£ä»»å§”æ‰˜ç»™å¦ä¸€ä¸ªç±»ã€‚</span><br><span class="line">@protocol EOCNetworkFetcherDelegate &lt;NSObject&gt;</span><br><span class="line">@optional</span><br><span class="line">- (void)networkFetcher:(EOCNetworkFetcher *)fetcher</span><br><span class="line">        didReceiveData:(NSData *)data;</span><br><span class="line">- (void)networkFetcher:(EOCNetworkFetcher *)fetcher</span><br><span class="line">      didFailWithError:(NSError *)error;</span><br><span class="line">- (void)networkFetcher:(EOCNetworkFetcher *)fetcher</span><br><span class="line">        didUpdateProgressTo:(float)progress;</span><br><span class="line">- (BOOL)networkFetcher:(EOCNetworkFetcher *)fetcher</span><br><span class="line">        shouldFollowRedirectToURL:(NSURL *)url;</span><br><span class="line">@end</span><br></pre></td></tr></table></figure>
<h5 id="EOCNetworkFetcher-ç±»"><a href="#EOCNetworkFetcher-ç±»" class="headerlink" title="EOCNetworkFetcher ç±»"></a>EOCNetworkFetcher ç±»</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line">//  EOCNetworkFetcher.h</span><br><span class="line">#import &lt;Foundation/Foundation.h&gt;</span><br><span class="line">#import &quot;EOCNetworkFetcherDelegate.h&quot;</span><br><span class="line"></span><br><span class="line">@interface EOCNetworkFetcher : NSObject</span><br><span class="line">// ä½¿ç”¨å±æ€§å®šä¹‰å…¶å§”æ‰˜å¯¹è±¡</span><br><span class="line">// ä½¿ç”¨ weak å…³é”®å­—ï¼Œé¿å…å¼•ç”¨å¾ªç¯</span><br><span class="line">@property (nonatomic, weak) id&lt;EOCNetworkFetcherDelegate&gt; delegate;</span><br><span class="line">@end</span><br><span class="line"></span><br><span class="line">#import &quot;EOCNetworkFetcher.h&quot;</span><br><span class="line"></span><br><span class="line">//  EOCNetworkFetcher.m</span><br><span class="line">@interface EOCNetworkFetcher () &#123;</span><br><span class="line">    // â‡ï¸ ä½¿ç”¨ bitfield æ•°æ®ç±»å‹</span><br><span class="line">    // ç¼“å­˜å§”æ‰˜å¯¹è±¡æ˜¯å¦èƒ½å“åº”åè®®ä¸­çš„ç›¸å…³æ–¹æ³•</span><br><span class="line">    struct &#123;</span><br><span class="line">        unsigned int didReceiveData            : 1;</span><br><span class="line">        unsigned int didFailWithError          : 1;</span><br><span class="line">        unsigned int didUpdateProgressTo       : 1;</span><br><span class="line">        unsigned int shouldFollowRedirectToURL : 1;</span><br><span class="line">    &#125; _delegateFlags;</span><br><span class="line">&#125;</span><br><span class="line">@end</span><br><span class="line">@implementation EOCNetworkFetcher</span><br><span class="line"></span><br><span class="line">- (void)setDelegate:(id&lt;EOCNetworkFetcherDelegate&gt;)delegate &#123;</span><br><span class="line">    _delegate = delegate;</span><br><span class="line">    // â‘  â‡ï¸å®ç°ç¼“å­˜åŠŸèƒ½</span><br><span class="line">    _delegateFlags.didReceiveData = [delegate respondsToSelector:@selector(networkFetcher:didReceiveData:)];</span><br><span class="line">    _delegateFlags.didFailWithError = [delegate respondsToSelector:@selector(networkFetcher:didFailWithError:)];</span><br><span class="line">    _delegateFlags.didUpdateProgressTo = [delegate respondsToSelector:@selector(networkFetcher:didUpdateProgressTo:)];</span><br><span class="line">    _delegateFlags.shouldFollowRedirectToURL = [delegate respondsToSelector:@selector(networkFetcher:shouldFollowRedirectToURL:)];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (void)testMethod &#123;</span><br><span class="line">    // data obtained from network</span><br><span class="line">    NSData *data;</span><br><span class="line">    // â‡ï¸åœ¨å§”æ‰˜å¯¹è±¡ä¸Šè°ƒåŠ¨å¯é€‰æ–¹æ³•ï¼Œå¿…é¡»æå‰ä½¿ç”¨ç±»å‹ä¿¡æ¯æŸ¥è¯¢æ–¹æ³•åˆ¤æ–­è¿™ä¸ªå§”æ‰˜å¯¹è±¡èƒ½å¦å“åº”ç›¸å…³é€‰æ‹©å­</span><br><span class="line">    if ([_delegate respondsToSelector:</span><br><span class="line">            @selector(networkFetcher:didReceiveData:)]) &#123;</span><br><span class="line">        [_delegate networkFetcher:self didReceiveData:data];</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    float currentProgress = 0.0;</span><br><span class="line">    // â‘¡ â‡ï¸æŸ¥è¯¢ç»“æ„ä½“æ ‡å¿—</span><br><span class="line">    // ä¸å¿…æ¯æ¬¡ä½¿ç”¨ç±»å‹ä¿¡æ¯æŸ¥è¯¢æ–¹æ³•ï¼Œå¯¹éœ€è¦è°ƒç”¨å¾ˆå¤šæ¬¡çš„æ–¹æ³•æ—¶ï¼Œå€¼å¾—è¿›è¡Œè¿™ç§ä¼˜åŒ–</span><br><span class="line">    if (_delegateFlags.didUpdateProgressTo) &#123;</span><br><span class="line">        [_delegate networkFetcher:self didUpdateProgressTo:currentProgress];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@end</span><br></pre></td></tr></table></figure>
<h5 id="EOCDataModel"><a href="#EOCDataModel" class="headerlink" title="EOCDataModel"></a>EOCDataModel</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">//  EOCDataModel.h</span><br><span class="line">#import &lt;Foundation/Foundation.h&gt;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> EOCDataModel å¯¹è±¡æ˜¯ EOCNetworkFetcher çš„å§”æ‰˜å¯¹è±¡</span><br><span class="line"> */</span><br><span class="line">@interface EOCDataModel : NSObject</span><br><span class="line"></span><br><span class="line">@end</span><br><span class="line"></span><br><span class="line">//  EOCDataModel.m</span><br><span class="line">#import &quot;EOCDataModel.h&quot;</span><br><span class="line">#import &quot;EOCNetworkFetcherDelegate.h&quot;</span><br><span class="line">#import &quot;EOCNetworkFetcher.h&quot;</span><br><span class="line"></span><br><span class="line">// 1.å£°æ˜æ­¤ç±»éµä»å§”æ‰˜åè®®</span><br><span class="line">@interface EOCDataModel () &lt;EOCNetworkFetcherDelegate&gt;</span><br><span class="line">@property (nonatomic, strong) EOCNetworkFetcher *myFetcherA;</span><br><span class="line">@property (nonatomic, strong) EOCNetworkFetcher *myFetcherB;</span><br><span class="line">@end</span><br><span class="line"></span><br><span class="line">@implementation EOCDataModel</span><br><span class="line"></span><br><span class="line">// 2.å®ç°å§”æ‰˜åè®®ä¸­çš„æ–¹æ³•</span><br><span class="line">- (void)networkFetcher:(EOCNetworkFetcher *)fetcher</span><br><span class="line">        didReceiveData:(NSData *)data &#123;</span><br><span class="line">    // â‡ï¸è°ƒç”¨ delegate ä¸­çš„æ–¹æ³•æ—¶ï¼Œæ€»æ˜¯åº”è¯¥æŠŠå‘èµ·å§”æ‰˜çš„å®ä¾‹ä¹Ÿä¸€å¹¶ä¼ å…¥æ–¹æ³•ä¸­,</span><br><span class="line">    // è¿™æ ·ï¼Œdelegate å¯¹è±¡åœ¨å®ç°ç›¸å…³æ–¹æ³•æ—¶ï¼Œå°±èƒ½æ ¹æ®ä¼ å…¥çš„å®ä¾‹åˆ†åˆ«æ‰§è¡Œä¸åŒçš„ä»£ç äº†ã€‚</span><br><span class="line">    if (fetcher == _myFetcherA) &#123;</span><br><span class="line">        // handle data</span><br><span class="line">    &#125;else if (fetcher == _myFetcherB) &#123;</span><br><span class="line">        // handle data</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (void)networkFetcher:(EOCNetworkFetcher *)fetcher</span><br><span class="line">      didFailWithError:(NSError *)error &#123;</span><br><span class="line">    // handle error</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@end</span><br></pre></td></tr></table></figure>
<h4 id="è¦ç‚¹"><a href="#è¦ç‚¹" class="headerlink" title="è¦ç‚¹"></a>è¦ç‚¹</h4><ul>
<li>å§”æ‰˜æ¨¡å¼ä¸ºå¯¹è±¡æä¾›äº†ä¸€å¥—æ¥å£ï¼Œä½¿å…¶å¯ç”±æ­¤å°†ç›¸å…³äº‹ä»¶å‘ŠçŸ¥å…¶ä»–å¯¹è±¡ã€‚</li>
<li>å°†å§”æ‰˜å¯¹è±¡åº”è¯¥æ”¯æŒçš„æ¥å£å®šä¹‰æˆåè®®ï¼Œåœ¨åè®®ä¸­æŠŠå¯èƒ½éœ€è¦å¤„ç†çš„äº‹ä»¶å®šä¹‰æˆæ–¹æ³•ã€‚</li>
<li>å½“æŸå¯¹è±¡éœ€è¦ä»å¦å¤–ä¸€ä¸ªå¯¹è±¡ä¸­è·å–æ•°æ®æ—¶ï¼Œå¯ä½¿ç”¨å§”æ‰˜æ¨¡å¼ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œè¯¥æ¨¡å¼äº¦ç§°<strong>æ•°æ®æºåè®®</strong>ï¼ˆdata source protocalï¼‰ã€‚</li>
<li>è‹¥æœ‰å¿…è¦ï¼Œå¯å®ç°å«æœ‰ä½æ®µçš„ç»“æ„ä½“ï¼Œå°†å§”æ‰˜å¯¹è±¡æ˜¯å¦èƒ½å“åº”ç›¸å…³åè®®æ–¹æ³•è¿™ä¸€ä¿¡æ¯ç¼“å­˜è‡³å…¶ä¸­ã€‚</li>
</ul>
<h3 id="ç¬¬24æ¡ï¼šå°†ç±»çš„å®ç°ä»£ç åˆ†æ•£åˆ°ä¾¿äºç®¡ç†çš„æ•°ä¸ªåˆ†ç±»ä¹‹ä¸­"><a href="#ç¬¬24æ¡ï¼šå°†ç±»çš„å®ç°ä»£ç åˆ†æ•£åˆ°ä¾¿äºç®¡ç†çš„æ•°ä¸ªåˆ†ç±»ä¹‹ä¸­" class="headerlink" title="ç¬¬24æ¡ï¼šå°†ç±»çš„å®ç°ä»£ç åˆ†æ•£åˆ°ä¾¿äºç®¡ç†çš„æ•°ä¸ªåˆ†ç±»ä¹‹ä¸­"></a>ç¬¬24æ¡ï¼šå°†ç±»çš„å®ç°ä»£ç åˆ†æ•£åˆ°ä¾¿äºç®¡ç†çš„æ•°ä¸ªåˆ†ç±»ä¹‹ä¸­</h3><ul>
<li>é€šè¿‡ <strong>Objectice-C</strong> çš„â€åˆ†ç±»â€ï¼ˆ<strong>Category</strong>ï¼‰æœºåˆ¶ï¼ŒæŠŠç±»ä»£ç æŒ‰é€»è¾‘åˆ’å…¥å‡ ä¸ªåˆ†åŒºä¸­ï¼Œè¿™å¯¹å¼€å‘ä¸è°ƒè¯•éƒ½æœ‰å¥½å¤„ã€‚</li>
</ul>
<h5 id="ä¸ä½¿ç”¨-Category-åˆ†ç±»ï¼š"><a href="#ä¸ä½¿ç”¨-Category-åˆ†ç±»ï¼š" class="headerlink" title="ä¸ä½¿ç”¨ Category åˆ†ç±»ï¼š"></a>ä¸ä½¿ç”¨ Category åˆ†ç±»ï¼š</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">#import &lt;Foundation/Foundation.h&gt;</span><br><span class="line"></span><br><span class="line">@interface EOCPerson : NSObject</span><br><span class="line">@property (nonatomic, copy, readonly) NSString *firstName;</span><br><span class="line">@property (nonatomic, copy, readonly) NSString *lastName;</span><br><span class="line">@property (nonatomic, strong, readonly) NSSet *friends;</span><br><span class="line"></span><br><span class="line">- (instancetype)initWithFirstName:(NSString *)firstName</span><br><span class="line">                      andLastName:(NSString *)lastName;</span><br><span class="line"></span><br><span class="line">/** Friendship methods */</span><br><span class="line">- (void)addFirend:(EOCPerson *)person;</span><br><span class="line">- (void)removeFriend:(EOCPerson *)person;</span><br><span class="line">- (BOOL)isFriendsWith:(EOCPerson *)person;</span><br><span class="line"></span><br><span class="line">/* Word methods */</span><br><span class="line">- (void)performDaysWork;</span><br><span class="line">- (void)takeVacationFromWork;</span><br><span class="line"></span><br><span class="line">/** Play methods */</span><br><span class="line">- (void)goToTheCinema;</span><br><span class="line">- (void)goToSportsGame;</span><br><span class="line"></span><br><span class="line">@end</span><br></pre></td></tr></table></figure>
<h5 id="ä½¿ç”¨-Category-åˆ†ç±»ï¼š"><a href="#ä½¿ç”¨-Category-åˆ†ç±»ï¼š" class="headerlink" title="ä½¿ç”¨ Category åˆ†ç±»ï¼š"></a>ä½¿ç”¨ Category åˆ†ç±»ï¼š</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">//  EOCPerson.h</span><br><span class="line">#import &lt;Foundation/Foundation.h&gt;</span><br><span class="line"></span><br><span class="line">@interface EOCPerson : NSObject</span><br><span class="line">@property (nonatomic, copy, readonly) NSString *firstName;</span><br><span class="line">@property (nonatomic, copy, readonly) NSString *lastName;</span><br><span class="line">@property (nonatomic, strong, readonly) NSSet *friends;</span><br><span class="line"></span><br><span class="line">- (instancetype)initWithFirstName:(NSString *)firstName</span><br><span class="line">                      andLastName:(NSString *)lastName;</span><br><span class="line">@end</span><br><span class="line"></span><br><span class="line">@interface EOCPerson (Friendship)</span><br><span class="line">- (void)addFirend:(EOCPerson *)person;</span><br><span class="line">- (void)removeFriend:(EOCPerson *)person;</span><br><span class="line">- (BOOL)isFriendsWith:(EOCPerson *)person;</span><br><span class="line">@end</span><br><span class="line"></span><br><span class="line">@interface EOCPerson (Work)</span><br><span class="line">- (void)performDaysWork;</span><br><span class="line">- (void)takeVacationFromWork;</span><br><span class="line">@end</span><br><span class="line"></span><br><span class="line">@interface EOCPerson (Play)</span><br><span class="line">- (void)goToTheCinema;</span><br><span class="line">- (void)goToSportsGame;</span><br><span class="line">@end</span><br></pre></td></tr></table></figure>
<p>ä½¿ç”¨ <strong>Category</strong> åˆ†ç±»æœºåˆ¶ï¼š</p>
<ul>
<li>ä½ å¯ä»¥æŠŠæ•´ä¸ªç±»éƒ½å®šä¹‰åœ¨ä¸€ä¸ªæ¥å£æ–‡ä»¶ä¸­ï¼Œå¹¶å°†å…¶ä»£ç å†™åœ¨ä¸€ä¸ªå®ç°æ–‡ä»¶é‡Œã€‚</li>
</ul>
<ul>
<li>éšç€åˆ†ç±»æ•°é‡çš„å¢åŠ ï¼Œå¯ä»¥æŠŠæ¯ä¸ªåˆ†ç±»æå–åˆ°å„è‡ªçš„æ–‡ä»¶ä¸­å»ã€‚<ul>
<li>EOCPerson+Friendship(.h/.m)</li>
<li>EOCPerson+Work(.h/.m)</li>
<li>EOCPerson+Play(.h/.m)</li>
</ul>
</li>
<li>ä¼˜ç‚¹ï¼šå¯ä»¥æŠŠç±»ä»£ç åˆ†æˆå¾ˆå¤šä¸ª<strong>æ˜“äºç®¡ç†</strong>çš„å°å—ï¼Œä»¥ä¾¿å•ç‹¬æ£€è§†ã€‚</li>
<li>ä¼˜ç‚¹ï¼š<strong>ä¾¿äºè°ƒè¯•</strong>ï¼šå¯¹äºæŸä¸ªåˆ†ç±»ä¸­çš„æ‰€æœ‰æ–¹æ³•ï¼Œåˆ†ç±»åç§°éƒ½ä¼šå‡ºç°åœ¨å…¶ç¬¦å·ä¸­ã€‚å¯ä»¥æ ¹æ®è°ƒè¯•å™¨å›æº¯ä¿¡æ¯ä¸­çš„åˆ†ç±»åç§°ï¼Œç²¾ç¡®å®šä½åˆ°ç±»ä¸­çš„æ–¹æ³•æ‰€å±çš„åŠŸèƒ½åŒºã€‚</li>
</ul>
<h4 id="è¦ç‚¹-1"><a href="#è¦ç‚¹-1" class="headerlink" title="è¦ç‚¹"></a>è¦ç‚¹</h4><ul>
<li>ä½¿ç”¨åˆ†ç±»æœºåˆ¶æŠŠç±»çš„å®ç°ä»£ç åˆ’åˆ†æˆæ˜“äºç®¡ç†çš„å°å—ã€‚</li>
<li>å°†åº”è¯¥è§†ä¸ºç§æœ‰çš„æ–¹æ³•å½’å…¥åå« <strong>Private</strong> çš„åˆ†ç±»ä¸­ï¼Œä»¥éšè—å®ç°ç»†èŠ‚ã€‚ä»¥ç¼–å†™â€œè‡ªæˆ‘æè¿°å¼ä»£ç â€ï¼ˆself-documenting codeï¼‰ã€‚</li>
</ul>
<h3 id="ç¬¬25æ¡ï¼šæ€»æ˜¯ä¸ºç¬¬ä¸‰æ–¹ç±»çš„åˆ†ç±»åç§°åŠ å‰ç¼€"><a href="#ç¬¬25æ¡ï¼šæ€»æ˜¯ä¸ºç¬¬ä¸‰æ–¹ç±»çš„åˆ†ç±»åç§°åŠ å‰ç¼€" class="headerlink" title="ç¬¬25æ¡ï¼šæ€»æ˜¯ä¸ºç¬¬ä¸‰æ–¹ç±»çš„åˆ†ç±»åç§°åŠ å‰ç¼€"></a>ç¬¬25æ¡ï¼šæ€»æ˜¯ä¸ºç¬¬ä¸‰æ–¹ç±»çš„åˆ†ç±»åç§°åŠ å‰ç¼€</h3><h4 id="ä½¿ç”¨åˆ†ç±»çš„é—®é¢˜ï¼š"><a href="#ä½¿ç”¨åˆ†ç±»çš„é—®é¢˜ï¼š" class="headerlink" title="ä½¿ç”¨åˆ†ç±»çš„é—®é¢˜ï¼š"></a>ä½¿ç”¨åˆ†ç±»çš„é—®é¢˜ï¼š</h4><ol>
<li>ã€å°†åˆ†ç±»æ–¹æ³•åŠ å…¥ç±»ä¸­ã€‘è¿™ä¸€æ“ä½œæ˜¯åœ¨ã€è¿è¡ŒæœŸç³»ç»ŸåŠ è½½åˆ†ç±»æ—¶ã€‘å®Œæˆçš„ã€‚è¿è¡ŒæœŸç³»ç»Ÿä¼šæŠŠåˆ†ç±»ä¸­æ‰€å®ç°çš„æ¯ä¸ªæ–¹æ³•éƒ½åŠ å…¥ç±»çš„æ–¹æ³•åˆ—è¡¨ä¸­ã€‚</li>
<li>å¦‚æœç±»ä¸­æœ¬æ¥å°±æœ‰æ­¤æ–¹æ³•ï¼Œè€Œåˆ†ç±»åˆå®ç°äº†ä¸€æ¬¡ï¼Œé‚£ä¹ˆåˆ†ç±»ä¸­çš„æ–¹æ³•ä¼šè¦†ç›–åŸæ¥é‚£ä¸€ä»½å®ç°ä»£ç ã€‚</li>
</ol>
<h4 id="è§£å†³æ–¹æ³•ï¼š"><a href="#è§£å†³æ–¹æ³•ï¼š" class="headerlink" title="è§£å†³æ–¹æ³•ï¼š"></a>è§£å†³æ–¹æ³•ï¼š</h4><ol>
<li>ä»¥å‘½åç©ºé—´æ¥åŒºåˆ«å„ä¸ª<strong>åˆ†ç±»çš„åç§°</strong>ä¸å…¶ä¸­æ‰€å®šä¹‰çš„<strong>æ–¹æ³•</strong>ã€‚</li>
<li>ç»™ç›¸å…³åç§°éƒ½åŠ ä¸ŠæŸä¸ªå…±ç”¨çš„å‰ç¼€ã€‚</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">//  NSString+ABC_HTTP.h</span><br><span class="line">#import &lt;Foundation/Foundation.h&gt;</span><br><span class="line"></span><br><span class="line">@interface NSString (ABC_HTTP)</span><br><span class="line"></span><br><span class="line">// Encode a string with URL encoding</span><br><span class="line">- (NSString *)abc_urlEncodedString;</span><br><span class="line"></span><br><span class="line">// Decode a URL encoded string</span><br><span class="line">- (NSString *)abc_urlDecodedString;</span><br><span class="line"></span><br><span class="line">@end</span><br></pre></td></tr></table></figure>
<h4 id="è¦ç‚¹-2"><a href="#è¦ç‚¹-2" class="headerlink" title="è¦ç‚¹"></a>è¦ç‚¹</h4><ul>
<li>å‘ç¬¬ä¸‰æ–¹ç±»ä¸­æ·»åŠ åˆ†ç±»æ—¶ï¼Œæ€»åº”ç»™å…¶<strong>åç§°</strong>åŠ ä¸Šä½ ä¸“ç”¨çš„å‰ç¼€ã€‚</li>
<li>å‘ç¬¬ä¸‰æ–¹ç±»ä¸­æ·»åŠ åˆ†ç±»æ—¶ï¼Œæ€»åº”ç»™å…¶ä¸­çš„<strong>æ–¹æ³•å</strong>åŠ ä¸Šä½ ä¸“ç”¨çš„å‰ç¼€ã€‚</li>
</ul>
<h3 id="ç¬¬26æ¡ï¼šå‹¿åœ¨åˆ†ç±»ä¸­å£°æ˜å±æ€§"><a href="#ç¬¬26æ¡ï¼šå‹¿åœ¨åˆ†ç±»ä¸­å£°æ˜å±æ€§" class="headerlink" title="ç¬¬26æ¡ï¼šå‹¿åœ¨åˆ†ç±»ä¸­å£°æ˜å±æ€§"></a>ç¬¬26æ¡ï¼šå‹¿åœ¨åˆ†ç±»ä¸­å£°æ˜å±æ€§</h3><ul>
<li><p><strong>Category</strong> åˆ†ç±»æ— æ³•æŠŠå®ç°å±æ€§æ‰€éœ€çš„å®ä¾‹å˜é‡åˆæˆå‡ºæ¥ï¼Œå³æ— æ³•è‡ªåŠ¨å®ç°å­˜å–æ–¹æ³•ã€‚</p>
</li>
<li><p>å…³è”å¯¹è±¡ï¼ˆå‚åŠ ç¬¬10æ¡ï¼‰èƒ½å¤Ÿè§£å†³åœ¨åˆ†ç±»ä¸­ä¸èƒ½åˆæˆå®ä¾‹å˜é‡çš„é—®é¢˜ï¼Œä½†æ˜¯ä¸æ¨èã€‚</p>
</li>
<li><p>æ‰€æœ‰å±æ€§éƒ½åº”è¯¥å®šä¹‰åœ¨ä¸»æ¥å£ä¸­ã€‚</p>
</li>
<li><p><strong>Category</strong> åˆ†ç±»çš„ä½œç”¨æ˜¯æ‰©å±•ç±»çš„åŠŸèƒ½ï¼Œè€Œéå°è£…æ•°æ®ã€‚</p>
</li>
<li><p>å¯ä»¥åœ¨ <strong>Category</strong> åˆ†ç±»ä¸­ä½¿ç”¨åªè¯»ï¼ˆreadonlyï¼‰å±æ€§ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">//  NSCalendar+EOC_Additions.h</span><br><span class="line">#import &lt;Foundation/Foundation.h&gt;</span><br><span class="line"></span><br><span class="line">@interface NSCalendar (EOC_Additions)</span><br><span class="line">@property (nonatomic, strong, readonly) NSArray *eoc_allMonths;</span><br><span class="line"></span><br><span class="line">- ()</span><br><span class="line">@end</span><br><span class="line"></span><br><span class="line">//  NSCalendar+EOC_Additions.m</span><br><span class="line">#import &quot;NSCalendar+EOC_Additions.h&quot;</span><br><span class="line"></span><br><span class="line">@implementation NSCalendar (EOC_Additions)</span><br><span class="line">// â‡ï¸ readonlyï¼Œä¸éœ€è¦è®¾ç½® set æ–¹æ³•ã€‚</span><br><span class="line">// â‡ï¸ getæ–¹æ³•ä¸ä¼šè®¿é—®ç±»æ•°æ®ï¼Œå±æ€§ä¹Ÿä¸éœ€è¦ç”±å®ä¾‹å˜é‡æ¥å®ç°</span><br><span class="line">- (NSArray *)eoc_allMonths &#123;</span><br><span class="line">    if ([self.calendarIdentifier</span><br><span class="line">            isEqualToString:NSCalendarIdentifierGregorian]) &#123;</span><br><span class="line">        return @[@&quot;January&quot;,@&quot;Feburary&quot;,</span><br><span class="line">                 @&quot;March&quot;,@&quot;April&quot;,</span><br><span class="line">                 @&quot;May&quot;,@&quot;June&quot;,</span><br><span class="line">                 @&quot;July&quot;,@&quot;August&quot;,</span><br><span class="line">                 @&quot;September&quot;,@&quot;October&quot;,</span><br><span class="line">                 @&quot;November&quot;,@&quot;December&quot;,];</span><br><span class="line">    &#125;else if (/** other calendar identifier */) &#123;</span><br><span class="line">        /** return months for other calendars */</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">@end</span><br></pre></td></tr></table></figure>
</li>
<li><p>ä¸Šä¾‹ä¸­ï¼Œç›´æ¥å£°æ˜ä¸€ä¸ªæ–¹æ³•æˆ–è®¸æ›´å¥½ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">#import &lt;Foundation/Foundation.h&gt;</span><br><span class="line"></span><br><span class="line">@interface NSCalendar (EOC_Additions)</span><br><span class="line">- (NSArray *)eoc_allMonths;</span><br><span class="line">@end</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="è¦ç‚¹-3"><a href="#è¦ç‚¹-3" class="headerlink" title="è¦ç‚¹"></a>è¦ç‚¹</h4><ul>
<li>æŠŠå°è£…æ•°æ®æ‰€ç”¨çš„å…¨éƒ¨å±æ€§éƒ½å®šä¹‰åœ¨ä¸»æ¥å£é‡Œã€‚</li>
<li>åœ¨ â€œclass-continuationâ€ åˆ†ç±»ä¹‹å¤–çš„å…¶ä»–åˆ†ç±»ä¸­ï¼Œå¯ä»¥å®šä¹‰å­˜å–æ–¹æ³•ï¼Œä½†å°½é‡ä¸è¦å®šä¹‰å±æ€§ã€‚</li>
</ul>
<h3 id="ç¬¬27æ¡ï¼šä½¿ç”¨-â€œclass-continuationåˆ†ç±»â€-éšè—å®ç°ç»†èŠ‚"><a href="#ç¬¬27æ¡ï¼šä½¿ç”¨-â€œclass-continuationåˆ†ç±»â€-éšè—å®ç°ç»†èŠ‚" class="headerlink" title="ç¬¬27æ¡ï¼šä½¿ç”¨  â€œclass-continuationåˆ†ç±»â€  éšè—å®ç°ç»†èŠ‚"></a>ç¬¬27æ¡ï¼šä½¿ç”¨  â€œclass-continuationåˆ†ç±»â€  éšè—å®ç°ç»†èŠ‚</h3><h4 id="Objectice-C-Class-Extension"><a href="#Objectice-C-Class-Extension" class="headerlink" title="Objectice-C Class Extension"></a>Objectice-C Class Extension</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">@interface &lt;#class name#&gt; ()</span><br><span class="line"></span><br><span class="line">@end</span><br></pre></td></tr></table></figure>
<ul>
<li>å¯ä»¥å°†<u>ç§æœ‰å®ä¾‹å˜é‡</u>å’Œ<u>ç§æœ‰æ–¹æ³•</u>å£°æ˜åœ¨ â€œclass-continuationåˆ†ç±»â€ ä¸­ï¼Œå®ç°å¯¹å¤–éšè—ã€‚</li>
<li>å°†å®ä¾‹å˜é‡æ·»åŠ åˆ°  â€œclass-continuationåˆ†ç±»â€ ä¸­ä¸æ·»åŠ åˆ° <strong>@implementation</strong> å®ç°å—ä¸­æ˜¯ç­‰æ•ˆçš„ã€‚</li>
<li>ç¼–å†™ Objectice-C++ ä»£ç æ—¶ä½¿ç”¨ â€œclass-continuationåˆ†ç±»â€ ä¹Ÿå°¤ä¸ºæœ‰ç”¨ã€‚</li>
<li>â€œclass-continuationåˆ†ç±»â€ è¿˜å¯ä»¥å°† public æ¥å£ä¸­å£°æ˜ä¸º <code>readonly</code> çš„å±æ€§æ‰©å±•ä¸º <code>readwrite</code>ã€‚ã€å‚è§ï¼šç¬¬18æ¡ï¼šå°½é‡ä½¿ç”¨ä¸å¯å˜å¯¹è±¡ã€‘</li>
<li>è‹¥å¯¹è±¡æ‰€éµä»çš„åè®®ï¼ˆdelegateï¼‰åªåº”è§†ä¸ºç§æœ‰ï¼Œåˆ™å¯ä»¥åœ¨ â€œclass-continuationåˆ†ç±»â€ ä¸­å£°æ˜ã€‚</li>
</ul>
<h4 id="è¦ç‚¹-4"><a href="#è¦ç‚¹-4" class="headerlink" title="è¦ç‚¹"></a>è¦ç‚¹</h4><ul>
<li>é€šè¿‡ â€œclass-continuationåˆ†ç±»â€ å‘ç±»ä¸­æ–°å¢å®ä¾‹å˜é‡ã€‚</li>
<li>å¦‚æœæŸå±æ€§åœ¨ä¸»æ¥å£ä¸­å£°æ˜ä¸ºâ€åªè¯»â€ï¼Œè€Œç±»çš„å†…éƒ¨åˆè¦ç”¨è®¾ç½®æ–¹æ³•ä¿®æ”¹æ­¤å±æ€§ï¼Œé‚£ä¹ˆå°±åœ¨ â€œclass-continuationåˆ†ç±»â€ ä¸­å°†å…¶æ‰©å±•ä¸ºâ€å¯è¯»å†™â€ã€‚</li>
<li>æŠŠç§æœ‰æ–¹æ³•çš„åŸå‹å£°æ˜åœ¨ â€œclass-continuationåˆ†ç±»â€ é‡Œé¢ã€‚</li>
<li>è‹¥æƒ³ä½¿ç±»æ‰€éµå¾ªçš„åè®®ä¸ä¸ºäººæ‰€çŸ¥ï¼Œåˆ™å¯äº â€œclass-continuationåˆ†ç±»â€ ä¸­å£°æ˜ã€‚</li>
</ul>
<h3 id="ç¬¬28æ¡ï¼šé€šè¿‡åè®®æä¾›åŒ¿åå¯¹è±¡"><a href="#ç¬¬28æ¡ï¼šé€šè¿‡åè®®æä¾›åŒ¿åå¯¹è±¡" class="headerlink" title="ç¬¬28æ¡ï¼šé€šè¿‡åè®®æä¾›åŒ¿åå¯¹è±¡"></a>ç¬¬28æ¡ï¼šé€šè¿‡åè®®æä¾›åŒ¿åå¯¹è±¡</h3><ul>
<li><p>å°†è¿”å›çš„å¯¹è±¡è®¾è®¡ä¸ºéµä»åè®®çš„çº¯ <code>id</code> ç±»å‹ã€‚</p>
</li>
<li><p>â€œåŒ¿åå¯¹è±¡â€ï¼ˆanonymous objectï¼‰ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">@property (nonatomic, weak) id&lt;EOCNetworkFetcherDelegate&gt; delegate;</span><br></pre></td></tr></table></figure>
</li>
<li><p>æœ‰æ—¶å€™å¯¹è±¡ç±»å‹å¹¶ä¸é‡è¦ï¼Œé‡è¦çš„æ˜¯å¯¹è±¡æœ‰æ²¡æœ‰å®ç°æŸäº›æ–¹æ³•ã€‚</p>
</li>
</ul>
<h4 id="ç¤ºä¾‹ä»£ç "><a href="#ç¤ºä¾‹ä»£ç " class="headerlink" title="ç¤ºä¾‹ä»£ç "></a>ç¤ºä¾‹ä»£ç </h4><p>ä»¥ä¸‹ç¤ºä¾‹æ˜¯å‚è€ƒè‡ª <a href="https://www.objccn.io/issue-1-2/" target="_blank" rel="noopener">objcä¸­å›½æœŸåˆŠï¼šæ•´æ´çš„ Table View ä»£ç </a></p>
<blockquote>
<h3 id="è®©-Cells-å¯å¤ç”¨"><a href="#è®©-Cells-å¯å¤ç”¨" class="headerlink" title="è®© Cells å¯å¤ç”¨"></a>è®© Cells å¯å¤ç”¨</h3><p>æœ‰æ—¶å¤šç§ model å¯¹è±¡éœ€è¦ç”¨åŒä¸€ç±»å‹çš„ cell æ¥è¡¨ç¤ºï¼Œè¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥è¿›ä¸€æ­¥è®© cell å¯ä»¥å¤ç”¨ã€‚é¦–å…ˆï¼Œæˆ‘ä»¬ç»™ cell å®šä¹‰ä¸€ä¸ª protocolï¼Œéœ€è¦ç”¨è¿™ä¸ª cell æ˜¾ç¤ºçš„å¯¹è±¡å¿…é¡»éµå¾ªè¿™ä¸ª protocolã€‚ç„¶åç®€å•ä¿®æ”¹ category ä¸­çš„è®¾ç½®æ–¹æ³•ï¼Œè®©å®ƒå¯ä»¥æ¥å—éµå¾ªè¿™ä¸ª protocol çš„ä»»ä½•å¯¹è±¡ã€‚è¿™äº›ç®€å•çš„æ­¥éª¤è®© cell å’Œä»»ä½•ç‰¹æ®Šçš„ model å¯¹è±¡ä¹‹é—´å¾—ä»¥è§£è€¦ï¼Œè®©å®ƒå¯é€‚åº”ä¸åŒçš„æ•°æ®ç±»å‹ã€‚</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line">// ****************************************************</span><br><span class="line">//  UITableViewCell+ConfigureModel.h</span><br><span class="line">#import &lt;UIKit/UIKit.h&gt;</span><br><span class="line"></span><br><span class="line">@protocol HQLTableViewCellConfigureDelegate &lt;NSObject&gt;</span><br><span class="line">@required</span><br><span class="line">- (NSString *)imageName;</span><br><span class="line">- (NSString *)titleLabelText;</span><br><span class="line">@end</span><br><span class="line"></span><br><span class="line">@protocol HQLTableViewCellKeyValueConfigureDelegate &lt;NSObject&gt;</span><br><span class="line">@required</span><br><span class="line">- (NSString *)titleLabelText;</span><br><span class="line">- (NSString *)detailLabelText;</span><br><span class="line">@end</span><br><span class="line"></span><br><span class="line">@interface UITableViewCell (ConfigureModel)</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> é…ç½®æŸ¥è¯¢åŠŸèƒ½ Cell</span><br><span class="line"></span><br><span class="line"> @param model æ¨¡å‹ï¼šå›¾ç‰‡ + æ ‡é¢˜ + æŒ‡ç¤ºç®­å¤´&gt;</span><br><span class="line"> */</span><br><span class="line">- (void)hql_configureForModel:(id&lt;HQLTableViewCellConfigureDelegate&gt;)model;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> é…ç½®æ•°æ®æ˜¾ç¤º Cell</span><br><span class="line"></span><br><span class="line"> @param model æ¨¡å‹ï¼štitleLabel + detailLabel</span><br><span class="line"> */</span><br><span class="line">- (void)hql_configureForKeyValueModel:(id&lt;HQLTableViewCellKeyValueConfigureDelegate&gt;)model;</span><br><span class="line"></span><br><span class="line">@end</span><br><span class="line">  </span><br><span class="line">// ****************************************************</span><br><span class="line">//  UITableViewCell+ConfigureModel.m</span><br><span class="line">#import &quot;UITableViewCell+ConfigureModel.h&quot;</span><br><span class="line"></span><br><span class="line">@implementation UITableViewCell (ConfigureModel)</span><br><span class="line"></span><br><span class="line">- (void)hql_configureForModel:(id&lt;HQLTableViewCellConfigureDelegate&gt;)model &#123;</span><br><span class="line">    self.imageView.image = [UIImage imageNamed:model.imageName];</span><br><span class="line">    self.textLabel.text  = model.titleLabelText;</span><br><span class="line">    self.accessoryType   = UITableViewCellAccessoryDisclosureIndicator;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (void)hql_configureForKeyValueModel:(id&lt;HQLTableViewCellKeyValueConfigureDelegate&gt;)model &#123;</span><br><span class="line">    self.textLabel.text       = model.titleLabelText;</span><br><span class="line">    self.detailTextLabel.text = model.detailLabelText;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@end</span><br></pre></td></tr></table></figure>
<h4 id="è¦ç‚¹-5"><a href="#è¦ç‚¹-5" class="headerlink" title="è¦ç‚¹"></a>è¦ç‚¹</h4><ul>
<li>åè®®å¯åœ¨æŸç§ç¨‹åº¦ä¸Šæä¾›åŒ¿åç±»å‹ã€‚å…·ä½“çš„å¯¹è±¡ç±»å‹å¯ä»¥æ·¡åŒ–æˆéµä»æŸåè®®çš„ id ç±»å‹ï¼Œåè®®é‡Œè§„å®šäº†å¯¹è±¡æ‰€åº”å®ç°çš„æ–¹æ³•ã€‚</li>
<li>ä½¿ç”¨åŒ¿åå¯¹è±¡æ¥éšè—ç±»å‹åç§°(æˆ–ç±»å)ã€‚</li>
<li>å¦‚æœå…·ä½“ç±»å‹ä¸é‡è¦ï¼Œé‡è¦çš„æ˜¯å¯¹è±¡èƒ½å¤Ÿå“åº”ï¼ˆå®šä¹‰åœ¨åè®®é‡Œçš„ï¼‰ç‰¹å®šæ–¹æ³•ï¼Œé‚£ä¹ˆå¯ä½¿ç”¨åŒ¿åå¯¹è±¡æ¥è¡¨ç¤ºã€‚</li>
</ul>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://andy0570.com/2017/08/14/é‚£äº›ä½ ä¸çŸ¥é“çš„ Mac å°æŠ€å·§/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ç‹¬æœ¨èˆŸçš„æœ¨">
      <meta itemprop="description" content="æœ‰æ—¶å€™é˜³å…‰å¾ˆå¥½ æœ‰æ—¶å€™é˜³å…‰å¾ˆæš—">
      <meta itemprop="image" content="https://ws1.sinaimg.cn/large/006tNc79gy1g22m14458rj30u014xu0x.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ç‹¬æœ¨èˆŸçš„æœ¨">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2017/08/14/é‚£äº›ä½ ä¸çŸ¥é“çš„ Mac å°æŠ€å·§/" class="post-title-link" itemprop="url">é‚£äº›ä½ ä¸çŸ¥é“çš„ Mac å°æŠ€å·§</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              

              
                
              

              <time title="åˆ›å»ºæ—¶é—´ï¼š2017-08-14 10:59:00" itemprop="dateCreated datePublished" datetime="2017-08-14T10:59:00+08:00">2017-08-14</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">æ›´æ–°äº</span>
                
                <time title="ä¿®æ”¹æ—¶é—´ï¼š2019-04-16 15:35:53" itemprop="dateModified" datetime="2019-04-16T15:35:53+08:00">2019-04-16</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/å¼€å‘å·¥å…·-Macåº”ç”¨/" itemprop="url" rel="index"><span itemprop="name">å¼€å‘å·¥å…·&Macåº”ç”¨</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          
            <span id="/2017/08/14/é‚£äº›ä½ ä¸çŸ¥é“çš„ Mac å°æŠ€å·§/" class="leancloud_visitors" data-flag-title="é‚£äº›ä½ ä¸çŸ¥é“çš„ Mac å°æŠ€å·§">
              <span class="post-meta-divider">|</span>
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              
                <span class="post-meta-item-text">é˜…è¯»æ¬¡æ•°ï¼š</span>
              
                <span class="leancloud-visitors-count"></span>
            </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body han-init-context" itemprop="articleBody">

      
      

      
        
          
            <p><img src="https://upload-images.jianshu.io/upload_images/2648731-bbf5527e70e5f73b.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt></p>
<h3 id="æ¨èé˜…è¯»"><a href="#æ¨èé˜…è¯»" class="headerlink" title="æ¨èé˜…è¯»"></a>æ¨èé˜…è¯»</h3><ul>
<li><a href="https://appso.gitbooks.io/macos/content/" target="_blank" rel="noopener">è¿™ä»½ macOS ä½¿ç”¨æŒ‡å—ï¼Œè®©ä½ çš„ Mac æ›´å¥½ç”¨</a></li>
<li><a href="https://zhuanlan.zhihu.com/p/24868436" target="_blank" rel="noopener">é«˜æ•ˆmacbookå·¥ä½œç¯å¢ƒé…ç½®</a> â­ï¸â­ï¸â­ï¸</li>
<li><a href="http://www.feng.com/iPhone/news/2017-07-21/Someone-found-for-macOS-fast-way-to-upgrade-is-complete_686024.shtml" target="_blank" rel="noopener">è®©macOSå¿«é€Ÿå®Œæˆå‡çº§çš„åŠæ³•</a></li>
<li><a href="https://www.ifanr.com/app/1069203" target="_blank" rel="noopener">æ”¶è—ï¼è¿™ä»½å¿…å¤‡å…è´¹è½¯ä»¶æ¸…å•ï¼Œè®©ä½ çš„ Mac æ›´å€¼é’± | æœ‰ç”¨åŠŸ</a></li>
<li><a href="https://sspai.com/post/43451" target="_blank" rel="noopener">9 æ¡è¿›é˜¶å‘½ä»¤ï¼ŒæŠŠ HomeBrew æ‰“é€ æˆç®¡ç†ç¬¬ä¸‰æ–¹åº”ç”¨çš„ App Store</a></li>
<li><a href="https://sspai.com/post/32857" target="_blank" rel="noopener">å€ŸåŠ© Homebrew Caskï¼Œæ•™ä½ å¿«é€Ÿä¸‹è½½å®‰è£… Mac App æ–°å§¿åŠ¿</a></li>
<li><a href="https://github.com/serhii-londar/open-source-mac-os-apps" target="_blank" rel="noopener">Awesome macOS open source applications</a></li>
<li><a href="https://sspai.com/post/48380" target="_blank" rel="noopener">å†™ç»™ Mac æ–°æ‰‹çš„å…¥é—¨ App æŒ‡å— @å°‘æ•°æ´¾</a></li>
</ul>
<ul>
<li><p><a href="http://mp.weixin.qq.com/s?__biz=MzAxNzcwMTA4Ng==&amp;mid=743765127&amp;idx=1&amp;sn=b3eb339b1314afff12942f52febac2a5&amp;scene=25#wechat_redirect" target="_blank" rel="noopener">é‚£äº›ä½ ä¸çŸ¥é“çš„Macå°æŠ€å·§ï¼ˆä¸€ï¼‰</a></p>
<ul>
<li>å¿«é€Ÿæ‰“å‡º Apple logoï¼š<strong>option+shift+K</strong></li>
<li>æŸ¥çœ‹æ‰€æœ‰Emojiç¬¦å·ï¼š<strong>ctrl+cmd+ç©ºæ ¼</strong></li>
</ul>
</li>
<li><p><a href="http://mp.weixin.qq.com/s?__biz=MzAxNzcwMTA4Ng==&amp;mid=748992520&amp;idx=1&amp;sn=45a3c3c9aeb3411339bc777d143f021f&amp;scene=21#wechat_redirect" target="_blank" rel="noopener">é‚£äº›ä½ ä¸çŸ¥é“çš„Macå°æŠ€å·§ï¼ˆäºŒï¼‰</a></p>
<ul>
<li>å‘ååˆ é™¤ï¼šFn + Delete</li>
<li>å¿«é€Ÿæ¯å±ï¼šControl + Shift + Ejectï¼ˆå¼€æœºé”®ï¼‰</li>
<li>å½’ç±»å¤šä¸ªæ–‡æ¡£</li>
<li>æ‰¹é‡ä¿®æ”¹æ–‡ä»¶å</li>
</ul>
</li>
<li><p><a href="http://mp.weixin.qq.com/s?__biz=MzAxNzcwMTA4Ng==&amp;mid=771251268&amp;idx=1&amp;sn=98a4924eb64e943f661c3ec53dbb5b4a&amp;scene=21#wechat_redirect" target="_blank" rel="noopener">é‚£äº›ä½ ä¸çŸ¥é“çš„Macå®ç”¨åŠŸèƒ½ï¼ˆäºŒï¼‰</a></p>
<ul>
<li>â¡é¢„è§ˆâ¦- å›¾ç‰‡è£å‰ªåŠŸèƒ½</li>
<li>â¡é¢„è§ˆâ¦- æå–åº”ç”¨ç¨‹åºå›¾æ ‡</li>
<li>Mac è¯­éŸ³è¾“å…¥åŠŸèƒ½</li>
</ul>
</li>
<li><p><a href="http://mp.weixin.qq.com/s?__biz=MzAxNzcwMTA4Ng==&amp;mid=752261609&amp;idx=1&amp;sn=d3fe4ec78bb3366261b93b8ae5a780db&amp;scene=25#wechat_redirect" target="_blank" rel="noopener">é‚£äº›ä½ ä¸çŸ¥é“çš„Macå°æŠ€å·§ï¼ˆä¸‰ï¼‰</a></p>
<ul>
<li>åˆ†å±åŠŸèƒ½</li>
<li>æŸ¥çœ‹ç®€ä»‹ï¼šcmd+i</li>
<li>å¿«é€ŸæŸ¥å•è¯</li>
</ul>
</li>
<li><p><a href="http://mp.weixin.qq.com/s?__biz=MzAxNzcwMTA4Ng==&amp;mid=757795270&amp;idx=1&amp;sn=56277a16fb8c56f49a256a3e4a2973cb&amp;scene=21#wechat_redirect" target="_blank" rel="noopener">é‚£äº›ä½ ä¸çŸ¥é“çš„Macå°æŠ€å·§(å››)</a></p>
<ul>
<li>é€Ÿè¾“åŸŸåï¼šbaidu/ ä»£æ›¿ baidu.com</li>
<li>æ›´æ”¹APPå›¾æ ‡ï¼šcmd+iã€cmd+cã€cmd+vã€cmd+deleteè¿˜åŸ</li>
<li>å¿«é€ŸæŸ¥æ‰¾</li>
<li>Finderè¾¹æ </li>
</ul>
</li>
<li><p><a href>é‚£äº›ä½ ä¸çŸ¥é“çš„Macå°æŠ€å·§(äº”)</a></p>
<ul>
<li>æ”¾å¤§/ç¼©å°å±å¹•æ˜¾ç¤ºï¼šcontrol+é¼ æ ‡æ»šè½®</li>
<li>é”å®šé”®ç›˜å’Œè§¦æ§æ¿ï¼šç³»ç»Ÿåå¥½è®¾ç½®-è¾…åŠ©åŠŸèƒ½</li>
<li>è®¾ç½®æ–‡ä»¶é»˜è®¤æ‰“å¼€æ–¹å¼</li>
</ul>
</li>
<li><p><a href>é‚£äº›ä½ ä¸çŸ¥é“çš„Macå°æŠ€å·§(å…­)</a></p>
<ul>
<li>è§¦æ§æ¿æ‰‹åŠ¿</li>
<li>æ˜¾ç¤ºèµ„æºåº“</li>
<li>è®¾ç½®æ–‡ä»¶ä¸‹è½½ä½ç½®</li>
</ul>
</li>
<li><p><a href>é‚£äº›ä½ ä¸çŸ¥é“çš„Macå°æŠ€å·§(ä¸ƒ)</a></p>
<ul>
<li><p>emojiè¡¨æƒ…ï¼šcontrol+command+ç©ºæ ¼é”®</p>
</li>
<li><p>è°ƒæ•´Launchpadå›¾æ ‡å¤§å°</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// é»˜è®¤ï¼š5*7</span></span><br><span class="line"><span class="comment">// æ”¹è¡Œæ•°</span></span><br><span class="line">defaults write com<span class="selector-class">.apple</span><span class="selector-class">.dock</span> springboard-rows -int <span class="number">6</span></span><br><span class="line"><span class="comment">// æ”¹åˆ—æ•°</span></span><br><span class="line">defaults write com<span class="selector-class">.apple</span><span class="selector-class">.dock</span> springboard-<span class="attribute">columns</span> -int <span class="number">8</span></span><br><span class="line"><span class="comment">// é‡å¯Dock</span></span><br><span class="line">killall Dock</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p><a href="http://mp.weixin.qq.com/s?__biz=MzAxNzcwMTA4Ng==&amp;mid=805017451&amp;idx=1&amp;sn=c592caa3a1ea0de2490a03cfe18daec3&amp;scene=21#wechat_redirect" target="_blank" rel="noopener">é‚£äº›ç›¸è§æ¨æ™šçš„Macå°æŠ€å·§(å…«)</a></p>
<ul>
<li>å®‰å…¨æ€§ä¸éšç§</li>
<li>åŠ å¯†å‹ç¼©æ–‡ä»¶ï¼šå½’æ¡£å®ç”¨å·¥å…·ã€</li>
</ul>
</li>
<li><p><a href>é‚£äº›ç›¸è§æ¨æ™šçš„Macå°æŠ€å·§(ä¹)</a></p>
<ul>
<li>Mac ä¸‹è½½æŠ€å·§</li>
<li>Folx</li>
</ul>
</li>
<li><p><a href>é‚£äº›ç›¸è§æ¨æ™šçš„Macå°æŠ€å·§(å)</a></p>
<ul>
<li>iPhoneã€iPadå±å¹•å…±äº«è‡³Macï¼šQuickTime Player</li>
</ul>
</li>
<li><p><a href>é‚£äº›ç›¸è§æ¨æ™šçš„Macå°æŠ€å·§(åä¸€)</a></p>
<ul>
<li>ç²¾å‡†è°ƒèŠ‚éŸ³é‡ï¼šé…åˆ Option+shift</li>
<li>éšè—æ¡Œé¢æ‰€æœ‰æ–‡ä»¶</li>
<li>æ˜¾ç¤ºç³»ç»Ÿéšè—æ–‡ä»¶</li>
</ul>
</li>
<li><p><a href="http://mp.weixin.qq.com/s?__biz=MzAxNzcwMTA4Ng==&amp;mid=2247483918&amp;idx=1&amp;sn=407dfae80ca32819796d67d516d1e352&amp;scene=21#wechat_redirect" target="_blank" rel="noopener">é‚£äº›ç›¸è§æ¨æ™šçš„MacæŠ€å·§(åäºŒ)</a></p>
<ul>
<li>çª—å£æœ€å¤§åŒ–ï¼šoption</li>
<li>å¼€æœºå¯åŠ¨é¡¹ï¼šç³»ç»Ÿåå¥½è®¾ç½®ï¼ç”¨æˆ·ä¸ç¾¤ç»„ï¼ç™»å½•é¡¹</li>
<li>å‰ªåˆ‡ç§»åŠ¨æ–‡ä»¶ï¼šcommand+option+V</li>
</ul>
</li>
<li><p><a href>é‚£äº›ç›¸è§æ¨æ™šçš„Macå°æŠ€å·§(åä¸‰)</a></p>
<ul>
<li>å®šæ—¶å…³æœº</li>
<li>å¼ºåˆ¶é€€å‡ºï¼šcommand+option+esc</li>
<li>åˆ‡æ¢åº”ç”¨ç¨‹åºï¼šcommand+tabã€command+shift+tab</li>
</ul>
</li>
<li><p><a href>é‚£äº›ç›¸è§æ¨æ™šçš„Macå°æŠ€å·§(åå››)</a></p>
<ul>
<li>ç³»ç»Ÿåå¥½è®¾ç½®-é€šç”¨é¢æ¿è§£æ</li>
</ul>
</li>
<li><p><a href>é‚£äº›ç›¸è§æ¨æ™šçš„Macå°æŠ€å·§(åäº”)</a></p>
<ul>
<li>è®¾ç½®å£çº¸</li>
<li>è®¾ç½®è§¦å‘è§’</li>
<li>è®¾ç½®Dock</li>
</ul>
</li>
<li><p><a href>é‚£äº›ç›¸è§æ¨æ™šçš„Macå°æŠ€å·§(åå…­)</a></p>
<ul>
<li>æŠ“å–ç½‘é¡µå›¾ç‰‡</li>
<li>æ·»åŠ æ¡Œé¢</li>
</ul>
</li>
<li><p><a href>é‚£äº›ç›¸è§æ¨æ™šçš„Macå°æŠ€å·§(åä¸ƒ)</a></p>
<ul>
<li>åˆ†é…æ¡Œé¢ï¼šå°†æŸä¸ªåº”ç”¨ç¨‹åºåˆ†é…ç»™å›ºå®šçš„æ¡Œé¢</li>
<li>éšè—å…¶ä»–ç¨‹åºï¼šoption+command+h</li>
<li>å·¦å³æ»‘åŠ¨é¡µé¢ï¼šshift+é¼ æ ‡æ»šè½®</li>
</ul>
</li>
<li><p><a href>é‚£äº›ç›¸è§æ¨æ™šçš„Macå°æŠ€å·§(åå…«)</a></p>
<ul>
<li>è‡ªå®šä¹‰ç”¨æˆ·ç™»å½•çª—å£ï¼šã€Œç³»ç»Ÿåå¥½è®¾ç½®ã€- ã€Œç”¨æˆ·ä¸ç¾¤ä¸»ã€å…³é—­å®¢äººç”¨æˆ·ï¼Œç™»å½•çª—å£æ˜¾ç¤ºä¸ºåç§°å’Œå¯†ç </li>
<li>æ–‡ä»¶æ ‡è®°åŠŸèƒ½</li>
<li>å¿«æ·é”®<ul>
<li>ä¸€é”®åˆ°ç½‘é¡µé¡¶éƒ¨ï¼šcmd + ä¸Š æˆ–è€… fn + å·¦ï¼›</li>
<li>ä¸€é”®åˆ°ç½‘é¡µåº•éƒ¨ï¼šcmd + ä¸‹ æˆ–è€… fn + å³</li>
<li>ç½‘é¡µçš„å‰è¿›ï¼šcmd + å·¦</li>
<li>ç½‘é¡µçš„åé€€ï¼šcmd + å³</li>
<li>ä¸Šä¸€é¡µï¼ˆPageUpï¼‰ï¼šfn + ä¸Š</li>
<li>ä¸‹ä¸€ä¸ªï¼ˆPageDownï¼‰ï¼šfn +  ä¸‹</li>
</ul>
</li>
</ul>
</li>
<li><p><a href="http://mp.weixin.qq.com/s?__biz=MzAxNzcwMTA4Ng==&amp;mid=2247484789&amp;idx=1&amp;sn=18acc76da8e85ce16b7b8b47ca33fcdc&amp;scene=19#wechat_redirect" target="_blank" rel="noopener">ç›¸è§æ¨æ™šçš„MacæŠ€å·§(åä¹)</a></p>
<ul>
<li>caps lock åˆ‡æ¢è¾“å…¥æ³•</li>
<li>æå– App UI å›¾ç‰‡ï¼šExtrac </li>
<li>è‡ªå®šä¹‰æ–‡ä»¶å¤¹å›¾æ ‡ï¼š<a href="http://www.iconarchive.com/tag/folder" target="_blank" rel="noopener">IconArchive</a> ã€Foldery</li>
</ul>
</li>
<li><p><a href="http://mp.weixin.qq.com/s?__biz=MzAxNzcwMTA4Ng==&amp;mid=2247484830&amp;idx=1&amp;sn=37da4e3190f41fa96ce2cf85c22ff450&amp;scene=19#wechat_redirect" target="_blank" rel="noopener">ç›¸è§æ¨æ™šçš„MacæŠ€å·§ï¼ˆäºŒå)</a></p>
<ul>
<li>ç²˜è´´ä¸ºçº¯æ–‡æœ¬ï¼š shift + option + cmd + v </li>
<li>ä¿®æ”¹æ–‡ä»¶æ‰©å±•å</li>
<li>åˆ é™¤å¸¦é—®å·çš„APPå›¾æ ‡ï¼šæ‹–å…¥åºŸçº¸ç¯“</li>
</ul>
</li>
<li><p><a href>é‚£äº›ç›¸è§æ¨æ™šçš„Macå°æŠ€å·§(äºŒåä¸€)</a></p>
</li>
<li><p><a href>é‚£äº›ç›¸è§æ¨æ™šçš„Macå°æŠ€å·§(äºŒåäºŒ)</a></p>
<ul>
<li>Dashboard ä»ªè¡¨ç›˜</li>
<li>æ—‹è½¬å±å¹•</li>
<li>å¯åŠ¨æŒ‰é”®éŸ³ï¼šã€Œç³»ç»Ÿåå¥½è®¾ç½®ã€- ã€Œè¾…åŠ©åŠŸèƒ½ã€- ã€Œé”®ç›˜ã€- ã€Œå¯ç”¨æ…¢é€Ÿé”®ã€- ã€Œé€‰é¡¹ã€- ã€Œå¯ç”¨æŒ‰é”®éŸ³ã€ã€Tickeys è½¯ä»¶</li>
</ul>
</li>
<li><p>ç¦ç”¨ä»ªè¡¨ç›˜ï¼š<br>æ‰“å¼€ç»ˆç«¯ï¼Œè¾“å…¥å¦‚ä¸‹å‘½ä»¤ï¼š</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">defaults write com<span class="selector-class">.apple</span><span class="selector-class">.dashboard</span> mcx-disabled -boolean YES &amp;&amp; killall Dock</span><br></pre></td></tr></table></figure>
</li>
<li><p>å¯ç”¨ä»ªè¡¨ç›˜ï¼š<br>æ‰“å¼€ç»ˆç«¯ï¼Œè¾“å…¥å¦‚ä¸‹å‘½ä»¤ï¼š</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">defaults write com<span class="selector-class">.apple</span><span class="selector-class">.dashboard</span> mcx-disabled -boolean NO &amp;&amp; killall Dock</span><br></pre></td></tr></table></figure>
</li>
</ul>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://andy0570.com/2017/08/14/Mac æ—¶é’Ÿå±å¹•ä¿æŠ¤ç¨‹åº/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ç‹¬æœ¨èˆŸçš„æœ¨">
      <meta itemprop="description" content="æœ‰æ—¶å€™é˜³å…‰å¾ˆå¥½ æœ‰æ—¶å€™é˜³å…‰å¾ˆæš—">
      <meta itemprop="image" content="https://ws1.sinaimg.cn/large/006tNc79gy1g22m14458rj30u014xu0x.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ç‹¬æœ¨èˆŸçš„æœ¨">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2017/08/14/Mac æ—¶é’Ÿå±å¹•ä¿æŠ¤ç¨‹åº/" class="post-title-link" itemprop="url">Mac æ—¶é’Ÿå±å¹•ä¿æŠ¤ç¨‹åº</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              

              
                
              

              <time title="åˆ›å»ºæ—¶é—´ï¼š2017-08-14 10:09:00" itemprop="dateCreated datePublished" datetime="2017-08-14T10:09:00+08:00">2017-08-14</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">æ›´æ–°äº</span>
                
                <time title="ä¿®æ”¹æ—¶é—´ï¼š2019-04-16 15:36:30" itemprop="dateModified" datetime="2019-04-16T15:36:30+08:00">2019-04-16</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/å¼€å‘å·¥å…·-Macåº”ç”¨/" itemprop="url" rel="index"><span itemprop="name">å¼€å‘å·¥å…·&Macåº”ç”¨</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          
            <span id="/2017/08/14/Mac æ—¶é’Ÿå±å¹•ä¿æŠ¤ç¨‹åº/" class="leancloud_visitors" data-flag-title="Mac æ—¶é’Ÿå±å¹•ä¿æŠ¤ç¨‹åº">
              <span class="post-meta-divider">|</span>
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              
                <span class="post-meta-item-text">é˜…è¯»æ¬¡æ•°ï¼š</span>
              
                <span class="leancloud-visitors-count"></span>
            </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body han-init-context" itemprop="articleBody">

      
      

      
        
          
            <p><img src="http://upload-images.jianshu.io/upload_images/2648731-2a8a26b2b835b99c.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/620" alt></p>
<ul>
<li><a href="http://padbury.me/clock/" target="_blank" rel="noopener">LEDæ•°å­—æ—¶é’Ÿï¼šPadburyClock</a></li>
<li><a href="http://fliqlo.com/#about" target="_blank" rel="noopener">æœºæ¢°ç¿»é¡µå¼æ—¶é’Ÿï¼šFliqlo</a> - å¯ä»¥æ˜¾ç¤ºæ—¶ã€åˆ†</li>
<li><a href="http://goondaba.com/s/FlipClock.zip" target="_blank" rel="noopener">æœºæ¢°ç¿»é¡µå¼æ—¶é’Ÿï¼šFlipClock</a> - å¯ä»¥æ˜¾ç¤ºæ—¶ã€åˆ†ã€ç§’</li>
<li><a href="http://www.rasmusnielsen.dk/applewatch/" target="_blank" rel="noopener">æ‰‹è¡¨ä¸»é¢˜æ—¶é’Ÿï¼šApple Watch Screen Saver</a></li>
<li><a href="http://www.macupdate.com/info.php/id/19934" target="_blank" rel="noopener">æ°´æ³¢å±å¹•ä¿æŠ¤ï¼šLotsaWater</a></li>
<li><a href="https://github.com/nemesit/SwiftBubble" target="_blank" rel="noopener">è™šå¹»æ•ˆæœï¼šSwiftBubble</a></li>
<li><a href="https://github.com/soffes/Countdown/releases" target="_blank" rel="noopener">å€’è®¡æ—¶ï¼šCountDown</a></li>
<li><a href="http://s.sudre.free.fr/Software/SaveHollywood/about.html" target="_blank" rel="noopener">æŠŠè§†é¢‘ä½œä¸ºå±ä¿ï¼šSaveHollywood</a></li>
</ul>
<h3 id="æ¨èé˜…è¯»"><a href="#æ¨èé˜…è¯»" class="headerlink" title="æ¨èé˜…è¯»"></a>æ¨èé˜…è¯»</h3><ul>
<li><a href="https://www.waerfa.com/39-best-screensavers-for-macos" target="_blank" rel="noopener">è¿™äº›å¹´æˆ‘åœ¨ Mac ä¸Šç”¨è¿‡çš„ 39 æ¬¾ç²¾å“å±ä¿ç¨‹åº</a></li>
<li><a href="http://www.mac52ipod.cn/go.php/category/Apple-Skill/" target="_blank" rel="noopener">å‚è€ƒåšå®¢</a></li>
<li><a href="https://appso.gitbooks.io/macos/content/you-xiu-di-san-fang-app-tui-jian-2014-2014-zhuo-mian-zheng-li-zhu/7-kuan-shi-yong-you-hao-kan-de-mac-ping-bao-ff0c-kuai-shou-cang-ff01.html" target="_blank" rel="noopener">7 æ¬¾å®ç”¨åˆå¥½çœ‹çš„ Mac å±ä¿</a></li>
</ul>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/15/"><i class="fa fa-angle-left" aria-label="ä¸Šä¸€é¡µ"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/15/">15</a><span class="page-number current">16</span><a class="page-number" href="/page/17/">17</a><span class="space">&hellip;</span><a class="page-number" href="/page/32/">32</a><a class="extend next" rel="next" href="/page/17/"><i class="fa fa-angle-right" aria-label="ä¸‹ä¸€é¡µ"></i></a>
  </nav>



          </div>
          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <div class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image" src="https://ws1.sinaimg.cn/large/006tNc79gy1g22m14458rj30u014xu0x.jpg" alt="ç‹¬æœ¨èˆŸçš„æœ¨">
            
              <p class="site-author-name" itemprop="name">ç‹¬æœ¨èˆŸçš„æœ¨</p>
              <div class="site-description motion-element" itemprop="description">æœ‰æ—¶å€™é˜³å…‰å¾ˆå¥½ æœ‰æ—¶å€™é˜³å…‰å¾ˆæš—</div>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/">
                
                    <span class="site-state-item-count">311</span>
                    <span class="site-state-item-name">æ—¥å¿—</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-categories">
                  
                    
                      <a href="/categories/">
                    
                  
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">15</span>
                    <span class="site-state-item-name">åˆ†ç±»</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-tags">
                  
                    
                      <a href="/tags/">
                    
                  
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">74</span>
                    <span class="site-state-item-name">æ ‡ç­¾</span>
                  </a>
                </div>
              
            </nav>
          

          
            <div class="feed-link motion-element">
              <a href="/atom.xml" rel="alternate">
                <i class="fa fa-rss"></i>
                RSS
              </a>
            </div>
          

          

          
            <div class="links-of-author motion-element">
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                    
                  
                  <a href="https://github.com/Andy0570" title="GitHub &rarr; https://github.com/Andy0570" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i>GitHub</a>
                </span>
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                    
                  
                  <a href="mailto:andywhm@163.com" title="E-Mail &rarr; mailto:andywhm@163.com" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                </span>
              
            </div>
          

          
             <div class="cc-license motion-element" itemprop="license">
              
              
                
              
              
              
              <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" class="cc-opacity" rel="noopener" target="_blank"><img src="/images/cc-by-nc-sa.svg" alt="Creative Commons"></a>
             </div>
          

          
          

          
            
          
          

        </div>
      </div>

      

      

    </div>
  </aside>
  


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">ç‹¬æœ¨èˆŸçš„æœ¨</span>

  

  
</div>


  <div class="powered-by">ç”± <a href="https://hexo.io" class="theme-link" rel="noopener" target="_blank">Hexo</a> å¼ºåŠ›é©±åŠ¨ v3.8.0</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">ä¸»é¢˜ â€“ <a href="https://theme-next.org" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> v7.1.0</div>




        








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

    

    
  </div>

  

<script>
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>





  



  






  



  
    
    
      
    
  
  <script color="17,119,176" opacity="0.5" zindex="-1" count="99" src="//cdn.jsdelivr.net/gh/theme-next/theme-next-canvas-nest@1/canvas-nest.min.js"></script>













  
  <script src="//cdn.jsdelivr.net/npm/jquery@2/dist/jquery.min.js"></script>

  
  <script src="//cdn.jsdelivr.net/npm/fastclick@1/lib/fastclick.min.js"></script>

  
  <script src="//cdn.jsdelivr.net/npm/jquery-lazyload@1/jquery.lazyload.min.js"></script>

  
  <script src="//cdn.jsdelivr.net/npm/velocity-animate@1/velocity.min.js"></script>

  
  <script src="//cdn.jsdelivr.net/npm/velocity-animate@1/velocity.ui.min.js"></script>

  
  <script src="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.js"></script>


  


  <script src="/js/utils.js?v=7.1.0"></script>

  <script src="/js/motion.js?v=7.1.0"></script>



  
  


  <script src="/js/affix.js?v=7.1.0"></script>

  <script src="/js/schemes/pisces.js?v=7.1.0"></script>




  

  


  <script src="/js/next-boot.js?v=7.1.0"></script>


  

  

  
  
  
    
  

  
    
      
    
  

  
  
  
    <script src="//cdn.jsdelivr.net/npm/quicklink@1/dist/quicklink.umd.js"></script>
    <script>
      
        window.addEventListener('load', () => {
      
        quicklink({
          timeout: 3000,
          priority: true,
          ignores: [uri => uri.includes('#'),uri => uri == 'https://andy0570.com/page/16/',]
        });
      
        });
      
    </script>
  


  



  



  
  
  
    
  
  <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/instantsearch.js@2/dist/instantsearch.min.css">

  
  
    
  
  <script src="//cdn.jsdelivr.net/npm/instantsearch.js@2/dist/instantsearch.js"></script>
  

  <script src="/js/algolia-search.js?v=7.1.0"></script>



  
  
  <script>
    
    function showTime(Counter) {
      var entries = [];
      var $visitors = $('.leancloud_visitors');

      $visitors.each(function() {
        entries.push( $(this).attr('id').trim() );
      });

      Counter('get', '/classes/Counter', { where: JSON.stringify({ url: { '$in': entries } }) })
        .done(function({ results }) {
          var COUNT_CONTAINER_REF = '.leancloud-visitors-count';

          if (results.length === 0) {
            $visitors.find(COUNT_CONTAINER_REF).text(0);
            return;
          }

          for (var i = 0; i < results.length; i++) {
            var item = results[i];
            var url = item.url;
            var time = item.time;
            var element = document.getElementById(url);

            $(element).find(COUNT_CONTAINER_REF).text(time);
          }
          for (var i = 0; i < entries.length; i++) {
            var url = entries[i];
            var element = document.getElementById(url);
            var countSpan = $(element).find(COUNT_CONTAINER_REF);
            if (countSpan.text() == '') {
              countSpan.text(0);
            }
          }
        })
        .fail(function ({ responseJSON }) {
          console.log('LeanCloud Counter Error: ' + responseJSON.code + ' ' + responseJSON.error);
        });
    }
    

    $(function() {
      $.get('https://app-router.leancloud.cn/2/route?appId=' + 'S7i1Y8YorMKFPaYbJbekD5el-gzGzoHsz')
        .done(function({ api_server }) {
          var Counter = function(method, url, data) {
            return $.ajax({
              method: method,
              url: 'https://' + api_server + '/1.1' + url,
              headers: {
                'X-LC-Id': 'S7i1Y8YorMKFPaYbJbekD5el-gzGzoHsz',
                'X-LC-Key': 'brOnU8mOQvSjpipJvdKUAIbU',
                'Content-Type': 'application/json',
              },
              data: data
            });
          };
          
            if ($('.post-title-link').length >= 1) {
              showTime(Counter);
            }
          
        });
    });
  </script>



  

  

  

  

  

  

  

  

  
  
  
    
  
  <script src="//cdn.jsdelivr.net/npm/pangu@4/dist/browser/pangu.min.js"></script>
  <script>pangu.spacingPage();</script>


  
  
  
    
  
  <script src="//cdn.jsdelivr.net/gh/theme-next/theme-next-bookmark@1/bookmark.min.js"></script>
  <script>
  
    bookmark.loadBookmark();
  
  </script>


  

  

  


  <!-- red heart -->
  <script type="text/javascript" src="/js/src/love.js"></script>
  
</body>
</html>
