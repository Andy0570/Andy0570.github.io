<!DOCTYPE html>













<html class="theme-next gemini" lang="zh-CN">
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">




  
  
    
      
    
    
      
    
  <script src="//cdn.jsdelivr.net/npm/pace-js@1/pace.min.js"></script>
  <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/pace-js@1/themes/blue/pace-theme-minimal.css">



  
  
    
  
  <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/han-css@3/dist/han.min.css">













  
  
    
  
  <link rel="stylesheet" href="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.css">







  

<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/font-awesome@4/css/font-awesome.min.css">

<link rel="stylesheet" href="/css/main.css?v=7.1.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/panda/apple-touch-icon.png?v=7.1.0">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/panda/favicon-32x32.png?v=7.1.0">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/panda/favicon-16x16.png?v=7.1.0">


  <link rel="mask-icon" href="/images/panda/safari-pinned-tab.svg?v=7.1.0" color="#222">


  <link rel="manifest" href="/images/panda/site.webmanifest">


  <meta name="msapplication-config" content="/images/panda/browserconfig.xml">





<script id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '7.1.0',
    sidebar: {"position":"left","display":"post","offset":12,"onmobile":false,"dimmer":false},
    back2top: true,
    back2top_sidebar: false,
    fancybox: true,
    fastclick: true,
    lazyload: true,
    tabs: true,
    motion: {"enable":false,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '0E2AON8EZF',
      apiKey: '22fbefd84c8343239f5c04365b9728de',
      indexName: 'MyBlogPlatform',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  <meta name="description" content="有时候阳光很好 有时候阳光很暗">
<meta name="keywords" content="独木舟的木">
<meta property="og:type" content="website">
<meta property="og:title" content="独木舟的木">
<meta property="og:url" content="https://andy0570.com/page/5/index.html">
<meta property="og:site_name" content="独木舟的木">
<meta property="og:description" content="有时候阳光很好 有时候阳光很暗">
<meta property="og:locale" content="zh-CN">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="独木舟的木">
<meta name="twitter:description" content="有时候阳光很好 有时候阳光很暗">



  <link rel="alternate" href="/atom.xml" title="独木舟的木" type="application/atom+xml">



  
  
  <link rel="canonical" href="https://andy0570.com/page/5/">



<script id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>独木舟的木</title>
  






  <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?8229a094facca297f211d61323fd9fde";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>







  <noscript>
  <style>
  .use-motion .motion-element,
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-title { opacity: initial; }

  .use-motion .logo,
  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-CN">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <a href="https://github.com/andy0570" class="github-corner" aria-label="View source on GitHub"><svg width="80" height="80" viewbox="0 0 250 250" style="fill:#151513; color:#fff; position: absolute; top: 0; border: 0; right: 0;" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"/><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"/><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"/></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style>
    
    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">独木舟的木</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
      
        <p class="site-subtitle">iOS Developer</p>
      
    
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="切换导航栏">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home">

    
    
    
      
    

    
      
    

    <a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i> <br>首页</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-categories">

    
    
    
      
    

    
      
    

    <a href="/categories/" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i> <br>分类<span class="badge">14</span></a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-tags">

    
    
    
      
    

    
      
    

    <a href="/tags/" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i> <br>标签<span class="badge">37</span></a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">

    
    
    
      
    

    
      
    

    <a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i> <br>归档<span class="badge">317</span></a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-about">

    
    
    
      
    

    
      
    

    <a href="/about/" rel="section"><i class="menu-item-icon fa fa-fw fa-user"></i> <br>关于</a>

  </li>

      
      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br>搜索</a>
        </li>
      
    </ul>
  

  

  
    <div class="site-search">
      
  
  <div class="algolia-popup popup search-popup">
    <div class="algolia-search">
      <div class="algolia-search-input-icon">
        <i class="fa fa-search"></i>
      </div>
      <div class="algolia-search-input" id="algolia-search-input"></div>
    </div>

    <div class="algolia-results">
      <div id="algolia-stats"></div>
      <div id="algolia-hits"></div>
      <div id="algolia-pagination" class="algolia-pagination"></div>
    </div>

    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
  </div>




    </div>
  
</nav>



  



</div>
    </header>

    
  
  

  

  <a href="https://github.com/andy0570" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewbox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"/><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"/><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"/></svg></a>



    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
            

          
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://andy0570.com/2018/12/12/Web 开发的身份数据和安全_1.导论/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="独木舟的木">
      <meta itemprop="description" content="有时候阳光很好 有时候阳光很暗">
      <meta itemprop="image" content="https://blog-andy0570-1256077835.cos.ap-shanghai.myqcloud.com/site_Images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="独木舟的木">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2018/12/12/Web 开发的身份数据和安全_1.导论/" class="post-title-link" itemprop="url">Web 开发的身份数据和安全_1.导论</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2018-12-12 02:16:00" itemprop="dateCreated datePublished" datetime="2018-12-12T02:16:00+08:00">2018-12-12</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2019-04-28 15:59:34" itemprop="dateModified" datetime="2019-04-28T15:59:34+08:00">2019-04-28</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/PKI-密码学/" itemprop="url" rel="index"><span itemprop="name">PKI&密码学</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          
            <span id="/2018/12/12/Web 开发的身份数据和安全_1.导论/" class="leancloud_visitors" data-flag-title="Web 开发的身份数据和安全_1.导论">
              <span class="post-meta-divider">|</span>
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              
                <span class="post-meta-item-text">阅读次数：</span>
              
                <span class="leancloud-visitors-count"></span>
            </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body han-init-context" itemprop="articleBody">

      
      

      
        
          <blockquote>
<p>参考：《Web 开发的身份数据和安全》</p>
</blockquote>
          <!--noindex-->
          
            <div class="post-button text-center">
              <a class="btn" href="/2018/12/12/Web 开发的身份数据和安全_1.导论/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          
          <!--/noindex-->
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://andy0570.com/2018/12/11/浅尝辄止·摄影/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="独木舟的木">
      <meta itemprop="description" content="有时候阳光很好 有时候阳光很暗">
      <meta itemprop="image" content="https://blog-andy0570-1256077835.cos.ap-shanghai.myqcloud.com/site_Images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="独木舟的木">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2018/12/11/浅尝辄止·摄影/" class="post-title-link" itemprop="url">浅尝辄止·摄影</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2018-12-11 00:47:00" itemprop="dateCreated datePublished" datetime="2018-12-11T00:47:00+08:00">2018-12-11</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2019-04-28 15:59:34" itemprop="dateModified" datetime="2019-04-28T15:59:34+08:00">2019-04-28</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/开发工具-Mac应用/" itemprop="url" rel="index"><span itemprop="name">开发工具&Mac应用</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          
            <span id="/2018/12/11/浅尝辄止·摄影/" class="leancloud_visitors" data-flag-title="浅尝辄止·摄影">
              <span class="post-meta-divider">|</span>
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              
                <span class="post-meta-item-text">阅读次数：</span>
              
                <span class="leancloud-visitors-count"></span>
            </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body han-init-context" itemprop="articleBody">

      
      

      
        
          
            <p>参考：<a href="https://www.apple.com/cn/iphone/photography-how-to/" target="_blank" rel="noopener">Apple 官方教程：使用 iPhone 拍摄的窍门</a></p>
<h3 id="使用-iPhone-「景深控制功能」调整照片的窍门"><a href="#使用-iPhone-「景深控制功能」调整照片的窍门" class="headerlink" title="使用 iPhone 「景深控制功能」调整照片的窍门"></a>使用 iPhone 「景深控制功能」调整照片的窍门</h3><ol>
<li>选一张人像；</li>
<li>轻点「编辑」；</li>
<li>滑动来调节景深；</li>
<li>轻点「完成」；</li>
</ol>
<h3 id="使用-iPhone-编辑「人像自拍」的窍门"><a href="#使用-iPhone-编辑「人像自拍」的窍门" class="headerlink" title="使用 iPhone 编辑「人像自拍」的窍门"></a>使用 iPhone 编辑「人像自拍」的窍门</h3><ol>
<li>打开相簿，选一张「人像自拍」；</li>
<li>轻点「编辑」；</li>
<li>选择「光效」；</li>
<li>滑动来调节景深；</li>
<li>轻点「完成」；</li>
</ol>
<h3 id="使用-iPhoneX「慢动作」拍摄的窍门"><a href="#使用-iPhoneX「慢动作」拍摄的窍门" class="headerlink" title="使用 iPhoneX「慢动作」拍摄的窍门"></a>使用 iPhoneX「慢动作」拍摄的窍门</h3><ol>
<li>找个尽可能低的角度；</li>
<li>选择慢动作模式；</li>
<li>调整效果的起点；</li>
</ol>
<h3 id="使用-iPhoneX「逆光」拍摄的窍门"><a href="#使用-iPhoneX「逆光」拍摄的窍门" class="headerlink" title="使用 iPhoneX「逆光」拍摄的窍门"></a>使用 iPhoneX「逆光」拍摄的窍门</h3><ol>
<li>锁定对焦（轻点画面），调整曝光（按住空白处上下拖动手指）；</li>
<li>制造点气氛；</li>
<li>抓拍动作；</li>
</ol>
<h3 id="使用-iPhoneX「连拍快照」拍摄的窍门"><a href="#使用-iPhoneX「连拍快照」拍摄的窍门" class="headerlink" title="使用 iPhoneX「连拍快照」拍摄的窍门"></a>使用 iPhoneX「连拍快照」拍摄的窍门</h3><ol>
<li>找到合适的角度；</li>
<li><strong>按住快门按钮</strong>，激活连拍快照模式；</li>
<li>选择你最喜欢的；</li>
</ol>
<h3 id="使用-iPhoneX「全景拍摄」的窍门"><a href="#使用-iPhoneX「全景拍摄」的窍门" class="headerlink" title="使用 iPhoneX「全景拍摄」的窍门"></a>使用 iPhoneX「全景拍摄」的窍门</h3><p><img src="https://blog-andy0570-1256077835.cos.ap-shanghai.myqcloud.com/site_Images/075407.png" alt="全景拍摄"></p>
<ol>
<li>选择全景模式；</li>
<li>拍到中间时保持不动（所有人从拍摄者背后绕到另一边摆Poss）；</li>
<li>完成右半边拍摄；</li>
</ol>
<h3 id="让实况照片来回播放的窍门"><a href="#让实况照片来回播放的窍门" class="headerlink" title="让实况照片来回播放的窍门"></a>让实况照片来回播放的窍门</h3><ol>
<li>选一张<strong>实况</strong>照片；</li>
<li>向上轻扫；</li>
<li>选择来回播放；</li>
</ol>
<h3 id="拍摄「黑白照片」的窍门"><a href="#拍摄「黑白照片」的窍门" class="headerlink" title="拍摄「黑白照片」的窍门"></a>拍摄「黑白照片」的窍门</h3><ol>
<li>选一个滤镜（在拍摄画面向上轻扫）；</li>
<li>让主体和背景间形成明显的反差；</li>
<li>调出合适的曝光；</li>
<li>开拍；</li>
</ol>
<h3 id="编辑「慢动作时间点」的窍门"><a href="#编辑「慢动作时间点」的窍门" class="headerlink" title="编辑「慢动作时间点」的窍门"></a>编辑「慢动作时间点」的窍门</h3><ol>
<li>选一段<strong>慢动作</strong>视频；</li>
<li>轻点「编辑」；</li>
<li>滑动调整慢动作时间点（选择慢动作区间）；</li>
<li>完成；</li>
</ol>
<h3 id="「俯视」拍摄的窍门"><a href="#「俯视」拍摄的窍门" class="headerlink" title="「俯视」拍摄的窍门"></a>「俯视」拍摄的窍门</h3><ol>
<li>打开<strong>网格</strong>（系统设置-相机中开启）；</li>
<li>躲开头顶的光线（构图）；</li>
<li>让两个++对齐（让手机水平对齐）；</li>
<li>开拍；</li>
</ol>
<h3 id="「巧用框架构图」拍摄的窍门"><a href="#「巧用框架构图」拍摄的窍门" class="headerlink" title="「巧用框架构图」拍摄的窍门"></a>「巧用框架构图」拍摄的窍门</h3><p><img src="https://blog-andy0570-1256077835.cos.ap-shanghai.myqcloud.com/site_Images/075411.png" alt="巧用框架构图"></p>
<ol>
<li>寻找合适的线条作为框架突出主体；</li>
<li>安排好拍摄主体的位置；</li>
<li>开拍；</li>
</ol>
<h3 id="调整照片「颜色」的窍门"><a href="#调整照片「颜色」的窍门" class="headerlink" title="调整照片「颜色」的窍门"></a>调整照片「颜色」的窍门</h3><ol>
<li>选一张照片；</li>
<li>点一下「编辑」；</li>
<li>调整「颜色」的浓淡（饱和度/对比度/色偏）；</li>
<li>完成；</li>
</ol>
<h3 id="「长焦镜头」构图的窍门"><a href="#「长焦镜头」构图的窍门" class="headerlink" title="「长焦镜头」构图的窍门"></a>「长焦镜头」构图的窍门</h3><ol>
<li>轻点（1x）简化构图；</li>
<li>开拍；</li>
</ol>
<h3 id="拍摄「人像光效照片」的窍门"><a href="#拍摄「人像光效照片」的窍门" class="headerlink" title="拍摄「人像光效照片」的窍门"></a>拍摄「人像光效照片」的窍门</h3><ol>
<li>切换到<strong>人像</strong>模式；</li>
<li>轻扫来选择光线效果；</li>
<li>开拍；</li>
</ol>
<h3 id="编辑「人像光效」的窍门"><a href="#编辑「人像光效」的窍门" class="headerlink" title="编辑「人像光效」的窍门"></a>编辑「人像光效」的窍门</h3><ol>
<li>选择用<strong>人像模式</strong>拍摄的照片；</li>
<li>轻按「编辑」；</li>
<li>轻扫来选择<strong>光线效果</strong>；</li>
<li>轻点完成；</li>
</ol>
<h3 id="拍摄「微距特写」的窍门"><a href="#拍摄「微距特写」的窍门" class="headerlink" title="拍摄「微距特写」的窍门"></a>拍摄「微距特写」的窍门</h3><p><img src="https://blog-andy0570-1256077835.cos.ap-shanghai.myqcloud.com/site_Images/075415.png" alt="微距特写"></p>
<ol>
<li>靠近，再靠近，近到 10cm 为止；</li>
<li>轻点「对焦」，并滑动调整曝光；</li>
<li>开拍；</li>
</ol>
<h3 id="拍摄「竖幅全景」的窍门"><a href="#拍摄「竖幅全景」的窍门" class="headerlink" title="拍摄「竖幅全景」的窍门"></a>拍摄「竖幅全景」的窍门</h3><ol>
<li>首先要把镜头横过来；</li>
<li>切换到「全景」模式；</li>
<li>从底部开始慢慢地平稳地向上；</li>
</ol>
<h3 id="「关闭闪光」拍摄的窍门"><a href="#「关闭闪光」拍摄的窍门" class="headerlink" title="「关闭闪光」拍摄的窍门"></a>「关闭闪光」拍摄的窍门</h3><p><img src="https://blog-andy0570-1256077835.cos.ap-shanghai.myqcloud.com/site_Images/075425.png" alt="关闭闪光"></p>
<ol>
<li>找一个光源；</li>
<li>关闭闪光灯；</li>
<li>轻点拍摄对象设定曝光；</li>
<li>开拍</li>
</ol>
<h3 id="拍摄「动感场景」的窍门"><a href="#拍摄「动感场景」的窍门" class="headerlink" title="拍摄「动感场景」的窍门"></a>拍摄「动感场景」的窍门</h3><ol>
<li>按住快门按钮，使用连拍快照模式；</li>
<li>点开你的照片；</li>
<li>从选一张你喜欢的；</li>
</ol>
<h3 id="拍摄「定时自拍照」的窍门"><a href="#拍摄「定时自拍照」的窍门" class="headerlink" title="拍摄「定时自拍照」的窍门"></a>拍摄「定时自拍照」的窍门</h3><ol>
<li>转换到前置摄像头；</li>
<li>将你的 iPhone 放稳；</li>
<li>设<strong>定时器</strong>；</li>
<li>轻点快门按钮；</li>
</ol>
<h3 id="抓拍「特殊角度」的窍门"><a href="#抓拍「特殊角度」的窍门" class="headerlink" title="抓拍「特殊角度」的窍门"></a>抓拍「特殊角度」的窍门</h3><ol>
<li>选定拍摄对象；</li>
<li>尝试各种角度；</li>
<li>试试斜过来、试试仰起来、试试低下来（斜仰低近，多多尝试）；</li>
<li>开拍；</li>
</ol>
<h3 id="「变焦」拍摄的窍门"><a href="#「变焦」拍摄的窍门" class="headerlink" title="「变焦」拍摄的窍门"></a>「变焦」拍摄的窍门</h3><ol>
<li>变焦有两种方式：<ul>
<li>轻点 1x 可实现两倍光学变焦；</li>
<li>或者轻点并按住 1x 再滑动控制变焦；</li>
</ul>
</li>
<li>开拍；</li>
</ol>
<h3 id="录像时「抓拍照片」的窍门"><a href="#录像时「抓拍照片」的窍门" class="headerlink" title="录像时「抓拍照片」的窍门"></a>录像时「抓拍照片」的窍门</h3><ol>
<li>切换到<strong>视频模式</strong>；</li>
<li>开始拍摄视频；</li>
<li>轻点快门按钮（除了中间的视频拍摄，左下角还有一个按钮）；</li>
</ol>
<h3 id="「用街头光线」拍摄的窍门"><a href="#「用街头光线」拍摄的窍门" class="headerlink" title="「用街头光线」拍摄的窍门"></a>「用街头光线」拍摄的窍门</h3><ol>
<li>关闭闪光灯；</li>
<li>轻点并按住锁定对焦；</li>
<li>调到合适的曝光量；</li>
<li>开拍；</li>
</ol>
<h3 id="「让作品简洁抢眼」的窍门"><a href="#「让作品简洁抢眼」的窍门" class="headerlink" title="「让作品简洁抢眼」的窍门"></a>「让作品简洁抢眼」的窍门</h3><p><img src="https://blog-andy0570-1256077835.cos.ap-shanghai.myqcloud.com/site_Images/075429.png" alt="让作品简洁抢眼"></p>
<ol>
<li>找一些形成强烈反差效果的色彩；</li>
<li>简化一下画面；</li>
<li>使构图平衡对称；</li>
<li>尝试不同的曝光；</li>
<li>开拍</li>
</ol>
<h3 id="「在夕阳余晖下」拍摄的窍门"><a href="#「在夕阳余晖下」拍摄的窍门" class="headerlink" title="「在夕阳余晖下」拍摄的窍门"></a>「在夕阳余晖下」拍摄的窍门</h3><p><img src="https://blog-andy0570-1256077835.cos.ap-shanghai.myqcloud.com/site_Images/075433.png" alt="在夕阳余晖下"></p>
<ol>
<li>赶在日落之前；</li>
<li>让阳光从正面照亮拍摄对象；</li>
<li>轻点并下滑减弱曝光；</li>
<li>开拍；</li>
</ol>
<h3 id="拍摄「单手自拍照」的窍门"><a href="#拍摄「单手自拍照」的窍门" class="headerlink" title="拍摄「单手自拍照」的窍门"></a>拍摄「单手自拍照」的窍门</h3><ol>
<li>将锁定屏幕向左轻扫快速打开相机；</li>
<li>转换到前置摄像头；</li>
<li>按任意一个音量键都可以开拍；</li>
</ol>
<h3 id="拍摄「日落剪影」的窍门"><a href="#拍摄「日落剪影」的窍门" class="headerlink" title="拍摄「日落剪影」的窍门"></a>拍摄「日落剪影」的窍门</h3><ol>
<li>让拍摄对象位于落日前；</li>
<li>轻点并按住锁定对焦；</li>
<li>下滑降低曝光量；</li>
<li>开拍</li>
</ol>
<h3 id="抓拍「亲密瞬间」的窍门"><a href="#抓拍「亲密瞬间」的窍门" class="headerlink" title="抓拍「亲密瞬间」的窍门"></a>抓拍「亲密瞬间」的窍门</h3><p><img src="https://blog-andy0570-1256077835.cos.ap-shanghai.myqcloud.com/site_Images/075435.png" alt="亲密瞬间"></p>
<ol>
<li>将锁定屏幕向左轻扫快速打开相机；</li>
<li>悄悄地将你的手机调成静音；</li>
<li>轻点并按住 1x，再滑动变焦；</li>
<li>轻点对焦并滑动调整曝光量；</li>
<li>开拍；</li>
</ol>
<blockquote>
<p>key：构图、变焦、对焦、曝光量、</p>
</blockquote>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://andy0570.com/2018/12/06/Node.js_uuid 模块/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="独木舟的木">
      <meta itemprop="description" content="有时候阳光很好 有时候阳光很暗">
      <meta itemprop="image" content="https://blog-andy0570-1256077835.cos.ap-shanghai.myqcloud.com/site_Images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="独木舟的木">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2018/12/06/Node.js_uuid 模块/" class="post-title-link" itemprop="url">Node.js_uuid 模块</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2018-12-06 22:49:00" itemprop="dateCreated datePublished" datetime="2018-12-06T22:49:00+08:00">2018-12-06</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2019-04-28 15:59:34" itemprop="dateModified" datetime="2019-04-28T15:59:34+08:00">2019-04-28</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Node-js/" itemprop="url" rel="index"><span itemprop="name">Node.js</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          
            <span id="/2018/12/06/Node.js_uuid 模块/" class="leancloud_visitors" data-flag-title="Node.js_uuid 模块">
              <span class="post-meta-divider">|</span>
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              
                <span class="post-meta-item-text">阅读次数：</span>
              
                <span class="leancloud-visitors-count"></span>
            </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body han-init-context" itemprop="articleBody">

      
      

      
        
          <h1 id="UUID-定义"><a href="#UUID-定义" class="headerlink" title="UUID 定义"></a>UUID 定义</h1><p>UUID 是由一组 32 位的 16 进制数所构成，是故 UUID 理论上的总数为 16^32=2^128，约等于 3.4 x 10^38。也就是说若每<a href="https://www.wikiwand.com/zh-hans/%E7%BA%B3%E7%A7%92" target="_blank" rel="noopener">纳秒</a>产生 1 <a href="https://www.wikiwand.com/zh-hans/%E5%85%86" target="_blank" rel="noopener">兆</a>个 UUID，要花 100 亿年才会将所有 UUID 用完。</p>
<p>UUID 示例：74760410-f963-11e8-b2a3-1bb26e1e5b69</p>
          <!--noindex-->
          
            <div class="post-button text-center">
              <a class="btn" href="/2018/12/06/Node.js_uuid 模块/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          
          <!--/noindex-->
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://andy0570.com/2018/12/06/Node.js_crypto 模块/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="独木舟的木">
      <meta itemprop="description" content="有时候阳光很好 有时候阳光很暗">
      <meta itemprop="image" content="https://blog-andy0570-1256077835.cos.ap-shanghai.myqcloud.com/site_Images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="独木舟的木">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2018/12/06/Node.js_crypto 模块/" class="post-title-link" itemprop="url">Node.js_crypto 模块</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2018-12-06 11:04:00" itemprop="dateCreated datePublished" datetime="2018-12-06T11:04:00+08:00">2018-12-06</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2019-04-28 17:24:50" itemprop="dateModified" datetime="2019-04-28T17:24:50+08:00">2019-04-28</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Node-js/" itemprop="url" rel="index"><span itemprop="name">Node.js</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          
            <span id="/2018/12/06/Node.js_crypto 模块/" class="leancloud_visitors" data-flag-title="Node.js_crypto 模块">
              <span class="post-meta-divider">|</span>
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              
                <span class="post-meta-item-text">阅读次数：</span>
              
                <span class="leancloud-visitors-count"></span>
            </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body han-init-context" itemprop="articleBody">

      
      

      
        
          
            <a id="more"></a>
<h2 id="Hash-算法"><a href="#Hash-算法" class="headerlink" title="Hash 算法"></a>Hash 算法</h2><p>查看 crypto 模块支持的 hash 函数：<code>crypto.getHashes()</code></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">[ <span class="string">'RSA-MD4'</span>,</span><br><span class="line">  <span class="string">'RSA-MD5'</span>,</span><br><span class="line">  <span class="string">'RSA-MDC2'</span>,</span><br><span class="line">  <span class="string">'RSA-RIPEMD160'</span>,</span><br><span class="line">  <span class="string">'RSA-SHA1'</span>,</span><br><span class="line">  <span class="string">'RSA-SHA1-2'</span>,</span><br><span class="line">  <span class="string">'RSA-SHA224'</span>,</span><br><span class="line">  <span class="string">'RSA-SHA256'</span>,</span><br><span class="line">  <span class="string">'RSA-SHA384'</span>,</span><br><span class="line">  <span class="string">'RSA-SHA512'</span>,</span><br><span class="line">  <span class="string">'blake2b512'</span>,</span><br><span class="line">  <span class="string">'blake2s256'</span>,</span><br><span class="line">  <span class="string">'md4'</span>,</span><br><span class="line">  <span class="string">'md4WithRSAEncryption'</span>,</span><br><span class="line">  <span class="string">'md5'</span>,</span><br><span class="line">  <span class="string">'md5-sha1'</span>,</span><br><span class="line">  <span class="string">'md5WithRSAEncryption'</span>,</span><br><span class="line">  <span class="string">'mdc2'</span>,</span><br><span class="line">  <span class="string">'mdc2WithRSA'</span>,</span><br><span class="line">  <span class="string">'ripemd'</span>,</span><br><span class="line">  <span class="string">'ripemd160'</span>,</span><br><span class="line">  <span class="string">'ripemd160WithRSA'</span>,</span><br><span class="line">  <span class="string">'rmd160'</span>,</span><br><span class="line">  <span class="string">'sha1'</span>,</span><br><span class="line">  <span class="string">'sha1WithRSAEncryption'</span>,</span><br><span class="line">  <span class="string">'sha224'</span>,</span><br><span class="line">  <span class="string">'sha224WithRSAEncryption'</span>,</span><br><span class="line">  <span class="string">'sha256'</span>,</span><br><span class="line">  <span class="string">'sha256WithRSAEncryption'</span>,</span><br><span class="line">  <span class="string">'sha384'</span>,</span><br><span class="line">  <span class="string">'sha384WithRSAEncryption'</span>,</span><br><span class="line">  <span class="string">'sha512'</span>,</span><br><span class="line">  <span class="string">'sha512WithRSAEncryption'</span>,</span><br><span class="line">  <span class="string">'ssl3-md5'</span>,</span><br><span class="line">  <span class="string">'ssl3-sha1'</span>,</span><br><span class="line">  <span class="string">'whirlpool'</span> ]</span><br></pre></td></tr></table></figure>
<h3 id="SHA-256"><a href="#SHA-256" class="headerlink" title="SHA-256"></a>SHA-256</h3><p>示例：使用 <code>hash.update()</code> 和 <code>hash.digest()</code>：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> crypto = <span class="built_in">require</span>(<span class="string">'crypto'</span>);</span><br><span class="line"><span class="keyword">const</span> hash = crypto.createHash(<span class="string">'sha256'</span>); <span class="comment">// 创建哈希函数 sha256</span></span><br><span class="line"></span><br><span class="line">hash.update(<span class="string">'some data to hash'</span>, <span class="string">'utf8'</span>);</span><br><span class="line"><span class="built_in">console</span>.log(hash.digest(<span class="string">'hex'</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">// 输出</span></span><br><span class="line"><span class="comment">// 6a2da20943931e9834fc12cfe5bb47bbd9ae43489a30726962b576f4e3993e50</span></span><br></pre></td></tr></table></figure>
<h3 id="PBKDF2"><a href="#PBKDF2" class="headerlink" title="PBKDF2"></a>PBKDF2</h3><p>PBKDF2 是 Node.js 的 <strong>crypto</strong> 模块原生支持的标准方法。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> crypto = <span class="built_in">require</span>(<span class="string">'crypto'</span>);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">pbkdf2_encrypt</span>(<span class="params">username, password</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// crypto.randomBytes(）方法生成 32 字节的随机数 - 这里作为盐值</span></span><br><span class="line">  crypto.randomBytes(<span class="number">32</span>, (err, salt) =&gt; &#123;</span><br><span class="line">    <span class="keyword">if</span> (err) <span class="keyword">throw</span> err;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 参数列表：（密码，盐值，迭代次数，密钥长度，摘要函数）</span></span><br><span class="line">    crypto.pbkdf2(password, salt, <span class="number">4096</span>, <span class="number">512</span>, <span class="string">'sha256'</span>, (err, key) =&gt; &#123;</span><br><span class="line">      <span class="keyword">if</span> (err) <span class="keyword">throw</span> err;</span><br><span class="line">      <span class="comment">// 将用户名、密码哈希值和盐值存入数据库</span></span><br><span class="line">      <span class="built_in">console</span>.log(username, key.toString(<span class="string">'hex'</span>), salt.toString(<span class="string">'hex'</span>));</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">pbkdf2_encrypt(<span class="string">'zhangSan'</span>, <span class="string">'123456'</span>);</span><br></pre></td></tr></table></figure>
<p>同步函数示例：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> salt = crypto.randomBytes(<span class="number">32</span>);</span><br><span class="line"><span class="keyword">const</span> result = crypto.pbkdf2Sync(password, salt, <span class="number">4096</span>, <span class="number">512</span>, <span class="string">'sha256'</span>);</span><br></pre></td></tr></table></figure>
<h2 id="Hmac-算法"><a href="#Hmac-算法" class="headerlink" title="Hmac 算法"></a>Hmac 算法</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> crypto = <span class="built_in">require</span>(<span class="string">'crypto'</span>);</span><br><span class="line"><span class="keyword">const</span> key = <span class="string">'BDvDYUmfdykkBLgX'</span>;</span><br><span class="line"><span class="keyword">const</span> hmac = crypto.createHmac(<span class="string">'sha1'</span>, key.toString(<span class="string">'ascii'</span>));</span><br><span class="line"></span><br><span class="line">hmac.update(<span class="string">'data to crypt'</span>);</span><br><span class="line"><span class="built_in">console</span>.log(hmac.digest(<span class="string">'hex'</span>)); </span><br><span class="line"></span><br><span class="line"><span class="comment">// 输出</span></span><br><span class="line"><span class="comment">// a43bfb9f12b6f69ad9fcd4338a981efbed2569ae</span></span><br></pre></td></tr></table></figure>
<h2 id="加盐（salt）"><a href="#加盐（salt）" class="headerlink" title="加盐（salt）"></a>加盐（salt）</h2><blockquote>
<p>盐值就是随机数值，用于在计算密码的哈希值时加强数据的安全性，可以有效抵御诸如字典攻击、彩虹表攻击等密码攻击媒介。</p>
</blockquote>
<p>常见的 Hash 算法使用示例：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> crypto = <span class="built_in">require</span>(<span class="string">'crypto'</span>);</span><br><span class="line"><span class="keyword">const</span> md5 = crypto.createHash(<span class="string">'md5'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> password = <span class="string">'123456'</span>;</span><br><span class="line"><span class="comment">// 直接对密码原文进行 Hash</span></span><br><span class="line">md5.update(password);</span><br><span class="line"><span class="built_in">console</span>.log(md5.digest(<span class="string">'hex'</span>)); </span><br><span class="line"></span><br><span class="line"><span class="comment">// 输出</span></span><br><span class="line"><span class="comment">// e10adc3949ba59abbe56e057f20f883e</span></span><br><span class="line"><span class="comment">// 可以通过 &lt;https://www.cmd5.com/&gt; 反向查询得到密码，不够安全。</span></span><br></pre></td></tr></table></figure>
<p>加“盐”的 Hash 算法：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> crypto = <span class="built_in">require</span>(<span class="string">'crypto'</span>);</span><br><span class="line"><span class="keyword">const</span> md5 = crypto.createHash(<span class="string">'md5'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> password = <span class="string">'123456'</span>;</span><br><span class="line"><span class="keyword">let</span> salt = <span class="string">'hhug6dcKyCNBQ5sUC0i6hja5dCTqdSzV'</span>; <span class="comment">// 盐值</span></span><br><span class="line"><span class="comment">// 将密码拼接上任意长度的随机字符串后，再进行 Hash</span></span><br><span class="line">md5.update(password+salt);</span><br><span class="line"><span class="built_in">console</span>.log(md5.digest(<span class="string">'hex'</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">// 输出</span></span><br><span class="line"><span class="comment">// b2d23b0443c319e574f1ea3f8bddc6e0</span></span><br></pre></td></tr></table></figure>
<p><code>crypto.randomBytes()</code> 方法可以生成随机数，用于作为密钥或者盐值：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> crypto = <span class="built_in">require</span>(<span class="string">'crypto'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// crypto.randomBytes() 生成强加密的伪随机数</span></span><br><span class="line">crypto.randomBytes(<span class="number">16</span>, (err, buf) =&gt; &#123;</span><br><span class="line">  <span class="keyword">if</span> (err) <span class="keyword">throw</span> err;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">`<span class="subst">$&#123;buf.length&#125;</span> bytes of random data: <span class="subst">$&#123;buf.toString(<span class="string">'hex'</span>)&#125;</span>`</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 打印</span></span><br><span class="line"><span class="comment">// 16 bytes of random data: 411fd0a79188f2fde58a91ea0302f148</span></span><br></pre></td></tr></table></figure></p>
<p>使用 Node <strong>crypto</strong> 模块为哈希函数生成随机的盐值：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> crypto = <span class="built_in">require</span>(<span class="string">'crypto'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 1. 异步方法</span></span><br><span class="line">crypto.randomBytes(<span class="number">32</span>, (err, salt) =&gt; &#123;</span><br><span class="line">  <span class="keyword">if</span> (err) <span class="keyword">throw</span> err;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 记录盐值可读的字符串版本</span></span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'salt: '</span> + salt.toString(<span class="string">'hex'</span>));</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 后续步骤：使用盐值</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. 同步方法</span></span><br><span class="line"><span class="keyword">const</span> buf = crypto.randomBytes(<span class="number">256</span>);</span><br></pre></td></tr></table></figure></p>
<h2 id="加密（Cipher）和解密（Decipher）算法"><a href="#加密（Cipher）和解密（Decipher）算法" class="headerlink" title="加密（Cipher）和解密（Decipher）算法"></a>加密（Cipher）和解密（Decipher）算法</h2><h3 id="对称加密算法"><a href="#对称加密算法" class="headerlink" title="对称加密算法"></a>对称加密算法</h3><p>查看 Openssl 对称加密算法列表：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ openssl list -cipher-algorithms</span><br><span class="line">$ openssl list-cipher-algorithms <span class="comment"># 旧版本命令</span></span><br></pre></td></tr></table></figure>
<h4 id="AES-256-GCM-示例1"><a href="#AES-256-GCM-示例1" class="headerlink" title="AES-256-GCM 示例1:"></a>AES-256-GCM 示例1:</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">'use strict'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> crypto = <span class="built_in">require</span>(<span class="string">'crypto'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 初始化参数</span></span><br><span class="line"><span class="keyword">const</span> text = <span class="string">'Encryption Testing AES GCM mode'</span>; <span class="comment">// 要加密和解密的数据</span></span><br><span class="line"><span class="keyword">const</span> key = crypto.randomBytes(<span class="number">32</span>); <span class="comment">// 256 位的共享密钥</span></span><br><span class="line"><span class="keyword">const</span> iv = crypto.randomBytes(<span class="number">16</span>); <span class="comment">// 初始向量，16 字节</span></span><br><span class="line"><span class="keyword">const</span> algorithm = <span class="string">'aes-256-gcm'</span>; <span class="comment">// 加密算法和操作模式</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 加密</span></span><br><span class="line"><span class="keyword">const</span> cipher = crypto.createCipheriv(algorithm, key, iv); <span class="comment">// 初始化加密算法</span></span><br><span class="line"><span class="keyword">let</span> encrypted = cipher.update(text, <span class="string">'utf8'</span>, <span class="string">'hex'</span>);</span><br><span class="line">encrypted += cipher.final(<span class="string">'hex'</span>);</span><br><span class="line"><span class="keyword">const</span> tag = cipher.getAuthTag(); <span class="comment">// 生成标签，用于验证密文的来源</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 解密</span></span><br><span class="line"><span class="keyword">const</span> decipher = crypto.createDecipheriv(algorithm, key, iv); <span class="comment">// 初始化解密算法</span></span><br><span class="line">decipher.setAuthTag(tag); <span class="comment">// 传入验证标签，验证密文的来源</span></span><br><span class="line"><span class="keyword">let</span> decrypted = decipher.update(encrypted, <span class="string">'hex'</span>, <span class="string">'utf8'</span>);</span><br><span class="line">decrypted += decipher.final(<span class="string">'utf8'</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(decrypted); <span class="comment">// Encryption Testing AES GCM mode</span></span><br></pre></td></tr></table></figure>
<h4 id="AES-256-GCM-示例2"><a href="#AES-256-GCM-示例2" class="headerlink" title="AES-256-GCM 示例2:"></a>AES-256-GCM 示例2:</h4><ul>
<li><a href="https://gist.github.com/rjz/15baffeab434b8125ca4d783f4116d81" target="_blank" rel="noopener">Github - crypto-aes-256-gem-demo.js</a></li>
<li><a href="https://github.com/matt-wu/AES" target="_blank" rel="noopener">GitHub: AES 简介</a></li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">'use strict'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> crypto = <span class="built_in">require</span>(<span class="string">'crypto'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> aes256gcm = <span class="function"><span class="params">key</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> ALGO = <span class="string">'aes-256-gcm'</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// encrypt returns base64-encoded ciphertext</span></span><br><span class="line">  <span class="keyword">const</span> encrypt = <span class="function"><span class="params">str</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// Hint: the 'iv' should be unique (but not necessarily random).</span></span><br><span class="line">    <span class="comment">// 'randomBytes' here are (relatively) slow but convenient for demonstration</span></span><br><span class="line">    <span class="keyword">const</span> iv = <span class="keyword">new</span> Buffer.from(crypto.randomBytes(<span class="number">16</span>), <span class="string">'utf8'</span>);</span><br><span class="line">    <span class="keyword">const</span> cipher = crypto.createCipheriv(ALGO, key, iv);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Hint: Larger inputs (it's GCM, after all!) should use the stream API</span></span><br><span class="line">    <span class="keyword">let</span> enc = cipher.update(str, <span class="string">'utf8'</span>, <span class="string">'base64'</span>);</span><br><span class="line">    enc += cipher.final(<span class="string">'base64'</span>);</span><br><span class="line">    <span class="keyword">return</span> [ enc, iv, cipher.getAuthTag() ];</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// decrypt decodes base64-encoded ciphertext into a utf8-encoded string</span></span><br><span class="line">  <span class="keyword">const</span> decrpt = <span class="function">(<span class="params">enc, iv, authTag</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> decipher = crypto.createDecipheriv(ALGO, key, iv);</span><br><span class="line">    decipher.setAuthTag(authTag);</span><br><span class="line">    <span class="keyword">let</span> str = decipher.update(enc, <span class="string">'base64'</span>, <span class="string">'utf8'</span>);</span><br><span class="line">    str += decipher.final(<span class="string">'utf8'</span>);</span><br><span class="line">    <span class="keyword">return</span> str;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> &#123; encrypt, decrpt &#125;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 加密密钥</span></span><br><span class="line"><span class="comment">// Note: a key size of 16 bytes will use AES-128, 24 =&gt; AES-192, 32 =&gt; AES-256</span></span><br><span class="line"><span class="keyword">const</span> KEY = <span class="keyword">new</span> Buffer.from(crypto.randomBytes(<span class="number">32</span>), <span class="string">'utf8'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> aesCipher = aes256gcm(KEY);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 加密</span></span><br><span class="line"><span class="keyword">const</span> [ encrypted, iv, authTag ] = aesCipher.encrypt(<span class="string">'hello world'</span>);</span><br><span class="line"><span class="comment">// 解密</span></span><br><span class="line"><span class="keyword">const</span> decrypted = aesCipher.decrpt(encrypted, iv, authTag);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(decrypted); <span class="comment">// hello world</span></span><br></pre></td></tr></table></figure>
<h3 id="非对称加密算法的使用，1-公钥加密-私钥解密；2-私钥加密-公钥解密。"><a href="#非对称加密算法的使用，1-公钥加密-私钥解密；2-私钥加密-公钥解密。" class="headerlink" title="非对称加密算法的使用，1. 公钥加密-私钥解密；2. 私钥加密-公钥解密。"></a>非对称加密算法的使用，1. 公钥加密-私钥解密；2. 私钥加密-公钥解密。</h3><ul>
<li><code>crypto.publicEncrypt(key, buffer)</code></li>
<li><code>crypto.publicDecrypt(key, buffer)</code></li>
<li><code>crypto.privateEncrypt(privateKey, buffer)</code></li>
<li><code>crypto.privateDecrypt(privateKey, buffer)</code></li>
</ul>
<h4 id="使用-RSA-2048-进行公钥加密，私钥解密"><a href="#使用-RSA-2048-进行公钥加密，私钥解密" class="headerlink" title="使用 RSA 2048 进行公钥加密，私钥解密"></a>使用 RSA 2048 进行公钥加密，私钥解密</h4><p>使用 OpenSSL 生成 2048位 RSA 密钥：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 1.生成 2048位 RSA 私钥</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> openssl genrsa -out rsa_private_key.pem 2048</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 2. 通过私钥生成公钥</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> openssl rsa -<span class="keyword">in</span> rsa_private_key.pem -pubout -out rsa_public_key.pem</span></span><br></pre></td></tr></table></figure>
<p>使用公钥加密数据，再使用私钥解密数据：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> crypto = <span class="built_in">require</span>(<span class="string">'crypto'</span>);</span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>);</span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>);</span><br><span class="line"><span class="keyword">const</span> root = __dirname;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> publicKey = fs.readFileSync(path.join(root, <span class="string">'./rsa_public_key.pem'</span>)).toString(<span class="string">'ascii'</span>);</span><br><span class="line"><span class="keyword">const</span> privateKey = fs.readFileSync(path.join(root, <span class="string">'./rsa_private_key.pem'</span>)).toString(<span class="string">'ascii'</span>);</span><br><span class="line"><span class="keyword">const</span> data = <span class="string">'data to crypt'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 公钥加密</span></span><br><span class="line"><span class="keyword">const</span> encryptData = crypto.publicEncrypt(publicKey, Buffer.from(data)).toString(<span class="string">'base64'</span>);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'encode'</span>, encryptData);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 私钥解密</span></span><br><span class="line"><span class="keyword">const</span> decryptData = crypto.privateDecrypt(privateKey, Buffer.from(encryptData.toString(<span class="string">'base64'</span>), <span class="string">'base64'</span>));</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'decode'</span>, decryptData.toString());</span><br></pre></td></tr></table></figure>
<h2 id="签名（Sign）和验证（Verify）算法"><a href="#签名（Sign）和验证（Verify）算法" class="headerlink" title="签名（Sign）和验证（Verify）算法"></a>签名（Sign）和验证（Verify）算法</h2><p>签名算法示例：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> crypto = <span class="built_in">require</span>(<span class="string">'crypto'</span>);</span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>);</span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>);</span><br><span class="line"><span class="keyword">const</span> root = __dirname;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 加载私钥文件</span></span><br><span class="line"><span class="keyword">const</span> pem = fs.readFileSync(path.join(root, <span class="string">'./rsa_private_key.pem'</span>));</span><br><span class="line"><span class="keyword">const</span> key = pem.toString(<span class="string">'ascii'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> sign = crypto.createSign(<span class="string">'RSA-SHA256'</span>); <span class="comment">// 创建签名算法</span></span><br><span class="line">sign.update(<span class="string">'data to sign'</span>); <span class="comment">// 更新待签名内容</span></span><br><span class="line"><span class="keyword">const</span> result = sign.sign(key, <span class="string">'hex'</span>); <span class="comment">// 生成并返回签名</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'result:'</span>, result);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 打印</span></span><br><span class="line"><span class="comment">// 3a26e0c3ec5ad1f517aad27f0f3a48cc0db156c2221800e4c2f995220f62a9077b4507a72ac6b0f1f50ee72386191d5ada4013945ff2afdb1ea6aa4e8d51a94f186089a67c2d6f4236150d59a1db134286fd7ba8deab0fc28f97eba7ad35820113f24dc6e30c6d11f0773527c4d81582c2b42016c9f972b5f4809e6d1f9115c2fb6db3168c68af3cfca986a458e3ea1c15606e7d33ee0bf5400ca460cf5371a51e800abe7ac943f16d9546239949bf7eec77488212d815b6a013e68fc2f456c4f2eb9d38c551e3f94168b076c3f761341afa3b724d8e73f486aacbace5a09412ef16c9b88182fcaeaaf97d96fdb402832530708a915d34c42131d7a26e4f04d4</span></span><br></pre></td></tr></table></figure>
<p>验证算法示例：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> crypto = <span class="built_in">require</span>(<span class="string">'crypto'</span>);</span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>);</span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>);</span><br><span class="line"><span class="keyword">const</span> root = __dirname;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 加载公钥文件</span></span><br><span class="line"><span class="keyword">const</span> publicKey = fs.readFileSync(path.join(root, <span class="string">'./rsa_public_key.pem'</span>)).toString(<span class="string">'ascii'</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> verify = crypto.createVerify(<span class="string">'RSA-SHA256'</span>); <span class="comment">// 创建验证算法</span></span><br><span class="line">verify.update(<span class="string">'data to sign'</span>);</span><br><span class="line"><span class="built_in">console</span>.log(verify.verify(publicKey, result, <span class="string">'hex'</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">// 打印</span></span><br><span class="line"><span class="comment">// true</span></span><br></pre></td></tr></table></figure>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><ul>
<li><a href="https://itbilu.com/nodejs/core/4koGTGNY.html" target="_blank" rel="noopener">Node.js 的加密模块 crypto 之使用 Hash 类计算数据的哈希值</a></li>
<li><a href="https://itbilu.com/nodejs/core/VJKNIOVF.html" target="_blank" rel="noopener">Node.js 的加密模块 crypto 之使用 Hmac 类计算哈希密钥</a></li>
<li><a href="https://itbilu.com/nodejs/core/EJOj6hBY.html" target="_blank" rel="noopener">Node.js 的加密模块 crypto 之使用 Cipher 类加密数据</a></li>
<li><a href="https://itbilu.com/nodejs/core/4ySMqlUF.html" target="_blank" rel="noopener">Node.js 的加密模块 crypto 之使用 Decipher 类解密数据</a></li>
<li><a href="https://itbilu.com/nodejs/core/NkQOETLK.html" target="_blank" rel="noopener">Node.js 的加密模块 crypto 之使用 Sign 类生成数字签名并使用 Verify 类验证数字签名</a></li>
<li><a href="https://itbilu.com/nodejs/core/EknZWVKt.html" target="_blank" rel="noopener">Node.js 的加密模块 crypto 之使用 DiffieHellman 类生成交换密钥</a></li>
<li><a href="https://itbilu.com/nodejs/core/41iXzVot.html" target="_blank" rel="noopener">Node.js 的加密模块 crypto 之使用 ECDH 类生成 EC Diffie-Hellman 交换密钥</a></li>
<li><p><a href="https://github.com/iddatasecuritybook" target="_blank" rel="noopener">Identity and Data Security for Web DevelopmentReport abuse</a></p>
</li>
<li><p><a href="https://blog.csdn.net/qq_39791705/article/details/79567410" target="_blank" rel="noopener">Node.js 使用 RSA 加密 / 解密</a></p>
</li>
</ul>
<h3 id="相关第三方库"><a href="#相关第三方库" class="headerlink" title="相关第三方库"></a>相关第三方库</h3><ul>
<li><a href="https://www.npmjs.com/package/bcrypt" target="_blank" rel="noopener">bcrypt</a>——密码哈希函数</li>
<li><a href="https://www.npmjs.com/package/bcryptjs" target="_blank" rel="noopener">bcrypt.js</a></li>
<li><a href="https://www.npmjs.com/package/node-rsa" target="_blank" rel="noopener">node-rsa</a></li>
<li><a href="https://www.npmjs.com/package/node-forge" target="_blank" rel="noopener">node-forge</a></li>
</ul>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://andy0570.com/2018/12/05/全球网络身份管理的现状与发展/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="独木舟的木">
      <meta itemprop="description" content="有时候阳光很好 有时候阳光很暗">
      <meta itemprop="image" content="https://blog-andy0570-1256077835.cos.ap-shanghai.myqcloud.com/site_Images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="独木舟的木">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2018/12/05/全球网络身份管理的现状与发展/" class="post-title-link" itemprop="url">全球网络身份管理的现状与发展</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2018-12-05 10:52:00" itemprop="dateCreated datePublished" datetime="2018-12-05T10:52:00+08:00">2018-12-05</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2019-04-28 15:59:34" itemprop="dateModified" datetime="2019-04-28T15:59:34+08:00">2019-04-28</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/PKI-密码学/" itemprop="url" rel="index"><span itemprop="name">PKI&密码学</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          
            <span id="/2018/12/05/全球网络身份管理的现状与发展/" class="leancloud_visitors" data-flag-title="全球网络身份管理的现状与发展">
              <span class="post-meta-divider">|</span>
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              
                <span class="post-meta-item-text">阅读次数：</span>
              
                <span class="leancloud-visitors-count"></span>
            </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body han-init-context" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>书名：《全球网络身份管理的现状与发展》</p>
</blockquote>
<blockquote>
<p>提及网络身份管理，我们很容易将之等效于“网络实名制”。</p>
<p><strong>网络实名制</strong>是一种政策，是政府部门对网络管理所采取的一种模式，是将网络虚拟身份与社会物理身份相对应的一种要求；</p>
<p><strong>网络身份管理</strong>则是对网络身份唯一性判定、真实性鉴别的一种能力要求。</p>
<p>网络身份管理在对网络用户管理时，可以采用基于公民网络电子身份标识（eID）的管理模式来支持网络实名制的管理要求。同时，网络身份管理所面对的还可以是网络设备、企事业法人、官方代表等具有特定网络身份的角色。</p>
<p>因此，网络身份管理与网络实名制之间虽有些相通之处，但更多的是区别。</p>
</blockquote>
<h1 id="一、网络身份管理综述"><a href="#一、网络身份管理综述" class="headerlink" title="一、网络身份管理综述"></a>一、网络身份管理综述</h1><h3 id="网络身份管理的范围"><a href="#网络身份管理的范围" class="headerlink" title="网络身份管理的范围"></a>网络身份管理的范围</h3><ol>
<li>网络身份的<strong>产生</strong>——用户如何获取自己的网络身份？</li>
<li>网络身份的<strong>保护</strong>——如何防止网络身份被盗用或冒用？密码口令、生物识别技术、数字证书、安全的网络协议。</li>
<li>网络身份的<strong>使用</strong>——网络身份验证。</li>
<li>网络身份的<strong>维护</strong>——网络身份生命周期的管理。</li>
</ol>
<h3 id="网络身份管理的参与方"><a href="#网络身份管理的参与方" class="headerlink" title="网络身份管理的参与方"></a>网络身份管理的参与方</h3><ul>
<li>个体；</li>
<li>身份服务提供方/身份提供商；</li>
<li>身份标识及载体；</li>
<li>依赖方；</li>
<li>属性服务提供方；</li>
</ul>
<h3 id="网络身份管理需求"><a href="#网络身份管理需求" class="headerlink" title="网络身份管理需求"></a>网络身份管理需求</h3><h4 id="一、个人-企业"><a href="#一、个人-企业" class="headerlink" title="一、个人/企业"></a>一、个人/企业</h4><ol>
<li>便利；</li>
<li>安全；</li>
<li>隐私；</li>
</ol>
<h4 id="二、互联网服务提供方"><a href="#二、互联网服务提供方" class="headerlink" title="二、互联网服务提供方"></a>二、互联网服务提供方</h4><ol>
<li>确认用户身份的真实性和有效性。</li>
<li>身份管理方案的经济性。</li>
</ol>
<h4 id="三、政府"><a href="#三、政府" class="headerlink" title="三、政府"></a>三、政府</h4><ol>
<li>维护国家安全和社会安全，有效遏制网络欺诈、身份盗窃和在线信息滥用的增长，防止由此造成的个人或组织的财产、名誉等各类损失。</li>
<li>推动个人和组织使用权威、高效、易用和互操作性的身份管理解决方案安全访问在线服务。</li>
<li>保护公民隐私，防止公民身份信息被非法获取，防范大规模网络身份信息的泄漏。</li>
</ol>
<h3 id="网络身份管理与网络实名制的区别"><a href="#网络身份管理与网络实名制的区别" class="headerlink" title="网络身份管理与网络实名制的区别"></a>网络身份管理与网络实名制的区别</h3><ol>
<li>身份信息的采集、传输、存储和使用必须严格受控。</li>
<li>并不是所有的网络活动都需要实名。</li>
<li>网络身份管理的关键作用是<strong>建立网络上各参与方之间的信任关系</strong>。</li>
</ol>
<p>网络实名制的初衷：防止匿名情况下的网络犯罪。</p>
<p>网络实名制存在的问题：压缩公民诉求表达的渠道、个人隐私泄露。</p>
<h3 id="网络身份管理的关键作用"><a href="#网络身份管理的关键作用" class="headerlink" title="网络身份管理的关键作用"></a>网络身份管理的关键作用</h3><ol>
<li>保障网络空间安全。</li>
<li>保护个人财产安全与隐私。</li>
<li>提高社会管理和服务效率。</li>
</ol>
<h3 id="身份认证的概念的方式"><a href="#身份认证的概念的方式" class="headerlink" title="身份认证的概念的方式"></a>身份认证的概念的方式</h3><p>网络身份认证的主要方式：</p>
<ol>
<li>用户名/密码组合认证；</li>
<li>动态口令认证；</li>
<li>智能卡认证；</li>
<li>短信密码认证；</li>
<li>智能密码钥匙（USBKey）认证；</li>
<li>基于生物特性认证；</li>
</ol>
<blockquote>
<p>未完待续…</p>
</blockquote>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://andy0570.com/2018/12/04/密码学—密码算法与协议/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="独木舟的木">
      <meta itemprop="description" content="有时候阳光很好 有时候阳光很暗">
      <meta itemprop="image" content="https://blog-andy0570-1256077835.cos.ap-shanghai.myqcloud.com/site_Images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="独木舟的木">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2018/12/04/密码学—密码算法与协议/" class="post-title-link" itemprop="url">密码学—密码算法与协议</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2018-12-04 15:42:00" itemprop="dateCreated datePublished" datetime="2018-12-04T15:42:00+08:00">2018-12-04</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2019-04-28 15:59:34" itemprop="dateModified" datetime="2019-04-28T15:59:34+08:00">2019-04-28</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/PKI-密码学/" itemprop="url" rel="index"><span itemprop="name">PKI&密码学</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          
            <span id="/2018/12/04/密码学—密码算法与协议/" class="leancloud_visitors" data-flag-title="密码学—密码算法与协议">
              <span class="post-meta-divider">|</span>
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              
                <span class="post-meta-item-text">阅读次数：</span>
              
                <span class="leancloud-visitors-count"></span>
            </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body han-init-context" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>书名：《密码学——密码算法与协议（第2版）》</p>
</blockquote>
<h3 id="思维导图"><a href="#思维导图" class="headerlink" title="思维导图"></a>思维导图</h3><p><img src="https://blog-andy0570-1256077835.cos.ap-shanghai.myqcloud.com/site_Images/075910.png" alt="密码学"></p>
<h3 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h3><ul>
<li><a href="https://github.com/matt-wu/AES" target="_blank" rel="noopener">AES 简介</a></li>
</ul>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://andy0570.com/2018/11/29/PerfOps-CLI-多地点网络测试工具/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="独木舟的木">
      <meta itemprop="description" content="有时候阳光很好 有时候阳光很暗">
      <meta itemprop="image" content="https://blog-andy0570-1256077835.cos.ap-shanghai.myqcloud.com/site_Images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="独木舟的木">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2018/11/29/PerfOps-CLI-多地点网络测试工具/" class="post-title-link" itemprop="url">PerfOps CLI 多地点网络测试工具</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2018-11-29 13:51:00" itemprop="dateCreated datePublished" datetime="2018-11-29T13:51:00+08:00">2018-11-29</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2019-04-28 15:59:34" itemprop="dateModified" datetime="2019-04-28T15:59:34+08:00">2019-04-28</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/开发工具-Mac应用/" itemprop="url" rel="index"><span itemprop="name">开发工具&Mac应用</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          
            <span id="/2018/11/29/PerfOps-CLI-多地点网络测试工具/" class="leancloud_visitors" data-flag-title="PerfOps CLI 多地点网络测试工具">
              <span class="post-meta-divider">|</span>
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              
                <span class="post-meta-item-text">阅读次数：</span>
              
                <span class="leancloud-visitors-count"></span>
            </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body han-init-context" itemprop="articleBody">

      
      

      
        
          
            <h1 id="perfops-cli-一款IT运维工具"><a href="#perfops-cli-一款IT运维工具" class="headerlink" title="perfops-cli - 一款IT运维工具"></a><a href="https://perfops.net/cli" target="_blank" rel="noopener">perfops-cli</a> - 一款IT运维工具</h1><p><a href="https://github.com/ProspectOne/perfops-cli" target="_blank" rel="noopener">GitHub：perfops-cli</a></p>
<p>PerfOps CLI 是一款适合于运维人员使用的命令行工具，方便从多地点执行 ping、traceroute、mtr 等网络基准测试。<br>PerfOps 使用简单，你可以从位于全世界的数百个节点向目标地址发起网络测试。在不设置 API 密钥的条件下，它允许每小时进行 10 次测试，免费注册用户则可以在每小时内发起最多 200 次测试。</p>
<h2 id="Homebrew-MacOS-安装方法"><a href="#Homebrew-MacOS-安装方法" class="headerlink" title="Homebrew - MacOS 安装方法"></a>Homebrew - MacOS 安装方法</h2><p>使用 Homebrew 安装：<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">brew tap ProspectOne/perfops</span><br><span class="line">brew install perfops</span><br><span class="line">perfops --help</span><br></pre></td></tr></table></figure></p>
<h2 id="使用方法"><a href="#使用方法" class="headerlink" title="使用方法"></a>使用方法</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> perfops --<span class="built_in">help</span></span></span><br><span class="line">perfops is a simple command line tool to interact with hunderds of servers around the world. Run benchmarks and debug your infrastructure without leaving your console.</span><br><span class="line">perfops 是一个简单的命令行工具，可与世界各地的数百台服务器进行交互。 无需离开控制台即可运行基准测试并调试基础架构。</span><br><span class="line"></span><br><span class="line">Usage:</span><br><span class="line">  perfops [flags]</span><br><span class="line">  perfops [command]</span><br><span class="line"></span><br><span class="line">Examples:</span><br><span class="line">perfops traceroute --from "New York" google.com</span><br><span class="line"></span><br><span class="line">Available Commands:</span><br><span class="line">  credits     Displays the remaing credits</span><br><span class="line">  curl        Run a curl test on a domain name or IP address</span><br><span class="line">  dnsperf     Find the time it takes to resolve a DNS record on a target</span><br><span class="line">  help        Help about any command</span><br><span class="line">  latency     Run a ICMP latency test on a domain name or IP address</span><br><span class="line">  mtr         Run a MTR test on a domain name or IP address</span><br><span class="line">  ping        Run a ping test on a domain name or IP address</span><br><span class="line">  resolve     Resolve a DNS record on a domain name</span><br><span class="line">  traceroute  Run a traceroute test on a domain name or IP address</span><br><span class="line"></span><br><span class="line">Flags:</span><br><span class="line">      --debug             Enables debug output</span><br><span class="line">  -F, --from string       A continent, region (e.g eastern europe), country, US state or city</span><br><span class="line">  -h, --help              help for perfops</span><br><span class="line">  -J, --json              Print the result of a command in JSON format</span><br><span class="line">  -K, --key string        The PerfOps API key (default is $PERFOPS_API_KEY)</span><br><span class="line">  -N, --nodeid intSlice   A comma separated list of node IDs to run a test from</span><br><span class="line">  -v, --version           Prints the version information of perfops</span><br><span class="line"></span><br><span class="line">Use "perfops [command] --help" for more information about a command.</span><br></pre></td></tr></table></figure>
<h3 id="ping-测试网络连通性"><a href="#ping-测试网络连通性" class="headerlink" title="ping - 测试网络连通性"></a>ping - 测试网络连通性</h3><ol>
<li><p>从亚洲（Asia）的随机一台服务器上 Ping baidu.com：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> perfops ping --from Asia baidu.com</span></span><br><span class="line">Node203, AS45102, Dubai, United Arab Emirates # Node203，AS45102，迪拜，阿拉伯联合酋长国</span><br><span class="line">PING baidu.com (220.181.57.216) 56(84) bytes of data.</span><br><span class="line">64 bytes from 220.181.57.216: icmp_seq=1 ttl=47 time=341 ms</span><br><span class="line">64 bytes from 220.181.57.216: icmp_seq=2 ttl=47 time=342 ms</span><br><span class="line">64 bytes from 220.181.57.216: icmp_seq=3 ttl=47 time=342 ms</span><br><span class="line"></span><br><span class="line">--- baidu.com ping statistics ---</span><br><span class="line">3 packets transmitted, 3 received, 0% packet loss, time 800ms</span><br><span class="line">rtt min/avg/max/mdev = 341.865/342.230/342.800/0.789 ms</span><br></pre></td></tr></table></figure>
</li>
<li><p>从亚洲（Asia）的随机两台服务器上 Ping 某一个IP地址：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> perfops ping --from Asia 52.14.183.223 --<span class="built_in">limit</span> 2</span></span><br><span class="line">Node297, AS199524, Seoul, South Korea # 韩国首尔的节点</span><br><span class="line">PING 52.14.183.223 (52.14.183.223) 56(84) bytes of data.</span><br><span class="line">64 bytes from 52.14.183.223: icmp_seq=1 ttl=39 time=193 ms</span><br><span class="line">64 bytes from 52.14.183.223: icmp_seq=2 ttl=39 time=193 ms</span><br><span class="line">64 bytes from 52.14.183.223: icmp_seq=3 ttl=39 time=193 ms</span><br><span class="line"></span><br><span class="line">--- 52.14.183.223 ping statistics ---</span><br><span class="line">3 packets transmitted, 3 received, 0% packet loss, time 802ms</span><br><span class="line">rtt min/avg/max/mdev = 193.768/193.786/193.814/0.020 ms</span><br><span class="line"></span><br><span class="line">Node112, AS14061, Bangalore, India # Node112，AS14061，班加罗尔，印度</span><br><span class="line">PING 52.14.183.223 (52.14.183.223) 56(84) bytes of data.</span><br><span class="line">64 bytes from 52.14.183.223: icmp_seq=1 ttl=41 time=233 ms</span><br><span class="line">64 bytes from 52.14.183.223: icmp_seq=2 ttl=41 time=232 ms</span><br><span class="line">64 bytes from 52.14.183.223: icmp_seq=3 ttl=41 time=232 ms</span><br><span class="line"></span><br><span class="line">--- 52.14.183.223 ping statistics ---</span><br><span class="line">3 packets transmitted, 3 received, 0% packet loss, time 801ms</span><br><span class="line">rtt min/avg/max/mdev = 232.727/232.975/233.375/0.486 ms</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h3 id="traceroute-对域名或-IP-地址运行路由跟踪测试"><a href="#traceroute-对域名或-IP-地址运行路由跟踪测试" class="headerlink" title="traceroute - 对域名或 IP 地址运行路由跟踪测试"></a>traceroute - 对域名或 IP 地址运行路由跟踪测试</h3><p>从上海的某一台服务器测试 baidu.com 的路由跟踪：<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> perfops traceroute --from <span class="string">"Shanghai"</span> baidu.com</span></span><br><span class="line">Node276, AS37963, Shanghai, China</span><br><span class="line">traceroute to baidu.com (123.125.115.110), 20 hops max, 60 byte packets</span><br><span class="line"> 2  11.222.252.181 (11.222.252.181)  5.770 ms  5.911 ms</span><br><span class="line"> 3  11.222.252.10 (11.222.252.10)  5.519 ms  52.961 ms</span><br><span class="line"> 4  11.220.159.58 (11.220.159.58)  1.760 ms  1.863 ms</span><br><span class="line"> 5  116.251.106.157 (116.251.106.157)  2.412 ms  2.402 ms</span><br><span class="line"> 6  140.205.50.225 (140.205.50.225)  2.185 ms  2.189 ms</span><br><span class="line"> 7  140.206.207.205 (140.206.207.205)  3.937 ms  4.036 ms</span><br><span class="line"> 8  140.206.207.29 (140.206.207.29)  4.209 ms  4.247 ms</span><br><span class="line"> 9  * *</span><br><span class="line">10  139.226.227.33 (139.226.227.33)  9.367 ms  9.365 ms</span><br><span class="line">11  219.158.6.165 (219.158.6.165)  30.609 ms  30.525 ms</span><br><span class="line">12  * *</span><br><span class="line">13  61.51.113.246 (61.51.113.246)  25.389 ms  25.578 ms</span><br><span class="line">14  202.106.43.38 (202.106.43.38)  25.545 ms  25.531 ms</span><br><span class="line">15  * *</span><br><span class="line">16  * *</span><br><span class="line">17  123.125.115.110 (123.125.115.110)  25.586 ms  25.594 ms</span><br></pre></td></tr></table></figure></p>
<h3 id="latency-对域名或-IP-地址运行-ICMP-延迟测试"><a href="#latency-对域名或-IP-地址运行-ICMP-延迟测试" class="headerlink" title="latency - 对域名或 IP 地址运行 ICMP 延迟测试"></a>latency - 对域名或 IP 地址运行 ICMP 延迟测试</h3><p>分别在位于中国的随机10台服务器上测试 google.com 的ICMP延迟：<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">perfops latency --from China google.com --limit 10</span><br><span class="line">Node208, AS37963, Hangzhou, China # 杭州，100%丢包😂</span><br><span class="line"><span class="meta">100%</span><span class="bash"> packet loss</span></span><br><span class="line">Node329, AS37963, Hohhot, China # 呼和浩特，100%丢包😂</span><br><span class="line"><span class="meta">100%</span><span class="bash"> packet loss</span></span><br><span class="line">Node207, AS37963, Beijing, China # 北京。。。😂</span><br><span class="line"><span class="meta">100%</span><span class="bash"> packet loss</span></span><br><span class="line">Node276, AS37963, Shanghai, China # 上海。。。😂</span><br><span class="line"><span class="meta">100%</span><span class="bash"> packet loss</span></span><br></pre></td></tr></table></figure></p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://andy0570.com/2018/11/15/Node.js 异步编程笔记/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="独木舟的木">
      <meta itemprop="description" content="有时候阳光很好 有时候阳光很暗">
      <meta itemprop="image" content="https://blog-andy0570-1256077835.cos.ap-shanghai.myqcloud.com/site_Images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="独木舟的木">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2018/11/15/Node.js 异步编程笔记/" class="post-title-link" itemprop="url">Node.js 异步编程笔记</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2018-11-15 18:00:00" itemprop="dateCreated datePublished" datetime="2018-11-15T18:00:00+08:00">2018-11-15</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2019-04-28 15:59:34" itemprop="dateModified" datetime="2019-04-28T15:59:34+08:00">2019-04-28</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Node-js/" itemprop="url" rel="index"><span itemprop="name">Node.js</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          
            <span id="/2018/11/15/Node.js 异步编程笔记/" class="leancloud_visitors" data-flag-title="Node.js 异步编程笔记">
              <span class="post-meta-divider">|</span>
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              
                <span class="post-meta-item-text">阅读次数：</span>
              
                <span class="leancloud-visitors-count"></span>
            </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body han-init-context" itemprop="articleBody">

      
      

      
        
          
            <a id="more"></a>
<h1 id="从-Callback-Hell-到-Promise-到-Async-Await"><a href="#从-Callback-Hell-到-Promise-到-Async-Await" class="headerlink" title="从 Callback Hell 到 Promise 到 Async/Await"></a>从 Callback Hell 到 Promise 到 Async/Await</h1><h3 id="【知乎-Live】狼叔：如何正确的学习-Node-js"><a href="#【知乎-Live】狼叔：如何正确的学习-Node-js" class="headerlink" title="【知乎 Live】狼叔：如何正确的学习 Node.js"></a><a href="https://i5ting.github.io/How-to-learn-node-correctly/" target="_blank" rel="noopener">【知乎 Live】狼叔：如何正确的学习 Node.js</a></h3><p>Node.js 异步流程控制的学习重点：</p>
<ol>
<li>API 写法：Error-first Callback 和 EventEmitter；</li>
<li>中流砥柱：<a href="https://github.com/then/promise#readme" target="_blank" rel="noopener">Promise</a>；</li>
<li>终极解决方案：Async/Await</li>
</ol>
<h4 id="回调地狱（Callback-Hell-）"><a href="#回调地狱（Callback-Hell-）" class="headerlink" title="回调地狱（Callback Hell ）"></a>回调地狱（Callback Hell ）</h4><p>Node.js 默认使用回调函数（callback）风格语法来实现异步编程：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Node.js 默认的回调函数风格写法，Callback Hell</span></span><br><span class="line">step1(<span class="function"><span class="keyword">function</span>(<span class="params">value1</span>) </span>&#123;</span><br><span class="line">  step2(value1, <span class="function"><span class="keyword">function</span>(<span class="params">value2</span>) </span>&#123;</span><br><span class="line">    step3(value2, <span class="function"><span class="keyword">function</span>(<span class="params">value3</span>) </span>&#123;</span><br><span class="line">      step4(value3, <span class="function"><span class="keyword">function</span>(<span class="params">value4</span>) </span>&#123;</span><br><span class="line">        <span class="comment">// Do something with value 4.</span></span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// ES6 箭头函数语法：</span></span><br><span class="line">step1(<span class="function"><span class="params">value1</span> =&gt;</span> &#123;</span><br><span class="line">  step2(value1, value2 =&gt; &#123;</span><br><span class="line">    step3(value2, value3 =&gt; &#123;</span><br><span class="line">      step4(value3, value4 =&gt; &#123;</span><br><span class="line">        <span class="comment">// Do something with value4.</span></span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h4 id="Promise-语法"><a href="#Promise-语法" class="headerlink" title="Promise 语法"></a>Promise 语法</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">return</span> step1().then(step2).then(step3).then(step4).catch(<span class="function"><span class="keyword">function</span>(<span class="params">err</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// do something with error.</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h3 id="InfoQ：异步-JavaScript-的演化史：从回调到-Promise-再到-Async-Await-⭐️⭐️⭐️⭐️"><a href="#InfoQ：异步-JavaScript-的演化史：从回调到-Promise-再到-Async-Await-⭐️⭐️⭐️⭐️" class="headerlink" title="InfoQ：异步 JavaScript 的演化史：从回调到 Promise 再到 Async/Await ⭐️⭐️⭐️⭐️"></a><a href="https://www.infoq.cn/article/JQxzWt7FqDc9p7jJ_1hs" target="_blank" rel="noopener">InfoQ：异步 JavaScript 的演化史：从回调到 Promise 再到 Async/Await</a> ⭐️⭐️⭐️⭐️</h3><h4 id="什么是回调函数（callback）？"><a href="#什么是回调函数（callback）？" class="headerlink" title="什么是回调函数（callback）？"></a>什么是回调函数（callback）？</h4><blockquote>
<p>首先，就像可以将字符串或数字以参数的形式传递给函数一样，我们也可以将函数的引用作为参数进行传递。但我们这样做的时候，作为参数传递的函数被称为回调函数（callback function），而接收回调函数传入的那个函数则被称为高阶函数（higher order function）。</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">add</span>(<span class="params">x, y</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> x + y;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">higherOrderFunction</span>(<span class="params">x, callback</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> callback(x, <span class="number">5</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">higherOrderFunction(<span class="number">10</span>, add);</span><br></pre></td></tr></table></figure>
<p>回调的使用场景：将函数的执行延迟至一个特定的时间。</p>
<h4 id="Promise"><a href="#Promise" class="headerlink" title="Promise"></a>Promise</h4><p><code>Promise</code>会处于如下三种状态中的某一种： <code>pending</code>、<code>fulfilled</code>或<code>rejected</code>。</p>
<p>如果异步请求依然还在进行，那么<code>Promise</code>的状态会是<code>pending</code>。如果异步请求成功完成的话，那么<code>Promise</code>会将状态转换为<code>fulfilled</code>。如果异步请求失败的话，<code>Promise</code>会将状态转换为<code>rejected</code>。</p>
<hr>
<p><code>Promise</code>的构造函数会接收一个参数，这个参数是一个（回调）函数。该函数会被传入两个参数<code>resolve</code>和<code>reject</code>。</p>
<p><code>resolve</code>：一个能将 Promise 状态变为<code>fulfilled</code>的函数；</p>
<p><code>reject</code>：一个能将 Promise 状态变为<code>rejected</code>的函数；</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> promise = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">  setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    resolve(); <span class="comment">// 将状态变为"fulfilled"</span></span><br><span class="line">  &#125;, <span class="number">2000</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>当 Promise 的状态变为<code>fulfilled</code>的时候，传递给<code>.then</code>的函数将会被调用。如果 Promise 的状态变为<code>rejected</code>，传递给<code>.catch</code>的函数将会被调用。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">onSuccess</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'Success'</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">onError</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'Error'</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> promise = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">  setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    resolve(); <span class="comment">// 将状态变为"fulfilled"</span></span><br><span class="line">  &#125;, <span class="number">2000</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">promise.then(onSuccess);</span><br><span class="line">promise.catch(onError);</span><br></pre></td></tr></table></figure>
<p>Promise 的链式语法。</p>
<h4 id="Async-Await"><a href="#Async-Await" class="headerlink" title="Async/Await"></a>Async/Await</h4><p>如何完全按照编写同步代码的方式来编写异步代码？</p>
<ol>
<li>首先，只要你为函数添加<code>async</code>，它就会隐式的返回一个 Promise 对象：</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">getPromise</span>(<span class="params"></span>) </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> promise = getPromise();</span><br></pre></td></tr></table></figure>
<ol start="2">
<li>其次，如果<code>async</code>函数有返回值的话，它也将会包装到一个 Promise 中。这意味着，你必须要使用<code>.then</code>来访问它。</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">add</span>(<span class="params">x, y</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> x + y;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">add(<span class="number">2</span>, <span class="number">3</span>).then(<span class="function"><span class="params">result</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(result); <span class="comment">// 5</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<ol start="3">
<li><p>不能将 <code>await</code> 用到非 <code>async</code> 的函数中。</p>
<p>当你将 <code>await</code> 添加到一个函数上的时候：首先，它会让这个函数本身返回一个 Promise（或者将返回的内容包装到 Promise 中）；其次，它会确保你能够在这个函数中使用<code>await</code>。</p>
</li>
</ol>
<h3 id="Node-js-异步最佳实践-amp-避免回调地狱-RisingStack"><a href="#Node-js-异步最佳实践-amp-避免回调地狱-RisingStack" class="headerlink" title="Node.js 异步最佳实践 &amp; 避免回调地狱 | @RisingStack"></a><a href="https://juejin.im/entry/589401b68fd9c57277376470" target="_blank" rel="noopener">Node.js 异步最佳实践 &amp; 避免回调地狱 | @RisingStack</a></h3><blockquote>
<p> 要成为一个高效的 Node.js 开发者，你必须避免不断增加的缩进级别，书写简洁且易读的代码，以及处理复杂的流程。</p>
<p>尽可能使用异步 API 而不是同步 API。因为非阻塞的方式比同步的方式性能更好。</p>
</blockquote>
<h3 id="InfoQ：JavaScript-异步编程的-Promise-模式"><a href="#InfoQ：JavaScript-异步编程的-Promise-模式" class="headerlink" title="InfoQ：JavaScript 异步编程的 Promise 模式"></a><a href="https://www.infoq.cn/article/2011%2F09%2Fjs-promise" target="_blank" rel="noopener">InfoQ：JavaScript 异步编程的 Promise 模式</a></h3><p>关键字：2011 年 9 月 15 日、JavaScript、Ajax 示例。</p>
<h2 id="Promise-1"><a href="#Promise-1" class="headerlink" title="Promise"></a>Promise</h2><ul>
<li><a href="https://cnodejs.org/topic/560dbc826a1ed28204a1e7de" target="_blank" rel="noopener">Node.js 最新技术栈之 Promise 篇</a> ⭐️⭐️⭐️</li>
<li><a href="https://cnodejs.org/topic/569c8226adf526da2aeb23fd" target="_blank" rel="noopener">理解 Promise 的工作原理</a> ⭐️</li>
<li><a href="http://liubin.github.io/promises-book/" target="_blank" rel="noopener">Promise 迷你书</a> ⭐️</li>
<li><a href="https://github.com/petkaantonov/bluebird" target="_blank" rel="noopener">promise模块：bluebird</a></li>
<li><a href="https://github.com/kriskowal/q" target="_blank" rel="noopener">promise模块: q</a></li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 回调地狱</span></span><br><span class="line">asyncOperation(<span class="function"><span class="keyword">function</span>(<span class="params">data1</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// 处理 data1</span></span><br><span class="line">  anotherAsync(<span class="function"><span class="keyword">function</span>(<span class="params">data2</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 处理 data2</span></span><br><span class="line">    yetAnotherAsync(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="comment">// 完成</span></span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Promise 语法</span></span><br><span class="line">promiseSomething()</span><br><span class="line">  .then(<span class="function"><span class="keyword">function</span>(<span class="params">data1</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 处理 data1</span></span><br><span class="line">    <span class="keyword">return</span> anotherAsync();</span><br><span class="line">  &#125;)</span><br><span class="line">  .then(<span class="function"><span class="keyword">function</span>(<span class="params">data2</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 处理 data2</span></span><br><span class="line">    <span class="keyword">return</span> yetAnotherAsync();</span><br><span class="line">  &#125;)</span><br><span class="line">  .then(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 完成</span></span><br><span class="line">  &#125;);</span><br></pre></td></tr></table></figure>
<h3 id="Promise-A-规范"><a href="#Promise-A-规范" class="headerlink" title="Promise/A 规范"></a>Promise/A 规范</h3><p>promise 表示一个最终值，该值由一个操作完成时返回。</p>
<ul>
<li>promise 有3种状态：<strong>未完成（Pending）</strong>、<strong>完成（Fulfilled）</strong>、<strong>失败（Rejected）</strong>。</li>
<li>promise 的状态转换：<ul>
<li>未完成 ➡️ 完成。</li>
<li>未完成 ➡️ 失败。</li>
</ul>
</li>
<li>promise 的状态转换只发生一次。</li>
</ul>
<p>promise 的 <code>then()</code> 方法可以接受3个函数作为参数：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">promiseSomething().then(<span class="function"><span class="keyword">function</span>(<span class="params">fulfilled</span>) </span>&#123;</span><br><span class="line"><span class="comment">// 当 promise 状态变成 fulfilled 时，调用此函数。</span></span><br><span class="line">&#125;, <span class="function"><span class="keyword">function</span>(<span class="params">rejected</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// 当 promise 状态变成 rejected 时，调用此函数</span></span><br><span class="line">&#125;, <span class="function"><span class="keyword">function</span>(<span class="params">progress</span>) </span>&#123;</span><br><span class="line">  <span class="comment">//当返回进度信息时，调用此函数（可选）</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h2 id="Async"><a href="#Async" class="headerlink" title="Async"></a>Async</h2><ul>
<li><a href="https://github.com/caolan/async" target="_blank" rel="noopener">async</a></li>
<li><a href="https://caolan.github.io/async/index.html" target="_blank" rel="noopener">Document: async</a></li>
</ul>
<h3 id="async-函数的含义和用法-阮一峰"><a href="#async-函数的含义和用法-阮一峰" class="headerlink" title="async 函数的含义和用法 @阮一峰"></a><a href="http://es6.ruanyifeng.com/#docs/async" target="_blank" rel="noopener">async 函数的含义和用法 @阮一峰</a></h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> asyncMethod = <span class="keyword">async</span> () =&gt; &#123;  <span class="comment">// async 用于声明一个函数是异步的。</span></span><br><span class="line">  <span class="keyword">const</span> f1 = <span class="keyword">await</span> firstMethod();  <span class="comment">// await 用于等待一个异步方法执行完成。</span></span><br><span class="line">  <span class="keyword">const</span> f2 = <span class="keyword">await</span> anotherMethod();</span><br><span class="line">  <span class="built_in">console</span>.log(f1, f2);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>async 函数就是 Generator 函数的语法糖。</p>
<p>async 函数就是将 Generator 函数的星号（<code>*</code>）替换成 async，将 yield 替换成 await，仅此而已。</p>
<p>await 命令后面的 Promise 对象，运行结果可能是 rejected，所以最好把 await 命令放在 try…catch 代码块中。</p>
<p>async 函数返回的是一个 Promise 对象。</p>
<p>await 命令只能用在 async 函数之中，如果用在普通函数，就会报错。</p>
</blockquote>
<h3 id="理解-JavaScript-的-async-await-⭐️⭐️⭐️"><a href="#理解-JavaScript-的-async-await-⭐️⭐️⭐️" class="headerlink" title="理解 JavaScript 的 async/await ⭐️⭐️⭐️"></a><a href="https://segmentfault.com/a/1190000007535316" target="_blank" rel="noopener">理解 JavaScript 的 async/await</a> ⭐️⭐️⭐️</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">testAsync</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="string">'Hello World'</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> result = testAsync();</span><br><span class="line"><span class="built_in">console</span>.log(result); <span class="comment">// Promise &#123; 'Hello World' &#125;</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>async 函数（包含函数语句、函数表达式、Lambda 表达式）会返回一个 Promise 对象，如果在函数中 <code>return</code> 一个直接量，async 会把这个直接量通过 <code>Promise.resolve()</code> 封装成 Promise 对象。</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">testAsync</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="string">'Hello World'</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">testAsync().then(<span class="function"><span class="params">result</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(result); <span class="comment">// Hello World</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h4 id="用-setTimeout-模拟耗时操作的示例"><a href="#用-setTimeout-模拟耗时操作的示例" class="headerlink" title="用 setTimeout 模拟耗时操作的示例"></a>用 <code>setTimeout</code> 模拟耗时操作的示例</h4><p>Promise 语法：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">takeLongTime</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="params">resolve</span> =&gt;</span> &#123;</span><br><span class="line">    setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      resolve(<span class="string">'long_time_value'</span>);</span><br><span class="line">    &#125;, <span class="number">1000</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">takeLongTime().then(<span class="function"><span class="params">result</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(result); <span class="comment">// long_time_value</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>async/await 语法：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">takeLongTime</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="params">resolve</span> =&gt;</span> &#123;</span><br><span class="line">    setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      resolve(<span class="string">'long_time_value'</span>);</span><br><span class="line">    &#125;, <span class="number">1000</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">test</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> result = <span class="keyword">await</span> takeLongTime();</span><br><span class="line">  <span class="built_in">console</span>.log(result);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">test();</span><br></pre></td></tr></table></figure>
<h4 id="async-await-的优势在于处理-then-链。"><a href="#async-await-的优势在于处理-then-链。" class="headerlink" title="async/await 的优势在于处理 then 链。"></a>async/await 的优势在于处理 then 链。</h4><p>假设一个业务，分多个步骤完成，每个步骤都是异步的，而且依赖于上一个步骤的结果。我们仍然用 <code>setTimeout</code> 来模拟异步操作：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 返回值：time+200</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">takeLongTime</span>(<span class="params">time</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="params">resolve</span> =&gt;</span> &#123;</span><br><span class="line">    setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> resolve(time + <span class="number">200</span>), time);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">step1</span>(<span class="params">time</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">`step1 with <span class="subst">$&#123;time&#125;</span>`</span>);</span><br><span class="line">  <span class="keyword">return</span> takeLongTime(time);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">step2</span>(<span class="params">time</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">`step2 with <span class="subst">$&#123;time&#125;</span>`</span>);</span><br><span class="line">  <span class="keyword">return</span> takeLongTime(time);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">step3</span>(<span class="params">time</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">`step3 with <span class="subst">$&#123;time&#125;</span>`</span>);</span><br><span class="line">  <span class="keyword">return</span> takeLongTime(time);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>promise 语法：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">promiseMethod</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> time = <span class="number">300</span>;</span><br><span class="line">  step1(time)</span><br><span class="line">    .then(<span class="function"><span class="params">time2</span> =&gt;</span> step2(time2))</span><br><span class="line">    .then(<span class="function"><span class="params">time3</span> =&gt;</span> step3(time3))</span><br><span class="line">    .then(<span class="function"><span class="params">result</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">`result is <span class="subst">$&#123;result&#125;</span>`</span>);</span><br><span class="line">    &#125;)</span><br><span class="line">    .catch(<span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">// 任何一个步骤有错误，程序跳转到这里执行。</span></span><br><span class="line">      <span class="built_in">console</span>.log(err);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">promiseMethod();</span><br></pre></td></tr></table></figure>
<p>async/await 语法：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">asyncMethod</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> time1 = <span class="number">300</span>;</span><br><span class="line">  <span class="keyword">const</span> time2 = <span class="keyword">await</span> step1(time1);</span><br><span class="line">  <span class="keyword">const</span> time3 = <span class="keyword">await</span> step2(time2);</span><br><span class="line">  <span class="keyword">const</span> result = <span class="keyword">await</span> step3(time3);</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">`result is <span class="subst">$&#123;result&#125;</span>`</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">asyncMethod();</span><br></pre></td></tr></table></figure>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://andy0570.com/2018/11/14/Node.js示例_串行:并行流程控制/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="独木舟的木">
      <meta itemprop="description" content="有时候阳光很好 有时候阳光很暗">
      <meta itemprop="image" content="https://blog-andy0570-1256077835.cos.ap-shanghai.myqcloud.com/site_Images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="独木舟的木">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2018/11/14/Node.js示例_串行:并行流程控制/" class="post-title-link" itemprop="url">Node.js示例_串行/并行流程控制</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2018-11-14 16:21:00" itemprop="dateCreated datePublished" datetime="2018-11-14T16:21:00+08:00">2018-11-14</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2019-04-28 15:59:34" itemprop="dateModified" datetime="2019-04-28T15:59:34+08:00">2019-04-28</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Node-js/" itemprop="url" rel="index"><span itemprop="name">Node.js</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          
            <span id="/2018/11/14/Node.js示例_串行:并行流程控制/" class="leancloud_visitors" data-flag-title="Node.js示例_串行/并行流程控制">
              <span class="post-meta-divider">|</span>
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              
                <span class="post-meta-item-text">阅读次数：</span>
              
                <span class="leancloud-visitors-count"></span>
            </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body han-init-context" itemprop="articleBody">

      
      

      
        
          <blockquote>
<p>本文内容：<br>用简单的示例程序描述 Node.js 串行和并行化流程控制的底层机制。<br>实际应用开发中以社区中的工具为主。比较流行的有 <a href="https://caolan.github.io/async/index.html" target="_blank" rel="noopener">Async</a>、Step、Seq 等。</p>
</blockquote>
          <!--noindex-->
          
            <div class="post-button text-center">
              <a class="btn" href="/2018/11/14/Node.js示例_串行:并行流程控制/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          
          <!--/noindex-->
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://andy0570.com/2018/11/13/Node.js示例_CNode RESTful API/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="独木舟的木">
      <meta itemprop="description" content="有时候阳光很好 有时候阳光很暗">
      <meta itemprop="image" content="https://blog-andy0570-1256077835.cos.ap-shanghai.myqcloud.com/site_Images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="独木舟的木">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2018/11/13/Node.js示例_CNode RESTful API/" class="post-title-link" itemprop="url">Node.js示例_CNode RESTful API</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2018-11-13 13:53:00" itemprop="dateCreated datePublished" datetime="2018-11-13T13:53:00+08:00">2018-11-13</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2019-04-28 15:59:34" itemprop="dateModified" datetime="2019-04-28T15:59:34+08:00">2019-04-28</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Node-js/" itemprop="url" rel="index"><span itemprop="name">Node.js</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          
            <span id="/2018/11/13/Node.js示例_CNode RESTful API/" class="leancloud_visitors" data-flag-title="Node.js示例_CNode RESTful API">
              <span class="post-meta-divider">|</span>
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              
                <span class="post-meta-item-text">阅读次数：</span>
              
                <span class="leancloud-visitors-count"></span>
            </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body han-init-context" itemprop="articleBody">

      
      

      
        
          
            <a id="more"></a>
<h2 id="创建主题"><a href="#创建主题" class="headerlink" title="创建主题"></a>创建主题</h2><ul>
<li><code>POST /api/v2/topics</code></li>
<li><p>请求体：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  accesstoken: 'string',</span><br><span class="line">  title: 'string',</span><br><span class="line">  tab: &#123; type: 'enum', values: [ 'ask', 'share', 'job' ], required: false &#125;,</span><br><span class="line">  content: 'string',</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>响应状态码：201</p>
</li>
<li>响应体：<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"topic_id"</span>: <span class="string">"57ea257b3670ca3f44c5beb6"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="实现"><a href="#实现" class="headerlink" title="实现"></a>实现</h2><h3 id="初始化项目"><a href="#初始化项目" class="headerlink" title="初始化项目"></a>初始化项目</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> npm i egg-init -g    <span class="comment"># 安装Egg脚手架</span></span></span><br><span class="line"><span class="meta">$</span><span class="bash"> egg-init cnode-api --<span class="built_in">type</span>=simple</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">cd</span> cnode-api</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> npm i</span></span><br></pre></td></tr></table></figure>
<h3 id="开启-validate-插件"><a href="#开启-validate-插件" class="headerlink" title="开启 validate 插件"></a>开启 validate 插件</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// config/plugin.js</span></span><br><span class="line">exports.validate = &#123;</span><br><span class="line">  enable: <span class="literal">true</span>,</span><br><span class="line">  package: <span class="string">'egg-validate'</span>,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h3 id="注册路由"><a href="#注册路由" class="headerlink" title="注册路由"></a>注册路由</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// app/router.js</span></span><br><span class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="params">app</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// app.resources('routerName', 'pathMatch', controller)</span></span><br><span class="line">  app.router.resources(<span class="string">'topics'</span>, <span class="string">'/api/v2/topics'</span>, app.controller.topics);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>通过 <code>app.resources</code> 方法，将 topics 这个资源的增删查改接口映射到了 <code>app/controller/topics.js</code> 文件。</p>
<h3 id="controller-开发"><a href="#controller-开发" class="headerlink" title="controller 开发"></a>controller 开发</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// app/controller/topics.js</span></span><br><span class="line"><span class="keyword">const</span> Controller = <span class="built_in">require</span>(<span class="string">'egg'</span>).Controller;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TopicsController</span> <span class="keyword">extends</span> <span class="title">Controller</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>(ctx) &#123;</span><br><span class="line">    <span class="keyword">super</span>(ctx);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 定义创建接口的请求参数规则</span></span><br><span class="line">    <span class="keyword">this</span>.createRule = &#123;</span><br><span class="line">      accesstoken: <span class="string">'string'</span>,</span><br><span class="line">      title: <span class="string">'string'</span>,</span><br><span class="line">      tab: &#123; <span class="attr">type</span>: <span class="string">'enum'</span>, <span class="attr">values</span>: [ <span class="string">'ask'</span>, <span class="string">'share'</span>, <span class="string">'job'</span> ], <span class="attr">required</span>: <span class="literal">false</span> &#125;,</span><br><span class="line">      content: <span class="string">'string'</span>,</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ------ 新建 ------</span></span><br><span class="line">  <span class="keyword">async</span> create() &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; ctx &#125; = <span class="keyword">this</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 1. 调用 validate 方法对请求参数进行验证。</span></span><br><span class="line">    <span class="comment">// 校验 `ctx.request.body` 是否符合我们预期的格式</span></span><br><span class="line">    <span class="comment">// 如果参数校验未通过，将会抛出一个 status = 422 的异常</span></span><br><span class="line">    ctx.validate(<span class="keyword">this</span>.createRule, ctx.request.body);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2. 用验证过的参数调用 service 封装的业务逻辑来创建一个 topic。</span></span><br><span class="line">    <span class="comment">// 调用 service 创建一个 topic</span></span><br><span class="line">    <span class="keyword">const</span> id = <span class="keyword">await</span> ctx.service.topics.create(ctx.request.body);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 3. 按照接口约定的格式设置响应状态码和内容。</span></span><br><span class="line">    <span class="comment">// 设置响应体和状态码</span></span><br><span class="line">    ctx.body = &#123;</span><br><span class="line">      topic_id: id,</span><br><span class="line">    &#125;;</span><br><span class="line">    ctx.status = <span class="number">201</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = TopicsController;</span><br></pre></td></tr></table></figure>
<h3 id="service-开发"><a href="#service-开发" class="headerlink" title="service 开发"></a>service 开发</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> Service = <span class="built_in">require</span>(<span class="string">'egg'</span>).Service;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TopicService</span> <span class="keyword">extends</span> <span class="title">Service</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>(ctx) &#123;</span><br><span class="line">    <span class="keyword">super</span>(ctx);</span><br><span class="line">    <span class="keyword">this</span>.root = <span class="string">'https://cnodejs.org/api/v1'</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">async</span> request(url, opts) &#123;</span><br><span class="line">    url = <span class="string">`<span class="subst">$&#123;<span class="keyword">this</span>.root&#125;</span><span class="subst">$&#123;url&#125;</span>`</span>;</span><br><span class="line">    opts = <span class="built_in">Object</span>.assign(&#123;</span><br><span class="line">      timeout: [ <span class="string">'30s'</span>, <span class="string">'30s'</span> ],</span><br><span class="line">      dataType: <span class="string">'json'</span>,</span><br><span class="line">    &#125;, opts);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.ctx.curl(url, opts);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">async</span> create(params) &#123;</span><br><span class="line">    <span class="comment">// 调用 CNode V1 版本 API</span></span><br><span class="line">    <span class="keyword">const</span> result = <span class="keyword">await</span> <span class="keyword">this</span>.request(<span class="string">'/topics'</span>, &#123;</span><br><span class="line">      method: <span class="string">'post'</span>,</span><br><span class="line">      data: params,</span><br><span class="line">      contentType: <span class="string">'json'</span>,</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 检查调用是否成功，如果调用失败会抛出异常</span></span><br><span class="line">    <span class="keyword">this</span>.checkSuccess(result);</span><br><span class="line">    <span class="comment">// 返回创建的 topic 的 id</span></span><br><span class="line">    <span class="keyword">return</span> result.data.topic_id;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 封装统一的调用检查函数，可以在查询、创建和更新等 Service 中复用</span></span><br><span class="line">  checkSuccess(result) &#123;</span><br><span class="line">    <span class="keyword">if</span> (result.status !== <span class="number">200</span>) &#123;</span><br><span class="line">      <span class="keyword">const</span> errorMsg = result.data &amp;&amp; result.data.error_msg ? result.data.error_msg : <span class="string">'unknown error'</span>;</span><br><span class="line">      <span class="keyword">this</span>.ctx.throw(result.status, errorMsg);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (!result.data.success) &#123;</span><br><span class="line">      <span class="comment">// 远程调用返回格式错误</span></span><br><span class="line">      <span class="keyword">this</span>.ctx.throw(<span class="number">500</span>, <span class="string">'remote response error'</span>, &#123; <span class="attr">data</span>: result.data &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = TopicService;</span><br></pre></td></tr></table></figure>
<h3 id="统一错误处理"><a href="#统一错误处理" class="headerlink" title="统一错误处理"></a>统一错误处理</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// app/middleware/error_handler.js</span></span><br><span class="line"><span class="built_in">module</span>.exports = <span class="function">(<span class="params">option, app</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">errorHandler</span>(<span class="params">ctx, next</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="keyword">await</span> next();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 所有的异常都在 app 上触发一个 error 事件，框架会记录一条错误日志</span></span><br><span class="line">      app.emit(<span class="string">'error'</span>, err, <span class="keyword">this</span>);</span><br><span class="line"></span><br><span class="line">      <span class="keyword">const</span> status = err.status || <span class="number">500</span>;</span><br><span class="line">      <span class="comment">// 生产环境时 500 错误的详细错误内容不返回给客户端，因为可能包含敏感信息</span></span><br><span class="line">      <span class="keyword">const</span> error = (( status === <span class="number">500</span> ) &amp;&amp; ( app.config.env === <span class="string">'prod'</span> ))</span><br><span class="line">        ? <span class="string">'Internal Server Error'</span></span><br><span class="line">        : err.message;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 从 error 对象上读出各个属性，设置到响应中</span></span><br><span class="line">      ctx.body = &#123; error &#125;;</span><br><span class="line">      <span class="keyword">if</span> (status === <span class="number">422</span>) &#123;</span><br><span class="line">        ctx.body.detail = err.errors;</span><br><span class="line">      &#125;</span><br><span class="line">      ctx.status = status;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>通过配置文件（<code>config/config.default.js</code>）加载中间件：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="params">appInfo</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> config = &#123;&#125;;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// should change to your own</span></span><br><span class="line">  config.keys = appInfo.name + <span class="string">'_1490750627161_5967'</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 加载 errorHandler 中间件</span></span><br><span class="line">  config.middleware = [ <span class="string">'errorHandler'</span> ];</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 配置 errorHandler 中间件：只对 /api 前缀的 url 路径生效</span></span><br><span class="line">  config.errorHandler = &#123;</span><br><span class="line">    match: <span class="string">'/api'</span>,</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> config;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><ul>
<li><a href="https://eggjs.org/zh-cn/tutorials/restful.html" target="_blank" rel="noopener">Egg.js 教程：实现 RESTful API</a></li>
<li><a href="https://cnodejs.org/api" target="_blank" rel="noopener">CNode 社区 API</a></li>
</ul>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/4/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/4/">4</a><span class="page-number current">5</span><a class="page-number" href="/page/6/">6</a><span class="space">&hellip;</span><a class="page-number" href="/page/32/">32</a><a class="extend next" rel="next" href="/page/6/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <div class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image" src="https://blog-andy0570-1256077835.cos.ap-shanghai.myqcloud.com/site_Images/avatar.png" alt="独木舟的木">
            
              <p class="site-author-name" itemprop="name">独木舟的木</p>
              <div class="site-description motion-element" itemprop="description">有时候阳光很好 有时候阳光很暗</div>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/">
                
                    <span class="site-state-item-count">317</span>
                    <span class="site-state-item-name">日志</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-categories">
                  
                    
                      <a href="/categories/">
                    
                  
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">14</span>
                    <span class="site-state-item-name">分类</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-tags">
                  
                    
                      <a href="/tags/">
                    
                  
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">36</span>
                    <span class="site-state-item-name">标签</span>
                  </a>
                </div>
              
            </nav>
          

          
            <div class="feed-link motion-element">
              <a href="/atom.xml" rel="alternate">
                <i class="fa fa-rss"></i>
                RSS
              </a>
            </div>
          

          

          
            <div class="links-of-author motion-element">
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                    
                  
                  <a href="https://github.com/Andy0570" title="GitHub &rarr; https://github.com/Andy0570" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i>GitHub</a>
                </span>
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                    
                  
                  <a href="mailto:andywhm@163.com" title="E-Mail &rarr; mailto:andywhm@163.com" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                </span>
              
            </div>
          

          
             <div class="cc-license motion-element" itemprop="license">
              
              
                
              
              
              
              <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" class="cc-opacity" rel="noopener" target="_blank"><img src="/images/cc-by-nc-sa.svg" alt="Creative Commons"></a>
             </div>
          

          
          

          
            
          
          

        </div>
      </div>

      

      

    </div>
  </aside>
  


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js">
</script>
<div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love" id="animate">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">独木舟的木</span>

  

  
</div>



  <span id="busuanzi_container_site_uv">
  本站访客数<span id="busuanzi_value_site_uv"></span>人次
  </span>
  <span class="post-meta-divider">|</span>

  <div class="powered-by">由 <a href="https://hexo.io" class="theme-link" rel="noopener" target="_blank">Hexo</a> 强力驱动 v3.8.0</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 – <a href="https://theme-next.org" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> v7.1.0</div>




        








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

    

    
  </div>

  

<script>
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>





  



  






  



  
    
    
      
    
  
  <script color="17,119,176" opacity="0.5" zindex="-1" count="99" src="//cdn.jsdelivr.net/gh/theme-next/theme-next-canvas-nest@1/canvas-nest.min.js"></script>













  
  <script src="//cdn.jsdelivr.net/npm/jquery@2/dist/jquery.min.js"></script>

  
  <script src="//cdn.jsdelivr.net/npm/fastclick@1/lib/fastclick.min.js"></script>

  
  <script src="//cdn.jsdelivr.net/npm/jquery-lazyload@1/jquery.lazyload.min.js"></script>

  
  <script src="//cdn.jsdelivr.net/npm/velocity-animate@1/velocity.min.js"></script>

  
  <script src="//cdn.jsdelivr.net/npm/velocity-animate@1/velocity.ui.min.js"></script>

  
  <script src="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.js"></script>


  


  <script src="/js/utils.js?v=7.1.0"></script>

  <script src="/js/motion.js?v=7.1.0"></script>



  
  


  <script src="/js/affix.js?v=7.1.0"></script>

  <script src="/js/schemes/pisces.js?v=7.1.0"></script>




  

  


  <script src="/js/next-boot.js?v=7.1.0"></script>


  

  

  
  
  
    
  

  
    
      
    
  

  
  
  
    <script src="//cdn.jsdelivr.net/npm/quicklink@1/dist/quicklink.umd.js"></script>
    <script>
      
        window.addEventListener('load', () => {
      
        quicklink({
          timeout: 3000,
          priority: true,
          ignores: [uri => uri.includes('#'),uri => uri == 'https://andy0570.com/page/5/',]
        });
      
        });
      
    </script>
  


  



  



  
  
  
    
  
  <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/instantsearch.js@2/dist/instantsearch.min.css">

  
  
    
  
  <script src="//cdn.jsdelivr.net/npm/instantsearch.js@2/dist/instantsearch.js"></script>
  

  <script src="/js/algolia-search.js?v=7.1.0"></script>



  
  
  <script>
    
    function showTime(Counter) {
      var entries = [];
      var $visitors = $('.leancloud_visitors');

      $visitors.each(function() {
        entries.push( $(this).attr('id').trim() );
      });

      Counter('get', '/classes/Counter', { where: JSON.stringify({ url: { '$in': entries } }) })
        .done(function({ results }) {
          var COUNT_CONTAINER_REF = '.leancloud-visitors-count';

          if (results.length === 0) {
            $visitors.find(COUNT_CONTAINER_REF).text(0);
            return;
          }

          for (var i = 0; i < results.length; i++) {
            var item = results[i];
            var url = item.url;
            var time = item.time;
            var element = document.getElementById(url);

            $(element).find(COUNT_CONTAINER_REF).text(time);
          }
          for (var i = 0; i < entries.length; i++) {
            var url = entries[i];
            var element = document.getElementById(url);
            var countSpan = $(element).find(COUNT_CONTAINER_REF);
            if (countSpan.text() == '') {
              countSpan.text(0);
            }
          }
        })
        .fail(function ({ responseJSON }) {
          console.log('LeanCloud Counter Error: ' + responseJSON.code + ' ' + responseJSON.error);
        });
    }
    

    $(function() {
      $.get('https://app-router.leancloud.cn/2/route?appId=' + 'S7i1Y8YorMKFPaYbJbekD5el-gzGzoHsz')
        .done(function({ api_server }) {
          var Counter = function(method, url, data) {
            return $.ajax({
              method: method,
              url: 'https://' + api_server + '/1.1' + url,
              headers: {
                'X-LC-Id': 'S7i1Y8YorMKFPaYbJbekD5el-gzGzoHsz',
                'X-LC-Key': 'brOnU8mOQvSjpipJvdKUAIbU',
                'Content-Type': 'application/json',
              },
              data: data
            });
          };
          
            if ($('.post-title-link').length >= 1) {
              showTime(Counter);
            }
          
        });
    });
  </script>



  

  

  

  

  

  

  

  

  
  
  
    
  
  <script src="//cdn.jsdelivr.net/npm/pangu@4/dist/browser/pangu.min.js"></script>
  <script>pangu.spacingPage();</script>


  
  
  
    
  
  <script src="//cdn.jsdelivr.net/gh/theme-next/theme-next-bookmark@1/bookmark.min.js"></script>
  <script>
  
    bookmark.loadBookmark();
  
  </script>


  

  

  
  
</body>
</html>
