<!DOCTYPE html>












  


<html class="theme-next gemini use-motion" lang="zh-CN">
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">




  
  
    
      
    
    
      
    
  <script src="//cdn.jsdelivr.net/npm/pace-js@1/pace.min.js"></script>
  <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/pace-js@1/themes/blue/pace-theme-minimal.css">



  
  
    
  
  <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/han-css@3/dist/han.min.css">













  
  
    
  
  <link rel="stylesheet" href="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.css">







  

<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/font-awesome@4/css/font-awesome.min.css">

<link rel="stylesheet" href="/css/main.css?v=7.1.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/panda/apple-touch-icon.png?v=7.1.0">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/panda/favicon-32x32.png?v=7.1.0">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/panda/favicon-16x16.png?v=7.1.0">


  <link rel="mask-icon" href="/images/panda/safari-pinned-tab.svg?v=7.1.0" color="#222">


  <link rel="manifest" href="/images/panda/site.webmanifest">


  <meta name="msapplication-config" content="/images/panda/browserconfig.xml">





<script id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '7.1.0',
    sidebar: {"position":"left","display":"post","offset":12,"onmobile":false,"dimmer":false},
    back2top: true,
    back2top_sidebar: false,
    fancybox: true,
    fastclick: true,
    lazyload: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  <meta name="description" content="有时候阳光很好 有时候阳光很暗">
<meta name="keywords" content="独木舟的木">
<meta property="og:type" content="website">
<meta property="og:title" content="独木舟的木">
<meta property="og:url" content="https://andy0570.com/page/6/index.html">
<meta property="og:site_name" content="独木舟的木">
<meta property="og:description" content="有时候阳光很好 有时候阳光很暗">
<meta property="og:locale" content="zh-CN">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="独木舟的木">
<meta name="twitter:description" content="有时候阳光很好 有时候阳光很暗">



  <link rel="alternate" href="/atom.xml" title="独木舟的木" type="application/atom+xml">



  
  
  <link rel="canonical" href="https://andy0570.com/page/6/">



<script id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>独木舟的木</title>
  






  <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?8229a094facca297f211d61323fd9fde";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>







  <noscript>
  <style>
  .use-motion .motion-element,
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-title { opacity: initial; }

  .use-motion .logo,
  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-CN">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <a href="https://github.com/andy0570" class="github-corner" aria-label="View source on GitHub"><svg width="80" height="80" viewbox="0 0 250 250" style="fill:#151513; color:#fff; position: absolute; top: 0; border: 0; right: 0;" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"/><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"/><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"/></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style>
    
    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">独木舟的木</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
      
        <p class="site-subtitle">iOS Developer</p>
      
    
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="切换导航栏">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home">

    
    
    
      
    

    
      
    

    <a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i> <br>首页</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-categories">

    
    
    
      
    

    
      
    

    <a href="/categories/" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i> <br>分类<span class="badge">14</span></a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-tags">

    
    
    
      
    

    
      
    

    <a href="/tags/" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i> <br>标签<span class="badge">39</span></a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">

    
    
    
      
    

    
      
    

    <a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i> <br>归档<span class="badge">314</span></a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-about">

    
    
    
      
    

    
      
    

    <a href="/about/" rel="section"><i class="menu-item-icon fa fa-fw fa-user"></i> <br>关于</a>

  </li>

      
      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br>搜索</a>
        </li>
      
    </ul>
  

  

  
    <div class="site-search">
      
  
  <div class="algolia-popup popup search-popup">
    <div class="algolia-search">
      <div class="algolia-search-input-icon">
        <i class="fa fa-search"></i>
      </div>
      <div class="algolia-search-input" id="algolia-search-input"></div>
    </div>

    <div class="algolia-results">
      <div id="algolia-stats"></div>
      <div id="algolia-hits"></div>
      <div id="algolia-pagination" class="algolia-pagination"></div>
    </div>

    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
  </div>




    </div>
  
</nav>



  



</div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
            

          
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://andy0570.com/2018/11/02/Node.js实战_2.构建 Node Web 程序/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="独木舟的木">
      <meta itemprop="description" content="有时候阳光很好 有时候阳光很暗">
      <meta itemprop="image" content="https://ws1.sinaimg.cn/large/006tNc79gy1g22m14458rj30u014xu0x.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="独木舟的木">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2018/11/02/Node.js实战_2.构建 Node Web 程序/" class="post-title-link" itemprop="url">Node.js实战_2.构建 Node Web 程序</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2018-11-02 13:55:00" itemprop="dateCreated datePublished" datetime="2018-11-02T13:55:00+08:00">2018-11-02</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2019-04-18 15:06:08" itemprop="dateModified" datetime="2019-04-18T15:06:08+08:00">2019-04-18</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Node-js/" itemprop="url" rel="index"><span itemprop="name">Node.js</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          
            <span id="/2018/11/02/Node.js实战_2.构建 Node Web 程序/" class="leancloud_visitors" data-flag-title="Node.js实战_2.构建 Node Web 程序">
              <span class="post-meta-divider">|</span>
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              
                <span class="post-meta-item-text">阅读次数：</span>
              
                <span class="leancloud-visitors-count"></span>
            </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body han-init-context" itemprop="articleBody">

      
      

      
        
          
            <a id="more"></a>
<h2 id="一、HTTP-服务器的基础知识"><a href="#一、HTTP-服务器的基础知识" class="headerlink" title="一、HTTP 服务器的基础知识"></a>一、HTTP 服务器的基础知识</h2><p>Node 的 http 模块：C编写、底层、简单、灵活、高效。<br>Node的策略是提供小而强的网络API，像会话（Session）这种高级概念以及 HTTP cookies 这样的基础组件都没有包括在Node的内核之中。那些都要由第三方模块提供。</p>
<p><img src="http://upload-images.jianshu.io/upload_images/2648731-15f0e76e069f12d8.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="Node Web程序分层概览"></p>
<h3 id="1-Node-如何向开发者呈现HTTP请求"><a href="#1-Node-如何向开发者呈现HTTP请求" class="headerlink" title="1. Node 如何向开发者呈现HTTP请求"></a>1. Node 如何向开发者呈现HTTP请求</h3><p><img src="http://upload-images.jianshu.io/upload_images/2648731-ceb974145bce047a.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image"></p>
<p>Node 服务器收到HTTP请求之后：</p>
<ol>
<li>解析HTTP请求头（HTTP Head）；</li>
<li>触发回调函数（function(req, res) {…} ）；</li>
<li>解析HTTP请求体（HTTP Body）；</li>
<li>执行应用逻辑；</li>
<li>调用 <code>res.end()</code> 结束响应；</li>
</ol>
<h3 id="2-一个用“Hello-World”做响应的HTTP服务器"><a href="#2-一个用“Hello-World”做响应的HTTP服务器" class="headerlink" title="2. 一个用“Hello World”做响应的HTTP服务器"></a>2. 一个用“Hello World”做响应的HTTP服务器</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// http 模块提供了HTTP服务器和客户端接口。</span></span><br><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">'http'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// http.createServer()：创建HTTP服务器，服务器每次收到HTTP请求后都会调用它的回调函数</span></span><br><span class="line"><span class="keyword">var</span> server = http.createServer(<span class="function"><span class="keyword">function</span>(<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// res.write():将响应数据写到socket中</span></span><br><span class="line">    res.write(<span class="string">'Hello World'</span>);</span><br><span class="line">    <span class="comment">// res.end():结束响应</span></span><br><span class="line">    res.end(); </span><br><span class="line"></span><br><span class="line">    <span class="comment">// res.write() 和 res.end() 可以合并缩写：</span></span><br><span class="line">    <span class="comment">// res.end('Hello World');</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 绑定监听端口</span></span><br><span class="line">server.listen(<span class="number">3000</span>);</span><br></pre></td></tr></table></figure>
<h3 id="3-读取、设定响应头"><a href="#3-读取、设定响应头" class="headerlink" title="3. 读取、设定响应头"></a>3. 读取、设定响应头</h3><p>Node 中修改HTTP响应头的方法：</p>
<ul>
<li><code>res.setHeader(field, value)</code></li>
<li><code>res.getHeader(field, value)</code></li>
<li><code>res.removeHeader(field)</code></li>
</ul>
<p>添加和移除响应头的顺序可以随意，但一定要在调用 <code>res.write()</code> 或<code>res.end()</code> 之前。</p>
<p>示例，使用 <code>res.setHeader()</code>：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> body = <span class="string">'Hello World'</span>;</span><br><span class="line">res.setHeader(<span class="string">'Content-Length'</span>, Buffer.byteLength(body));</span><br><span class="line">res.setHeader(<span class="string">'Content-Type'</span>, <span class="string">'text/plain'</span>);</span><br><span class="line">res.end(body);</span><br></pre></td></tr></table></figure>
<h3 id="4-设定HTTP响应的状态码"><a href="#4-设定HTTP响应的状态码" class="headerlink" title="4. 设定HTTP响应的状态码"></a>4. 设定HTTP响应的状态码</h3><p>响应状态码需要设定 <code>res.statusCode</code> 属性。在程序响应期间可以随时给这个属性赋值，只要是在第一次调用<code>res.write()</code>或<code>res.end()</code>之前就行。</p>
<p><code>res.statusCode</code> 默认的响应状态码是200 OK。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> body = <span class="string">'Hello World'</span>;</span><br><span class="line">res.setHeader(<span class="string">'Content-Length'</span>, Buffer.byteLength(body));</span><br><span class="line">res.setHeader(<span class="string">'Content-Type'</span>, <span class="string">'text/plain'</span>);</span><br><span class="line">res.statusCode = <span class="number">302</span>;</span><br><span class="line">res.end(body); </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 以上可以简写如下：</span></span><br><span class="line"><span class="keyword">const</span> body = <span class="string">'Hello World'</span>;</span><br><span class="line">res.writeHead(<span class="number">200</span>, &#123;</span><br><span class="line">    <span class="string">'Content-Length'</span>: Buffer.byteLength(body),</span><br><span class="line">    <span class="string">'Content-Type'</span>: <span class="string">'text/plain'</span></span><br><span class="line">&#125;);</span><br><span class="line">res.end();</span><br></pre></td></tr></table></figure>
<p>参考：<a href="https://www.wikiwand.com/zh-hans/HTTP%E7%8A%B6%E6%80%81%E7%A0%81" target="_blank" rel="noopener">Wikiwand：HTTP 状态码</a></p>
<table>
<thead>
<tr>
<th>HTTP状态码</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>1xx</td>
<td>消息</td>
</tr>
<tr>
<td>2xx</td>
<td>成功</td>
</tr>
<tr>
<td>3xx</td>
<td>重定向</td>
</tr>
<tr>
<td>4xx</td>
<td>客户端错误</td>
</tr>
<tr>
<td>5xx</td>
<td>服务器错误</td>
</tr>
</tbody>
</table>
<h2 id="二、构建-RESTful-Web-服务"><a href="#二、构建-RESTful-Web-服务" class="headerlink" title="二、构建 RESTful Web 服务"></a>二、构建 RESTful Web 服务</h2><p>创建标准的REST服务器需要实现四个HTTP谓词，每个谓词会覆盖一个待办事项清单的操作任务:</p>
<table>
<thead>
<tr>
<th>HTTP Method</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>POST</td>
<td>增，向待办事项清单中添加事项</td>
</tr>
<tr>
<td>GET</td>
<td>查，显示当前事项列表，或者显示某一事项的详情;</td>
</tr>
<tr>
<td>DELETE</td>
<td>删，从待办事项清单中移除事项;</td>
</tr>
<tr>
<td>PUT</td>
<td>改，修改已有事项</td>
</tr>
</tbody>
</table>
<h3 id="1-用-POST-请求创建资源"><a href="#1-用-POST-请求创建资源" class="headerlink" title="1. 用 POST 请求创建资源"></a>1. 用 POST 请求创建资源</h3><p>当 Node 的 HTTP 解析器读入并解析请求数据时，它会将数据做成 data 事件的形式，把解析好的数据块放入其中，等待程序处理：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">'http'</span>);</span><br><span class="line"><span class="keyword">var</span> server = http.createServer(<span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 数据块默认是 Buffer 对象</span></span><br><span class="line">    <span class="comment">// 将流编码设定为utf8，这样data事件会给出字符串</span></span><br><span class="line">    req.setEncoding(<span class="string">'utf8'</span>);</span><br><span class="line">    <span class="comment">// 1. 只要读入了新的数据块，就会触发 data 事件。</span></span><br><span class="line">    req.on(<span class="string">'data'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">chunk</span>) </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'parsed'</span>, chunk); </span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="comment">// 2. 数据全部读取完之后，触发 end 事件。</span></span><br><span class="line">    req.on(<span class="string">'end'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'done parsing'</span>);</span><br><span class="line">        res.end();</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>在Node中，可以通过检查 <code>req.method</code> 属性查看用的是哪个HTTP方法(谓词)。</p>
<p>示例：POST请求字符串缓存：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">'http'</span>);</span><br><span class="line"><span class="keyword">const</span> url = <span class="built_in">require</span>(<span class="string">'url'</span>);</span><br><span class="line"><span class="keyword">var</span> items = []; <span class="comment">// 用一个JS数组存放数据</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> server = http.createServer(<span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">switch</span> (req.method) &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">'POST'</span>:</span><br><span class="line">            <span class="keyword">var</span> item = <span class="string">''</span>; <span class="comment">// 进来的字符串缓存</span></span><br><span class="line">            req.setEncoding(<span class="string">'utf8'</span>); <span class="comment">// 将进来的 data 事件编码为 utf8</span></span><br><span class="line">            req.on(<span class="string">'data'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">chunk</span>) </span>&#123;</span><br><span class="line">                item += chunk;</span><br><span class="line">            &#125;);</span><br><span class="line">            req.on(<span class="string">'end'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">                items.push(item); <span class="comment">// 将完整的事项压入数组</span></span><br><span class="line">                res.end(<span class="string">'OK\n'</span>);</span><br><span class="line">            &#125;);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">    </span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">server.listen(<span class="number">3000</span>);</span><br></pre></td></tr></table></figure>
<h3 id="2-用-GET-请求获取资源"><a href="#2-用-GET-请求获取资源" class="headerlink" title="2. 用 GET 请求获取资源"></a>2. 用 GET 请求获取资源</h3><p>switch 中添加如下分支：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">case</span> <span class="string">'GET'</span>:</span><br><span class="line">    items.forEach(<span class="function"><span class="keyword">function</span> (<span class="params">item, i</span>) </span>&#123;</span><br><span class="line">        res.write(i + <span class="string">') '</span> + item + <span class="string">'\n'</span>);</span><br><span class="line">    &#125;)</span><br><span class="line">    res.end;</span><br><span class="line">    <span class="keyword">break</span>;</span><br></pre></td></tr></table></figure>
<p>测试：</p>
<p><a href="https://curl.haxx.se/download.html" target="_blank" rel="noopener">cURL</a>是一个强大的命令行HTTP客户端，可以用来向目标服务器发送请求。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> -d 表示请求方法为 POST</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> curl -d <span class="string">'buy groceries'</span> http://localhost:3000</span></span><br><span class="line">OK</span><br><span class="line"><span class="meta">$</span><span class="bash"> curl -d <span class="string">'buy node in action'</span> http://localhost:3000</span></span><br><span class="line">OK</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> GET 是默认的方法</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> curl http://localhost:3000</span></span><br><span class="line">0) buy groceries</span><br><span class="line">1) buy node in action</span><br></pre></td></tr></table></figure>
<h4 id="设定-Content-Length-头"><a href="#设定-Content-Length-头" class="headerlink" title="设定 Content-Length 头"></a>设定 Content-Length 头</h4><p>在响应中设置 <strong>Content-Length</strong> 可以提高响应速度。</p>
<p>设定 <strong>Content-Length</strong> 域会隐含禁用Node的块编码，因为要传输的数据更少，所以能提升性能。</p>
<p>经过优化的 GET 处理如下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">case</span> <span class="string">'GET'</span>:</span><br><span class="line">    <span class="keyword">var</span> body = items.map(<span class="function"><span class="keyword">function</span> (<span class="params">item, i</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> i + <span class="string">') '</span> + item;</span><br><span class="line">    &#125;).join(<span class="string">'\n'</span>);</span><br><span class="line">    res.setHeader(<span class="string">'Content-Length'</span>, Buffer.byteLength(body)); <span class="comment">// ⚠️</span></span><br><span class="line">    res.setHeader(<span class="string">'Content-Type'</span>, <span class="string">'text/plain; charset="utf-8"'</span>);</span><br><span class="line">    res.end(body);</span><br><span class="line">    <span class="keyword">break</span>;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>⚠️</p>
<p><strong>Buffer.byteLength()</strong></p>
<p>你可能想用 <code>body.length</code> 的值设定 <strong>Content-Length</strong>，但 <strong>Content-Length</strong> 的值应该是字节长度，不是字符长度，并且如果字符串中有多字节字符，两者的长度是不一样的。为了规避这个问题，Node提供了一个<code>Buffer.byteLength()</code> 方法。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;</span><span class="bash"> <span class="comment"># Node REPL 测试</span></span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> ☁  ~ [master] ⚡  node</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> &gt; <span class="string">'etc张三'</span>.length</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> 5</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> &gt; Buffer.byteLength(<span class="string">'etc张三'</span>)</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> 9</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"></span></span><br></pre></td></tr></table></figure>
</blockquote>
<h4 id="Node-REPL-环境"><a href="#Node-REPL-环境" class="headerlink" title="Node REPL 环境"></a>Node REPL 环境</h4><blockquote>
<p>Node跟很多其他语言一样，提供了一个REPL(读取-计算-输出-循环)环境，在命令行中不带任何参数运行node就可以进入这个环境。用REPL可以编写代码片段，每条语句写好并执行后马上就能得到结果。对于学习编程语言、运行简单的测试，甚至是调试都很有帮助。</p>
</blockquote>
<h3 id="3-用-DELETE-请求移除资源"><a href="#3-用-DELETE-请求移除资源" class="headerlink" title="3. 用 DELETE 请求移除资源"></a>3. 用 DELETE 请求移除资源</h3><p><code>req.url</code> 属性中包含了客户端请求的URL，根据请求的不同，其中可能包含几个组成部分。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> node</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> require(<span class="string">'url'</span>).parse(<span class="string">'http://localhost:3000/v1?key=value'</span>)</span></span><br><span class="line">Url &#123;</span><br><span class="line">  protocol: 'http:',</span><br><span class="line">  slashes: true,</span><br><span class="line">  auth: null,</span><br><span class="line">  host: 'localhost:3000',</span><br><span class="line">  port: '3000',</span><br><span class="line">  hostname: 'localhost',</span><br><span class="line">  hash: null,</span><br><span class="line">  search: '?key=value',</span><br><span class="line">  query: 'key=value',</span><br><span class="line">  pathname: '/v1',</span><br><span class="line">  path: '/v1?key=value', # 请求路径</span><br><span class="line">  href: 'http://localhost:3000/v1?key=value' &#125;</span><br></pre></td></tr></table></figure>
<p>DELETE 请求处理代码片段：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">case</span> <span class="string">'DELETE'</span>:</span><br><span class="line">    <span class="keyword">var</span> path = url.parse(req.url).pathname;</span><br><span class="line">    <span class="comment">// pathname是字符串，需要将字符串转换为数字</span></span><br><span class="line">    <span class="comment">// String.slice(),提取字符串的第一个字符串</span></span><br><span class="line">    <span class="comment">// parseInt(),JavaScript 的全局函数，解析一个字符串，返回整数。</span></span><br><span class="line">    <span class="comment">// 10 表示字符串基数，十进制。</span></span><br><span class="line">    <span class="keyword">var</span> i = <span class="built_in">parseInt</span>(path.slice(<span class="number">1</span>), <span class="number">10</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">isNaN</span>(i)) &#123; <span class="comment">// 检查数字是否有效</span></span><br><span class="line">        res.statusCode = <span class="number">400</span>;</span><br><span class="line">        res.end(<span class="string">'Invalid item id'</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (!items[i]) &#123; <span class="comment">// 确保请求的索引存在</span></span><br><span class="line">        res.statusCode = <span class="number">400</span>;</span><br><span class="line">        res.end(<span class="string">'Item not found'</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        items.splice(i, <span class="number">1</span>); <span class="comment">// 删除请求的事项</span></span><br><span class="line">        res.end(<span class="string">'OK\n'</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">break</span>;</span><br></pre></td></tr></table></figure>
<h2 id="三、提供静态文件服务"><a href="#三、提供静态文件服务" class="headerlink" title="三、提供静态文件服务"></a>三、提供静态文件服务</h2><p>静态文件（CSS、JavaScript、图片）服务器。</p>
<p>fs（文件系统）模块，是提供静态服务的必备模块。</p>
<h3 id="1-创建一个静态文件服务器"><a href="#1-创建一个静态文件服务器" class="headerlink" title="1. 创建一个静态文件服务器"></a>1. 创建一个静态文件服务器</h3><p>每个静态文件服务器都有个根目录，也就是提供文件服务的基础目录。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">'http'</span>);</span><br><span class="line"><span class="keyword">const</span> parse = <span class="built_in">require</span>(<span class="string">'url'</span>).parse;</span><br><span class="line"><span class="keyword">const</span> join = <span class="built_in">require</span>(<span class="string">'path'</span>).join;</span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> root = __dirname; <span class="comment">// 静态文件服务器的根目录</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * url.pathname = /index.html</span></span><br><span class="line"><span class="comment"> * root = /var/www/example.com/public</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * path.join() =&gt; /var/www/example.com/public/index.html</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">var</span> server = http.createServer(<span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> url = parse(req.url);</span><br><span class="line">    <span class="keyword">var</span> path = join(root, url.pathname); <span class="comment">// 构造绝对路径</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> stream = fs.createReadStream(path); <span class="comment">// fs.ReadStream</span></span><br><span class="line">    stream.on(<span class="string">'data'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">chunk</span>) </span>&#123; </span><br><span class="line">        res.write(chunk); <span class="comment">// 将文件数据写入到响应中</span></span><br><span class="line">    &#125;)</span><br><span class="line">    stream.on(<span class="string">'end'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        res.end(); <span class="comment">// 文件写完后结束响应</span></span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">server.listen(<span class="number">3000</span>);</span><br></pre></td></tr></table></figure>
<blockquote>
<p>⚠️</p>
<p><strong>目录遍历攻击</strong></p>
<p>生产环境中，应该全面地检查输入的有效性，以防用户通过目录遍历攻击访问到你本来不想开放给他们的那部分内容。</p>
</blockquote>
<h4 id="用-Stream-pipe-优化数据传输"><a href="#用-Stream-pipe-优化数据传输" class="headerlink" title="用 Stream.pipe() 优化数据传输"></a>用 Stream.pipe() 优化数据传输</h4><blockquote>
<p><strong>管道和水管</strong></p>
<p>管道可以让来自源头（即ReadableStream）的数据，流到某个目的地（即WritableStream）。</p>
<p>用 <code>pipe()</code> 方法连接管道。</p>
<p>ReadableStream.pipe(WritableStream);</p>
<p>读取一个文件（ReadableStream）并把其中的内容写到另一个文件中（WritableStream）用的就是管道:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="keyword">var</span> readStream = fs.createReadStream(<span class="string">'./original.txt'</span>);</span><br><span class="line">&gt; <span class="keyword">var</span> writeStream = fs. createWriteStream(<span class="string">'./copy.txt'</span>);</span><br><span class="line">&gt; readStream.pipe(writeStream);</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>
</blockquote>
<blockquote>
<p>所有ReadableStream都能接入任何一个WritableStream。比如HTTP请求(req)对象就是ReadableStream，你可以让其中的内容流动到文件中:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt; req.pipe(fs.createWriteStream(<span class="string">'./req-body.txt'</span>));</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>
</blockquote>
<p>用 pipe() 简化服务器端代码：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> server = http.createServer(<span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> url = parse(req.url);</span><br><span class="line">    <span class="keyword">var</span> path = join(root, url.pathname); <span class="comment">// 构造绝对路径</span></span><br><span class="line">    <span class="keyword">var</span> stream = fs.createReadStream(path); <span class="comment">// fs.ReadStream</span></span><br><span class="line">    stream.pipe(res); <span class="comment">// res.end() 会在 stream.pipe() 内部调用</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h3 id="2-处理服务器错误"><a href="#2-处理服务器错误" class="headerlink" title="2. 处理服务器错误"></a>2. 处理服务器错误</h3><p>如何让Node服务器更加健壮？</p>
<p>默认情况下，如果没有设置监听器，error事件会被抛出。也就是说如果你不监听这些错误，那它们就会搞垮你的服务器。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">   ...</span><br><span class="line">stream.pipe(res);</span><br><span class="line">   stream.on(<span class="string">'error'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">err</span>) </span>&#123; <span class="comment">// 注册error事件处理器</span></span><br><span class="line">       res.statusCode = <span class="number">500</span>;</span><br><span class="line">       res.end(<span class="string">'Internal Server Error'</span>);</span><br><span class="line">   &#125;);</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<h3 id="3-用-fs-stat-实现先发制人的错误处理"><a href="#3-用-fs-stat-实现先发制人的错误处理" class="headerlink" title="3. 用 fs.stat() 实现先发制人的错误处理"></a>3. 用 fs.stat() 实现先发制人的错误处理</h3><p><code>fs.stat()</code> 用于获取文件相关信息。</p>
<p>检查文件是否存在，并在响应中提供Content-Length</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> server = http.createServer(<span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> url = parse(req.url);</span><br><span class="line">    <span class="keyword">var</span> path = join(root, url.pathname); <span class="comment">// 构造绝对路径</span></span><br><span class="line">    fs.stat(path, <span class="function"><span class="keyword">function</span> (<span class="params">err, stat</span>) </span>&#123; <span class="comment">// 检查文件是否存在</span></span><br><span class="line">        <span class="keyword">if</span> (err) &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="string">'ENOENT'</span> == err.code) &#123;</span><br><span class="line">                res.statusCode = <span class="number">404</span>;</span><br><span class="line">                res.end(<span class="string">'Not Found'</span>);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123; <span class="comment">// 其他错误</span></span><br><span class="line">                res.statusCode = <span class="number">500</span>;</span><br><span class="line">                res.end(<span class="string">'Internal Server Error'</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// 用 stat 对象的属性设置 Content-Length</span></span><br><span class="line">            res.setHeader(<span class="string">'Content-Length'</span>, stat.size); </span><br><span class="line">            <span class="keyword">var</span> stream = fs.createReadStream(path); <span class="comment">// fs.ReadStream</span></span><br><span class="line">            stream.pipe(res); <span class="comment">// res.end() 会在 stream.pipe() 内部调用</span></span><br><span class="line">            stream.on(<span class="string">'error'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">err</span>) </span>&#123;</span><br><span class="line">                res.statusCode = <span class="number">500</span>;</span><br><span class="line">                res.end(<span class="string">'Internal Server Error'</span>);</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<blockquote>
<p>💡💡💡</p>
<p>不推荐在调用<code>fs.open()</code>, <code>fs.readFile()</code> or <code>fs.writeFile()</code> 前通过使用 <code>fs.stat()</code> 来检查某个文件是否存在。对于这种情况，开发者应当通过直接 open/read/write 文件并检测产生的异常来判断文件是否可用。</p>
<p>如果不需要操作文件只是想获取文件是否可用，推荐使用 <a href="http://nodejs.cn/s/NCPsM3" target="_blank" rel="noopener"><code>fs.access()</code></a>。</p>
</blockquote>
<h2 id="四、从表单中接受用户输入"><a href="#四、从表单中接受用户输入" class="headerlink" title="四、从表单中接受用户输入"></a>四、从表单中接受用户输入</h2><p>Node 不会帮你承担处理表单的工作(比如验证或文件上传)，它只能把请求body数据交给你。尽管这看起来不太方便，但Node一贯的宗旨是提供简单高效的底层API，把其他机会留给了第三方框架。</p>
<table>
<thead>
<tr>
<th>表单提交的 Content-Type 值</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>application/x-www-form-urlencoded</td>
<td>HTML 表单默认值</td>
</tr>
<tr>
<td>multipart/form-data</td>
<td>表单中含有文件或非ASCII或二进制数据时使用</td>
</tr>
</tbody>
</table>
<h3 id="1-处理提交的表单域"><a href="#1-处理提交的表单域" class="headerlink" title="1. 处理提交的表单域"></a>1. 处理提交的表单域</h3><p>支持GET和POST的HTTP服务器：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">'http'</span>);</span><br><span class="line"><span class="keyword">const</span> qs = <span class="built_in">require</span>(<span class="string">'querystring'</span>);</span><br><span class="line"><span class="keyword">var</span> items = [];</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> server = http.createServer(<span class="function"><span class="keyword">function</span>(<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="string">'/'</span> == req.url) &#123;</span><br><span class="line">        <span class="keyword">switch</span> (req.method) &#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">'GET'</span>:</span><br><span class="line">                show(res);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">'POST'</span>:</span><br><span class="line">                add(req, res);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">default</span>:</span><br><span class="line">                badRequest(res);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        notFound(res);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">server.listen(<span class="number">3000</span>);</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">show</span>(<span class="params">res</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 用拼接字符串的方法生成 HTML</span></span><br><span class="line">    <span class="keyword">var</span> html = <span class="string">'&lt;html&gt;&lt;head&gt;&lt;title&gt;Todo List&lt;/title&gt;&lt;/head&gt;&lt;body&gt;'</span></span><br><span class="line">            + <span class="string">'&lt;h1&gt;Todo List&lt;/h1&gt;'</span></span><br><span class="line">            + <span class="string">'&lt;ul&gt;'</span></span><br><span class="line">            + items.map(<span class="function"><span class="keyword">function</span> (<span class="params">item</span>) </span>&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="string">'&lt;li&gt;'</span> + item + <span class="string">'&lt;/li&gt;'</span></span><br><span class="line">            &#125;).join(<span class="string">' '</span>)</span><br><span class="line">            + <span class="string">'&lt;/ul&gt;'</span></span><br><span class="line">            + <span class="string">'&lt;form method="post" action="/"&gt;'</span></span><br><span class="line">            + <span class="string">'&lt;p&gt;&lt;input type="text" name="item" /&gt;&lt;/p&gt;'</span></span><br><span class="line">            + <span class="string">'&lt;p&gt;&lt;input type="submit" value="Add Item" /&gt;&gt;&lt;/p&gt;'</span></span><br><span class="line">            + <span class="string">'&lt;/form&gt;&lt;/body&gt;&lt;/html&gt;'</span>;</span><br><span class="line">res.setHeader(<span class="string">'Content-Type'</span>, <span class="string">'text/html'</span>);</span><br><span class="line">res.setHeader(<span class="string">'Content-Length'</span>, Buffer.byteLength(html));</span><br><span class="line">res.end(html);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">add</span>(<span class="params">params</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> body = <span class="string">''</span>;</span><br><span class="line">    req.setEncoding(<span class="string">'utf8'</span>);</span><br><span class="line">    req.on(<span class="string">'data'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">chunk</span>) </span>&#123;</span><br><span class="line">        <span class="comment">// 把data事件的数据块拼接到一起形成完整的请求body字符串。</span></span><br><span class="line">        body += chunk;</span><br><span class="line">    &#125;);</span><br><span class="line">    req.on(<span class="string">'end'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> obj = qs.parse(body);</span><br><span class="line">        items.push(obj.item);</span><br><span class="line">        show(res);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 404 Not Found</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">notFound</span>(<span class="params">res</span>) </span>&#123;</span><br><span class="line">    res.statusCode = <span class="number">404</span>;</span><br><span class="line">    res.setHeader(<span class="string">'Content-Type'</span>, <span class="string">'text/plain'</span>);</span><br><span class="line">    res.end(<span class="string">'Not Found'</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 400 Bad Requests</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">badRequest</span>(<span class="params">res</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> body = <span class="string">'Bad Request'</span>;</span><br><span class="line">    res.writeHead(<span class="number">400</span>, &#123;</span><br><span class="line">        <span class="string">'Content-Length'</span>: Buffer.byteLength(body),</span><br><span class="line">        <span class="string">'Content-Type'</span>: <span class="string">'text/plain'</span></span><br><span class="line">    &#125;);</span><br><span class="line">    res.end(body);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="2-用formidable处理上传的文件"><a href="#2-用formidable处理上传的文件" class="headerlink" title="2. 用formidable处理上传的文件"></a>2. 用formidable处理上传的文件</h3><p>实现Web中的文件上传功能。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--上传文件时，表单的 enctype 属性需要设置为 multipart/form-data--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">method</span>=<span class="string">"POST"</span> <span class="attr">action</span>=<span class="string">"/"</span> <span class="attr">enctype</span>=<span class="string">"multipart/form-data"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"name"</span> /&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"file"</span> /&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">value</span>=<span class="string">"Upload"</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>第三方模块：<a href="https://www.npmjs.com/package/formidable" target="_blank" rel="noopener">npm：formmidable</a>，formidable 的流式解析器是处理文件上传的绝佳选择，也就是说它能随着数据块的上传接收它们，解析它们，并吐出特定的部分。这种方式不仅快速，还不会因为需要大量缓冲而导致内存膨胀，即便像视频这种大型文件，也不会把进程压垮。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">'http'</span>);</span><br><span class="line"><span class="keyword">const</span> formidable = <span class="built_in">require</span>(<span class="string">'formidable'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> server = http.createServer(<span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">switch</span> (req.method) &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">'GET'</span>:</span><br><span class="line">            show(req, res);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">'POST'</span>:</span><br><span class="line">            upload(req, res);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;);</span><br><span class="line">server.listen(<span class="number">3000</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// GET</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">show</span>(<span class="params">res</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 带有文件上传控件的 HTML 表单</span></span><br><span class="line">    <span class="keyword">var</span> html = <span class="string">' '</span></span><br><span class="line">            + <span class="string">'&lt;form method="post" action="/" enctype="multipart/form-data"&gt;'</span></span><br><span class="line">            + <span class="string">'&lt;p&gt;&lt;input type="text" name="name" /&gt;&lt;/p&gt;'</span></span><br><span class="line">            + <span class="string">'&lt;p&gt;&lt;input type="file" name="file" /&gt;&lt;/p&gt;'</span></span><br><span class="line">            + <span class="string">'&lt;p&gt;&lt;input type="submit" value="Upload" /&gt;&lt;/p&gt;'</span></span><br><span class="line">            + <span class="string">'&lt;/form&gt;'</span>;</span><br><span class="line">res.setHeader(<span class="string">'Content-Type'</span>, <span class="string">'text/html'</span>);</span><br><span class="line">res.setHeader(<span class="string">'Content-Length'</span>, Buffer.byteLength(html));</span><br><span class="line">res.end(html);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">upload</span>(<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!isFormData(req)) &#123;</span><br><span class="line">        res.statusCode = <span class="number">400</span>;</span><br><span class="line">        res.end(<span class="string">'Bad Request: expecting multipart/form-data'</span>);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> form = <span class="keyword">new</span> formidable.IncomingForm();</span><br><span class="line">    <span class="comment">// // 收完输入域后会发出 field 事件</span></span><br><span class="line">    <span class="comment">// // 每当收到字段 / 值对时发出。</span></span><br><span class="line">    <span class="comment">// form.on('field', function (name, value) &#123;</span></span><br><span class="line">    <span class="comment">//     console.log(name);</span></span><br><span class="line">    <span class="comment">//     console.log(value);</span></span><br><span class="line">    <span class="comment">// &#125;);</span></span><br><span class="line">    <span class="comment">// // 在收到文件并处理好后会发出 file 事件</span></span><br><span class="line">    <span class="comment">// // 文件上传完成后发出了file事件</span></span><br><span class="line">    <span class="comment">// // 每当收到字段 / 文件对时发出。</span></span><br><span class="line">    <span class="comment">// form.on('file', function (name, file) &#123;</span></span><br><span class="line">    <span class="comment">//     console.log(name);</span></span><br><span class="line">    <span class="comment">//     console.log(file);</span></span><br><span class="line">    <span class="comment">// &#125;);</span></span><br><span class="line">    <span class="comment">// form.on('end', function () &#123;</span></span><br><span class="line">    <span class="comment">//     res.end('upload complete');</span></span><br><span class="line">    <span class="comment">// &#125;);</span></span><br><span class="line"></span><br><span class="line">    form.parse(req, <span class="function"><span class="keyword">function</span> (<span class="params">err, fields, files</span>) </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(fields);</span><br><span class="line">        <span class="built_in">console</span>.log(files);</span><br><span class="line">        res.end(<span class="string">'upload complete'</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 用String.indexOf()方法检查请求头中的Content-Type字段， 断言它的值是以multipart/form-data开头的。</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">isFormData</span>(<span class="params">req</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> type = req.headers[<span class="string">'content-type'</span>] || <span class="string">''</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span> == type.indexOf(<span class="string">'multipart/form-data'</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="3-计算上传进度"><a href="#3-计算上传进度" class="headerlink" title="3. 计算上传进度"></a>3. 计算上传进度</h3><p><a href="https://github.com/felixge/node-formidable" target="_blank" rel="noopener">Formidable</a> 的 progress 事件能给出收到的字节数，以及期望收到的字节数。我们可以借助这个做出一个进度条。 </p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">form.on(<span class="string">'progress'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">bytesReceived, bytesExpected</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> percent = <span class="built_in">Math</span>.floor(bytesReceived / bytesExpected * <span class="number">100</span>);</span><br><span class="line">    <span class="built_in">console</span>.log(percent);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>接下来，把这个进度传回到用户的浏览器中，可以使用 <strong>WebSocket</strong> 协议或者 <strong>Socket.IO</strong> 这样的实时模块。</p>
<h2 id="五、用-HTTPS-加强程序的安全性"><a href="#五、用-HTTPS-加强程序的安全性" class="headerlink" title="五、用 HTTPS 加强程序的安全性"></a>五、用 HTTPS 加强程序的安全性</h2><p>开发环境中，生成自签名证书用于测试：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 使用 OpenSSL 生成私钥</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> openssl genrsa 2048 &gt; key.pem</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 使用私钥创建证书</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> openssl req -x509 -new -key key.pem &gt; key-cert.pem</span></span><br></pre></td></tr></table></figure>
<p>HTTPS 服务器配置项：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">'use strict'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> https = <span class="built_in">require</span>(<span class="string">'https'</span>);</span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 作为配置项的密钥和证书</span></span><br><span class="line"><span class="keyword">var</span> options = &#123;</span><br><span class="line">    key: fs.readFileSync(<span class="string">'./key.pem'</span>),</span><br><span class="line">    cert: fs.readFileSync(<span class="string">'./key-cert.pem'</span>)</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// https 和 http 模块的API几乎一样</span></span><br><span class="line">https.createServer(options, <span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">    res.writeHead(<span class="number">200</span>);</span><br><span class="line">    res.end(<span class="string">'Hello World'</span>);</span><br><span class="line">&#125;).listen(<span class="number">3000</span>);</span><br></pre></td></tr></table></figure>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://andy0570.com/2018/11/01/Node.js实战_1.Node 基础/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="独木舟的木">
      <meta itemprop="description" content="有时候阳光很好 有时候阳光很暗">
      <meta itemprop="image" content="https://ws1.sinaimg.cn/large/006tNc79gy1g22m14458rj30u014xu0x.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="独木舟的木">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2018/11/01/Node.js实战_1.Node 基础/" class="post-title-link" itemprop="url">Node.js实战_1.Node 基础</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2018-11-01 14:07:00" itemprop="dateCreated datePublished" datetime="2018-11-01T14:07:00+08:00">2018-11-01</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2019-04-23 09:58:26" itemprop="dateModified" datetime="2019-04-23T09:58:26+08:00">2019-04-23</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Node-js/" itemprop="url" rel="index"><span itemprop="name">Node.js</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          
            <span id="/2018/11/01/Node.js实战_1.Node 基础/" class="leancloud_visitors" data-flag-title="Node.js实战_1.Node 基础">
              <span class="post-meta-divider">|</span>
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              
                <span class="post-meta-item-text">阅读次数：</span>
              
                <span class="leancloud-visitors-count"></span>
            </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body han-init-context" itemprop="articleBody">

      
      

      
        
          <h1 id="Node-基础"><a href="#Node-基础" class="headerlink" title="Node 基础"></a>Node 基础</h1><p><strong>JavaScript 是编程语言，而 Node.js 是执行环境。</strong></p>
<p>Node.js 是一个基于 Chrome V8 引擎的 JavaScript 运行环境（runtime）。 </p>
<p>Node.js 特性：事件驱动、异步 API、非阻塞 I/O。</p>
<p>Node.js 是专为数据密集型实时程序（DITR）设计的。</p>
<p>Node.js 通过<strong>事件轮询（event loop）</strong>来实现非阻塞I/O网络的调用，而事件轮询是单向运行的先入先出队列。</p>
          <!--noindex-->
          
            <div class="post-button text-center">
              <a class="btn" href="/2018/11/01/Node.js实战_1.Node 基础/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          
          <!--/noindex-->
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://andy0570.com/2018/10/29/深入浅出Node.js_网络编程/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="独木舟的木">
      <meta itemprop="description" content="有时候阳光很好 有时候阳光很暗">
      <meta itemprop="image" content="https://ws1.sinaimg.cn/large/006tNc79gy1g22m14458rj30u014xu0x.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="独木舟的木">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2018/10/29/深入浅出Node.js_网络编程/" class="post-title-link" itemprop="url">深入浅出Node.js_网络编程</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2018-10-29 10:25:00" itemprop="dateCreated datePublished" datetime="2018-10-29T10:25:00+08:00">2018-10-29</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2019-04-18 13:34:00" itemprop="dateModified" datetime="2019-04-18T13:34:00+08:00">2019-04-18</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Node-js/" itemprop="url" rel="index"><span itemprop="name">Node.js</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          
            <span id="/2018/10/29/深入浅出Node.js_网络编程/" class="leancloud_visitors" data-flag-title="深入浅出Node.js_网络编程">
              <span class="post-meta-divider">|</span>
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              
                <span class="post-meta-item-text">阅读次数：</span>
              
                <span class="leancloud-visitors-count"></span>
            </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body han-init-context" itemprop="articleBody">

      
      

      
        
          <p><img src="http://upload-images.jianshu.io/upload_images/2648731-159c76f3f5171625.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="Node 网络模块"></p>
          <!--noindex-->
          
            <div class="post-button text-center">
              <a class="btn" href="/2018/10/29/深入浅出Node.js_网络编程/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          
          <!--/noindex-->
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://andy0570.com/2018/10/28/深入浅出Node.js_Buffer/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="独木舟的木">
      <meta itemprop="description" content="有时候阳光很好 有时候阳光很暗">
      <meta itemprop="image" content="https://ws1.sinaimg.cn/large/006tNc79gy1g22m14458rj30u014xu0x.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="独木舟的木">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2018/10/28/深入浅出Node.js_Buffer/" class="post-title-link" itemprop="url">深入浅出Node.js_Buffer</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2018-10-28 14:25:00" itemprop="dateCreated datePublished" datetime="2018-10-28T14:25:00+08:00">2018-10-28</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2019-04-20 15:34:17" itemprop="dateModified" datetime="2019-04-20T15:34:17+08:00">2019-04-20</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Node-js/" itemprop="url" rel="index"><span itemprop="name">Node.js</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          
            <span id="/2018/10/28/深入浅出Node.js_Buffer/" class="leancloud_visitors" data-flag-title="深入浅出Node.js_Buffer">
              <span class="post-meta-divider">|</span>
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              
                <span class="post-meta-item-text">阅读次数：</span>
              
                <span class="leancloud-visitors-count"></span>
            </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body han-init-context" itemprop="articleBody">

      
      

      
        
          <p>在网络流和文件的操作中，需要处理大量的二进制数据，JavaScript自有的字符串数据类型无法满足需求（注：ECAMScript 2015 引入了 <strong><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/TypedArray" target="_blank" rel="noopener">TypedArray</a></strong>），Buffer 对象应运而生，以提供对<strong>二进制数据</strong>的操作。</p>
          <!--noindex-->
          
            <div class="post-button text-center">
              <a class="btn" href="/2018/10/28/深入浅出Node.js_Buffer/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          
          <!--/noindex-->
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://andy0570.com/2018/10/26/深入浅出Node.js_内存控制/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="独木舟的木">
      <meta itemprop="description" content="有时候阳光很好 有时候阳光很暗">
      <meta itemprop="image" content="https://ws1.sinaimg.cn/large/006tNc79gy1g22m14458rj30u014xu0x.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="独木舟的木">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2018/10/26/深入浅出Node.js_内存控制/" class="post-title-link" itemprop="url">深入浅出Node.js_内存控制</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2018-10-26 14:33:00" itemprop="dateCreated datePublished" datetime="2018-10-26T14:33:00+08:00">2018-10-26</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2019-04-18 13:26:12" itemprop="dateModified" datetime="2019-04-18T13:26:12+08:00">2019-04-18</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Node-js/" itemprop="url" rel="index"><span itemprop="name">Node.js</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          
            <span id="/2018/10/26/深入浅出Node.js_内存控制/" class="leancloud_visitors" data-flag-title="深入浅出Node.js_内存控制">
              <span class="post-meta-divider">|</span>
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              
                <span class="post-meta-item-text">阅读次数：</span>
              
                <span class="leancloud-visitors-count"></span>
            </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body han-init-context" itemprop="articleBody">

      
      

      
        
          <p>内存控制是在<strong>海量请求</strong>和<strong>长时间运行</strong>的前提下进行探讨的。</p>
<p>在Node中如何高效地使用内存？</p>
          <!--noindex-->
          
            <div class="post-button text-center">
              <a class="btn" href="/2018/10/26/深入浅出Node.js_内存控制/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          
          <!--/noindex-->
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://andy0570.com/2018/10/26/深入浅出Node.js_异步编程/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="独木舟的木">
      <meta itemprop="description" content="有时候阳光很好 有时候阳光很暗">
      <meta itemprop="image" content="https://ws1.sinaimg.cn/large/006tNc79gy1g22m14458rj30u014xu0x.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="独木舟的木">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2018/10/26/深入浅出Node.js_异步编程/" class="post-title-link" itemprop="url">深入浅出Node.js_异步编程</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2018-10-26 14:32:00" itemprop="dateCreated datePublished" datetime="2018-10-26T14:32:00+08:00">2018-10-26</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2019-04-18 14:35:28" itemprop="dateModified" datetime="2019-04-18T14:35:28+08:00">2019-04-18</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Node-js/" itemprop="url" rel="index"><span itemprop="name">Node.js</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          
            <span id="/2018/10/26/深入浅出Node.js_异步编程/" class="leancloud_visitors" data-flag-title="深入浅出Node.js_异步编程">
              <span class="post-meta-divider">|</span>
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              
                <span class="post-meta-item-text">阅读次数：</span>
              
                <span class="leancloud-visitors-count"></span>
            </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body han-init-context" itemprop="articleBody">

      
      

      
        
          <h1 id="Node-的特点：事件驱动、非阻塞I-O"><a href="#Node-的特点：事件驱动、非阻塞I-O" class="headerlink" title="Node 的特点：事件驱动、非阻塞I/O"></a>Node 的特点：事件驱动、非阻塞I/O</h1><ol>
<li>异步I/O；</li>
<li>事件（轻量级、松耦合、只关注事务点）与回调函数；</li>
<li>单线程：child_process 子进程；</li>
<li>跨平台：libuv；</li>
</ol>
          <!--noindex-->
          
            <div class="post-button text-center">
              <a class="btn" href="/2018/10/26/深入浅出Node.js_异步编程/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          
          <!--/noindex-->
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://andy0570.com/2018/10/23/OpenLDAP/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="独木舟的木">
      <meta itemprop="description" content="有时候阳光很好 有时候阳光很暗">
      <meta itemprop="image" content="https://ws1.sinaimg.cn/large/006tNc79gy1g22m14458rj30u014xu0x.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="独木舟的木">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2018/10/23/OpenLDAP/" class="post-title-link" itemprop="url">OpenLDAP</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2018-10-23 21:05:00" itemprop="dateCreated datePublished" datetime="2018-10-23T21:05:00+08:00">2018-10-23</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2019-04-15 17:57:59" itemprop="dateModified" datetime="2019-04-15T17:57:59+08:00">2019-04-15</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/PKI-密码学/" itemprop="url" rel="index"><span itemprop="name">PKI&密码学</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          
            <span id="/2018/10/23/OpenLDAP/" class="leancloud_visitors" data-flag-title="OpenLDAP">
              <span class="post-meta-divider">|</span>
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              
                <span class="post-meta-item-text">阅读次数：</span>
              
                <span class="leancloud-visitors-count"></span>
            </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body han-init-context" itemprop="articleBody">

      
      

      
        
          
            <h1 id="OpenLDAP"><a href="#OpenLDAP" class="headerlink" title="OpenLDAP"></a>OpenLDAP</h1><ul>
<li><a href="https://wiki.archlinux.org/index.php/OpenLDAP_(%E7%AE%80%E4%BD%93%E4%B8%AD%E6%96%87" target="_blank" rel="noopener">openLDAP（简体中文）</a>)</li>
</ul>
<h1 id="Docker-OpenLDAP"><a href="#Docker-OpenLDAP" class="headerlink" title="Docker-OpenLDAP"></a>Docker-OpenLDAP</h1><ul>
<li><a href="https://github.com/osixia/docker-openldap" target="_blank" rel="noopener">GitHub: osixia/docker-openldap</a></li>
<li><a href="https://github.com/osixia/docker-phpLDAPadmin" target="_blank" rel="noopener">GitHub:osixia/docker-phpLDAPadmin</a></li>
</ul>
<h1 id="OpenLDAP-1"><a href="#OpenLDAP-1" class="headerlink" title="OpenLDAP"></a>OpenLDAP</h1><ul>
<li><a href="https://www.howtoing.com/how-to-install-and-configure-openldap-and-phpldapadmin-on-ubuntu-16-04" target="_blank" rel="noopener">如何在 Ubuntu 16.04 上安装和配置 OpenLDAP 和 phpLDAPadmins</a></li>
<li><a href="https://www.howtoing.com/how-to-install-and-configure-a-basic-ldap-server-on-an-ubuntu-12-04-vps/#add-organizational-units-groups-and-users" target="_blank" rel="noopener">如何在 Ubuntu 12.04 VPS 上安装和配置基本 LDAP 服务器</a>—— 在 phpLDAPadmin 上添加组织单位，组和用户</li>
<li><a href="https://www.howtoing.com/how-to-secure-apache-with-let-s-encrypt-on-ubuntu-16-04/" target="_blank" rel="noopener">如何在 Ubuntu 16.04 使用安全加密的 Apache</a></li>
<li><a href="https://mp.weixin.qq.com/s/k7Gda7CWmI38dF4ZJ-BPVA" target="_blank" rel="noopener">OpenLDAP 管理工具 Phpldapadmin 的安装及使用</a></li>
<li><a href="https://mp.weixin.qq.com/s/pnSmdhy74_HJN6LC7-BPkQ" target="_blank" rel="noopener">一键添加 OpenLDAP 用户及 Kerberos 账号</a></li>
<li><a href="https://www.jb51.net/article/115258.htm" target="_blank" rel="noopener">ubuntu 临时或永久修改 hostname 的方法</a></li>
<li><a href="http://blog.51cto.com/jiangche00/1925454" target="_blank" rel="noopener">51cto: Ubuntu 系统下 OpenLDAP 的安装及配置</a></li>
<li><a href="https://www.cnblogs.com/kungfupanda/p/4704421.html" target="_blank" rel="noopener">ubuntu 12.04 下安装 openldap，slapd.conf 找不到的解决方法</a></li>
<li><a href="https://segmentfault.com/a/1190000014683418" target="_blank" rel="noopener">我花了一个五一终于搞懂了 OpenLDAP</a></li>
</ul>
<p>轻量级目录访问协议（Lightweight Directory Access Protocol，LDAP）是用于通过网络管理和访问分层目录信息的标准协议。 它可以用于存储任何类型的信息，尽管它通常用作集中式身份验证系统或公司电子邮件和电话目录。</p>
<p>OpenLDAP 是 LDAP 协议的一个开源实现。LDAP 服务器本质上是一个为只读访问而优化的非关系型数据库。它主要用作地址簿查询（如 email 客户端）或对各种服务访问做后台认证以及用户数据权限管控。（例如，访问 Samba 时，LDAP 可以起到域控制器的作用；或者 <a href="https://wiki.archlinux.org/index.php/LDAP_authentication" target="_blank" rel="noopener">Linux 系统认证</a> 时代替 <code>/etc/passwd</code> 的作用。）</p>
<blockquote>
<p>⚠️ <strong>注意:</strong></p>
<p>以 <code>slap</code> 开头的命令（如： <code>slapcat</code> <code>slapcat</code>）是<strong>服务端</strong>工具。</p>
<p>以 <code>ldap</code> 开头的命令（如： <code>ldapsearch</code>）是<strong>客户端</strong>工具;</p>
</blockquote>
<h3 id="第一步：安装和配置-OpenLDAP-服务器"><a href="#第一步：安装和配置-OpenLDAP-服务器" class="headerlink" title="第一步：安装和配置 OpenLDAP 服务器"></a>第一步：安装和配置 OpenLDAP 服务器</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 安装 OpenLDAP:</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> slapd:OpenLDAP 服务端程序组件。</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> ldap-utils:OpenLDAP 命令行工具集。</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> sudo apt-get update</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> sudo apt-get install -y slapd ldap-utils</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 重新配置</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> sudo dpkg-reconfigure slapd</span></span><br><span class="line">Domain Name:arling.com</span><br><span class="line">Organization Name:tonintech</span><br><span class="line">Password:paradise</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 打开防火墙LDAP端口（389、636）</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> sudo ufw allow ldap</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> LDAP进程 slapd 生命周期管理</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> sudo service slapd start   <span class="comment"># 开启</span></span></span><br><span class="line"><span class="meta">$</span><span class="bash"> sudo serviec slapd stop    <span class="comment"># 关闭</span></span></span><br><span class="line"><span class="meta">$</span><span class="bash"> sudo service slapd restart <span class="comment"># 重启</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 获取 OpenLDAP 默认监听的端口</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> doc</span></span><br><span class="line">tcp        0      0 0.0.0.0:389             0.0.0.0:*               LISTEN      25135/slapd</span><br><span class="line">tcp6       0      0 :::389                  :::*                    LISTEN      25135/slapd</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 获取 OpenLDAP 进程的状态</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> ps aux | grep slapd | grep -v grep</span></span><br><span class="line">openldap 25135  0.0  0.0 1249408 7068 ?        Ssl  03:06   0:00 /usr/sbin/slapd -h ldap:/// ldapi:/// -g openldap -u openldap -F /etc/ldap/slapd.d</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 测试与 ldapwhoami 的 LDAP 连接</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> ldapwhoami -H ldap://18.217.226.78 -x</span></span><br><span class="line">anonymous</span><br></pre></td></tr></table></figure>
<h4 id="LDAP-配置文件"><a href="#LDAP-配置文件" class="headerlink" title="LDAP 配置文件"></a>LDAP 配置文件</h4><ul>
<li>通过 apt-get 命名安装 OpenLDAP 后，配置文件路径为：<code>/etc/ldap</code></li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">/etc/ldap$ ls -l</span><br><span class="line">total 16</span><br><span class="line">-rw-r--r-- 1 root     root      332 May 24 21:06 ldap.conf # 客户端配置文件</span><br><span class="line">drwxr-xr-x 2 root     root     4096 May 24 21:06 sasl2</span><br><span class="line">drwxr-xr-x 2 root     root     4096 Sep 14 09:32 schema</span><br><span class="line">drwxr-xr-x 3 openldap openldap 4096 Sep 17 08:27 slapd.d # 服务端配置文件</span><br></pre></td></tr></table></figure>
<blockquote>
<p>⚠️</p>
<ul>
<li>从 OpenLDAP 2.4 版本开始所有配置数据都保存在 <code>/etc/openldap/slapd.d/</code>中，建议不再使用 <code>slapd.conf</code> 作为配置文件。</li>
<li>配置 OpenLDAP 最正确的姿势是通过<code>ldapmodify</code>命令执行<strong>一系列自己写好的</strong> ldif 文件，而<strong>不要修改任何 OpenLDAP 装好的配置文件</strong>。</li>
</ul>
</blockquote>
<h3 id="第二步：安装和配置-phpLDAPadmin-Web-页面"><a href="#第二步：安装和配置-phpLDAPadmin-Web-页面" class="headerlink" title="第二步：安装和配置 phpLDAPadmin Web 页面"></a>第二步：安装和配置 phpLDAPadmin Web 页面</h3><p>安装 phpLDAPadmin：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> sudo apt-get install phpldapadmin</span></span><br></pre></td></tr></table></figure>
<p>修改 phpLDAPadmin 配置文件 <code>/etc/phpldapadmin/config.php</code>：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> sudo vim /etc/phpldapadmin/config.php</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> ------ 配置内容如下 ------</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 1.LDAP 服务器名称</span></span><br><span class="line"><span class="meta">$</span><span class="bash">servers-&gt;setValue(<span class="string">'server'</span>,<span class="string">'name'</span>,<span class="string">'My LDAP Server'</span>); </span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 2.phpLDAPadmin LDAP 层次结构的根目录</span></span><br><span class="line"><span class="meta">$</span><span class="bash">servers-&gt;setValue(<span class="string">'server'</span>,<span class="string">'base'</span>,array(<span class="string">'dc=arling,dc=com'</span>)); </span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 3.注释掉登录bind_id配置行</span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="variable">$servers</span>-&gt;setValue(<span class="string">'login'</span>,<span class="string">'bind_id'</span>,<span class="string">'cn=admin,dc=example,dc=com'</span>);</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 命令行模式下搜索：/hide_template_warning</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 4.隐藏 phpLDAPadmin 警告消息</span></span><br><span class="line"><span class="meta">$</span><span class="bash">config-&gt;custom-&gt;appearance[<span class="string">'hide_template_warning'</span>] = <span class="literal">true</span>;</span></span><br></pre></td></tr></table></figure>
<p>关闭 Apache2 服务</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> sudo /etc/init.d/apache2 stop</span></span><br></pre></td></tr></table></figure>
<h3 id="第三步：登录到-phpLDAPadmin-Web-页面："><a href="#第三步：登录到-phpLDAPadmin-Web-页面：" class="headerlink" title="第三步：登录到 phpLDAPadmin Web 页面："></a>第三步：登录到 phpLDAPadmin Web 页面：</h3><p>登录到 phpLDAPadmin 界面，添加用户，组织单位，组和关系。参考：<a href="https://www.howtoing.com/how-to-install-and-configure-a-basic-ldap-server-on-an-ubuntu-12-04-vps/#add-organizational-units-groups-and-users" target="_blank" rel="noopener">添加组织单位，组和用户</a></p>
<ul>
<li><a href="http://18.217.226.78/phpldapadmin/index.php" target="_blank" rel="noopener">http://18.217.226.78/phpldapadmin/index.php</a></li>
<li>Login DN:cn=admin,dc=arling,dc=com</li>
<li>Password:paradise</li>
</ul>
<p>​    <img src="https://ws4.sinaimg.cn/large/006tNbRwly1fvdttyt7itj30hs0ms78u.jpg" alt></p>
<p>​    1. 添加组织：Generic: Organisational Unit</p>
<p>​    2. 添加组：Generic: Posix Group</p>
<p>​    3. 添加用户：Generic: User Account</p>
<h3 id="第四步：配置-StartTLS-LDAP-加密"><a href="#第四步：配置-StartTLS-LDAP-加密" class="headerlink" title="第四步：配置 StartTLS LDAP 加密"></a>第四步：配置 StartTLS LDAP 加密</h3>
          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://andy0570.com/2018/10/23/OpenSSL-无法使用-RSA-非对称加密算法加密大文件/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="独木舟的木">
      <meta itemprop="description" content="有时候阳光很好 有时候阳光很暗">
      <meta itemprop="image" content="https://ws1.sinaimg.cn/large/006tNc79gy1g22m14458rj30u014xu0x.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="独木舟的木">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2018/10/23/OpenSSL-无法使用-RSA-非对称加密算法加密大文件/" class="post-title-link" itemprop="url">OpenSSL-无法使用-RSA-非对称加密算法加密大文件</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2018-10-23 21:05:00" itemprop="dateCreated datePublished" datetime="2018-10-23T21:05:00+08:00">2018-10-23</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2019-04-15 17:37:13" itemprop="dateModified" datetime="2019-04-15T17:37:13+08:00">2019-04-15</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/PKI-密码学/" itemprop="url" rel="index"><span itemprop="name">PKI&密码学</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          
            <span id="/2018/10/23/OpenSSL-无法使用-RSA-非对称加密算法加密大文件/" class="leancloud_visitors" data-flag-title="OpenSSL-无法使用-RSA-非对称加密算法加密大文件">
              <span class="post-meta-divider">|</span>
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              
                <span class="post-meta-item-text">阅读次数：</span>
              
                <span class="leancloud-visitors-count"></span>
            </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body han-init-context" itemprop="articleBody">

      
      

      
        
          
            <h3 id="Shell-示例代码"><a href="#Shell-示例代码" class="headerlink" title="Shell 示例代码"></a>Shell 示例代码</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 使用 genrsa 命令生成 RSA-2048 位的密钥（rsa_private.key）</span></span><br><span class="line">openssl genrsa -out rsa_private.key 2048</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 解析私钥结构，查看密钥内容</span></span><br><span class="line">openssl rsa -text -in rsa_private.key</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 生成密钥的公钥（rsa_private.key）</span></span><br><span class="line">openssl rsa -in rsa_private.key -pubout -out rsa_public.key</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 使用生成的公钥加密文件</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> -pubin 表明用纯公钥文件加密</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> -inkey 指定密钥（rsa_private.key）</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> -<span class="keyword">in</span> 指定要加密的文件（test.pdf，3.2M）</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> -out 加密后的文件（encrypted.en）</span></span><br><span class="line">openssl rsautl -encrypt -pubin -inkey rsa_public.key  -in test.pdf -out encrypted.en</span><br><span class="line">RSA operation error</span><br><span class="line">4475450988:error:04FFF06E:rsa routines:CRYPTO_internal:data too large for key size:/BuildRoot/Library/Caches/com.apple.xbs/Sources/libressl/libressl-22.200.4/libressl-2.6/crypto/rsa/rsa_pk1.c:151:</span><br></pre></td></tr></table></figure>
<ul>
<li><a href="https://stackoverflow.com/questions/7143514/how-to-encrypt-a-large-file-in-openssl-using-public-key" target="_blank" rel="noopener">How to encrypt a large file in openssl using public key</a></li>
</ul>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://andy0570.com/2018/10/13/Node.js 框架&资源/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="独木舟的木">
      <meta itemprop="description" content="有时候阳光很好 有时候阳光很暗">
      <meta itemprop="image" content="https://ws1.sinaimg.cn/large/006tNc79gy1g22m14458rj30u014xu0x.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="独木舟的木">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2018/10/13/Node.js 框架&资源/" class="post-title-link" itemprop="url">Node.js 框架&资源</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2018-10-13 00:41:00" itemprop="dateCreated datePublished" datetime="2018-10-13T00:41:00+08:00">2018-10-13</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2019-04-23 16:28:58" itemprop="dateModified" datetime="2019-04-23T16:28:58+08:00">2019-04-23</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Node-js/" itemprop="url" rel="index"><span itemprop="name">Node.js</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          
            <span id="/2018/10/13/Node.js 框架&资源/" class="leancloud_visitors" data-flag-title="Node.js 框架&资源">
              <span class="post-meta-divider">|</span>
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              
                <span class="post-meta-item-text">阅读次数：</span>
              
                <span class="leancloud-visitors-count"></span>
            </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body han-init-context" itemprop="articleBody">

      
      

      
        
          
            <a id="more"></a>
<h2 id="nodeframework-上的框架分类"><a href="#nodeframework-上的框架分类" class="headerlink" title="nodeframework 上的框架分类"></a><a href="http://nodeframework.com/" target="_blank" rel="noopener">nodeframework</a> 上的框架分类</h2><p><img src="http://upload-images.jianshu.io/upload_images/2648731-8ccc4b3dde2e47b9.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="Node.js 框架"></p>
<h3 id="框架的定义"><a href="#框架的定义" class="headerlink" title="框架的定义"></a>框架的定义</h3><ul>
<li><strong>API 框架</strong>——用于搭建 Web API 的库，有协助组织程序结构的框架支持。LoopBack将自己定义为这类框架。</li>
<li><strong>HTTP 服务器库</strong>——所有基于 Express 的项目都可以归为这一类，包括 Koa 和 Kraken.js 。这些库帮我们围绕 HTTP 动词和路由搭建程序。</li>
<li><strong>HTTP服务器框架</strong>——用来搭建模块化 HTTP 服务器的框架。hapi 就是这种框架。</li>
<li><strong>Web MVC 框架</strong>——模型-视图-控制器框架，Sail.js 就是这种框架。</li>
<li><strong>全栈框架</strong>——这些框架在服务器端和浏览器上用的都是  JavaScript，并且两端可以共享代码。这被称为<strong>同构代码</strong>。 DerbyJS 是个全栈 MVC 框架。</li>
</ul>
<h3 id="Koa"><a href="#Koa" class="headerlink" title="Koa"></a>Koa</h3><table>
<thead>
<tr>
<th>库类别</th>
<th>HTTP 服务器库</th>
</tr>
</thead>
<tbody>
<tr>
<td>功能特性</td>
<td>基于生成器的中间件，请求/响应模型</td>
</tr>
<tr>
<td>建议应用</td>
<td>轻型 Web 程序、不严格的 HTTP API、单页 Web 程序</td>
</tr>
<tr>
<td>插件架构</td>
<td>中间件</td>
</tr>
<tr>
<td>文档</td>
<td><a href="https://koa.bootcss.com/" target="_blank" rel="noopener">https://koa.bootcss.com/</a></td>
</tr>
<tr>
<td>热门程度</td>
<td><a href="https://github.com/koajs/koa" target="_blank" rel="noopener">GitHub</a> 24198 ⭐️</td>
</tr>
<tr>
<td>授权许可</td>
<td>MIT</td>
</tr>
</tbody>
</table>
<blockquote>
<p>Koa 轻便、极简，在中间件中使用 ES2015 生成器语法。适合依赖外部 Web API 的单页 Web 程序。</p>
</blockquote>
<h3 id="Kraken"><a href="#Kraken" class="headerlink" title="Kraken"></a>Kraken</h3><table>
<thead>
<tr>
<th>库类别</th>
<th>HTTP 服务器库</th>
</tr>
</thead>
<tbody>
<tr>
<td>功能特性</td>
<td>对项目结构要求严格、模型、模版（Dust）、安全强化（Lusca）、配置管理、国际化</td>
</tr>
<tr>
<td>建议应用</td>
<td>企业 Web 程序</td>
</tr>
<tr>
<td>插件架构</td>
<td>Express 中间件</td>
</tr>
<tr>
<td>文档</td>
<td><a href="https://www.kraken.com/help/api" target="_blank" rel="noopener">https://www.kraken.com/help/api</a></td>
</tr>
<tr>
<td>热门程度</td>
<td><a href="https://github.com/krakenjs/kraken-js" target="_blank" rel="noopener">GitHub</a> 4698 ⭐️</td>
</tr>
<tr>
<td>授权许可</td>
<td>Apache 2.0</td>
</tr>
</tbody>
</table>
<blockquote>
<p> Kraken 是基于 Express 的，添加了安全特性。可以用于 MVC。</p>
</blockquote>
<h3 id="hapi"><a href="#hapi" class="headerlink" title="hapi"></a>hapi</h3><table>
<thead>
<tr>
<th>库类别</th>
<th>HTTP 服务器库</th>
</tr>
</thead>
<tbody>
<tr>
<td>功能特性</td>
<td>高层服务器容器抽象，安全的头部信息</td>
</tr>
<tr>
<td>建议应用</td>
<td>单页 Web 程序、HTTP API</td>
</tr>
<tr>
<td>插件架构</td>
<td>hapi 插件</td>
</tr>
<tr>
<td>文档</td>
<td><a href="https://hapijs.com/" target="_blank" rel="noopener">https://hapijs.com/</a></td>
</tr>
<tr>
<td>热门程度</td>
<td><a href="https://github.com/hapijs/hapi" target="_blank" rel="noopener">GitHub</a> 10000 ⭐️</td>
</tr>
<tr>
<td>授权许可</td>
<td>BSD 3</td>
</tr>
</tbody>
</table>
<blockquote>
<p>hapi 的重点是 HTTP 服务器和路由。适合由很多小服务器组成的轻便后台。</p>
</blockquote>
<h3 id="Sails-js"><a href="#Sails-js" class="headerlink" title="Sails.js"></a>Sails.js</h3><table>
<thead>
<tr>
<th>库类别</th>
<th>MVC 框架</th>
</tr>
</thead>
<tbody>
<tr>
<td>功能特性</td>
<td>有支持数据库的 ORM，生成 REST API，WebSocket</td>
</tr>
<tr>
<td>建议应用</td>
<td>Rails 风格的 MVC 程序</td>
</tr>
<tr>
<td>插件架构</td>
<td>Express 中间件</td>
</tr>
<tr>
<td>文档</td>
<td><a href="http://sailsjs.org/" target="_blank" rel="noopener">http://sailsjs.org/</a></td>
</tr>
<tr>
<td>热门程度</td>
<td><a href="https://github.com/balderdashy/sails/" target="_blank" rel="noopener">GitHub</a> 19976 ⭐️</td>
</tr>
<tr>
<td>授权许可</td>
<td>BSD 3</td>
</tr>
</tbody>
</table>
<blockquote>
<p> Sails.js 是 Rails/Django 风格的 MVC 框架。有 ORM 和模板系统。</p>
</blockquote>
<h3 id="DerbyJS"><a href="#DerbyJS" class="headerlink" title="DerbyJS"></a>DerbyJS</h3><table>
<thead>
<tr>
<th>库类别</th>
<th>全栈框架</th>
</tr>
</thead>
<tbody>
<tr>
<td>功能特性</td>
<td>有支持数据库的 ORM（Racer），同构</td>
</tr>
<tr>
<td>建议应用</td>
<td>有服务器端支持的单页 Web 程序</td>
</tr>
<tr>
<td>插件架构</td>
<td>DerbyJS 插件</td>
</tr>
<tr>
<td>文档</td>
<td><a href="https://derbyjs.com/" target="_blank" rel="noopener">https://derbyjs.com/</a></td>
</tr>
<tr>
<td>热门程度</td>
<td><a href="https://github.com/derbyjs/derby/" target="_blank" rel="noopener">GitHub</a> 4358 ⭐️</td>
</tr>
<tr>
<td>授权许可</td>
<td>MIT</td>
</tr>
</tbody>
</table>
<blockquote>
<p> DerbyJS 是个同构框架，适合实时程序。</p>
</blockquote>
<h3 id="Flatiron-js"><a href="#Flatiron-js" class="headerlink" title="Flatiron.js"></a>Flatiron.js</h3><table>
<thead>
<tr>
<th>库类别</th>
<th>模块化 MVC 框架</th>
</tr>
</thead>
<tbody>
<tr>
<td>功能特性</td>
<td>数据库管理层（Resourceful），解耦的可重用模块</td>
</tr>
<tr>
<td>建议应用</td>
<td>轻量的 MVC 程序，在其他框架中使用 Flatiron 模块</td>
</tr>
<tr>
<td>插件架构</td>
<td>Broadway 插件 API</td>
</tr>
<tr>
<td>文档</td>
<td><a href="https://github.com/flatiron/flatiron" target="_blank" rel="noopener">https://github.com/flatiron/flatiron</a></td>
</tr>
<tr>
<td>热门程度</td>
<td><a href="https://github.com/flatiron/flatiron" target="_blank" rel="noopener">GitHub</a> 1338 ⭐️</td>
</tr>
<tr>
<td>授权许可</td>
<td>MIT</td>
</tr>
</tbody>
</table>
<blockquote>
<p>Flatiron 是一组解耦的模块，既可以当作 Web MVC 框架来用，也可以当作更轻便的 Express库。 Flatiron 跟 Connect 中间件是兼容的。</p>
</blockquote>
<h3 id="LoopBack"><a href="#LoopBack" class="headerlink" title="LoopBack"></a>LoopBack</h3><table>
<thead>
<tr>
<th>库类别</th>
<th>API 框架</th>
</tr>
</thead>
<tbody>
<tr>
<td>功能特性</td>
<td>ORM、API 用户界面、WebScoket、客户端 SDK（包括 iOS）</td>
</tr>
<tr>
<td>建议应用</td>
<td>支持多客户端的 API（移动端、桌面端、Web）</td>
</tr>
<tr>
<td>插件架构</td>
<td>Express 中间件</td>
</tr>
<tr>
<td>文档</td>
<td><a href="https://loopback.io/" target="_blank" rel="noopener">https://loopback.io/</a></td>
</tr>
<tr>
<td>热门程度</td>
<td><a href="https://github.com/strongloop/loopback" target="_blank" rel="noopener">GitHub</a> 12092 ⭐️</td>
</tr>
<tr>
<td>授权许可</td>
<td>双许可：MIT 和 StrongLoop 认购协议</td>
</tr>
</tbody>
</table>
<blockquote>
<p> LoopBack 帮我们省掉了写套路化代码的工作。它可以快速生成带有数据库支持的 REST API，并有个 API 管理界面。</p>
</blockquote>
<h3 id="如何选择-Node-框架"><a href="#如何选择-Node-框架" class="headerlink" title="如何选择 Node 框架"></a>如何选择 Node 框架</h3><p><img src="https://upload-images.jianshu.io/upload_images/2648731-0a2c2e7344bde422.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="选择 Node 框架"></p>
<h3 id="提升应用安全性的-Node-模块"><a href="#提升应用安全性的-Node-模块" class="headerlink" title="提升应用安全性的 Node 模块"></a>提升应用安全性的 Node 模块</h3><ul>
<li>Lusca：<a href="http://krakenjs.com" target="_blank" rel="noopener">krakenjs</a> 中的一个安全模块。</li>
<li><a href="https://helmetjs.github.io/" target="_blank" rel="noopener">Helmet</a>：通过设置各种 HTTP 头来帮助您保护 Express 应用程序。</li>
<li>nsp 模块：审计 Node 应用的 <code>package.json</code> 和 <code>npm- shrinkwrap.json</code>文件，检查有没有已知漏洞。</li>
</ul>
<h2 id="流行的-npm-包"><a href="#流行的-npm-包" class="headerlink" title="流行的 npm 包"></a>流行的 npm 包</h2><ul>
<li><a href="https://prettier.io/" target="_blank" rel="noopener">Prettier</a>——让你可以专注于你正在写的代码，而不是去关心代码的格式；<br>Prettier 是一种代码格式化程序，它以特定的方式为你格式化代码。</li>
<li><a href="https://eslint.org/" target="_blank" rel="noopener">eslint</a>——保持代码整洁；</li>
<li><a href="https://date-fns.org/" target="_blank" rel="noopener">date-fns</a>——moment.js 的轻量级替代品；</li>
<li><a href="https://lodash.com/" target="_blank" rel="noopener">lodash</a>——主要用于 <code>throttle()</code> 和 <code>debounce()</code> 函数；</li>
<li><a href="https://ramdajs.com/" target="_blank" rel="noopener">rambda</a>——如果你真的喜欢函数式编程。</li>
<li><a href="https://www.npmjs.com/package/cross-env" target="_blank" rel="noopener">cross-env</a></li>
<li><a href="https://yarn.bootcss.com/" target="_blank" rel="noopener">Yarn</a>——快速、可靠、安全的依赖管理工具。</li>
<li><a href="https://aui.github.io/art-template/zh-cn/docs/" target="_blank" rel="noopener">art-template</a>——JavaScript 模版引擎</li>
</ul>
<h2 id="文章资源"><a href="#文章资源" class="headerlink" title="文章资源"></a>文章资源</h2><ul>
<li><a href="https://i5ting.github.io/How-to-learn-node-correctly/" target="_blank" rel="noopener">【知乎 Live】狼叔：如何正确的学习 Node.js</a></li>
<li><a href="http://okj45byt5.bkt.clouddn.com/%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BANode.js.pdf" target="_blank" rel="noopener">PDF：深入浅出 Node.js</a></li>
<li><a href="http://nqdeng.github.io/7-days-nodejs/" target="_blank" rel="noopener">阿里云出品：七天学会Node.js</a></li>
<li><a href="https://github.com/atian25/blog/issues/19" target="_blank" rel="noopener">如何挑选高质量的 Node.js 模块</a></li>
<li><a href="https://www.jianshu.com/p/fbf4a7c94e61" target="_blank" rel="noopener">node.js</a> - 基础科普性文章，值得观看⭐️⭐️⭐️</li>
<li><a href="https://github.com/aisuhua/restful-api-design-references" target="_blank" rel="noopener">RESTful API 完整介绍</a></li>
<li><a href="https://github.com/ElemeFE/node-interview/blob/master/sections/zh-cn/process.md" target="_blank" rel="noopener">GitHub: process</a> 与 node.js 进程相关的一篇文章</li>
</ul>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://andy0570.com/2018/10/12/Node.js_使用 mongoose 连接 MongoDB 数据库/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="独木舟的木">
      <meta itemprop="description" content="有时候阳光很好 有时候阳光很暗">
      <meta itemprop="image" content="https://ws1.sinaimg.cn/large/006tNc79gy1g22m14458rj30u014xu0x.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="独木舟的木">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2018/10/12/Node.js_使用 mongoose 连接 MongoDB 数据库/" class="post-title-link" itemprop="url">Node.js_使用 mongoose 连接 MongoDB 数据库</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2018-10-12 15:42:00" itemprop="dateCreated datePublished" datetime="2018-10-12T15:42:00+08:00">2018-10-12</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2019-04-18 11:04:38" itemprop="dateModified" datetime="2019-04-18T11:04:38+08:00">2019-04-18</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Node-js/" itemprop="url" rel="index"><span itemprop="name">Node.js</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          
            <span id="/2018/10/12/Node.js_使用 mongoose 连接 MongoDB 数据库/" class="leancloud_visitors" data-flag-title="Node.js_使用 mongoose 连接 MongoDB 数据库">
              <span class="post-meta-divider">|</span>
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              
                <span class="post-meta-item-text">阅读次数：</span>
              
                <span class="leancloud-visitors-count"></span>
            </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body han-init-context" itemprop="articleBody">

      
      

      
        
          
            <a id="more"></a>
<h2 id="MongoDB-数据库"><a href="#MongoDB-数据库" class="headerlink" title="MongoDB 数据库"></a>MongoDB 数据库</h2><p>MongoDB 的数据逻辑结构：文档（document）、集合（collection）、数据库（database）。</p>
<ul>
<li>文档（document）：由键值对构成，相当于关系数据库中的一行记录。</li>
<li>集合（collection）：多个文档组成一个集合，相当于关系数据库的表。</li>
<li>数据库（database）：多个集合逻辑上组织在一起，就是数据库。</li>
</ul>
<p>一个 MongoDB 实例支持多个数据库（database）。</p>
<p><img src="https://ws3.sinaimg.cn/large/006tNbRwly1fw4gd4brp4j31fw0jc0u7.jpg" alt="MongoDB 数据库结构"></p>
<h2 id="使用-mongoose-连接-MongoDB"><a href="#使用-mongoose-连接-MongoDB" class="headerlink" title="使用 mongoose 连接 MongoDB"></a>使用 <a href="https://github.com/Automattic/mongoose" target="_blank" rel="noopener">mongoose</a> 连接 MongoDB</h2><p>MongoDB 数据库基础：</p>
<ul>
<li>mongoose 中的一切由 <strong>schema</strong>（ˈskēmə） 开始。 <strong>schema</strong> 是一种以文件形式存储的数据库模型骨架，并不具备数据库的操作能力。 </li>
<li><strong>Schema</strong> 定义了 <strong>model</strong> 中的所有属性，而 <strong>model</strong> 则是对应一个 MongoDB 中的 <strong>collection</strong>。</li>
</ul>
<blockquote>
<p><strong>Schema</strong> 生成 <strong>Model</strong>，<strong>Model</strong> 创造 <strong>Entity</strong>，<strong>Model</strong> 和 <strong>Entity</strong> 都可对数据库操作造成影响，但 <strong>Model</strong> 比 <strong>Entity</strong> 更具操作性。</p>
</blockquote>
<h3 id="连接数据库"><a href="#连接数据库" class="headerlink" title="连接数据库"></a>连接数据库</h3><p>连接数据库，实现增、删、改、查操作</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 引入 mongoose 模块</span></span><br><span class="line"><span class="keyword">const</span> mongoose = <span class="built_in">require</span>(<span class="string">'mongoose'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义数据库地址</span></span><br><span class="line"><span class="comment">// uri:mongodb://+[用户名:密码@]+数据库地址[:端口]+数据库名</span></span><br><span class="line"><span class="comment">// uri：mongodb://user:pass@localhost:port/database</span></span><br><span class="line"><span class="keyword">const</span> uri = <span class="string">'mongodb://user:pass@localhost:port/database?authSource=admin'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 连接 mongoDB 数据库</span></span><br><span class="line">mongoose.connect(uri, &#123;<span class="attr">useNewUrlParser</span>: <span class="literal">true</span>&#125;);</span><br><span class="line"><span class="keyword">const</span> db = mongoose.connection;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 将连接绑定到错误事件</span></span><br><span class="line">db.on(<span class="string">'error'</span>, <span class="built_in">console</span>.error.bind(<span class="built_in">console</span>, <span class="string">'MongoDB connection error'</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">// 错误事件，同上</span></span><br><span class="line">db.on(<span class="string">'error'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">error</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.error.bind(<span class="built_in">console</span>, <span class="string">'数据库连接失败：'</span> + error);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 一次打开事件</span></span><br><span class="line">db.once(<span class="string">'open'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'一次打开记录'</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 数据库连接成功</span></span><br><span class="line">db.on(<span class="string">'open'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'数据库连接成功'</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 数据库连接失败</span></span><br><span class="line">db.on(<span class="string">'disconnected'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'数据库连接断开'</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 断开连接</span></span><br><span class="line">mongoose.disconnect();</span><br></pre></td></tr></table></figure>
<h3 id="Schema"><a href="#Schema" class="headerlink" title="Schema"></a>Schema</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 定义 Schema</span></span><br><span class="line"><span class="keyword">const</span> Schema = mongoose.Schema;</span><br><span class="line"><span class="comment">// 使用 Schema 构造函数，创建一个新的 Schema 实例</span></span><br><span class="line"><span class="comment">// 实例化 mongoose.Schema 对象并定义 Model 的属性</span></span><br><span class="line"><span class="keyword">const</span> ArticleScheme = <span class="keyword">new</span> Schema(&#123;</span><br><span class="line">    title: <span class="built_in">String</span>,</span><br><span class="line">    author: <span class="built_in">String</span>,</span><br><span class="line">    content: <span class="built_in">String</span>,</span><br><span class="line">    publishTime: <span class="built_in">Date</span></span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// 将 Schema 注册成 Model</span></span><br><span class="line">mongoose.model(<span class="string">'Article'</span>, ArticleScheme);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 如果 Model成功注册，就可以通过如下方式访问模型</span></span><br><span class="line"><span class="keyword">const</span> ArticleModel = mongoose.model(<span class="string">'Article'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 通过 Model 定义 Entity</span></span><br><span class="line"><span class="keyword">var</span> ArticleEntity = <span class="keyword">new</span> ArticleModel(&#123;</span><br><span class="line">    title: <span class="string">'node.js'</span>,</span><br><span class="line">    author: <span class="string">'node'</span>,</span><br><span class="line">    content: <span class="string">'node.js is great!'</span>,</span><br><span class="line">    publishTime: <span class="keyword">new</span> <span class="built_in">Date</span>()</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 【将文档插入到集合中】</span></span><br><span class="line">ArticleEntity.save(<span class="function"><span class="keyword">function</span>(<span class="params">err</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (err) &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'save failed '</span> + err);</span><br><span class="line">    &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'save successed'</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 【查询】</span></span><br><span class="line"><span class="comment">// find() 方法，查询所有符合要求的数据</span></span><br><span class="line"><span class="comment">// findOne() 方法，查询符号要求的第一条数据</span></span><br><span class="line">ArticleModel.find(&#123;<span class="attr">title</span>:<span class="string">'node.js'</span>&#125;, <span class="function"><span class="keyword">function</span>(<span class="params">err, docs</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (err) &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'error'</span>);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'result: '</span> + docs); <span class="comment">// 打印实体</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 【查询纪录后，修改记录的值】</span></span><br><span class="line">    docs[<span class="number">0</span>].title = <span class="string">'javascript'</span>; <span class="comment">// 修改数据</span></span><br><span class="line">    docs[<span class="number">0</span>].save(); <span class="comment">// 保存修改后的数据</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 【删除数据】</span></span><br><span class="line">    <span class="keyword">if</span> (docs) &#123;</span><br><span class="line">        <span class="comment">// 遍历文档，逐条删除</span></span><br><span class="line">        docs.forEach(<span class="function"><span class="keyword">function</span>(<span class="params">ele</span>) </span>&#123;</span><br><span class="line">            <span class="comment">// 只有单个文档可以使用 remove() 方法</span></span><br><span class="line">            ele.remove();</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>可以将 Model 提取成单独的一个类：</p>
<blockquote>
<p>💡</p>
<p>强烈建议在每个模型模块（文件）中，定义每个模型纲要，导出方法以创建模型。</p>
</blockquote>
<h4 id="article-js"><a href="#article-js" class="headerlink" title="article.js"></a>article.js</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 导入 mongoose 模块</span></span><br><span class="line"><span class="keyword">const</span> mongoose = <span class="built_in">require</span>(<span class="string">'mongoose'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义 Schema</span></span><br><span class="line"><span class="keyword">const</span> Schema = mongoose.Schema;</span><br><span class="line"><span class="keyword">const</span> ObjectId = Schema.ObjectId; <span class="comment">// 主键</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> ArticleSchema = <span class="keyword">new</span> Schema(&#123;</span><br><span class="line">    id: ObjectId,</span><br><span class="line">    title: &#123;<span class="attr">type</span>: <span class="built_in">String</span>, <span class="attr">required</span>: <span class="literal">true</span>, <span class="attr">max</span>: <span class="number">100</span>&#125;,</span><br><span class="line">    name: &#123;<span class="attr">type</span>: <span class="built_in">String</span>, <span class="attr">required</span>: <span class="literal">true</span>, <span class="attr">max</span>: <span class="number">100</span>&#125;,</span><br><span class="line">    date: &#123;<span class="attr">type</span>: date&#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 导出模型</span></span><br><span class="line"><span class="built_in">module</span>.exports = mongoose.model(<span class="string">'Article'</span>, ArticleSchema);</span><br></pre></td></tr></table></figure>
<h4 id="farmers-js"><a href="#farmers-js" class="headerlink" title="farmers.js"></a>farmers.js</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> mongoose = <span class="built_in">require</span>(<span class="string">'mongoose'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义 Schema</span></span><br><span class="line"><span class="keyword">const</span> Schema = mongoose.Schema;</span><br><span class="line"><span class="keyword">const</span> FarmerSchema = <span class="keyword">new</span> Schema(&#123;</span><br><span class="line">  uuid: &#123; <span class="attr">type</span>: <span class="built_in">String</span>, <span class="attr">required</span>: <span class="literal">true</span> &#125;,</span><br><span class="line">  name: &#123; <span class="attr">type</span>: <span class="built_in">String</span>, <span class="attr">required</span>: <span class="literal">true</span> &#125;,</span><br><span class="line">  id_number: &#123; <span class="attr">type</span>: <span class="built_in">String</span>, <span class="attr">required</span>: <span class="literal">true</span> &#125;,</span><br><span class="line">  phone: &#123; <span class="attr">type</span>: <span class="built_in">String</span>, <span class="attr">required</span>: <span class="literal">true</span> &#125;,</span><br><span class="line">  public_key: &#123; <span class="attr">type</span>: <span class="built_in">String</span>, <span class="attr">required</span>: <span class="literal">true</span> &#125;,</span><br><span class="line">  private_key: &#123; <span class="attr">type</span>: <span class="built_in">String</span>, <span class="attr">required</span>: <span class="literal">true</span> &#125;,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 导出模型</span></span><br><span class="line"><span class="built_in">module</span>.exports = mongoose.model(<span class="string">'Farmer'</span>, FarmerSchema);</span><br><span class="line"></span><br><span class="line"><span class="comment">// --------</span></span><br><span class="line"><span class="comment">// 引入并使用</span></span><br><span class="line"><span class="keyword">const</span> FarmerModel = <span class="built_in">require</span>(<span class="string">'../model/farmers'</span>);</span><br></pre></td></tr></table></figure>
<h3 id="增（Create）"><a href="#增（Create）" class="headerlink" title="增（Create）"></a>增（Create）</h3><p>通常所说的 CRUD 就是数据库的增（Create）删（Delete）查（Read）改（Update）。</p>
<blockquote>
<p><code>Model.create()</code></p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> doc = (&#123;</span><br><span class="line">  uuid: <span class="string">'1234567890'</span>,</span><br><span class="line">  name: <span class="string">'张三'</span>,</span><br><span class="line">  id_number: <span class="string">'320321201810104321'</span>,</span><br><span class="line">  phone: <span class="string">'15812345678'</span>,</span><br><span class="line">  public_key: <span class="string">'publickey'</span>,</span><br><span class="line">  private_key: <span class="string">'privatekey'</span>,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">FarmerModel.create(doc, <span class="function"><span class="keyword">function</span>(<span class="params">err, docs</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (err) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'create error: '</span> + err);</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'create success:\n '</span> + docs);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<blockquote>
<p>Entity.save()</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 通过 Model 定义 Entity</span></span><br><span class="line"><span class="keyword">const</span> FarmerEntity = <span class="keyword">new</span> FarmerModel(&#123;</span><br><span class="line">  uuid: <span class="string">'2234567890'</span>,</span><br><span class="line">  name: <span class="string">'李四'</span>,</span><br><span class="line">  id_number: <span class="string">'320321201810104322'</span>,</span><br><span class="line">  phone: <span class="string">'15912345678'</span>,</span><br><span class="line">  public_key: <span class="string">'publickey_1'</span>,</span><br><span class="line">  private_key: <span class="string">'privatekey_1'</span>,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 将 Entity 保存到数据库</span></span><br><span class="line">FarmerEntity.save(<span class="function"><span class="keyword">function</span>(<span class="params">err, docs</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (err) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'create error: '</span> + err);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'create success:\n '</span> + docs);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<blockquote>
<p><code>Model.insertMany()</code>，一次插入多个值</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// insertMany()</span></span><br><span class="line">FarmerModel.insertMany([&#123;</span><br><span class="line">  uuid: <span class="string">'12345'</span>,</span><br><span class="line">  name: <span class="string">'王五'</span>,</span><br><span class="line">  id_number: <span class="string">'123456'</span>,</span><br><span class="line">  phone: <span class="string">'123456'</span>,</span><br><span class="line">  public_key: <span class="string">'12345'</span>,</span><br><span class="line">  private_key: <span class="string">'12345'</span>,</span><br><span class="line">&#125;, &#123;</span><br><span class="line">  uuid: <span class="string">'12345'</span>,</span><br><span class="line">  name: <span class="string">'赵六'</span>,</span><br><span class="line">  id_number: <span class="string">'123456'</span>,</span><br><span class="line">  phone: <span class="string">'123456'</span>,</span><br><span class="line">  public_key: <span class="string">'12345'</span>,</span><br><span class="line">  private_key: <span class="string">'12345'</span>,</span><br><span class="line">&#125;], <span class="function"><span class="keyword">function</span>(<span class="params">err, docs</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (err) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'create error: '</span> + err);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'create success:\n '</span> + docs);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h3 id="查（Read）"><a href="#查（Read）" class="headerlink" title="查（Read）"></a>查（Read）</h3><blockquote>
<p><code>Model.find()</code>，查询所有符合要求的数据</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">FarmerModel.find(&#123; <span class="attr">name</span>: <span class="string">'张三'</span> &#125;, <span class="function"><span class="keyword">function</span>(<span class="params">err, docs</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (err) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'查询错误'</span> + err);</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'打印实体：result: '</span> + docs);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 从集合/表中按照 uuid 键值对查找文档（document）</span></span><br><span class="line">db.getCollection(<span class="string">'NaturalPersonInfo'</span>).find(&#123;<span class="attr">uuid</span>:<span class="string">'8a033c7f20ea2bdea3c4b9d60d42f11e'</span>&#125;)</span><br></pre></td></tr></table></figure>
<blockquote>
<p><code>Model.findOne()</code>，查询符号要求的第一条数据</p>
</blockquote>
<blockquote>
<p><code>Model.findById()</code></p>
</blockquote>
<h3 id="改（Update）"><a href="#改（Update）" class="headerlink" title="改（Update）"></a>改（Update）</h3><blockquote>
<p><code>Model.update()</code></p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Model.update()</span></span><br><span class="line"><span class="comment">// 查询 uuid 为 2234567890 的实体，将他的名字改为张团团，允许更新多条查询记录</span></span><br><span class="line">FarmerModel.update(&#123; <span class="attr">uuid</span>: <span class="string">'2234567890'</span> &#125;, &#123; <span class="attr">name</span>: <span class="string">'张团团'</span> &#125;, &#123; <span class="attr">multi</span>: <span class="literal">true</span> &#125;, <span class="function"><span class="keyword">function</span>(<span class="params">err, docs</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (err) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'更新错误'</span> + err);</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'更新后的实体：result: '</span> + docs);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<blockquote>
<p><code>Model.updateMany()</code>，一次更新多条数据。</p>
<p><code>Model.updateOne()</code>，一次更新一条数据。</p>
<p><code>Model.findByIdAndyUpdate()</code>，</p>
<p><code>Model.findOneAndUpdate()</code></p>
</blockquote>
<h3 id="删（Delete）"><a href="#删（Delete）" class="headerlink" title="删（Delete）"></a>删（Delete）</h3><blockquote>
<p><code>Model.remove()</code>，删除</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">FarmerModel.remove(&#123; <span class="attr">uuid</span>: <span class="string">'1234567890'</span> &#125;, <span class="function"><span class="keyword">function</span>(<span class="params">err, docs</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (err) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'查询错误'</span> + err);</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'删除成功'</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<blockquote>
<p><code>Model.findByIdAndRemove()</code></p>
<p><code>Model.findOneAndRemove()</code></p>
</blockquote>
<h2 id="常见错误"><a href="#常见错误" class="headerlink" title="常见错误"></a>常见错误</h2><h3 id="1-连接-MongdDB-数据库时提示字符串参数失效"><a href="#1-连接-MongdDB-数据库时提示字符串参数失效" class="headerlink" title="1. 连接 MongdDB 数据库时提示字符串参数失效"></a>1. 连接 MongdDB 数据库时提示字符串参数失效</h3><p>示例代码：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 连接 mongoDB 数据库</span></span><br><span class="line">mongoose.connect(uri, <span class="function"><span class="keyword">function</span>(<span class="params">err</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (err) &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'connect failed'</span> + err);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'connect success'</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>错误提示内容：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DeprecationWarning: current URL string parser is deprecated, and will be removed in a future version. To use the new parser, pass option &#123; useNewUrlParser: true &#125; to MongoClient.connect.</span><br></pre></td></tr></table></figure>
<p>解决方法：连接时传递参数：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 连接 mongoDB 数据库</span></span><br><span class="line">mongoose.connect(uri, &#123;<span class="attr">useNewUrlParser</span>: <span class="literal">true</span>&#125;); <span class="comment">// &lt;——</span></span><br><span class="line"><span class="keyword">const</span> db = mongoose.connection;</span><br><span class="line"><span class="comment">// 将连接绑定到错误事件</span></span><br><span class="line">db.on(<span class="string">'error'</span>, <span class="built_in">console</span>.error.bind(<span class="built_in">console</span>, <span class="string">'MongoDB connection error'</span>));</span><br></pre></td></tr></table></figure>
<h3 id="2-连接-MongoDB-数据库时授权失败，提示：errmsg-‘Authentication-failed-’-code-18"><a href="#2-连接-MongoDB-数据库时授权失败，提示：errmsg-‘Authentication-failed-’-code-18" class="headerlink" title="2. 连接 MongoDB 数据库时授权失败，提示：errmsg: ‘Authentication failed.’,  code: 18"></a>2. 连接 MongoDB 数据库时授权失败，提示：<strong>errmsg: ‘Authentication failed.’,  code: 18</strong></h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// uri 后面添加 authDatabase 参数</span></span><br><span class="line">mongoose.connect(<span class="string">'mongodb://user:password@host:port/dbname?authSource=admin'</span>)</span><br></pre></td></tr></table></figure>
<p>解决参考：<a href="https://stackoverflow.com/questions/31398367/authentication-in-mongoose-using-scram-sha-1" target="_blank" rel="noopener">Authentication in mongoose using SCRAM-SHA-1</a></p>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><ul>
<li>开源框架：<a href="https://mongodb.github.io/node-mongodb-native/" target="_blank" rel="noopener">node-mongode-native</a></li>
<li>开源框架：<a href="https://github.com/Automattic/mongoose" target="_blank" rel="noopener">mongoose</a></li>
<li>开源框架：<a href="https://github.com/eggjs/egg-mongoose" target="_blank" rel="noopener">egg-mongoose</a></li>
<li><a href="https://mongoosejs.com/" target="_blank" rel="noopener">mongoose 官网|Doc</a></li>
<li><a href="https://developer.mozilla.org/zh-CN/docs/learn/Server-side/Express_Nodejs/mongoose" target="_blank" rel="noopener">Express 教程 3: 使用数据库 (Mongoose)</a></li>
<li><a href="https://cnodejs.org/topic/504b4924e2b84515770103dd" target="_blank" rel="noopener">CNode：Mongoose 学习参考文档——基础篇</a> ⭐️⭐️⭐️</li>
<li><a href="https://segmentfault.com/a/1190000008245062#articleHeader13" target="_blank" rel="noopener">Mongoose 增查改删学习笔记</a> ⭐️⭐️⭐️</li>
<li><a href="https://segmentfault.com/a/1190000009492647" target="_blank" rel="noopener">Node 学习记录: mongodb</a></li>
</ul>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/5/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/5/">5</a><span class="page-number current">6</span><a class="page-number" href="/page/7/">7</a><span class="space">&hellip;</span><a class="page-number" href="/page/32/">32</a><a class="extend next" rel="next" href="/page/7/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <div class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image" src="https://ws1.sinaimg.cn/large/006tNc79gy1g22m14458rj30u014xu0x.jpg" alt="独木舟的木">
            
              <p class="site-author-name" itemprop="name">独木舟的木</p>
              <div class="site-description motion-element" itemprop="description">有时候阳光很好 有时候阳光很暗</div>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/">
                
                    <span class="site-state-item-count">314</span>
                    <span class="site-state-item-name">日志</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-categories">
                  
                    
                      <a href="/categories/">
                    
                  
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">14</span>
                    <span class="site-state-item-name">分类</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-tags">
                  
                    
                      <a href="/tags/">
                    
                  
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">38</span>
                    <span class="site-state-item-name">标签</span>
                  </a>
                </div>
              
            </nav>
          

          
            <div class="feed-link motion-element">
              <a href="/atom.xml" rel="alternate">
                <i class="fa fa-rss"></i>
                RSS
              </a>
            </div>
          

          

          
            <div class="links-of-author motion-element">
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                    
                  
                  <a href="https://github.com/Andy0570" title="GitHub &rarr; https://github.com/Andy0570" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i>GitHub</a>
                </span>
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                    
                  
                  <a href="mailto:andywhm@163.com" title="E-Mail &rarr; mailto:andywhm@163.com" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                </span>
              
            </div>
          

          
             <div class="cc-license motion-element" itemprop="license">
              
              
                
              
              
              
              <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" class="cc-opacity" rel="noopener" target="_blank"><img src="/images/cc-by-nc-sa.svg" alt="Creative Commons"></a>
             </div>
          

          
          

          
            
          
          

        </div>
      </div>

      

      

    </div>
  </aside>
  


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">独木舟的木</span>

  

  
</div>


  <div class="powered-by">由 <a href="https://hexo.io" class="theme-link" rel="noopener" target="_blank">Hexo</a> 强力驱动 v3.8.0</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 – <a href="https://theme-next.org" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> v7.1.0</div>




        








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

    

    
  </div>

  

<script>
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>





  



  






  



  
    
    
      
    
  
  <script color="17,119,176" opacity="0.5" zindex="-1" count="99" src="//cdn.jsdelivr.net/gh/theme-next/theme-next-canvas-nest@1/canvas-nest.min.js"></script>













  
  <script src="//cdn.jsdelivr.net/npm/jquery@2/dist/jquery.min.js"></script>

  
  <script src="//cdn.jsdelivr.net/npm/fastclick@1/lib/fastclick.min.js"></script>

  
  <script src="//cdn.jsdelivr.net/npm/jquery-lazyload@1/jquery.lazyload.min.js"></script>

  
  <script src="//cdn.jsdelivr.net/npm/velocity-animate@1/velocity.min.js"></script>

  
  <script src="//cdn.jsdelivr.net/npm/velocity-animate@1/velocity.ui.min.js"></script>

  
  <script src="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.js"></script>


  


  <script src="/js/utils.js?v=7.1.0"></script>

  <script src="/js/motion.js?v=7.1.0"></script>



  
  


  <script src="/js/affix.js?v=7.1.0"></script>

  <script src="/js/schemes/pisces.js?v=7.1.0"></script>




  

  


  <script src="/js/next-boot.js?v=7.1.0"></script>


  

  

  
  
  
    
  

  
    
      
    
  

  
  
  
    <script src="//cdn.jsdelivr.net/npm/quicklink@1/dist/quicklink.umd.js"></script>
    <script>
      
        window.addEventListener('load', () => {
      
        quicklink({
          timeout: 3000,
          priority: true,
          ignores: [uri => uri.includes('#'),uri => uri == 'https://andy0570.com/page/6/',]
        });
      
        });
      
    </script>
  


  



  



  
  
  
    
  
  <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/instantsearch.js@2/dist/instantsearch.min.css">

  
  
    
  
  <script src="//cdn.jsdelivr.net/npm/instantsearch.js@2/dist/instantsearch.js"></script>
  

  <script src="/js/algolia-search.js?v=7.1.0"></script>



  
  
  <script>
    
    function showTime(Counter) {
      var entries = [];
      var $visitors = $('.leancloud_visitors');

      $visitors.each(function() {
        entries.push( $(this).attr('id').trim() );
      });

      Counter('get', '/classes/Counter', { where: JSON.stringify({ url: { '$in': entries } }) })
        .done(function({ results }) {
          var COUNT_CONTAINER_REF = '.leancloud-visitors-count';

          if (results.length === 0) {
            $visitors.find(COUNT_CONTAINER_REF).text(0);
            return;
          }

          for (var i = 0; i < results.length; i++) {
            var item = results[i];
            var url = item.url;
            var time = item.time;
            var element = document.getElementById(url);

            $(element).find(COUNT_CONTAINER_REF).text(time);
          }
          for (var i = 0; i < entries.length; i++) {
            var url = entries[i];
            var element = document.getElementById(url);
            var countSpan = $(element).find(COUNT_CONTAINER_REF);
            if (countSpan.text() == '') {
              countSpan.text(0);
            }
          }
        })
        .fail(function ({ responseJSON }) {
          console.log('LeanCloud Counter Error: ' + responseJSON.code + ' ' + responseJSON.error);
        });
    }
    

    $(function() {
      $.get('https://app-router.leancloud.cn/2/route?appId=' + 'S7i1Y8YorMKFPaYbJbekD5el-gzGzoHsz')
        .done(function({ api_server }) {
          var Counter = function(method, url, data) {
            return $.ajax({
              method: method,
              url: 'https://' + api_server + '/1.1' + url,
              headers: {
                'X-LC-Id': 'S7i1Y8YorMKFPaYbJbekD5el-gzGzoHsz',
                'X-LC-Key': 'brOnU8mOQvSjpipJvdKUAIbU',
                'Content-Type': 'application/json',
              },
              data: data
            });
          };
          
            if ($('.post-title-link').length >= 1) {
              showTime(Counter);
            }
          
        });
    });
  </script>



  

  

  

  

  

  

  

  

  
  
  
    
  
  <script src="//cdn.jsdelivr.net/npm/pangu@4/dist/browser/pangu.min.js"></script>
  <script>pangu.spacingPage();</script>


  
  
  
    
  
  <script src="//cdn.jsdelivr.net/gh/theme-next/theme-next-bookmark@1/bookmark.min.js"></script>
  <script>
  
    bookmark.loadBookmark();
  
  </script>


  

  

  


  <!-- red heart -->
  <script type="text/javascript" src="/js/src/love.js"></script>
  
</body>
</html>
