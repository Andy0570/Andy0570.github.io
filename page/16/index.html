<!DOCTYPE html>













<html class="theme-next gemini" lang="zh-CN">
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">




  
  
    
      
    
    
      
    
  <script src="//cdn.jsdelivr.net/npm/pace-js@1/pace.min.js"></script>
  <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/pace-js@1/themes/blue/pace-theme-minimal.css">



  
  
    
  
  <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/han-css@3/dist/han.min.css">













  
  
    
  
  <link rel="stylesheet" href="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.css">







  

<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/font-awesome@4/css/font-awesome.min.css">

<link rel="stylesheet" href="/css/main.css?v=7.1.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/panda/apple-touch-icon.png?v=7.1.0">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/panda/favicon-32x32.png?v=7.1.0">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/panda/favicon-16x16.png?v=7.1.0">


  <link rel="mask-icon" href="/images/panda/safari-pinned-tab.svg?v=7.1.0" color="#222">


  <link rel="manifest" href="/images/panda/site.webmanifest">


  <meta name="msapplication-config" content="/images/panda/browserconfig.xml">





<script id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '7.1.0',
    sidebar: {"position":"left","display":"post","offset":12,"onmobile":false,"dimmer":false},
    back2top: true,
    back2top_sidebar: false,
    fancybox: true,
    fastclick: true,
    lazyload: true,
    tabs: true,
    motion: {"enable":false,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '0E2AON8EZF',
      apiKey: '22fbefd84c8343239f5c04365b9728de',
      indexName: 'MyBlogPlatform',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  <meta name="description" content="有时候阳光很好 有时候阳光很暗">
<meta name="keywords" content="独木舟的木">
<meta property="og:type" content="website">
<meta property="og:title" content="独木舟的木">
<meta property="og:url" content="https://andy0570.com/page/16/index.html">
<meta property="og:site_name" content="独木舟的木">
<meta property="og:description" content="有时候阳光很好 有时候阳光很暗">
<meta property="og:locale" content="zh-CN">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="独木舟的木">
<meta name="twitter:description" content="有时候阳光很好 有时候阳光很暗">



  <link rel="alternate" href="/atom.xml" title="独木舟的木" type="application/atom+xml">



  
  
  <link rel="canonical" href="https://andy0570.com/page/16/">



<script id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>独木舟的木</title>
  






  <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?8229a094facca297f211d61323fd9fde";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>







  <noscript>
  <style>
  .use-motion .motion-element,
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-title { opacity: initial; }

  .use-motion .logo,
  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-CN">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <a href="https://github.com/andy0570" class="github-corner" aria-label="View source on GitHub"><svg width="80" height="80" viewbox="0 0 250 250" style="fill:#151513; color:#fff; position: absolute; top: 0; border: 0; right: 0;" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"/><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"/><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"/></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style>
    
    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">独木舟的木</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
      
        <p class="site-subtitle">iOS Developer</p>
      
    
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="切换导航栏">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home">

    
    
    
      
    

    
      
    

    <a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i> <br>首页</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-categories">

    
    
    
      
    

    
      
    

    <a href="/categories/" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i> <br>分类<span class="badge">14</span></a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-tags">

    
    
    
      
    

    
      
    

    <a href="/tags/" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i> <br>标签<span class="badge">38</span></a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">

    
    
    
      
    

    
      
    

    <a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i> <br>归档<span class="badge">315</span></a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-about">

    
    
    
      
    

    
      
    

    <a href="/about/" rel="section"><i class="menu-item-icon fa fa-fw fa-user"></i> <br>关于</a>

  </li>

      
      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br>搜索</a>
        </li>
      
    </ul>
  

  

  
    <div class="site-search">
      
  
  <div class="algolia-popup popup search-popup">
    <div class="algolia-search">
      <div class="algolia-search-input-icon">
        <i class="fa fa-search"></i>
      </div>
      <div class="algolia-search-input" id="algolia-search-input"></div>
    </div>

    <div class="algolia-results">
      <div id="algolia-stats"></div>
      <div id="algolia-hits"></div>
      <div id="algolia-pagination" class="algolia-pagination"></div>
    </div>

    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
  </div>




    </div>
  
</nav>



  



</div>
    </header>

    
  
  

  

  <a href="https://github.com/andy0570" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewbox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"/><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"/><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"/></svg></a>



    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
            

          
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://andy0570.com/2017/09/12/天天品尝iOS7甜点 Day10：Custom UIViewController Transitions/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="独木舟的木">
      <meta itemprop="description" content="有时候阳光很好 有时候阳光很暗">
      <meta itemprop="image" content="https://blog-andy0570-1256077835.cos.ap-shanghai.myqcloud.com/site_Images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="独木舟的木">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2017/09/12/天天品尝iOS7甜点 Day10：Custom UIViewController Transitions/" class="post-title-link" itemprop="url">天天品尝iOS7甜点 Day10：Custom UIViewController Transitions</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2017-09-12 17:42:00" itemprop="dateCreated datePublished" datetime="2017-09-12T17:42:00+08:00">2017-09-12</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2019-05-01 21:20:24" itemprop="dateModified" datetime="2019-05-01T21:20:24+08:00">2019-05-01</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/iOS/" itemprop="url" rel="index"><span itemprop="name">iOS</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          

          

          
            <div class="post-symbolscount">
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">本文字数：</span>
                
                <span title="本文字数">4.3k</span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">4 分钟</span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body han-init-context" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>自定义视图控制器转场</p>
</blockquote>
<h3>参考</h3>
<ul>
<li><a href="https://github.com/ShinobiControls/iOS7-day-by-day" target="_blank" rel="noopener">GitHub 源码：shinobicontrols/iOS7-day-by-day</a></li>
<li><a href="http://blog.kingiol.com/2014/01/12/ios7-day-by-day-day10-custom-uiviewcontroller-transitions/" target="_blank" rel="noopener">天天品尝iOS7甜点 :: Day 10 :: Custom UIViewController Transitions</a></li>
</ul>
<p>&lt;!-- more --&gt;</p>
<h3>转场效果</h3>
<p>默认的 <strong>UINavigationController</strong> 转场 push/pop 是这样的：</p>
<p><img src="https://blog-andy0570-1256077835.cos.ap-shanghai.myqcloud.com/site_Images/071744.gif" alt></p>
<p>现在我们要实现自定义实现视图控制器转场效果：</p>
<p><img src="https://blog-andy0570-1256077835.cos.ap-shanghai.myqcloud.com/site_Images/071747.gif" alt></p>
<h3>视图层次结构</h3>
<p>视图层次结构很简单：一个 UINavigationController 作为窗口的根视图控制器、而首页是 UINavigationController 的根视图控制器、首页可以 push 到第二页：</p>
<p><img src="https://blog-andy0570-1256077835.cos.ap-shanghai.myqcloud.com/site_Images/071752.jpg" alt></p>
<h4>要想实现自定义视图控制器转场效果，需要实现 <code>UINavigationControllerDelegate</code> 协议。</h4>
<p>在 <strong>UINavigationController</strong> 实例对象中声明某个类（<code>HQLNavControllerDelegate</code>）实现了<code>UINavigationControllerDelegate</code> 协议：</p>
<p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">#import &quot;HQLNavigationController.h&quot;</span><br><span class="line">#import &quot;HQLNavControllerDelegate.h&quot;</span><br><span class="line"></span><br><span class="line">@interface HQLNavigationController () &#123;</span><br><span class="line">    id&lt;UINavigationControllerDelegate&gt; _navDelegate;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@end</span><br><span class="line"></span><br><span class="line">@implementation HQLNavigationController</span><br><span class="line"></span><br><span class="line">- (instancetype)initWithCoder:(NSCoder *)aDecoder &#123;</span><br><span class="line">    self = [super initWithCoder:aDecoder];</span><br><span class="line">    if (self) &#123;</span><br><span class="line">        _navDelegate = [HQLNavControllerDelegate new];</span><br><span class="line">        self.delegate = _navDelegate;</span><br><span class="line">    &#125;</span><br><span class="line">    return self;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h4>上面代码中把实现转场效果的协议方法封装成了一个类<code>HQLNavControllerDelegate</code>：</h4>
<p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">// ****************************************************</span><br><span class="line">//  HQLNavControllerDelegate.h</span><br><span class="line">#import &lt;Foundation/Foundation.h&gt;</span><br><span class="line">#import &lt;UIKit/UIKit.h&gt;</span><br><span class="line"></span><br><span class="line">@interface HQLNavControllerDelegate : NSObject &lt;UINavigationControllerDelegate&gt;</span><br><span class="line"></span><br><span class="line">@end</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">// ****************************************************</span><br><span class="line">//  HQLNavControllerDelegate.m</span><br><span class="line">#import &quot;HQLNavControllerDelegate.h&quot;</span><br><span class="line">#import &quot;HQLFadeTransition.h&quot;</span><br><span class="line"></span><br><span class="line">@implementation HQLNavControllerDelegate</span><br><span class="line"></span><br><span class="line">- (nullable id &lt;UIViewControllerAnimatedTransitioning&gt;)navigationController:(UINavigationController *)navigationController</span><br><span class="line">                                            animationControllerForOperation:(UINavigationControllerOperation)operation</span><br><span class="line">                                                         fromViewController:(UIViewController *)fromVC</span><br><span class="line">                                                           toViewController:(UIViewController *)toVC&#123;</span><br><span class="line">    return [HQLFadeTransition new];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@end</span><br></pre></td></tr></table></figure></p>
<h4>而在 <code>HQLNavControllerDelegate</code> 类中又把实现自定义转场效果的转场动画封装成了一个类 <code>HQLFadeTransition</code></h4>
<p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line">// ****************************************************</span><br><span class="line">//  HQLFadeTransition.h</span><br><span class="line">#import &lt;Foundation/Foundation.h&gt;</span><br><span class="line">#import &lt;UIKit/UIKit.h&gt;</span><br><span class="line"></span><br><span class="line">@interface HQLFadeTransition : NSObject &lt;UIViewControllerAnimatedTransitioning&gt;</span><br><span class="line"></span><br><span class="line">@end</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line">// ****************************************************</span><br><span class="line">//  HQLFadeTransition.m</span><br><span class="line">#import &quot;HQLFadeTransition.h&quot;</span><br><span class="line"></span><br><span class="line">@implementation HQLFadeTransition</span><br><span class="line"></span><br><span class="line">// @required 方法：返回动画的时长</span><br><span class="line">- (NSTimeInterval)transitionDuration:(id&lt;UIViewControllerContextTransitioning&gt;)transitionContext &#123;</span><br><span class="line">    return 2.0;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// @required 方法：实现视图控制器之间的转场效果</span><br><span class="line">- (void)animateTransition:(id&lt;UIViewControllerContextTransitioning&gt;)transitionContext &#123;</span><br><span class="line">    </span><br><span class="line">    // 1️⃣ viewControllerForKey:获取与转场相关的两个视图控制器</span><br><span class="line">    // UITransitionContextFromViewControllerKey</span><br><span class="line">    UIViewController *fromVC = [transitionContext viewControllerForKey:UITransitionContextFromViewControllerKey];</span><br><span class="line">    // UITransitionContextToViewControllerKey</span><br><span class="line">    UIViewController *toVC = [transitionContext viewControllerForKey:UITransitionContextToViewControllerKey];</span><br><span class="line">    </span><br><span class="line">    // 2️⃣ containerView - 动画发生的容器视图</span><br><span class="line">    UIView *containerView = [transitionContext containerView];</span><br><span class="line">    </span><br><span class="line">    // 3️⃣ 将两个视图控制器的子视图添加到容器视图</span><br><span class="line">    [containerView addSubview:fromVC.view];</span><br><span class="line">    [containerView addSubview:toVC.view];</span><br><span class="line">    // 4️⃣ 将要转换到的那个视图设置为透明</span><br><span class="line">    toVC.view.alpha = 0.0;</span><br><span class="line">    </span><br><span class="line">    // 5️⃣ 执行动画</span><br><span class="line">    [UIView animateWithDuration:[self transitionDuration:transitionContext]</span><br><span class="line">                          delay:0</span><br><span class="line">                        options:0</span><br><span class="line">                     animations:^&#123;</span><br><span class="line">                         // 动画效果</span><br><span class="line">                         toVC.view.alpha = 1.f;</span><br><span class="line">                     &#125;</span><br><span class="line">                     completion:^(BOOL finished) &#123;</span><br><span class="line">                         // 移除旧视图控制器视图</span><br><span class="line">                         [fromVC.view removeFromSuperview];</span><br><span class="line">                         // 告诉 transitionContext 上下文，动画完成啦!</span><br><span class="line">                         [transitionContext completeTransition:YES];</span><br><span class="line">                     &#125;];</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 转换完成后调用</span><br><span class="line">- (void)animationEnded:(BOOL) transitionCompleted &#123;</span><br><span class="line">    NSLog(@&quot;Transition Completed!&quot;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@end</span><br></pre></td></tr></table></figure></p>
<blockquote>
<p>The end.</p>
</blockquote>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://andy0570.com/2017/09/12/天天品尝iOS7甜点 Day9：Device Identification/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="独木舟的木">
      <meta itemprop="description" content="有时候阳光很好 有时候阳光很暗">
      <meta itemprop="image" content="https://blog-andy0570-1256077835.cos.ap-shanghai.myqcloud.com/site_Images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="独木舟的木">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2017/09/12/天天品尝iOS7甜点 Day9：Device Identification/" class="post-title-link" itemprop="url">天天品尝iOS7甜点 Day9：Device Identification</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2017-09-12 10:24:00" itemprop="dateCreated datePublished" datetime="2017-09-12T10:24:00+08:00">2017-09-12</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2019-05-01 21:20:14" itemprop="dateModified" datetime="2019-05-01T21:20:14+08:00">2019-05-01</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/iOS/" itemprop="url" rel="index"><span itemprop="name">iOS</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          

          

          
            <div class="post-symbolscount">
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">本文字数：</span>
                
                <span title="本文字数">3.7k</span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">3 分钟</span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body han-init-context" itemprop="articleBody">

      
      

      
        
          
            <h3>参考</h3>
<ul>
<li><a href="https://github.com/ShinobiControls/iOS7-day-by-day" target="_blank" rel="noopener">GitHub 源码：shinobicontrols/iOS7-day-by-day</a></li>
<li><a href="http://blog.kingiol.com/2014/01/10/ios7-day-by-day-day9-device-identification/" target="_blank" rel="noopener">天天品尝iOS7甜点 :: Day 9 :: Device Identification</a></li>
</ul>
<h3>Vendor Identification</h3>
<p><code>UIDevice</code>中的<code>identifierForVendor</code>方法是最接近替代<code>uniqueIdentifier</code>的另外一个方法，它返回<code>NSUUID</code>。在相同的设备中相同供应商的app共享一个UUID。不同的供应商在同一个设备上面将会返回不同的<code>identifierForVendor</code>值，就像相同供应商在不同设备上面一样。</p>
<p>对于开发者来说，这个值提供了和原来相似的功能，而且没有用户隐私的问题。</p>
<p>但是美中不足的是<strong>如果用卸载了供应商下面所有的app，这个id就会被销毁，重新安装之后就会生成一个新的供应商ID。</strong></p>
<p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">NSString *identifeir = [[[UIDevice currentDevice] identifierForVendor] UUIDString];</span><br></pre></td></tr></table></figure></p>
<p>&lt;!-- more --&gt;</p>
<h3>Advertising Identification</h3>
<p><code>ADSupprt</code>模块包含了<code>ASIdentifierManager</code>类，它有一个<code>advertisingIdentifier</code>方法。它返回一个<code>NSUUID</code>可以用来达到追踪广告的目的。</p>
<p>还有一个方法<code>avertisingTrackingEnable</code>.它返回一个BOOL类型的数据用来指定是否用户允许进行广告追踪。</p>
<p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">@import AdSupport;</span><br><span class="line">// ...</span><br><span class="line"></span><br><span class="line">NSString *identifier = [[[ASIdentifierManager sharedManager] advertisingIdentifier] UUIDString];</span><br><span class="line"></span><br><span class="line">NSString *isEnabled = [[ASIdentifierManager sharedManager] isAdvertisingTrackingEnabled] ? @&quot;YES&quot; : @&quot;NO&quot;;</span><br></pre></td></tr></table></figure></p>
<h3>Network Identification</h3>
<p>当 <code>uniqueIdentifier</code> 被弃用了，通过使用MAC地址变得很流行。一个MAC地址是恒定不变的且唯一的，可以用来跟踪用户。但是在iOS7中Apple对这个也添加了限制，所以实际返回的MAC地址为: 02:00:00:00:00:00. 关闭这个“漏洞”，将会推动开发者运用Apple提供的优先方法来进行获得设备标识.</p>
<p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;sys/socket.h&gt;</span><br><span class="line">#include &lt;sys/sysctl.h&gt;</span><br><span class="line">#include &lt;net/if.h&gt;</span><br><span class="line">#include &lt;net/if_dl.h&gt;</span><br><span class="line"></span><br><span class="line">//...</span><br><span class="line"></span><br><span class="line">- (NSString *)getMacAddress &#123;</span><br><span class="line">    int                 mgmtInfoBase[6];</span><br><span class="line">    char                *msgBuffer = NULL;</span><br><span class="line">    NSString            *errorFlag = NULL;</span><br><span class="line">    size_t              length;</span><br><span class="line">    </span><br><span class="line">    // Setup the management Information Base (mib)</span><br><span class="line">    mgmtInfoBase[0] = CTL_NET;        // Request network subsystem</span><br><span class="line">    mgmtInfoBase[1] = AF_ROUTE;       // Routing table info</span><br><span class="line">    mgmtInfoBase[2] = 0;</span><br><span class="line">    mgmtInfoBase[3] = AF_LINK;        // Request link layer information</span><br><span class="line">    mgmtInfoBase[4] = NET_RT_IFLIST;  // Request all configured interfaces</span><br><span class="line">    </span><br><span class="line">    // With all configured interfaces requested, get handle index</span><br><span class="line">    if ((mgmtInfoBase[5] = if_nametoindex(&quot;en0&quot;)) == 0)</span><br><span class="line">        errorFlag = @&quot;if_nametoindex failure&quot;;</span><br><span class="line">    // Get the size of the data available (store in len)</span><br><span class="line">    else if (sysctl(mgmtInfoBase, 6, NULL, &amp;length, NULL, 0) &lt; 0)</span><br><span class="line">        errorFlag = @&quot;sysctl mgmtInfoBase failure&quot;;</span><br><span class="line">    // Alloc memory based on above call</span><br><span class="line">    else if ((msgBuffer = malloc(length)) == NULL)</span><br><span class="line">        errorFlag = @&quot;buffer allocation failure&quot;;</span><br><span class="line">    // Get system information, store in buffer</span><br><span class="line">    else if (sysctl(mgmtInfoBase, 6, msgBuffer, &amp;length, NULL, 0) &lt; 0)</span><br><span class="line">    &#123;</span><br><span class="line">        free(msgBuffer);</span><br><span class="line">        errorFlag = @&quot;sysctl msgBuffer failure&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">    else</span><br><span class="line">    &#123;</span><br><span class="line">        // Map msgbuffer to interface message structure</span><br><span class="line">        struct if_msghdr *interfaceMsgStruct = (struct if_msghdr *) msgBuffer;</span><br><span class="line">        </span><br><span class="line">        // Map to link-level socket structure</span><br><span class="line">        struct sockaddr_dl *socketStruct = (struct sockaddr_dl *) (interfaceMsgStruct + 1);</span><br><span class="line">        </span><br><span class="line">        // Copy link layer address data in socket structure to an array</span><br><span class="line">        unsigned char macAddress[6];</span><br><span class="line">        memcpy(&amp;macAddress, socketStruct-&gt;sdl_data + socketStruct-&gt;sdl_nlen, 6);</span><br><span class="line">        </span><br><span class="line">        // Read from char array into a string object, into traditional Mac address format</span><br><span class="line">        NSString *macAddressString = [NSString stringWithFormat:@&quot;%02X:%02X:%02X:%02X:%02X:%02X&quot;,</span><br><span class="line">                                      macAddress[0], macAddress[1], macAddress[2], macAddress[3], macAddress[4], macAddress[5]];</span><br><span class="line">        </span><br><span class="line">        // Release the buffer memory</span><br><span class="line">        free(msgBuffer);</span><br><span class="line">        </span><br><span class="line">        return macAddressString;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    return errorFlag;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3>关于 identity</h3>
<p>关于 UUID （设备唯一标识符）我之前也有研究过，可以戳这里：</p>
<p><a href="http://www.jianshu.com/p/40b9f8ec1c78" target="_blank" rel="noopener">iOS—获取设备型号和App版本号等信息</a></p>
<p>得到的最终方案是： <code>UIDevice</code>中的<code>identifierForVendor</code>方法配合 keychain（钥匙串）存储标识符。</p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://andy0570.com/2017/09/08/天天品尝iOS7甜点 Day7：Taking Snapshots of UIViews/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="独木舟的木">
      <meta itemprop="description" content="有时候阳光很好 有时候阳光很暗">
      <meta itemprop="image" content="https://blog-andy0570-1256077835.cos.ap-shanghai.myqcloud.com/site_Images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="独木舟的木">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2017/09/08/天天品尝iOS7甜点 Day7：Taking Snapshots of UIViews/" class="post-title-link" itemprop="url">天天品尝iOS7甜点 Day7：Taking Snapshots of UIViews</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2017-09-08 17:31:00" itemprop="dateCreated datePublished" datetime="2017-09-08T17:31:00+08:00">2017-09-08</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2019-05-01 21:20:04" itemprop="dateModified" datetime="2019-05-01T21:20:04+08:00">2019-05-01</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/iOS/" itemprop="url" rel="index"><span itemprop="name">iOS</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          

          

          
            <div class="post-symbolscount">
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">本文字数：</span>
                
                <span title="本文字数">6k</span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">5 分钟</span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body han-init-context" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>获取UIView对象的快照</p>
</blockquote>
<h3>参考</h3>
<ul>
<li><a href="https://github.com/ShinobiControls/iOS7-day-by-day" target="_blank" rel="noopener">GitHub 源码：shinobicontrols/iOS7-day-by-day</a></li>
</ul>
<ul>
<li><a href="http://blog.kingiol.com/2014/01/09/ios7-day-by-day-day7-taking-snapshots-of-uiviews/" target="_blank" rel="noopener">天天品尝iOS7甜点 :: Day 7 :: Taking Snapshots of UIViews</a></li>
</ul>
<p>&lt;!-- more --&gt;</p>
<h2>API方法</h2>
<h3>UIScreen</h3>
<p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">- (UIView *)snapshotViewAfterScreenUpdates:(BOOL)afterUpdates;</span><br></pre></td></tr></table></figure></p>
<h3>UIView</h3>
<p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">// 获取当前文本的快照视图</span><br><span class="line">- (UIView *)snapshotViewAfterScreenUpdates:(BOOL)afterUpdates;</span><br><span class="line"></span><br><span class="line">// 给定一个可伸缩插值，返回基于当前视图的指定内容的快照视图，</span><br><span class="line">- (UIView *)resizableSnapshotViewFromRect:(CGRect)rect afterScreenUpdates:(BOOL)afterUpdates withCapInsets:(UIEdgeInsets)capInsets;</span><br><span class="line"></span><br><span class="line">// 将完整视图层次结构的快照呈现在当前上下文中。</span><br><span class="line">- (BOOL)drawViewHierarchyInRect:(CGRect)rect afterScreenUpdates:(BOOL)afterUpdates;</span><br></pre></td></tr></table></figure></p>
<h2>Demo 示例</h2>
<h3>Snapshotting for Animation - 动画快照</h3>
<p><img src="https://blog-andy0570-1256077835.cos.ap-shanghai.myqcloud.com/site_Images/073205.jpg" alt></p>
<p>自定义视图绘制方法：</p>
<p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">// 生成旋转视图</span><br><span class="line">- (void)generateRotations &#123;</span><br><span class="line">    for (CGFloat angle = 0; angle &lt; 2 * M_PI; angle += M_PI / 20.0) &#123;</span><br><span class="line">        UIView *newView = [[UIView alloc] initWithFrame:CGRectMake(0, 0, 200, 250)];</span><br><span class="line">        newView.center = CGPointMake(CGRectGetMidX(self.bounds), CGRectGetMidY(self.bounds));</span><br><span class="line">        newView.layer.borderColor = [UIColor grayColor].CGColor;</span><br><span class="line">        newView.layer.borderWidth = 1;</span><br><span class="line">        newView.backgroundColor = [UIColor colorWithWhite:0.8 alpha:0.4];</span><br><span class="line">        newView.transform = CGAffineTransformMakeRotation(angle);</span><br><span class="line">        newView.autoresizingMask = UIViewAutoresizingFlexibleHeight | UIViewAutoresizingFlexibleWidth;</span><br><span class="line">        [self addSubview:newView];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>重新设置所有子视图的背景色:</p>
<p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">- (void)recolorSubviews:(UIColor *)newColor &#123;</span><br><span class="line">    for (UIView *subview in self.subviews) &#123;</span><br><span class="line">        subview.backgroundColor = newColor;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h4>在动画中使用UIView快照以简化复杂的视图</h4>
<p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line">#import &quot;ViewController.h&quot;</span><br><span class="line">#import &quot;HQLRotatingViews.h&quot;</span><br><span class="line"></span><br><span class="line">@interface ViewController ()</span><br><span class="line">@property (weak, nonatomic) IBOutlet UIView *containerView;</span><br><span class="line">@end</span><br><span class="line"></span><br><span class="line">@implementation ViewController &#123;</span><br><span class="line">    HQLRotatingViews *_complexView;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#pragma mark - Lifecycle</span><br><span class="line"></span><br><span class="line">- (void)viewDidLoad &#123;</span><br><span class="line">    [super viewDidLoad];</span><br><span class="line">    // Do any additional setup after loading the view, typically from a nib.</span><br><span class="line">    [self createComplexView];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#pragma mark - Utility methods</span><br><span class="line"></span><br><span class="line">// 向容器视图中添加旋转视图</span><br><span class="line">- (void)createComplexView &#123;</span><br><span class="line">    _complexView = [[HQLRotatingViews alloc] initWithFrame:self.view.bounds];</span><br><span class="line">    [self.containerView addSubview:_complexView];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (void)animateViewAwayAndReset:(UIView *)view &#123;</span><br><span class="line">    [UIView animateWithDuration:2.0</span><br><span class="line">                     animations:^&#123;</span><br><span class="line">                         view.bounds = CGRectZero;</span><br><span class="line">                     &#125;</span><br><span class="line">                     completion:^(BOOL finished) &#123;</span><br><span class="line">                         // 动画完成后删除视图并创建新视图</span><br><span class="line">                         [view removeFromSuperview];</span><br><span class="line">                         [self performSelector:@selector(createComplexView)</span><br><span class="line">                                    withObject:nil</span><br><span class="line">                                    afterDelay:1];</span><br><span class="line">                     &#125;];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#pragma mark - IBActions</span><br><span class="line"></span><br><span class="line">/** </span><br><span class="line"> 这两个方法演示了如何在动画中使用UIView快照以简化复杂的视图</span><br><span class="line"> */</span><br><span class="line">// ❇️ Animate 按钮——直接对 UIView 进行旋转</span><br><span class="line">- (IBAction)handleAnimate:(id)sender &#123;</span><br><span class="line">    [self animateViewAwayAndReset:_complexView];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// ❇️ 生成当前 UIView 的快照之后，对快照进行旋转</span><br><span class="line">- (IBAction)handleSnapshot:(id)sender &#123;</span><br><span class="line">    // 创建复合视图的快照</span><br><span class="line">    UIView *snapshotView = [_complexView snapshotViewAfterScreenUpdates:NO];</span><br><span class="line">    [self.containerView addSubview:snapshotView];</span><br><span class="line">    [_complexView removeFromSuperview];</span><br><span class="line">    [self animateViewAwayAndReset:snapshotView];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h4>示例一：Animate 按钮——直接对 UIView 进行旋转</h4>
<p><img src="https://blog-andy0570-1256077835.cos.ap-shanghai.myqcloud.com/site_Images/073208.gif" alt></p>
<h4>示例二：生成当前 UIView 的快照之后，对快照进行旋转</h4>
<p><img src="https://blog-andy0570-1256077835.cos.ap-shanghai.myqcloud.com/site_Images/073209.gif" alt></p>
<p>快照方法：</p>
<p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">- (nullable UIView *)snapshotViewAfterScreenUpdates:(BOOL)afterUpdates;</span><br></pre></td></tr></table></figure></p>
<h3>测试快照方法中的 BOOL 参数</h3>
<p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">/** </span><br><span class="line"> 这两种方法比较了是否允许屏幕更新的区别</span><br><span class="line"> - (nullable UIView *)snapshotViewAfterScreenUpdates:(BOOL)afterUpdates;</span><br><span class="line"> */</span><br><span class="line">- (IBAction)handlePreUpdateSnapshot:(id)sender &#123;</span><br><span class="line">    // 更新视图</span><br><span class="line">    [_complexView recolorSubviews:[[UIColor redColor] colorWithAlphaComponent:0.3]];</span><br><span class="line">    // 创建快照，不等待更改被应用。</span><br><span class="line">    UIView *snapshotView = [_complexView snapshotViewAfterScreenUpdates:NO];</span><br><span class="line">    [self.containerView addSubview:snapshotView];</span><br><span class="line">    [_complexView removeFromSuperview];</span><br><span class="line">    [self animateViewAwayAndReset:snapshotView];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (IBAction)handlePostUpdateSnapshot:(id)sender &#123;</span><br><span class="line">    // 更新视图</span><br><span class="line">    [_complexView recolorSubviews:[[UIColor redColor] colorWithAlphaComponent:0.3]];</span><br><span class="line">    // 创建快照，等待渲染完成。</span><br><span class="line">    UIView *snapshotView = [_complexView snapshotViewAfterScreenUpdates:YES];</span><br><span class="line">    [self.containerView addSubview:snapshotView];</span><br><span class="line">    [_complexView removeFromSuperview];</span><br><span class="line">    [self animateViewAwayAndReset:snapshotView];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h4>Pre 按钮——设置为 NO</h4>
<p><img src="https://blog-andy0570-1256077835.cos.ap-shanghai.myqcloud.com/site_Images/073211.gif" alt></p>
<h4>Post 按钮——设置为 YES</h4>
<p><img src="https://blog-andy0570-1256077835.cos.ap-shanghai.myqcloud.com/site_Images/073213.gif" alt></p>
<h3>生成快照图片</h3>
<p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">/** </span><br><span class="line"> 此方法演示了如何向UIView快照添加图像效果</span><br><span class="line"> */</span><br><span class="line">- (IBAction)handleImageSnapshot:(id)sender &#123;</span><br><span class="line">    // 创建一个图像上下文 - 复合视图的大小和缩放比例</span><br><span class="line">    UIGraphicsBeginImageContextWithOptions(_complexView.bounds.size, NO, 0.0);</span><br><span class="line">    // 将快照渲染到图像上下文中</span><br><span class="line">    [_complexView drawViewHierarchyInRect:_complexView.bounds afterScreenUpdates:NO];</span><br><span class="line">    </span><br><span class="line">    // 从图像上下文中抓取图像</span><br><span class="line">    UIImage *complexViewImage = UIGraphicsGetImageFromCurrentImageContext();</span><br><span class="line">    // 结束使用图像上下文</span><br><span class="line">    UIGraphicsEndImageContext();</span><br><span class="line">    </span><br><span class="line">    // 在生成快照之前让当前的视图模糊化</span><br><span class="line">    UIImageView *iv = [[UIImageView alloc] initWithImage:[self applyBlurToImage:complexViewImage]];</span><br><span class="line">    iv.center = _complexView.center;</span><br><span class="line">    [self.containerView addSubview:iv];</span><br><span class="line">    [_complexView removeFromSuperview];</span><br><span class="line">    [self performSelector:@selector(animateViewAwayAndReset:)</span><br><span class="line">               withObject:iv</span><br><span class="line">               afterDelay:1.0];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 模糊化UIImage</span><br><span class="line">- (UIImage *)applyBlurToImage:(UIImage *)image &#123;</span><br><span class="line">    CIContext *context = [CIContext contextWithOptions:nil];</span><br><span class="line">    CIImage *ci_image = [CIImage imageWithCGImage:image.CGImage];</span><br><span class="line">    CIFilter *filter = [CIFilter filterWithName:@&quot;CIGaussianBlur&quot;];</span><br><span class="line">    [filter setValue:ci_image forKey:kCIInputImageKey];</span><br><span class="line">    [filter setValue:@5 forKey:kCIInputRadiusKey];</span><br><span class="line">    CIImage *result = [filter valueForKey:kCIOutputImageKey];</span><br><span class="line">    CGImageRef cgImage = [context createCGImage:result fromRect:[result extent]];</span><br><span class="line">    return [UIImage imageWithCGImage:cgImage</span><br><span class="line">                               scale:image.scale</span><br><span class="line">                         orientation:image.imageOrientation];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p><img src="https://blog-andy0570-1256077835.cos.ap-shanghai.myqcloud.com/site_Images/073224.gif" alt></p>
<h3>Limitaions - 局限性</h3>
<p>创建的快照必须在屏幕范围之内</p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://andy0570.com/2017/09/07/天天品尝iOS7甜点 Day6：Tint Color/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="独木舟的木">
      <meta itemprop="description" content="有时候阳光很好 有时候阳光很暗">
      <meta itemprop="image" content="https://blog-andy0570-1256077835.cos.ap-shanghai.myqcloud.com/site_Images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="独木舟的木">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2017/09/07/天天品尝iOS7甜点 Day6：Tint Color/" class="post-title-link" itemprop="url">天天品尝iOS7甜点 Day6：Tint Color</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2017-09-07 16:00:00" itemprop="dateCreated datePublished" datetime="2017-09-07T16:00:00+08:00">2017-09-07</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2019-05-01 21:19:54" itemprop="dateModified" datetime="2019-05-01T21:19:54+08:00">2019-05-01</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/iOS/" itemprop="url" rel="index"><span itemprop="name">iOS</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          

          

          
            <div class="post-symbolscount">
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">本文字数：</span>
                
                <span title="本文字数">5.1k</span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">5 分钟</span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body han-init-context" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>学习使用 <code>tintColor</code> 属性</p>
</blockquote>
<h3>参考</h3>
<ul>
<li><a href="https://github.com/ShinobiControls/iOS7-day-by-day" target="_blank" rel="noopener">GitHub 源码：shinobicontrols/iOS7-day-by-day</a></li>
</ul>
<ul>
<li><a href="http://blog.kingiol.com/2014/01/09/ios7-day-by-day-day6-tint-color/" target="_blank" rel="noopener">天天品尝iOS7甜点 :: Day 6 :: Tint Color</a></li>
</ul>
<p>&lt;!-- more --&gt;</p>
<h3>tintColor 属性</h3>
<p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">@property(null_resettable, nonatomic, strong) UIColor *tintColor NS_AVAILABLE_IOS(7_0);</span><br></pre></td></tr></table></figure></p>
<ul>
<li><code>tintColor</code> 属性是 iOS 7.0 新增属性，被使用在<code>UIView</code>中以改变应用程序的外观（我的理解是，类似于给所有 UI 控件统一设置主题色效果）；</li>
<li>该属性是 <code>UIColor</code> 类型，默认为系统颜色（蓝色）；</li>
<li>它将会运用父视图层次的颜色来进行着色。可以通过设置 root view controller 的 <code>tintColor</code> 来改变系统整体的颜色。</li>
</ul>
<h3>特点：<strong>继承</strong>、<strong>重写</strong>、<strong>传播</strong>。</h3>
<blockquote>
<ul>
<li>
<p><strong>继承</strong>：只要一个 <strong>UIView</strong> 的 subview 没有明确指定 <code>tintColor</code>，那么这个 <strong>UIView</strong> 的 <code>tintColor</code> 就会被它的 subview 所继承！在一个 App 中，最顶层的 view 就是 window，因此，只要修改 window 的 <code>tintColor</code>，那么所有 view 的 <code>tintColor</code> 就都会跟着改变。(这种说法其实并不严谨，请耐心继续看下去^_^)。</p>
</li>
<li>
<p><strong>重写</strong>：如果明确指定了某个 view 的 <code>tintColor</code>， 那么这个 view 就不会继承其 superview 的 <code>tintColor</code>。而且自此, 这个 view 的 subview 的 <code>tintColor</code> 会发生改变。</p>
</li>
<li>
<p>传播：一个 view 的 <code>tintColor</code> 的改变会立即向下传播, 影响其所有的 subview，直至它的一个 subview 明确指定了 <code>tintColor</code> 为止。</p>
<p>——<a href="http://www.jianshu.com/p/4bcaf6349133" target="_blank" rel="noopener">UIView并没想的那么简单 - tintColor揭秘</a></p>
</li>
</ul>
</blockquote>
<h3>Tint color of existing iOS controller - 使用tint color为iOS中已经存在的控件进行着色</h3>
<p>示例代码：</p>
<p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">- (IBAction)changeColorHandle:(id)sender &#123;</span><br><span class="line">    // 生成随机色</span><br><span class="line">    CGFloat hue = ( arc4random() % 256 / 256.0 );</span><br><span class="line">    CGFloat saturation = ( arc4random() % 128 / 256.0 ) + 0.5;</span><br><span class="line">    CGFloat brightness = ( arc4random() % 128 / 256.0 ) + 0.5;</span><br><span class="line">    UIColor *color = [UIColor colorWithHue:hue saturation:saturation brightness:brightness alpha:1];</span><br><span class="line">    // 设置 tintColor</span><br><span class="line">    self.view.tintColor = color;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>效果：只要修改根视图控制器的 <code>tintColor</code> 属性，该页面下的所有 UI 控件颜色都会随之改变。</p>
<p><img src="https://blog-andy0570-1256077835.cos.ap-shanghai.myqcloud.com/site_Images/072941.gif" alt></p>
<h3>关于 UIProgressView</h3>
<p>参考的文章称 <code>tintColor</code> 属性并不会影响 UIProgressView，因为其有两个描述 <code>tintColor</code> 的属性：</p>
<p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">// 填充进度条的颜色</span><br><span class="line">@property(nonatomic, strong, nullable) UIColor* progressTintColor;</span><br><span class="line">// 未填充进度条的颜色</span><br><span class="line">@property(nonatomic, strong, nullable) UIColor* trackTintColor;</span><br></pre></td></tr></table></figure></p>
<p>需要进行额外设置：</p>
<p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">- (void)updateProgressViewTint &#123;</span><br><span class="line">    self.progressView.progressTintColor = self.view.tintColor;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h4>✏️ 更正</h4>
<p>注释以上代码后测试，结果并不是这样，UIProgressView 的 <code>progressTintColor</code> 值是会跟随 <code>tintColor</code> 的变化而变化的。</p>
<h3>Tint Dimming - 颜色变暗</h3>
<h4>UIViewTintAdjustmentMode</h4>
<p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">typedef NS_ENUM(NSInteger, UIViewTintAdjustmentMode) &#123;</span><br><span class="line">    UIViewTintAdjustmentModeAutomatic,</span><br><span class="line">    </span><br><span class="line">    UIViewTintAdjustmentModeNormal,</span><br><span class="line">    UIViewTintAdjustmentModeDimmed,</span><br><span class="line">&#125; NS_ENUM_AVAILABLE_IOS(7_0);</span><br></pre></td></tr></table></figure></p>
<p>示例代码：</p>
<p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">- (IBAction)dimTintHandle:(id)sender &#123;</span><br><span class="line">    if (self.dimTintSwitch.isOn) &#123;</span><br><span class="line">        self.view.tintAdjustmentMode = UIViewTintAdjustmentModeDimmed;</span><br><span class="line">    &#125;else &#123;</span><br><span class="line">        self.view.tintAdjustmentMode = UIViewTintAdjustmentModeNormal;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>效果：设置<code>UIViewTintAdjustmentModeDimmed</code> 属性以后，所有 UI 控件的颜色会变暗，适合沉浸式体验的场景。</p>
<p><img src="https://blog-andy0570-1256077835.cos.ap-shanghai.myqcloud.com/site_Images/072942.gif" alt></p>
<h3>Using tint color in custom views - 给自定义视图进行着色</h3>
<p>自定义 UIView 子类需要覆盖以下方法：</p>
<p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">/*</span><br><span class="line"> The -tintColorDidChange message is sent to appropriate subviews of a view when its tintColor is changed by client code or to subviews in the view hierarchy of a view whose tintColor is implicitly changed when its superview or tintAdjustmentMode changes.</span><br><span class="line"> */</span><br><span class="line">- (void)tintColorDidChange NS_AVAILABLE_IOS(7_0);</span><br></pre></td></tr></table></figure></p>
<p>创建一个自定义视图类：</p>
<p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line">//  ***********************************</span><br><span class="line">//  HQLCustomView.h</span><br><span class="line">#import &lt;UIKit/UIKit.h&gt;</span><br><span class="line">@interface HQLCustomView : UIView</span><br><span class="line">@end</span><br><span class="line">  </span><br><span class="line">//  ***********************************</span><br><span class="line">//  HQLCustomView.m</span><br><span class="line">#import &quot;HQLCustomView.h&quot;</span><br><span class="line"></span><br><span class="line">@implementation HQLCustomView &#123;</span><br><span class="line">    UIView *_tintColorBlock;</span><br><span class="line">    UILabel *_greyLabel;</span><br><span class="line">    UILabel *_tintColorLabel;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (id)initWithCoder:(NSCoder *)aDecoder &#123;</span><br><span class="line">    self = [super initWithCoder:aDecoder];</span><br><span class="line">    if (!self) &#123;</span><br><span class="line">        return nil;</span><br><span class="line">    &#125;</span><br><span class="line">    self.backgroundColor = [UIColor clearColor];</span><br><span class="line">    [self prepareSubviews];</span><br><span class="line">    return self;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (void)prepareSubviews &#123;</span><br><span class="line">    _tintColorBlock = [[UIView alloc] init];</span><br><span class="line">    _tintColorBlock.backgroundColor = self.tintColor;</span><br><span class="line">    [self addSubview:_tintColorBlock];</span><br><span class="line">    </span><br><span class="line">    _greyLabel = [UILabel new];</span><br><span class="line">    _greyLabel.text = @&quot;Grey Label&quot;;</span><br><span class="line">    _greyLabel.textColor = [UIColor grayColor];</span><br><span class="line">    [_greyLabel sizeToFit];</span><br><span class="line">    [self addSubview:_greyLabel];</span><br><span class="line">    </span><br><span class="line">    _tintColorLabel = [UILabel new];</span><br><span class="line">    _tintColorLabel.text = @&quot;Tint Color Label&quot;;</span><br><span class="line">    _tintColorLabel.textColor = self.tintColor;</span><br><span class="line">    [_tintColorLabel sizeToFit];</span><br><span class="line">    [self addSubview:_tintColorLabel];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (void)layoutSubviews &#123;</span><br><span class="line">    _tintColorBlock.frame = CGRectMake(0, 0, CGRectGetWidth(self.bounds) / 3, CGRectGetHeight(self.bounds));</span><br><span class="line">    </span><br><span class="line">    CGRect frame = _greyLabel.frame;</span><br><span class="line">    frame.origin.x = CGRectGetWidth(self.bounds) / 3 + 10;</span><br><span class="line">    frame.origin.y = 0;</span><br><span class="line">    _greyLabel.frame = frame;</span><br><span class="line">    </span><br><span class="line">    frame = _tintColorLabel.frame;</span><br><span class="line">    frame.origin.x = CGRectGetWidth(self.bounds) / 3 + 10;</span><br><span class="line">    frame.origin.y = CGRectGetHeight(self.bounds) / 2;</span><br><span class="line">    _tintColorLabel.frame = frame;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 当tintColor或者tintAdjustmentMode属性发生变化时调用</span><br><span class="line">- (void)tintColorDidChange &#123;</span><br><span class="line">    _tintColorBlock.backgroundColor = self.tintColor;</span><br><span class="line">    _tintColorLabel.textColor = self.tintColor;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@end</span><br></pre></td></tr></table></figure></p>
<p><img src="https://blog-andy0570-1256077835.cos.ap-shanghai.myqcloud.com/site_Images/072944.gif" alt></p>
<h3>Tinting images with tintColor - 给图像着色</h3>
<p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">// 加载图片</span><br><span class="line">UIImage *gitHubImg = [UIImage imageNamed:@&quot;gitHub&quot;];</span><br><span class="line">// 设置图片渲染模式</span><br><span class="line">gitHubImg = [gitHubImg imageWithRenderingMode:UIImageRenderingModeAlwaysTemplate];</span><br><span class="line">// 添加到视图</span><br><span class="line">self.tintedImageView.image = gitHubImg;</span><br><span class="line">self.tintedImageView.contentMode = UIViewContentModeScaleAspectFit;</span><br></pre></td></tr></table></figure></p>
<p>原图：</p>
<p><img src="https://blog-andy0570-1256077835.cos.ap-shanghai.myqcloud.com/site_Images/072946.jpg" alt></p>
<p>实际效果：</p>
<p><img src="https://blog-andy0570-1256077835.cos.ap-shanghai.myqcloud.com/site_Images/072951.gif" alt></p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://andy0570.com/2017/09/05/Mac 截屏应用/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="独木舟的木">
      <meta itemprop="description" content="有时候阳光很好 有时候阳光很暗">
      <meta itemprop="image" content="https://blog-andy0570-1256077835.cos.ap-shanghai.myqcloud.com/site_Images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="独木舟的木">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2017/09/05/Mac 截屏应用/" class="post-title-link" itemprop="url">Mac 截屏应用</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2017-09-05 11:00:00" itemprop="dateCreated datePublished" datetime="2017-09-05T11:00:00+08:00">2017-09-05</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2019-05-01 22:09:49" itemprop="dateModified" datetime="2019-05-01T22:09:49+08:00">2019-05-01</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/开发工具-Mac应用/" itemprop="url" rel="index"><span itemprop="name">开发工具&Mac应用</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          

          

          
            <div class="post-symbolscount">
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">本文字数：</span>
                
                <span title="本文字数">203</span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">1 分钟</span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body han-init-context" itemprop="articleBody">

      
      

      
        
          
            <h2>系统截屏</h2>
<p><img src="https://blog-andy0570-1256077835.cos.ap-shanghai.myqcloud.com/site_Images/072453.jpg" alt></p>
<p>&lt;!-- more --&gt;</p>
<hr>
<h2>Snappy</h2>
<p><img src="https://blog-andy0570-1256077835.cos.ap-shanghai.myqcloud.com/site_Images/072454.png" alt></p>
<ul>
<li><a href="http://snappy-app.com" target="_blank" rel="noopener">Snappy 官网</a></li>
<li><a href="http://www.ifanr.com/app/891044" target="_blank" rel="noopener">Snappy：满足你 99% 截图需求的电脑工具，比系统自带更好用 #macOS</a></li>
</ul>
<hr>
<h2>Snip</h2>
<p><img src="https://blog-andy0570-1256077835.cos.ap-shanghai.myqcloud.com/site_Images/072455.png" alt></p>
<ul>
<li><a href="http://snip.qq.com" target="_blank" rel="noopener">Tencent ：Snip</a></li>
</ul>
<hr>
<h2>截图</h2>
<p><img src="https://blog-andy0570-1256077835.cos.ap-shanghai.myqcloud.com/site_Images/072456.png" alt></p>
<ul>
<li><a href="http://jietu.qq.com" target="_blank" rel="noopener">Tencent：截图</a></li>
<li><a href="https://appso.gitbooks.io/macos/content/xi-tong-zeng-qiang-app/qing-liang-3001-qiang-da-de-mian-fei-jie-tu-biao-zhu-ruan-jian-ff0c-huan-bu-kuai-shou-le-ff1f.html" target="_blank" rel="noopener">轻量、强大的免费截图标注软件</a></li>
</ul>
<hr>
<p>另外，Mac 版的 QQ 和 微信 也自带截图功能，而且上面两款腾讯出品的截图应用其实就是从QQ中单独提取出来的。</p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://andy0570.com/2017/09/04/天天品尝iOS7甜点 Day3：Background Fetch/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="独木舟的木">
      <meta itemprop="description" content="有时候阳光很好 有时候阳光很暗">
      <meta itemprop="image" content="https://blog-andy0570-1256077835.cos.ap-shanghai.myqcloud.com/site_Images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="独木舟的木">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2017/09/04/天天品尝iOS7甜点 Day3：Background Fetch/" class="post-title-link" itemprop="url">天天品尝iOS7甜点 Day3：Background Fetch</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2017-09-04 10:03:00" itemprop="dateCreated datePublished" datetime="2017-09-04T10:03:00+08:00">2017-09-04</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2019-05-01 21:19:45" itemprop="dateModified" datetime="2019-05-01T21:19:45+08:00">2019-05-01</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/iOS/" itemprop="url" rel="index"><span itemprop="name">iOS</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          

          

          
            <div class="post-symbolscount">
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">本文字数：</span>
                
                <span title="本文字数">1.8k</span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">2 分钟</span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body han-init-context" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>后台提取特性：iOS 可以根据 App 的使用情况自动更新内容，不管app是否正在运行。</p>
</blockquote>
<p>后台提取功能可以让你的程序用户体验效果更加的好，如果你的应用是基于互联网数据更新，那么这非常简单的方法，让应用程序时刻获得最新的信息。</p>
<h3>参考：</h3>
<ul>
<li><a href="https://github.com/ShinobiControls/iOS7-day-by-day" target="_blank" rel="noopener">GitHub 源码：shinobicontrols/iOS7-day-by-day</a></li>
<li><a href="http://blog.kingiol.com/2014/01/06/ios7-day-by-day-day1-nsurlsession/" target="_blank" rel="noopener">天天品尝iOS7甜点 :: Day 1 :: NSURLSession</a></li>
</ul>
<p>&lt;!-- more --&gt;</p>
<h3>Enabling background fetch - 开启后台提取功能</h3>
<p><img src="https://blog-andy0570-1256077835.cos.ap-shanghai.myqcloud.com/site_Images/072518.jpg" alt></p>
<h3>指定后台提取功能运行的频率</h3>
<p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">- (BOOL)application:(UIApplication *)application didFinishLaunchingWithOptions:(NSDictionary *)launchOptions &#123;</span><br><span class="line">    // 指定后台提取功能运行的频率</span><br><span class="line">    [[UIApplication sharedApplication] setMinimumBackgroundFetchInterval:UIApplicationBackgroundFetchIntervalMinimum];</span><br><span class="line">    </span><br><span class="line">    return YES;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3>后台提取功能需要实现的代理协议</h3>
<p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">// application:performFetchWithCompletionHandler:</span><br><span class="line">- (void)application:(UIApplication *)application performFetchWithCompletionHandler:(void (^)(UIBackgroundFetchResult))completionHandler</span><br><span class="line">&#123;</span><br><span class="line">    // 得到要更新的视图控制器</span><br><span class="line">    SCViewController *vc = (SCViewController *)self.window.rootViewController;</span><br><span class="line">    // Insert status updates and pass in the completion handler block</span><br><span class="line">    // 更新状态，并回传更新完成后的处理程序</span><br><span class="line">    NSUInteger numberInserted = [vc insertStatusObjectsForFetchWithCompletionHandler:completionHandler];</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">    // 分 iOS 版本，设置 applicationIconBadgeNumber</span><br><span class="line">    float version = [[[UIDevice currentDevice] systemVersion] floatValue];</span><br><span class="line">    </span><br><span class="line">    if (version &gt;= 8.0) &#123;</span><br><span class="line">        UIUserNotificationSettings *settings = [UIUserNotificationSettings settingsForTypes:UIUserNotificationTypeBadge categories:nil];</span><br><span class="line">        // 注册用户通知：</span><br><span class="line">        [[UIApplication sharedApplication] registerUserNotificationSettings:settings];</span><br><span class="line">        // 注册消息推送：</span><br><span class="line">        [application registerForRemoteNotifications];</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    // 应用程序右上角数字</span><br><span class="line">    [UIApplication sharedApplication].applicationIconBadgeNumber += numberInserted;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3>Testing - 测试</h3>
<p>需要测试两种情况：</p>
<ol>
<li>App currently runing in background - app当前在后台运行</li>
<li>App currently in terminated state - app当前已经终止进程</li>
</ol>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://andy0570.com/2017/09/03/天天品尝iOS7甜点 Day2：Asset Catalog/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="独木舟的木">
      <meta itemprop="description" content="有时候阳光很好 有时候阳光很暗">
      <meta itemprop="image" content="https://blog-andy0570-1256077835.cos.ap-shanghai.myqcloud.com/site_Images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="独木舟的木">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2017/09/03/天天品尝iOS7甜点 Day2：Asset Catalog/" class="post-title-link" itemprop="url">天天品尝iOS7甜点 Day2：Asset Catalog</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2017-09-03 16:02:00" itemprop="dateCreated datePublished" datetime="2017-09-03T16:02:00+08:00">2017-09-03</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2019-05-01 21:19:04" itemprop="dateModified" datetime="2019-05-01T21:19:04+08:00">2019-05-01</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/iOS/" itemprop="url" rel="index"><span itemprop="name">iOS</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          

          

          
            <div class="post-symbolscount">
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">本文字数：</span>
                
                <span title="本文字数">4.3k</span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">4 分钟</span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body han-init-context" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>Asset Catalogs (资产分类)，它可以管理物理图像文件和这些文件的上下文信息。</p>
</blockquote>
<h3>参考：</h3>
<ul>
<li><a href="https://github.com/ShinobiControls/iOS7-day-by-day" target="_blank" rel="noopener">GitHub 源码：shinobicontrols/iOS7-day-by-day</a></li>
<li><a href="http://blog.kingiol.com/2014/01/06/ios7-day-by-day-day1-nsurlsession/" target="_blank" rel="noopener">天天品尝iOS7甜点 :: Day 1 :: NSURLSession</a></li>
<li><a href="%5Bhttps://zhuanlan.zhihu.com/p/34474502%5D(https://zhuanlan.zhihu.com/p/34474502)">知乎专栏：iOS 温习之路 ” Bundle “</a></li>
</ul>
<p>&lt;!-- more --&gt;</p>
<h3>Asset Catalog - 资产分类</h3>
<ul>
<li>资产分类目录由一些图像的集合、app图标和app启动页构成。</li>
<li>新建工程时，Xcode 会自动创建一个名为 <code>Assets.xcassets</code> 的文件夹。</li>
<li><strong>Asset catalogs</strong> 是存在在硬盘上面的一个目录，由Xcode进行管理。它以特定的方式进行文件的排列，包含一个json文件存储目录相关联的元数据:</li>
</ul>
<p><img src="https://blog-andy0570-1256077835.cos.ap-shanghai.myqcloud.com/site_Images/072636.jpg" alt></p>
<h3>App icons and launch images</h3>
<p><strong>Asset catalog</strong>(资产分类)默认自动创建，名为<code>Assets.xcassets</code>,包含<code>AppIcon</code>的入口。提供了构建应用的所有需要的图标的尺寸：</p>
<p><code>LaunchImage</code> 目录需要自己创建：<strong>鼠标右击</strong> —— <strong>App Icons &amp; Launch Images</strong> —— <strong>New iOS Launch Image</strong></p>
<p><img src="https://blog-andy0570-1256077835.cos.ap-shanghai.myqcloud.com/site_Images/072638.jpg" alt></p>
<h3>Custom imagesets - 自定义图像集</h3>
<p>和标准的集合一样，你可以使用 <code>asset catalogs</code> 来管理你自己的图片，图片都是包含在<code>ImageSet</code>中的，并且可以使用管理对应的retina和非retina图像。</p>
<p><img src="https://blog-andy0570-1256077835.cos.ap-shanghai.myqcloud.com/site_Images/072640.jpg" alt></p>
<p>使用方法：<code>UIImage:imageNamed:</code></p>
<p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">UIImage *image = [UIImage imageNamed:@&quot;Australia&quot;];</span><br></pre></td></tr></table></figure></p>
<blockquote>
<p>💡 加载图片还涉及到缓存问题，参考之前写的文章：</p>
<p><a href="http://www.jianshu.com/p/9d858f073863" target="_blank" rel="noopener">UIImage 使用Tips</a></p>
</blockquote>
<h3>Slicing images - 切片图像</h3>
<p>Asset catalogs 的另外一个主要的特性就是能够让图像进行切片工作，自从iOS2开始程序就能够使用切片的图像了，但是Xcode中的这个新特性会变得非常的简单。</p>
<p>使用切片变换图像，是创建虚拟的元素基本的技术。例如按钮，需要拉伸这个按钮图片的大小达到一个新的大小，并且要设置边缘不被拉伸，只拉伸中间的部分。</p>
<p>在 Asset catalog 中就可以使用Xcode提供的功能进行切片操作了，开启切片功能，只需要点击<code>Show Slicing</code>按钮,你可以选择水平、竖直或者两者都拉伸的方式,如果你选择之后，图像将会重新加载并且上面会出现拉伸辅助线，你可以通过拖拽辅助线，来实现自己需要拉伸的效果。</p>
<p><img src="https://blog-andy0570-1256077835.cos.ap-shanghai.myqcloud.com/site_Images/072643.jpg" alt></p>
<p>使用这些切片图像编程非常的简单，和之前一样创建一个<code>UIImage</code>对象，然后当你调整<code>UIImageView</code>的大小，内部的image就会自动根据切片的图像来变换大小。</p>
<p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">UIImage *btnImage = [UIImage imageNamed:@&quot;ButtonSlice&quot;];</span><br><span class="line"></span><br><span class="line">// Let&apos;s make 2</span><br><span class="line">UIImageView *iv = [[UIImageView alloc] initWithImage:btnImage];</span><br><span class="line">iv.bounds = CGRectMake(0, 0, 150, CGRectGetHeight(iv.bounds));</span><br><span class="line">iv.center = CGPointMake(CGRectGetWidth(self.view.bounds) / 2, 300);</span><br><span class="line">[self.view addSubview:iv];</span><br><span class="line"></span><br><span class="line">// And a stretched version</span><br><span class="line">iv = [[UIImageView alloc] initWithImage:btnImage];</span><br><span class="line">iv.bounds = CGRectMake(0, 0, 300, CGRectGetHeight(iv.bounds));</span><br><span class="line">iv.center = CGPointMake(CGRectGetWidth(self.view.bounds) / 2, 350);</span><br><span class="line">[self.view addSubview:iv];</span><br></pre></td></tr></table></figure></p>
<p><img src="https://blog-andy0570-1256077835.cos.ap-shanghai.myqcloud.com/site_Images/072645.jpg" alt></p>
<h4>步骤详解：</h4>
<ol>
<li>点击<code>Show Slicing</code> 按钮？</li>
</ol>
<p><img src="https://blog-andy0570-1256077835.cos.ap-shanghai.myqcloud.com/site_Images/072646.jpg" alt></p>
<ol start="2">
<li>
<p>选择拉伸模式：</p>
<p>支持三种模式：水平拉伸、水平和垂直同时拉伸、垂直拉伸。</p>
<p><img src="https://blog-andy0570-1256077835.cos.ap-shanghai.myqcloud.com/site_Images/072647.jpg" alt></p>
</li>
<li>
<p>设置拉伸句柄：</p>
<p><img src="https://blog-andy0570-1256077835.cos.ap-shanghai.myqcloud.com/site_Images/072650-1.jpg" alt></p>
</li>
<li>
<p>代码添加图片：</p>
<p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">UIImage *image = [UIImage imageNamed:@&quot;bird&quot;];</span><br><span class="line"></span><br><span class="line">// default</span><br><span class="line">UIImageView *imageView = [[UIImageView alloc] initWithImage:image];</span><br><span class="line">imageView.bounds = CGRectMake(0, 0, 50, 37.5);</span><br><span class="line">imageView.center = CGPointMake(CGRectGetWidth(self.view.bounds) / 2, 300);</span><br><span class="line">[self.view addSubview:imageView];</span><br><span class="line"></span><br><span class="line">// stretch</span><br><span class="line">UIImageView *stretchImgView = [[UIImageView alloc] initWithImage:image];</span><br><span class="line">stretchImgView.bounds = CGRectMake(0, 0, 100, 75);</span><br><span class="line">stretchImgView.center = CGPointMake(CGRectGetWidth(self.view.bounds) / 2, 400);</span><br><span class="line">[self.view addSubview:stretchImgView];</span><br></pre></td></tr></table></figure></p>
</li>
<li>
<p>效果：用【填充部分】去覆盖【可扩展部分】</p>
<p><img src="https://blog-andy0570-1256077835.cos.ap-shanghai.myqcloud.com/site_Images/072652.jpg" alt></p>
</li>
</ol>
<h3>ImageOptim - 超好用的图像压缩工具</h3>
<p><a href="https://imageoptim.com/mac" target="_blank" rel="noopener">ImageOptim</a> 是一个免费的图像压缩工具。iOS 工程默认使用 pngcrush 命令来压缩数据，不过其压缩比率不是很高。而使用 <strong>ImageOptim</strong> 可以达到最大的图片压缩效果。</p>
<p>实现原理：使用各种开源的图像压缩工具，然后取压缩效果最好的那一个。</p>
<p>使用方法也非常简单：在 Finder 中打开图片所在的文件夹，将图片拖拽进 <strong>ImageOptim</strong> 界面中即可。</p>
<p>其他图像压缩工具：</p>
<ul>
<li><a href="http://optimizilla.com/zh/" target="_blank" rel="noopener">Optimizilla</a> ——在线图像优化压缩器</li>
</ul>
<h3>附录：</h3>
<p>摘自官方人机交互指南：<a href="https://developer.apple.com/ios/human-interface-guidelines/#//apple_ref/doc/uid/TP40006556-CH27-SW1" target="_blank" rel="noopener">iOS Human Interface Guidelines</a></p>
<h4>图片大小和分辨率（Image Size and Resolution）</h4>
<table>
<thead>
<tr>
<th>设备</th>
<th>比例系数</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>iPhone 7 Plus and iPhone 6s Plus</strong></td>
<td>@3x</td>
</tr>
<tr>
<td><strong>其余高分辨率的 iOS 设备</strong></td>
<td>@2x</td>
</tr>
</tbody>
</table>
<h5>App Icon</h5>
<table>
<thead>
<tr>
<th>设备或状况</th>
<th>图标大小</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>iPhone</strong></td>
<td>180px × 180px (60pt × 60pt @3x)</td>
</tr>
<tr>
<td></td>
<td>120px × 120px (60pt × 60pt @2x)</td>
</tr>
<tr>
<td><strong>iPad Pro</strong></td>
<td>167px × 167px (83.5pt × 83.5pt @2x)</td>
</tr>
<tr>
<td><strong>iPad, iPad mini</strong></td>
<td>152px × 152px (76pt × 76pt @2x)</td>
</tr>
<tr>
<td><strong>App Store</strong></td>
<td>1024px × 1024px</td>
</tr>
</tbody>
</table>
<h5>Spotlight, Settings, and Notification Icons</h5>
<h5>Spotlight</h5>
<table>
<thead>
<tr>
<th>设备</th>
<th>Spotlight 图标大小</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>iPhone</strong></td>
<td>120px × 120px (40pt × 40pt @3x)</td>
</tr>
<tr>
<td></td>
<td>80px × 80px (40pt × 40pt @2x)</td>
</tr>
<tr>
<td><strong>iPad Pro, iPad, iPad mini</strong></td>
<td>80px × 80px (40pt × 40pt @2x)</td>
</tr>
</tbody>
</table>
<hr>
<h5>Settings</h5>
<table>
<thead>
<tr>
<th>设备</th>
<th>Settings 图标大小</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>iPhone</strong></td>
<td>87px × 87px (29pt × 29pt @3x)</td>
</tr>
<tr>
<td></td>
<td>58px × 58px (29pt × 29pt @2x)</td>
</tr>
<tr>
<td><strong>iPad Pro, iPad, iPad mini</strong></td>
<td>58px × 58px (29pt × 29pt @2x)</td>
</tr>
</tbody>
</table>
<hr>
<h5>Notification</h5>
<table>
<thead>
<tr>
<th>设备</th>
<th>Notification 图标大小</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>iPhone</strong></td>
<td>60px × 60px (20pt × 20pt @3x)</td>
</tr>
<tr>
<td></td>
<td>40px × 40px (20pt × 20pt @2x)</td>
</tr>
<tr>
<td><strong>iPad Pro, iPad, iPad mini</strong></td>
<td>40px × 40px (20pt × 20pt @2x)</td>
</tr>
</tbody>
</table>
<h5>自定义图标大小</h5>
<table>
<thead>
<tr>
<th></th>
<th>导航栏和工具栏图标尺寸</th>
<th>标签栏图标尺寸</th>
</tr>
</thead>
<tbody>
<tr>
<td>推荐</td>
<td>75px × 75px (25pt × 25pt @3x)</td>
<td>75px × 75px (25pt × 25pt @3x)</td>
</tr>
<tr>
<td></td>
<td>50px × 50px (25pt × 25pt @2x)</td>
<td>50px × 50px (25pt × 25pt @2x)</td>
</tr>
<tr>
<td>最大</td>
<td>83px × 83px (27.67pt × 27.67pt @3x)</td>
<td>144px × 96px (48pt × 32pt @3x)</td>
</tr>
<tr>
<td></td>
<td>56px × 56px (28pt × 28pt @2x)</td>
<td>96px × 64px (48pt × 32pt @2x)</td>
</tr>
</tbody>
</table>
<h4>启动画面（Launch Screen）</h4>
<h5>静态启动画面图片</h5>
<table>
<thead>
<tr>
<th>设备</th>
<th>Portrait size</th>
<th>Landscape size</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>iPhone 7 Plus, iPhone 6s Plus</strong></td>
<td>1242px × 2208px</td>
<td>2208px × 1242px</td>
</tr>
<tr>
<td><strong>iPhone 7, iPhone 6s</strong></td>
<td>750px × 1334px</td>
<td>1334px × 750px</td>
</tr>
<tr>
<td><strong>iPhone SE</strong></td>
<td>640px × 1136px</td>
<td>1136px × 640px</td>
</tr>
<tr>
<td><strong>12.9-inch iPad Pro</strong></td>
<td>2048px × 2732px</td>
<td>2732px × 2048px</td>
</tr>
<tr>
<td><strong>9.7-inch iPad Pro, iPad Air 2, iPad mini 4, iPad mini 2</strong></td>
<td>1536px × 2048px</td>
<td>2048px × 1536px</td>
</tr>
</tbody>
</table>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://andy0570.com/2017/09/01/天天品尝iOS7甜点 Day1：NSURLSession/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="独木舟的木">
      <meta itemprop="description" content="有时候阳光很好 有时候阳光很暗">
      <meta itemprop="image" content="https://blog-andy0570-1256077835.cos.ap-shanghai.myqcloud.com/site_Images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="独木舟的木">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2017/09/01/天天品尝iOS7甜点 Day1：NSURLSession/" class="post-title-link" itemprop="url">天天品尝iOS7甜点 Day1：NSURLSession</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2017-09-01 15:26:00" itemprop="dateCreated datePublished" datetime="2017-09-01T15:26:00+08:00">2017-09-01</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2019-05-01 21:19:13" itemprop="dateModified" datetime="2019-05-01T21:19:13+08:00">2019-05-01</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/iOS/" itemprop="url" rel="index"><span itemprop="name">iOS</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          

          

          
            <div class="post-symbolscount">
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">本文字数：</span>
                
                <span title="本文字数">12k</span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">11 分钟</span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body han-init-context" itemprop="articleBody">

      
      

      
        
          
            <p>与 <strong>NSURLSession</strong> API 相关的内容。</p>
<h3>参考：</h3>
<ul>
<li><a href="https://github.com/ShinobiControls/iOS7-day-by-day" target="_blank" rel="noopener">GitHub 源码：shinobicontrols/iOS7-day-by-day</a></li>
<li><a href="http://blog.kingiol.com/2014/01/06/ios7-day-by-day-day1-nsurlsession/" target="_blank" rel="noopener">天天品尝iOS7甜点 :: Day 1 :: NSURLSession</a></li>
</ul>
<p>&lt;!-- more --&gt;</p>
<h3>NSURLSessionConfiguration</h3>
<p>创建 <strong>NSURLSessionConfiguration</strong> 对象的三种方式：</p>
<p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">// 默认会话配置</span><br><span class="line">NSURLSessionConfiguration *defaultConfig = [NSURLSessionConfiguration defaultSessionConfiguration];</span><br><span class="line"></span><br><span class="line">// 短暂会话配置,无缓存(caches),cookies,证书(credentials)</span><br><span class="line">NSURLSessionConfiguration *ephemeralConfig = [NSURLSessionConfiguration ephemeralSessionConfiguration];</span><br><span class="line"></span><br><span class="line">// 后台会话配置</span><br><span class="line">NSURLSessionConfiguration *backgroundConfig = [NSURLSessionConfiguration backgroundSessionConfigurationWithIdentifier:@&quot;com.Apple.BackgroundDownload.BackgroundSession&quot;];</span><br></pre></td></tr></table></figure></p>
<h3>NSURLSession</h3>
<p>创建 <strong>NSURLSession</strong> 对象的三种方式：</p>
<p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">// 1. 单例类会话,便捷创建方法</span><br><span class="line">NSURLSession *sharedSession = [NSURLSession sharedSession];</span><br><span class="line"></span><br><span class="line">// 2. sessionWithConfiguration:</span><br><span class="line">// 一般用 Block 处理服务器回调时使用</span><br><span class="line">// 默认会话</span><br><span class="line">NSURLSession *defaultSession = [NSURLSession sessionWithConfiguration:defaultConfig];</span><br><span class="line">// 短暂会话</span><br><span class="line">NSURLSession *ephemeralSesson = [NSURLSession sessionWithConfiguration:ephemeralConfig];</span><br><span class="line">// 后台会话</span><br><span class="line">NSURLSession *backgroundSession = [NSURLSession sessionWithConfiguration:backgroundConfig];</span><br><span class="line"></span><br><span class="line">// 3. sessionWithConfiguration:delegate:delegateQueue:</span><br><span class="line">// 需要实现委托协议或者指定线程的创建方法</span><br><span class="line">NSOperationQueue *operationQueue = [NSOperationQueue mainQueue];</span><br><span class="line">// 默认会话</span><br><span class="line">NSURLSession *defalutSession1 = [NSURLSession sessionWithConfiguration:defaultConfig delegate:self delegateQueue:operationQueue];</span><br><span class="line">// 短暂会话</span><br><span class="line">NSURLSession *ephemeralSesson1 = [NSURLSession sessionWithConfiguration:ephemeralConfig delegate:self delegateQueue:operationQueue];</span><br><span class="line">// 后台会话</span><br><span class="line">NSURLSession *backgroundSession1 = [NSURLSession sessionWithConfiguration:backgroundConfig delegate:self delegateQueue:operationQueue];</span><br></pre></td></tr></table></figure></p>
<h4>NSURLSessionTask</h4>
<p>⚠️ 创建 <strong>NSURLSessionTask</strong> 对象有四种种方式：</p>
<blockquote>
<ol>
<li>数据任务(NSURLSessionDataTask)</li>
<li>上传任务(NSURLSessionUploadTask)</li>
<li>下载任务(NSURLSessionDownloadTask)</li>
<li>流任务（NSURLSessionStreamTask）：WWDC2015新增，提供 TCP/IP 连接接口。</li>
</ol>
</blockquote>
<p><img src="https://blog-andy0570-1256077835.cos.ap-shanghai.myqcloud.com/site_Images/071444.jpg" alt></p>
<h4>NSURLSessionDelegate 委托协议</h4>
<p><img src="https://blog-andy0570-1256077835.cos.ap-shanghai.myqcloud.com/site_Images/071445.jpg" alt></p>
<p>示例 Demo</p>
<p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br></pre></td><td class="code"><pre><span class="line">// *************************************************</span><br><span class="line">// SCViewController.h</span><br><span class="line">#import &lt;UIKit/UIKit.h&gt;</span><br><span class="line"></span><br><span class="line">@interface SCViewController : UIViewController</span><br><span class="line"></span><br><span class="line">@property (strong, nonatomic) NSURLSessionDownloadTask *resumableTask;   // 可恢复任务</span><br><span class="line">@property (strong, nonatomic) NSURLSessionDownloadTask *backgroundTask;  // 后台任务</span><br><span class="line"></span><br><span class="line">@property (strong, nonatomic, readonly) NSURLSession *backgroundSession; // 后台会话</span><br><span class="line"></span><br><span class="line">@property (weak, nonatomic) IBOutlet UIImageView *imageView;</span><br><span class="line">@property (weak, nonatomic) IBOutlet UIProgressView *progressIndicator;</span><br><span class="line">@property (strong, nonatomic) IBOutletCollection(UIBarButtonItem) NSArray *startButtons;</span><br><span class="line"></span><br><span class="line">- (IBAction)startCancellable:(id)sender;  // 开始任务</span><br><span class="line">- (IBAction)cancelCancellable:(id)sender; // 取消任务</span><br><span class="line">- (IBAction)startResumable:(id)sender;    // 恢复任务</span><br><span class="line">- (IBAction)startBackground:(id)sender;   // 后台任务</span><br><span class="line"></span><br><span class="line">@end</span><br><span class="line"></span><br><span class="line">// *************************************************</span><br><span class="line">// SCViewController.m</span><br><span class="line">#import &quot;SCViewController.h&quot;</span><br><span class="line">#import &quot;SCAppDelegate.h&quot;</span><br><span class="line"></span><br><span class="line">@interface SCViewController () &lt;NSURLSessionDownloadDelegate&gt; &#123;</span><br><span class="line">    NSURLSessionDownloadTask *cancellableTask; // 可取消任务</span><br><span class="line">    NSURLSession *inProcessSession; // 私有会话</span><br><span class="line">    NSData *partialDownload; // 后台下载临时数据</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@end</span><br><span class="line"></span><br><span class="line">@implementation SCViewController</span><br><span class="line"></span><br><span class="line">#pragma mark - Lifecycle</span><br><span class="line">- (void)viewDidLoad</span><br><span class="line">&#123;</span><br><span class="line">    [super viewDidLoad];</span><br><span class="line">	// 从 nib 文件加载视图后，进行额外的初始化工作</span><br><span class="line">    self.progressIndicator.hidden = YES;</span><br><span class="line">    self.progressIndicator.progress = 0;</span><br><span class="line">    </span><br><span class="line">    // Make sure that we&apos;ve attached to the background session</span><br><span class="line">    self.backgroundSession.sessionDescription = @&quot;Background session&quot;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#pragma mark - Custom Accessors</span><br><span class="line">// 后台会话，单例类</span><br><span class="line">- (NSURLSession *)backgroundSession</span><br><span class="line">&#123;</span><br><span class="line">    static NSURLSession *backgroundSession = nil;</span><br><span class="line">    static dispatch_once_t onceToken;</span><br><span class="line">    dispatch_once(&amp;onceToken, ^&#123;</span><br><span class="line">        NSURLSessionConfiguration *config = [NSURLSessionConfiguration backgroundSessionConfigurationWithIdentifier:@&quot;com.shinobicontrols.BackgroundDownload.BackgroundSession&quot;];</span><br><span class="line">        backgroundSession = [NSURLSession sessionWithConfiguration:config</span><br><span class="line">                                                          delegate:self</span><br><span class="line">                                                     delegateQueue:nil];</span><br><span class="line">    &#125;);</span><br><span class="line">    return backgroundSession;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#pragma mark - IBActions</span><br><span class="line">// 开始任务</span><br><span class="line">- (IBAction)startCancellable:(id)sender &#123;</span><br><span class="line">    if (!cancellableTask) &#123;</span><br><span class="line">        if(!inProcessSession) &#123;</span><br><span class="line">            // 创建默认会话</span><br><span class="line">            NSURLSessionConfiguration *sessionConfig = [NSURLSessionConfiguration defaultSessionConfiguration];</span><br><span class="line">            inProcessSession = [NSURLSession sessionWithConfiguration:sessionConfig</span><br><span class="line">                                                             delegate:self</span><br><span class="line">                                                        delegateQueue:nil];</span><br><span class="line">            inProcessSession.sessionDescription = @&quot;in-process NSURLSession&quot;;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        // Image CreativeCommons courtesy of flickr.com/charliematters</span><br><span class="line">        NSString *url = @&quot;http://farm6.staticflickr.com/5505/9824098016_0e28a047c2_b_d.jpg&quot;;</span><br><span class="line">        NSURLRequest *request = [NSURLRequest requestWithURL:[NSURL URLWithString:url]];</span><br><span class="line">        </span><br><span class="line">        // 创建可取消任务</span><br><span class="line">        cancellableTask = [inProcessSession downloadTaskWithRequest:request];</span><br><span class="line">        </span><br><span class="line">        [self setDownloadButtonsAsEnabled:NO];</span><br><span class="line">        self.imageView.hidden = YES;</span><br><span class="line">        </span><br><span class="line">        // 开启下载任务</span><br><span class="line">        [cancellableTask resume];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 取消任务</span><br><span class="line">- (IBAction)cancelCancellable:(id)sender &#123;</span><br><span class="line">    if(cancellableTask) &#123;</span><br><span class="line">        // 1. 可取消任务</span><br><span class="line">        [cancellableTask cancel];</span><br><span class="line">        cancellableTask = nil;</span><br><span class="line">    &#125; else if(self.resumableTask) &#123;</span><br><span class="line">        // 2. 可恢复任务</span><br><span class="line">        [self.resumableTask cancelByProducingResumeData:^(NSData *resumeData) &#123;</span><br><span class="line">            // ❇️ 缓存已下载数据</span><br><span class="line">            partialDownload = resumeData;</span><br><span class="line">            self.resumableTask = nil;</span><br><span class="line">        &#125;];</span><br><span class="line">    &#125; else if(self.backgroundTask) &#123;</span><br><span class="line">        // 3. 后台任务</span><br><span class="line">        [self.backgroundTask cancel];</span><br><span class="line">        self.backgroundTask = nil;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 恢复任务</span><br><span class="line">- (IBAction)startResumable:(id)sender &#123;</span><br><span class="line">    if(!self.resumableTask) &#123;</span><br><span class="line">        if(!inProcessSession) &#123;</span><br><span class="line">            // 创建默认会话</span><br><span class="line">            NSURLSessionConfiguration *sessionConfig = [NSURLSessionConfiguration defaultSessionConfiguration];</span><br><span class="line">            inProcessSession = [NSURLSession sessionWithConfiguration:sessionConfig delegate:self delegateQueue:nil];</span><br><span class="line">            inProcessSession.sessionDescription = @&quot;in-process NSURLSession&quot;;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        if(partialDownload) &#123;</span><br><span class="line">            // 1. 如果存在缓存数据，继续下载此任务</span><br><span class="line">            self.resumableTask = [inProcessSession downloadTaskWithResumeData:partialDownload];</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            // 2. 如果不存在缓存，新建可恢复任务</span><br><span class="line">            // Image CreativeCommons courtesy of flickr.com/charliematters</span><br><span class="line">            NSString *url = @&quot;http://farm3.staticflickr.com/2846/9823925914_78cd653ac9_b_d.jpg&quot;;</span><br><span class="line">            NSURLRequest *request = [NSURLRequest requestWithURL:[NSURL URLWithString:url]];</span><br><span class="line">            // 创建可恢复任务</span><br><span class="line">            self.resumableTask = [inProcessSession downloadTaskWithRequest:request];</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        [self setDownloadButtonsAsEnabled:NO];</span><br><span class="line">        self.imageView.hidden = YES;</span><br><span class="line">        </span><br><span class="line">        // 开启下载任务</span><br><span class="line">        [self.resumableTask resume];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 开始后台任务</span><br><span class="line">- (IBAction)startBackground:(id)sender &#123;</span><br><span class="line">    // Image CreativeCommons courtesy of flickr.com/charliematters</span><br><span class="line">    NSString *url = @&quot;http://farm3.staticflickr.com/2831/9823890176_82b4165653_b_d.jpg&quot;;</span><br><span class="line">    NSURLRequest *request = [NSURLRequest requestWithURL:[NSURL URLWithString:url]];</span><br><span class="line">    </span><br><span class="line">    // self.backgroundSession 是单例对象</span><br><span class="line">    self.backgroundTask = [self.backgroundSession downloadTaskWithRequest:request];</span><br><span class="line">    </span><br><span class="line">    [self setDownloadButtonsAsEnabled:NO];</span><br><span class="line">    self.imageView.hidden = YES;</span><br><span class="line">    </span><br><span class="line">    // 开启下载任务</span><br><span class="line">    [self.backgroundTask resume];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#pragma mark - Private</span><br><span class="line">- (void)setDownloadButtonsAsEnabled:(BOOL)enabled</span><br><span class="line">&#123;</span><br><span class="line">    // 更新按钮 enable 状态</span><br><span class="line">    for(UIBarButtonItem *btn in self.startButtons) &#123;</span><br><span class="line">        btn.enabled = enabled;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#pragma mark - NSURLSessionDownloadDelegate</span><br><span class="line"></span><br><span class="line">// 追踪下载任务进度，更新进度条</span><br><span class="line">- (void)URLSession:(NSURLSession *)session downloadTask:(NSURLSessionDownloadTask *)downloadTask didWriteData:(int64_t)bytesWritten totalBytesWritten:(int64_t)totalBytesWritten totalBytesExpectedToWrite:(int64_t)totalBytesExpectedToWrite</span><br><span class="line">&#123;</span><br><span class="line">    double currentProgress = totalBytesWritten / (double)totalBytesExpectedToWrite;</span><br><span class="line">    dispatch_async(dispatch_get_main_queue(), ^&#123;</span><br><span class="line">        self.progressIndicator.hidden = NO;</span><br><span class="line">        self.progressIndicator.progress = currentProgress;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 恢复下载后调用</span><br><span class="line">- (void)URLSession:(NSURLSession *)session downloadTask:(NSURLSessionDownloadTask *)downloadTask didResumeAtOffset:(int64_t)fileOffset expectedTotalBytes:(int64_t)expectedTotalBytes</span><br><span class="line">&#123;</span><br><span class="line">    // Leave this for now</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 下载任务成功后调用</span><br><span class="line">- (void)URLSession:(NSURLSession *)session downloadTask:(NSURLSessionDownloadTask *)downloadTask didFinishDownloadingToURL:(NSURL *)location</span><br><span class="line">&#123;</span><br><span class="line">    // We&apos;ve successfully finished the download. Let&apos;s save the file</span><br><span class="line">    // 保存到文件</span><br><span class="line">    NSFileManager *fileManager = [NSFileManager defaultManager];</span><br><span class="line">    </span><br><span class="line">    NSArray *URLs = [fileManager URLsForDirectory:NSDocumentDirectory inDomains:NSUserDomainMask];</span><br><span class="line">    NSURL *documentsDirectory = URLs[0];</span><br><span class="line">    </span><br><span class="line">    NSURL *destinationPath = [documentsDirectory URLByAppendingPathComponent:[location lastPathComponent]];</span><br><span class="line">    NSError *error;</span><br><span class="line">    </span><br><span class="line">    // 先删除文件中已经存在的任何文件</span><br><span class="line">    [fileManager removeItemAtURL:destinationPath error:NULL];</span><br><span class="line">    BOOL success = [fileManager copyItemAtURL:location toURL:destinationPath error:&amp;error];</span><br><span class="line">    </span><br><span class="line">    if (success) &#123;</span><br><span class="line">        // 保存到文件后，更新主线程 UI</span><br><span class="line">        dispatch_async(dispatch_get_main_queue(), ^&#123;</span><br><span class="line">            UIImage *image = [UIImage imageWithContentsOfFile:[destinationPath path]];</span><br><span class="line">            self.imageView.image = image;</span><br><span class="line">            self.imageView.contentMode = UIViewContentModeScaleAspectFill;</span><br><span class="line">            self.imageView.hidden = NO;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;else &#123;</span><br><span class="line">        NSLog(@&quot;Couldn&apos;t copy the downloaded file&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    // ❇️ 会话置空，解除循环引用</span><br><span class="line">    if(downloadTask == cancellableTask) &#123;</span><br><span class="line">        cancellableTask = nil;</span><br><span class="line">    &#125; else if (downloadTask == self.resumableTask) &#123;</span><br><span class="line">        self.resumableTask = nil;</span><br><span class="line">        partialDownload = nil;</span><br><span class="line">    &#125; else if (session == self.backgroundSession) &#123;</span><br><span class="line">        // 后台会话</span><br><span class="line">        self.backgroundTask = nil;</span><br><span class="line">        // Get hold of the app delegate</span><br><span class="line">        SCAppDelegate *appDelegate = (SCAppDelegate *)[[UIApplication sharedApplication] delegate];</span><br><span class="line">        if(appDelegate.backgroundURLSessionCompletionHandler) &#123;</span><br><span class="line">            // Need to copy the completion handler</span><br><span class="line">            void (^handler)() = appDelegate.backgroundURLSessionCompletionHandler;</span><br><span class="line">            appDelegate.backgroundURLSessionCompletionHandler = nil;</span><br><span class="line">            handler();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#pragma mark - NSURLSessionTaskDelegate</span><br><span class="line">// 每一个任务结束的时候执行-NSURLSessionDelegate,不管任务是不是正常结束:</span><br><span class="line">- (void)URLSession:(NSURLSession *)session task:(NSURLSessionTask *)task didCompleteWithError:(NSError *)error &#123;</span><br><span class="line">    // 主线程更新 UI</span><br><span class="line">    dispatch_async(dispatch_get_main_queue(), ^&#123;</span><br><span class="line">        self.progressIndicator.hidden = YES;</span><br><span class="line">        [self setDownloadButtonsAsEnabled:YES];</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@end</span><br></pre></td></tr></table></figure></p>
<p>开启后台下载任务时，即使关闭了应用程序，这个下载任务依然在后台运行。</p>
<p>当这个下载任务完成后，iOS将会重新启动app来让任务知道，对这个我们不必放在心上。为了达到这个目的，我们可以在app的代理中调用下面的代码:</p>
<p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">- (void)application:(UIApplication *)application handleEventsForBackgroundURLSession:(NSString *)identifier completionHandler:(void (^)())completionHandler</span><br><span class="line">&#123;</span><br><span class="line">    self.backgroundURLSessionCompletionHandler = completionHandler;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3>效果</h3>
<p><img src="http://upload-images.jianshu.io/upload_images/2648731-26ce50a3e3637801.gif?imageMogr2/auto-orient/strip" alt></p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://andy0570.com/2017/09/01/天天品尝iOS7甜点 Day0：UIKit Dynamics/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="独木舟的木">
      <meta itemprop="description" content="有时候阳光很好 有时候阳光很暗">
      <meta itemprop="image" content="https://blog-andy0570-1256077835.cos.ap-shanghai.myqcloud.com/site_Images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="独木舟的木">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2017/09/01/天天品尝iOS7甜点 Day0：UIKit Dynamics/" class="post-title-link" itemprop="url">天天品尝iOS7甜点 Day0：UIKit Dynamics</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2017-09-01 11:08:00" itemprop="dateCreated datePublished" datetime="2017-09-01T11:08:00+08:00">2017-09-01</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2019-05-01 21:19:26" itemprop="dateModified" datetime="2019-05-01T21:19:26+08:00">2019-05-01</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/iOS/" itemprop="url" rel="index"><span itemprop="name">iOS</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          

          

          
            <div class="post-symbolscount">
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">本文字数：</span>
                
                <span title="本文字数">7.8k</span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">7 分钟</span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body han-init-context" itemprop="articleBody">

      
      

      
        
          
            <p><strong>UIKit Dyanmics</strong> 是 <strong>UIKit</strong> 下的一个二维的物理引擎。</p>
<h3>参考：</h3>
<ul>
<li><a href="https://github.com/ShinobiControls/iOS7-day-by-day" target="_blank" rel="noopener">GitHub 源码：shinobicontrols/iOS7-day-by-day</a></li>
<li><a href="http://blog.kingiol.com/archives/page/4/" target="_blank" rel="noopener">天天品尝iOS7甜点 :: Day 0 :: UIKit Dynamics</a></li>
</ul>
<p>&lt;!-- more --&gt;</p>
<h3>关键的几个类:</h3>
<h4>UIDynamicBehavior 模拟对象的行为</h4>
<p><img src="https://blog-andy0570-1256077835.cos.ap-shanghai.myqcloud.com/site_Images/071507.jpg" alt></p>
<h4>UIDynamicAnimator 物理引擎</h4>
<p><strong>UIDynamicAnimator</strong> 自己可以根据不同的行为来计算不同对象间的相互影响。</p>
<p><img src="https://blog-andy0570-1256077835.cos.ap-shanghai.myqcloud.com/site_Images/071508.jpg" alt></p>
<p>使用方法总结：</p>
<ol>
<li>用 <strong>UIDynamicBehavior</strong> 的子类对象设置不同物体各自的行为或者它们通用的行为，然后将它们添加到 <strong>UIDynamicBehavior</strong> 实例对象上，</li>
<li>将 <strong>UIDynamicBehavior</strong> 实例对象添加到 <strong>UIDynamicAnimator</strong> 物理引擎上。</li>
</ol>
<h3>Demo源码：牛顿摆钟</h3>
<p>该 Demo 构建一个牛顿摆钟模拟重力实验。
<img src="https://blog-andy0570-1256077835.cos.ap-shanghai.myqcloud.com/site_Images/071509.jpg" alt></p>
<h4>SCBallBearingView</h4>
<p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">// **********************************************</span><br><span class="line">#import &lt;UIKit/UIKit.h&gt;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> 圆形钟摆球模型</span><br><span class="line"> */</span><br><span class="line">@interface SCBallBearingView : UIView</span><br><span class="line">@end</span><br><span class="line"></span><br><span class="line">// **********************************************</span><br><span class="line">#import &quot;SCBallBearingView.h&quot;</span><br><span class="line">@import QuartzCore;</span><br><span class="line"></span><br><span class="line">@implementation SCBallBearingView</span><br><span class="line"></span><br><span class="line">- (id)initWithFrame:(CGRect)frame</span><br><span class="line">&#123;</span><br><span class="line">    self = [super initWithFrame:frame];</span><br><span class="line">    if (self) &#123;</span><br><span class="line">        // 初始化代码</span><br><span class="line">        self.backgroundColor = [UIColor lightGrayColor];</span><br><span class="line">        self.layer.cornerRadius = MIN(CGRectGetHeight(frame), CGRectGetWidth(frame)) / 2.0;</span><br><span class="line">        self.layer.borderColor = [UIColor grayColor].CGColor;</span><br><span class="line">        self.layer.borderWidth = 2;</span><br><span class="line">    &#125;</span><br><span class="line">    return self;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@end</span><br></pre></td></tr></table></figure></p>
<h4>❇️ SCNewtonsCradleView</h4>
<p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br></pre></td><td class="code"><pre><span class="line">// **********************************************</span><br><span class="line">#import &lt;UIKit/UIKit.h&gt;</span><br><span class="line"></span><br><span class="line">@interface SCNewtonsCradleView : UIView</span><br><span class="line">@end</span><br><span class="line"></span><br><span class="line">// **********************************************</span><br><span class="line">#import &quot;SCNewtonsCradleView.h&quot;</span><br><span class="line">#import &quot;SCBallBearingView.h&quot;</span><br><span class="line"></span><br><span class="line">@implementation SCNewtonsCradleView &#123;</span><br><span class="line">    NSArray *_ballBearings;             // 钟摆球容器</span><br><span class="line">    UIDynamicAnimator *_animator;       // 用于控制行为的物理引擎</span><br><span class="line">    UIPushBehavior *_userDragBehavior;  // 手势的线性力量</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (id)initWithFrame:(CGRect)frame</span><br><span class="line">&#123;</span><br><span class="line">    self = [super initWithFrame:frame];</span><br><span class="line">    if (self) &#123;</span><br><span class="line">        // 初始化代码</span><br><span class="line">        [self createBallBearings];</span><br><span class="line">        [self applyDynamicBehaviors];</span><br><span class="line">        </span><br><span class="line">        // 初始化时施加推力让钟摆球摇摆</span><br><span class="line">        _userDragBehavior = [[UIPushBehavior alloc] initWithItems:@[_ballBearings[0]] mode:UIPushBehaviorModeInstantaneous];</span><br><span class="line">        _userDragBehavior.pushDirection = CGVectorMake(-0.5, 0);</span><br><span class="line">        [_animator addBehavior:_userDragBehavior];</span><br><span class="line">    &#125;</span><br><span class="line">    return self;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 1.创建5个钟摆球</span><br><span class="line">- (void)createBallBearings</span><br><span class="line">&#123;</span><br><span class="line">    NSMutableArray *bbArray = [NSMutableArray array];</span><br><span class="line">    NSUInteger numberBalls = 5;</span><br><span class="line">    CGFloat ballSize = CGRectGetWidth(self.bounds) / (3.0 * (numberBalls - 1));</span><br><span class="line">    </span><br><span class="line">    for (NSUInteger i=0; i&lt;numberBalls; i++) &#123;</span><br><span class="line">        // 钟摆球需要设置得足够小，使它们之间静态摆放时仍留有间隙。</span><br><span class="line">        SCBallBearingView *bb = [[SCBallBearingView alloc] initWithFrame:CGRectMake(0, 0, ballSize - 1, ballSize - 1)];</span><br><span class="line">        </span><br><span class="line">        // 把每个钟摆球放到合适的位置</span><br><span class="line">        CGFloat x = CGRectGetWidth(self.bounds) / 3.0 + i * ballSize;</span><br><span class="line">        CGFloat y = CGRectGetHeight(self.bounds) / 2.0;</span><br><span class="line">        bb.center = CGPointMake(x, y);</span><br><span class="line">        </span><br><span class="line">        // 为每个钟摆球添加一个手势操作，这样可以通过手势来摆弄钟摆球模型:</span><br><span class="line">        UIPanGestureRecognizer *gesture = [[UIPanGestureRecognizer alloc] initWithTarget:self action:@selector(handleBallBearingPan:)];</span><br><span class="line">        [bb addGestureRecognizer:gesture];</span><br><span class="line">        </span><br><span class="line">        // 把钟摆球添加进数组中，并添加为当前页面子视图</span><br><span class="line">        [bbArray addObject:bb];</span><br><span class="line">        [self addSubview:bb];</span><br><span class="line">    &#125;</span><br><span class="line">    _ballBearings = [NSArray arrayWithArray:bbArray];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#pragma mark - UIDynamics utility methods</span><br><span class="line">// 2.添加动力行为</span><br><span class="line">- (void)applyDynamicBehaviors</span><br><span class="line">&#123;</span><br><span class="line">    // 创建一个复合的行为集合 UIDynamicBehavior (可以包含很多基本行为)</span><br><span class="line">    UIDynamicBehavior *behavior = [[UIDynamicBehavior alloc] init];</span><br><span class="line">    </span><br><span class="line">    // 将每个球轴承安装到其枢轴点</span><br><span class="line">    for(id&lt;UIDynamicItem&gt; ballBearing in _ballBearings)</span><br><span class="line">    &#123;</span><br><span class="line">        // 2.1 为每个钟摆球添加连结物行为</span><br><span class="line">        UIDynamicBehavior *attachmentBehavior = [self createAttachmentBehaviorForBallBearing:ballBearing];</span><br><span class="line">        [behavior addChildBehavior:attachmentBehavior];</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    // 2.2 添加重力行为</span><br><span class="line">    [behavior addChildBehavior:[self createGravityBehaviorForObjects:_ballBearings]];</span><br><span class="line">    </span><br><span class="line">    // 2.3 添加碰撞行为</span><br><span class="line">    [behavior addChildBehavior:[self createCollisionBehaviorForObjects:_ballBearings]];</span><br><span class="line">    </span><br><span class="line">    // 2.4 指定碰撞的弹性</span><br><span class="line">    // 使用 UIDynamicItemBehavior 来指定碰撞的弹性。</span><br><span class="line">    // dynamic item 行为也可以设置线性和角速度，把它们添加到手势操作上面是十分有用的。</span><br><span class="line">    UIDynamicItemBehavior *itemBehavior = [[UIDynamicItemBehavior alloc] initWithItems:_ballBearings];</span><br><span class="line">    // 设置了其他的属性</span><br><span class="line">    itemBehavior.elasticity = 1.0;    // 弹性</span><br><span class="line">    itemBehavior.allowsRotation = NO; // rotation(旋转),运行旋转时，可以指定角阻力</span><br><span class="line">    itemBehavior.resistance = 2.f;    // resistance(阻尼，空气产生的阻尼)</span><br><span class="line">    [behavior addChildBehavior:itemBehavior];</span><br><span class="line">    </span><br><span class="line">    // 2.5 创建物理引擎动画</span><br><span class="line">    // 创建物理引擎来控制这些行为，所以我们定了一个类的全局变量(iVar):UIDynamicAnimator *_animator;</span><br><span class="line">    // UIDynamicAnimator代表了模拟动态系统的物理引擎，在这里我们创建了它，并且指定了它参照的view(既指定宇宙空间),也添加了我们创建的行为.</span><br><span class="line">    _animator = [[UIDynamicAnimator alloc] initWithReferenceView:self];</span><br><span class="line">    // Add the composite behavior</span><br><span class="line">    [_animator addBehavior:behavior];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">// 连结物的行为(attachment behavior)需要添加到钟摆球上面，它代表了绳子对它的牵引作用:</span><br><span class="line">- (UIDynamicBehavior *)createAttachmentBehaviorForBallBearing:(id&lt;UIDynamicItem&gt;)ballBearing</span><br><span class="line">&#123;</span><br><span class="line">    // UIAttachmentBehavior 实例伴随一个动态的对象(一个锚点或者另外的对象),它们有具体的属性来控制绳子对它的行为 - 具体就是它的频繁性、阻尼和长度。默认的设置就是一个完全刚性的连接物(没有任何长度伸缩弹性的物体),刚性的连接物正是我们的钟摆球所需要的。</span><br><span class="line">    </span><br><span class="line">    CGPoint anchor = ballBearing.center;</span><br><span class="line">    // 锚点在钟摆球的正上方</span><br><span class="line">    anchor.y -= CGRectGetHeight(self.bounds) / 4.0;</span><br><span class="line">    </span><br><span class="line">    // 在瞄点上方画一个盒子. 这不是行为的一部分，只是为了视觉上很好看</span><br><span class="line">    UIView *blueBox = [[UIView alloc] initWithFrame:CGRectMake(0, 0, 10, 10)];</span><br><span class="line">    blueBox.backgroundColor = [UIColor blueColor];</span><br><span class="line">    blueBox.center = anchor;</span><br><span class="line">    [self addSubview:blueBox];</span><br><span class="line">    </span><br><span class="line">    // 2.1 创建连结物行为</span><br><span class="line">    UIAttachmentBehavior *behavior = [[UIAttachmentBehavior alloc] initWithItem:ballBearing</span><br><span class="line">                                                               attachedToAnchor:anchor];</span><br><span class="line">    return behavior;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (UIDynamicBehavior *)createGravityBehaviorForObjects:(NSArray *)objects</span><br><span class="line">&#123;</span><br><span class="line">    // 2.2 创建重力行为</span><br><span class="line">    // UIGravityBehavior 代表了对象本身和地球之间的重力吸引力，它有一些属性允许你设置矢量的万有引力(就是重力系数magnitude和方向direction),我们这里增加了重力系数，但是保持重力的方向在y轴上面。</span><br><span class="line">    UIGravityBehavior *gravity = [[UIGravityBehavior alloc] initWithItems:objects];</span><br><span class="line">    gravity.magnitude = 10; // 设置重力系数</span><br><span class="line">    return gravity;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (UIDynamicBehavior *)createCollisionBehaviorForObjects:(NSArray *)objects</span><br><span class="line">&#123;</span><br><span class="line">    // 2.3 创建碰撞行为</span><br><span class="line">    // 将碰撞行为作用在模拟系统中的所有对象上面。</span><br><span class="line">    // 碰撞行为还可以用于模型对象达到边界如视图边界,或任意的贝塞尔曲线路径的界限。</span><br><span class="line">    return [[UICollisionBehavior alloc] initWithItems:objects];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#pragma mark - UIGestureRecognizer target method</span><br><span class="line">// 实现手势的具体行为</span><br><span class="line">// UIPushBehavior 代表一个简单的线性力量作用于对象上面。当力消失的时候，我们就回收作用在钟摆球上面的力,我们定义了一个类全局变量(iVar) UIPushBehavior *_userDragBehvior,这个变量可是在手势触发开始的时候赋值，需要记得把这个行为添加到dynamics animator中， 我们力的大小与水平位移成正比， 为了让钟摆球摇摆，我们需要在手势结束的时候删除掉push行为。</span><br><span class="line"></span><br><span class="line">- (void)handleBallBearingPan:(UIPanGestureRecognizer *)recognizer</span><br><span class="line">&#123;</span><br><span class="line">    // 拖动手势触发时，创建一个拖动力</span><br><span class="line">    if (recognizer.state == UIGestureRecognizerStateBegan) &#123;</span><br><span class="line">        if(_userDragBehavior) &#123;</span><br><span class="line">            [_animator removeBehavior:_userDragBehavior];</span><br><span class="line">        &#125;</span><br><span class="line">        // 将 UIPushBehavior 对象添加到 UIDynamicAnimator 物理引擎上</span><br><span class="line">        _userDragBehavior = [[UIPushBehavior alloc] initWithItems:@[recognizer.view] mode:UIPushBehaviorModeContinuous];</span><br><span class="line">        [_animator addBehavior:_userDragBehavior];</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    // 设置力的大小,与水平位移成正比</span><br><span class="line">    _userDragBehavior.pushDirection = CGVectorMake([recognizer translationInView:self].x / 10.f, 0);</span><br><span class="line">    </span><br><span class="line">    // 拖动手势结束时，回收作用在钟摆球上面的力</span><br><span class="line">    if (recognizer.state == UIGestureRecognizerStateEnded) &#123;</span><br><span class="line">        [_animator removeBehavior:_userDragBehavior];</span><br><span class="line">        _userDragBehavior = nil;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>将牛顿钟摆球视图添加到主页：</p>
<p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">- (void)viewDidLoad</span><br><span class="line">&#123;</span><br><span class="line">    [super viewDidLoad];</span><br><span class="line">	// Do any additional setup after loading the view, typically from a nib.</span><br><span class="line">    _newtonsCradle = [[SCNewtonsCradleView alloc] initWithFrame:self.view.bounds];</span><br><span class="line">    [self.view addSubview:_newtonsCradle];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3>动画效果</h3>
<p><img src="https://blog-andy0570-1256077835.cos.ap-shanghai.myqcloud.com/site_Images/071510.gif" alt></p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://andy0570.com/2017/08/22/《Effective Objective-C 2.0》2.对象、消息、运行期/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="独木舟的木">
      <meta itemprop="description" content="有时候阳光很好 有时候阳光很暗">
      <meta itemprop="image" content="https://blog-andy0570-1256077835.cos.ap-shanghai.myqcloud.com/site_Images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="独木舟的木">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2017/08/22/《Effective Objective-C 2.0》2.对象、消息、运行期/" class="post-title-link" itemprop="url">《Effective Objective-C 2.0》2.对象、消息、运行期</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2017-08-22 14:10:00" itemprop="dateCreated datePublished" datetime="2017-08-22T14:10:00+08:00">2017-08-22</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2019-04-28 15:45:00" itemprop="dateModified" datetime="2019-04-28T15:45:00+08:00">2019-04-28</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/《Effective-Objective-C-2-0》/" itemprop="url" rel="index"><span itemprop="name">《Effective Objective-C 2.0》</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          

          

          
            <div class="post-symbolscount">
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">本文字数：</span>
                
                <span title="本文字数">23k</span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">21 分钟</span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body han-init-context" itemprop="articleBody">

      
      

      
        
          
            <p><img src="https://blog-andy0570-1256077835.cos.ap-shanghai.myqcloud.com/site_Images/071522.jpg" alt></p>
<p>&lt;!-- more --&gt;</p>
<h2>第2章 对象、消息、运行期</h2>
<p><strong>对象</strong>：用 <strong>Objective-C</strong> 等面向对象语言编程时，“对象”（object) 是 “基本构造单元&quot;（building block)，开发者可以通过对象来存储并传递数据。</p>
<p><strong>消息传递</strong>（Messaging)：在对象之间传递数据并执行任务的过程。</p>
<p><strong>Objective-C 运行期环境</strong>：当应用程序运行起来以后，为其提供相关支持的代码叫做“Objective-C 运行期环境” (Objective-C runtime)，它提供了一些使得对象之间能够传递消息的重要函数，并且包含创建 类实例所用的全部逻辑。</p>
<h3>第6条：理解“属性”这一概念</h3>
<h4>@property：属性</h4>
<p><strong>属性</strong>（property）用于封装对象中的数据。而 Objective-C 对象通常会把其所需要的数据保存为各种实例变量。</p>
<p><strong>实例变量</strong> 通过<strong>存取方法</strong>（access method）来访问：</p>
<ul>
<li><strong>获取方法</strong>（getter）用于读取变量值。</li>
<li><strong>设置方法</strong>（setter）用于写入变量值。</li>
</ul>
<p>编写 Objectice-C 代码时很少<strong>定义实例变量的作用域</strong>。因为：对象布局在编译期就已经固定了，访问实例变量时，编译器会把其替换为硬编码（hardcode）的偏移量（offset）。表示该变量距离存放对象的 内存区域的起始地址有多远。</p>
<p>访问属性，可以使用<strong>点语法</strong>。</p>
<p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">EOCPerson *person = [[EOCPerson alloc] init];</span><br><span class="line">person.firstName = @&quot;Chester&quot;; //Same as</span><br><span class="line">[person setFirstName:@&quot;Chester&quot;];</span><br><span class="line"></span><br><span class="line">NSString *lastName = person.lastName; //Same as</span><br><span class="line">NSString *lastName = [person lastName];</span><br></pre></td></tr></table></figure></p>
<p><strong>自动合成</strong>（autosynthesis)：使用属性时，编译器会自动编写访问属性所需的方法，自动向类中添加适当类型的实例变量。</p>
<h4>@synthesize：指定实例变量的名字</h4>
<p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">// 将生成的实例变量命名为_myFirstName与_myLastName</span><br><span class="line">@implementation EOCPerson</span><br><span class="line">@synthesize firstName = _myFirstName;</span><br><span class="line">@synthesize lastName  = _myLastName;</span><br><span class="line">@end</span><br></pre></td></tr></table></figure></p>
<h4>@dynamic</h4>
<p>若不想令编译器自动合成存取方法，则可以自己实现。如果你只实现了其中一个存取方法，那么另外一个还是会由编译器来合成。还有一种办法能阻止编译器自动合成存取方法，就是使用 <strong>@dynamic</strong> 关键字，它会告诉编译器：不要自动创建实现属性所用的实例变 量，也不要为其创建存取方法。</p>
<h4>属性特质</h4>
<p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">@property (nonatomic, copy, readonly) NSString *firstName;</span><br></pre></td></tr></table></figure></p>
<h5>原子性</h5>
<ul>
<li><strong>atomic</strong>（默认）</li>
<li><strong>nonatomic</strong>：非原子性、不使用同步锁</li>
</ul>
<blockquote>
<p>atomic 与 nonatomic 的区别是什么呢？</p>
<p>具备 atomic 特质的获取方法会通过锁定机制来确保其操作的原子性。这也就是说，如果两个线程读写同一属性，那么不论何时，总能看到有效的属性值。若是不加锁的话（或者说使用 nonatomic 语义)，那么当其中一个线程正在改写某属性值时，另外一个线程也许会突然闯入，把尚未修改好的属性值读取出来。 发生这种情况时，线程读到的属性值可能不对。</p>
<p>如果开发过 iOS 程序，你就会发现，其中所有属性都声明为 nonatomic。这样做的历史原因是：在 iOS 中使用同步锁的开销较大，这会带来性能问题。一般情况下并不要求属性必须是“原子的”，因为这并不能保证“线程安全&quot;（thread safety)，若要实现“线程安全”的操作，还需采用更为深层的锁定机制才行。例如，一个线程在连续多次读取某属性值的过程中有别的线程在同时改写该值，那么即便将属性声明为 atomic，也还是会读到不同的属性值。 因此，开发 iOS 程序时一般都会使用 nonatomic 属性。但是在开发 Mac OS X 程序时，使用 atomic 属性通常都不会有性能瓶颈。</p>
</blockquote>
<h5>读写性</h5>
<ul>
<li><strong>readwrite</strong>：自动生成<strong>获取方法</strong>（getter）与<strong>设置方法</strong>（setter）。</li>
<li><strong>readonly</strong>：只生成<strong>获取方法</strong>（getter）。</li>
</ul>
<h5>内存管理语义，该特质只影响设置方法。</h5>
<ul>
<li><strong>assign</strong>：设置方法只会执行针对“纯量类型”（scalar type，例如 CGFloat 或 NSImeger 等）的简单赋值操作。</li>
<li><strong>strong</strong>：此特质表明该属性定义了一种“拥有关系”（owning relationship)。为这种属性设置新值时，设置方法会先保留新值，并释放旧值，然后再将新值设置上去。</li>
<li><strong>weak</strong>：此特质表明该属性定义了一种“非拥有关系”（nonowning relationship)。为这种属性设置新值时，设置方法既不保留新值，也不释放旧值。此特质同 <strong>assign</strong> 类似, 然而在属性所指的对象遭到摧毁时，属性值也会清空（nil out)。</li>
<li><strong>unsafe_unretained</strong>：此特质的语义和 <strong>assign</strong> 相同，但是它适用于“对象类型”（object type),该特质表达一种“非拥有关系”（“不保留”，unretained),当目标对象遭到摧毁 时，属性值不会自动清空（“不安全”，unsafe)，这一点与 <strong>weak</strong> 有区别。</li>
<li><strong>copy</strong>：此特质所表达的所属关系与 <strong>strong</strong> 类似。然而设置方法并不保留新值，而是将其拷贝（copy）。当属性类型为 <code>NSString *</code> 时，经常用此特质来保护其封装性，以返回不可变对象。涉及到深拷贝与浅拷贝的问题。</li>
</ul>
<h5>方法名</h5>
<p>指定存取方法的方法名</p>
<ul>
<li>
<p><code>getter=&lt;name&gt;</code></p>
<p>指定“获取方法”的方法名，如：</p>
<p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">@property (nonatomic, getter=isOn) BOOL on;</span><br></pre></td></tr></table></figure></p>
</li>
<li>
<p><code>setter=&lt;name&gt;</code></p>
<p>指定“设置方法”的方法名。这种用法不太常见。</p>
</li>
</ul>
<h4>要点</h4>
<ul>
<li>可以通过 <strong>@property</strong> 语法来定义对象中所封装的数据。</li>
<li>通过 “特质” 来指定存储数据所需的正确语义。</li>
<li>在设置属性所对应的实例变量时，一定要遵从该属性所声明的语义。</li>
<li>开发iOS程序时，应该使用 <strong>nonatomic</strong> 属性，因为 <strong>atomic</strong> 属性会严重影响性能。</li>
</ul>
<h3>第7条：在对象内部尽量直接访问实例变量</h3>
<p>⭐️ <strong>合理的方案</strong>：在<strong>写入</strong>实例变量时，通过其<strong>设置方法</strong>来做。而<strong>读取</strong>实例变量时，则<strong>直接访问</strong>之。</p>
<p><strong>优点</strong>：既能提高读取操作的速度，又能控制对属性的写入操作。</p>
<p><strong>通过设置方法来写入实例变量的原因</strong>：能够确保相关属性的“内存管理语义”得以贯彻。</p>
<p><strong>选用该方案的注意点</strong>：</p>
<ul>
<li><strong>直接访问实例变量</strong>不会经过 Objectice-C 的方法派发（method dispatch）、不会调用其设置方法（setter）、不会触发键值观测（KVO）。</li>
<li>在初始化方法中，总是应该直接访问实例变量，因为子类可能会**覆写（override）**设置（setter）方法。</li>
<li>使用<strong>惰性初始化（lazy initialization）<strong>技术时，必须通过</strong>获取方法</strong>来<strong>访问属性</strong>。</li>
</ul>
<h4>要点</h4>
<ul>
<li>在对象内部读取数据时，应该直接通过实例变量来读，而写入数据时，应该通过属性来写。</li>
<li>在初始化方法及 <code>dealloc</code> 方法中，总是应该直接通过实例变量来读写数据。</li>
<li>有时会使用惰性初始化技术配置某份数据，这种情况下，需要通过属性来读取数据。</li>
</ul>
<h3>第8条：理解“对象等同性”这一概念</h3>
<ul>
<li><code>==</code> 操作比较的是两个指针本身。</li>
<li>应该用 NSObject 协议中的 <code>isEqual</code>  方法判断两个对象的等同性。</li>
</ul>
<p>NSObject 协议中判断两个对象的等同性的关键方法：</p>
<p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">// 默认实现：当且仅当其“指针值&quot;完全相等时，这两个对象才相等。</span><br><span class="line">- (BOOL)isEqual:(id)object;</span><br><span class="line">@property (readonly) NSUInteger hash;</span><br></pre></td></tr></table></figure></p>
<p>对象等同性约定：</p>
<ol>
<li>如果 <code>isEqual:</code> 方法判定两个对象相等，那么其 <code>hash</code> 方法也必须返回同一个值。</li>
<li>但是，如果两个对象的 <code>hash</code> 方法返回同一个值，其 <code>isEqual:</code> 方法<strong>未必会</strong>认为两者相等。</li>
</ol>
<h4>覆写 isEqual：</h4>
<p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">- (BOOL)isEqual:(id)object &#123;</span><br><span class="line">    // 1.判断两个指针是否相等，即两个指针指向同一个对象</span><br><span class="line">    if (self == object) return YES;</span><br><span class="line">    // 2.判断两个对象是否属于同一个类</span><br><span class="line">    //   还应考虑到继承体系中的等同性问题</span><br><span class="line">    if ( [self class] != [object class]) return NO;</span><br><span class="line">    </span><br><span class="line">    // 3.判断每个属性是否都相等</span><br><span class="line">    EOCPerson *otherPerson = (EOCPerson *)object;</span><br><span class="line">    if (![_firstName isEqualToString:otherPerson.firstName]) &#123;</span><br><span class="line">        return NO;</span><br><span class="line">    &#125;</span><br><span class="line">    if (![_lastName isEqualToString:otherPerson.lastName]) &#123;</span><br><span class="line">        return NO;</span><br><span class="line">    &#125;</span><br><span class="line">    if (_age != otherPerson.age) &#123;</span><br><span class="line">        return NO;</span><br><span class="line">    &#125;</span><br><span class="line">    return YES;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h4>覆写 hash</h4>
<p>若两对象相等，则其哈希码 (hash) 也相等，但是两个哈希码相同的对象却未必相等。</p>
<p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">/*</span><br><span class="line"> 在 collection 中使用这种对象将产生性能问题。</span><br><span class="line"> </span><br><span class="line"> collection 在检索哈希表（hash table）时，会用对象的哈希码做索引。假如某个 collection 是用 set 实现的，</span><br><span class="line"> 那么 set 可能会根据哈希码把对象分装到不同的数组中。在向 set 中添加新对象时，要根据其哈希码找到与之相关的那个</span><br><span class="line"> 数组，依次检査其中各个元素，看数组中已有的对象是否和将要添加的新对象相等。如果相等，那就说明要添加的对象已经在</span><br><span class="line">  set 里面了。由此可知，如果令每个对象都返回相同的哈希码，那么在 set 中已有 1000000 个对象的情况下，若是继</span><br><span class="line"> 续向其中添加对象，则需将这 1000000 个对象全部扫描一遍。</span><br><span class="line"> */</span><br><span class="line">- (NSUInteger)hash &#123;</span><br><span class="line">    return 1337;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/*</span><br><span class="line"> 这样做还需负担创建字符串的开销，所以比返回单一值要慢。</span><br><span class="line"> 把这种对象添加到collection中时，也会产生性能问题</span><br><span class="line"> */</span><br><span class="line">- (NSUInteger)hash &#123;</span><br><span class="line">    NSString *stringToHash =</span><br><span class="line">        [NSString stringWithFormat:@&quot;%@:%@:%lu&quot;,</span><br><span class="line">            _firstName, _lastName, _age];</span><br><span class="line">    return [stringToHash hash];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">/*</span><br><span class="line"> 此方法既能保持较高效率，又能使生成的哈希码至少位于一定范围之内，而不会过于频繁地重复。</span><br><span class="line"> */</span><br><span class="line">- (NSUInteger)hash &#123;</span><br><span class="line">    NSUInteger firstNameHash = [_firstName hash];</span><br><span class="line">    NSUInteger lastNameHash  = [_lastName hash];</span><br><span class="line">    NSUInteger ageHash       = _age;</span><br><span class="line">    return firstNameHash ^ lastNameHash ^ ageHash;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h4>特定类所具有的等同性判断方法</h4>
<p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">/** NSString */</span><br><span class="line">- (BOOL)isEqualToString:(NSString *)aString;</span><br><span class="line"></span><br><span class="line">/** NSArray */</span><br><span class="line">- (BOOL)isEqualToArray:(NSArray&lt;ObjectType&gt; *)otherArray;</span><br><span class="line"></span><br><span class="line">/** NSDictionary */</span><br><span class="line">- (BOOL)isEqualToDictionary:(NSDictionary&lt;KeyType, ObjectType&gt; *)otherDictionary;</span><br><span class="line"></span><br><span class="line">/** NSSet */</span><br><span class="line">- (BOOL)isEqualToSet:(NSSet&lt;ObjectType&gt; *)otherSet;</span><br></pre></td></tr></table></figure></p>
<h4>创建自定义等同性判定方法的原因：</h4>
<ol>
<li>无须检测参数类型，能提升检测速度；</li>
<li>代码更美观、更易读，类似于 <code>isEqualToString:</code>。</li>
</ol>
<p><code>isEqual:</code> 方法常见实现方式为：如果受测的参数与接收该消息的对象都属于同一个类，那么就调用自已编写的判定方法，否则就交由超类来判断。</p>
<p>示例：</p>
<p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">- (BOOL)isEqualToPerson:(EOCPerson *)otherPerson &#123;</span><br><span class="line">    // 1.1 判断两个指针是否相等，即两个指针指向同一个对象</span><br><span class="line">    if (self == otherPerson) return YES;</span><br><span class="line">    </span><br><span class="line">    // 1.2 判断每个属性是否都相等</span><br><span class="line">    if (![_firstName isEqualToString:otherPerson.firstName]) &#123;</span><br><span class="line">        return NO;</span><br><span class="line">    &#125;</span><br><span class="line">    if (![_lastName isEqualToString:otherPerson.lastName]) &#123;</span><br><span class="line">        return NO;</span><br><span class="line">    &#125;</span><br><span class="line">    if (_age != otherPerson.age) &#123;</span><br><span class="line">        return NO;</span><br><span class="line">    &#125;</span><br><span class="line">    return YES;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (BOOL)isEqual:(id)object &#123;</span><br><span class="line">    </span><br><span class="line">    // 判断两个对象是否属于同一个类</span><br><span class="line">    if ( [self class] == [object class]) &#123;</span><br><span class="line">        // 1.同类，调用自定义判定方法</span><br><span class="line">        return [self isEqualToPerson:(EOCPerson *)object];</span><br><span class="line">    &#125;else &#123;</span><br><span class="line">        // 2.否则，交由超类处理</span><br><span class="line">        return [super isEqual:object];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h4>等同性判断的执行深度</h4>
<p>创建等同性判定方法时，需要决定是根据整个对象来判断等同性，还是仅根据其中几个字段来判断。</p>
<ul>
<li>深度等同性判断（deep equality）;</li>
<li>根据自定义类的 identifier 标识符判定。</li>
</ul>
<h4>容器中可变类的等同性</h4>
<p>把某个对象放入 collection 之后，就不应再改变其（这个对象）哈希码了。因为如果把某对象放入 set 之后又修改其内容，那么后面的行为将很难预料。</p>
<h4>要点</h4>
<ul>
<li>若想检测对象的等同性，请提供 <code>isEqual:</code> 与 <code>hash</code> 方法。</li>
<li>相同的对象必须具有相同的hash码，但是两个hash码相同的对象却未必相同。</li>
<li>不要盲目的逐个检测每条属性，而是应该依照具体需求来制定检测方案。</li>
<li>编写 <code>hash</code> 方法时，应该使用计算速度快而且哈希码碰撞几率低的算法。</li>
</ul>
<h3>第9条：以“类族模式”隐藏实现细节</h3>
<p><strong>类族/类别方法</strong>（class cluster）：可以隐藏“抽象基类&quot;背后的实现细节。</p>
<p>例如：</p>
<p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">+ (instancetype)buttonWithType:(UIButtonType)buttonType;</span><br></pre></td></tr></table></figure></p>
<h4>创建类族</h4>
<p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">#import &lt;Foundation/Foundation.h&gt;</span><br><span class="line"></span><br><span class="line">/** 定义抽象基类 */</span><br><span class="line">typedef NS_ENUM(NSUInteger, EOCEmployeeType) &#123;</span><br><span class="line">    EOCEmployeeTypeDeveloper,</span><br><span class="line">    EOCEmployeeTypeDesigner,</span><br><span class="line">    EOCEmployeeTypeFinance,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">@interface EOCEmployee : NSObject</span><br><span class="line"></span><br><span class="line">@property (nonatomic, copy) NSString *name;</span><br><span class="line">@property (nonatomic, assign) NSUInteger age;</span><br><span class="line"></span><br><span class="line">+ (EOCEmployee *)employeeWithType:(EOCEmployeeType)type;</span><br><span class="line">- (void)doADayWork;</span><br><span class="line"></span><br><span class="line">@end</span><br><span class="line"></span><br><span class="line">@implementation EOCEmployee</span><br><span class="line"></span><br><span class="line">+ (EOCEmployee *)employeeWithType:(EOCEmployeeType)type &#123;</span><br><span class="line">    switch (type) &#123;</span><br><span class="line">        case EOCEmployeeTypeDeveloper:</span><br><span class="line">            return [EOCEmployeeDeveloper new];</span><br><span class="line">            break;</span><br><span class="line">        case EOCEmployeeTypeDesigner:</span><br><span class="line">            return [EOCEmployeeDesigner new];</span><br><span class="line">            break;</span><br><span class="line">        case EOCEmployeeTypeFinance:</span><br><span class="line">            return [EOCEmployeeFinance new];</span><br><span class="line">            break;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (void)doADayWork &#123;</span><br><span class="line">    // Subclasses implement this</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@end</span><br></pre></td></tr></table></figure></p>
<p>其中，每个实体子类都从基类继承而来</p>
<p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">@interface EOCEmployeeDeveloper : EOCEmployee</span><br><span class="line">@end</span><br><span class="line"></span><br><span class="line">@implementation EOCEmployeeDeveloper</span><br><span class="line"></span><br><span class="line">- (void)doADayWork &#123;</span><br><span class="line">    [self writeCode];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@end</span><br></pre></td></tr></table></figure></p>
<h4>Cocoa 里的类族</h4>
<p>大部分 collection 类都是类族，如 <strong>NSArray</strong> 及其可变版本 <strong>NSMutableArray</strong>。</p>
<p>判断某个对象是否位于类族中，使用 <code>isKindOfClass:</code> 方法。</p>
<h4>要点</h4>
<ul>
<li>类族模式可以把实现细节隐藏在一套简单的公共接口后面。</li>
<li>系统框架中经常使用类族。</li>
<li>从类族的公共抽象基类中继承子类时要当心，若有开发文档，则应首先阅读。</li>
</ul>
<h3>第10条：在既有类中使用关联对象存放自定义数据</h3>
<p>关联对象（Associated Object）：</p>
<ol>
<li>
<p>可以给某对象关联许多其他对象，这些对象通过 <strong>键</strong> 来区分。</p>
</li>
<li>
<p>存储对象值的时候，可以指明 <strong>存储策略</strong>（storage policy），用以维护相应的“内存管理语义”。存储策略由名为 <code>objc_AssociationPolicy</code> 的枚举所定义：</p>
<p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">typedef enum objc_AssociationPolicy : uintptr_t &#123;</span><br><span class="line">    OBJC_ASSOCIATION_ASSIGN = 0,</span><br><span class="line">    OBJC_ASSOCIATION_RETAIN_NONATOMIC = 1,</span><br><span class="line">    OBJC_ASSOCIATION_COPY_NONATOMIC = 3,</span><br><span class="line">    OBJC_ASSOCIATION_RETAIN = 01401,</span><br><span class="line">    OBJC_ASSOCIATION_COPY = 01403</span><br><span class="line">&#125; objc_AssociationPolicy;</span><br></pre></td></tr></table></figure></p>
<table>
<thead>
<tr>
<th style="text-align:left">关联类型</th>
<th style="text-align:left">等效的 @property 属性</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">OBJC_ASSOCIATION_ASSIGN</td>
<td style="text-align:left">assign</td>
</tr>
<tr>
<td style="text-align:left">OBJC_ASSOCIATION_RETAIN_NONATOMIC</td>
<td style="text-align:left">nonatomic，retain</td>
</tr>
<tr>
<td style="text-align:left">OBJC_ASSOCIATION_COPY_NONATOMIC</td>
<td style="text-align:left">nonatomic，copy</td>
</tr>
<tr>
<td style="text-align:left">OBJC_ASSOCIATION_RETAIN</td>
<td style="text-align:left">retain</td>
</tr>
<tr>
<td style="text-align:left">OBJC_ASSOCIATION_COPY</td>
<td style="text-align:left">copy</td>
</tr>
</tbody>
</table>
</li>
</ol>
<p>管理关联对象的方法：</p>
<p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">// 以给定的键和策略为某对象设置关联对象值。</span><br><span class="line">void objc_setAssociatedObject(id object, const void *key, id value, objc_AssociationPolicy policy);</span><br><span class="line"></span><br><span class="line">// 根据给定的键从某对象中获取相应的关联对象值。</span><br><span class="line">id objc_getAssociatedObject(id object, const void *key);</span><br><span class="line"></span><br><span class="line">// 移除指定对象的全部关联对象。</span><br><span class="line">void objc_removeAssociatedObjects(id object);</span><br></pre></td></tr></table></figure></p>
<blockquote>
<p>我们可以把某对象想象成 <strong>NSDictionary</strong>，把关联到该对象的值理解为字典中的条目，于是，存取关联对象的值就相当于在 <strong>NSDictionary</strong> 对象上调用 <code>[object setObject:value forKey:key]</code> 与 <code>[object objectForKey:key]</code> 方法。</p>
<p>然而两者之间有个重要差别：设置关联对象时用的键（key）是个 <strong>不透明的指针</strong>（opaque pointer）。如果在两个键上调用 <code>isEqual:</code> 方法的返回值是 YES，那么 <strong>NSDictionary</strong> 就认为二者相等；然而在设置关联对象值时，若想令两 键匹配到同一个值，则二者必须是完全相同的指针才行。鉴于此，<strong>在设置关联对象值时， 通常使用静态全局变量做键。</strong></p>
</blockquote>
<h4>要点</h4>
<ul>
<li>可以通过“关联对象”机制来把两个对象连起来。</li>
<li>定义关联对象时可指定内存管理语义，用以模仿定义属性时所采用的“拥有关系”与“非拥有关系”。</li>
<li>只有在其他做法不可行时才应选用关联对象，因为这种做法通常会引入难于查找的bug。</li>
</ul>
<h3>第11条：理解 objc_msgSend 的作用</h3>
<blockquote>
<p>运行期系统如何査找并调用某方法的实现代码?</p>
</blockquote>
<ul>
<li>在 Objectice-C 对象上调用方法称之为 <strong>传递消息</strong>。</li>
<li>消息有 <strong>名称</strong>（name）或 <strong>选择子</strong>（selector），可以接受参数、传递返回值。</li>
<li><strong>C</strong> 语言使用 <strong>静态绑定</strong> 的函数调用方式。即<strong>在编译期就能决定运行时所应调用的函数</strong>。</li>
<li><strong>动态绑定</strong>：需要调用的函数直到运行期才能确定。</li>
</ul>
<blockquote>
<p>在 Objective-C 中，如果向某对象传递消息，那就会使用动态绑定机制来决定需要调用的方法。在底层，所有方法都是普通的 C 语言函数，然而对象收到消息之后，究竟该调用哪个方法则完全于运行期决定，甚至可以在程序运行时改变，这些特性使得 Objective-C 成为一门真正的动态语言。</p>
</blockquote>
<p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">/*</span><br><span class="line"> 给对象发送消息</span><br><span class="line"></span><br><span class="line"> 接收者(receiver): someObject</span><br><span class="line"> 选择子(selector): messageName</span><br><span class="line"> 消息(message): 选择子 + 参数</span><br><span class="line"> */</span><br><span class="line">id returnValue = [someObject messageName:parameter];</span><br><span class="line"></span><br><span class="line">// 编译器看到上面这条消息后，将其转换为一条标准的 C 语言函数调用，</span><br><span class="line">// 所调用的函数是消息传递机制中的核心函数，叫做 objc_msgSend</span><br><span class="line">void objc_msgSend(void /* id self, SEL op, ... */ )</span><br><span class="line"></span><br><span class="line">// 消息派发；</span><br><span class="line">// 方法列表；</span><br><span class="line">// 消息转发机制；</span><br><span class="line">// 快速映射表，缓存匹配的方法名结果。</span><br></pre></td></tr></table></figure></p>
<p>Objectice-C 运行环境的其他函数：</p>
<p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">/*</span><br><span class="line">  如果待发送的消息要返回结构体，那么可交由此函数处理。</span><br><span class="line"></span><br><span class="line">  只有当CPU的寄存器能够容纳得下消息返回类型时，这个函数才能处理此消息。</span><br><span class="line">  若是返回值无法容纳于CPU寄存器中（比如说返回的结构体太大了)，那么就由另一个函数执行派发。</span><br><span class="line">  此时，那个函数会通过分配在栈上的某个变量来处理消息所返回的结构体。</span><br><span class="line"> */</span><br><span class="line">void objc_msgSend_stret(id self, SEL op, ...);</span><br><span class="line"></span><br><span class="line">/*</span><br><span class="line"> 如果消息返回的是浮点数，那么可交由此函数处理。</span><br><span class="line"> </span><br><span class="line"> 在某些架构的 CPU 中调用函数时，需要对 ”浮点数寄存器“（floating-point register)做特殊处理。</span><br><span class="line"> 也就是说，通常所用的 objc_msgSend 在这种情况下并不合适。</span><br><span class="line"> 这个函数是为了处理 x86 等架构 CPU 中某些令人稍觉惊讶的奇怪状况。</span><br><span class="line"> */</span><br><span class="line">long double objc_msgSend_fpret(id self, SEL op, ...);</span><br><span class="line"></span><br><span class="line">/*</span><br><span class="line"> 如果要给超类发消息，例如 [super message:parameter],那么就交由此函数处理。</span><br><span class="line"> </span><br><span class="line"> 也有另外两个与 objc_msgSend_stret 和 objc_msgSend_fpret 等效的函数，</span><br><span class="line"> 用于处理发给 super 的相应消息。</span><br><span class="line"> */</span><br><span class="line">id objc_msgSendSuper(struct objc_super *super, SEL op, ...);</span><br></pre></td></tr></table></figure></p>
<h4>要点</h4>
<ul>
<li>消息由接受者，selector及参数构成。给某对象“发送消息”也就相当于在该对象上调用方法。</li>
<li>发给某对象的全部消息都要由“动态消息派发系统”来处理，该系统会查出对应的方法，并执行其代码。</li>
</ul>
<h3>第12条：理解消息转发机制</h3>
<blockquote>
<p>消息转发的原理，如果类无法立即响应某个选择子, 那么就会启动消息转发流程。</p>
</blockquote>
<h4>消息转发机制</h4>
<blockquote>
<p>在编译期向类发送了其无法解读的消息并不会报错，因为在运行期可以继续向类中添加方法，所以 编译器在编译时还无法确知类中到底会不会有某个方法实现。</p>
<p>当对象接收到无法解读的消息后，就会启动 <strong>消息转发</strong>（message forwarding）机制，程序员可经由此过程告诉对象应该如何处理未知消息。</p>
</blockquote>
<p>消息转发的两个阶段：</p>
<p>第一阶段，<strong>动态方法解析</strong>（dynamic method resolution）：先征询接收者，所属的类，看其是否能动态添加方法，以处理当前这个<strong>未知的选择子</strong>（unknown selector）。</p>
<p>第二阶段，涉及<strong>完整的消息转发机制</strong>（full forwarding mechanism)。如果运行期系统已经把第一阶段执行完了，那么接收者自己就无法再以动态新增方法的手段来响应包含该选择子的消息了。此时，运行期系统会请求接收者以其他手段来处理与消息相关的方法调用。细分为两小步：</p>
<ul>
<li>首先，请接收者看看有没有其他对象能处理这条消息。若有，则运行期系统会把消息转给那个对象，于是消息转发过程结束，一切如常。</li>
<li>若没有<strong>备援的接收者</strong>（replacement receiver)，则启动完整的消息转发机制，运行期系统会把与消息有关的全部细节都封装到 <strong>NSInvocation</strong> 对象中，再给接收者最后一次机会，令其设法解决当前 还未处理的这条消息。</li>
</ul>
<h4>动态方法解析</h4>
<p>对象在收到无法解读的消息后，首先将调用其所属类的下列类方法：</p>
<p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">+ (BOOL)resolveInstanceMethod:(SEL)sel;</span><br></pre></td></tr></table></figure></p>
<p>该方法的参数就是那个未知的选择子，其返回值为 Boolean 类型，表示这个类是否能新增一个实例方法用以处理此选择子。在继续往下执行转发机制之前，本类有机会新增一个处理此选择子的方法。假如尚未实现的方法不是<strong>实例方法</strong>而是<strong>类方法</strong>，那么运行期系统就会调 用另外一个方法，该方法与 <code>resolvelnstanceMethod:</code> 类似，叫做 <code>resolveClassMethod:</code>。</p>
<p><strong>使用这种办法的前提</strong>：相关方法的实现代码已经写好，只等着运行的时候动态插在类里面就可以了。此方案常用来实现 <strong>@dynamic</strong> 属性：</p>
<p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">id autoDictioanryGetter(id self, SEL _cmd);</span><br><span class="line">void autoDictionarySetter(id self, SEL _cmd, id value);</span><br><span class="line"></span><br><span class="line">+ (BOOL)resolveInstanceMethod:(SEL)sel &#123;</span><br><span class="line">    NSString *selectorString = NSStringFromSelector(sel);</span><br><span class="line">    if ( /** selector is from a @dynamic property */ ) &#123;</span><br><span class="line">        if ([selectorString hasPrefix:@&quot;set&quot;]) &#123;</span><br><span class="line">            class_addMethod(self,</span><br><span class="line">                            sel,</span><br><span class="line">                            (IMP)autoDictionarySetter,</span><br><span class="line">                            &quot;v@:@&quot;);</span><br><span class="line">        &#125;else &#123;</span><br><span class="line">            class_addMethod(self,</span><br><span class="line">                            sel,</span><br><span class="line">                            (IMP)autoDictioanryGetter,</span><br><span class="line">                            &quot;@@:&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">        return YES;</span><br><span class="line">    &#125;</span><br><span class="line">    return [super resolveInstanceMethod:sel];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h4>备援接收者</h4>
<p>当前接收者还有第二次机会能处理未知的选择子，在这一步中，运行期系统会问它：能不能把这条消息转给其他接收者来处理。</p>
<p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">- (id)forwardingTargetForSelector:(SEL)aSelector;</span><br></pre></td></tr></table></figure></p>
<p>该方法参数代表未知的选择子，若当前接收者能找到备援对象，则将其返回，若找不到， 就返回nil。通过此方案，我们可以用 “组合”（composition）来模拟出 “多重继承”（multiple inheritance）的某些特性。在一个对象内部，可能还有一系列其他对象，该对象可经由此方法将能够处理某选择子的相关内部对象返回，这样的话，在外界看来，好像是该对象亲自处理了这些消息似的。</p>
<h4>完整的消息转发机制</h4>
<p>首先创建 <strong>NSInvocation</strong> 对象，把与尚未处理的那条消息有关的全部细节都封于其中。 此对象包含选择子、目标（target）及参数。在触发 <strong>NSInvocation</strong> 对象时，“消息派发系统” (message-dispatch system）将亲自出马，把消息指派给目标对象。</p>
<p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">- (void)forwardInvocation:(NSInvocation *)anInvocation;</span><br></pre></td></tr></table></figure></p>
<p>这个方法可以实现得很简单：只需改变调用目标，使消息在新目标上得以调用即可。然而这样实现出来的方法与“备援接收者”方案所实现的方法等效，所以很少有人采用这么简单的实现方式。</p>
<p>比较有用的实现方式为：在触发消息前，先以某种方式改变消息内容，比如追加另外一个参数，或是改换选择子，等等。</p>
<h4>消息转发全流程</h4>
<p><img src="https://blog-andy0570-1256077835.cos.ap-shanghai.myqcloud.com/site_Images/071523.jpg" alt></p>
<p>接收者在每一步中均有机会处理消息。步骤越往后，处理消息的代价就越大。最好能在第一步就处理完，这样的话，运行期系统就可以将此方法缓存起来了。如果这个类的实例稍后还收到同名选择子，那么根本无须启动消息转发流程。若想在第三步里把消息转给备援的接收者，那还不如把转发操作提前到第二步。因为第三步只是修改了调用目标，这项改动放在第二步执行会更为简单，不然的话，还得创建并处理完整的 <strong>NSInvocation</strong> 。</p>
<h4>以完整的例子演示动态方法解析</h4>
<p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br></pre></td><td class="code"><pre><span class="line">// *************************************************************</span><br><span class="line">//  EOCAutoDictionary.h</span><br><span class="line">#import &lt;Foundation/Foundation.h&gt;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> 以动态方法解析实现 @dynamic 属性</span><br><span class="line"> </span><br><span class="line"> 编写一个类似于“字典”的对象，它里面可以容纳其他对象，只不过开发者要直接通过属性来存取其中的数据。</span><br><span class="line"> 设计思路是：由开发者来添加属性定义，并将其声明为 @dynamic，而类则会自动处理相关属性值的存放与获取操作。</span><br><span class="line"> */</span><br><span class="line">@interface EOCAutoDictionary : NSObject</span><br><span class="line">@property (nonatomic, strong) NSString *string;</span><br><span class="line">@property (nonatomic, strong) NSNumber *number;</span><br><span class="line">@property (nonatomic, strong) NSDate *date;</span><br><span class="line">@property (nonatomic, strong) id opaqueObject;</span><br><span class="line">@end</span><br><span class="line"></span><br><span class="line">// *************************************************************</span><br><span class="line">//  EOCAutoDictionary.m</span><br><span class="line">#import &quot;EOCAutoDictionary.h&quot;</span><br><span class="line">#import &lt;objc/runtime.h&gt;</span><br><span class="line"></span><br><span class="line">@interface EOCAutoDictionary ()</span><br><span class="line">/** 在类的内部，每个属性的值都存放在字典里 */</span><br><span class="line">@property (nonatomic, strong) NSMutableDictionary *backingStore;</span><br><span class="line">@end</span><br><span class="line"></span><br><span class="line">/** getter 函数 */</span><br><span class="line">id autoDictioanryGetter(id self, SEL _cmd) &#123;</span><br><span class="line">    // 从对象中获取存储器</span><br><span class="line">    EOCAutoDictionary *typeSelf = (EOCAutoDictionary *)self;</span><br><span class="line">    NSMutableDictionary *backingStore = typeSelf.backingStore;</span><br><span class="line">    </span><br><span class="line">    // 字典的 key 是 selector 的名字</span><br><span class="line">    NSString *key = NSStringFromSelector(_cmd);</span><br><span class="line">    </span><br><span class="line">    // Return the value</span><br><span class="line">    return [backingStore objectForKey:key];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/** Setter 函数 */</span><br><span class="line">void autoDictionarySetter(id self, SEL _cmd, id value) &#123;</span><br><span class="line">    // 从对象中获取存储器</span><br><span class="line">    EOCAutoDictionary *typeSelf = (EOCAutoDictionary *)self;</span><br><span class="line">    NSMutableDictionary *backingStore =  typeSelf.backingStore;</span><br><span class="line">    </span><br><span class="line">    /** </span><br><span class="line">     *  selector 的名称格式像这样：&quot;setOpaqueObject:&quot;</span><br><span class="line">     *  我们需要移除 &quot;set&quot;，&quot;:&quot;，并且将首字母小写</span><br><span class="line">     */</span><br><span class="line">    NSString *selectorString = NSStringFromSelector(_cmd);</span><br><span class="line">    NSMutableString *key = [selectorString mutableCopy];</span><br><span class="line">    </span><br><span class="line">    // 移除末尾的 “:”</span><br><span class="line">    [key deleteCharactersInRange:NSMakeRange(key.length - 1, 1)];</span><br><span class="line">    </span><br><span class="line">    // 移除 “set” 前缀</span><br><span class="line">    [key deleteCharactersInRange:NSMakeRange(0, 3)];</span><br><span class="line">    </span><br><span class="line">    // 首字母小写</span><br><span class="line">    NSString *lowercaseFirstChar = [[key substringToIndex:1] lowercaseString];</span><br><span class="line">    [key replaceCharactersInRange:NSMakeRange(0, 1)</span><br><span class="line">                       withString:lowercaseFirstChar];</span><br><span class="line">    </span><br><span class="line">    if (value) &#123;</span><br><span class="line">        [backingStore setObject:value forKey:key];</span><br><span class="line">    &#125;else &#123;</span><br><span class="line">        [backingStore removeObjectForKey:key];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@implementation EOCAutoDictionary</span><br><span class="line">/** 禁止编译器自动生成实例变量和存取方法 */</span><br><span class="line">@dynamic string, number, date, opaqueObject;</span><br><span class="line"></span><br><span class="line">- (instancetype)init &#123;</span><br><span class="line">    if (self = [super init]) &#123;</span><br><span class="line">        _backingStore = [NSMutableDictionary new];</span><br><span class="line">    &#125;</span><br><span class="line">    return self;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">+ (BOOL)resolveInstanceMethod:(SEL)sel &#123;</span><br><span class="line">    NSString *selectorString = NSStringFromSelector(sel);</span><br><span class="line">    if ([selectorString hasPrefix:@&quot;set&quot;]) &#123;</span><br><span class="line">        // 向类中动态地添加方法，用以处理给定的选择子</span><br><span class="line">        // 第三个参数为函数指针，指向待添加的方法</span><br><span class="line">        // 最后一个参数表示待添加方法的类型编码</span><br><span class="line">        class_addMethod(self,</span><br><span class="line">                        sel,</span><br><span class="line">                        (IMP)autoDictionarySetter,</span><br><span class="line">                        &quot;v@:@&quot;);</span><br><span class="line">    &#125;else &#123;</span><br><span class="line">        class_addMethod(self,</span><br><span class="line">                        sel,</span><br><span class="line">                        (IMP)autoDictioanryGetter,</span><br><span class="line">                        &quot;@@:&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    return YES;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@end</span><br></pre></td></tr></table></figure></p>
<p>使用 <strong>EOCAutoDictionary</strong>:</p>
<p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">EOCAutoDictionary *dict = [EOCAutoDictionary new];</span><br><span class="line">dict.date = [NSDate dateWithTimeIntervalSince1970:475372800];</span><br><span class="line">NSLog(@&quot;dict.date = %@&quot;,dict.date);</span><br><span class="line">// dict.date = Thu Jan 24 08:00:00 1985</span><br></pre></td></tr></table></figure></p>
<blockquote>
<p><strong>CoreAnimation</strong> 框架中的 <strong>CALayer</strong> 类使用了与本例相似的实现方式，这使得 <strong>CALayer</strong> 成为 <strong>兼容于键值编码的</strong>（key-value-coding-compliant）容器类， 也就等于说，能够向里面随意添加属性，然后以键值对的形式来访问。于是，开发者就可以向其中新增自定义的属性了，这些属性值的存储工作由基类直接负责，我们只需在 <strong>CALayer</strong> 的子类中定义新属性即可。</p>
</blockquote>
<h4>要点</h4>
<ul>
<li>若对象无法响应某个 selector，则进入消息转发流程。</li>
<li>通过运行期的动态方法解析功能，我们可以在需要用到某个方法时再将其加入类中。</li>
<li>对象可以将其无法解读的某些 selector 转交给其他对象处理。</li>
<li>经过上述两步后，如果还是没办法处理 selector，那就启动完整的消息转发机制。</li>
</ul>
<h3>第13条：用“方法调配技术”调试“黑盒方法”</h3>
<blockquote>
<p>Objective-C 对象收到消息之后，究竟会调用何种方法需要在运行期才能解析出来。</p>
<p><strong>方法调配</strong>（method swizzling）：与给定的选择子名称相对应的方法也可以在运行期改变。</p>
<p>此特性的优势：</p>
<ol>
<li>既不需要源代码，也不需要通过继承子类来覆写方法就能改变这个类本身的功能。</li>
<li>新的功能将在本类的所有实例中生效，而不是仅限于覆写了相关方法的那些子类实例。</li>
</ol>
</blockquote>
<h4>原理</h4>
<p>类的方法列表会把选择子的名称映射到相关的方法实现之上，使得 <strong>动态消息派发系统</strong> 能够据此找到应该调用的方法。这些方法均以函数指针的形式来表示，这种指针叫做 IMP。</p>
<p><img src="https://blog-andy0570-1256077835.cos.ap-shanghai.myqcloud.com/site_Images/071524.jpg" alt></p>
<p>而 Objective-C 运行期系统提供的方法可以操作这张方法列表。开发者可以向其中新增选择子，也可以改变某选择子所对应的方法实现，还可以交换两个选择子所映射到的指针。</p>
<p><img src="https://blog-andy0570-1256077835.cos.ap-shanghai.myqcloud.com/site_Images/071525.jpg" alt></p>
<p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">// 获得方法实现</span><br><span class="line">Method class_getInstanceMethod(Class cls, SEL name);</span><br><span class="line"></span><br><span class="line">// 互换两个方法实现</span><br><span class="line">void method_exchangeImplementations(Method m1, Method m2);</span><br></pre></td></tr></table></figure></p>
<p>示例一：</p>
<p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">// 互换两个方法实现</span><br><span class="line">Method originalMethod =</span><br><span class="line">    class_getClassMethod([NSString class],</span><br><span class="line">                         @selector(lowercaseString));</span><br><span class="line">Method swappedMethod =</span><br><span class="line">    class_getClassMethod([NSString class],</span><br><span class="line">                         @selector(uppercaseString));</span><br><span class="line">method_exchangeImplementations(originalMethod, swappedMethod);</span><br></pre></td></tr></table></figure></p>
<p>示例二：</p>
<p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">// *************************************************************</span><br><span class="line">//  NSString+EOCMyAdditions.h</span><br><span class="line">#import &lt;Foundation/Foundation.h&gt;</span><br><span class="line"></span><br><span class="line">@interface NSString (EOCMyAdditions)</span><br><span class="line">- (NSString *)eoc_myLowercaseString;</span><br><span class="line">@end</span><br><span class="line"></span><br><span class="line">// *************************************************************</span><br><span class="line">//  NSString+EOCMyAdditions.m</span><br><span class="line">#import &quot;NSString+EOCMyAdditions.h&quot;</span><br><span class="line"></span><br><span class="line">@implementation NSString (EOCMyAdditions)</span><br><span class="line">- (NSString *)eoc_myLowercaseString &#123;</span><br><span class="line">    NSString *lowercase = [self eoc_myLowercaseString];</span><br><span class="line">    NSLog(@&quot;%@ =&gt; %@&quot;, self, lowercase);</span><br><span class="line">    return lowercase;</span><br><span class="line">&#125;</span><br><span class="line">@end</span><br><span class="line"></span><br><span class="line">// *************************************************************</span><br><span class="line">// 在运行期，eoc_myLowercaseString 择子实际上对应于原有的 owercaseString 法实现。</span><br><span class="line">Method originalMethod =</span><br><span class="line">class_getClassMethod([NSString class],</span><br><span class="line">                     @selector(lowercaseString));</span><br><span class="line">Method swappedMethod =</span><br><span class="line">class_getClassMethod([NSString class],</span><br><span class="line">                     @selector(eoc_myLowercaseString));</span><br><span class="line">method_exchangeImplementations(originalMethod, swappedMethod);</span><br></pre></td></tr></table></figure></p>
<blockquote>
<p>通过此方案，开发者可以为那些 <strong>完全不知道其具体实现的</strong>（completely opaque, “完全不透明的”）黑盒方法增加日志记录功能，这非常有助于程序调试。</p>
<p>然而，此做法只在调试程序时有用。很少有人在调试程序之外的场合用上述 <strong>方法调配技术</strong> 来永久改动某个类的功能。不能仅仅因为 Objective-C 语言里有这个特性就一定要用它。若是滥用，反而会令代码变得不易读懂且难于维护。</p>
</blockquote>
<h4>要点</h4>
<ul>
<li>在 runtime 运行期，可以向类中新增或替换 selector 所对应的方法实现。</li>
<li>使用另一份实现来替换原有的方法实现，这道工序叫做方法调配（method swizzling），开发者常用此技术向原有实现中添加功能。</li>
<li>一般来说，只有调试程序的时候才需要在 runtime 中修改方法实现，这种做法不宜滥用。</li>
</ul>
<h3>第14条：理解“类对象”的用意</h3>
<ul>
<li>对象类型并非在编译期就绑定好了，而是要在运行期査找。</li>
<li><strong>id</strong> 是特殊类型，它能指代任意的 Objective-C 对象类型。</li>
<li><strong>在运行期检视对象类型</strong> 这一操作也叫做 <strong>类型信息査询</strong>。</li>
<li>在程序中不要直接比较对象所属的类，明智的做法是调用<strong>类型信息査询方法</strong>。</li>
</ul>
<p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">// 此结构体存放类的元数据</span><br><span class="line">struct objc_class &#123;</span><br><span class="line">    Class isa  OBJC_ISA_AVAILABILITY;</span><br><span class="line"></span><br><span class="line">#if !__OBJC2__</span><br><span class="line">    // 定义本类的超类</span><br><span class="line">    Class super_class                                        OBJC2_UNAVAILABLE;</span><br><span class="line">    const char *name                                         OBJC2_UNAVAILABLE;</span><br><span class="line">    long version                                             OBJC2_UNAVAILABLE;</span><br><span class="line">    long info                                                OBJC2_UNAVAILABLE;</span><br><span class="line">    long instance_size                                       OBJC2_UNAVAILABLE;</span><br><span class="line">    struct objc_ivar_list *ivars                             OBJC2_UNAVAILABLE;</span><br><span class="line">    struct objc_method_list **methodLists                    OBJC2_UNAVAILABLE;</span><br><span class="line">    struct objc_cache *cache                                 OBJC2_UNAVAILABLE;</span><br><span class="line">    struct objc_protocol_list *protocols                     OBJC2_UNAVAILABLE;</span><br><span class="line">#endif</span><br><span class="line"></span><br><span class="line">&#125; OBJC2_UNAVAILABLE;</span><br></pre></td></tr></table></figure></p>
<ul>
<li>每个对象结构体的首个成员是 Class 类的变量。该变量定义了对象所属的类, 通常称为 <code>is a</code> 指针。</li>
<li><code>superclass</code> 指针确立了继承关系，而 <code>isa</code> 指针描述了实例所属的类。</li>
</ul>
<h4>在类继承体系中查询类型信息</h4>
<p>类型信息査询方法：</p>
<p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">// 对象是否为某类或其派生类的实例</span><br><span class="line">- (BOOL)isKindOfClass:(Class)aClass;</span><br><span class="line"></span><br><span class="line">// 对象是否为某个特定类的实例</span><br><span class="line">- (BOOL)isMemberOfClass:(Class)aClass;</span><br></pre></td></tr></table></figure></p>
<p>示例：</p>
<p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">NSMutableDictionary *dict = [NSMutableDictionary new];</span><br><span class="line"></span><br><span class="line">[dict isMemberOfClass:[NSDictionary class]]; // NO</span><br><span class="line">[dict isMemberOfClass:[NSMutableDictionary class]]; // NO,类族模式‼️</span><br><span class="line">[dict isKindOfClass:[NSDictionary class]]; // YES</span><br><span class="line">[dict isKindOfClass:[NSMutableDictionary class]]; // YES</span><br><span class="line">[dict isKindOfClass:[NSArray class]]; // NO</span><br></pre></td></tr></table></figure></p>
<p>两者的区别：<code>isMemberOfClass:</code> 不能检测任何的类都是基于 <strong>NSObject</strong> 类这一事实，而 <code>isKindOfClass:</code> 可以。</p>
<p>示例二：</p>
<p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">// 根据数组中存储的对象生成以逗号分隔的字符串</span><br><span class="line">- (NSString *)commaSeparatedStringFromObjects:(NSArray *)array &#123;</span><br><span class="line">    NSMutableString *string = [NSMutableString new];</span><br><span class="line">    [array enumerateObjectsUsingBlock:^(id  _Nonnull obj, NSUInteger idx, BOOL * _Nonnull stop) &#123;</span><br><span class="line">        if ([obj isKindOfClass:[NSString class]]) &#123;</span><br><span class="line">            [string appendFormat:@&quot;%@,&quot;, obj];</span><br><span class="line">        &#125;else if ([obj isKindOfClass:[NSNumber class]]) &#123;</span><br><span class="line">            [string appendFormat:@&quot;%d,&quot;, [obj intValue]];</span><br><span class="line">        &#125;else if ([obj isKindOfClass:[NSData class]]) &#123;</span><br><span class="line">            NSString *base64Encoded = [obj base64EncodedStringWithOptions:NSDataBase64Encoding64CharacterLineLength];</span><br><span class="line">            [string appendFormat:@&quot;%@,&quot;, base64Encoded];</span><br><span class="line">        &#125;else &#123;</span><br><span class="line">            // Type not support</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;];</span><br><span class="line">    return string;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h4>类型信息查询方法 &amp; <code>class</code> 方法</h4>
<p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">// 使用 class 方法也可以精确判断出对象是否为某类实例</span><br><span class="line">id object;</span><br><span class="line">if ([object class] == [NSString class]) &#123;</span><br><span class="line">    // object is an instance of NSString</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>类型信息查询方法可以正确处理那些使用了消息传递机制的对象。</p>
<blockquote>
<p>某个对象可能会把其收到的所有选择子都转发给另外一个对象。这样的对象叫做 <strong>代理</strong> （proxy），此种对象均以 <strong>NSProxy</strong> 为根类。</p>
<p>通常情况下，如果在此种代理对象上调用 <code>class</code> 方法，那么返回的是代理对象本身（此类是 <strong>NSProxy</strong> 的子类)，而非接受的代理的对象所属的类。</p>
<p>然而，若是改用 <code>isKindOfClass:</code> 这样的类型信息査询方法，那么代理对象就会把这条消息转给 <strong>接受代理的对象</strong>（proxied object)。也就是说，这条消息的返回值与直接在接受代理的对象上面査询其类型所得的结果相同。因此，这样査出来的类对象与通过 <code>class</code> 方法所返回的那个类对象不同，<code>class</code>方法所返回的类表示发起代理的对象，而非接受代理的对象。</p>
</blockquote>
<h4>要点</h4>
<ul>
<li>每个实例都有一个指向 Class 对象的指针，用以表明其类型，而这些 Class 对象则构成了类的继承体系。</li>
<li>如果对象类型无法在编译期确定，那么就应该使用类型信息查询方法来探知。</li>
<li>尽量使用类型信息查询方法来确定对象类型，而不要直接比较类对象，因为某些对象可能实现了消息转发功能。</li>
</ul>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/15/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/15/">15</a><span class="page-number current">16</span><a class="page-number" href="/page/17/">17</a><span class="space">&hellip;</span><a class="page-number" href="/page/32/">32</a><a class="extend next" rel="next" href="/page/17/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <div class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image" src="https://blog-andy0570-1256077835.cos.ap-shanghai.myqcloud.com/site_Images/avatar.png" alt="独木舟的木">
            
              <p class="site-author-name" itemprop="name">独木舟的木</p>
              <div class="site-description motion-element" itemprop="description">有时候阳光很好 有时候阳光很暗</div>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/">
                
                    <span class="site-state-item-count">315</span>
                    <span class="site-state-item-name">日志</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-categories">
                  
                    
                      <a href="/categories/">
                    
                  
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">14</span>
                    <span class="site-state-item-name">分类</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-tags">
                  
                    
                      <a href="/tags/">
                    
                  
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">37</span>
                    <span class="site-state-item-name">标签</span>
                  </a>
                </div>
              
            </nav>
          

          
            <div class="feed-link motion-element">
              <a href="/atom.xml" rel="alternate">
                <i class="fa fa-rss"></i>
                RSS
              </a>
            </div>
          

          

          
            <div class="links-of-author motion-element">
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                    
                  
                  <a href="https://github.com/Andy0570" title="GitHub &rarr; https://github.com/Andy0570" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i>GitHub</a>
                </span>
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                    
                  
                  <a href="mailto:andywhm@163.com" title="E-Mail &rarr; mailto:andywhm@163.com" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                </span>
              
            </div>
          

          
             <div class="cc-license motion-element" itemprop="license">
              
              
                
              
              
              
              <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" class="cc-opacity" rel="noopener" target="_blank"><img src="/images/cc-by-nc-sa.svg" alt="Creative Commons"></a>
             </div>
          

          
          

          
            
          
          

        </div>
      </div>

      

      

    </div>
  </aside>
  


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js">
</script>
<div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love" id="animate">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">独木舟的木</span>

  
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-area-chart"></i>
    </span>
    
    <span title="站点总字数">2.3m</span>
  

  
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    
    <span title="站点阅读时长">34:07</span>
  
</div>



  <span id="busuanzi_container_site_uv">
  本站访客数<span id="busuanzi_value_site_uv"></span>人次
  </span>
  <span class="post-meta-divider">|</span>

  <div class="powered-by">由 <a href="https://hexo.io" class="theme-link" rel="noopener" target="_blank">Hexo</a> 强力驱动 v3.8.0</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 – <a href="https://theme-next.org" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> v7.1.0</div>




        








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

    

    
  </div>

  

<script>
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>





  



  






  



  
    
    
      
    
  
  <script color="17,119,176" opacity="0.5" zindex="-1" count="99" src="//cdn.jsdelivr.net/gh/theme-next/theme-next-canvas-nest@1/canvas-nest.min.js"></script>













  
  <script src="//cdn.jsdelivr.net/npm/jquery@2/dist/jquery.min.js"></script>

  
  <script src="//cdn.jsdelivr.net/npm/fastclick@1/lib/fastclick.min.js"></script>

  
  <script src="//cdn.jsdelivr.net/npm/jquery-lazyload@1/jquery.lazyload.min.js"></script>

  
  <script src="//cdn.jsdelivr.net/npm/velocity-animate@1/velocity.min.js"></script>

  
  <script src="//cdn.jsdelivr.net/npm/velocity-animate@1/velocity.ui.min.js"></script>

  
  <script src="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.js"></script>


  


  <script src="/js/utils.js?v=7.1.0"></script>

  <script src="/js/motion.js?v=7.1.0"></script>



  
  


  <script src="/js/affix.js?v=7.1.0"></script>

  <script src="/js/schemes/pisces.js?v=7.1.0"></script>




  

  


  <script src="/js/next-boot.js?v=7.1.0"></script>


  

  

  
  
  
    
  

  
    
      
    
  

  
  
  
    <script src="//cdn.jsdelivr.net/npm/quicklink@1/dist/quicklink.umd.js"></script>
    <script>
      
        window.addEventListener('load', () => {
      
        quicklink({
          timeout: 3000,
          priority: true,
          ignores: [uri => uri.includes('#'),uri => uri == 'https://andy0570.com/page/16/',]
        });
      
        });
      
    </script>
  


  



  



  
  
  
    
  
  <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/instantsearch.js@2/dist/instantsearch.min.css">

  
  
    
  
  <script src="//cdn.jsdelivr.net/npm/instantsearch.js@2/dist/instantsearch.js"></script>
  

  <script src="/js/algolia-search.js?v=7.1.0"></script>



  

  

  

  

  

  

  

  

  

  
  
  
    
  
  <script src="//cdn.jsdelivr.net/npm/pangu@4/dist/browser/pangu.min.js"></script>
  <script>pangu.spacingPage();</script>


  
  
  
    
  
  <script src="//cdn.jsdelivr.net/gh/theme-next/theme-next-bookmark@1/bookmark.min.js"></script>
  <script>
  
    bookmark.loadBookmark();
  
  </script>


  

  

  
  
</body>
</html>
