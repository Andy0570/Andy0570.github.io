<!DOCTYPE html>












  


<html class="theme-next gemini use-motion" lang="zh-CN">
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">




  
  
    
      
    
    
      
    
  <script src="//cdn.jsdelivr.net/npm/pace-js@1/pace.min.js"></script>
  <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/pace-js@1/themes/blue/pace-theme-minimal.css">



  
  
    
  
  <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/han-css@3/dist/han.min.css">













  
  
    
  
  <link rel="stylesheet" href="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.css">







  

<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/font-awesome@4/css/font-awesome.min.css">

<link rel="stylesheet" href="/css/main.css?v=7.1.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/panda/apple-touch-icon.png?v=7.1.0">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/panda/favicon-32x32.png?v=7.1.0">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/panda/favicon-16x16.png?v=7.1.0">


  <link rel="mask-icon" href="/images/panda/safari-pinned-tab.svg?v=7.1.0" color="#222">


  <link rel="manifest" href="/images/panda/site.webmanifest">


  <meta name="msapplication-config" content="/images/panda/browserconfig.xml">





<script id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '7.1.0',
    sidebar: {"position":"left","display":"post","offset":12,"onmobile":false,"dimmer":false},
    back2top: true,
    back2top_sidebar: false,
    fancybox: true,
    fastclick: true,
    lazyload: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  <meta name="description" content="有时候阳光很好 有时候阳光很暗">
<meta name="keywords" content="独木舟的木">
<meta property="og:type" content="website">
<meta property="og:title" content="独木舟的木">
<meta property="og:url" content="https://andy0570.com/page/3/index.html">
<meta property="og:site_name" content="独木舟的木">
<meta property="og:description" content="有时候阳光很好 有时候阳光很暗">
<meta property="og:locale" content="zh-CN">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="独木舟的木">
<meta name="twitter:description" content="有时候阳光很好 有时候阳光很暗">



  <link rel="alternate" href="/atom.xml" title="独木舟的木" type="application/atom+xml">



  
  
  <link rel="canonical" href="https://andy0570.com/page/3/">



<script id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>独木舟的木</title>
  






  <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?8229a094facca297f211d61323fd9fde";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>







  <noscript>
  <style>
  .use-motion .motion-element,
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-title { opacity: initial; }

  .use-motion .logo,
  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-CN">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <a href="https://github.com/andy0570" class="github-corner" aria-label="View source on GitHub"><svg width="80" height="80" viewbox="0 0 250 250" style="fill:#151513; color:#fff; position: absolute; top: 0; border: 0; right: 0;" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"/><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"/><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"/></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style>
    
    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">独木舟的木</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
      
        <p class="site-subtitle">iOS Developer</p>
      
    
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="切换导航栏">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home">

    
    
    
      
    

    
      
    

    <a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i> <br>首页</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-categories">

    
    
    
      
    

    
      
    

    <a href="/categories/" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i> <br>分类<span class="badge">15</span></a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-tags">

    
    
    
      
    

    
      
    

    <a href="/tags/" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i> <br>标签<span class="badge">76</span></a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">

    
    
    
      
    

    
      
    

    <a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i> <br>归档<span class="badge">311</span></a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-about">

    
    
    
      
    

    
      
    

    <a href="/about/" rel="section"><i class="menu-item-icon fa fa-fw fa-user"></i> <br>关于</a>

  </li>

      
      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br>搜索</a>
        </li>
      
    </ul>
  

  

  
    <div class="site-search">
      
  
  <div class="algolia-popup popup search-popup">
    <div class="algolia-search">
      <div class="algolia-search-input-icon">
        <i class="fa fa-search"></i>
      </div>
      <div class="algolia-search-input" id="algolia-search-input"></div>
    </div>

    <div class="algolia-results">
      <div id="algolia-stats"></div>
      <div id="algolia-hits"></div>
      <div id="algolia-pagination" class="algolia-pagination"></div>
    </div>

    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
  </div>




    </div>
  
</nav>



  



</div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
            

          
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://andy0570.com/2019/01/09/《AWS云计算实战》笔记（六）——对象存储/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="独木舟的木">
      <meta itemprop="description" content="有时候阳光很好 有时候阳光很暗">
      <meta itemprop="image" content="https://ws1.sinaimg.cn/large/006tNc79gy1g22m14458rj30u014xu0x.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="独木舟的木">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/01/09/《AWS云计算实战》笔记（六）——对象存储/" class="post-title-link" itemprop="url">《AWS云计算实战》笔记（六）——对象存储</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2019-01-09 12:16:00" itemprop="dateCreated datePublished" datetime="2019-01-09T12:16:00+08:00">2019-01-09</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2019-04-16 16:29:01" itemprop="dateModified" datetime="2019-04-16T16:29:01+08:00">2019-04-16</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/云计算/" itemprop="url" rel="index"><span itemprop="name">云计算</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          
            <span id="/2019/01/09/《AWS云计算实战》笔记（六）——对象存储/" class="leancloud_visitors" data-flag-title="《AWS云计算实战》笔记（六）——对象存储">
              <span class="post-meta-divider">|</span>
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              
                <span class="post-meta-item-text">阅读次数：</span>
              
                <span class="leancloud-visitors-count"></span>
            </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body han-init-context" itemprop="articleBody">

      
      

      
        
          
            <h2 id="对象存储——-S3-和-Glacier"><a href="#对象存储——-S3-和-Glacier" class="headerlink" title="对象存储—— S3 和 Glacier"></a>对象存储—— S3 和 Glacier</h2><table>
<thead>
<tr>
<th>AWS 对象存储服务</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="https://amazonaws-china.com/cn/s3/?nc2=h_m1" target="_blank" rel="noopener">AWS S3</a></td>
<td>AWS 提供的对象存储服务</td>
</tr>
<tr>
<td><a href="https://docs.aws.amazon.com/zh_cn/amazonglacier/latest/dev/introduction.html" target="_blank" rel="noopener">AWS Glacier</a></td>
<td>备份和归档的存储服务</td>
</tr>
</tbody>
</table>
<h2 id="对象存储"><a href="#对象存储" class="headerlink" title="对象存储"></a>对象存储</h2><p><strong>对象存储</strong>可以帮助用户存储图片、视频、文档和可执行文件。</p>
<ul>
<li>在对象存储中，数据存储为对象，每个对象包含：一个全球唯一的标识符、元数据和数据本身。</li>
<li>客户可以直接操作「元数据」来管理和查询数据。</li>
<li>「元数据」还可以用来存储访问权限信息和其他管理任务。</li>
</ul>
<h2 id="Amazon-S3"><a href="#Amazon-S3" class="headerlink" title="Amazon S3"></a>Amazon S3</h2><blockquote>
<p>Amazon S3 将数据作为对象存储在被称为 “存储桶” 的资源中。您可以在一个存储桶中尽可能多地存储对象，并写入、读取和删除您的存储桶中的对象。对象大小最多可为 5 TB。</p>
</blockquote>
<ul>
<li>无限存储空间、高可用、高度持久化。</li>
<li>可存储任何类型的数据，如图片、文档和二进制文件。</li>
<li><del>单个对象的容量不超过 5 TB</del>。单个存档最大可达 40TB。</li>
<li>上传/下载对象方式：HTTPS 协议、命令行工具（CLI）、SDK、第三方工具。</li>
<li>S3 使用「存储桶」组织对象。「存储桶」是对象的容器。用户可以创建最多100个存储桶。</li>
<li>建议选择域名（如 com.google.* ）或者公司名称作为「存储桶」名的前缀。</li>
</ul>
<h3 id="示例：备份用户的数据"><a href="#示例：备份用户的数据" class="headerlink" title="示例：备份用户的数据"></a>示例：备份用户的数据</h3><p>使用 AWS CLI 命令行工具上传数据。并从 S3 下载数据。</p>
<p>1⃣️ 为数据创建一个 S3 存储桶。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 格式</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> aws s3 mb s3://com.domain-<span class="variable">$YourName</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">$</span><span class="bash"> aws s3 mb s3://com.arlingbc-andy</span></span><br><span class="line">make_bucket: com.arlingbc-andy</span><br></pre></td></tr></table></figure>
<p>2⃣️ 从本地的目录上传数据到 S3 存储桶。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 格式</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> sync：比较 <span class="variable">$Path</span> 目录和 S3 存储桶里的 /backup 目录 ,只上传新的或者修改过的文件</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="variable">$Path</span>：为目录路径</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> aws s3 sync <span class="variable">$Path</span> s3://com.domain-<span class="variable">$YourName</span>/backup</span></span><br><span class="line"></span><br><span class="line"><span class="meta">$</span><span class="bash"> aws s3 sync /Users/huqilin/Desktop/image s3://com.arlingbc-andy/backup</span></span><br><span class="line">upload: image/sunset.jpeg to s3://com.arlingbc-andy/backup/sunset.jpeg</span><br></pre></td></tr></table></figure>
<p>3⃣️ 测试数据恢复。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 格式</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> aws s3 cp --recursive s3://com.domain-<span class="variable">$YourName</span>/backup <span class="variable">$Path</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">$</span><span class="bash"> aws s3 cp --recursive s3://com.arlingbc-andy/backup /Users/huqilin/Desktop/image</span></span><br></pre></td></tr></table></figure>
<p>4⃣️ 为存储桶激活版本保护（启用版本控制）。</p>
<p>默认情况下，S3 存储桶禁用了版本保护功能（同名文件会被覆盖）。</p>
<figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ aws s3api put-<span class="keyword">bucket-versioning </span>--<span class="keyword">bucket </span>com.arlingbc-<span class="keyword">andy </span>--versioning-configuration Status<span class="symbol">=Enabled</span></span><br></pre></td></tr></table></figure>
<p>5⃣️  获取所有对象和版本</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> aws s3api list-object-versions --bucket com.arlingbc-andy</span></span><br></pre></td></tr></table></figure>
<p>6⃣️ 资源清理。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> aws s3 rb --force s3://com.arlingbc-andy</span></span><br><span class="line">delete: s3://com.arlingbc-andy/backup/sunset.jpeg</span><br><span class="line">remove_bucket failed: s3://com.arlingbc-andy An error occurred (BucketNotEmpty) when calling the DeleteBucket operation: The bucket you tried to delete is not empty. You must delete all versions in the bucket.</span><br></pre></td></tr></table></figure>
<blockquote>
<p><strong>移除存储桶造成 BucketNotEmpty 报错</strong><br>如果激活了存储桶的版本功能，删除存储桶时将报错 BucketNotEmpty。这种情况下请使用管理控制台来删除存储桶。</p>
</blockquote>
<h2 id="归档对象以优化成本"><a href="#归档对象以优化成本" class="headerlink" title="归档对象以优化成本"></a>归档对象以优化成本</h2><blockquote>
<p><strong>Amazon S3 Glacier</strong> 是一款安全、持久且成本极低的云存储服务，适用于数据存档和长期备份。它能够提供 99.999999999% 的持久性以及全面的安全与合规功能，可以帮助满足最严格的监管要求。Amazon S3 Glacier 提供就地查询功能，允许您针对静态存档数据直接运行强大的分析。客户能以每月每 GB 低至 0.004 USD 的价格存储数据，与本地解决方案相比，显著降低了成本。为了保持成本低廉，同时满足各种数据检索需求，Amazon S3 Glacier 提供三种访问存档的选项，各自的检索时间从数分钟到数小时不等。</p>
</blockquote>
<p>在 Glacier 中存储数据的成本大概是 S3 中的 1/3。</p>
<table>
<thead>
<tr>
<th></th>
<th>S3</th>
<th>Glacier</th>
</tr>
</thead>
<tbody>
<tr>
<td>每 GB 容量成本</td>
<td>0.03 美元</td>
<td>0.01 美元</td>
</tr>
<tr>
<td>数据访问速度</td>
<td>立即可以访问</td>
<td>在提交请求 3～5h 后</td>
</tr>
<tr>
<td>持久性</td>
<td>设计为年度 99.999999999% 的数据持久性</td>
<td>设计为年度 99.999999999% 的数据持久性</td>
</tr>
</tbody>
</table>
<h3 id="示例：创建-S3-存储桶配合-Glacier-使用"><a href="#示例：创建-S3-存储桶配合-Glacier-使用" class="headerlink" title="示例：创建 S3 存储桶配合 Glacier 使用"></a>示例：创建 S3 存储桶配合 Glacier 使用</h3><p>集成 S3 和 Glacier 以降低存储数据的成本。</p>
<p>可以为存储桶添加多条生命周期规则。</p>
<p><strong>生命周期规则</strong>：在给定的日期之后归档或者删除对象，它还可以帮助把 S3 的对象归档到 Glacier。 </p>
<p>添加生命周期转换规则，「创建制定天数后转换到 Amazon Glacier」。</p>
<h4 id="AWS-S3-Glacier-数据检索策略"><a href="#AWS-S3-Glacier-数据检索策略" class="headerlink" title="AWS S3 Glacier 数据检索策略"></a>AWS S3 Glacier 数据检索策略</h4><ul>
<li><p>加急检索：存档通常在 1-5 分钟内可供使用。</p>
<blockquote>
<p>当您偶尔需要加急请求档案子集时，可以使用加急检索来快速访问您的数据。除了最大的存档 (250MB+) 以外，对于使用加急检索方式访问的所有数据，通常在 1-5 分钟内即可使用。有两种加急检索：按需和预置。按需请求类似于 EC2 按需实例，绝大部分时间都可以使用。预置请求可保证在您需要时获得数据。</p>
<p>加急检索针对偶尔需要紧急请求少量存档的情况进行了优化。除了最大的存档 (250MB+) 以外，对于使用加急检索方式访问的所有数据，通常在 1-5 分钟内即可使用。如果您的应用程序或工作负载需要确保加急检索在您需要时就能使用，则您应该考虑使用<strong>预置容量</strong>。</p>
</blockquote>
</li>
<li><p>标准检索：档通常在 3-5 小时内可供访问。</p>
<blockquote>
<p>标准检索是在数小时内访问数据的低成本方式。例如，您可以使用标准检索来恢复备份数据，检索存档的数据以便当天进行编辑和分发，或者获取并分析日志以便在数小时内做出业务决策。</p>
</blockquote>
</li>
<li><p>批量检索:</p>
<blockquote>
<p>批量检索是 S3 Glacier 提供的成本最低的检索方式，使您能够以低廉的成本在一天内检索大量数据，甚至可以达到 PB 级。批量检索通常在 5-12 小时内完成。</p>
<p>批量检索的设计宗旨是让客户以经济高效的方式获取大量数据，以便满足非紧急使用案例的需要，例如对数 PB 的原始视频内容进行转码或分析大量基因组序列。</p>
</blockquote>
</li>
<li><p>预置容量</p>
<blockquote>
<p>预置容量可确保加急检索所检索的容量在您需要时即可使用。每单位容量可确保每 5 分钟内至少可执行 3 次加急检索，并提供高达 150MB/s 的检索吞吐量。</p>
<p>如果您需要满足特定的加急检索速率要求，则可以预置检索容量。如果没有预置容量，则只有在发出请求时有容量可用的情况下，才会接受加急检索请求。</p>
</blockquote>
</li>
</ul>
<h3 id="示例：使用程序的方式存储对象"><a href="#示例：使用程序的方式存储对象" class="headerlink" title="示例：使用程序的方式存储对象"></a>示例：使用程序的方式存储对象</h3><p>S3 可以通过 HTTPS 和 API 来访问。也就是说，用户可以集成 S3 （SDK）到应用程序里，用程序调用 API 来提交请求到 S3。</p>
<p>在应用程序中集成 S3 有助于实现<strong>无状态的服务器架构</strong>。</p>
<p>…</p>
<h3 id="示例：使用-S3-来实现静态网站托管"><a href="#示例：使用-S3-来实现静态网站托管" class="headerlink" title="示例：使用 S3 来实现静态网站托管"></a>示例：使用 S3 来实现静态网站托管</h3><p>1⃣️ 创建一个新的 S3 存储桶；</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">aws s3 mb s3://static.arlingbc.com</span><br></pre></td></tr></table></figure>
<p>2⃣️ 上传文件（helloworld.html）到 S3；</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">aws s3 cp /Users/huqilin/Desktop/helloworld.html s3://static.arlingbc.com/helloworld.html</span><br><span class="line">upload: ./helloworld.html to s3://static.arlingbc.com/helloworld.html</span><br></pre></td></tr></table></figure>
<p>3⃣️ 添加存储桶策略到存储桶；</p>
<p> 配置存储桶策略，以允许所有人查看和下载该存储桶里的文档。</p>
<p><a href="https://awspolicygen.s3.amazonaws.com/policygen.html" target="_blank" rel="noopener">存储桶策略生成器</a></p>
<h4 id="bucketpolicy-json"><a href="#bucketpolicy-json" class="headerlink" title="bucketpolicy.json"></a>bucketpolicy.json</h4><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"Id"</span>: <span class="string">"Policy1547005345057"</span>,</span><br><span class="line">  <span class="attr">"Version"</span>: <span class="string">"2012-10-17"</span>,</span><br><span class="line">  <span class="attr">"Statement"</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">"Sid"</span>: <span class="string">"Stmt1547005342595"</span>,</span><br><span class="line">      <span class="attr">"Action"</span>: [</span><br><span class="line">        <span class="string">"s3:GetObject"</span></span><br><span class="line">      ],</span><br><span class="line">      <span class="attr">"Effect"</span>: <span class="string">"Allow"</span>,</span><br><span class="line">      <span class="attr">"Resource"</span>: <span class="string">"arn:aws:s3:::static.arlingbc.com/*"</span>,</span><br><span class="line">      <span class="attr">"Principal"</span>: <span class="string">"*"</span></span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>上传存储策略：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">aws s3api put-bucket-policy --bucket static.arlingbc.com --policy file:///Users/huqilin/Desktop/bucketpolicy.json</span><br></pre></td></tr></table></figure>
<p>4⃣️ 激活和配置 S3 服务静态网站；</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">aws s3 website s3://static.arlingbc.com --index-document helloworld.html</span><br></pre></td></tr></table></figure>
<p>配置完成，访问路径为：<code>$BucketName.s3-website-$Region.amazonaws.com</code></p>
<p>即：<a href="https://s3.us-east-2.amazonaws.com/static.arlingbc.com/helloworld.html" target="_blank" rel="noopener">https://s3.us-east-2.amazonaws.com/static.arlingbc.com/helloworld.html</a></p>
<p>5⃣️ 使用别名（CNAME）关联一个自定义的域名到 S3 的存储桶；</p>
<p>为自己的域名添加一个 CNAME 别名记录，让记录指向 S3 存储桶的端点。</p>
<blockquote>
<p> CNAME 别名记录只在满足下面条件的时候生效。</p>
<ul>
<li>存储桶名必须和 CNAME  别名记录一样。要创建一个 CNAME 给 static.yourdomain.com，存储桶名也必须是 static.yourdomain.com。</li>
<li>CNAME 别名记录不适用于主域名。可以给子域名创建别名记录的资源。如 static 或者 www 这样前缀的域名。如果想关联主域名到S3存储桶，需要使用AWS提供的 Route53 的 DNS 服务。</li>
</ul>
</blockquote>
<p>6⃣️ 清理资源</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">aws s3 rb --force s3://static.arlingbc.com</span><br></pre></td></tr></table></figure>
<h2 id="对象存储的内部机制"><a href="#对象存储的内部机制" class="headerlink" title="对象存储的内部机制"></a>对象存储的内部机制</h2><h3 id="确保数据一致性"><a href="#确保数据一致性" class="headerlink" title="确保数据一致性"></a>确保数据一致性</h3><ul>
<li><p>S3 是最终一致性：如果更新一个对象然后尝试读取，对象可能还包含旧的版本。在有些情况下，最新的版本可以访问到。</p>
</li>
<li><p>S3 上创建、更新或者删除对象的操作是原子操作。</p>
</li>
<li>在上传<strong>新对象</strong>之后，立即提交的读请求会读到一致的数据。但是在<strong>更新或者删除操作</strong>之后的读请求操作将返回最终一致的结果。</li>
</ul>
<h3 id="选择合适的键"><a href="#选择合适的键" class="headerlink" title="选择合适的键"></a>选择合适的键</h3><p>挑战：如何合理地设置主键来实现 S3 的 I/O 性能的最大化？</p>
<ul>
<li>为所有对象的键在开头的部分使用相同的字符串，将限制 S3 存储桶的最大 I/O 性能。（不合理的命名示例，像：image1.png、image2.png、image3.png、image4.png、image5.png…）</li>
<li>为了改善 S3 的 I/O 性能，不要使用开头相同的字符串作为键。</li>
<li>可以为每个对象的键添加散列（MD5）前缀的方式解决这个问题。</li>
</ul>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://andy0570.com/2019/01/07/《AWS云计算实战》笔记（五）——IAM、安全组和VPC/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="独木舟的木">
      <meta itemprop="description" content="有时候阳光很好 有时候阳光很暗">
      <meta itemprop="image" content="https://ws1.sinaimg.cn/large/006tNc79gy1g22m14458rj30u014xu0x.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="独木舟的木">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/01/07/《AWS云计算实战》笔记（五）——IAM、安全组和VPC/" class="post-title-link" itemprop="url">《AWS云计算实战》笔记（五）——IAM、安全组和VPC</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2019-01-07 16:27:00" itemprop="dateCreated datePublished" datetime="2019-01-07T16:27:00+08:00">2019-01-07</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2019-04-16 16:27:09" itemprop="dateModified" datetime="2019-04-16T16:27:09+08:00">2019-04-16</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/云计算/" itemprop="url" rel="index"><span itemprop="name">云计算</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          
            <span id="/2019/01/07/《AWS云计算实战》笔记（五）——IAM、安全组和VPC/" class="leancloud_visitors" data-flag-title="《AWS云计算实战》笔记（五）——IAM、安全组和VPC">
              <span class="post-meta-divider">|</span>
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              
                <span class="post-meta-item-text">阅读次数：</span>
              
                <span class="leancloud-visitors-count"></span>
            </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body han-init-context" itemprop="articleBody">

      
      

      
        
          
            <h1 id="保护系统安全：IAM、安全组和-VPC"><a href="#保护系统安全：IAM、安全组和-VPC" class="headerlink" title="保护系统安全：IAM、安全组和 VPC"></a>保护系统安全：IAM、安全组和 VPC</h1><p><img src="http://upload-images.jianshu.io/upload_images/2648731-6e0ccb9ad2947112.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="保护系统安全"></p>
<h2 id="检查安全更新"><a href="#检查安全更新" class="headerlink" title="检查安全更新"></a>检查安全更新</h2><p>1⃣️ 在服务器启动时安装安全更新：在用户数据脚本中添加安全更新命令：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 检查安全更新</span></span><br><span class="line">yum -security check-update</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 安装所有更新</span></span><br><span class="line">yum -y update</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 仅安装安全更新</span></span><br><span class="line">yum -y -security update</span><br></pre></td></tr></table></figure>
<p>2⃣️ 在服务器运行时安装安全更新：使用一个脚本获取所有服务器列表，然后在所有运行的 EC2 实例上安装安全更新：</p>
<h4 id="update-sh-在所有服务器上安装安全更新的脚本文件"><a href="#update-sh-在所有服务器上安装安全更新的脚本文件" class="headerlink" title="update.sh 在所有服务器上安装安全更新的脚本文件"></a>update.sh 在所有服务器上安装安全更新的脚本文件</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/bin/bash -ex</span></span><br><span class="line"></span><br><span class="line">PUBLICNAMES=$(aws ec2 describe-instances --filters <span class="string">"Name=instance-state-name,Values=running"</span> --query <span class="string">"Reservations[].Instances[].PublicDnsName"</span> --output text)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> PUBLICNAME <span class="keyword">in</span> <span class="variable">$PUBLICNAMES</span>; <span class="keyword">do</span></span><br><span class="line">	ssh -t -o StrictHostKeyChecking=no ec2-user@<span class="variable">$PUBLICNAME</span> <span class="string">"sudo yum -y --security update"</span></span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure>
<h2 id="保护-AWS-账户安全"><a href="#保护-AWS-账户安全" class="headerlink" title="保护 AWS 账户安全"></a>保护 AWS 账户安全</h2><p>使用多重身份验证（MFA）来保护你的root用户。然后你将停止使用root用户，创建一个新用户用于日常操作，然后学会授予一个角色最小权限。</p>
<h3 id="IAM-服务"><a href="#IAM-服务" class="headerlink" title="IAM 服务"></a><a href="https://docs.aws.amazon.com/zh_cn/IAM/latest/UserGuide/best-practices.html" target="_blank" rel="noopener">IAM 服务</a></h3><p>root 用户、IAM 用户、IAM 角色的区别：</p>
<table>
<thead>
<tr>
<th></th>
<th>root 用户</th>
<th>IAM 用户</th>
<th>IAM 角色</th>
</tr>
</thead>
<tbody>
<tr>
<td>可以有一个密码</td>
<td>总是</td>
<td>是</td>
<td>否</td>
</tr>
<tr>
<td>可以有一个访问密钥</td>
<td>是（不推荐）</td>
<td>是</td>
<td>否</td>
</tr>
<tr>
<td>可以属于一个组</td>
<td>否</td>
<td>是</td>
<td>否</td>
</tr>
<tr>
<td>可以与一个 EC2 实例关联</td>
<td>否</td>
<td>否</td>
<td>是</td>
</tr>
</tbody>
</table>
<ul>
<li>密码：登录管理控制台；</li>
<li>访问密钥：使用 AWS CLI 登录；</li>
</ul>
<p><img src="http://upload-images.jianshu.io/upload_images/2648731-b98d6341d78b02ed.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="策略类型"></p>
<p>IAM 用户和 IAM 角色通过策略进行授权。</p>
<p>最小授权原则。</p>
<p>创建用户组、IAM 用户、IAM 角色，并将 IAM 角色与 EC2 实例关联。</p>
<p>…</p>
<h2 id="控制进出虚拟服务器的网络流量"><a href="#控制进出虚拟服务器的网络流量" class="headerlink" title="控制进出虚拟服务器的网络流量"></a>控制进出虚拟服务器的网络流量</h2><ul>
<li>防火墙设置原则：只打开必要的端口。</li>
<li>默认情况下，所有的入站流量都被拒绝，而所有的出站流量都被允许。</li>
</ul>
<blockquote>
<p>💡💡💡 <strong>源和目的地</strong></p>
<p><strong>入站安全组规则</strong>筛选基于网络流量的源。源可以是一个IP地址也可以是一个安全组。这样就可以只允许从特定源IP地址范围来的入站流量。<br><strong>出站安全组规则</strong>筛选基于网路流量的目的地。目的地可以是一个IP地址或安全组。可以只允许特定目的IP地址范围的出站流量。</p>
<p>源 IP 和 目的 IP 针对的都是 EC2 实例外部的 IP 地址。</p>
</blockquote>
<h3 id="设置安全组规则"><a href="#设置安全组规则" class="headerlink" title="设置安全组规则"></a>设置安全组规则</h3><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">"Resources": &#123;</span><br><span class="line">	"SecurityGroup": &#123; ## 安全组</span><br><span class="line">		"Type": "AWS::EC2::SecurityGroup", ## 安全组资源类型</span><br><span class="line">		"Properties": &#123;  ## 安全组属性</span><br><span class="line">			"GroupDescription": "My security group", ## 安全组描述</span><br><span class="line">			"VpcId": &#123;"Ref": "VPC"&#125; ## 关联安全组与虚拟网络</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;,</span><br><span class="line">	"AllowInboundICMP": &#123; ## 允许 ICPM 规则描述</span><br><span class="line">		"Type": "AWS::EC2::SecurityGroupIngress", ## 入站规则类型</span><br><span class="line">		"Properties": &#123; </span><br><span class="line">			"GroupId": &#123;"Ref": "SecurityGroup"&#125;, ## 关联入站规则与安全组</span><br><span class="line">			"IpProtocol": "icmp", ## 指定协议</span><br><span class="line">			"FromPort": "-1", ## -1，意味着所有端口</span><br><span class="line">			"ToPort": "-1",</span><br><span class="line">			"CidrIp": "0.0.0.0/0" ## 0.0.0.0/0 表示所有源IP地址都被允许</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;,</span><br><span class="line">	"Server": &#123;</span><br><span class="line">		"Type": "AWS::EC2::Instance", ## EC2 实例描述</span><br><span class="line">		"Properties": &#123;</span><br><span class="line">			"ImageId": &#123;"Fn::FindInMap": ["EC2RegionMap", &#123;"Ref": "AWS::Region"&#125;, "AmazonLinuxAMIHVMEBSBacked64bit"]&#125;, </span><br><span class="line">			"InstanceType": "t2.micro",</span><br><span class="line">			"KeyName": &#123;"Ref": "KeyName"&#125;,</span><br><span class="line">			"SecurityGroupIds": [&#123;"Ref": "SecurityGroup"&#125;], ## 将安全组关联到 EC2 实例上</span><br><span class="line">			"SubnetId": &#123;"Ref": "Subnet"&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>
<p>允许 ICMP 流量</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">"AllowInboundICMP": &#123; ## 允许 ICPM 规则描述</span><br><span class="line">	"Type": "AWS::EC2::SecurityGroupIngress", ## 入站规则类型</span><br><span class="line">	"Properties": &#123;</span><br><span class="line">		"GroupId": &#123;"Ref": "SecurityGroup"&#125;, ## 关联入站规则与安全组</span><br><span class="line">		"IpProtocol": "icmp", ## 指定协议：ICPMP 协议</span><br><span class="line">		"FromPort": "-1", ## -1，意味着所有端口</span><br><span class="line">		"ToPort": "-1",</span><br><span class="line">		"CidrIp": "0.0.0.0/0" ## 0.0.0.0/0 表示所有源IP地址都被允许</span><br><span class="line">	&#125;</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>
<p>允许 SSH 流量</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">"IpForSSH": &#123; ## 公有 IP 地址参数</span><br><span class="line">	"Description": "Your public IP address to allow SSH access",</span><br><span class="line">	"Type": "String"</span><br><span class="line">&#125;</span><br><span class="line">...</span><br><span class="line">"AllowInboundSSH": &#123; ## 允许 SSH 规则描述</span><br><span class="line">	"Type": "AWS::EC2::SecurityGroupIngress", ## 入站规则类型</span><br><span class="line">	"Properties": &#123;</span><br><span class="line">		"GroupId": &#123;"Ref": "SecurityGroup"&#125;, ## 关联入站规则与安全组</span><br><span class="line">		"IpProtocol": "tcp", ## SSH 基于 TCP 协议</span><br><span class="line">		"FromPort": "22", ## 默认的 SSH 端口号：22</span><br><span class="line">		"ToPort": "22",</span><br><span class="line">		"CidrIp": &#123;"Fn::Join": ["", [&#123;"Ref": "IpForSSH"&#125;, "/32"]]&#125; ## 指定源IP</span><br><span class="line">	&#125;</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>
<p>查看你的公有IP地址：<a href="http://api.ipify.org" target="_blank" rel="noopener">http://api.ipify.org</a></p>
<h3 id="在云中创建一个私有网络：虚拟私有云（VPC）"><a href="#在云中创建一个私有网络：虚拟私有云（VPC）" class="headerlink" title="在云中创建一个私有网络：虚拟私有云（VPC）"></a>在云中创建一个私有网络：虚拟私有云（VPC）</h3><h4 id="公有子网-amp-私有子网"><a href="#公有子网-amp-私有子网" class="headerlink" title="公有子网&amp;私有子网"></a>公有子网&amp;私有子网</h4><blockquote>
<p>💡</p>
<p>用户应该至少有两个子网，即公有子网和私有子网。公有子网能够路由到互联网，私有子网则不能。</p>
<p>公有子网：用户的网站服务器。</p>
<p>私有子网：用户的数据库服务器。</p>
<p>公有子网和私有子网到唯一区别是，<strong>私有子网不能路由到互联网网关</strong>（ IGW）。</p>
<hr>
<p>私有子网如何访问互联网？如何下载安装应用源码？</p>
<p>在公有子网中使用一个 NAT 服务器，并且创建一条从用户的私有子网到 NAT 服务器的路由。一台 NAT 服务器就是一台用来处理网络地址转换的虚拟服务器。来自用户的私有子网的互联网流量将从 NAT 服务器的公有 IP 地址访问互联网。</p>
</blockquote>
<h4 id="网络安全组-amp-网络访问控制列表-ACL"><a href="#网络安全组-amp-网络访问控制列表-ACL" class="headerlink" title="网络安全组 &amp; 网络访问控制列表 ACL"></a>网络安全组 &amp; 网络访问控制列表 ACL</h4><p><a href="https://docs.aws.amazon.com/zh_cn/vpc/latest/userguide/VPC_Security.html#VPC_Security_Comparison" target="_blank" rel="noopener">安全组与网络 ACL 的比较</a></p>
<p>安全组与ACL有一个重要的区别：<strong>安全组是有状态的，而 ACL 则没有。</strong></p>
<p>如果用户允许在安全组上的一个入站端口，那么该入站端口上的请求对应的出站响应也是被允许的。安全组规则将按用户所期望的方式工作。如果用户在安全组上打开端口22，就能通过SSH连接。</p>
<p>ACL 则不同。如果用户仅仅为子网的 ACL 打开入站端口22，仍然不能通过 SSH 访问。除此之外，用户还需要允许出站临时端口，因为 sshd（SSH守护进程）在端口22上接受连接，但却使用临时端口与客户端通信。临时端口从范围1024至65535中选择。<br>如果用户想从自己的子网发起一个 SSH 连接，就需要打开出站端口22且同时打开入站临时端口。如果对这些都不熟悉，应该使用安全组且在ACL层允许所有。</p>
<p><img src="http://upload-images.jianshu.io/upload_images/2648731-0a56d8303102f4f8.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="AWS 示例"></p>
<p>上图含义：来自 Internet 网关的数据流会通过路由表中的路径被路由到合适的子网。与子网相关的网络 ACL 规则控制允许进入子网的数据流。与实例相关的安全组规则控制允许进入实例的数据流。</p>
<h4 id="互联网网关-IGW"><a href="#互联网网关-IGW" class="headerlink" title="互联网网关 IGW"></a>互联网网关 IGW</h4><p><strong>IGW （Internet Gateway）</strong>:互联网网关，会使用网络地址转换（network address translation, NAT）把虚拟服务器的公有IP地址转换成它们的私有IP地址。</p>
<h4 id="附：CIDR-（无类域间路由）的概念"><a href="#附：CIDR-（无类域间路由）的概念" class="headerlink" title="附：CIDR （无类域间路由）的概念"></a>附：CIDR （无类域间路由）的概念</h4><p>一个示例：计算 192.168.23.35/21 计算子网的网络 ID、子网掩码、起止 IP 地址？</p>
<p>CIDR 表示法：192.168.23.35/21</p>
<p>IP 地址：   11000000.10101000.00010111.00100011 （192.168.23.35）</p>
<p>子网掩码：<strong>11111111.11111111.11111</strong>000.00000000 （255.255.248.0）即21个1</p>
<p>网络 ID：   <strong>11000000.10101000.00010</strong>000.00000000 （192.168.16.0）</p>
<p>起始 IP 地址： 11000000.10101000.00010<strong>000.00000001</strong> （192.168.16.1）</p>
<p>结束 IP 地址：11000000.10101000.00010<strong>111.11111110</strong> （192.168.23.254）</p>
<p>广播 IP 地址：11000000.10101000.00010<strong>111.11111111</strong> （192.168.23.255）主机 ID 全1。</p>
<h4 id="附：有4个子网来保护网站应用安全的VPC"><a href="#附：有4个子网来保护网站应用安全的VPC" class="headerlink" title="附：有4个子网来保护网站应用安全的VPC"></a>附：有4个子网来保护网站应用安全的VPC</h4><p><img src="http://upload-images.jianshu.io/upload_images/2648731-2799aec829318ffe.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="有4个子网来保护网站应用安全的VPC"></p>
<h5 id="CloudFormation-模版文件示例："><a href="#CloudFormation-模版文件示例：" class="headerlink" title="CloudFormation 模版文件示例："></a>CloudFormation 模版文件示例：</h5><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br><span class="line">552</span><br><span class="line">553</span><br><span class="line">554</span><br><span class="line">555</span><br><span class="line">556</span><br><span class="line">557</span><br><span class="line">558</span><br><span class="line">559</span><br><span class="line">560</span><br><span class="line">561</span><br><span class="line">562</span><br><span class="line">563</span><br><span class="line">564</span><br><span class="line">565</span><br><span class="line">566</span><br><span class="line">567</span><br><span class="line">568</span><br><span class="line">569</span><br><span class="line">570</span><br><span class="line">571</span><br><span class="line">572</span><br><span class="line">573</span><br><span class="line">574</span><br><span class="line">575</span><br><span class="line">576</span><br><span class="line">577</span><br><span class="line">578</span><br><span class="line">579</span><br><span class="line">580</span><br><span class="line">581</span><br><span class="line">582</span><br><span class="line">583</span><br><span class="line">584</span><br><span class="line">585</span><br><span class="line">586</span><br><span class="line">587</span><br><span class="line">588</span><br><span class="line">589</span><br><span class="line">590</span><br><span class="line">591</span><br><span class="line">592</span><br><span class="line">593</span><br><span class="line">594</span><br><span class="line">595</span><br><span class="line">596</span><br><span class="line">597</span><br><span class="line">598</span><br><span class="line">599</span><br><span class="line">600</span><br><span class="line">601</span><br><span class="line">602</span><br><span class="line">603</span><br><span class="line">604</span><br><span class="line">605</span><br><span class="line">606</span><br><span class="line">607</span><br><span class="line">608</span><br><span class="line">609</span><br><span class="line">610</span><br><span class="line">611</span><br><span class="line">612</span><br><span class="line">613</span><br><span class="line">614</span><br><span class="line">615</span><br><span class="line">616</span><br><span class="line">617</span><br><span class="line">618</span><br><span class="line">619</span><br><span class="line">620</span><br><span class="line">621</span><br><span class="line">622</span><br><span class="line">623</span><br><span class="line">624</span><br><span class="line">625</span><br><span class="line">626</span><br><span class="line">627</span><br><span class="line">628</span><br><span class="line">629</span><br><span class="line">630</span><br><span class="line">631</span><br><span class="line">632</span><br><span class="line">633</span><br><span class="line">634</span><br><span class="line">635</span><br><span class="line">636</span><br><span class="line">637</span><br><span class="line">638</span><br><span class="line">639</span><br><span class="line">640</span><br><span class="line">641</span><br><span class="line">642</span><br><span class="line">643</span><br><span class="line">644</span><br><span class="line">645</span><br><span class="line">646</span><br><span class="line">647</span><br><span class="line">648</span><br><span class="line">649</span><br><span class="line">650</span><br><span class="line">651</span><br><span class="line">652</span><br><span class="line">653</span><br><span class="line">654</span><br><span class="line">655</span><br><span class="line">656</span><br><span class="line">657</span><br><span class="line">658</span><br><span class="line">659</span><br><span class="line">660</span><br><span class="line">661</span><br><span class="line">662</span><br><span class="line">663</span><br><span class="line">664</span><br><span class="line">665</span><br><span class="line">666</span><br><span class="line">667</span><br><span class="line">668</span><br><span class="line">669</span><br><span class="line">670</span><br><span class="line">671</span><br><span class="line">672</span><br><span class="line">673</span><br><span class="line">674</span><br><span class="line">675</span><br><span class="line">676</span><br><span class="line">677</span><br><span class="line">678</span><br><span class="line">679</span><br><span class="line">680</span><br><span class="line">681</span><br><span class="line">682</span><br><span class="line">683</span><br><span class="line">684</span><br><span class="line">685</span><br><span class="line">686</span><br><span class="line">687</span><br><span class="line">688</span><br><span class="line">689</span><br><span class="line">690</span><br><span class="line">691</span><br><span class="line">692</span><br><span class="line">693</span><br><span class="line">694</span><br><span class="line">695</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	<span class="attr">"AWSTemplateFormatVersion"</span>: <span class="string">"2010-09-09"</span>,</span><br><span class="line">	<span class="attr">"Description"</span>: <span class="string">"AWS in Action: chapter 6 (VPC)"</span>,</span><br><span class="line">	<span class="attr">"Parameters"</span>: &#123;</span><br><span class="line">		<span class="attr">"KeyName"</span>: &#123;</span><br><span class="line">			<span class="attr">"Description"</span>: <span class="string">"Key Pair name"</span>,</span><br><span class="line">			<span class="attr">"Type"</span>: <span class="string">"AWS::EC2::KeyPair::KeyName"</span>,</span><br><span class="line">			<span class="attr">"Default"</span>: <span class="string">"mykey"</span></span><br><span class="line">		&#125;</span><br><span class="line">	&#125;,</span><br><span class="line">	<span class="attr">"Mappings"</span>: &#123;</span><br><span class="line">		<span class="attr">"EC2RegionMap"</span>: &#123;</span><br><span class="line">			<span class="attr">"ap-northeast-1"</span>: &#123;<span class="attr">"AmazonLinuxAMIHVMEBSBacked64bit"</span>: <span class="string">"ami-cbf90ecb"</span>, <span class="attr">"AmazonLinuxNATAMIHVMEBSBacked64bit"</span>: <span class="string">"ami-03cf3903"</span>&#125;,</span><br><span class="line">			<span class="attr">"ap-southeast-1"</span>: &#123;<span class="attr">"AmazonLinuxAMIHVMEBSBacked64bit"</span>: <span class="string">"ami-68d8e93a"</span>, <span class="attr">"AmazonLinuxNATAMIHVMEBSBacked64bit"</span>: <span class="string">"ami-b49dace6"</span>&#125;,</span><br><span class="line">			<span class="attr">"ap-southeast-2"</span>: &#123;<span class="attr">"AmazonLinuxAMIHVMEBSBacked64bit"</span>: <span class="string">"ami-fd9cecc7"</span>, <span class="attr">"AmazonLinuxNATAMIHVMEBSBacked64bit"</span>: <span class="string">"ami-e7ee9edd"</span>&#125;,</span><br><span class="line">			<span class="attr">"eu-central-1"</span>: &#123;<span class="attr">"AmazonLinuxAMIHVMEBSBacked64bit"</span>: <span class="string">"ami-a8221fb5"</span>, <span class="attr">"AmazonLinuxNATAMIHVMEBSBacked64bit"</span>: <span class="string">"ami-46073a5b"</span>&#125;,</span><br><span class="line">			<span class="attr">"eu-west-1"</span>: &#123;<span class="attr">"AmazonLinuxAMIHVMEBSBacked64bit"</span>: <span class="string">"ami-a10897d6"</span>, <span class="attr">"AmazonLinuxNATAMIHVMEBSBacked64bit"</span>: <span class="string">"ami-6975eb1e"</span>&#125;,</span><br><span class="line">			<span class="attr">"sa-east-1"</span>: &#123;<span class="attr">"AmazonLinuxAMIHVMEBSBacked64bit"</span>: <span class="string">"ami-b52890a8"</span>, <span class="attr">"AmazonLinuxNATAMIHVMEBSBacked64bit"</span>: <span class="string">"ami-fbfa41e6"</span>&#125;,</span><br><span class="line">			<span class="attr">"us-east-1"</span>: &#123;<span class="attr">"AmazonLinuxAMIHVMEBSBacked64bit"</span>: <span class="string">"ami-1ecae776"</span>, <span class="attr">"AmazonLinuxNATAMIHVMEBSBacked64bit"</span>: <span class="string">"ami-303b1458"</span>&#125;,</span><br><span class="line">			<span class="attr">"us-west-1"</span>: &#123;<span class="attr">"AmazonLinuxAMIHVMEBSBacked64bit"</span>: <span class="string">"ami-d114f295"</span>, <span class="attr">"AmazonLinuxNATAMIHVMEBSBacked64bit"</span>: <span class="string">"ami-7da94839"</span>&#125;,</span><br><span class="line">			<span class="attr">"us-west-2"</span>: &#123;<span class="attr">"AmazonLinuxAMIHVMEBSBacked64bit"</span>: <span class="string">"ami-e7527ed7"</span>, <span class="attr">"AmazonLinuxNATAMIHVMEBSBacked64bit"</span>: <span class="string">"ami-69ae8259"</span>&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;,</span><br><span class="line">	<span class="attr">"Resources"</span>: &#123;</span><br><span class="line">		<span class="attr">"SecurityGroup"</span>: &#123;</span><br><span class="line">			<span class="attr">"Type"</span>: <span class="string">"AWS::EC2::SecurityGroup"</span>,</span><br><span class="line">			<span class="attr">"Properties"</span>: &#123;</span><br><span class="line">				<span class="attr">"GroupDescription"</span>: <span class="string">"My security group"</span>,</span><br><span class="line">				<span class="attr">"VpcId"</span>: &#123;<span class="attr">"Ref"</span>: <span class="string">"VPC"</span>&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;,</span><br><span class="line">		<span class="attr">"SecurityGroupIngress"</span>: &#123;</span><br><span class="line">			<span class="attr">"Type"</span>: <span class="string">"AWS::EC2::SecurityGroupIngress"</span>,</span><br><span class="line">			<span class="attr">"Properties"</span>:&#123;</span><br><span class="line">				<span class="attr">"IpProtocol"</span>: <span class="string">"-1"</span>,</span><br><span class="line">				<span class="attr">"FromPort"</span>: <span class="string">"-1"</span>,</span><br><span class="line">				<span class="attr">"ToPort"</span>: <span class="string">"-1"</span>,</span><br><span class="line">				<span class="attr">"CidrIp"</span>: <span class="string">"0.0.0.0/0"</span>,</span><br><span class="line">				<span class="attr">"GroupId"</span>: &#123;<span class="attr">"Ref"</span>: <span class="string">"SecurityGroup"</span>&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;,</span><br><span class="line">		<span class="attr">"SecurityGroupEgress"</span>: &#123;</span><br><span class="line">			<span class="attr">"Type"</span>: <span class="string">"AWS::EC2::SecurityGroupEgress"</span>,</span><br><span class="line">			<span class="attr">"Properties"</span>:&#123;</span><br><span class="line">				<span class="attr">"IpProtocol"</span>: <span class="string">"-1"</span>,</span><br><span class="line">				<span class="attr">"FromPort"</span>: <span class="string">"-1"</span>,</span><br><span class="line">				<span class="attr">"ToPort"</span>: <span class="string">"-1"</span>,</span><br><span class="line">				<span class="attr">"CidrIp"</span>: <span class="string">"0.0.0.0/0"</span>,</span><br><span class="line">				<span class="attr">"GroupId"</span>: &#123;<span class="attr">"Ref"</span>: <span class="string">"SecurityGroup"</span>&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;,</span><br><span class="line">		"VPC": &#123; ## 1.虚拟网络 VPC</span><br><span class="line">			"Type": "AWS::EC2::VPC",</span><br><span class="line">			"Properties": &#123;</span><br><span class="line">				"CidrBlock": "10.0.0.0/16", ## 地址空间</span><br><span class="line">				"EnableDnsHostnames": "true"</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;,</span><br><span class="line">		"InternetGateway": &#123;  ## 互联网网关 IGW</span><br><span class="line">			"Type": "AWS::EC2::InternetGateway",</span><br><span class="line">			"Properties": &#123;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;,</span><br><span class="line">		"VPCGatewayAttachment": &#123; ## 将网关关联到VPC</span><br><span class="line">			"Type": "AWS::EC2::VPCGatewayAttachment",</span><br><span class="line">			"Properties": &#123;</span><br><span class="line">				"VpcId": &#123;"Ref": "VPC"&#125;,</span><br><span class="line">				"InternetGatewayId": &#123;"Ref": "InternetGateway"&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;,</span><br><span class="line">		"SubnetPublicNAT": &#123; ## 1.1 公有 NAT 子网</span><br><span class="line">			"Type": "AWS::EC2::Subnet",</span><br><span class="line">			"Properties": &#123;</span><br><span class="line">				"AvailabilityZone": &#123;"Fn::Select": ["0", &#123;"Fn::GetAZs": ""&#125;]&#125;,</span><br><span class="line">				"CidrBlock": "10.0.0.0/24", ## NAT 子网的地址空间</span><br><span class="line">				"VpcId": &#123;"Ref": "VPC"&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;,</span><br><span class="line">		"RouteTablePublicNAT": &#123;</span><br><span class="line">			"Type": "AWS::EC2::RouteTable",</span><br><span class="line">			"Properties": &#123;</span><br><span class="line">				"VpcId": &#123;"Ref": "VPC"&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;,</span><br><span class="line">		"RouteTableAssociationPublicNAT": &#123;</span><br><span class="line">			"Type": "AWS::EC2::SubnetRouteTableAssociation",</span><br><span class="line">			"Properties": &#123;</span><br><span class="line">				"SubnetId": &#123;"Ref": "SubnetPublicNAT"&#125;,</span><br><span class="line">				"RouteTableId": &#123;"Ref": "RouteTablePublicNAT"&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;,</span><br><span class="line">		"RoutePublicNATToInternet": &#123; ## NAT 子网是公有的能路由到互联网</span><br><span class="line">			"Type": "AWS::EC2::Route",</span><br><span class="line">			"Properties": &#123;</span><br><span class="line">				"RouteTableId": &#123;"Ref": "RouteTablePublicNAT"&#125;,</span><br><span class="line">				"DestinationCidrBlock": "0.0.0.0/0",</span><br><span class="line">				"GatewayId": &#123;"Ref": "InternetGateway"&#125;</span><br><span class="line">			&#125;,</span><br><span class="line">			"DependsOn": "VPCGatewayAttachment"</span><br><span class="line">		&#125;,</span><br><span class="line">		"NetworkAclPublicNAT": &#123;</span><br><span class="line">			"Type": "AWS::EC2::NetworkAcl",</span><br><span class="line">			"Properties": &#123;</span><br><span class="line">				"VpcId": &#123;"Ref": "VPC"&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;,</span><br><span class="line">		"SubnetNetworkAclAssociationPublicNAT": &#123;</span><br><span class="line">			"Type": "AWS::EC2::SubnetNetworkAclAssociation",</span><br><span class="line">			"Properties": &#123;</span><br><span class="line">				"SubnetId": &#123;"Ref": "SubnetPublicNAT"&#125;,</span><br><span class="line">				"NetworkAclId": &#123;"Ref": "NetworkAclPublicNAT"&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;,</span><br><span class="line">		"NetworkAclEntryInPublicNATHTTP": &#123;</span><br><span class="line">			"Type": "AWS::EC2::NetworkAclEntry",</span><br><span class="line">			"Properties": &#123;</span><br><span class="line">				"NetworkAclId": &#123;"Ref": "NetworkAclPublicNAT"&#125;,</span><br><span class="line">				"RuleNumber": "100",</span><br><span class="line">				"Protocol": "6",</span><br><span class="line">				"PortRange": &#123;</span><br><span class="line">					"From": "80",</span><br><span class="line">					"To": "80"</span><br><span class="line">				&#125;,</span><br><span class="line">				"RuleAction": "allow",</span><br><span class="line">				"Egress": "false",</span><br><span class="line">				"CidrBlock": "10.0.0.0/16"</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;,</span><br><span class="line">		"NetworkAclEntryInPublicNATHTTPS": &#123;</span><br><span class="line">			"Type": "AWS::EC2::NetworkAclEntry",</span><br><span class="line">			"Properties": &#123;</span><br><span class="line">				"NetworkAclId": &#123;"Ref": "NetworkAclPublicNAT"&#125;,</span><br><span class="line">				"RuleNumber": "110",</span><br><span class="line">				"Protocol": "6",</span><br><span class="line">				"PortRange": &#123;</span><br><span class="line">					"From": "443",</span><br><span class="line">					"To": "443"</span><br><span class="line">				&#125;,</span><br><span class="line">				"RuleAction": "allow",</span><br><span class="line">				"Egress": "false",</span><br><span class="line">				"CidrBlock": "10.0.0.0/16"</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;,</span><br><span class="line">		"NetworkAclEntryInPublicNATEphemeralPorts": &#123;</span><br><span class="line">			"Type": "AWS::EC2::NetworkAclEntry",</span><br><span class="line">			"Properties": &#123;</span><br><span class="line">				"NetworkAclId": &#123;"Ref": "NetworkAclPublicNAT"&#125;,</span><br><span class="line">				"RuleNumber": "200",</span><br><span class="line">				"Protocol": "6",</span><br><span class="line">				"PortRange": &#123;</span><br><span class="line">					"From": "1024",</span><br><span class="line">					"To": "65535"</span><br><span class="line">				&#125;,</span><br><span class="line">				"RuleAction": "allow",</span><br><span class="line">				"Egress": "false",</span><br><span class="line">				"CidrBlock": "0.0.0.0/0"</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;,</span><br><span class="line">		"NetworkAclEntryOutPublicNATHTTP": &#123;</span><br><span class="line">			"Type": "AWS::EC2::NetworkAclEntry",</span><br><span class="line">			"Properties": &#123;</span><br><span class="line">				"NetworkAclId": &#123;"Ref": "NetworkAclPublicNAT"&#125;,</span><br><span class="line">				"RuleNumber": "100",</span><br><span class="line">				"Protocol": "6",</span><br><span class="line">				"PortRange": &#123;</span><br><span class="line">					"From": "80",</span><br><span class="line">					"To": "80"</span><br><span class="line">				&#125;,</span><br><span class="line">				"RuleAction": "allow",</span><br><span class="line">				"Egress": "true",</span><br><span class="line">				"CidrBlock": "0.0.0.0/0"</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;,</span><br><span class="line">		"NetworkAclEntryOutPublicNATHTTPS": &#123;</span><br><span class="line">			"Type": "AWS::EC2::NetworkAclEntry",</span><br><span class="line">			"Properties": &#123;</span><br><span class="line">				"NetworkAclId": &#123;"Ref": "NetworkAclPublicNAT"&#125;,</span><br><span class="line">				"RuleNumber": "110",</span><br><span class="line">				"Protocol": "6",</span><br><span class="line">				"PortRange": &#123;</span><br><span class="line">					"From": "443",</span><br><span class="line">					"To": "443"</span><br><span class="line">				&#125;,</span><br><span class="line">				"RuleAction": "allow",</span><br><span class="line">				"Egress": "true",</span><br><span class="line">				"CidrBlock": "0.0.0.0/0"</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;,</span><br><span class="line">		"NetworkAclEntryOutPublicNATEphemeralPorts": &#123;</span><br><span class="line">			"Type": "AWS::EC2::NetworkAclEntry",</span><br><span class="line">			"Properties": &#123;</span><br><span class="line">				"NetworkAclId": &#123;"Ref": "NetworkAclPublicNAT"&#125;,</span><br><span class="line">				"RuleNumber": "200",</span><br><span class="line">				"Protocol": "6",</span><br><span class="line">				"PortRange": &#123;</span><br><span class="line">					"From": "1024",</span><br><span class="line">					"To": "65535"</span><br><span class="line">				&#125;,</span><br><span class="line">				"RuleAction": "allow",</span><br><span class="line">				"Egress": "true",</span><br><span class="line">				"CidrBlock": "0.0.0.0/0"</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;,</span><br><span class="line">		"SubnetPublicSSHBastion": &#123; ## 1.2 公有堡垒主机子网</span><br><span class="line">			"Type": "AWS::EC2::Subnet",</span><br><span class="line">			"Properties": &#123;</span><br><span class="line">				"AvailabilityZone": &#123;"Fn::Select": ["0", &#123;"Fn::GetAZs": ""&#125;]&#125;,</span><br><span class="line">				"CidrBlock": "10.0.1.0/24", ## 公有子网地址空间</span><br><span class="line">				"VpcId": &#123;"Ref": "VPC"&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;,</span><br><span class="line">		"RouteTablePublicSSHBastion": &#123; ## 路由表</span><br><span class="line">			"Type": "AWS::EC2::RouteTable",</span><br><span class="line">			"Properties": &#123;</span><br><span class="line">				"VpcId": &#123;"Ref": "VPC"&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;,</span><br><span class="line">		"RouteTableAssociationPublicSSHBastion": &#123; ## 将路由表关联到子网</span><br><span class="line">			"Type": "AWS::EC2::SubnetRouteTableAssociation",</span><br><span class="line">			"Properties": &#123;</span><br><span class="line">				"SubnetId": &#123;"Ref": "SubnetPublicSSHBastion"&#125;,</span><br><span class="line">				"RouteTableId": &#123;"Ref": "RouteTablePublicSSHBastion"&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;,</span><br><span class="line">		"RoutePublicSSHBastionToInternet": &#123;</span><br><span class="line">			"Type": "AWS::EC2::Route",</span><br><span class="line">			"Properties": &#123;</span><br><span class="line">				"RouteTableId": &#123;"Ref": "RouteTablePublicSSHBastion"&#125;,</span><br><span class="line">				"DestinationCidrBlock": "0.0.0.0/0", ## 将任何地址路由至 IGW</span><br><span class="line">				"GatewayId": &#123;"Ref": "InternetGateway"&#125;</span><br><span class="line">			&#125;,</span><br><span class="line">			"DependsOn": "VPCGatewayAttachment"</span><br><span class="line">		&#125;,</span><br><span class="line">		"NetworkAclPublicSSHBastion": &#123; ## 公有子网访问控制列表 ACL</span><br><span class="line">			"Type": "AWS::EC2::NetworkAcl",</span><br><span class="line">			"Properties": &#123;</span><br><span class="line">				"VpcId": &#123;"Ref": "VPC"&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;,</span><br><span class="line">		"SubnetNetworkAclAssociationPublicSSHBastion": &#123; ## 关联</span><br><span class="line">			"Type": "AWS::EC2::SubnetNetworkAclAssociation",</span><br><span class="line">			"Properties": &#123;</span><br><span class="line">				"SubnetId": &#123;"Ref": "SubnetPublicSSHBastion"&#125;,</span><br><span class="line">				"NetworkAclId": &#123;"Ref": "NetworkAclPublicSSHBastion"&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;,</span><br><span class="line">		"NetworkAclEntryInPublicSSHBastionSSH": &#123; ## 允许来自任何地方的入站 SSH 流量</span><br><span class="line">			"Type": "AWS::EC2::NetworkAclEntry",</span><br><span class="line">			"Properties": &#123;</span><br><span class="line">				"NetworkAclId": &#123;"Ref": "NetworkAclPublicSSHBastion"&#125;,</span><br><span class="line">				"RuleNumber": "100",</span><br><span class="line">				"Protocol": "6",</span><br><span class="line">				"PortRange": &#123;</span><br><span class="line">					"From": "22",</span><br><span class="line">					"To": "22"</span><br><span class="line">				&#125;,</span><br><span class="line">				"RuleAction": "allow",</span><br><span class="line">				"Egress": "false",</span><br><span class="line">				"CidrBlock": "0.0.0.0/0"</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;,</span><br><span class="line">		"NetworkAclEntryInPublicSSHBastionEphemeralPorts": &#123; ## 用于短 TCP/IP 连接的入站临时端口</span><br><span class="line">			"Type": "AWS::EC2::NetworkAclEntry",</span><br><span class="line">			"Properties": &#123;</span><br><span class="line">				"NetworkAclId": &#123;"Ref": "NetworkAclPublicSSHBastion"&#125;,</span><br><span class="line">				"RuleNumber": "200",</span><br><span class="line">				"Protocol": "6",</span><br><span class="line">				"PortRange": &#123;</span><br><span class="line">					"From": "1024",</span><br><span class="line">					"To": "65535"</span><br><span class="line">				&#125;,</span><br><span class="line">				"RuleAction": "allow",</span><br><span class="line">				"Egress": "false",</span><br><span class="line">				"CidrBlock": "10.0.0.0/16"</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;,</span><br><span class="line">		"NetworkAclEntryOutPublicSSHBastionSSH": &#123; ## 允许从 VPC 出站的 SSH 流量</span><br><span class="line">			"Type": "AWS::EC2::NetworkAclEntry",</span><br><span class="line">			"Properties": &#123;</span><br><span class="line">				"NetworkAclId": &#123;"Ref": "NetworkAclPublicSSHBastion"&#125;,</span><br><span class="line">				"RuleNumber": "100",</span><br><span class="line">				"Protocol": "6",</span><br><span class="line">				"PortRange": &#123;</span><br><span class="line">					"From": "22",</span><br><span class="line">					"To": "22"</span><br><span class="line">				&#125;,</span><br><span class="line">				"RuleAction": "allow",</span><br><span class="line">				"Egress": "true",</span><br><span class="line">				"CidrBlock": "10.0.0.0/16"</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;,</span><br><span class="line">		"NetworkAclEntryOutPublicSSHBastionEphemeralPorts": &#123;  ## 出站临时端口,用于 SSH 出站连接</span><br><span class="line">			"Type": "AWS::EC2::NetworkAclEntry",</span><br><span class="line">			"Properties": &#123;</span><br><span class="line">				"NetworkAclId": &#123;"Ref": "NetworkAclPublicSSHBastion"&#125;,</span><br><span class="line">				"RuleNumber": "200",</span><br><span class="line">				"Protocol": "6",</span><br><span class="line">				"PortRange": &#123;</span><br><span class="line">					"From": "1024",</span><br><span class="line">					"To": "65535"</span><br><span class="line">				&#125;,</span><br><span class="line">				"RuleAction": "allow",</span><br><span class="line">				"Egress": "true",</span><br><span class="line">				"CidrBlock": "0.0.0.0/0"</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;,</span><br><span class="line">		"SubnetPublicVarnish": &#123;  ## 1.3 Varnish 网络缓存子网，公有子网</span><br><span class="line">			"Type": "AWS::EC2::Subnet",</span><br><span class="line">			"Properties": &#123;</span><br><span class="line">				"AvailabilityZone": &#123;"Fn::Select": ["0", &#123;"Fn::GetAZs": ""&#125;]&#125;,</span><br><span class="line">				"CidrBlock": "10.0.2.0/24", ## 地址空间</span><br><span class="line">				"VpcId": &#123;"Ref": "VPC"&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;,</span><br><span class="line">		"RouteTablePublicVarnish": &#123;</span><br><span class="line">			"Type": "AWS::EC2::RouteTable",</span><br><span class="line">			"Properties": &#123;</span><br><span class="line">				"VpcId": &#123;"Ref": "VPC"&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;,</span><br><span class="line">		"RouteTableAssociationPublicVarnish": &#123;</span><br><span class="line">			"Type": "AWS::EC2::SubnetRouteTableAssociation",</span><br><span class="line">			"Properties": &#123;</span><br><span class="line">				"SubnetId": &#123;"Ref": "SubnetPublicVarnish"&#125;,</span><br><span class="line">				"RouteTableId": &#123;"Ref": "RouteTablePublicVarnish"&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;,</span><br><span class="line">		"RoutePublicVarnishToInternet": &#123;</span><br><span class="line">			"Type": "AWS::EC2::Route",</span><br><span class="line">			"Properties": &#123;</span><br><span class="line">				"RouteTableId": &#123;"Ref": "RouteTablePublicVarnish"&#125;,</span><br><span class="line">				"DestinationCidrBlock": "0.0.0.0/0",</span><br><span class="line">				"GatewayId": &#123;"Ref": "InternetGateway"&#125;</span><br><span class="line">			&#125;,</span><br><span class="line">			"DependsOn": "VPCGatewayAttachment"</span><br><span class="line">		&#125;,</span><br><span class="line">		"NetworkAclPublicVarnish": &#123;</span><br><span class="line">			"Type": "AWS::EC2::NetworkAcl",</span><br><span class="line">			"Properties": &#123;</span><br><span class="line">				"VpcId": &#123;"Ref": "VPC"&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;,</span><br><span class="line">		"SubnetNetworkAclAssociationPublicVarnish": &#123;</span><br><span class="line">			"Type": "AWS::EC2::SubnetNetworkAclAssociation",</span><br><span class="line">			"Properties": &#123;</span><br><span class="line">				"SubnetId": &#123;"Ref": "SubnetPublicVarnish"&#125;,</span><br><span class="line">				"NetworkAclId": &#123;"Ref": "NetworkAclPublicVarnish"&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;,</span><br><span class="line">		"NetworkAclEntryInPublicVarnishSSH": &#123;</span><br><span class="line">			"Type": "AWS::EC2::NetworkAclEntry",</span><br><span class="line">			"Properties": &#123;</span><br><span class="line">				"NetworkAclId": &#123;"Ref": "NetworkAclPublicVarnish"&#125;,</span><br><span class="line">				"RuleNumber": "100",</span><br><span class="line">				"Protocol": "6",</span><br><span class="line">				"PortRange": &#123;</span><br><span class="line">					"From": "22",</span><br><span class="line">					"To": "22"</span><br><span class="line">				&#125;,</span><br><span class="line">				"RuleAction": "allow",</span><br><span class="line">				"Egress": "false",</span><br><span class="line">				"CidrBlock": "10.0.1.0/24"</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;,</span><br><span class="line">		"NetworkAclEntryInPublicVarnishHTTP": &#123;</span><br><span class="line">			"Type": "AWS::EC2::NetworkAclEntry",</span><br><span class="line">			"Properties": &#123;</span><br><span class="line">				"NetworkAclId": &#123;"Ref": "NetworkAclPublicVarnish"&#125;,</span><br><span class="line">				"RuleNumber": "110",</span><br><span class="line">				"Protocol": "6",</span><br><span class="line">				"PortRange": &#123;</span><br><span class="line">					"From": "80",</span><br><span class="line">					"To": "80"</span><br><span class="line">				&#125;,</span><br><span class="line">				"RuleAction": "allow",</span><br><span class="line">				"Egress": "false",</span><br><span class="line">				"CidrBlock": "0.0.0.0/0"</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;,</span><br><span class="line">		"NetworkAclEntryInPublicVarnishEphemeralPorts": &#123;</span><br><span class="line">			"Type": "AWS::EC2::NetworkAclEntry",</span><br><span class="line">			"Properties": &#123;</span><br><span class="line">				"NetworkAclId": &#123;"Ref": "NetworkAclPublicVarnish"&#125;,</span><br><span class="line">				"RuleNumber": "200",</span><br><span class="line">				"Protocol": "6",</span><br><span class="line">				"PortRange": &#123;</span><br><span class="line">					"From": "1024",</span><br><span class="line">					"To": "65535"</span><br><span class="line">				&#125;,</span><br><span class="line">				"RuleAction": "allow",</span><br><span class="line">				"Egress": "false",</span><br><span class="line">				"CidrBlock": "0.0.0.0/0"</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;,</span><br><span class="line">		"NetworkAclEntryOutPublicVarnishHTTP": &#123;</span><br><span class="line">			"Type": "AWS::EC2::NetworkAclEntry",</span><br><span class="line">			"Properties": &#123;</span><br><span class="line">				"NetworkAclId": &#123;"Ref": "NetworkAclPublicVarnish"&#125;,</span><br><span class="line">				"RuleNumber": "100",</span><br><span class="line">				"Protocol": "6",</span><br><span class="line">				"PortRange": &#123;</span><br><span class="line">					"From": "80",</span><br><span class="line">					"To": "80"</span><br><span class="line">				&#125;,</span><br><span class="line">				"RuleAction": "allow",</span><br><span class="line">				"Egress": "true",</span><br><span class="line">				"CidrBlock": "0.0.0.0/0"</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;,</span><br><span class="line">		"NetworkAclEntryOutPublicVarnishHTTPS": &#123;</span><br><span class="line">			"Type": "AWS::EC2::NetworkAclEntry",</span><br><span class="line">			"Properties": &#123;</span><br><span class="line">				"NetworkAclId": &#123;"Ref": "NetworkAclPublicVarnish"&#125;,</span><br><span class="line">				"RuleNumber": "110",</span><br><span class="line">				"Protocol": "6",</span><br><span class="line">				"PortRange": &#123;</span><br><span class="line">					"From": "443",</span><br><span class="line">					"To": "443"</span><br><span class="line">				&#125;,</span><br><span class="line">				"RuleAction": "allow",</span><br><span class="line">				"Egress": "true",</span><br><span class="line">				"CidrBlock": "0.0.0.0/0"</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;,</span><br><span class="line">		"NetworkAclEntryOutPublicVarnishEphemeralPorts": &#123;</span><br><span class="line">			"Type": "AWS::EC2::NetworkAclEntry",</span><br><span class="line">			"Properties": &#123;</span><br><span class="line">				"NetworkAclId": &#123;"Ref": "NetworkAclPublicVarnish"&#125;,</span><br><span class="line">				"RuleNumber": "200",</span><br><span class="line">				"Protocol": "6",</span><br><span class="line">				"PortRange": &#123;</span><br><span class="line">					"From": "1024",</span><br><span class="line">					"To": "65535"</span><br><span class="line">				&#125;,</span><br><span class="line">				"RuleAction": "allow",</span><br><span class="line">				"Egress": "true",</span><br><span class="line">				"CidrBlock": "0.0.0.0/0"</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;,</span><br><span class="line">		"SubnetPrivateApache": &#123; ## 1.4 Apache 网站服务器私有子网</span><br><span class="line">			"Type": "AWS::EC2::Subnet",</span><br><span class="line">			"Properties": &#123;</span><br><span class="line">				"AvailabilityZone": &#123;"Fn::Select": ["0", &#123;"Fn::GetAZs": ""&#125;]&#125;,</span><br><span class="line">				"CidrBlock": "10.0.3.0/24", ## 私有子网地址空间</span><br><span class="line">				"VpcId": &#123;"Ref": "VPC"&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;,</span><br><span class="line">		# 公有子网和私有子网到唯一区别是，私有子网不能路由到互联网网关（ IGW）。</span><br><span class="line">		"RouteTablePrivateApache": &#123; ## Apache 私有子网路由表。没有路由到 IGW。</span><br><span class="line">			"Type": "AWS::EC2::RouteTable",</span><br><span class="line">			"Properties": &#123;</span><br><span class="line">				"VpcId": &#123;"Ref": "VPC"&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;,</span><br><span class="line">		"RouteTableAssociationPrivateApache": &#123;</span><br><span class="line">			"Type": "AWS::EC2::SubnetRouteTableAssociation",</span><br><span class="line">			"Properties": &#123;</span><br><span class="line">				"SubnetId": &#123;"Ref": "SubnetPrivateApache"&#125;,</span><br><span class="line">				"RouteTableId": &#123;"Ref": "RouteTablePrivateApache"&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;,</span><br><span class="line">		"RoutePrivateApacheToInternet": &#123;</span><br><span class="line">			"Type": "AWS::EC2::Route",</span><br><span class="line">			"Properties": &#123;</span><br><span class="line">				"RouteTableId": &#123;"Ref": "RouteTablePrivateApache"&#125;,</span><br><span class="line">				"DestinationCidrBlock": "0.0.0.0/0", </span><br><span class="line">				"InstanceId": &#123;"Ref": "NatServer"&#125; ## 从 Apache 子网路由到 NAT 实例</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;,</span><br><span class="line">		"NetworkAclPrivateApache": &#123; ## Apache 私有子网 ACL </span><br><span class="line">			"Type": "AWS::EC2::NetworkAcl",</span><br><span class="line">			"Properties": &#123;</span><br><span class="line">				"VpcId": &#123;"Ref": "VPC"&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;,</span><br><span class="line">		"SubnetNetworkAclAssociationPrivateApache": &#123;</span><br><span class="line">			"Type": "AWS::EC2::SubnetNetworkAclAssociation",</span><br><span class="line">			"Properties": &#123;</span><br><span class="line">				"SubnetId": &#123;"Ref": "SubnetPrivateApache"&#125;,</span><br><span class="line">				"NetworkAclId": &#123;"Ref": "NetworkAclPrivateApache"&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;,</span><br><span class="line">		"NetworkAclEntryInPrivateApacheSSH": &#123;</span><br><span class="line">			"Type": "AWS::EC2::NetworkAclEntry",</span><br><span class="line">			"Properties": &#123;</span><br><span class="line">				"NetworkAclId": &#123;"Ref": "NetworkAclPrivateApache"&#125;,</span><br><span class="line">				"RuleNumber": "100",</span><br><span class="line">				"Protocol": "6",</span><br><span class="line">				"PortRange": &#123;</span><br><span class="line">					"From": "22",</span><br><span class="line">					"To": "22"</span><br><span class="line">				&#125;,</span><br><span class="line">				"RuleAction": "allow",</span><br><span class="line">				"Egress": "false",</span><br><span class="line">				"CidrBlock": "10.0.1.0/24"</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;,</span><br><span class="line">		"NetworkAclEntryInPrivateApacheHTTP": &#123;</span><br><span class="line">			"Type": "AWS::EC2::NetworkAclEntry",</span><br><span class="line">			"Properties": &#123;</span><br><span class="line">				"NetworkAclId": &#123;"Ref": "NetworkAclPrivateApache"&#125;,</span><br><span class="line">				"RuleNumber": "110",</span><br><span class="line">				"Protocol": "6",</span><br><span class="line">				"PortRange": &#123;</span><br><span class="line">					"From": "80",</span><br><span class="line">					"To": "80"</span><br><span class="line">				&#125;,</span><br><span class="line">				"RuleAction": "allow",</span><br><span class="line">				"Egress": "false",</span><br><span class="line">				"CidrBlock": "10.0.2.0/24"</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;,</span><br><span class="line">		"NetworkAclEntryInPrivateApacheEphemeralPorts": &#123;</span><br><span class="line">			"Type": "AWS::EC2::NetworkAclEntry",</span><br><span class="line">			"Properties": &#123;</span><br><span class="line">				"NetworkAclId": &#123;"Ref": "NetworkAclPrivateApache"&#125;,</span><br><span class="line">				"RuleNumber": "200",</span><br><span class="line">				"Protocol": "6",</span><br><span class="line">				"PortRange": &#123;</span><br><span class="line">					"From": "1024",</span><br><span class="line">					"To": "65535"</span><br><span class="line">				&#125;,</span><br><span class="line">				"RuleAction": "allow",</span><br><span class="line">				"Egress": "false",</span><br><span class="line">				"CidrBlock": "0.0.0.0/0"</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;,</span><br><span class="line">		"NetworkAclEntryOutPrivateApacheHTTP": &#123;</span><br><span class="line">			"Type": "AWS::EC2::NetworkAclEntry",</span><br><span class="line">			"Properties": &#123;</span><br><span class="line">				"NetworkAclId": &#123;"Ref": "NetworkAclPrivateApache"&#125;,</span><br><span class="line">				"RuleNumber": "100",</span><br><span class="line">				"Protocol": "6",</span><br><span class="line">				"PortRange": &#123;</span><br><span class="line">					"From": "80",</span><br><span class="line">					"To": "80"</span><br><span class="line">				&#125;,</span><br><span class="line">				"RuleAction": "allow",</span><br><span class="line">				"Egress": "true",</span><br><span class="line">				"CidrBlock": "0.0.0.0/0"</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;,</span><br><span class="line">		"NetworkAclEntryOutPrivateApacheHTTPS": &#123;</span><br><span class="line">			"Type": "AWS::EC2::NetworkAclEntry",</span><br><span class="line">			"Properties": &#123;</span><br><span class="line">				"NetworkAclId": &#123;"Ref": "NetworkAclPrivateApache"&#125;,</span><br><span class="line">				"RuleNumber": "110",</span><br><span class="line">				"Protocol": "6",</span><br><span class="line">				"PortRange": &#123;</span><br><span class="line">					"From": "443",</span><br><span class="line">					"To": "443"</span><br><span class="line">				&#125;,</span><br><span class="line">				"RuleAction": "allow",</span><br><span class="line">				"Egress": "true",</span><br><span class="line">				"CidrBlock": "0.0.0.0/0"</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;,</span><br><span class="line">		"NetworkAclEntryOutPrivateApacheEphemeralPorts": &#123;</span><br><span class="line">			"Type": "AWS::EC2::NetworkAclEntry",</span><br><span class="line">			"Properties": &#123;</span><br><span class="line">				"NetworkAclId": &#123;"Ref": "NetworkAclPrivateApache"&#125;,</span><br><span class="line">				"RuleNumber": "200",</span><br><span class="line">				"Protocol": "6",</span><br><span class="line">				"PortRange": &#123;</span><br><span class="line">					"From": "1024",</span><br><span class="line">					"To": "65535"</span><br><span class="line">				&#125;,</span><br><span class="line">				"RuleAction": "allow",</span><br><span class="line">				"Egress": "true",</span><br><span class="line">				"CidrBlock": "10.0.0.0/16"</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;,</span><br><span class="line">		"NatServer": &#123; ## NAT 服务器，私有子网的互联网流量将从 NAT 服务器的公有 IP 地址访问互联网。</span><br><span class="line">			"Type": "AWS::EC2::Instance",</span><br><span class="line">			"Properties": &#123;</span><br><span class="line">				"ImageId": &#123;"Fn::FindInMap": ["EC2RegionMap", &#123;"Ref": "AWS::Region"&#125;, "AmazonLinuxNATAMIHVMEBSBacked64bit"]&#125;, ## AWS 提供了配置好的 NAT 实例映像</span><br><span class="line">				"InstanceType": "t2.micro",</span><br><span class="line">				"KeyName": &#123;"Ref": "KeyName"&#125;,</span><br><span class="line">				"NetworkInterfaces": [&#123;</span><br><span class="line">					"AssociatePublicIpAddress": "true", ## 分配公有 IP 地址，所有私有子网到互联网流量的源地址</span><br><span class="line">					"DeleteOnTermination": "true",</span><br><span class="line">					"SubnetId": &#123;"Ref": "SubnetPublicNAT"&#125;,</span><br><span class="line">					"DeviceIndex": "0",</span><br><span class="line">					"GroupSet": [&#123;"Ref": "SecurityGroup"&#125;]</span><br><span class="line">				&#125;],</span><br><span class="line">				"SourceDestCheck": "false", ## 默认情况下，一个实例必须是它发送的网络流量的源或者目的地。 对 NAT 实例禁用此检查。</span><br><span class="line">				"UserData": &#123;"Fn::Base64": &#123;"Fn::Join": ["", [</span><br><span class="line">					"#!/bin/bash -ex\n",</span><br><span class="line">					"/opt/aws/bin/cfn-signal --stack ", &#123;"Ref": "AWS::StackName"&#125;, " --resource NatServer --region ", &#123;"Ref": "AWS::Region"&#125;, "\n"</span><br><span class="line">				]]&#125;&#125;</span><br><span class="line">			&#125;,</span><br><span class="line">			"CreationPolicy": &#123;</span><br><span class="line">				"ResourceSignal": &#123;</span><br><span class="line">					"Timeout": "PT5M"</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;,</span><br><span class="line">			"DependsOn": "VPCGatewayAttachment"</span><br><span class="line">		&#125;,</span><br><span class="line">		"BastionHost": &#123; ## 堡垒主机</span><br><span class="line">			"Type": "AWS::EC2::Instance",</span><br><span class="line">			"Properties": &#123;</span><br><span class="line">				"ImageId": &#123;"Fn::FindInMap": ["EC2RegionMap", &#123;"Ref": "AWS::Region"&#125;, "AmazonLinuxAMIHVMEBSBacked64bit"]&#125;,</span><br><span class="line">				"InstanceType": "t2.micro",</span><br><span class="line">				"KeyName": &#123;"Ref": "KeyName"&#125;,</span><br><span class="line">				"NetworkInterfaces": [&#123;</span><br><span class="line">					"AssociatePublicIpAddress": "true", ## 分配一个公有 IP 地址</span><br><span class="line">					"DeleteOnTermination": "true",</span><br><span class="line">					"SubnetId": &#123;"Ref": "SubnetPublicSSHBastion"&#125;, ## 在堡垒主机子网中启动</span><br><span class="line">					"DeviceIndex": "0",</span><br><span class="line">					"GroupSet": [&#123;"Ref": "SecurityGroup"&#125;] ## 安全组允许所有流量</span><br><span class="line">				&#125;]</span><br><span class="line">			&#125;,</span><br><span class="line">			"DependsOn": "VPCGatewayAttachment"</span><br><span class="line">		&#125;,</span><br><span class="line">		"VarnishServer": &#123; ## Varnish 服务器</span><br><span class="line">			"Type": "AWS::EC2::Instance",</span><br><span class="line">			"Properties": &#123;</span><br><span class="line">				"ImageId": &#123;"Fn::FindInMap": ["EC2RegionMap", &#123;"Ref": "AWS::Region"&#125;, "AmazonLinuxAMIHVMEBSBacked64bit"]&#125;,</span><br><span class="line">				"InstanceType": "t2.micro",</span><br><span class="line">				"KeyName": &#123;"Ref": "KeyName"&#125;,</span><br><span class="line">				"NetworkInterfaces": [&#123;</span><br><span class="line">					"AssociatePublicIpAddress": "true",</span><br><span class="line">					"DeleteOnTermination": "true",</span><br><span class="line">					"SubnetId": &#123;"Ref": "SubnetPublicVarnish"&#125;,</span><br><span class="line">					"DeviceIndex": "0",</span><br><span class="line">					"GroupSet": [&#123;"Ref": "SecurityGroup"&#125;]</span><br><span class="line">				&#125;],</span><br><span class="line">				"UserData": &#123;"Fn::Base64": &#123;"Fn::Join": ["", [</span><br><span class="line">					"#!/bin/bash -ex\n",</span><br><span class="line">					"yum -y install varnish-3.0.7\n",</span><br><span class="line">					"cat &gt; /etc/varnish/default.vcl &lt;&lt; EOF\n",</span><br><span class="line">					"backend default &#123;\n",</span><br><span class="line">					"  .host = \"", &#123;"Fn::GetAtt": ["ApacheServer", "PrivateIp"]&#125; ,"\";\n",</span><br><span class="line">					"  .port = \"80\";\n",</span><br><span class="line">					"&#125;\n",</span><br><span class="line">					"EOF\n",</span><br><span class="line">					"sed -i.bak \"s/^VARNISH_LISTEN_PORT=.*/VARNISH_LISTEN_PORT=80/\" /etc/sysconfig/varnish\n",</span><br><span class="line">					"service varnish start\n",</span><br><span class="line">					"/opt/aws/bin/cfn-signal --stack ", &#123;"Ref": "AWS::StackName"&#125;, " --resource VarnishServer --region ", &#123;"Ref": "AWS::Region"&#125;, "\n"</span><br><span class="line">				]]&#125;&#125;</span><br><span class="line">			&#125;,</span><br><span class="line">			"CreationPolicy": &#123;</span><br><span class="line">				"ResourceSignal": &#123;</span><br><span class="line">					"Timeout": "PT5M"</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;,</span><br><span class="line">			"DependsOn": "VPCGatewayAttachment"</span><br><span class="line">		&#125;,</span><br><span class="line">		"ApacheServer": &#123; ## Apache 服务器</span><br><span class="line">			"Type": "AWS::EC2::Instance",</span><br><span class="line">			"Properties": &#123;</span><br><span class="line">				"ImageId": &#123;"Fn::FindInMap": ["EC2RegionMap", &#123;"Ref": "AWS::Region"&#125;, "AmazonLinuxAMIHVMEBSBacked64bit"]&#125;,</span><br><span class="line">				"InstanceType": "t2.micro",</span><br><span class="line">				"KeyName": &#123;"Ref": "KeyName"&#125;,</span><br><span class="line">				"NetworkInterfaces": [&#123;</span><br><span class="line">					"AssociatePublicIpAddress": "false", ## 不分配公有 IP 地址。</span><br><span class="line">					"DeleteOnTermination": "true",</span><br><span class="line">					"SubnetId": &#123;"Ref": "SubnetPrivateApache"&#125;, ## 在私有子网中启动</span><br><span class="line">					"DeviceIndex": "0",</span><br><span class="line">					"GroupSet": [&#123;"Ref": "SecurityGroup"&#125;]</span><br><span class="line">				&#125;],</span><br><span class="line">				"UserData": &#123;"Fn::Base64": &#123;"Fn::Join": ["", [</span><br><span class="line">					"#!/bin/bash -ex\n",</span><br><span class="line">					"yum -y install httpd\n", ## 从互联网安装 Apache</span><br><span class="line">					"service httpd start\n",</span><br><span class="line">					"/opt/aws/bin/cfn-signal --stack ", &#123;"Ref": "AWS::StackName"&#125;, " --resource ApacheServer --region ", &#123;"Ref": "AWS::Region"&#125;, "\n"</span><br><span class="line">				]]&#125;&#125;</span><br><span class="line">			&#125;,</span><br><span class="line">			"CreationPolicy": &#123;</span><br><span class="line">				"ResourceSignal": &#123;</span><br><span class="line">					"Timeout": "PT10M"</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;,</span><br><span class="line">			"DependsOn": "NatServer"</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;,</span><br><span class="line">	"Outputs": &#123;</span><br><span class="line">		"BastionHostPublicName": &#123;</span><br><span class="line">			"Value": &#123;"Fn::GetAtt": ["BastionHost", "PublicDnsName"]&#125;,</span><br><span class="line">			"Description": "connect via SSH as user ec2-user"</span><br><span class="line">		&#125;,</span><br><span class="line">		"VarnishServerPublicName": &#123;</span><br><span class="line">			"Value": &#123;"Fn::GetAtt": ["VarnishServer", "PublicDnsName"]&#125;,</span><br><span class="line">			"Description": "handles HTTP requests"</span><br><span class="line">		&#125;,</span><br><span class="line">		"VarnishServerPrivateIp": &#123;</span><br><span class="line">			"Value": &#123;"Fn::GetAtt": ["VarnishServer", "PrivateIp"]&#125;,</span><br><span class="line">			"Description": "connect via SSH from bastion host"</span><br><span class="line">		&#125;,</span><br><span class="line">		"ApacheServerPrivateIp": &#123;</span><br><span class="line">			"Value": &#123;"Fn::GetAtt": ["ApacheServer", "PrivateIp"]&#125;,</span><br><span class="line">			"Description": "connect via SSH from bastion host"</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://andy0570.com/2019/01/07/流行的 npm 包/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="独木舟的木">
      <meta itemprop="description" content="有时候阳光很好 有时候阳光很暗">
      <meta itemprop="image" content="https://ws1.sinaimg.cn/large/006tNc79gy1g22m14458rj30u014xu0x.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="独木舟的木">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/01/07/流行的 npm 包/" class="post-title-link" itemprop="url">流行的 npm 包</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2019-01-07 10:05:00" itemprop="dateCreated datePublished" datetime="2019-01-07T10:05:00+08:00">2019-01-07</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2019-04-17 01:57:18" itemprop="dateModified" datetime="2019-04-17T01:57:18+08:00">2019-04-17</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Node-js/" itemprop="url" rel="index"><span itemprop="name">Node.js</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          
            <span id="/2019/01/07/流行的 npm 包/" class="leancloud_visitors" data-flag-title="流行的 npm 包">
              <span class="post-meta-divider">|</span>
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              
                <span class="post-meta-item-text">阅读次数：</span>
              
                <span class="leancloud-visitors-count"></span>
            </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body han-init-context" itemprop="articleBody">

      
      

      
        
          
            <h3 id="GitHub-项目"><a href="#GitHub-项目" class="headerlink" title="GitHub 项目"></a>GitHub 项目</h3><ul>
<li><p><a href="https://prettier.io/" target="_blank" rel="noopener">Prettier</a>——让你可以专注于你正在写的代码，而不是去关心代码的格式；<br>Prettier 是一种代码格式化程序，它以特定的方式为你格式化代码。</p>
</li>
<li><p><a href="https://eslint.org/" target="_blank" rel="noopener">eslint</a>——保持代码整洁；</p>
</li>
<li><p><a href="https://date-fns.org/" target="_blank" rel="noopener">date-fns</a>——moment.js 的轻量级替代品；</p>
</li>
<li><p><a href="https://lodash.com/" target="_blank" rel="noopener">lodash</a>——主要用于 <code>throttle()</code> 和 <code>debounce()</code> 函数；</p>
</li>
<li><p><a href="https://ramdajs.com/" target="_blank" rel="noopener">rambda</a>——如果你真的喜欢函数式编程。</p>
</li>
</ul>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://andy0570.com/2019/01/04/《AWS云计算实战》笔记（四）——自动化部署/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="独木舟的木">
      <meta itemprop="description" content="有时候阳光很好 有时候阳光很暗">
      <meta itemprop="image" content="https://ws1.sinaimg.cn/large/006tNc79gy1g22m14458rj30u014xu0x.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="独木舟的木">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/01/04/《AWS云计算实战》笔记（四）——自动化部署/" class="post-title-link" itemprop="url">《AWS云计算实战》笔记（四）——自动化部署</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2019-01-04 17:06:00" itemprop="dateCreated datePublished" datetime="2019-01-04T17:06:00+08:00">2019-01-04</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2019-04-16 16:28:18" itemprop="dateModified" datetime="2019-04-16T16:28:18+08:00">2019-04-16</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/云计算/" itemprop="url" rel="index"><span itemprop="name">云计算</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          
            <span id="/2019/01/04/《AWS云计算实战》笔记（四）——自动化部署/" class="leancloud_visitors" data-flag-title="《AWS云计算实战》笔记（四）——自动化部署">
              <span class="post-meta-divider">|</span>
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              
                <span class="post-meta-item-text">阅读次数：</span>
              
                <span class="leancloud-visitors-count"></span>
            </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body han-init-context" itemprop="articleBody">

      
      

      
        
          
            <h1 id="自动化部署"><a href="#自动化部署" class="headerlink" title="自动化部署"></a>自动化部署</h1><p>部署：安装、更新和配置应用程序及其依赖的组件。</p>
<p>在 AWS 上部署应用的3个工具：</p>
<ol>
<li>AWS CloudFormation；<ul>
<li>在引导流程结束时运行一个脚本来部署应用。</li>
</ul>
</li>
<li><a href="https://amazonaws-china.com/cn/elasticbeanstalk/?c=7&amp;pt=8" target="_blank" rel="noopener">AWS Elastic Beanstalk</a>；<ul>
<li>适合部署普通 Web 站点应用。</li>
</ul>
</li>
<li>AWS OpsWorks；<ul>
<li>支持部署互相依赖的多层架构应用。</li>
</ul>
</li>
</ol>
<h2 id="一、使用-CloudFormation-在服务器启动时运行脚本"><a href="#一、使用-CloudFormation-在服务器启动时运行脚本" class="headerlink" title="一、使用 CloudFormation 在服务器启动时运行脚本"></a>一、使用 CloudFormation 在服务器启动时运行脚本</h2><blockquote>
<p>AWS CloudFormation 为您提供了一种通用语言来描述和预配置您的云环境中的所有基础设施资源。CloudFormation 使您可以跨所有地区和账户使用简单的文本文件以自动化的安全方式为您的应用程序需要的所有资源建模并对其进行预配置。该文件是您的云环境的单一信任源。 </p>
</blockquote>
<p>在服务器启动时运行一个脚本是简单、有用并且灵活地进行自动化部署的方法。</p>
<p>三个步骤：</p>
<ol>
<li>启动一台仅有操作系统的虚拟服务器；</li>
<li>在引导程序完成后执行一个脚本；</li>
<li>使用脚本安装并配置应用程序；</li>
</ol>
<h3 id="在虚拟服务器上部署-OpenSwan-作为-VPN-服务器"><a href="#在虚拟服务器上部署-OpenSwan-作为-VPN-服务器" class="headerlink" title="在虚拟服务器上部署 OpenSwan 作为 VPN 服务器"></a>在虚拟服务器上部署 OpenSwan 作为 VPN 服务器</h3><h4 id="vpn-create-cloudformation-stack-sh-文件"><a href="#vpn-create-cloudformation-stack-sh-文件" class="headerlink" title="vpn-create-cloudformation-stack.sh 文件"></a>vpn-create-cloudformation-stack.sh 文件</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/bin/bash -ex</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取默认 VPC</span></span><br><span class="line">vpc=$(aws ec2 describe-vpcs --filter <span class="string">"Name=isDefault, Values=true"</span> --query <span class="string">"Vpcs[0].VpcId"</span> --output text)</span><br><span class="line"><span class="comment"># 获取默认子网</span></span><br><span class="line">subnet=$(aws ec2 describe-subnets --filters Name=vpc-id,Values=<span class="variable">$vpc</span> --query Subnets[0].SubnetId --output text)</span><br><span class="line"><span class="comment"># 创建一个随机密码</span></span><br><span class="line">sharedsecret=$(openssl rand -base64 30)</span><br><span class="line">user=vpn</span><br><span class="line"><span class="comment"># 创建一个随机共享密钥</span></span><br><span class="line">password=$(openssl rand -base64 30)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建一个 CloudFormation 堆栈</span></span><br><span class="line">aws cloudformation create-stack --stack-name vpn --template-url \</span><br><span class="line">https://s3.amazonaws.com/awsinaction/chapter5/vpn-cloudformation.json \ <span class="comment"># 1⃣️ CloudFormation 模版文件</span></span><br><span class="line">--parameters ParameterKey=KeyName,ParameterValue=mykey \</span><br><span class="line">ParameterKey=VPC,ParameterValue=<span class="variable">$vpc</span> \</span><br><span class="line">ParameterKey=Subnet,ParameterValue=<span class="variable">$subnet</span> \</span><br><span class="line">ParameterKey=IPSecSharedSecret,ParameterValue=<span class="variable">$sharedsecret</span> \</span><br><span class="line">ParameterKey=VPNUser,ParameterValue=<span class="variable">$user</span> \</span><br><span class="line">ParameterKey=VPNPassword,ParameterValue=<span class="variable">$password</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 如果状态不是 COMPLETE，请在 1 min后重试</span></span><br><span class="line"><span class="keyword">while</span> [[ `aws cloudformation describe-stacks --stack-name vpn --query Stacks[0].StackStatus` != *<span class="string">"COMPLETE"</span>* ]]</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">	sleep 10</span><br><span class="line"><span class="keyword">done</span></span><br><span class="line">aws cloudformation describe-stacks --stack-name vpn --query Stacks[0].Outputs</span><br></pre></td></tr></table></figure>
<h4 id="vpn-cloudformation-json-——使用用户数据来初始化一台虚拟服务器"><a href="#vpn-cloudformation-json-——使用用户数据来初始化一台虚拟服务器" class="headerlink" title="vpn-cloudformation.json  ——使用用户数据来初始化一台虚拟服务器"></a>vpn-cloudformation.json  ——使用用户数据来初始化一台虚拟服务器</h4><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br></pre></td><td class="code"><pre><span class="line"># 使用用户数据来初始化一台虚拟服务器</span><br><span class="line">&#123;</span><br><span class="line">	<span class="attr">"AWSTemplateFormatVersion"</span>: <span class="string">"2010-09-09"</span>,</span><br><span class="line">	<span class="attr">"Description"</span>: <span class="string">"AWS in Action: chapter 5 (OpenSwan acting as VPN IPSec endpoint)"</span>,</span><br><span class="line">	"Parameters": &#123; # 参数，使模版复用成为可能</span><br><span class="line">		"KeyName": &#123; </span><br><span class="line">			"Description": "key for SSH access",</span><br><span class="line">			"Type": "AWS::EC2::KeyPair::KeyName",</span><br><span class="line">			"ConstraintDescription": "Must be the name of an existing key pair."</span><br><span class="line">		&#125;,</span><br><span class="line">		"VPC": &#123;</span><br><span class="line">			"Description": "Just select the one and only default VPC.",</span><br><span class="line">			"Type": "AWS::EC2::VPC::Id"</span><br><span class="line">		&#125;,</span><br><span class="line">		"Subnet": &#123;</span><br><span class="line">			"Description": "Just select one of the available subnets.",</span><br><span class="line">			"Type": "AWS::EC2::Subnet::Id"</span><br><span class="line">		&#125;,</span><br><span class="line">		"IPSecSharedSecret": &#123;</span><br><span class="line">			"Description": "The shared secret key for IPSec.",</span><br><span class="line">			"Type": "String"</span><br><span class="line">		&#125;,</span><br><span class="line">		"VPNUser": &#123;</span><br><span class="line">			"Description": "The VPN user.",</span><br><span class="line">			"Type": "String"</span><br><span class="line">		&#125;,</span><br><span class="line">		"VPNPassword": &#123;</span><br><span class="line">			"Description": "The VPN password.",</span><br><span class="line">			"Type": "String"</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;,</span><br><span class="line">	"Mappings": &#123;</span><br><span class="line">		"EC2RegionMap": &#123;</span><br><span class="line">			"ap-northeast-1": &#123;"AmazonLinuxAMIHVMEBSBacked64bit": "ami-cbf90ecb"&#125;,</span><br><span class="line">			"ap-southeast-1": &#123;"AmazonLinuxAMIHVMEBSBacked64bit": "ami-68d8e93a"&#125;,</span><br><span class="line">			"ap-southeast-2": &#123;"AmazonLinuxAMIHVMEBSBacked64bit": "ami-fd9cecc7"&#125;,</span><br><span class="line">			"eu-central-1": &#123;"AmazonLinuxAMIHVMEBSBacked64bit": "ami-a8221fb5"&#125;,</span><br><span class="line">			"eu-west-1": &#123;"AmazonLinuxAMIHVMEBSBacked64bit": "ami-a10897d6"&#125;,</span><br><span class="line">			"sa-east-1": &#123;"AmazonLinuxAMIHVMEBSBacked64bit": "ami-b52890a8"&#125;,</span><br><span class="line">			"us-east-1": &#123;"AmazonLinuxAMIHVMEBSBacked64bit": "ami-1ecae776"&#125;,</span><br><span class="line">			"us-west-1": &#123;"AmazonLinuxAMIHVMEBSBacked64bit": "ami-d114f295"&#125;,</span><br><span class="line">			"us-west-2": &#123;"AmazonLinuxAMIHVMEBSBacked64bit": "ami-e7527ed7"&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;,</span><br><span class="line">	"Resources": &#123;</span><br><span class="line">		"EC2Instance": &#123; # 描述虚拟服务器</span><br><span class="line">			"Type": "AWS::EC2::Instance",</span><br><span class="line">			"Properties": &#123;</span><br><span class="line">				"InstanceType": "t2.micro",</span><br><span class="line">				"SecurityGroupIds": [&#123;"Ref": "InstanceSecurityGroup"&#125;],</span><br><span class="line">				"KeyName": &#123;"Ref": "KeyName"&#125;,</span><br><span class="line">				"ImageId": &#123;"Fn::FindInMap": ["EC2RegionMap", &#123;"Ref": "AWS::Region"&#125;, "AmazonLinuxAMIHVMEBSBacked64bit"]&#125;,</span><br><span class="line">				"SubnetId": &#123;"Ref": "Subnet"&#125;,</span><br><span class="line">				"UserData": &#123;"Fn::Base64": &#123;"Fn::Join": ["", [ # 为虚拟服务器定义一个 shell 脚本作为用户数据</span><br><span class="line">					"#!/bin/bash -ex\n",</span><br><span class="line">					"export IPSEC_PSK=", &#123;"Ref": "IPSecSharedSecret"&#125;, "\n",</span><br><span class="line">					"export VPN_USER=", &#123;"Ref": "VPNUser"&#125;, "\n",</span><br><span class="line">					"export VPN_PASSWORD=", &#123;"Ref": "VPNPassword"&#125;, "\n",</span><br><span class="line">					"export STACK_NAME=", &#123;"Ref": "AWS::StackName"&#125;, "\n",</span><br><span class="line">					"export REGION=", &#123;"Ref": "AWS::Region"&#125;, "\n",</span><br><span class="line">					"curl -s https://raw.githubusercontent.com/AWSinAction/code/master/chapter5/vpn-setup.sh | bash -ex\n" # 2⃣️ 通过http获取shell脚本并执行</span><br><span class="line">				]]&#125;&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;,</span><br><span class="line">		"InstanceSecurityGroup": &#123;</span><br><span class="line">			"Type": "AWS::EC2::SecurityGroup",</span><br><span class="line">			"Properties": &#123;</span><br><span class="line">				"GroupDescription": "Enable access to VPN server",</span><br><span class="line">				"VpcId": &#123;"Ref": "VPC"&#125;,</span><br><span class="line">				"SecurityGroupIngress": [</span><br><span class="line">					&#123;</span><br><span class="line">						<span class="attr">"IpProtocol"</span>: <span class="string">"tcp"</span>,</span><br><span class="line">						<span class="attr">"FromPort"</span>: <span class="string">"22"</span>,</span><br><span class="line">						<span class="attr">"ToPort"</span>: <span class="string">"22"</span>,</span><br><span class="line">						<span class="attr">"CidrIp"</span>: <span class="string">"0.0.0.0/0"</span></span><br><span class="line">					&#125;,</span><br><span class="line">					&#123;</span><br><span class="line">						<span class="attr">"IpProtocol"</span>: <span class="string">"udp"</span>,</span><br><span class="line">						<span class="attr">"FromPort"</span>: <span class="string">"500"</span>,</span><br><span class="line">						<span class="attr">"ToPort"</span>: <span class="string">"500"</span>,</span><br><span class="line">						<span class="attr">"CidrIp"</span>: <span class="string">"0.0.0.0/0"</span></span><br><span class="line">					&#125;,</span><br><span class="line">					&#123;</span><br><span class="line">						<span class="attr">"IpProtocol"</span>: <span class="string">"udp"</span>,</span><br><span class="line">						<span class="attr">"FromPort"</span>: <span class="string">"1701"</span>,</span><br><span class="line">						<span class="attr">"ToPort"</span>: <span class="string">"1701"</span>,</span><br><span class="line">						<span class="attr">"CidrIp"</span>: <span class="string">"0.0.0.0/0"</span></span><br><span class="line">					&#125;,</span><br><span class="line">					&#123;</span><br><span class="line">						<span class="attr">"IpProtocol"</span>: <span class="string">"udp"</span>,</span><br><span class="line">						<span class="attr">"FromPort"</span>: <span class="string">"4500"</span>,</span><br><span class="line">						<span class="attr">"ToPort"</span>: <span class="string">"4500"</span>,</span><br><span class="line">						<span class="attr">"CidrIp"</span>: <span class="string">"0.0.0.0/0"</span></span><br><span class="line">					&#125;</span><br><span class="line">				]</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;,</span><br><span class="line">	"Outputs": &#123;</span><br><span class="line">		"ServerIP": &#123;</span><br><span class="line">			"Description": "Public IP address of the vpn server",</span><br><span class="line">			"Value": &#123;"Fn::GetAtt": ["EC2Instance", "PublicIp"]&#125;</span><br><span class="line">		&#125;,</span><br><span class="line">		"IPSecSharedSecret": &#123;</span><br><span class="line">			"Description": "The shared key for the VPN connection (IPSec)",</span><br><span class="line">			"Value": &#123;"Ref": "IPSecSharedSecret"&#125;</span><br><span class="line">		&#125;,</span><br><span class="line">		"VPNUser": &#123;</span><br><span class="line">			"Description": "The username for the vpn connection",</span><br><span class="line">			"Value": &#123;"Ref": "VPNUser"&#125;</span><br><span class="line">		&#125;,</span><br><span class="line">		"VPNPassword": &#123;</span><br><span class="line">			"Description": "The password for the vpn connection",</span><br><span class="line">			"Value": &#123;"Ref": "VPNPassword"&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="vpn-setup-sh-使用脚本安装并配置一个-VPN-服务器"><a href="#vpn-setup-sh-使用脚本安装并配置一个-VPN-服务器" class="headerlink" title="vpn-setup.sh - 使用脚本安装并配置一个 VPN 服务器"></a>vpn-setup.sh - 使用脚本安装并配置一个 VPN 服务器</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/bin/bash -ex</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#param IPSEC_PSK the shared secret</span></span><br><span class="line"><span class="comment">#param VPN_USER the vpn username</span></span><br><span class="line"><span class="comment">#param VPN_PASSWORD the vpn password</span></span><br><span class="line"><span class="comment">#param STACK_NAME</span></span><br><span class="line"><span class="comment">#param REGION</span></span><br><span class="line"> </span><br><span class="line"><span class="comment"># 获取虚拟服务器私有 IP 地址</span></span><br><span class="line">PRIVATE_IP=`curl -s http://169.254.169.254/latest/meta-data/<span class="built_in">local</span>-ipv4`</span><br><span class="line"> <span class="comment"># 获取虚拟服务器公有 IP 地址</span></span><br><span class="line">PUBLIC_IP=`curl -s http://169.254.169.254/latest/meta-data/public-ipv4`</span><br><span class="line"></span><br><span class="line"><span class="comment"># 向包管理器 yum 添加额外程序包</span></span><br><span class="line">yum-config-manager --<span class="built_in">enable</span> epel &amp;&amp; yum clean all</span><br><span class="line"><span class="comment"># 安装软件程序包</span></span><br><span class="line">yum install -y openswan xl2tpd</span><br><span class="line"></span><br><span class="line"><span class="comment"># 为 IPSec 写一个包含共享密钥的文件</span></span><br><span class="line">cat &gt; /etc/ipsec.conf &lt;&lt;EOF</span><br><span class="line">version 2.0</span><br><span class="line"> </span><br><span class="line">config setup</span><br><span class="line">	nat_traversal=yes</span><br><span class="line">	virtual_private=%v4:10.0.0.0/8,%v4:192.168.0.0/16,%v4:172.16.0.0/12,%v4:25.0.0.0/8,%v6:fd00::/8,%v6:fe80::/10</span><br><span class="line">	oe=off</span><br><span class="line">	protostack=netkey</span><br><span class="line">	nhelpers=0</span><br><span class="line">	interfaces=%defaultroute</span><br><span class="line"></span><br><span class="line">conn vpnpsk</span><br><span class="line">	auto=add</span><br><span class="line">	left=<span class="variable">$PRIVATE_IP</span></span><br><span class="line">	leftid=<span class="variable">$PUBLIC_IP</span></span><br><span class="line">	leftsubnet=<span class="variable">$PRIVATE_IP</span>/32</span><br><span class="line">	leftnexthop=%defaultroute</span><br><span class="line">	leftprotoport=17/1701</span><br><span class="line">	rightprotoport=17/%any</span><br><span class="line">	right=%any</span><br><span class="line">	rightsubnetwithin=0.0.0.0/0</span><br><span class="line">	forceencaps=yes</span><br><span class="line">	authby=secret</span><br><span class="line">	pfs=no</span><br><span class="line">	<span class="built_in">type</span>=transport</span><br><span class="line">	auth=esp</span><br><span class="line">	ike=3des-sha1</span><br><span class="line">	phase2alg=3des-sha1</span><br><span class="line">	dpddelay=30</span><br><span class="line">	dpdtimeout=120</span><br><span class="line">	dpdaction=clear</span><br><span class="line">EOF</span><br><span class="line"> </span><br><span class="line"> <span class="comment"># 为 IPSec 写配置文件</span></span><br><span class="line">cat &gt; /etc/ipsec.secrets &lt;&lt;EOF</span><br><span class="line"><span class="variable">$PUBLIC_IP</span> %any : PSK <span class="string">"<span class="variable">$&#123;IPSEC_PSK&#125;</span>"</span></span><br><span class="line">EOF</span><br><span class="line"> </span><br><span class="line"> <span class="comment"># 为 L2TP 管道写配置文件</span></span><br><span class="line">cat &gt; /etc/xl2tpd/xl2tpd.conf &lt;&lt;EOF</span><br><span class="line">[global]</span><br><span class="line">port = 1701</span><br><span class="line"></span><br><span class="line">[lns default]</span><br><span class="line">ip range = 192.168.42.10-192.168.42.250</span><br><span class="line"><span class="built_in">local</span> ip = 192.168.42.1</span><br><span class="line">require chap = yes</span><br><span class="line">refuse pap = yes</span><br><span class="line">require authentication = yes</span><br><span class="line">name = l2tpd</span><br><span class="line">pppoptfile = /etc/ppp/options.xl2tpd</span><br><span class="line">length bit = yes</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line"> <span class="comment"># 为 PPP 服务写配置文件</span></span><br><span class="line">cat &gt; /etc/ppp/chap-secrets &lt;&lt;EOF</span><br><span class="line"><span class="variable">$&#123;VPN_USER&#125;</span> l2tpd <span class="variable">$&#123;VPN_PASSWORD&#125;</span> *</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line">cat &gt; /etc/ppp/options.xl2tpd &lt;&lt;EOF</span><br><span class="line">ipcp-accept-local</span><br><span class="line">ipcp-accept-remote</span><br><span class="line">ms-dns 8.8.8.8</span><br><span class="line">ms-dns 8.8.4.4</span><br><span class="line">noccp</span><br><span class="line">auth</span><br><span class="line">crtscts</span><br><span class="line">idle 1800</span><br><span class="line">mtu 1280</span><br><span class="line">mru 1280</span><br><span class="line">lock</span><br><span class="line">connect-delay 5000</span><br><span class="line">EOF</span><br><span class="line"> </span><br><span class="line">iptables -t nat -A POSTROUTING -s 192.168.42.0/24 -o eth0 -j MASQUERADE</span><br><span class="line"><span class="built_in">echo</span> 1 &gt; /proc/sys/net/ipv4/ip_forward</span><br><span class="line">iptables-save &gt; /etc/iptables.rules</span><br><span class="line"></span><br><span class="line">mkdir -p /etc/network/<span class="keyword">if</span>-pre-up.d</span><br><span class="line">cat &gt; /etc/network/<span class="keyword">if</span>-pre-up.d/iptablesload &lt;&lt;EOF</span><br><span class="line"><span class="meta">#!/bin/sh</span></span><br><span class="line">iptables-restore &lt; /etc/iptables.rules</span><br><span class="line"><span class="built_in">echo</span> 1 &gt; /proc/sys/net/ipv4/ip_forward</span><br><span class="line"><span class="built_in">exit</span> 0</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line"><span class="comment"># 启动 VPN 服务器需要的服务</span></span><br><span class="line">service ipsec start &amp;&amp; service xl2tpd start</span><br><span class="line"><span class="comment"># 配置 VPN 服务器的运行等级</span></span><br><span class="line">chkconfig ipsec on &amp;&amp; chkconfig xl2tpd on</span><br><span class="line"></span><br><span class="line">/opt/aws/bin/cfn-signal --stack <span class="variable">$STACK_NAME</span> --resource EC2Instance --region <span class="variable">$REGION</span></span><br></pre></td></tr></table></figure>
<p>终止虚拟服务器并清理环境：</p>
<figure class="highlight dsconfig"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">aws </span><span class="string">cloudformation </span><span class="built_in">delete-stack</span> <span class="built_in">--slack-name</span> <span class="string">vpn</span></span><br></pre></td></tr></table></figure>
<h2 id="二、使用-Elastic-Beanstalk-部署一个简单的网站应用"><a href="#二、使用-Elastic-Beanstalk-部署一个简单的网站应用" class="headerlink" title="二、使用 Elastic Beanstalk 部署一个简单的网站应用"></a>二、使用 Elastic Beanstalk 部署一个简单的网站应用</h2><blockquote>
<p>AWS <a href="https://amazonaws-china.com/cn/elasticbeanstalk/?c=7&amp;pt=8" target="_blank" rel="noopener">Elastic Beanstalk</a> 是一项易于使用的服务，用于在熟悉的服务器（例如 Apache 、Nginx、Passenger 和 IIS ）上部署和扩展使用 Java、.NET、PHP、Node.js、Python、Ruby、GO 和 Docker 开发的 Web 应用程序和服务。</p>
<p>您只需上传代码，Elastic Beanstalk 即可自动处理包括容量预配置、负载均衡、自动扩展和应用程序运行状况监控在内的部署工作。同时，您能够完全控制为应用程序提供支持的 AWS 资源，并可以随时访问底层资源。</p>
<p>Elastic Beanstalk 不额外收费 – 您只需为存储和运行应用程序所需的 AWS 资源付费。</p>
<p>参考：<a href="https://docs.aws.amazon.com/zh_cn/elasticbeanstalk/latest/dg/Welcome.html" target="_blank" rel="noopener"><strong>AWS Elastic Beanstalk</strong></a></p>
</blockquote>
<h3 id="Elastic-Beanstalk-的组成部分"><a href="#Elastic-Beanstalk-的组成部分" class="headerlink" title="Elastic Beanstalk 的组成部分"></a>Elastic Beanstalk 的组成部分</h3><ul>
<li>应用；</li>
<li>版本；</li>
<li>配置模版；</li>
<li>环境；</li>
</ul>
<h3 id="使用-Elastic-Beanstalk-部署一个-Node-js-应用：Etherpad"><a href="#使用-Elastic-Beanstalk-部署一个-Node-js-应用：Etherpad" class="headerlink" title="使用 Elastic Beanstalk 部署一个 Node.js 应用：Etherpad"></a>使用 Elastic Beanstalk 部署一个 Node.js 应用：Etherpad</h3><blockquote>
<p>Etherpad 是一个开源的在线编辑器，支持多人协同编辑。</p>
</blockquote>
<p>创建步骤：</p>
<ol>
<li>创建应用：逻辑上的容器；</li>
<li>创建版本：指向特定 Etherpad 版本的指针；</li>
<li>创建环境：Etherpad 运行的地方；</li>
</ol>
<p>使用 Elastic Beanstalk 和 AWS CLI 创建应用、版本和环境，并部署一个 Etherpad 服务：</p>
<p>1⃣️ 为 Elastic Beanstalk 服务创建一个应用：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">aws elasticbeanstalk create-application --application-name etherpad</span><br></pre></td></tr></table></figure>
<p>2⃣️ 为 AWS Elastic Beanstalk 创建版本</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">aws elasticbeanstalk create-application-version \</span><br><span class="line">--application-name etherpad --version-label 1.5.2 \</span><br><span class="line">--<span class="built_in">source</span>-bundle S3Bucket=awsincation,S3Key=chapter5/etherpad.zip</span><br></pre></td></tr></table></figure>
<p>3⃣️ 用 Elastic Beanstalk 创建一个环境来执行 Etherpad</p>
<p>获取最新的 Node.js 环境脚本：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">aws elasticbeanstalk list-available-solution-stacks --output text \</span><br><span class="line">--query <span class="string">"SolutionStacks[?contains(@, 'running Node.js')] | [0]"</span> \</span><br><span class="line"></span><br><span class="line">64bit Amazon Linux 2015.03 v1.4.6 running Node.js</span><br></pre></td></tr></table></figure>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">aws elasticbeanstalk create-environment --environment-name etherpad \</span><br><span class="line">--application-name etherpad \</span><br><span class="line">--option-settings Namespace=aws:elasticbeanstalk:environment,\</span><br><span class="line">OptionName=EnvironmentType,Value=SingleInstance \ <span class="comment">## 启动一个不可变规模且无负载均衡的单台虚拟服务器</span></span><br><span class="line">--solution-stalk-name <span class="string">"<span class="variable">$SolutionStackName</span>"</span> \</span><br><span class="line">--version-label 1.5.2</span><br></pre></td></tr></table></figure>
<p>4⃣️ 检查 Etherpad 环境的状态</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">aws elasticbeanstalk <span class="keyword">describe</span>-environments <span class="comment">--environment-names etherpad</span></span><br></pre></td></tr></table></figure>
<h2 id="三、使用-OpsWorks-部署多层架构的应用"><a href="#三、使用-OpsWorks-部署多层架构的应用" class="headerlink" title="三、使用 OpsWorks 部署多层架构的应用"></a>三、使用 OpsWorks 部署多层架构的应用</h2><blockquote>
<p>AWS OpsWorks 是一款配置管理服务，提供 Chef 和 Puppet 的托管实例。Chef 和 Puppet 是自动化平台，允许您使用代码来自动配置服务器。借助 OpsWorks，您可以使用 Chef 和 Puppet 自动完成所有 <a href="https://aws.amazon.com/cn/ec2/" target="_blank" rel="noopener">Amazon EC2</a> 实例或本地计算环境中的服务器配置、部署和管理。OpsWorks 提供三种产品：<a href="https://aws.amazon.com/cn/opsworks/chefautomate/" target="_blank" rel="noopener">AWS Opsworks for Chef Automate</a>、<a href="https://aws.amazon.com/cn/opsworks/puppetenterprise/" target="_blank" rel="noopener">AWS OpsWorks for Puppet Enterprise</a> 和 <a href="https://aws.amazon.com/cn/opsworks/stacks/" target="_blank" rel="noopener">AWS OpsWorks Stacks</a>。</p>
</blockquote>
<p><strong>AWS OpsWorks</strong>——一个帮助用户部署多层架构应用的服务</p>
<p>部署是在 <strong>Chef</strong> 的帮助下进行控制的，Chef 是一个配置管理工具。Chef 使用在 cookbook 中组织的 recipe 来部署应用到任意系统中。用户可以使用标准 recipe 或自行创建。</p>
<p>示例：使用 OpsWorks 部署一个 IRC 聊天应用。。。</p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://andy0570.com/2019/01/03/《AWS云计算实战》笔记（三）——编写基础架构/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="独木舟的木">
      <meta itemprop="description" content="有时候阳光很好 有时候阳光很暗">
      <meta itemprop="image" content="https://ws1.sinaimg.cn/large/006tNc79gy1g22m14458rj30u014xu0x.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="独木舟的木">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/01/03/《AWS云计算实战》笔记（三）——编写基础架构/" class="post-title-link" itemprop="url">《AWS云计算实战》笔记（三）——编写基础架构</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2019-01-03 17:43:00" itemprop="dateCreated datePublished" datetime="2019-01-03T17:43:00+08:00">2019-01-03</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2019-04-16 16:28:08" itemprop="dateModified" datetime="2019-04-16T16:28:08+08:00">2019-04-16</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/云计算/" itemprop="url" rel="index"><span itemprop="name">云计算</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          
            <span id="/2019/01/03/《AWS云计算实战》笔记（三）——编写基础架构/" class="leancloud_visitors" data-flag-title="《AWS云计算实战》笔记（三）——编写基础架构">
              <span class="post-meta-divider">|</span>
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              
                <span class="post-meta-item-text">阅读次数：</span>
              
                <span class="leancloud-visitors-count"></span>
            </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body han-init-context" itemprop="articleBody">

      
      

      
        
          
            <h1 id="编写基础架构：命令行、SDK-和-CloudFormation"><a href="#编写基础架构：命令行、SDK-和-CloudFormation" class="headerlink" title="编写基础架构：命令行、SDK 和 CloudFormation"></a>编写基础架构：命令行、SDK 和 CloudFormation</h1><h2 id="一、基础架构即代码"><a href="#一、基础架构即代码" class="headerlink" title="一、基础架构即代码"></a>一、基础架构即代码</h2><p>思想：使用高级编程语言来控制 IT 系统。</p>
<p>「基础架构即代码」描述了编写程序来创建与修改基础架构（包括虚拟服务器、网络、存储等）的方法。</p>
<h3 id="自动化和-DevOps-运作"><a href="#自动化和-DevOps-运作" class="headerlink" title="自动化和 DevOps 运作"></a>自动化和 DevOps 运作</h3><p>DevOps（Development operations）的目标：快速发布开发好的软件，并且没有损失质量。</p>
<p>自动化部署、自动化构建、自动化测试（集成测试）、产品。</p>
<p>自动化基础架构的3种方式：</p>
<ol>
<li><a href="https://docs.aws.amazon.com/zh_cn/cli/latest/userguide/cli-chap-welcome.html" target="_blank" rel="noopener">命令行接口（CLI）</a>；</li>
<li><a href="https://amazonaws-china.com/cn/getting-started/tools-sdks/?hp=tile&amp;so-exp=below" target="_blank" rel="noopener">开发工具套件（SDK）</a>；</li>
<li><a href="https://docs.aws.amazon.com/zh_cn/AWSCloudFormation/latest/UserGuide/Welcome.html" target="_blank" rel="noopener">CloudFormation</a>；</li>
</ol>
<h3 id="基础架构语言：JIML"><a href="#基础架构语言：JIML" class="headerlink" title="基础架构语言：JIML"></a>基础架构语言：JIML</h3><p>描述基础架构：JSON基础架构标记语言（JSON Infrastructure Markup Language，JIML）。</p>
<p>转换步骤： JSON 输入 ➡️ JIML 解释器 ➡️ AWS API 调用。</p>
<h2 id="二、使用命令行接口"><a href="#二、使用命令行接口" class="headerlink" title="二、使用命令行接口"></a>二、使用命令行接口</h2><h3 id="安装-AWS-命令行接口（CLI）"><a href="#安装-AWS-命令行接口（CLI）" class="headerlink" title="安装 AWS 命令行接口（CLI）"></a>安装 AWS 命令行接口（CLI）</h3><p>AWS 命令行界面 (CLI) 是用于管理 AWS 服务的统一工具。只通过一个工具进行下载和配置，您可以使用命令行控制多个 AWS 服务并利用脚本来自动执行这些服务。</p>
<h4 id="参考："><a href="#参考：" class="headerlink" title="参考："></a>参考：</h4><ul>
<li><p><a href="https://amazonaws-china.com/cn/cli/?hp=tile&amp;so-exp=below" target="_blank" rel="noopener">官方文档：AWS 命令行界面</a></p>
</li>
<li><p><a href="https://docs.aws.amazon.com/zh_cn/cli/latest/userguide/cli-chap-welcome.html" target="_blank" rel="noopener">官方文档：AWS Command Line Interface</a></p>
</li>
</ul>
<p>在 Mac 上安装 Python 3：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">--------------------------------------------</span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看 Python 版本，系统自带的 Python 版本是 2.x</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> python --version</span></span><br><span class="line">Python 2.7.15</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 使用 Homebrew 安装 Python3</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> brew install python3</span></span><br><span class="line">...</span><br><span class="line">==&gt; python</span><br><span class="line">Python has been installed as</span><br><span class="line">  /usr/local/bin/python3  # Python3 的安装目录</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看 python3 版本</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> python3 --version </span></span><br><span class="line">Python 3.6.4</span><br><span class="line"></span><br><span class="line">--------------------------------------------</span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看 pip 版本</span></span><br><span class="line"><span class="meta">$</span><span class="bash">  pip --version <span class="comment"># 默认 python 2.7 的 pip 版本</span></span></span><br><span class="line">pip 18.0 from /usr/local/lib/python2.7/site-packages/pip (python 2.7)</span><br><span class="line"></span><br><span class="line"><span class="meta">$</span><span class="bash">  pip3 --version <span class="comment"># python 3.6 的 pip 版本</span></span></span><br><span class="line">pip 9.0.1 from /Library/Frameworks/Python.framework/Versions/3.6/lib/python3.6/site-packages (python 3.6)</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 升级 pip3 版本</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> pip3 install --upgrade pip</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> pip3 --version</span></span><br><span class="line">pip 18.1 from /Library/Frameworks/Python.framework/Versions/3.6/lib/python3.6/site-packages/pip (python 3.6)</span><br><span class="line"></span><br><span class="line">--------------------------------------------</span><br><span class="line"><span class="meta">#</span><span class="bash"> 安装 AWS CLI</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> sudo pip3 install awscli</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 验证 AWS CLI 的安装</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> aws --version</span></span><br><span class="line">aws-cli/1.16.81 Python/3.6.4 Darwin/18.2.0 botocore/1.12.71</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 升级 AWS CLI</span></span><br><span class="line">pip3 install awscli --upgrade --user</span><br></pre></td></tr></table></figure>
<p>参考：<a href="https://www.zhihu.com/question/30941329/answer/51489517" target="_blank" rel="noopener">知乎：Mac OS X 上如何切换默认的 Python 版本？</a></p>
<h3 id="配置-CLI"><a href="#配置-CLI" class="headerlink" title="配置 CLI"></a>配置 CLI</h3><h4 id="创建-IAM-用户"><a href="#创建-IAM-用户" class="headerlink" title="创建 IAM 用户"></a>创建 IAM 用户</h4><p>示例：</p>
<table>
<thead>
<tr>
<th>IAM 用户信息</th>
<th>值</th>
</tr>
</thead>
<tbody>
<tr>
<td>登录URL</td>
<td><a href="https://812677773757.signin.aws.amazon.com/console" target="_blank" rel="noopener">https://812677773757.signin.aws.amazon.com/console</a></td>
</tr>
<tr>
<td>IAM 用户名</td>
<td>mycli</td>
</tr>
<tr>
<td>访问类型</td>
<td>编程访问</td>
</tr>
<tr>
<td>权限</td>
<td>AdministratorAccess</td>
</tr>
<tr>
<td>访问密钥 ID</td>
<td>AKIAJMJA54KW6HSPM2XA</td>
</tr>
<tr>
<td>私有访问密钥</td>
<td>Nyd1u5NBglomjj5X+Mu7L9cM0ZiBKXv5swj2TJ6D</td>
</tr>
</tbody>
</table>
<h4 id="使用-aws-configure-命令设置-AWS-CLI："><a href="#使用-aws-configure-命令设置-AWS-CLI：" class="headerlink" title="使用 aws configure 命令设置 AWS CLI："></a>使用 <code>aws configure</code> 命令设置 AWS CLI：</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> default 的单个配置文件</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> aws configure </span></span><br><span class="line">AWS Access Key ID [None]: AKIAJMJA54KW6HSPM2XA # AWS 访问密钥 ID</span><br><span class="line">AWS Secret Access Key [None]: Nyd1u5NBglomjj5X+Mu7L9cM0ZiBKXv5swj2TJ6D # AWS 私有访问密钥</span><br><span class="line">Default region name [None]: us-east-1 # 默认区域名称，弗吉尼亚北部数据中心（us-east-1）</span><br><span class="line">Default output format [None]: json # 默认输出格式</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 使用 --profile 选项指定配置文件的名称</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> aws configure --profile user2</span></span><br><span class="line">AWS Access Key ID [None]: AKIAI44QH8DHBEXAMPLE</span><br><span class="line">AWS Secret Access Key [None]: je7MtGbClwBF/2Zp9Utk/h3yCo8nvbEXAMPLEKEY</span><br><span class="line">Default region name [None]: us-east-1</span><br><span class="line">Default output format [None]: json</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 省略 --profile 选项，这样会使用 default 配置文件中存储的设置：</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> aws s3 ls</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 指定 --profile profilename 来使用该名称下存储的设置：</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> aws s3 ls --profile myuser</span></span><br></pre></td></tr></table></figure>
<h4 id="获取所有可用的区域列表："><a href="#获取所有可用的区域列表：" class="headerlink" title="获取所有可用的区域列表："></a>获取所有可用的区域列表：</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> aws ec2 describe-regions</span></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="meta">$</span><span class="bash"> aws ec2 describe-regions --output table</span></span><br><span class="line">----------------------------------------------------------</span><br><span class="line">|                     DescribeRegions                    |</span><br><span class="line">+--------------------------------------------------------+</span><br><span class="line">||                        Regions                       ||</span><br><span class="line">|+-----------------------------------+------------------+|</span><br><span class="line">||             Endpoint              |   RegionName     ||</span><br><span class="line">|+-----------------------------------+------------------+|</span><br><span class="line">||  ec2.ap-south-1.amazonaws.com     |  ap-south-1      ||</span><br><span class="line">||  ec2.eu-west-3.amazonaws.com      |  eu-west-3       ||</span><br><span class="line">||  ec2.eu-north-1.amazonaws.com     |  eu-north-1      ||</span><br><span class="line">||  ec2.eu-west-2.amazonaws.com      |  eu-west-2       ||</span><br><span class="line">||  ec2.eu-west-1.amazonaws.com      |  eu-west-1       ||</span><br><span class="line">||  ec2.ap-northeast-2.amazonaws.com |  ap-northeast-2  ||</span><br><span class="line">||  ec2.ap-northeast-1.amazonaws.com |  ap-northeast-1  ||</span><br><span class="line">||  ec2.sa-east-1.amazonaws.com      |  sa-east-1       ||</span><br><span class="line">||  ec2.ca-central-1.amazonaws.com   |  ca-central-1    ||</span><br><span class="line">||  ec2.ap-southeast-1.amazonaws.com |  ap-southeast-1  ||</span><br><span class="line">||  ec2.ap-southeast-2.amazonaws.com |  ap-southeast-2  ||</span><br><span class="line">||  ec2.eu-central-1.amazonaws.com   |  eu-central-1    ||</span><br><span class="line">||  ec2.us-east-1.amazonaws.com      |  us-east-1       ||</span><br><span class="line">||  ec2.us-east-2.amazonaws.com      |  us-east-2       ||</span><br><span class="line">||  ec2.us-west-1.amazonaws.com      |  us-west-1       ||</span><br><span class="line">||  ec2.us-west-2.amazonaws.com      |  us-west-2       ||</span><br><span class="line">|+-----------------------------------+------------------+|</span><br></pre></td></tr></table></figure>
<h4 id="获得所有类型为-t2-micro-的-EC2-实例的列表："><a href="#获得所有类型为-t2-micro-的-EC2-实例的列表：" class="headerlink" title="获得所有类型为 t2.micro 的 EC2 实例的列表："></a>获得所有类型为 t2.micro 的 EC2 实例的列表：</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">aws ec2 describe-instances --filters "Name=instance-type,Values=t2.micro"</span><br><span class="line">&#123;</span><br><span class="line">    "Reservations": []</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>格式：<code>aws &lt;service&gt; &lt;action&gt; [--key value]</code>：</p>
<h4 id="help-关键字"><a href="#help-关键字" class="headerlink" title="help 关键字"></a>help 关键字</h4><ul>
<li><code>aws help</code>——显示所有可用的服务；</li>
<li><code>aws &lt;service&gt; help</code>——显示某一服务所有可用的操作；</li>
<li><code>aws &lt;service&gt; &lt;action&gt; help</code>——显示特定服务操作可用的所有选项；</li>
</ul>
<h4 id="实例脚本：server-sh"><a href="#实例脚本：server-sh" class="headerlink" title="实例脚本：server.sh"></a>实例脚本：server.sh</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">!/bin/bash -e <span class="comment"># 1⃣️ 当命令出错时终止</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> You need to install the AWS Command Line Interface from http://aws.amazon.com/cli/</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 2⃣️ 获取 Amazon Linux AMI 的 ID</span></span><br><span class="line">AMIID=$(aws ec2 describe-images --filters "Name=description, Values=Amazon Linux AMI 2015.03.? x86_64 HVM GP2" --query "Images[0].ImageId" --output text)</span><br><span class="line"><span class="meta">#</span><span class="bash"> 3⃣️ 获取默认 VPC 的 ID</span></span><br><span class="line">VPCID=$(aws ec2 describe-vpcs --filter "Name=isDefault, Values=true" --query "Vpcs[0].VpcId" --output text)</span><br><span class="line"><span class="meta">#</span><span class="bash"> 4⃣️ 获取默认子网的 ID</span></span><br><span class="line">SUBNETID=$(aws ec2 describe-subnets --filters "Name=vpc-id, Values=$VPCID" --query "Subnets[0].SubnetId" --output text)</span><br><span class="line"><span class="meta">#</span><span class="bash"> 5⃣️ 创建安全组</span></span><br><span class="line">SGID=$(aws ec2 create-security-group --group-name mysecuritygroup --description "My security group" --vpc-id $VPCID --output text)</span><br><span class="line"><span class="meta">#</span><span class="bash"> 6⃣️ 允许入站 SH 连接</span></span><br><span class="line">aws ec2 authorize-security-group-ingress --group-id $SGID --protocol tcp --port 22 --cidr 0.0.0.0/0</span><br><span class="line"><span class="meta">#</span><span class="bash"> 7⃣️ 创建并启动服务器</span></span><br><span class="line">INSTANCEID=$(aws ec2 run-instances --image-id $AMIID --key-name mykey --instance-type t2.micro --security-group-ids $SGID --subnet-id $SUBNETID --query "Instances[0].InstanceId" --output text)</span><br><span class="line">echo "waiting for $INSTANCEID ..."</span><br><span class="line"><span class="meta">#</span><span class="bash"> 8⃣️ 等到服务器启动</span></span><br><span class="line">aws ec2 wait instance-running --instance-ids $INSTANCEID</span><br><span class="line"><span class="meta">#</span><span class="bash"> 9⃣️ 获取服务器的公有域名</span></span><br><span class="line">PUBLICNAME=$(aws ec2 describe-instances --instance-ids $INSTANCEID --query "Reservations[0].Instances[0].PublicDnsName" --output text)</span><br><span class="line">echo "$INSTANCEID is accepting SSH connections under $PUBLICNAME"</span><br><span class="line">echo "ssh -i mykey.pem ec2-user@$PUBLICNAME"</span><br><span class="line">read -p "Press [Enter] key to terminate $INSTANCEID ..."</span><br><span class="line"><span class="meta">#</span><span class="bash"> 🔟 终止服务器</span></span><br><span class="line">aws ec2 terminate-instances --instance-ids $INSTANCEID</span><br><span class="line">echo "terminating $INSTANCEID ..."</span><br><span class="line"><span class="meta">#</span><span class="bash"> 1⃣️1⃣️ 等到服务器终止</span></span><br><span class="line">aws ec2 wait instance-terminated --instance-ids $INSTANCEID</span><br><span class="line"><span class="meta">#</span><span class="bash"> 1⃣️2⃣️ 删除安全组</span></span><br><span class="line">aws ec2 delete-security-group --group-id $SGID</span><br><span class="line">echo "done."</span><br></pre></td></tr></table></figure>
<h4 id="为什么要写脚本？"><a href="#为什么要写脚本？" class="headerlink" title="为什么要写脚本？"></a>为什么要写脚本？</h4><p>为什么要写脚本，而不是使用图形化的AWS管理控制台？<strong>脚本可以复用，并且在长时间操作时节省时间。</strong>用户能够使用自己之前的项目中已经可用的模块来快速创建新的架构。通过使自己的基础架构创建自动化，用户也能够加强自己的部署流水线的自动化。<br>另一个好处是，<strong>脚本将是能想象的最准确的文档（甚至计算机能理解它）</strong>。如果你想在周一重复上周五自己做的事，脚本就是无价之宝。如果你病了，而你的同事需要处理好你的任务，他们会感激你留下的脚本。</p>
<h2 id="三、使用-SDK-编程"><a href="#三、使用-SDK-编程" class="headerlink" title="三、使用 SDK 编程"></a>三、使用 SDK 编程</h2><p>参考：<a href="https://amazonaws-china.com/cn/getting-started/tools-sdks/?hp=tile&amp;so-exp=below" target="_blank" rel="noopener">官方文档：使用软件开发工具包和工具开始进行构建</a></p>
<h2 id="四、使用蓝图来启动一台虚拟服务器"><a href="#四、使用蓝图来启动一台虚拟服务器" class="headerlink" title="四、使用蓝图来启动一台虚拟服务器"></a>四、使用蓝图来启动一台虚拟服务器</h2><p>参考：<a href="https://docs.aws.amazon.com/zh_cn/AWSCloudFormation/latest/UserGuide/Welcome.html" target="_blank" rel="noopener">官方文档：AWS CloudFormation</a> ⭐️⭐️⭐️</p>
<p>参考：<a href="https://docs.aws.amazon.com/zh_cn/AWSCloudFormation/latest/UserGuide/working-with-templates-cfn-designer.html" target="_blank" rel="noopener">什么是 AWS CloudFormation Designer？</a></p>
<p>早些时候，我们谈到 JIML 来引入基础架构即代码的概念。幸运的是，AWS 已经提供了一个比 JIML更好的工具: <strong>AWS CloudFormation</strong>。<strong>CloudFormation 基于模板来创建基础架构</strong>，也就是我们称作蓝图（模版）的东西。</p>
<ul>
<li>模版使用 JSON 描述了用户的基础架构的最终状态，CloudFormation 能对其进行解析并自动实现它。</li>
<li>描述方法：告诉 CloudFormation 需要的基础架构以及组件之间的连接。</li>
<li>用户不需要告诉 CloudFormation 应用的创建过程和操作的执行顺序，最重要的是：<strong>组件之间的依赖。</strong></li>
</ul>
<h3 id="使用-CloudFormation-的好处"><a href="#使用-CloudFormation-的好处" class="headerlink" title="使用 CloudFormation 的好处"></a>使用 CloudFormation 的好处</h3><ul>
<li>用统一的方式描述基础架构；</li>
<li>它能处理依赖关系；</li>
<li>可复制；</li>
<li>可自定义；</li>
<li>可测试；</li>
<li>可更新；（也就是说，更新实例类型时，无需先停止实例-更新-重启balabala…只要更新模版就行了！）</li>
<li>最小化人为的误操作；</li>
<li>把基础架构文档化；</li>
<li>免费；</li>
</ul>
<h3 id="CloudFormation-模版解析"><a href="#CloudFormation-模版解析" class="headerlink" title="CloudFormation 模版解析"></a>CloudFormation 模版解析</h3><p><img src="http://upload-images.jianshu.io/upload_images/2648731-9ad0c3c83e6c841b.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="CloudFormation 模版结构"></p>
<p>CloudFormation 让你可以使用模版来创建和启动资源：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	"AWSTemplateFormatVersion": "2010-09-09",    ## 1⃣️ 唯一合法版本</span><br><span class="line">	"Description": "CloudFormation Description", ## 2⃣️ 描述模版的用途</span><br><span class="line">	"Parameters": &#123;</span><br><span class="line">		[...] ## 3⃣️ 定义参数，如：域名、客户ID和数据库密码。</span><br><span class="line">	&#125;,</span><br><span class="line">	"Resources": &#123;</span><br><span class="line">		[...] ## 4⃣️ 定义资源，如：虚拟服务器、负载均衡器、弹性IP地址。</span><br><span class="line">	&#125;,</span><br><span class="line">	"Outputs": &#123;</span><br><span class="line">		[...] ## 5⃣️ 定义输出。从模版返回一些信息。</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>附：<a href="https://docs.aws.amazon.com/zh_cn/AWSCloudFormation/latest/UserGuide/aws-template-resource-type-ref.html" target="_blank" rel="noopener">AWS 资源和属性类型参考</a></p>
<h4 id="参数"><a href="#参数" class="headerlink" title="参数"></a>参数</h4><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">"Parameters": &#123;</span><br><span class="line">	"KeyName": &#123; ## 参数名</span><br><span class="line">		"Description": "Key Pair name",</span><br><span class="line">		"Type": "AWS::EC2::KeyPair::KeyName", ## 参数类型</span><br><span class="line">		"Default": "mykey"</span><br><span class="line">	&#125;,</span><br></pre></td></tr></table></figure>
<h4 id="资源"><a href="#资源" class="headerlink" title="资源"></a>资源</h4><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">"Resources": &#123;</span><br><span class="line">	"Server": &#123; ## 资源名</span><br><span class="line">		"Type": "AWS::EC2::Instance", ## 资源类型</span><br><span class="line">		"Properties": &#123;</span><br><span class="line">			"ImageId": &#123;"Fn::FindInMap": ["EC2RegionMap", &#123;"Ref": "AWS::Region"&#125;, "AmazonLinuxAMIHVMEBSBacked64bit"]&#125;, ## 一些硬编码设置</span><br><span class="line">			"InstanceType": &#123;"Ref": "InstanceType"&#125;,</span><br><span class="line">			"KeyName": &#123;"Ref": "KeyName"&#125;,</span><br><span class="line">			"SecurityGroupIds": [&#123;"Ref": "SecurityGroup"&#125;],</span><br><span class="line">			"SubnetId": &#123;"Ref": "Subnet"&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>
<h4 id="输出"><a href="#输出" class="headerlink" title="输出"></a>输出</h4><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">"Outputs": &#123;</span><br><span class="line">	"PublicName": &#123; ## 输出的名字</span><br><span class="line">		"Value": &#123;"Fn::GetAtt": ["Server", "PublicDnsName"]&#125;, ## 输出的值：EC2 服务器的公有DNS名</span><br><span class="line">		"Description": "Public name (connect via SSH as user ec2-user)"</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="完整的示例模版"><a href="#完整的示例模版" class="headerlink" title="完整的示例模版"></a>完整的示例模版</h4><p>如果从模板创建一个基础架构，则 CloudFormation 称之为<strong>堆栈</strong>。可以认为模板对应堆栈，就像是类对应对象。模板只存在一次，而许多堆栈可以从同一个模板中被创建。</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	<span class="attr">"AWSTemplateFormatVersion"</span>: <span class="string">"2010-09-09"</span>,</span><br><span class="line">	<span class="attr">"Description"</span>: <span class="string">"AWS in Action: chapter 4"</span>,</span><br><span class="line">	<span class="attr">"Parameters"</span>: &#123;</span><br><span class="line">		<span class="attr">"KeyName"</span>: &#123;</span><br><span class="line">			<span class="attr">"Description"</span>: <span class="string">"Key Pair name"</span>,</span><br><span class="line">			<span class="attr">"Type"</span>: <span class="string">"AWS::EC2::KeyPair::KeyName"</span>,</span><br><span class="line">			<span class="attr">"Default"</span>: <span class="string">"mykey"</span></span><br><span class="line">		&#125;,</span><br><span class="line">		<span class="attr">"VPC"</span>: &#123;</span><br><span class="line">			<span class="attr">"Description"</span>: <span class="string">"Just select the one and only default VPC"</span>,</span><br><span class="line">			<span class="attr">"Type"</span>: <span class="string">"AWS::EC2::VPC::Id"</span></span><br><span class="line">		&#125;,</span><br><span class="line">		<span class="attr">"Subnet"</span>: &#123;</span><br><span class="line">			<span class="attr">"Description"</span>: <span class="string">"Just select one of the available subnets"</span>,</span><br><span class="line">			<span class="attr">"Type"</span>: <span class="string">"AWS::EC2::Subnet::Id"</span></span><br><span class="line">		&#125;,</span><br><span class="line">		<span class="attr">"InstanceType"</span>: &#123;</span><br><span class="line">			<span class="attr">"Description"</span>: <span class="string">"Select one of the possible instance types"</span>,</span><br><span class="line">			<span class="attr">"Type"</span>: <span class="string">"String"</span>,</span><br><span class="line">			<span class="attr">"Default"</span>: <span class="string">"t2.micro"</span>,</span><br><span class="line">			<span class="attr">"AllowedValues"</span>: [<span class="string">"t2.micro"</span>, <span class="string">"t2.small"</span>, <span class="string">"t2.medium"</span>]</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;,</span><br><span class="line">	<span class="attr">"Mappings"</span>: &#123;</span><br><span class="line">		<span class="attr">"EC2RegionMap"</span>: &#123;</span><br><span class="line">			<span class="attr">"ap-northeast-1"</span>: &#123;<span class="attr">"AmazonLinuxAMIHVMEBSBacked64bit"</span>: <span class="string">"ami-cbf90ecb"</span>&#125;,</span><br><span class="line">			<span class="attr">"ap-southeast-1"</span>: &#123;<span class="attr">"AmazonLinuxAMIHVMEBSBacked64bit"</span>: <span class="string">"ami-68d8e93a"</span>&#125;,</span><br><span class="line">			<span class="attr">"ap-southeast-2"</span>: &#123;<span class="attr">"AmazonLinuxAMIHVMEBSBacked64bit"</span>: <span class="string">"ami-fd9cecc7"</span>&#125;,</span><br><span class="line">			<span class="attr">"eu-central-1"</span>: &#123;<span class="attr">"AmazonLinuxAMIHVMEBSBacked64bit"</span>: <span class="string">"ami-a8221fb5"</span>&#125;,</span><br><span class="line">			<span class="attr">"eu-west-1"</span>: &#123;<span class="attr">"AmazonLinuxAMIHVMEBSBacked64bit"</span>: <span class="string">"ami-a10897d6"</span>&#125;,</span><br><span class="line">			<span class="attr">"sa-east-1"</span>: &#123;<span class="attr">"AmazonLinuxAMIHVMEBSBacked64bit"</span>: <span class="string">"ami-b52890a8"</span>&#125;,</span><br><span class="line">			<span class="attr">"us-east-1"</span>: &#123;<span class="attr">"AmazonLinuxAMIHVMEBSBacked64bit"</span>: <span class="string">"ami-1ecae776"</span>&#125;,</span><br><span class="line">			<span class="attr">"us-west-1"</span>: &#123;<span class="attr">"AmazonLinuxAMIHVMEBSBacked64bit"</span>: <span class="string">"ami-d114f295"</span>&#125;,</span><br><span class="line">			<span class="attr">"us-west-2"</span>: &#123;<span class="attr">"AmazonLinuxAMIHVMEBSBacked64bit"</span>: <span class="string">"ami-e7527ed7"</span>&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;,</span><br><span class="line">	<span class="attr">"Resources"</span>: &#123;</span><br><span class="line">		<span class="attr">"SecurityGroup"</span>: &#123;</span><br><span class="line">			<span class="attr">"Type"</span>: <span class="string">"AWS::EC2::SecurityGroup"</span>,</span><br><span class="line">			<span class="attr">"Properties"</span>: &#123;</span><br><span class="line">				<span class="attr">"GroupDescription"</span>: <span class="string">"My security group"</span>,</span><br><span class="line">				<span class="attr">"VpcId"</span>: &#123;<span class="attr">"Ref"</span>: <span class="string">"VPC"</span>&#125;,</span><br><span class="line">				<span class="attr">"SecurityGroupIngress"</span>: [&#123;</span><br><span class="line">					<span class="attr">"CidrIp"</span>: <span class="string">"0.0.0.0/0"</span>,</span><br><span class="line">					<span class="attr">"FromPort"</span>: <span class="number">22</span>,</span><br><span class="line">					<span class="attr">"IpProtocol"</span>: <span class="string">"tcp"</span>,</span><br><span class="line">					<span class="attr">"ToPort"</span>: <span class="number">22</span></span><br><span class="line">				&#125;]</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;,</span><br><span class="line">		<span class="attr">"Server"</span>: &#123;</span><br><span class="line">			<span class="attr">"Type"</span>: <span class="string">"AWS::EC2::Instance"</span>,</span><br><span class="line">			<span class="attr">"Properties"</span>: &#123;</span><br><span class="line">				<span class="attr">"ImageId"</span>: &#123;<span class="attr">"Fn::FindInMap"</span>: [<span class="string">"EC2RegionMap"</span>, &#123;<span class="attr">"Ref"</span>: <span class="string">"AWS::Region"</span>&#125;, <span class="string">"AmazonLinuxAMIHVMEBSBacked64bit"</span>]&#125;,</span><br><span class="line">				<span class="attr">"InstanceType"</span>: &#123;<span class="attr">"Ref"</span>: <span class="string">"InstanceType"</span>&#125;,</span><br><span class="line">				<span class="attr">"KeyName"</span>: &#123;<span class="attr">"Ref"</span>: <span class="string">"KeyName"</span>&#125;,</span><br><span class="line">				<span class="attr">"SecurityGroupIds"</span>: [&#123;<span class="attr">"Ref"</span>: <span class="string">"SecurityGroup"</span>&#125;],</span><br><span class="line">				<span class="attr">"SubnetId"</span>: &#123;<span class="attr">"Ref"</span>: <span class="string">"Subnet"</span>&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;,</span><br><span class="line">	<span class="attr">"Outputs"</span>: &#123;</span><br><span class="line">		<span class="attr">"PublicName"</span>: &#123;</span><br><span class="line">			<span class="attr">"Value"</span>: &#123;<span class="attr">"Fn::GetAtt"</span>: [<span class="string">"Server"</span>, <span class="string">"PublicDnsName"</span>]&#125;,</span><br><span class="line">			<span class="attr">"Description"</span>: <span class="string">"Public name (connect via SSH as user ec2-user)"</span></span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="CloudFormation-替代方案"><a href="#CloudFormation-替代方案" class="headerlink" title="CloudFormation 替代方案"></a>CloudFormation 替代方案</h4><ul>
<li>Terraform</li>
<li>Ansible</li>
<li>…</li>
</ul>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://andy0570.com/2019/01/02/《AWS云计算实战》笔记（二）——EC2/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="独木舟的木">
      <meta itemprop="description" content="有时候阳光很好 有时候阳光很暗">
      <meta itemprop="image" content="https://ws1.sinaimg.cn/large/006tNc79gy1g22m14458rj30u014xu0x.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="独木舟的木">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/01/02/《AWS云计算实战》笔记（二）——EC2/" class="post-title-link" itemprop="url">《AWS云计算实战》笔记（二）——EC2</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2019-01-02 20:12:00" itemprop="dateCreated datePublished" datetime="2019-01-02T20:12:00+08:00">2019-01-02</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2019-04-16 16:27:56" itemprop="dateModified" datetime="2019-04-16T16:27:56+08:00">2019-04-16</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/云计算/" itemprop="url" rel="index"><span itemprop="name">云计算</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          
            <span id="/2019/01/02/《AWS云计算实战》笔记（二）——EC2/" class="leancloud_visitors" data-flag-title="《AWS云计算实战》笔记（二）——EC2">
              <span class="post-meta-divider">|</span>
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              
                <span class="post-meta-item-text">阅读次数：</span>
              
                <span class="leancloud-visitors-count"></span>
            </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body han-init-context" itemprop="articleBody">

      
      

      
        
          
            <p>AWS 的<strong>弹性计算云</strong>（Elastic Compute Cloud，EC2）服务用来提供虚拟服务器。</p>
<p>虚拟服务器是一台物理服务器的一部分。物理服务器通过软件来隔离其上的各个虚拟服务器。一台虚拟服务器由CPU、内存、网络接口和存储组成。物理服务器也称为<strong>宿主服务器</strong>（host serverguest），其上运行的虚拟服务器称为<strong>客户机</strong>（guest）。<strong>虚拟化管理器</strong>（hypervisor）负责孤立各个客户机并调度它们对硬件的请求。</p>
<ul>
<li>AWS 使用 Xen，一个开源的虚拟机管理程序，作为 EC2 服务的底层技术。</li>
<li>HVM 是最新也是最快的虚拟化类型，HVM 技术是使用硬件辅助的虚拟化技术。</li>
</ul>
<p>参考：<a href="https://docs.aws.amazon.com/zh_cn/AWSEC2/latest/UserGuide/concepts.html" target="_blank" rel="noopener">AWS 文档：什么是 Amazon EC2</a></p>
<h2 id="1⃣️-启动虚拟服务器"><a href="#1⃣️-启动虚拟服务器" class="headerlink" title="1⃣️ 启动虚拟服务器"></a>1⃣️ 启动虚拟服务器</h2><p>步骤：</p>
<ol>
<li>选择操作系统（根据需求，选择合适的实例类型和家族）；</li>
<li>选择虚拟服务器的尺寸；<br>参考：<a href="https://amazonaws-china.com/cn/ec2/instance-types/" target="_blank" rel="noopener">AWS 文档：AWS EC2 实例类型</a></li>
<li>设置实例详细信息、存储、防火墙和标签；<ul>
<li>标签：清晰的组织分类可以营造整洁的环境。在 AWS 平台上，使用标签可以帮助用户很好地组织资源。</li>
</ul>
</li>
<li>检查输入并为 SSH 选择一个密钥对；<ul>
<li>在 AWS 上运行 Linux 的虚拟服务器强制使用 SSH 密钥访问方式。</li>
</ul>
</li>
</ol>
<h2 id="2⃣️-连接到虚拟服务器"><a href="#2⃣️-连接到虚拟服务器" class="headerlink" title="2⃣️ 连接到虚拟服务器"></a>2⃣️ 连接到虚拟服务器</h2><p>创建一个免费实例，使用 SSH 方式远程连接到实例：</p>
<p><img src="http://upload-images.jianshu.io/upload_images/2648731-867ae58c140eecb4.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="连接到实例"></p>
<h2 id="3⃣️-安装和运行软件"><a href="#3⃣️-安装和运行软件" class="headerlink" title="3⃣️ 安装和运行软件"></a>3⃣️ 安装和运行软件</h2><p>使用程序包管理软件 apt 下载和安装软件。<br>略。。。</p>
<h2 id="4⃣️-监控和调试虚拟服务器"><a href="#4⃣️-监控和调试虚拟服务器" class="headerlink" title="4⃣️ 监控和调试虚拟服务器"></a>4⃣️ 监控和调试虚拟服务器</h2><h3 id="4-1-显示虚拟服务器的日志"><a href="#4-1-显示虚拟服务器的日志" class="headerlink" title="4.1 显示虚拟服务器的日志"></a>4.1 显示虚拟服务器的日志</h3><p>在 Web 管理控制台上查看服务器的日志：【操作】- 【实例设置】- 【获取系统日志】：</p>
<p><img src="http://upload-images.jianshu.io/upload_images/2648731-a445091ae8ec846f.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="查看服务器日志"></p>
<h3 id="4-2-监控虚拟服务器的负载"><a href="#4-2-监控虚拟服务器的负载" class="headerlink" title="4.2 监控虚拟服务器的负载"></a>4.2 监控虚拟服务器的负载</h3><p>2.1 在 Web 管理控制台上查看服务器的负载情况：选择【监控】标签页，查看 CloudWatch 监控指标。</p>
<p>2.2 在控制台查看虚拟服务器的 CPU 和内存信息</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> cat /proc/cpuinfo <span class="comment"># 查看 CPU</span></span></span><br><span class="line">processor	: 0</span><br><span class="line">vendor_id	: GenuineIntel</span><br><span class="line">cpu family	: 6</span><br><span class="line">model		: 63</span><br><span class="line">model name	: Intel(R) Xeon(R) CPU E5-2676 v3 @ 2.40GHz</span><br><span class="line">stepping	: 2</span><br><span class="line">microcode	: 0x3c</span><br><span class="line">cpu MHz		: 2400.062</span><br><span class="line">cache size	: 30720 KB</span><br><span class="line">physical id	: 0</span><br><span class="line">siblings	: 1</span><br><span class="line">core id		: 0</span><br><span class="line">cpu cores	: 1</span><br><span class="line">apicid		: 0</span><br><span class="line">initial apicid	: 0</span><br><span class="line">fpu		: yes</span><br><span class="line">fpu_exception	: yes</span><br><span class="line">cpuid level	: 13</span><br><span class="line">wp		: yes</span><br><span class="line">flags		: fpu vme de pse tsc msr pae mce cx8 apic sep mtrr pge mca cmov pat pse36 clflush mmx fxsr sse sse2 ht syscall nx rdtscp lm constant_tsc rep_good nopl xtopology eagerfpu pni pclmulqdq ssse3 fma cx16 pcid sse4_1 sse4_2 x2apic movbe popcnt tsc_deadline_timer aes xsave avx f16c rdrand hypervisor lahf_lm abm invpcid_single kaiser fsgsbase bmi1 avx2 smep bmi2 erms invpcid xsaveopt</span><br><span class="line">bugs		: cpu_meltdown spectre_v1 spectre_v2 spec_store_bypass l1tf</span><br><span class="line">bogomips	: 4800.12</span><br><span class="line">clflush size	: 64</span><br><span class="line">cache_alignment	: 64</span><br><span class="line">address sizes	: 46 bits physical, 48 bits virtual</span><br><span class="line">power management:</span><br><span class="line"></span><br><span class="line"><span class="meta">$</span><span class="bash"> free -m <span class="comment"># 查看内存信息</span></span></span><br><span class="line">              total        used        free      shared  buff/cache   available</span><br><span class="line">Mem:            990         664          85          11         240         130</span><br><span class="line">Swap:             0           0           0</span><br></pre></td></tr></table></figure>
<h2 id="5⃣️-更改虚拟服务器的容量"><a href="#5⃣️-更改虚拟服务器的容量" class="headerlink" title="5⃣️ 更改虚拟服务器的容量"></a>5⃣️ 更改虚拟服务器的容量</h2><p>要调整的虚拟服务器的容量，首先需要先<strong>停止</strong>（⚠️ 「停止」不是「终止」）正在运行的实例，然后再<strong>更改实例类型</strong>。</p>
<h2 id="6⃣️-在另一个数据中心开启虚拟服务器"><a href="#6⃣️-在另一个数据中心开启虚拟服务器" class="headerlink" title="6⃣️ 在另一个数据中心开启虚拟服务器"></a>6⃣️ 在另一个数据中心开启虚拟服务器</h2><ul>
<li>AWS 为全球提供数据中心，要使互联网上的请求获得低延迟，为主要用户选择一个最近的数据中心是很重要的。</li>
<li>AWS 的各个区域间是完全独立的。典型情况下，一个区域由两个或更多位于同一地区的数据中心组成。</li>
</ul>
<h2 id="7⃣️-分配一个公有-IP-地址"><a href="#7⃣️-分配一个公有-IP-地址" class="headerlink" title="7⃣️ 分配一个公有 IP 地址"></a>7⃣️ 分配一个公有 IP 地址</h2><p>每个虚拟服务器都会自动连接到一个公有IP地址。但是，每次启动或停止一台虚拟服务器，公有IP地址就改变了。如果想要用一个固定IP地址运行一个应用程序，这样做就不可行了。AWS提供一项服务叫作<strong>弹性IP地址（Elastic IP address）</strong>来<strong>分配固定的公有 IP 地址</strong>。</p>
<p>在默认情况下，所有 AWS 账户在每个区域最多可拥有五 (5) 个弹性 IP 地址，因为公有 (IPv4) Internet 地址是稀缺的公共资源。我们大大鼓励您主要使用弹性 IP 地址，以便在实例发生故障的情况下能够将该地址映射到另一实例，并能够将 DNS 主机名用于所有其他节点间通信。</p>
<blockquote>
<p>⚠️</p>
<p>IPv4 地址是稀缺资源。为了防止浪费弹性 IP 地址资源，AWS 将对没有关联到任何服务器的弹性 IP 地址收费。😱😱😱</p>
</blockquote>
<p>参考：<a href="https://docs.aws.amazon.com/zh_cn/AWSEC2/latest/UserGuide/elastic-ip-addresses-eip.html" target="_blank" rel="noopener">AWS 文档：弹性 IP 地址</a></p>
<h2 id="8⃣️-向虚拟服务器添加额外的网络接口"><a href="#8⃣️-向虚拟服务器添加额外的网络接口" class="headerlink" title="8⃣️ 向虚拟服务器添加额外的网络接口"></a>8⃣️ 向虚拟服务器添加额外的网络接口</h2><p>用户可以向一台虚拟服务器添加多个网络接口，并且控制关联到这些网络接口的私有 IP 地址和公有 IP 地址。用户可以使用额外的网络接口关联第二个公有 IP 地址到自己的虚拟服务器上。</p>
<p>可以让一台虚拟服务器通过两个不同的公有 IP 地址来访问，这样就可以根据公有 IP 地址提供两个不同的网站服务：</p>
<p><img src="http://upload-images.jianshu.io/upload_images/2648731-9c2dc214e199ffab.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="多个网络接口"></p>
<p>命令行查看附加的网络接口：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ifconfig</span><br></pre></td></tr></table></figure>
<h2 id="9⃣️-优化虚拟服务器的开销"><a href="#9⃣️-优化虚拟服务器的开销" class="headerlink" title="9⃣️ 优化虚拟服务器的开销"></a>9⃣️ 优化虚拟服务器的开销</h2><table>
<thead>
<tr>
<th>服务器计费方式</th>
<th>优点</th>
<th>缺点</th>
<th>备注</th>
</tr>
</thead>
<tbody>
<tr>
<td>按需实例</td>
<td>灵活性最大</td>
<td>价格最高、可靠性中等</td>
<td></td>
</tr>
<tr>
<td>竞价型实例</td>
<td>价格随供求波动，价格最低</td>
<td>灵活性中等、可靠性低</td>
<td></td>
</tr>
<tr>
<td>预留实例</td>
<td>包年包月，有折扣优惠，价格中等、可靠性高</td>
<td>灵活性最低</td>
</tr>
</tbody>
</table>
<blockquote>
<p>💡</p>
<p>用户如果使用预留实例（全部前期费用，3年试用期），相比按需实例，最多可节省 60% 的费用。</p>
<p>预留实例以灵活性换取成本减少。</p>
<p>推荐：开始时使用按需服务器，然后切换到按需与预留服务器混合的模式！</p>
<hr>
<p>竞价型实例适合运行异步任务，如数据分析或者对媒体资源进行编码。</p>
</blockquote>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://andy0570.com/2019/01/02/各厂商云服务费用调查/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="独木舟的木">
      <meta itemprop="description" content="有时候阳光很好 有时候阳光很暗">
      <meta itemprop="image" content="https://ws1.sinaimg.cn/large/006tNc79gy1g22m14458rj30u014xu0x.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="独木舟的木">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/01/02/各厂商云服务费用调查/" class="post-title-link" itemprop="url">各厂商云服务费用调查</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2019-01-02 17:40:00" itemprop="dateCreated datePublished" datetime="2019-01-02T17:40:00+08:00">2019-01-02</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2019-04-16 22:42:22" itemprop="dateModified" datetime="2019-04-16T22:42:22+08:00">2019-04-16</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/云计算/" itemprop="url" rel="index"><span itemprop="name">云计算</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          
            <span id="/2019/01/02/各厂商云服务费用调查/" class="leancloud_visitors" data-flag-title="各厂商云服务费用调查">
              <span class="post-meta-divider">|</span>
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              
                <span class="post-meta-item-text">阅读次数：</span>
              
                <span class="leancloud-visitors-count"></span>
            </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body han-init-context" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>调查时间：2018年12月11日</p>
</blockquote>
<h1 id="一、参数指标"><a href="#一、参数指标" class="headerlink" title="一、参数指标"></a>一、参数指标</h1><h3 id="1-1-计费方式"><a href="#1-1-计费方式" class="headerlink" title="1.1 计费方式"></a>1.1 计费方式</h3><ul>
<li><strong>包年包月</strong>：按月购买及续费，预付费模式。==有折扣优惠==</li>
<li><strong>按量付费</strong>：按实际开通时长以小时为单位进行收费，后付费模式。</li>
<li><strong>抢占式实例</strong>：相对于按量付费实例价格有一定的折扣，价格随供求波动，按实际使用时长进行收费，后付费模式。您愿意支付每小时的实例最高价。当您的出价高于当前市场成交价时，您的实例就会运行。（注：抢占式实例适用于无状态的应用场景，比如可弹性伸缩的 Web 站点服务、实时分析、图像渲染、大数据分析和大规模并行计算等。）==后期可以尝试的计费方式，弹性增减节点数量==</li>
</ul>
<h3 id="1-2-ECS实例类型"><a href="#1-2-ECS实例类型" class="headerlink" title="1.2 ECS实例类型"></a>1.2 ECS实例类型</h3><table>
<thead>
<tr>
<th>实例类型</th>
<th>==CPU/内存比==</th>
<th>CPU型号</th>
<th>备注</th>
</tr>
</thead>
<tbody>
<tr>
<td>通用型</td>
<td>1:4</td>
<td>Intel Skylake Xeon Platinum 8163 2.5GHz 处理器。</td>
<td></td>
</tr>
<tr>
<td>计算型</td>
<td>1:2</td>
<td>Intel Skylake Xeon Platinum 8163 2.5GHz 处理器。</td>
<td></td>
</tr>
<tr>
<td>内存型</td>
<td>1:8</td>
<td>Intel Skylake Xeon Platinum 8163 2.5GHz 处理器。</td>
<td></td>
</tr>
<tr>
<td>大数据型</td>
<td>1:4</td>
<td>Intel Xeon E5-2682 v4（Broadwell）处理器，2.5GHZ 主频。</td>
<td>适合 Hadoop、并行数据处理类业务使用</td>
</tr>
<tr>
<td>本地SSD</td>
<td>1:4</td>
<td>Intel Skylake Xeon Platinum 8163 2.5GHz 处理器，为高性能数据库等场景设计，配备高性能（高 IOPS、大吞吐、低访问延迟）NVMe SSD 本地盘</td>
<td>适用于 OLTP、高性能关系型数据库、NoSQL 数据库（如 Cassandra、MongoDB 等）、Elasticsearch 等搜索场景</td>
</tr>
<tr>
<td>高主频型</td>
<td>1:4</td>
<td>Intel Xeon(Skylake) Gold 6149 3.1GHz 处理器，为高计算性能需求场景设计。</td>
<td></td>
</tr>
<tr>
<td>入门级（共享）</td>
<td>-</td>
<td>-</td>
<td>适用于 Web 应用前端机，轻负载应用、微服务，开发测试压测服务应用场景。</td>
</tr>
</tbody>
</table>
<p>参考：阿里云 ECS 标准，X86架构。</p>
<p><a href="https://help.aliyun.com/document_detail/58291.html?spm=a2c4g.11174283.6.611.364d52fevr5Cji" target="_blank" rel="noopener">阿里云 - ECS 配置选型 </a></p>
<p><img src="http://upload-images.jianshu.io/upload_images/2648731-890f166bc2d7002e.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="阿里云配置选型"></p>
<blockquote>
<p>推荐部署==通用型实例==，CPU/内存比为1:4，大部分云厂商的实例类型可弹性更改。</p>
</blockquote>
<h3 id="1-3-块存储"><a href="#1-3-块存储" class="headerlink" title="1.3 块存储"></a>1.3 块存储</h3><ul>
<li><a href="https://docs.aws.amazon.com/zh_cn/AWSEC2/latest/UserGuide/EBSVolumeTypes.html" target="_blank" rel="noopener">AWS - EBS 卷类型</a></li>
<li><a href="https://help.aliyun.com/document_detail/25382.html?spm=5176.ecsbuyv3.storage.2.122a3675k4YZ7H" target="_blank" rel="noopener">阿里云 - 块存储性能</a></li>
</ul>
<p><img src="http://upload-images.jianshu.io/upload_images/2648731-fa03a59a89cf8a6b.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="阿里云块存储"></p>
<h3 id="1-4-公网带宽计费模式"><a href="#1-4-公网带宽计费模式" class="headerlink" title="1.4 公网带宽计费模式"></a>1.4 公网带宽计费模式</h3><ul>
<li><strong>按固定带宽</strong>：需指定公网出方向的带宽的大小，如 10Mbps，==适用于业务场景对于网络带宽要求比较稳定的客户==，费用较低。</li>
<li><strong>按使用流量</strong>：是按公网出方向的实际发生的网络流量进行收费，==适用于业务场景对网络带宽需求变化较大的场景==，如平时带宽使用较低但间歇性的出现网络访问高峰的场景；</li>
</ul>
<h4 id="1-4-1-固定带宽费用（元-月）"><a href="#1-4-1-固定带宽费用（元-月）" class="headerlink" title="1.4.1 固定带宽费用（元/月）"></a>1.4.1 固定带宽费用（元/月）</h4><table>
<thead>
<tr>
<th>云服务</th>
<th>1 Mbps</th>
<th>5 Mbps</th>
<th>10 Mbps</th>
<th>20 Mbps</th>
</tr>
</thead>
<tbody>
<tr>
<td>AWS</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
</tr>
<tr>
<td>Azure</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
</tr>
<tr>
<td>阿里云</td>
<td>23</td>
<td>125</td>
<td>502</td>
<td>1325</td>
</tr>
<tr>
<td>华为云</td>
<td>23</td>
<td>115</td>
<td>800</td>
<td>1600</td>
</tr>
<tr>
<td>移动云</td>
<td>20</td>
<td>100</td>
<td>600</td>
<td>1200</td>
</tr>
<tr>
<td>天翼云</td>
<td>20</td>
<td>100</td>
<td>280</td>
<td>640</td>
</tr>
<tr>
<td>浪潮</td>
<td>-</td>
<td>95.8</td>
<td>429.16</td>
<td>1095.83</td>
</tr>
<tr>
<td>谷歌云</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
</tr>
</tbody>
</table>
<h1 id="二、AWS"><a href="#二、AWS" class="headerlink" title="二、AWS"></a>二、AWS</h1><p>区域：美国东部（俄亥俄州）</p>
<h3 id="按需定价"><a href="#按需定价" class="headerlink" title="按需定价"></a>按需定价</h3><table>
<thead>
<tr>
<th>通用实例</th>
<th>vCPU</th>
<th>内存（GiB）</th>
<th>实例存储</th>
<th>Linux 使用量</th>
<th>预计费用/月</th>
</tr>
</thead>
<tbody>
<tr>
<td>t3.large</td>
<td>2</td>
<td>8</td>
<td>仅限 EBS</td>
<td>每小时 0.0832 USD</td>
<td>==¥413.36==</td>
</tr>
<tr>
<td>t3.xlarge</td>
<td>4</td>
<td>16</td>
<td>仅限 EBS</td>
<td>每小时 0.1664 USD</td>
<td>==¥826.67==</td>
</tr>
<tr>
<td>t2.large</td>
<td>2</td>
<td>8</td>
<td>仅限 EBS</td>
<td>每小时 0.0928 USD</td>
<td>¥461.36</td>
</tr>
<tr>
<td>t2.xlarge</td>
<td>4</td>
<td>16</td>
<td>仅限 EBS</td>
<td>每小时 0.1856 USD</td>
<td>¥ 922.1</td>
</tr>
</tbody>
</table>
<ul>
<li>预计费用按照：每小时费用 x (当前汇率 6.9) x 24 x 30 计算。</li>
<li>数据传出、传入根据==不同的数据量==和==不同的地区==单独收费（没有带宽，按流量计费）。</li>
<li>弹性IP地址：¥24.8/月。</li>
</ul>
<h3 id="预留实例"><a href="#预留实例" class="headerlink" title="预留实例"></a>预留实例</h3><table>
<thead>
<tr>
<th>通用实例</th>
<th>预付</th>
<th>每小时有效价格</th>
<th>按需每小时费率</th>
<th>折扣</th>
<th>预计费用/月</th>
</tr>
</thead>
<tbody>
<tr>
<td>t3.large</td>
<td>¥ 2939.95</td>
<td>0.049 USD</td>
<td>0.0832 USD</td>
<td>42%</td>
<td>==¥ 245==</td>
</tr>
<tr>
<td>t3.xlarge</td>
<td>¥ 5886.80</td>
<td>0.097 USD</td>
<td>0.1664 USD</td>
<td>41%</td>
<td>==¥ 490.5==</td>
</tr>
<tr>
<td>t2.large</td>
<td>¥ 3243</td>
<td>0.054 USD</td>
<td>0.0928 USD</td>
<td>42%</td>
<td>==¥ 270.25==</td>
</tr>
<tr>
<td>t2.xlarge</td>
<td>¥ 6487</td>
<td>0.107 USD</td>
<td>0.1856 USD</td>
<td>42%</td>
<td>==540.58==</td>
</tr>
</tbody>
</table>
<ul>
<li><a href="https://amazonaws-china.com/cn/ec2/pricing/reserved-instances/pricing/" target="_blank" rel="noopener">Amazon EC2 预留实例定价</a></li>
<li>预付费用分：不预付费用、预付部分费用、预付全部费用。以上按预付全部费用计算。</li>
<li>与按需实例的定价相比，标准预留实例可为您提供大幅折扣（==最高可达 75%==），并能按 1 年或 3 年的使用期进行购买。</li>
</ul>
<h1 id="三、Azure"><a href="#三、Azure" class="headerlink" title="三、Azure"></a>三、Azure</h1><p><a href="https://azure.microsoft.com/zh-cn/pricing/details/virtual-machines/series/" target="_blank" rel="noopener">Azure 虚拟机系列</a> 以 B 系列（经济型可突增 VM）为例，包年（节省25%价格）：</p>
<table>
<thead>
<tr>
<th>实例类型</th>
<th>CPU</th>
<th>内存</th>
<th>临时存储空间</th>
<th>每小时费用</th>
<th>预计费用/月</th>
</tr>
</thead>
<tbody>
<tr>
<td>B2MS</td>
<td>2</td>
<td>8</td>
<td>16 GB</td>
<td>0.102 USD</td>
<td>==¥ 512==</td>
</tr>
<tr>
<td>B4MS</td>
<td>4</td>
<td>16</td>
<td>32 BG</td>
<td>0.203 USD</td>
<td>==¥ 1008.32==</td>
</tr>
</tbody>
</table>
<ul>
<li>亚洲东部|2 vCPU|8 GB RAM|32 GiB 标准 HDD，OS 磁盘|存储 1000 GiB |==¥ 943/月==</li>
<li>亚洲东部|4 vCPU|16 GB RAM|32 GiB 标准 HDD，OS 磁盘|存储 1000 GiB |==¥ 1455.56/月==</li>
</ul>
<h1 id="四、阿里云"><a href="#四、阿里云" class="headerlink" title="四、阿里云"></a>四、阿里云</h1><table>
<thead>
<tr>
<th>实例规格</th>
<th>vCPU</th>
<th>内存</th>
<th>处理器主频</th>
<th>内网带宽</th>
<th>内网收发包</th>
<th>支持iPv6</th>
<th>规格参考价格</th>
</tr>
</thead>
<tbody>
<tr>
<td>通用型g5 ecs.g5.large</td>
<td>2</td>
<td>8</td>
<td>2.5 GHz</td>
<td>1 Gbps</td>
<td>30 万 PPS</td>
<td>是</td>
<td>==¥ 242.25/月==</td>
</tr>
<tr>
<td>通用型g5 ecs.g5.xlarge</td>
<td>4</td>
<td>16</td>
<td>2.5 Ghz</td>
<td>1.5 Gbps</td>
<td>50 万 PPS</td>
<td>是</td>
<td>==¥ 484.5/月==</td>
</tr>
</tbody>
</table>
<ul>
<li><p>2 核vCPU | 8 GiB 内存 |系统盘+数据盘高效云盘 40 + 1020 GiB |10Mbps 带宽|==¥ 952.8/月（包一年）==。</p>
</li>
<li><p>4 核vCPU | 16 GiB 内存 |系统盘+数据盘高效云盘 40 + 1020 GiB |10Mbps 带宽|==¥ 1144.1/月（包一年）==。（==¥13729==一年）</p>
</li>
<li><p>包一年优惠：数据盘享 8.5 折，系统盘享 8.5 折，买满一年，带宽立享 8.5 折，专有网络实例立享 7.5 折。</p>
</li>
</ul>
<h1 id="五、华为云"><a href="#五、华为云" class="headerlink" title="五、华为云"></a>五、华为云</h1><p><a href="https://www.huaweicloud.com/pricing.html#/ecs" target="_blank" rel="noopener">华为云费用详情</a></p>
<h3 id="ECS-价格"><a href="#ECS-价格" class="headerlink" title="ECS 价格"></a>ECS 价格</h3><table>
<thead>
<tr>
<th>规格名称</th>
<th>CPU</th>
<th>内存</th>
<th>按小时</th>
<th>包月</th>
<th>包1年（83折）</th>
<th>包2年（7折）</th>
<th>包3年（5折）</th>
</tr>
</thead>
<tbody>
<tr>
<td>通用计算型S1</td>
<td>2</td>
<td>8</td>
<td>0.59</td>
<td>==284.9==</td>
<td>2849</td>
<td>4786.3</td>
<td>5128.2</td>
</tr>
<tr>
<td>通用计算型S1</td>
<td>4</td>
<td>16</td>
<td>1.19</td>
<td>==569.8==</td>
<td>5698</td>
<td>9572.6</td>
<td>10256.4</td>
</tr>
<tr>
<td>通用计算型S2</td>
<td>4</td>
<td>8</td>
<td>0.78</td>
<td>376</td>
<td>3760</td>
<td>6316.8</td>
<td>6768</td>
</tr>
<tr>
<td>通用计算型S3</td>
<td>2</td>
<td>8</td>
<td>0.68</td>
<td>==215.6==</td>
<td>2069.8</td>
<td>3363.4</td>
<td>3725.6</td>
</tr>
<tr>
<td>通用计算型S3</td>
<td>4</td>
<td>16</td>
<td>1.37</td>
<td>==431.2==</td>
<td>4139.6</td>
<td>6727.6</td>
<td>7451.1</td>
</tr>
</tbody>
</table>
<h3 id="磁盘价格"><a href="#磁盘价格" class="headerlink" title="磁盘价格"></a>磁盘价格</h3><table>
<thead>
<tr>
<th>产品类型</th>
<th>说明</th>
<th>步长规格</th>
<th>按小时</th>
<th>包月</th>
<th>包1年（83折）</th>
<th>包2年（7折）</th>
<th>包3年（5折）</th>
</tr>
</thead>
<tbody>
<tr>
<td>普通 IO</td>
<td>线性计算</td>
<td>1 GB</td>
<td>-</td>
<td>0.3</td>
<td>3</td>
<td>5.04</td>
<td>5.4</td>
</tr>
<tr>
<td>高 IO</td>
<td>线性计算</td>
<td>1 GB</td>
<td>-</td>
<td>0.35</td>
<td>==3.5==</td>
<td>5.88</td>
<td>6.3</td>
</tr>
<tr>
<td>超高 IO</td>
<td>线性计算</td>
<td>1 GB</td>
<td>-</td>
<td>1</td>
<td>==10==</td>
<td>16.8</td>
<td>18</td>
</tr>
</tbody>
</table>
<h3 id="带宽价格"><a href="#带宽价格" class="headerlink" title="带宽价格"></a>带宽价格</h3><h4 id="固定带宽（元-Mbits-s）"><a href="#固定带宽（元-Mbits-s）" class="headerlink" title="固定带宽（元/Mbits/s）"></a>固定带宽（元/Mbits/s）</h4><table>
<thead>
<tr>
<th>规格</th>
<th>收费方式</th>
<th>按小时</th>
<th>包月</th>
<th>包1年（83折）</th>
<th>包2年（7折）</th>
<th>包3年（5折）</th>
</tr>
</thead>
<tbody>
<tr>
<td>全动态 BGP</td>
<td>1-5M</td>
<td>0.063</td>
<td>23</td>
<td>230</td>
<td>460</td>
<td>690</td>
</tr>
<tr>
<td>全动态 BGP</td>
<td>6M以上</td>
<td>0.25</td>
<td>80</td>
<td>800</td>
<td>1600</td>
<td>2400</td>
</tr>
</tbody>
</table>
<h4 id="按流量"><a href="#按流量" class="headerlink" title="按流量"></a>按流量</h4><table>
<thead>
<tr>
<th>规格</th>
<th>收费方式</th>
<th>按流量</th>
<th>价格单位</th>
</tr>
</thead>
<tbody>
<tr>
<td>全动态 BGP</td>
<td>按流量</td>
<td>0.8</td>
<td>元/GB</td>
</tr>
<tr>
<td>静态 BGP</td>
<td>按流量</td>
<td>0.64</td>
<td>元/GB</td>
</tr>
</tbody>
</table>
<ul>
<li>华北 - 北京一|s3.large.4 | 2 核 | 8GB|系统盘+数据盘高I/O 40 G + 1020G |10 Mbps 带宽|==¥910.8/月（包一年价格）==</li>
<li>华北 - 北京一|s3.xlarge.4 | 4核 | 16GB|系统盘+数据盘高I/O 40 G + 1020G |10 Mbps 带宽|==¥1083.25/月（包一年价格）==</li>
</ul>
<h1 id="六、移动云"><a href="#六、移动云" class="headerlink" title="六、移动云"></a>六、移动云</h1><blockquote>
<p>⚠️ </p>
<ul>
<li>节点限制：只有一个地域可选，华南节点2。</li>
<li>机型限制：通用型。</li>
<li>参考：<a href="https://ecloud.10086.cn/op-help-center/show/f_4_4_3" target="_blank" rel="noopener">移动云</a></li>
</ul>
</blockquote>
<ul>
<li>华南节点2|2核|8GB|系统盘+数据盘 40GB+1TB|10 Mbps 带宽|==¥808.6/月==</li>
<li>华南节点2|4核|16GB|系统盘+数据盘 40GB+1TB|10 Mbps 带宽|==¥1028.6/月==</li>
</ul>
<h1 id="七、天翼云"><a href="#七、天翼云" class="headerlink" title="七、天翼云"></a>七、天翼云</h1><blockquote>
<p>⚠️</p>
<ul>
<li>节点限制，只有一个地域可选：北京1。</li>
<li>没有机型选项。</li>
<li>数据盘只有普通I/O。</li>
<li>参考：<a href="https://www.ctyun.cn/calculator/ecs" target="_blank" rel="noopener">天翼云价格计算器</a></li>
</ul>
</blockquote>
<ul>
<li>北京1|2核|8GB|数据盘 1020 GB|10 Mbps 带宽|==¥800.7/月==</li>
<li>北京1|4核|16GB|数据盘 1020 GB|10 Mbps 带宽|==¥1103.3/月==</li>
</ul>
<h1 id="八、浪潮"><a href="#八、浪潮" class="headerlink" title="八、浪潮"></a>八、浪潮</h1><blockquote>
<p>⚠️</p>
<ul>
<li>节点限制：只有一个地域可选，北京。</li>
<li>机型限制：标准型。</li>
<li>云服务器无法备份。</li>
<li>带宽限制：只有</li>
</ul>
<p>参考：<a href="https://cloud.inspur.com/" target="_blank" rel="noopener">浪潮云</a></p>
</blockquote>
<ul>
<li>北京|2核|8GB|系统盘+数据盘 20GB+1020GB|10 Mbps 带宽|==¥923.9/月==</li>
<li>北京|4核|16GB|系统盘+数据盘 20GB+1020GB|10 Mbps 带宽|==¥1115.16/月==</li>
</ul>
<h1 id="九、谷歌云"><a href="#九、谷歌云" class="headerlink" title="九、谷歌云"></a>九、谷歌云</h1><blockquote>
<p>⚠️  </p>
<ul>
<li>无国内服务。</li>
</ul>
<p>参考：<a href="https://cloud.google.com/pricing/" target="_blank" rel="noopener">谷歌云</a></p>
</blockquote>
<p><a href="https://www.ifanr.com/1141734" target="_blank" rel="noopener">资讯：秘密洽谈，Google 想和腾讯在云服务上合作</a></p>
<blockquote>
<p>腾讯云回应「Google 借道腾讯扩展中国云服务市场」：假消息。**据财联社 近日有媒体报道，Google 正打算和腾讯在云计算上合作，让腾讯作为中国谷歌云的代理，并提到「如果项目进展顺利，谷歌云将为国内客户提供从数据管理到分析以及网络安全的服务，同时在海外的腾讯云客户也可以使用谷歌云」。</p>
<p>针对此事，腾讯云方面回应称，「系假消息」。</p>
</blockquote>
<h1 id="腾讯云"><a href="#腾讯云" class="headerlink" title="腾讯云"></a>腾讯云</h1><table>
<thead>
<tr>
<th>机型规格</th>
<th>vCPU</th>
<th>内存</th>
<th>处理器型号</th>
<th>内网带宽</th>
<th>网络收发包</th>
<th>费用</th>
</tr>
</thead>
<tbody>
<tr>
<td>S4.MEDIUM8</td>
<td>2</td>
<td>8</td>
<td>Intel Xeon Skylake 6148(2.4 GHz)</td>
<td>1.5Gbps</td>
<td>30 万 PPS</td>
<td>276 元/月</td>
</tr>
<tr>
<td>S4.LARGE16</td>
<td>4</td>
<td>16</td>
<td>Intel Xeon Skylake 6148(2.4 GHz)</td>
<td>1.5Gbps</td>
<td>50 万 PPS</td>
<td>552 元/月</td>
</tr>
<tr>
<td>S2.MEDIUM8</td>
<td>2</td>
<td>8</td>
<td>Intel Xeon E5-2680 v4(2.4 GHz)</td>
<td>1.5Gbps</td>
<td>25 万 PPS</td>
<td>270 元/月</td>
</tr>
<tr>
<td>S2.LARGE16</td>
<td>4</td>
<td>16</td>
<td>Intel Xeon E5-2680 v4(2.4 GHz)</td>
<td>1.5Gbps</td>
<td>45 万 PPS</td>
<td>540 元/月</td>
</tr>
</tbody>
</table>
<ul>
<li>注：以下为标准价格，未计算包年折扣（83折）。</li>
<li>上海|2核 8GB|系统盘+数据盘 50+1020|10 Mbps 带宽|==¥1162==</li>
<li>上海|4核 16GB|系统盘+数据盘 50+1020|10 Mbps 带宽|==¥1438==</li>
</ul>
<h1 id="存储服务"><a href="#存储服务" class="headerlink" title="存储服务"></a>存储服务</h1><h3 id="对象存储"><a href="#对象存储" class="headerlink" title="对象存储 "></a><a href="https://www.aliyun.com/price/product?spm=5176.7933691.744462.c1.ffbe6a56ZNiOt4#/oss/detail" target="_blank" rel="noopener">对象存储 </a></h3><table>
<thead>
<tr>
<th>资费项</th>
<th>计费项</th>
<th>标准型单价</th>
<th>低频访问型单价</th>
<th>归档型单价</th>
</tr>
</thead>
<tbody>
<tr>
<td>存储费用</td>
<td>数据存储</td>
<td>0.12 元/GB/月</td>
<td>0.08 元/GB/月</td>
<td>0.033 元/GB/月</td>
</tr>
<tr>
<td></td>
<td>10GB/年的价格</td>
<td>14.4 元</td>
<td>9.6 元</td>
<td>3.96 元</td>
</tr>
</tbody>
</table>
<h3 id="文件存储"><a href="#文件存储" class="headerlink" title="文件存储"></a><a href="https://www.aliyun.com/product/nas?spm=5176.208355.cloudEssentials.20.11732ca1L5ja8K" target="_blank" rel="noopener">文件存储</a></h3><p>文件存储分：性能型存储包/容量型存储包</p>
<p><img src="http://upload-images.jianshu.io/upload_images/2648731-a988999a2c9c113d.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="容量型存储包价格"></p>
<blockquote>
<p>按照 0.21 元/GB/月的价格计算， 25.2 元/10GB/年。</p>
</blockquote>
<h3 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h3><ul>
<li><a href="https://amazonaws-china.com/cn/ec2/instance-types/" target="_blank" rel="noopener">AWS 实例类型</a></li>
<li><a href="https://amazonaws-china.com/cn/ec2/pricing/on-demand/" target="_blank" rel="noopener">Amazon EC2 定价</a></li>
<li><a href="https://docs.aws.amazon.com/zh_cn/AWSEC2/latest/UserGuide/EBSVolumeTypes.html" target="_blank" rel="noopener">Amazon EBS 卷类型</a></li>
<li><a href="https://azure.microsoft.com/zh-cn/pricing/details/virtual-machines/series/" target="_blank" rel="noopener">Azure 虚拟机类型</a></li>
<li><a href="https://azure.microsoft.com/zh-cn/pricing/calculator/?service=cost-management" target="_blank" rel="noopener">Azure 定价计算器</a></li>
<li><a href="https://www.aliyun.com/price/?spm=5176.8142029.388261.19.3e076d3eCTb08Q" target="_blank" rel="noopener">阿里云 - 定价</a></li>
<li><a href="https://ecs-buy.aliyun.com/wizard/#/prepay/cn-shanghai" target="_blank" rel="noopener">阿里云 - 实例类型</a></li>
<li><a href="https://help.aliyun.com/document_detail/58291.html?spm=5176.ecsbuyv3.instance.2.122a3675k4YZ7H" target="_blank" rel="noopener">阿里云 - 配置选型</a></li>
<li><a href="https://help.aliyun.com/document_detail/25378.html?spm=5176.ecsbuyv3.instance.1.122a3675k4YZ7H#g5" target="_blank" rel="noopener">阿里云 - 实例规格族特点</a></li>
<li><a href="https://help.aliyun.com/document_detail/25382.html?spm=5176.ecsbuyv3.storage.2.122a3675k4YZ7H" target="_blank" rel="noopener">阿里云 - 块存储性能</a></li>
<li><a href="https://www.huaweicloud.com/pricing.html#/ecs" target="_blank" rel="noopener">华为云 - 弹性云服务器ECS 价格计算器</a></li>
<li><a href="https://support.huaweicloud.com/productdesc-ecs/zh-cn_topic_0088142812.html" target="_blank" rel="noopener">华为云 - 弹性云服务器ECS 通用计算型实例规格</a></li>
<li><a href="https://cloud.tencent.com/document/product/213/11518" target="_blank" rel="noopener">腾讯云 - 实例规格</a></li>
<li><a href="https://www.infoq.cn/article/3FiAVeY8i_A1ziR67tux" target="_blank" rel="noopener">国内云计算厂商众生相：四大阵营十几家企业生存盘点</a></li>
</ul>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://andy0570.com/2019/01/01/《AWS云计算实战》笔记（一）——AWS/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="独木舟的木">
      <meta itemprop="description" content="有时候阳光很好 有时候阳光很暗">
      <meta itemprop="image" content="https://ws1.sinaimg.cn/large/006tNc79gy1g22m14458rj30u014xu0x.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="独木舟的木">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/01/01/《AWS云计算实战》笔记（一）——AWS/" class="post-title-link" itemprop="url">《AWS云计算实战》笔记（一）——AWS</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2019-01-01 20:12:00" itemprop="dateCreated datePublished" datetime="2019-01-01T20:12:00+08:00">2019-01-01</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2019-04-16 16:27:39" itemprop="dateModified" datetime="2019-04-16T16:27:39+08:00">2019-04-16</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/云计算/" itemprop="url" rel="index"><span itemprop="name">云计算</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          
            <span id="/2019/01/01/《AWS云计算实战》笔记（一）——AWS/" class="leancloud_visitors" data-flag-title="《AWS云计算实战》笔记（一）——AWS">
              <span class="post-meta-divider">|</span>
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              
                <span class="post-meta-item-text">阅读次数：</span>
              
                <span class="leancloud-visitors-count"></span>
            </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body han-init-context" itemprop="articleBody">

      
      

      
        
          
            <h1 id="AWS-是一个云计算平台"><a href="#AWS-是一个云计算平台" class="headerlink" title="AWS 是一个云计算平台"></a>AWS 是一个云计算平台</h1><p><strong>Amazon Web Service</strong>（AWS）是一个提供 Web 服务解决方案的平台，它提供了不同抽象层上的计算、存储和网络的解决方案。</p>
<p><strong>Web 服务</strong>：可以通过 Web 界面来控制服务。</p>
<p>AWS 部署在世界各地的数据中心，可以为客户提供全球性的基础设施服务。</p>
<blockquote>
<p>AWS 云在全球 20 个地理区域内运营着 60 个可用区，并宣布计划增加巴林、开普敦、中国香港特别行政区和米兰这四个区域，同时再增加 12 个可用区。（201902）</p>
</blockquote>
<h2 id="云计算"><a href="#云计算" class="headerlink" title="云计算"></a>云计算</h2><blockquote>
<p>美国国家标准和技术研究所（NIST）对云计算的定义：</p>
<p>云计算是一种普适的、方便的、按需提供网络访问的可配置的计算资源（如网络、服务器、存储、应用程序和服务）的共享池模型，它能够以最少的管理工作量或与服务提供者交互的方式快速进行分配和发布。</p>
</blockquote>
<p><img src="http://upload-images.jianshu.io/upload_images/2648731-6223e024c16c5e28.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="云计算的分类"></p>
<p><img src="http://upload-images.jianshu.io/upload_images/2648731-2f8132f7e194102a.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="云计算服务"></p>
<ul>
<li><strong>基础设施即服务（Iaas）</strong>——提供计算、存储和网络功能等基本资源，使用 Amazon EC2、Google Compute Engine 和 Microsoft Azure 虚拟机这一类虚拟服务器。</li>
<li><strong>平台即服务（Paas）</strong>——提供将定制的应用部署到云上的平台，如 AWS Elastic Beanstalk、Google App Engine 和 Heroku。</li>
<li><strong>软件即服务（Saas）</strong>——结合了基础设施和软件并且运行在云端，包括 Amazon WorkSpaces、Google Apps for Work 和 Microsoft Office 365 这一类办公应用。还有例如 AWS ELB 负载均衡器、AWS RDS 数据库 等。</li>
</ul>
<h2 id="AWS-可以做什么？"><a href="#AWS-可以做什么？" class="headerlink" title="AWS 可以做什么？"></a>AWS 可以做什么？</h2><p>使用一个或多个服务组合在 AWS 上运行任何应用程序。</p>
<p>如：托管一家网店、在 AWS 上运行企业应用程序、以可靠、耐用的方式存储和归档数据、实现容错的系统架构…</p>
<h2 id="使用-AWS-的优势"><a href="#使用-AWS-的优势" class="headerlink" title="使用 AWS 的优势"></a>使用 AWS 的优势</h2><ol>
<li>创新和快速发展的平台。使用 AWS 的新功能和服务转化为针对自己的客户的创新解决方案，从而体现竞争优势。</li>
<li>选择合适的服务构建复杂的系统。</li>
<li>利用 AWS API 实现自动化操作。</li>
<li>灵活的容量（可扩展性）。根据需求弹性部署应用。</li>
<li>为失效而构建（可靠性）。AWS 为客户提供了创建容错系统所需要的一切资源。</li>
<li>缩短上市的时间。客户可以在 AWS 上快速调整基础架构以满足需求。</li>
<li><p>从规模经济中受益（节约成本）。AWS 规模越大，价格就会越低。</p>
<blockquote>
<p>截止到 2017 年 11 月，AWS 已经进行了 62 次降价。</p>
</blockquote>
</li>
<li>全球化的基础设施。</li>
<li>专业的合作伙伴。AWS 符合很多行业合规性要求。ISO 27001、FedRAMP &amp; DoD CSM、PCI DSS Level 1、ISO 9001。</li>
</ol>
<h2 id="AWS-的付费机制——按使用量付费"><a href="#AWS-的付费机制——按使用量付费" class="headerlink" title="AWS 的付费机制——按使用量付费"></a>AWS 的付费机制——按使用量付费</h2><p>AWS 的计费方式：</p>
<ul>
<li>按使用时间计费；</li>
<li>按流量计费；</li>
<li>按存储用量计费；</li>
</ul>
<h2 id="AWS-服务"><a href="#AWS-服务" class="headerlink" title="AWS 服务"></a>AWS 服务</h2><p>用于计算、存储和联网的硬件是 AWS 云计算的基础。AWS 在硬件上运行软件服务来提供服务。</p>
<ul>
<li><strong>计算服务</strong>提供了计算能力以及内存。客户可以启动虚拟服务器并使用它们来运行应用程序。</li>
<li><strong>应用服务</strong>为常见的使用场景提供解决方案，如消息队列、主题以及检索大量数据以集成到应用中。</li>
<li><strong>企业服务</strong>提供独立的解决方案，如邮件服务器和目录服务。</li>
<li><strong>部署和管理服务</strong>作用于迄今所提到的服务。这个服务可以帮助客户授予或者撤销对云资源的访问、虚拟服务系统的监控以及部署应用程序。</li>
<li><strong>存储服务</strong>被用来搜集、保存和归档数据。AWS供了不同的存储选项:对象存储或者用于虚拟服务器的网络附加存储方案。</li>
<li>当需要管理结构化数据时，<strong>数据库存储</strong>比其他存储方案有一些优势。AWS提供了关系数据库和 NOSQL数据库服务。</li>
<li><strong>网络服务</strong>是AWS的基本组成部分。客户可以定义一个私有的网络并使用高度集成的DNS服务。</li>
</ul>
<h2 id="与-AWS-交互"><a href="#与-AWS-交互" class="headerlink" title="与 AWS 交互"></a>与 AWS 交互</h2><p>客户可以使用诸如管理控制台、基于 Web 的用户界面或命令行工具等工具实现对服务资源的管理。</p>
<p><img src="http://upload-images.jianshu.io/upload_images/2648731-09101d06c51e2ee3.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="与 AWS 交互的方式"></p>
<ul>
<li>GUI：使用基于 Web 的管理控制台实现与 AWS 的交互；</li>
<li>CLI 通常用于自动执行 AWS 上的任务，客户可以将多个 CLI 调用链接起来，以实现基础设施的自动化；</li>
<li>SDK 通常用于将 AWS 服务集成到应用程序中；</li>
<li>蓝图（AWS CloudFormation，官方称之为“堆栈”）是包含所有服务和依赖关系的对于系统的描述。蓝图可以帮助你自动化云中基础设施的配置。（简而言之，就是用一个 JSON 文件描述整个云服务基础设施架构，可以一键部署）。</li>
</ul>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://andy0570.com/2018/12/28/UIRefreshControl/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="独木舟的木">
      <meta itemprop="description" content="有时候阳光很好 有时候阳光很暗">
      <meta itemprop="image" content="https://ws1.sinaimg.cn/large/006tNc79gy1g22m14458rj30u014xu0x.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="独木舟的木">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2018/12/28/UIRefreshControl/" class="post-title-link" itemprop="url">UIRefreshControl</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2018-12-28 15:10:00" itemprop="dateCreated datePublished" datetime="2018-12-28T15:10:00+08:00">2018-12-28</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2019-04-17 11:57:38" itemprop="dateModified" datetime="2019-04-17T11:57:38+08:00">2019-04-17</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/iOS/" itemprop="url" rel="index"><span itemprop="name">iOS</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          
            <span id="/2018/12/28/UIRefreshControl/" class="leancloud_visitors" data-flag-title="UIRefreshControl">
              <span class="post-meta-divider">|</span>
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              
                <span class="post-meta-item-text">阅读次数：</span>
              
                <span class="leancloud-visitors-count"></span>
            </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body han-init-context" itemprop="articleBody">

      
      

      
        
          
            <h3 id="UIRefreshControl"><a href="#UIRefreshControl" class="headerlink" title="UIRefreshControl"></a>UIRefreshControl</h3><p>示例代码<br><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">MyViewController</span></span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">UIRefreshControl</span> * refreshControl;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span><br><span class="line">        </span><br><span class="line">    <span class="comment">// 刷新控件</span></span><br><span class="line">    refreshControl = [[<span class="built_in">UIRefreshControl</span> alloc] init];</span><br><span class="line">    [refreshControl addTarget:<span class="keyword">self</span> action:<span class="keyword">@selector</span>(refreshCallback) forControlEvents:<span class="built_in">UIControlEventValueChanged</span>];</span><br><span class="line">    [<span class="keyword">self</span>.tableView addSubview:refreshControl];</span><br><span class="line">    </span><br><span class="line">    [<span class="keyword">self</span> prepareDemoData];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#pragma mark - IBActions</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 刷新控件触发方法</span></span><br><span class="line">-(<span class="keyword">void</span>) refreshCallback</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// Run job...</span></span><br><span class="line">    [_tableView reloadData];</span><br><span class="line">    [refreshControl endRefreshing];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="推荐阅读"><a href="#推荐阅读" class="headerlink" title="推荐阅读"></a>推荐阅读</h3><ul>
<li><a href="https://medium.com/@ann.green/loading-indicators-e9d9ac9680b" target="_blank" rel="noopener">Medium：Loading Indicators</a></li>
</ul>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://andy0570.com/2018/12/26/MGSwipeTableCell——为 cell 添加带过渡动画的工具按钮/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="独木舟的木">
      <meta itemprop="description" content="有时候阳光很好 有时候阳光很暗">
      <meta itemprop="image" content="https://ws1.sinaimg.cn/large/006tNc79gy1g22m14458rj30u014xu0x.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="独木舟的木">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2018/12/26/MGSwipeTableCell——为 cell 添加带过渡动画的工具按钮/" class="post-title-link" itemprop="url">MGSwipeTableCell——为 cell 添加带过渡动画的工具按钮</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2018-12-26 18:00:00" itemprop="dateCreated datePublished" datetime="2018-12-26T18:00:00+08:00">2018-12-26</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2019-04-17 00:50:53" itemprop="dateModified" datetime="2019-04-17T00:50:53+08:00">2019-04-17</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/iOS-开源框架/" itemprop="url" rel="index"><span itemprop="name">iOS 开源框架</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          
            <span id="/2018/12/26/MGSwipeTableCell——为 cell 添加带过渡动画的工具按钮/" class="leancloud_visitors" data-flag-title="MGSwipeTableCell——为 cell 添加带过渡动画的工具按钮">
              <span class="post-meta-divider">|</span>
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              
                <span class="post-meta-item-text">阅读次数：</span>
              
                <span class="leancloud-visitors-count"></span>
            </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body han-init-context" itemprop="articleBody">

      
      

      
        
          
            <ul>
<li>GitHub: <a href="https://github.com/MortimerGoro/MGSwipeTableCell" target="_blank" rel="noopener">MGSwipeTableCell</a></li>
<li>Star: 6500+</li>
</ul>
<h1 id="MGSwipeTableCell"><a href="#MGSwipeTableCell" class="headerlink" title="MGSwipeTableCell"></a>MGSwipeTableCell</h1><p>MGSwipeTableCell 是一个易于使用的 UITableViewCell 子类，允许显示具有各种过渡效果的可滑动按钮。</p>
<p>该库与创建 UITableViewCell 的所有不同方法兼容：系统预定义样式，以编程方式创建的 cell，从 xib 加载的单元格以及故事板中的原型cell。 如果需要，您也可以使用 autolayout。</p>
<p>适用于 iOS&gt; = 5.0 版本。 在 iPhone 和 iPad 上的所有 iOS 版本上进行测试：iOS 7，iOS 8，iOS 9，iOS 10，iOS 11。</p>
<h2 id="过渡动画演示"><a href="#过渡动画演示" class="headerlink" title="过渡动画演示"></a>过渡动画演示</h2><h3 id="Border-transition-边缘过渡"><a href="#Border-transition-边缘过渡" class="headerlink" title="Border transition - 边缘过渡"></a>Border transition - 边缘过渡</h3><p><img src="https://upload-images.jianshu.io/upload_images/2648731-16d07f1db4794d5a.gif?imageMogr2/auto-orient/strip" alt="1.gif"></p>
<h3 id="Clip-transition-剪辑过渡"><a href="#Clip-transition-剪辑过渡" class="headerlink" title="Clip transition - 剪辑过渡"></a>Clip transition - 剪辑过渡</h3><p><img src="https://upload-images.jianshu.io/upload_images/2648731-daf5e70e4f434f96.gif?imageMogr2/auto-orient/strip" alt="2.gif"></p>
<h3 id="3D-transition-3D-过渡"><a href="#3D-transition-3D-过渡" class="headerlink" title="3D transition - 3D 过渡"></a>3D transition - 3D 过渡</h3><p><img src="https://upload-images.jianshu.io/upload_images/2648731-007ee3a15483e8fe.gif?imageMogr2/auto-orient/strip" alt="3.gif"></p>
<h3 id="Static-transition-静态过渡"><a href="#Static-transition-静态过渡" class="headerlink" title="Static transition - 静态过渡"></a>Static transition - 静态过渡</h3><p><img src="https://upload-images.jianshu.io/upload_images/2648731-b0dba03319d11c9b.gif?imageMogr2/auto-orient/strip" alt="4.gif"></p>
<h3 id="Drag-transition-拖动过渡"><a href="#Drag-transition-拖动过渡" class="headerlink" title="Drag transition - 拖动过渡"></a>Drag transition - 拖动过渡</h3><p><img src="https://upload-images.jianshu.io/upload_images/2648731-5c123fca311978ea.gif?imageMogr2/auto-orient/strip" alt="5.gif"></p>
<h2 id="API-参考"><a href="#API-参考" class="headerlink" title="API 参考"></a>API 参考</h2><p>参见 <a href="MGSwipeTableCell/MGSwipeTableCell.h"><code>MGSwipeTableCell.h</code></a> 头文件查看有关该类功能的完整概述。<br>参见 <a href="demo/MailAppDemo"><code>MailAppDemo</code></a> 查看一个模仿 Apple 的邮件应用程序的完整项目（用 Objective-C 编写）。<br>参见 <a href="demo/MailAppDemoSwift"><code>MailAppDemoSwift</code></a> 查看一个模仿 Apple 的邮件应用程序的完整项目（用 Swift 编写）。<br>参见 <a href="demo/SpotifyDemo"><code>SpotifyDemo</code></a> 查看一个模仿 Spotify App 滑动样式的完整项目。<br>参见 <a href="demo/MGSwipeDemo"><code>MGSwipeDemo</code></a> 查看一个完整的项目示例，您可以在真实设备 / 模拟器上测试各种过渡。</p>
<h2 id="项目设置"><a href="#项目设置" class="headerlink" title="项目设置"></a>项目设置</h2><p>You can use CocoaPods to include MGSwipeTableCell into you project:</p>
<pre><code>pod &apos;MGSwipeTableCell&apos;
</code></pre><p>You can use Carthage to include MGSwipeTableCell into your project. Just add this dependency to your Cartfile:<br>​<br>​    github “MortimerGoro/MGSwipeTableCell”</p>
<h2 id="用法"><a href="#用法" class="headerlink" title="用法"></a>用法</h2><h3 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h3><p>在项目中集成 MGSwipeTableCell 非常简单。 基本上，你只需继承 MGSwipeTableCell 而不是 UITableViewCell，或直接使用 iOS 预定义单元格样式实例化 MGSwipeTableCell 实例。 你可以按照以前的方式布置单元格内容，MGSwipeTableCell 不会强制您更改布局。</p>
<p>以下是使用 iOS 预定义样式的 MGSwipeTableCell 的示例。 您可以将按钮数组设置为 cell.leftButtons 和 / 或 cell.rightButtons 属性。 MGSwipeButton 是一个便利类，你不必被迫使用它。 你可以使用自己的 UIButtons 或 UIViews。 你也可以使用 leftSwipeSettings 和 / 或 rightSwipeSettings 属性配置转场（和滑动阈值）</p>
<h5 id="Objective-C"><a href="#Objective-C" class="headerlink" title="Objective-C"></a>Objective-C</h5><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="built_in">UITableViewCell</span> *)tableView:(<span class="built_in">UITableView</span> *)tableView cellForRowAtIndexPath:(<span class="built_in">NSIndexPath</span> *)indexPath</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="built_in">NSString</span> * reuseIdentifier = <span class="string">@"programmaticCell"</span>;</span><br><span class="line">    MGSwipeTableCell * cell = [<span class="keyword">self</span>.tableView dequeueReusableCellWithIdentifier:reuseIdentifier];</span><br><span class="line">    <span class="keyword">if</span> (!cell) &#123;</span><br><span class="line">        cell = [[MGSwipeTableCell alloc] initWithStyle:<span class="built_in">UITableViewCellStyleSubtitle</span> reuseIdentifier:reuseIdentifier];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    cell.textLabel.text = <span class="string">@"Title"</span>;</span><br><span class="line">    cell.detailTextLabel.text = <span class="string">@"Detail text"</span>;</span><br><span class="line">    cell.delegate = <span class="keyword">self</span>; <span class="comment">//optional</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//配置左边按钮</span></span><br><span class="line">    cell.leftButtons = @[[MGSwipeButton buttonWithTitle:<span class="string">@""</span> icon:[<span class="built_in">UIImage</span> imageNamed:<span class="string">@"check.png"</span>] backgroundColor:[<span class="built_in">UIColor</span> greenColor]],</span><br><span class="line">                          [MGSwipeButton buttonWithTitle:<span class="string">@""</span> icon:[<span class="built_in">UIImage</span> imageNamed:<span class="string">@"fav.png"</span>] backgroundColor:[<span class="built_in">UIColor</span> blueColor]]];</span><br><span class="line">    <span class="comment">// 按钮过渡样式,3D转换</span></span><br><span class="line">    cell.leftSwipeSettings.transition = MGSwipeTransition3D;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//配置右边按钮</span></span><br><span class="line">    cell.rightButtons = @[[MGSwipeButton buttonWithTitle:<span class="string">@"Delete"</span> backgroundColor:[<span class="built_in">UIColor</span> redColor]],</span><br><span class="line">                           [MGSwipeButton buttonWithTitle:<span class="string">@"More"</span> backgroundColor:[<span class="built_in">UIColor</span> lightGrayColor]]];</span><br><span class="line">    cell.rightSwipeSettings.transition = MGSwipeTransition3D;</span><br><span class="line">    <span class="keyword">return</span> cell;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="Swift"><a href="#Swift" class="headerlink" title="Swift"></a>Swift</h5><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">tableView</span><span class="params">(<span class="number">_</span> tableView: UITableView, cellForRowAt indexPath: IndexPath)</span></span> -&gt; <span class="type">UITableViewCell</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">let</span> reuseIdentifier = <span class="string">"programmaticCell"</span></span><br><span class="line">    <span class="keyword">var</span> cell = tableView.dequeueReusableCell(withIdentifier: reuseIdentifier, <span class="keyword">for</span>: indexPath) <span class="keyword">as</span>! <span class="type">MGSwipeTableCell</span></span><br><span class="line"></span><br><span class="line">    cell.textLabel!.text = <span class="string">"Title"</span></span><br><span class="line">    cell.detailTextLabel!.text = <span class="string">"Detail text"</span></span><br><span class="line">    cell.delegate = <span class="keyword">self</span> <span class="comment">//optional</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//configure left buttons</span></span><br><span class="line">    cell.leftButtons = [<span class="type">MGSwipeButton</span>(title: <span class="string">""</span>, icon: <span class="type">UIImage</span>(named:<span class="string">"check.png"</span>), backgroundColor: .green),</span><br><span class="line">                        <span class="type">MGSwipeButton</span>(title: <span class="string">""</span>, icon: <span class="type">UIImage</span>(named:<span class="string">"fav.png"</span>), backgroundColor: .blue)]</span><br><span class="line">    cell.leftSwipeSettings.transition = .rotate3D</span><br><span class="line"></span><br><span class="line">    <span class="comment">//configure right buttons</span></span><br><span class="line">    cell.rightButtons = [<span class="type">MGSwipeButton</span>(title: <span class="string">"Delete"</span>, backgroundColor: .red),</span><br><span class="line">                         <span class="type">MGSwipeButton</span>(title: <span class="string">"More"</span>,backgroundColor: .lightGray)]</span><br><span class="line">    cell.rightSwipeSettings.transition = .rotate3D</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> cell</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>为了监听按钮点击事件，你可以实现可选的 MGSwipeTableCellDelegate 协议，或者如果您懒得这样做，MGSwipeButton 类也附带一个便捷 block 回调;）</p>
<h5 id="Objective-c"><a href="#Objective-c" class="headerlink" title="Objective-c"></a>Objective-c</h5><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 创建按钮时，同时设置 block 回调</span></span><br><span class="line">[MGSwipeButton buttonWithTitle:<span class="string">@"More"</span> backgroundColor:[<span class="built_in">UIColor</span> lightGrayColor] callback:^<span class="built_in">BOOL</span>(MGSwipeTableCell *sender) &#123;</span><br><span class="line">      <span class="built_in">NSLog</span>(<span class="string">@"Convenience callback for swipe buttons!"</span>);</span><br><span class="line">&#125;]</span><br></pre></td></tr></table></figure>
<h5 id="Swift-1"><a href="#Swift-1" class="headerlink" title="Swift"></a>Swift</h5><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">MGSwipeButton</span>(title: <span class="string">"Delete"</span>, backgroundColor: .red) &#123;</span><br><span class="line">      (sender: <span class="type">MGSwipeTableCell!</span>) -&gt; <span class="type">Bool</span> <span class="keyword">in</span></span><br><span class="line">      <span class="built_in">print</span>(<span class="string">"Convenience callback for swipe buttons!"</span>)</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<h3 id="Delegate-代理协议"><a href="#Delegate-代理协议" class="headerlink" title="Delegate - 代理协议"></a>Delegate - 代理协议</h3><p>MGSwipeTableCellDelegate 是一个可选的委托协议，用于配置滑动按钮或接收触发的操作或其他事件。 按钮可以在cell 被创建时内联配置，如果你不想使用此委托方法。但是使用委托可以提高内存使用率，因为按钮仅按需创建。</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">@protocol</span> <span class="title">MGSwipeTableCellDelegate</span> &lt;<span class="title">NSObject</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@optional</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Delegate method to enable/disable swipe gestures</span></span><br><span class="line"><span class="comment"> * 开关</span></span><br><span class="line"><span class="comment"> * @return YES if swipe is allowed</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line">-(<span class="built_in">BOOL</span>) swipeTableCell:(MGSwipeTableCell*) cell canSwipe:(MGSwipeDirection) direction;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Delegate method invoked when the current swipe state changes</span></span><br><span class="line"><span class="comment"> * 当前滑动状态更改时调用的 Delegate 方法</span></span><br><span class="line"><span class="comment"> @param state the current Swipe State</span></span><br><span class="line"><span class="comment"> @param gestureIsActive YES if the user swipe gesture is active. No if the uses has already ended the gesture</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line">-(<span class="keyword">void</span>) swipeTableCell:(MGSwipeTableCell*) cell didChangeSwipeState:(MGSwipeState) state gestureIsActive:(<span class="built_in">BOOL</span>) gestureIsActive;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Called when the user clicks a swipe button or when a expandable button is automatically triggered</span></span><br><span class="line"><span class="comment"> * 当用户单击滑动按钮或自动触发可展开按钮时调用</span></span><br><span class="line"><span class="comment"> * @return YES to autohide the current swipe buttons</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line">-(<span class="built_in">BOOL</span>) swipeTableCell:(MGSwipeTableCell*) cell tappedButtonAtIndex:(<span class="built_in">NSInteger</span>) index direction:(MGSwipeDirection)direction fromExpansion:(<span class="built_in">BOOL</span>) fromExpansion;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Delegate method to setup the swipe buttons and swipe/expansion settings</span></span><br><span class="line"><span class="comment"> * 配置按钮协议方法</span></span><br><span class="line"><span class="comment"> * Buttons can be any kind of UIView but it's recommended to use the convenience MGSwipeButton class</span></span><br><span class="line"><span class="comment"> * Setting up buttons with this delegate instead of using cell properties improves memory usage because buttons are only created in demand</span></span><br><span class="line"><span class="comment"> * @param swipeTableCell the UITableViewCell to configure. You can get the indexPath using [tableView indexPathForCell:cell]</span></span><br><span class="line"><span class="comment"> * @param direction The swipe direction (left to right or right to left)</span></span><br><span class="line"><span class="comment"> * @param swipeSettings instance to configure the swipe transition and setting (optional)</span></span><br><span class="line"><span class="comment"> * @param expansionSettings instance to configure button expansions (optional)</span></span><br><span class="line"><span class="comment"> * @return Buttons array</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line">-(<span class="built_in">NSArray</span>*) swipeTableCell:(MGSwipeTableCell*) cell swipeButtonsForDirection:(MGSwipeDirection)direction</span><br><span class="line">             swipeSettings:(MGSwipeSettings*) swipeSettings expansionSettings:(MGSwipeExpansionSettings*) expansionSettings;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h3 id="Expandable-buttons-可扩展按钮"><a href="#Expandable-buttons-可扩展按钮" class="headerlink" title="Expandable buttons - 可扩展按钮"></a>Expandable buttons - 可扩展按钮</h3><p>默认情况下，按钮不可扩展。 你可以使用 cell.leftExpansion 和 cell.rightExpansion 属性设置可扩展按钮</p>
<p>当用户结束滑动手势并且扩展处于活动状态时（可通过阈值配置），将自动触发可扩展按钮事件。 触发的可扩展按钮可以弹回到其初始位置或填充整个 UITableViewCell，您可以使用 fillOnTrigger 属性选择所需的动画。</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">MGSwipeExpansionSettings</span>: <span class="title">NSObject</span></span></span><br><span class="line"><span class="comment">/** index of the expandable button (in the left or right buttons arrays) */</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">assign</span>) <span class="built_in">NSInteger</span> buttonIndex;</span><br><span class="line"><span class="comment">/** if true the button fills the cell on trigger, else it bounces back to its initial position */</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">assign</span>) <span class="built_in">BOOL</span> fillOnTrigger;</span><br><span class="line"><span class="comment">/** Size proportional threshold to trigger the expansion button. Default value 1.5 */</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">assign</span>) <span class="built_in">CGFloat</span> threshold;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h3 id="Rounded-corners-and-swipe-buttons-圆角和滑动按钮"><a href="#Rounded-corners-and-swipe-buttons-圆角和滑动按钮" class="headerlink" title="Rounded corners and swipe buttons - 圆角和滑动按钮"></a>Rounded corners and swipe buttons - 圆角和滑动按钮</h3><p>MGSwipeTableCell 支持圆角。 例：</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">cell.layer.cornerRadius = <span class="number">50</span></span><br><span class="line">cell.backgroundColor = <span class="built_in">UIColor</span>.gray</span><br><span class="line">cell.clipsToBounds = <span class="literal">true</span></span><br><span class="line">cell.swipeBackgroundColor = <span class="built_in">UIColor</span>.gray</span><br></pre></td></tr></table></figure>
<p><img src="http://upload-images.jianshu.io/upload_images/2648731-36ea5c3bd3daba49.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="RoundTableViewCell"></p>
<h2 id="License-许可证"><a href="#License-许可证" class="headerlink" title="License - 许可证"></a>License - 许可证</h2><p>The MIT License (MIT)</p>
<p>Copyright (c) 2014 Imanol Fernandez @MortimerGoro</p>
<p>Permission is hereby granted, free of charge, to any person obtaining a copy<br>of this software and associated documentation files (the “Software”), to deal<br>in the Software without restriction, including without limitation the rights<br>to use, copy, modify, merge, publish, distribute, sublicense, and/or sell<br>copies of the Software, and to permit persons to whom the Software is<br>furnished to do so, subject to the following conditions:</p>
<p>The above copyright notice and this permission notice shall be included in all<br>copies or substantial portions of the Software.</p>
<p>THE SOFTWARE IS PROVIDED “AS IS”, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR<br>IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,<br>FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE<br>AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER<br>LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,<br>OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE<br>SOFTWARE.</p>
<h3 id="示例代码"><a href="#示例代码" class="headerlink" title="示例代码"></a>示例代码</h3><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#pragma mark - MGSwipeTableCellDelegate</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Delegate method to setup the swipe buttons and swipe/expansion settings</span></span><br><span class="line"><span class="comment"> * Buttons can be any kind of UIView but it's recommended to use the convenience MGSwipeButton class</span></span><br><span class="line"><span class="comment"> * Setting up buttons with this delegate instead of using cell properties improves memory usage because buttons are only created in demand</span></span><br><span class="line"><span class="comment"> * @param cell the UITableViewCell to configure. You can get the indexPath using [tableView indexPathForCell:cell]</span></span><br><span class="line"><span class="comment"> * @param direction The swipe direction (left to right or right to left)</span></span><br><span class="line"><span class="comment"> * @param swipeSettings instance to configure the swipe transition and setting (optional)</span></span><br><span class="line"><span class="comment"> * @param expansionSettings instance to configure button expansions (optional)</span></span><br><span class="line"><span class="comment"> * @return Buttons array</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line">-(<span class="keyword">nullable</span> <span class="built_in">NSArray</span>&lt;<span class="built_in">UIView</span>*&gt;*) swipeTableCell:(<span class="keyword">nonnull</span> MGSwipeTableCell*) cell swipeButtonsForDirection:(MGSwipeDirection)direction</span><br><span class="line">                               swipeSettings:(<span class="keyword">nonnull</span> MGSwipeSettings*) swipeSettings expansionSettings:(<span class="keyword">nonnull</span> MGSwipeExpansionSettings*) expansionSettings &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (direction == MGSwipeDirectionRightToLeft) &#123;</span><br><span class="line">        <span class="comment">// MGSwipeSettings 按钮设置</span></span><br><span class="line">        swipeSettings.transition = MGSwipeTransitionBorder;</span><br><span class="line">        swipeSettings.threshold = <span class="number">1.5</span>; <span class="comment">// 工具按钮被显示出来的阈值 （手势拉伸的长度/按钮自身宽度）</span></span><br><span class="line">        swipeSettings.keepButtonsSwiped = <span class="literal">YES</span>; <span class="comment">// 手势停止时，按钮是否自动隐藏</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">// MGSwipeExpansionSettings 拉伸设置</span></span><br><span class="line">        expansionSettings.buttonIndex = <span class="number">0</span>; <span class="comment">// 被拉伸的按钮索引</span></span><br><span class="line">        expansionSettings.fillOnTrigger = <span class="literal">NO</span>; <span class="comment">// 拉伸时是否填充整个 cell</span></span><br><span class="line">        expansionSettings.threshold = <span class="number">2.0</span>; <span class="comment">// 拉伸动作被触发的阈值（与按钮的宽度相关）</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 删除按钮</span></span><br><span class="line">        <span class="built_in">CGFloat</span> padding = <span class="number">20</span>; <span class="comment">// 按钮右侧 - contentView 右侧边距</span></span><br><span class="line">        MGSwipeButton *trashButton = [MGSwipeButton buttonWithTitle:<span class="string">@""</span> icon:[<span class="built_in">UIImage</span> imageNamed:<span class="string">@"trash"</span>] backgroundColor:[<span class="built_in">UIColor</span> clearColor] padding:padding];</span><br><span class="line">        <span class="keyword">return</span> @[trashButton];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">nil</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 当用户单击滑动按钮或可展开按钮被自动自动触发时调用</span></span><br><span class="line"><span class="comment"> * Called when the user clicks a swipe button or when a expandable button is automatically triggered</span></span><br><span class="line"><span class="comment"> * @return YES to autohide the current swipe buttons</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line">-(<span class="built_in">BOOL</span>) swipeTableCell:(<span class="keyword">nonnull</span> MGSwipeTableCell*) cell tappedButtonAtIndex:(<span class="built_in">NSInteger</span>) index direction:(MGSwipeDirection)direction fromExpansion:(<span class="built_in">BOOL</span>) fromExpansion &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 删除按钮触发事件</span></span><br><span class="line">    <span class="keyword">if</span> (direction == MGSwipeDirectionRightToLeft &amp;&amp; index == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="comment">// 这里直接删除，业务层还需要做删除前的提示和判断的！！！</span></span><br><span class="line">        <span class="built_in">NSIndexPath</span> *indexPath = [<span class="keyword">self</span>.tableView indexPathForCell:cell];</span><br><span class="line">        [<span class="keyword">self</span>.dataSourceArray removeObjectAtIndex:indexPath.row];</span><br><span class="line">        [<span class="keyword">self</span>.tableView deleteRowAtIndexPath:indexPath withRowAnimation:<span class="built_in">UITableViewRowAnimationLeft</span>];</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">NO</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">YES</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h3><ul>
<li><a href="https://github.com/CEWendel/SWTableViewCell" target="_blank" rel="noopener">GitHub：SWTableViewCell</a> ⭐️ 7000+，但是这个库好像很久没有更新了（最后更新是4年前。。。）</li>
<li><a href="https://github.com/MortimerGoro/MGSwipeTableCell" target="_blank" rel="noopener">GitHub：MGSwipeTableCell</a> ⭐️6500+</li>
</ul>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/2/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><a class="page-number" href="/page/2/">2</a><span class="page-number current">3</span><a class="page-number" href="/page/4/">4</a><span class="space">&hellip;</span><a class="page-number" href="/page/32/">32</a><a class="extend next" rel="next" href="/page/4/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <div class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image" src="https://ws1.sinaimg.cn/large/006tNc79gy1g22m14458rj30u014xu0x.jpg" alt="独木舟的木">
            
              <p class="site-author-name" itemprop="name">独木舟的木</p>
              <div class="site-description motion-element" itemprop="description">有时候阳光很好 有时候阳光很暗</div>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/">
                
                    <span class="site-state-item-count">311</span>
                    <span class="site-state-item-name">日志</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-categories">
                  
                    
                      <a href="/categories/">
                    
                  
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">15</span>
                    <span class="site-state-item-name">分类</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-tags">
                  
                    
                      <a href="/tags/">
                    
                  
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">74</span>
                    <span class="site-state-item-name">标签</span>
                  </a>
                </div>
              
            </nav>
          

          
            <div class="feed-link motion-element">
              <a href="/atom.xml" rel="alternate">
                <i class="fa fa-rss"></i>
                RSS
              </a>
            </div>
          

          

          
            <div class="links-of-author motion-element">
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                    
                  
                  <a href="https://github.com/Andy0570" title="GitHub &rarr; https://github.com/Andy0570" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i>GitHub</a>
                </span>
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                    
                  
                  <a href="mailto:andywhm@163.com" title="E-Mail &rarr; mailto:andywhm@163.com" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                </span>
              
            </div>
          

          
             <div class="cc-license motion-element" itemprop="license">
              
              
                
              
              
              
              <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" class="cc-opacity" rel="noopener" target="_blank"><img src="/images/cc-by-nc-sa.svg" alt="Creative Commons"></a>
             </div>
          

          
          

          
            
          
          

        </div>
      </div>

      

      

    </div>
  </aside>
  


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">独木舟的木</span>

  

  
</div>


  <div class="powered-by">由 <a href="https://hexo.io" class="theme-link" rel="noopener" target="_blank">Hexo</a> 强力驱动 v3.8.0</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 – <a href="https://theme-next.org" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> v7.1.0</div>




        








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

    

    
  </div>

  

<script>
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>





  



  






  



  
    
    
      
    
  
  <script color="17,119,176" opacity="0.5" zindex="-1" count="99" src="//cdn.jsdelivr.net/gh/theme-next/theme-next-canvas-nest@1/canvas-nest.min.js"></script>













  
  <script src="//cdn.jsdelivr.net/npm/jquery@2/dist/jquery.min.js"></script>

  
  <script src="//cdn.jsdelivr.net/npm/fastclick@1/lib/fastclick.min.js"></script>

  
  <script src="//cdn.jsdelivr.net/npm/jquery-lazyload@1/jquery.lazyload.min.js"></script>

  
  <script src="//cdn.jsdelivr.net/npm/velocity-animate@1/velocity.min.js"></script>

  
  <script src="//cdn.jsdelivr.net/npm/velocity-animate@1/velocity.ui.min.js"></script>

  
  <script src="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.js"></script>


  


  <script src="/js/utils.js?v=7.1.0"></script>

  <script src="/js/motion.js?v=7.1.0"></script>



  
  


  <script src="/js/affix.js?v=7.1.0"></script>

  <script src="/js/schemes/pisces.js?v=7.1.0"></script>




  

  


  <script src="/js/next-boot.js?v=7.1.0"></script>


  

  

  
  
  
    
  

  
    
      
    
  

  
  
  
    <script src="//cdn.jsdelivr.net/npm/quicklink@1/dist/quicklink.umd.js"></script>
    <script>
      
        window.addEventListener('load', () => {
      
        quicklink({
          timeout: 3000,
          priority: true,
          ignores: [uri => uri.includes('#'),uri => uri == 'https://andy0570.com/page/3/',]
        });
      
        });
      
    </script>
  


  



  



  
  
  
    
  
  <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/instantsearch.js@2/dist/instantsearch.min.css">

  
  
    
  
  <script src="//cdn.jsdelivr.net/npm/instantsearch.js@2/dist/instantsearch.js"></script>
  

  <script src="/js/algolia-search.js?v=7.1.0"></script>



  
  
  <script>
    
    function showTime(Counter) {
      var entries = [];
      var $visitors = $('.leancloud_visitors');

      $visitors.each(function() {
        entries.push( $(this).attr('id').trim() );
      });

      Counter('get', '/classes/Counter', { where: JSON.stringify({ url: { '$in': entries } }) })
        .done(function({ results }) {
          var COUNT_CONTAINER_REF = '.leancloud-visitors-count';

          if (results.length === 0) {
            $visitors.find(COUNT_CONTAINER_REF).text(0);
            return;
          }

          for (var i = 0; i < results.length; i++) {
            var item = results[i];
            var url = item.url;
            var time = item.time;
            var element = document.getElementById(url);

            $(element).find(COUNT_CONTAINER_REF).text(time);
          }
          for (var i = 0; i < entries.length; i++) {
            var url = entries[i];
            var element = document.getElementById(url);
            var countSpan = $(element).find(COUNT_CONTAINER_REF);
            if (countSpan.text() == '') {
              countSpan.text(0);
            }
          }
        })
        .fail(function ({ responseJSON }) {
          console.log('LeanCloud Counter Error: ' + responseJSON.code + ' ' + responseJSON.error);
        });
    }
    

    $(function() {
      $.get('https://app-router.leancloud.cn/2/route?appId=' + 'S7i1Y8YorMKFPaYbJbekD5el-gzGzoHsz')
        .done(function({ api_server }) {
          var Counter = function(method, url, data) {
            return $.ajax({
              method: method,
              url: 'https://' + api_server + '/1.1' + url,
              headers: {
                'X-LC-Id': 'S7i1Y8YorMKFPaYbJbekD5el-gzGzoHsz',
                'X-LC-Key': 'brOnU8mOQvSjpipJvdKUAIbU',
                'Content-Type': 'application/json',
              },
              data: data
            });
          };
          
            if ($('.post-title-link').length >= 1) {
              showTime(Counter);
            }
          
        });
    });
  </script>



  

  

  

  

  

  

  

  

  
  
  
    
  
  <script src="//cdn.jsdelivr.net/npm/pangu@4/dist/browser/pangu.min.js"></script>
  <script>pangu.spacingPage();</script>


  
  
  
    
  
  <script src="//cdn.jsdelivr.net/gh/theme-next/theme-next-bookmark@1/bookmark.min.js"></script>
  <script>
  
    bookmark.loadBookmark();
  
  </script>


  

  

  


  <!-- red heart -->
  <script type="text/javascript" src="/js/src/love.js"></script>
  
</body>
</html>
