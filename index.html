<!DOCTYPE html>












  


<html class="theme-next gemini use-motion" lang="zh-CN">
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">




  
  
    
      
    
    
      
    
  <script src="//cdn.jsdelivr.net/npm/pace-js@1/pace.min.js"></script>
  <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/pace-js@1/themes/blue/pace-theme-minimal.css">



  
  
    
  
  <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/han-css@3/dist/han.min.css">













  
  
    
  
  <link rel="stylesheet" href="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.css">







  

<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/font-awesome@4/css/font-awesome.min.css">

<link rel="stylesheet" href="/css/main.css?v=7.1.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/panda/apple-touch-icon.png?v=7.1.0">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/panda/favicon-32x32.png?v=7.1.0">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/panda/favicon-16x16.png?v=7.1.0">


  <link rel="mask-icon" href="/images/panda/safari-pinned-tab.svg?v=7.1.0" color="#222">


  <link rel="manifest" href="/images/panda/site.webmanifest">


  <meta name="msapplication-config" content="/images/panda/browserconfig.xml">





<script id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '7.1.0',
    sidebar: {"position":"left","display":"post","offset":12,"onmobile":false,"dimmer":false},
    back2top: true,
    back2top_sidebar: false,
    fancybox: true,
    fastclick: true,
    lazyload: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  <meta name="description" content="有时候阳光很好 有时候阳光很暗">
<meta name="keywords" content="独木舟的木">
<meta property="og:type" content="website">
<meta property="og:title" content="独木舟的木">
<meta property="og:url" content="https://andy0570.com/index.html">
<meta property="og:site_name" content="独木舟的木">
<meta property="og:description" content="有时候阳光很好 有时候阳光很暗">
<meta property="og:locale" content="zh-CN">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="独木舟的木">
<meta name="twitter:description" content="有时候阳光很好 有时候阳光很暗">



  <link rel="alternate" href="/atom.xml" title="独木舟的木" type="application/atom+xml">



  
  
  <link rel="canonical" href="https://andy0570.com/">



<script id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>独木舟的木</title>
  






  <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?8229a094facca297f211d61323fd9fde";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>







  <noscript>
  <style>
  .use-motion .motion-element,
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-title { opacity: initial; }

  .use-motion .logo,
  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-CN">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <a href="https://github.com/andy0570" class="github-corner" aria-label="View source on GitHub"><svg width="80" height="80" viewbox="0 0 250 250" style="fill:#151513; color:#fff; position: absolute; top: 0; border: 0; right: 0;" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"/><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"/><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"/></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style>
    
    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">独木舟的木</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
      
        <p class="site-subtitle">iOS Developer</p>
      
    
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="切换导航栏">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home menu-item-active">

    
    
    
      
    

    
      
    

    <a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i> <br>首页</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-categories">

    
    
    
      
    

    
      
    

    <a href="/categories/" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i> <br>分类<span class="badge">1</span></a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-tags">

    
    
    
      
    

    
      
    

    <a href="/tags/" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i> <br>标签<span class="badge">2</span></a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">

    
    
    
      
    

    
      
    

    <a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i> <br>归档<span class="badge">10</span></a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-about">

    
    
    
      
    

    
      
    

    <a href="/about/" rel="section"><i class="menu-item-icon fa fa-fw fa-user"></i> <br>关于</a>

  </li>

      
      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br>搜索</a>
        </li>
      
    </ul>
  

  

  
    <div class="site-search">
      
  
  <div class="algolia-popup popup search-popup">
    <div class="algolia-search">
      <div class="algolia-search-input-icon">
        <i class="fa fa-search"></i>
      </div>
      <div class="algolia-search-input" id="algolia-search-input"></div>
    </div>

    <div class="algolia-results">
      <div id="algolia-stats"></div>
      <div id="algolia-hits"></div>
      <div id="algolia-pagination" class="algolia-pagination"></div>
    </div>

    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
  </div>




    </div>
  
</nav>



  



</div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
            

          
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://andy0570.com/2019/04/12/OpenLDAP/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="独木舟的木">
      <meta itemprop="description" content="有时候阳光很好 有时候阳光很暗">
      <meta itemprop="image" content="https://ws1.sinaimg.cn/large/006tNc79gy1g22m14458rj30u014xu0x.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="独木舟的木">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/04/12/OpenLDAP/" class="post-title-link" itemprop="url">未命名</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2019-04-12 02:04:06" itemprop="dateCreated datePublished" datetime="2019-04-12T02:04:06+08:00">2019-04-12</time>
            

            
          </span>

          

          
            
            
          

          
          
            <span id="/2019/04/12/OpenLDAP/" class="leancloud_visitors" data-flag-title>
              <span class="post-meta-divider">|</span>
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              
                <span class="post-meta-item-text">阅读次数：</span>
              
                <span class="leancloud-visitors-count"></span>
            </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body han-init-context" itemprop="articleBody">

      
      

      
        
          
            <h1 id="OpenLDAP"><a href="#OpenLDAP" class="headerlink" title="OpenLDAP"></a>OpenLDAP</h1><ul>
<li><a href="https://wiki.archlinux.org/index.php/OpenLDAP_(%E7%AE%80%E4%BD%93%E4%B8%AD%E6%96%87" target="_blank" rel="noopener">openLDAP（简体中文）</a>)</li>
</ul>
<h1 id="Docker-OpenLDAP"><a href="#Docker-OpenLDAP" class="headerlink" title="Docker-OpenLDAP"></a>Docker-OpenLDAP</h1><ul>
<li><a href="https://github.com/osixia/docker-openldap" target="_blank" rel="noopener">GitHub: osixia/docker-openldap</a></li>
<li><a href="https://github.com/osixia/docker-phpLDAPadmin" target="_blank" rel="noopener">GitHub:osixia/docker-phpLDAPadmin</a></li>
</ul>
<h1 id="OpenLDAP-1"><a href="#OpenLDAP-1" class="headerlink" title="OpenLDAP"></a>OpenLDAP</h1><ul>
<li><a href="https://www.howtoing.com/how-to-install-and-configure-openldap-and-phpldapadmin-on-ubuntu-16-04" target="_blank" rel="noopener">如何在 Ubuntu 16.04 上安装和配置 OpenLDAP 和 phpLDAPadmins</a></li>
<li><a href="https://www.howtoing.com/how-to-install-and-configure-a-basic-ldap-server-on-an-ubuntu-12-04-vps/#add-organizational-units-groups-and-users" target="_blank" rel="noopener">如何在 Ubuntu 12.04 VPS 上安装和配置基本 LDAP 服务器</a>—— 在 phpLDAPadmin 上添加组织单位，组和用户</li>
<li><a href="https://www.howtoing.com/how-to-secure-apache-with-let-s-encrypt-on-ubuntu-16-04/" target="_blank" rel="noopener">如何在 Ubuntu 16.04 使用安全加密的 Apache</a></li>
<li><a href="https://mp.weixin.qq.com/s/k7Gda7CWmI38dF4ZJ-BPVA" target="_blank" rel="noopener">OpenLDAP 管理工具 Phpldapadmin 的安装及使用</a></li>
<li><a href="https://mp.weixin.qq.com/s/pnSmdhy74_HJN6LC7-BPkQ" target="_blank" rel="noopener">一键添加 OpenLDAP 用户及 Kerberos 账号</a></li>
<li><a href="https://www.jb51.net/article/115258.htm" target="_blank" rel="noopener">ubuntu 临时或永久修改 hostname 的方法</a></li>
<li><a href="http://blog.51cto.com/jiangche00/1925454" target="_blank" rel="noopener">51cto: Ubuntu 系统下 OpenLDAP 的安装及配置</a></li>
<li><a href="https://www.cnblogs.com/kungfupanda/p/4704421.html" target="_blank" rel="noopener">ubuntu 12.04 下安装 openldap，slapd.conf 找不到的解决方法</a></li>
<li><a href="https://segmentfault.com/a/1190000014683418" target="_blank" rel="noopener">我花了一个五一终于搞懂了 OpenLDAP</a></li>
</ul>
<p>轻量级目录访问协议（Lightweight Directory Access Protocol，LDAP）是用于通过网络管理和访问分层目录信息的标准协议。 它可以用于存储任何类型的信息，尽管它通常用作集中式身份验证系统或公司电子邮件和电话目录。</p>
<p>OpenLDAP 是 LDAP 协议的一个开源实现。LDAP 服务器本质上是一个为只读访问而优化的非关系型数据库。它主要用作地址簿查询（如 email 客户端）或对各种服务访问做后台认证以及用户数据权限管控。（例如，访问 Samba 时，LDAP 可以起到域控制器的作用；或者 <a href="https://wiki.archlinux.org/index.php/LDAP_authentication" target="_blank" rel="noopener">Linux 系统认证</a> 时代替 <code>/etc/passwd</code> 的作用。）</p>
<blockquote>
<p>⚠️ <strong>注意:</strong></p>
<p>以 <code>slap</code> 开头的命令（如： <code>slapcat</code> <code>slapcat</code>）是<strong>服务端</strong>工具。</p>
<p>以 <code>ldap</code> 开头的命令（如： <code>ldapsearch</code>）是<strong>客户端</strong>工具;</p>
</blockquote>
<h3 id="第一步：安装和配置-OpenLDAP-服务器"><a href="#第一步：安装和配置-OpenLDAP-服务器" class="headerlink" title="第一步：安装和配置 OpenLDAP 服务器"></a>第一步：安装和配置 OpenLDAP 服务器</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> 安装 OpenLDAP:</span><br><span class="line"><span class="meta">#</span> slapd:OpenLDAP 服务端程序组件。</span><br><span class="line"><span class="meta">#</span> ldap-utils:OpenLDAP 命令行工具集。</span><br><span class="line"><span class="meta">$</span> sudo apt-get update</span><br><span class="line"><span class="meta">$</span> sudo apt-get install -y slapd ldap-utils</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> 重新配置</span><br><span class="line"><span class="meta">$</span> sudo dpkg-reconfigure slapd</span><br><span class="line">Domain Name:arling.com</span><br><span class="line">Organization Name:tonintech</span><br><span class="line">Password:paradise</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> 打开防火墙LDAP端口（389、636）</span><br><span class="line"><span class="meta">$</span> sudo ufw allow ldap</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> LDAP进程 slapd 生命周期管理</span><br><span class="line"><span class="meta">$</span> sudo service slapd start   # 开启</span><br><span class="line"><span class="meta">$</span> sudo serviec slapd stop    # 关闭</span><br><span class="line"><span class="meta">$</span> sudo service slapd restart # 重启</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> 获取 OpenLDAP 默认监听的端口</span><br><span class="line"><span class="meta">$</span> doc</span><br><span class="line">tcp        0      0 0.0.0.0:389             0.0.0.0:*               LISTEN      25135/slapd</span><br><span class="line">tcp6       0      0 :::389                  :::*                    LISTEN      25135/slapd</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> 获取 OpenLDAP 进程的状态</span><br><span class="line"><span class="meta">$</span> ps aux | grep slapd | grep -v grep</span><br><span class="line">openldap 25135  0.0  0.0 1249408 7068 ?        Ssl  03:06   0:00 /usr/sbin/slapd -h ldap:/// ldapi:/// -g openldap -u openldap -F /etc/ldap/slapd.d</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> 测试与 ldapwhoami 的 LDAP 连接</span><br><span class="line"><span class="meta">$</span> ldapwhoami -H ldap://18.217.226.78 -x</span><br><span class="line">anonymous</span><br></pre></td></tr></table></figure>
<h4 id="LDAP-配置文件"><a href="#LDAP-配置文件" class="headerlink" title="LDAP 配置文件"></a>LDAP 配置文件</h4><ul>
<li>通过 apt-get 命名安装 OpenLDAP 后，配置文件路径为：<code>/etc/ldap</code></li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">/etc/ldap$ ls -l</span><br><span class="line">total 16</span><br><span class="line">-rw-r--r-- 1 root     root      332 May 24 21:06 ldap.conf # 客户端配置文件</span><br><span class="line">drwxr-xr-x 2 root     root     4096 May 24 21:06 sasl2</span><br><span class="line">drwxr-xr-x 2 root     root     4096 Sep 14 09:32 schema</span><br><span class="line">drwxr-xr-x 3 openldap openldap 4096 Sep 17 08:27 slapd.d # 服务端配置文件</span><br></pre></td></tr></table></figure>
<blockquote>
<p>⚠️</p>
<ul>
<li>从 OpenLDAP 2.4 版本开始所有配置数据都保存在 <code>/etc/openldap/slapd.d/</code>中，建议不再使用 <code>slapd.conf</code> 作为配置文件。</li>
<li>配置 OpenLDAP 最正确的姿势是通过<code>ldapmodify</code>命令执行<strong>一系列自己写好的</strong> ldif 文件，而<strong>不要修改任何 OpenLDAP 装好的配置文件</strong>。</li>
</ul>
</blockquote>
<h3 id="第二步：安装和配置-phpLDAPadmin-Web-页面"><a href="#第二步：安装和配置-phpLDAPadmin-Web-页面" class="headerlink" title="第二步：安装和配置 phpLDAPadmin Web 页面"></a>第二步：安装和配置 phpLDAPadmin Web 页面</h3><p>安装 phpLDAPadmin：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span> sudo apt-get install phpldapadmin</span><br></pre></td></tr></table></figure>
<p>修改 phpLDAPadmin 配置文件 <code>/etc/phpldapadmin/config.php</code>：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span> sudo vim /etc/phpldapadmin/config.php</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> ------ 配置内容如下 ------</span><br><span class="line"><span class="meta">#</span> 1.LDAP 服务器名称</span><br><span class="line"><span class="meta">$</span>servers-&gt;setValue('server','name','My LDAP Server'); </span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> 2.phpLDAPadmin LDAP 层次结构的根目录</span><br><span class="line"><span class="meta">$</span>servers-&gt;setValue('server','base',array('dc=arling,dc=com')); </span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> 3.注释掉登录bind_id配置行</span><br><span class="line"><span class="meta">#</span>$servers-&gt;setValue('login','bind_id','cn=admin,dc=example,dc=com');</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> 命令行模式下搜索：/hide_template_warning</span><br><span class="line"><span class="meta">#</span> 4.隐藏 phpLDAPadmin 警告消息</span><br><span class="line"><span class="meta">$</span>config-&gt;custom-&gt;appearance['hide_template_warning'] = true;</span><br></pre></td></tr></table></figure>
<p>关闭 Apache2 服务</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span> sudo /etc/init.d/apache2 stop</span><br></pre></td></tr></table></figure>
<h3 id="第三步：登录到-phpLDAPadmin-Web-页面："><a href="#第三步：登录到-phpLDAPadmin-Web-页面：" class="headerlink" title="第三步：登录到 phpLDAPadmin Web 页面："></a>第三步：登录到 phpLDAPadmin Web 页面：</h3><p>登录到 phpLDAPadmin 界面，添加用户，组织单位，组和关系。参考：<a href="https://www.howtoing.com/how-to-install-and-configure-a-basic-ldap-server-on-an-ubuntu-12-04-vps/#add-organizational-units-groups-and-users" target="_blank" rel="noopener">添加组织单位，组和用户</a></p>
<ul>
<li><a href="http://18.217.226.78/phpldapadmin/index.php" target="_blank" rel="noopener">http://18.217.226.78/phpldapadmin/index.php</a></li>
<li>Login DN:cn=admin,dc=arling,dc=com</li>
<li>Password:paradise</li>
</ul>
<p>​    <img src="https://ws4.sinaimg.cn/large/006tNbRwly1fvdttyt7itj30hs0ms78u.jpg" alt></p>
<p>​    1. 添加组织：Generic: Organisational Unit</p>
<p>​    2. 添加组：Generic: Posix Group</p>
<p>​    3. 添加用户：Generic: User Account</p>
<h3 id="第四步：配置-StartTLS-LDAP-加密"><a href="#第四步：配置-StartTLS-LDAP-加密" class="headerlink" title="第四步：配置 StartTLS LDAP 加密"></a>第四步：配置 StartTLS LDAP 加密</h3>
          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://andy0570.com/2018/12/17/Web-开发的身份数据和安全（三）——身份安全基础/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="独木舟的木">
      <meta itemprop="description" content="有时候阳光很好 有时候阳光很暗">
      <meta itemprop="image" content="https://ws1.sinaimg.cn/large/006tNc79gy1g22m14458rj30u014xu0x.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="独木舟的木">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2018/12/17/Web-开发的身份数据和安全（三）——身份安全基础/" class="post-title-link" itemprop="url">Web-开发的身份数据和安全（三）——身份安全基础</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2018-12-17 22:11:00" itemprop="dateCreated datePublished" datetime="2018-12-17T22:11:00+08:00">2018-12-17</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2019-04-15 17:54:46" itemprop="dateModified" datetime="2019-04-15T17:54:46+08:00">2019-04-15</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/PKI-密码学/" itemprop="url" rel="index"><span itemprop="name">PKI&密码学</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          
            <span id="/2018/12/17/Web-开发的身份数据和安全（三）——身份安全基础/" class="leancloud_visitors" data-flag-title="Web-开发的身份数据和安全（三）——身份安全基础">
              <span class="post-meta-divider">|</span>
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              
                <span class="post-meta-item-text">阅读次数：</span>
              
                <span class="leancloud-visitors-count"></span>
            </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body han-init-context" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>在不同场合下如何验证和授权。</p>
</blockquote>
<h2 id="理解不同的身份类型"><a href="#理解不同的身份类型" class="headerlink" title="理解不同的身份类型"></a>理解不同的身份类型</h2><p><strong>身份</strong>：把个人和组织区分开的品性、信条等。——韦氏词典</p>
<p>根据网站的用途，身份可以分为：</p>
<ol>
<li>社会身份；</li>
<li>实际身份；</li>
<li>弱身份；</li>
</ol>
<p><img src="http://upload-images.jianshu.io/upload_images/2648731-2ac5642f4e86d4f8.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="不同身份之间的重叠"></p>
<h3 id="1-社会身份"><a href="#1-社会身份" class="headerlink" title="1. 社会身份"></a>1. 社会身份</h3><p>人们随意分享的身份，真实性有限。主要内容：社交网络、社会联系、兴趣和爱好。</p>
<h3 id="2-实际身份"><a href="#2-实际身份" class="headerlink" title="2. 实际身份"></a>2. 实际身份</h3><p>真实的个人资料。如网银和电商中的电子邮箱、地址、电话号码、语言、年龄等。</p>
<p>选举和其他很多政府服务也通常使用实际身份。</p>
<h3 id="3-弱身份"><a href="#3-弱身份" class="headerlink" title="3. 弱身份"></a>3. 弱身份</h3><p>验证用户身份时不访问任何个人资料。如：如通过短信给手机发送一次性密码实现无密码登录。</p>
<h3 id="利用身份提升用户体验"><a href="#利用身份提升用户体验" class="headerlink" title="利用身份提升用户体验"></a>利用身份提升用户体验</h3><p>刚接触用户时没有必要让他们登录（有损用户转化率），而是提供功能预览，帮助用户决定是否要使用应用。</p>
<h3 id="信任区简介"><a href="#信任区简介" class="headerlink" title="信任区简介"></a>信任区简介</h3><p>如今，我们使用的设备都预装了各种传感器，通过这些传感器可以收集用户所处环境的信息。GPS、WiFi、摄像头、加速计、陀螺仪、光线传感器等可用于构建用户的个人资料，然后据此认证用户的身份。把这个概念与身份结合起来，我们不仅可以认证用户的身份，还能构建起<strong>信任区</strong>。</p>
<p><img src="http://upload-images.jianshu.io/upload_images/2648731-815fc6f737a66d28.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="信任区"></p>
<ul>
<li>使用可用且独特的数据（例如用户的浏览器配置、硬件、设备、位置等信息）为用户创建数字指纹。</li>
<li>GPS 坐标、手机摄像头、指纹识别、声纹识别、可穿戴设备。</li>
<li>通过用户使用的系统和设备能收集足够的信息基本上确认用户就是他声称的那个人➡用户处在信任区中，减少用户再提供身份信任凭据的步骤。</li>
</ul>
<h3 id="1-浏览器指纹识别"><a href="#1-浏览器指纹识别" class="headerlink" title="1. 浏览器指纹识别"></a>1. 浏览器指纹识别</h3><p>通过用户所用的浏览器具有的独特信息（例如首部、字体等）得出验证用户身份的第二个因素。</p>
<p>获取浏览器特性的方式：用户代理、插件、字体、HTTP ACCEPT 首部、屏幕分辨率、超级 cookie、时区、启用cookie…</p>
<h3 id="2-位置追踪"><a href="#2-位置追踪" class="headerlink" title="2. 位置追踪"></a>2. 位置追踪</h3><p>使用用户的物理位置（GPS 数据）构建信任区。</p>
<p>⚠️ 物理位置可以伪造，而且结果也未必准确。</p>
<h3 id="3-设备指纹识别（手机-平板）"><a href="#3-设备指纹识别（手机-平板）" class="headerlink" title="3. 设备指纹识别（手机/平板）"></a>3. 设备指纹识别（手机/平板）</h3><p>设备的硬件指纹：操作系统版本、设备名称、设备型号、框架的 SDK 版本、硬件序列号（IMEI 码）。</p>
<h3 id="4-设备指纹识别（蓝牙配对设备）"><a href="#4-设备指纹识别（蓝牙配对设备）" class="headerlink" title="4. 设备指纹识别（蓝牙配对设备）"></a>4. 设备指纹识别（蓝牙配对设备）</h3><p>将连接到手机上的硬件设备作为硬件指纹。</p>
<h2 id="身份认证的其他方法"><a href="#身份认证的其他方法" class="headerlink" title="身份认证的其他方法"></a>身份认证的其他方法</h2><h3 id="双因素身份验证和-n-因素身份验证"><a href="#双因素身份验证和-n-因素身份验证" class="headerlink" title="双因素身份验证和 n 因素身份验证"></a>双因素身份验证和 n 因素身份验证</h3><p>双因素身份验证（2FA）依赖一个单独的令牌，例如一次性密码，使用后即失效，因此能避免常见的安全漏洞，例如重放攻击。</p>
<h3 id="n-因素身份验证（MFA）"><a href="#n-因素身份验证（MFA）" class="headerlink" title="n 因素身份验证（MFA）"></a>n 因素身份验证（MFA）</h3><p>假设每个人都具有三个基本的要素：</p>
<ul>
<li>知道的事情。（密码）</li>
<li>拥有的东西。（智能卡或 RSA 令牌、Google Authenticator、Au-thy）</li>
<li>自身的特征。（个体的身份、指纹）</li>
</ul>
<h3 id="一次性密码"><a href="#一次性密码" class="headerlink" title="一次性密码"></a>一次性密码</h3><p>生成一次性密码的三种方式：</p>
<ol>
<li>采用时钟同步方式，生成短期令牌。（Authy 和 Google Authenticator）</li>
<li><ol start="3">
<li>基于数学算法，生成长期令牌。（短信验证码、电子邮件）</li>
</ol>
</li>
</ol>
<h3 id="使用-Authy-实现双因素身份验证"><a href="#使用-Authy-实现双因素身份验证" class="headerlink" title="使用 Authy 实现双因素身份验证"></a>使用 Authy 实现双因素身份验证</h3><p>通过使用 Twilio 提供的身份验证服务 Authy 实现 2FA 功能。</p>
<h3 id="使用生物特征代替密码"><a href="#使用生物特征代替密码" class="headerlink" title="使用生物特征代替密码"></a>使用生物特征代替密码</h3><p>指纹扫描仪。</p>
<p>生物特征更适合看作一种证明身份的机制。</p>
<h3 id="如何评价生物特征的效果"><a href="#如何评价生物特征的效果" class="headerlink" title="如何评价生物特征的效果"></a>如何评价生物特征的效果</h3><p>在身份验证场景下处理生物特征时一定要考虑假阳性率（误识率）。</p>
<ol>
<li>遵循官方的误识率要求。</li>
<li>限制尝试次数。</li>
</ol>
<h4 id="1-面部识别"><a href="#1-面部识别" class="headerlink" title="1. 面部识别"></a>1. 面部识别</h4><p>面部识别使用数字图像或视频识别人类。这个技术使用标志性特征匹配轮廓。</p>
<h4 id="2-视网膜和虹膜扫描"><a href="#2-视网膜和虹膜扫描" class="headerlink" title="2. 视网膜和虹膜扫描"></a>2. 视网膜和虹膜扫描</h4><p>通过人类眼球上的血管识别用户。</p>
<p>视网膜扫描：检测血管对光的吸收。</p>
<p>虹膜扫描：先获取眼球的图像，然后再做分析。</p>
<h4 id="3-静脉识别"><a href="#3-静脉识别" class="headerlink" title="3. 静脉识别"></a>3. 静脉识别</h4><p>脉搏只有身体中有血液流动时才有。富士通为日本的 ATM 机部署了掌侧静脉识别。</p>
<h2 id="新出现的标准"><a href="#新出现的标准" class="headerlink" title="新出现的标准"></a>新出现的标准</h2><h3 id="1-FIDO-Alliance"><a href="#1-FIDO-Alliance" class="headerlink" title="1. FIDO Alliance"></a>1. FIDO Alliance</h3><p>FIDO 提供了两种解决方案：</p>
<ol>
<li>通用身份识别框架。</li>
<li>通用第二因素。</li>
</ol>
<h3 id="2-Oz"><a href="#2-Oz" class="headerlink" title="2. Oz"></a>2. Oz</h3><p>Web 授权框架：<a href="https://github.com/hueniverse/oz" target="_blank" rel="noopener">https://github.com/hueniverse/oz</a></p>
<h3 id="3-区块链"><a href="#3-区块链" class="headerlink" title="3. 区块链"></a>3. 区块链</h3><p>用户存储某些属性的证明，例如姓名、住址或生日，然后在任何能提供公钥的地方公开这些属性的加密哈希。这样个人就可以确认信息，而且能保证信息的真实性。这个概念的关键是决定分享哪些信息。</p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://andy0570.com/2018/12/17/Web-开发的身份数据和安全（二）——密码加密、哈希和加盐/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="独木舟的木">
      <meta itemprop="description" content="有时候阳光很好 有时候阳光很暗">
      <meta itemprop="image" content="https://ws1.sinaimg.cn/large/006tNc79gy1g22m14458rj30u014xu0x.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="独木舟的木">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2018/12/17/Web-开发的身份数据和安全（二）——密码加密、哈希和加盐/" class="post-title-link" itemprop="url">Web-开发的身份数据和安全（二）——密码加密、哈希和加盐</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2018-12-17 13:47:00" itemprop="dateCreated datePublished" datetime="2018-12-17T13:47:00+08:00">2018-12-17</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2019-04-15 17:54:13" itemprop="dateModified" datetime="2019-04-15T17:54:13+08:00">2019-04-15</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/PKI-密码学/" itemprop="url" rel="index"><span itemprop="name">PKI&密码学</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          
            <span id="/2018/12/17/Web-开发的身份数据和安全（二）——密码加密、哈希和加盐/" class="leancloud_visitors" data-flag-title="Web-开发的身份数据和安全（二）——密码加密、哈希和加盐">
              <span class="post-meta-divider">|</span>
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              
                <span class="post-meta-item-text">阅读次数：</span>
              
                <span class="leancloud-visitors-count"></span>
            </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body han-init-context" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>探讨密码加密和安全性。</p>
</blockquote>
<h1 id="静态数据-amp-动态数据"><a href="#静态数据-amp-动态数据" class="headerlink" title="静态数据&amp;动态数据"></a>静态数据&amp;动态数据</h1><p><strong>静态数据</strong>：不活动的（或静止的）数字数据，存储在服务器中，例如用于存储密码、个人资料、或其他应用所需数据的数据库。</p>
<p><strong>动态数据</strong>：传输中的数据，在应用和数据库之间来回发送，或者在网站和 API 或外部数据源之间来回传送。</p>
<h3 id="1-静态数据"><a href="#1-静态数据" class="headerlink" title="1. 静态数据"></a>1. 静态数据</h3><ul>
<li>数据库加密是绝对有必要的，尽管 99% 的团体没有这么做。</li>
<li>加密数据库应该使用强加密、受 NIST 认可的算法，如：SHA-256、AES、RSA。</li>
<li>遵循标准做法：1. 分开访问控制（用户登录）和数据加密；2. 定期更新加密数据库的密钥；3. 分开存储加密密钥和数据。</li>
<li>对全球覆盖的应用来说，可以使用<strong>数据联合</strong>避免恶意访问数据存储器。</li>
<li>根据运行应用、网站或服务的需要，<strong>应该尽量少存储敏感的用户数据</strong>。</li>
<li>敏感的财务信息（例如信用卡数据）可以交由他方（支付提供商）处理。</li>
</ul>
<h4 id="2-动态数据"><a href="#2-动态数据" class="headerlink" title="2. 动态数据"></a>2. 动态数据</h4><p>动态数据的使用场景：</p>
<ul>
<li>用户填写的注册信息，用于访问账户和认证身份。</li>
<li>把个人档案信息传输给API服务，或从中获取。</li>
<li>应用或网站收集的其他数据，传给数据库存储起来。</li>
</ul>
<h3 id="密码攻击媒介"><a href="#密码攻击媒介" class="headerlink" title="密码攻击媒介"></a>密码攻击媒介</h3><ul>
<li>钓鱼；</li>
<li>社会工程；</li>
<li>暴力攻击；（抵抗方式：密钥延伸技术）<ul>
<li>登录失败后显示验证码（<a href="https://www.google.com/recaptcha/intro/v3.html" target="_blank" rel="noopener">Google reCAPTCHA</a>、<a href="http://dun.163.com/trial/sense" target="_blank" rel="noopener">易盾 - 智能无感知验证码</a>），增加登录难度。</li>
<li>添加 2FA （双因素身份认证）机制。</li>
</ul>
</li>
<li>字典攻击；（抵抗方式：加盐）</li>
<li>彩虹表；（抵抗方式：加盐）</li>
<li>恶意软件；（抵抗方式：短信验证、n因素认证）</li>
<li>离线破解；</li>
</ul>
<h1 id="加盐"><a href="#加盐" class="headerlink" title="加盐"></a>加盐</h1><p>盐值是一种随机数据，计算密码的哈希值时用于加强数据，抵御多种攻击媒介尤其是字典攻击和彩虹表。这个随机数据（特别长）能确保生成的哈希值唯一的，即使多个用户使用相同的密码（确实有这种情况），添加唯一的盐值后能确保得到的哈希值仍是唯一的。就因为得到的哈希值是唯一的，我们才得以免受彩虹表和字典攻击的危害。</p>
<h3 id="生成随机盐值"><a href="#生成随机盐值" class="headerlink" title="生成随机盐值"></a>生成随机盐值</h3><p>使用 Node 原生支持的的 <a href="http://nodejs.cn/api/crypto.html#crypto_crypto_randombytes_size_callback" target="_blank" rel="noopener">crypto</a> 库生成随机盐值。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> crypto = <span class="built_in">require</span>(<span class="string">'crypto'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// crypto.randomBytes() 生成 16 位强加密的伪随机数</span></span><br><span class="line">crypto.randomBytes(<span class="number">16</span>, (err, buf) =&gt; &#123;</span><br><span class="line">  <span class="keyword">if</span> (err) <span class="keyword">throw</span> err;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">`<span class="subst">$&#123;buf.length&#125;</span> bytes of random data: <span class="subst">$&#123;buf.toString(<span class="string">'hex'</span>)&#125;</span>`</span>);</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">`<span class="subst">$&#123;buf.length&#125;</span> bytes of random data: <span class="subst">$&#123;buf.toString(<span class="string">'base64'</span>)&#125;</span>`</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 同步方法生成盐值</span></span><br><span class="line"><span class="keyword">const</span> buf = crypto.randomBytes(<span class="number">256</span>);</span><br></pre></td></tr></table></figure>
<h3 id="重用盐值"><a href="#重用盐值" class="headerlink" title="重用盐值"></a>重用盐值</h3><p>用户注册账户或修改密码时应该生成并存储新的盐值和哈希值。</p>
<h3 id="盐值的长度"><a href="#盐值的长度" class="headerlink" title="盐值的长度"></a>盐值的长度</h3><ul>
<li>根据经验，盐值的长度应该与哈希函数的输出长度一致。</li>
<li>PBKDF2 标准建议至少应该使用 64 位（8字节）长度的盐值。通常，多数情况下使用的是2的7次方，即128位（16字节）。</li>
</ul>
<h3 id="把盐值存储在哪？"><a href="#把盐值存储在哪？" class="headerlink" title="把盐值存储在哪？"></a>把盐值存储在哪？</h3><p>盐值可以和哈希值一起以明文形式存储在数据库中。</p>
<h1 id="撒胡椒"><a href="#撒胡椒" class="headerlink" title="撒胡椒"></a>撒胡椒</h1><ul>
<li>胡椒是在计算哈希值时随盐值和密码一起传入的值。</li>
<li>使用胡椒的原因：利用额外的字符和符号加强密码的强度。</li>
</ul>
<h1 id="选择正确的密码哈希函数"><a href="#选择正确的密码哈希函数" class="headerlink" title="选择正确的密码哈希函数"></a>选择正确的密码哈希函数</h1><h3 id="bcrypt-⭐️⭐️⭐️"><a href="#bcrypt-⭐️⭐️⭐️" class="headerlink" title="bcrypt ⭐️⭐️⭐️"></a><a href="https://github.com/kelektiv/node.bcrypt.js#readme" target="_blank" rel="noopener">bcrypt</a> ⭐️⭐️⭐️</h3><p>特性：专为加密密码设计，有异步方法和同步方法、密码哈希函数、校验密码函数、带 promise 特性…</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> bcrypt = <span class="built_in">require</span>(<span class="string">'bcrypt'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 封装 hash 函数</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">bcrypt_encrypt</span>(<span class="params">username, password</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// 1. bcrypt 内置了生成盐值的方法：getSalt()</span></span><br><span class="line">  bcrypt.genSalt(<span class="number">10</span>, (err, salt) =&gt; &#123;</span><br><span class="line">    <span class="keyword">if</span> (err) <span class="keyword">throw</span> err;</span><br><span class="line">      </span><br><span class="line">    <span class="comment">// 2. 生成哈希值：hash()</span></span><br><span class="line">    bcrypt.hash(password, salt, (err, key) =&gt; &#123;</span><br><span class="line">      <span class="keyword">if</span> (err) <span class="keyword">throw</span> err;</span><br><span class="line">      </span><br><span class="line">      <span class="comment">// 3. 把用户名、密码哈希值和盐值存入数据库</span></span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 调用示例</span></span><br><span class="line">bcrypt_encrypt(<span class="string">'zhangsan'</span>, <span class="string">'123456'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 对比哈希值，验证密码：</span></span><br><span class="line">bcrypt.compare(password, hash, (err, same) =&gt; &#123;</span><br><span class="line">  <span class="comment">// 返回 true 或 false</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h3 id="PBKDF2"><a href="#PBKDF2" class="headerlink" title="PBKDF2"></a>PBKDF2</h3><ul>
<li>1Password、LastPass 等密码管理系统采用的算法；</li>
<li>Node crypt 库原生支持的标准算法；</li>
</ul>
<p>加密示例：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// PBKDF2 算法</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">pbkdf2_encrypt</span>(<span class="params">username, password</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// 1. crypto.randomBytes(）方法生成 32 字节的随机盐值</span></span><br><span class="line">  crypto.randomBytes(<span class="number">32</span>, (err, salt) =&gt; &#123;</span><br><span class="line">    <span class="keyword">if</span> (err) <span class="keyword">throw</span> err;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2. 参数列表：（密码，盐值，迭代次数，密钥长度，摘要函数）</span></span><br><span class="line">    crypto.pbkdf2(password, salt, <span class="number">4096</span>, <span class="number">512</span>, <span class="string">'sha256'</span>, (err, key) =&gt; &#123;</span><br><span class="line">      <span class="keyword">if</span> (err) <span class="keyword">throw</span> err;</span><br><span class="line">      </span><br><span class="line">      <span class="comment">// 3. 将用户名、密码哈希值和盐值存入数据库</span></span><br><span class="line">      <span class="built_in">console</span>.log(username, key.toString(<span class="string">'hex'</span>), salt.toString(<span class="string">'hex'</span>));</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 调用示例</span></span><br><span class="line">pbkdf2_encrypt(<span class="string">'zhangSan'</span>, <span class="string">'123456'</span>);</span><br></pre></td></tr></table></figure>
<p>对比哈希值，验证密码：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> dbsalt = <span class="string">'USER RECORD SALT FROM YOUR DATABASE'</span>;</span><br><span class="line"><span class="keyword">const</span> dbhash = <span class="string">'USER RECORD KEY FROM YOUR DATABASE'</span>;</span><br><span class="line"></span><br><span class="line">crypto.pbkdf2(password, dbsalt, <span class="number">4096</span>, <span class="number">512</span>, <span class="string">'sha256'</span>, (err, comparsehash) =&gt; &#123;</span><br><span class="line">  <span class="keyword">if</span> (err) <span class="keyword">throw</span> err;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 比较</span></span><br><span class="line">  <span class="keyword">if</span> (dbhash.toString(<span class="string">'hex'</span>) === comparsehash.toString(<span class="string">'hex'</span>)) &#123;</span><br><span class="line">    <span class="comment">// 密码匹配</span></span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// 密码不匹配</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h3 id="scrypt"><a href="#scrypt" class="headerlink" title="scrypt"></a><a href="https://github.com/barrysteyn/node-scrypt" target="_blank" rel="noopener">scrypt</a></h3><p>scrypt 的优势和实现如下：</p>
<ul>
<li>做了特殊设计，是硬件和内存密集型算法，攻击者要实施大型攻击，想要破解需要耗费异常多的硬件和内存。</li>
<li>是加密数字货币莱特币和狗狗币背后采用的算法。</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">'use strict'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> scrypt = <span class="built_in">require</span>(<span class="string">'scrypt'</span>);</span><br><span class="line"><span class="keyword">const</span> crypto = <span class="built_in">require</span>(<span class="string">'crypto'</span>);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">scrypt_encrypt</span>(<span class="params">username, password</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// 1. 使用 crypto 的 crypto.randomBytes(...) 方法生成盐值。</span></span><br><span class="line">  crypto.randomBytes(<span class="number">32</span>, (err, salt) =&gt; &#123;</span><br><span class="line">    <span class="keyword">if</span> (err) <span class="keyword">throw</span> err;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2. scrypt.hash(...) 生成 64 位的哈希值</span></span><br><span class="line">    <span class="comment">// - N: crypt最多使用多长时间（秒数）计算密钥（偶数）。</span></span><br><span class="line">    <span class="comment">// - r:计算密钥时最多使用多少字节RAM（整数）。默认为0。</span></span><br><span class="line">    <span class="comment">// - p:计算密钥时所用RAM占可用值的比例（0-1，换算成百分比）默认为0.5。</span></span><br><span class="line">    scrypt.hash(password, &#123;<span class="string">"N"</span>:<span class="number">16384</span>,<span class="string">"r"</span>:<span class="number">8</span>,<span class="string">"p"</span>:<span class="number">1</span>&#125;, <span class="number">64</span>, salt, (err, key) =&gt; &#123;</span><br><span class="line">      <span class="keyword">if</span> (err) <span class="keyword">throw</span> err;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 3. 把用户名、密码哈希值和盐值存入数据库</span></span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">`key is <span class="subst">$&#123;key&#125;</span>`</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="密钥延伸"><a href="#密钥延伸" class="headerlink" title="密钥延伸"></a>密钥延伸</h2><p>bcrypt、scrypt 和 PBKDF2 行之有效涉及到的底层概念——密钥延伸。<br><strong>密钥延伸</strong>：把弱密码变成特别复杂的长密码，致使暴力攻击等攻击媒介不再可行。</p>
<p>对加密哈希函数来说，密钥延伸体现在不断循环应用哈希函数（哈希函数迭代），直到得到所需长度和复杂度的哈希值为止。</p>
<h2 id="重新计算哈希值"><a href="#重新计算哈希值" class="headerlink" title="重新计算哈希值"></a>重新计算哈希值</h2><p>有时可能需要为用户生成新的密码哈希值。比如说:</p>
<ul>
<li>根据摩尔定律，硬件更新了，要修改加密算法使用的权重/工作因子。</li>
<li>算法变了，或者有更好的算法出现，目前使用的算法不安全。</li>
<li>觉得现有哈希值不再安全。</li>
</ul>
<p>遇到这些情况，符合常规的做法是为用户生成新哈希值，存储在系统中。用户提供用户名和密码请求登录时，正常比较根据输入值计算的哈希值和存储的哈希值，而不是拒绝登录。随后，为用户生成新的哈希值，替换用户记录中的旧值。</p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://andy0570.com/2018/12/12/Web-开发的身份数据和安全（一）——导论/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="独木舟的木">
      <meta itemprop="description" content="有时候阳光很好 有时候阳光很暗">
      <meta itemprop="image" content="https://ws1.sinaimg.cn/large/006tNc79gy1g22m14458rj30u014xu0x.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="独木舟的木">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2018/12/12/Web-开发的身份数据和安全（一）——导论/" class="post-title-link" itemprop="url">Web-开发的身份数据和安全（一）——导论</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2018-12-12 02:16:00" itemprop="dateCreated datePublished" datetime="2018-12-12T02:16:00+08:00">2018-12-12</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2019-04-15 17:53:17" itemprop="dateModified" datetime="2019-04-15T17:53:17+08:00">2019-04-15</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/PKI-密码学/" itemprop="url" rel="index"><span itemprop="name">PKI&密码学</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          
            <span id="/2018/12/12/Web-开发的身份数据和安全（一）——导论/" class="leancloud_visitors" data-flag-title="Web-开发的身份数据和安全（一）——导论">
              <span class="post-meta-divider">|</span>
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              
                <span class="post-meta-item-text">阅读次数：</span>
              
                <span class="leancloud-visitors-count"></span>
            </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body han-init-context" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>参考：《Web 开发的身份数据和安全》</p>
</blockquote>
<p>主要内容：</p>
<ul>
<li>了解 Web 和应用安全的现状。</li>
<li>构建安全的加密方式、以及与各种密码攻击媒介斗争。</li>
<li>创建数字指纹，在浏览器、设备和配对设备中识别用户。</li>
<li>通过 OAuth 和 OpenID Connect 构建安全的数据传输系统。</li>
<li>使用其他的识别方法提供第二种身份验证方式。</li>
<li>加固 Web 应用，防止攻击。</li>
<li>使用 SSL/TLS 及同步和异步加密创建安全的数据传输系统。</li>
</ul>
<h1 id="导论"><a href="#导论" class="headerlink" title="导论"></a>导论</h1><h3 id="1-关于安全，你需要觉醒的是"><a href="#1-关于安全，你需要觉醒的是" class="headerlink" title="1. 关于安全，你需要觉醒的是"></a>1. 关于安全，你需要觉醒的是</h3><blockquote>
<p>对系统，公司或应用最重要的投资之一是<strong>安全和身份基础设施</strong>。</p>
<p>但是保护数据没有万无一失的安全方法。身份和数据安全的要务是降低风险、保护严守的数据，当不幸发生时，留出足够的时间采取行动，减少损失。</p>
</blockquote>
<h3 id="2-现有安全模型的问题"><a href="#2-现有安全模型的问题" class="headerlink" title="2. 现有安全模型的问题"></a>2. 现有安全模型的问题</h3><ul>
<li><p>不是技术跟不上潜在的攻击媒介的发展步伐，而是开发方式的选择导致系统变得薄弱。</p>
</li>
<li><p>错误的思想：</p>
<ul>
<li>你以为用户始终会选择最安全的方案（如：强密码、双因素身份验证），实际上用户更愿意选择最简单的方案。</li>
<li>为了确保系统安全，不惜牺牲可用性。</li>
<li>安全措施绝不会遭到破坏。</li>
</ul>
</li>
<li><p><strong>强密码</strong>：不管系统的体量有多大，都始终应该假设数据库的安全措施有可能被攻破，导致数据被盗取。一切敏感的信息都应该妥善加密。</p>
</li>
<li><p><strong>可用性和安全性</strong>一定要适当平衡。</p>
</li>
<li><p><strong>数据加密</strong>：数据不是为了防止数据被盗，而是要拖慢黑客的步伐，让他们在短时间内无法解密大量数据，或者拖延时间，以便采取必要的行动。</p>
</li>
<li><p>最薄弱的环节，人类：双因素身份认证、密码疲劳。</p>
<blockquote>
<p>解决“密码疲劳”问题：</p>
<ul>
<li>苹果（Apple）系统的密码管理应用：Keychain。</li>
<li>应用：1Password、Dashlane、LastPass。</li>
</ul>
<p>增强用户体验并提升密码强度的三个方式：</p>
<ul>
<li>显示密码规则；</li>
<li>显示用户输入；</li>
<li>显示强度表；</li>
</ul>
</blockquote>
</li>
<li><p>单点登录（single sign-on，SSO）：OpenID、OAuth 1.0、OAuth 2.0、OpenID Connect。</p>
</li>
</ul>
<h3 id="3-理解密码安全中的熵"><a href="#3-理解密码安全中的熵" class="headerlink" title="3. 理解密码安全中的熵"></a>3. 理解密码安全中的熵</h3><ul>
<li>判断密码强度的标准机制——<strong>信息熵</strong>。</li>
<li>信息熵的衡量方式：源（如密码）中信息的比特数。通常认为，熵至少为 36.86 比特的密码才是好密码。</li>
<li>衡量密码熵的几个关键特征：所用的符号集、符号集通过大小写字符所做的扩充、密码长度。</li>
<li>作用：预测通过猜测、字典攻击、暴力攻击等手段破解密码的难度。</li>
<li>生成密码的方式：1. 随机生成。2. 人为设置。</li>
<li>因为人类创建的密码难以确定安全性，所以 Web 开发时，通常：<ul>
<li>要求用户在创建密码时提高密码的强度。</li>
<li>默默在背后尽自己所能提升数据的安全性（如：加密、限制尝试登录次数）。</li>
</ul>
</li>
</ul>
<h3 id="4-区分用户名和密码在系统中的作用"><a href="#4-区分用户名和密码在系统中的作用" class="headerlink" title="4. 区分用户名和密码在系统中的作用"></a>4. 区分用户名和密码在系统中的作用</h3><ul>
<li>用户名（或公钥）用于认证用户的身份。</li>
<li>密码（或私钥）则以只有用户自己知道的方式证明用户的身份。</li>
<li>身份验证的两种方式：1. 增强系统。2. 删除用户名和密码。</li>
</ul>
<h3 id="5-好的和不好的安全算法（对密码而言）"><a href="#5-好的和不好的安全算法（对密码而言）" class="headerlink" title="5. 好的和不好的安全算法（对密码而言）"></a>5. 好的和不好的安全算法（对密码而言）</h3><p>⚠️ 注意：这边的“好”与“不好”指的是<strong>对密码进行哈希加密而言</strong>。<br>在保护数据和受限的用户信息方面，不是所有的加密算法都具有同等效果。</p>
<p>两种哈希加密算法：</p>
<ul>
<li>追求快速度的算法，用于快速而准确地加密和解密大量数据。</li>
<li>故意放慢速度的算法，防止暴力破解，用于保护密码。</li>
</ul>
<p><img src="http://upload-images.jianshu.io/upload_images/2648731-4e7ec645ea5113a1.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="哈希算法"></p>
<h3 id="6-应该保护哪些数据？"><a href="#6-应该保护哪些数据？" class="headerlink" title="6. 应该保护哪些数据？"></a>6. 应该保护哪些数据？</h3><p>任何能认证身份的信息（身份数据、个人信息、支付详情），以及那些对系统至关重要，公开后可能导致架构出现漏洞的信息。</p>
<h3 id="7-账户恢复机制还需要考虑到社会工程的影响"><a href="#7-账户恢复机制还需要考虑到社会工程的影响" class="headerlink" title="7. 账户恢复机制还需要考虑到社会工程的影响"></a>7. 账户恢复机制还需要考虑到社会工程的影响</h3><ul>
<li>安全问题的设置重复、搞怪、不易回答、难以记住。（如：小时候我喜欢吃什么菜？你最喜欢读哪本书？）。</li>
</ul>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://andy0570.com/2018/12/05/全球网络身份管理的现状与发展/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="独木舟的木">
      <meta itemprop="description" content="有时候阳光很好 有时候阳光很暗">
      <meta itemprop="image" content="https://ws1.sinaimg.cn/large/006tNc79gy1g22m14458rj30u014xu0x.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="独木舟的木">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2018/12/05/全球网络身份管理的现状与发展/" class="post-title-link" itemprop="url">全球网络身份管理的现状与发展</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2018-12-05 10:52:00" itemprop="dateCreated datePublished" datetime="2018-12-05T10:52:00+08:00">2018-12-05</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2019-04-15 17:52:19" itemprop="dateModified" datetime="2019-04-15T17:52:19+08:00">2019-04-15</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/PKI-密码学/" itemprop="url" rel="index"><span itemprop="name">PKI&密码学</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          
            <span id="/2018/12/05/全球网络身份管理的现状与发展/" class="leancloud_visitors" data-flag-title="全球网络身份管理的现状与发展">
              <span class="post-meta-divider">|</span>
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              
                <span class="post-meta-item-text">阅读次数：</span>
              
                <span class="leancloud-visitors-count"></span>
            </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body han-init-context" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>书名：《全球网络身份管理的现状与发展》</p>
</blockquote>
<blockquote>
<p>提及网络身份管理，我们很容易将之等效于“网络实名制”。</p>
<p><strong>网络实名制</strong>是一种政策，是政府部门对网络管理所采取的一种模式，是将网络虚拟身份与社会物理身份相对应的一种要求；</p>
<p><strong>网络身份管理</strong>则是对网络身份唯一性判定、真实性鉴别的一种能力要求。</p>
<p>网络身份管理在对网络用户管理时，可以采用基于公民网络电子身份标识（eID）的管理模式来支持网络实名制的管理要求。同时，网络身份管理所面对的还可以是网络设备、企事业法人、官方代表等具有特定网络身份的角色。</p>
<p>因此，网络身份管理与网络实名制之间虽有些相通之处，但更多的是区别。</p>
</blockquote>
<h1 id="一、网络身份管理综述"><a href="#一、网络身份管理综述" class="headerlink" title="一、网络身份管理综述"></a>一、网络身份管理综述</h1><h3 id="网络身份管理的范围"><a href="#网络身份管理的范围" class="headerlink" title="网络身份管理的范围"></a>网络身份管理的范围</h3><ol>
<li>网络身份的<strong>产生</strong>——用户如何获取自己的网络身份？</li>
<li>网络身份的<strong>保护</strong>——如何防止网络身份被盗用或冒用？密码口令、生物识别技术、数字证书、安全的网络协议。</li>
<li>网络身份的<strong>使用</strong>——网络身份验证。</li>
<li>网络身份的<strong>维护</strong>——网络身份生命周期的管理。</li>
</ol>
<h3 id="网络身份管理的参与方"><a href="#网络身份管理的参与方" class="headerlink" title="网络身份管理的参与方"></a>网络身份管理的参与方</h3><ul>
<li>个体；</li>
<li>身份服务提供方/身份提供商；</li>
<li>身份标识及载体；</li>
<li>依赖方；</li>
<li>属性服务提供方；</li>
</ul>
<h3 id="网络身份管理需求"><a href="#网络身份管理需求" class="headerlink" title="网络身份管理需求"></a>网络身份管理需求</h3><h4 id="一、个人-企业"><a href="#一、个人-企业" class="headerlink" title="一、个人/企业"></a>一、个人/企业</h4><ol>
<li>便利；</li>
<li>安全；</li>
<li>隐私；</li>
</ol>
<h4 id="二、互联网服务提供方"><a href="#二、互联网服务提供方" class="headerlink" title="二、互联网服务提供方"></a>二、互联网服务提供方</h4><ol>
<li>确认用户身份的真实性和有效性。</li>
<li>身份管理方案的经济性。</li>
</ol>
<h4 id="三、政府"><a href="#三、政府" class="headerlink" title="三、政府"></a>三、政府</h4><ol>
<li>维护国家安全和社会安全，有效遏制网络欺诈、身份盗窃和在线信息滥用的增长，防止由此造成的个人或组织的财产、名誉等各类损失。</li>
<li>推动个人和组织使用权威、高效、易用和互操作性的身份管理解决方案安全访问在线服务。</li>
<li>保护公民隐私，防止公民身份信息被非法获取，防范大规模网络身份信息的泄漏。</li>
</ol>
<h3 id="网络身份管理与网络实名制的区别"><a href="#网络身份管理与网络实名制的区别" class="headerlink" title="网络身份管理与网络实名制的区别"></a>网络身份管理与网络实名制的区别</h3><ol>
<li>身份信息的采集、传输、存储和使用必须严格受控。</li>
<li>并不是所有的网络活动都需要实名。</li>
<li>网络身份管理的关键作用是<strong>建立网络上各参与方之间的信任关系</strong>。</li>
</ol>
<p>网络实名制的初衷：防止匿名情况下的网络犯罪。</p>
<p>网络实名制存在的问题：压缩公民诉求表达的渠道、个人隐私泄露。</p>
<h3 id="网络身份管理的关键作用"><a href="#网络身份管理的关键作用" class="headerlink" title="网络身份管理的关键作用"></a>网络身份管理的关键作用</h3><ol>
<li>保障网络空间安全。</li>
<li>保护个人财产安全与隐私。</li>
<li>提高社会管理和服务效率。</li>
</ol>
<h3 id="身份认证的概念的方式"><a href="#身份认证的概念的方式" class="headerlink" title="身份认证的概念的方式"></a>身份认证的概念的方式</h3><p>网络身份认证的主要方式：</p>
<ol>
<li>用户名/密码组合认证；</li>
<li>动态口令认证；</li>
<li>智能卡认证；</li>
<li>短信密码认证；</li>
<li>智能密码钥匙（USBKey）认证；</li>
<li>基于生物特性认证；</li>
</ol>
<blockquote>
<p>未完待续…</p>
</blockquote>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://andy0570.com/2018/12/04/密码学——密码算法与协议/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="独木舟的木">
      <meta itemprop="description" content="有时候阳光很好 有时候阳光很暗">
      <meta itemprop="image" content="https://ws1.sinaimg.cn/large/006tNc79gy1g22m14458rj30u014xu0x.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="独木舟的木">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2018/12/04/密码学——密码算法与协议/" class="post-title-link" itemprop="url">密码学——密码算法与协议</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2018-12-04 15:42:00" itemprop="dateCreated datePublished" datetime="2018-12-04T15:42:00+08:00">2018-12-04</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2019-04-15 17:41:11" itemprop="dateModified" datetime="2019-04-15T17:41:11+08:00">2019-04-15</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/PKI-密码学/" itemprop="url" rel="index"><span itemprop="name">PKI&密码学</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          
            <span id="/2018/12/04/密码学——密码算法与协议/" class="leancloud_visitors" data-flag-title="密码学——密码算法与协议">
              <span class="post-meta-divider">|</span>
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              
                <span class="post-meta-item-text">阅读次数：</span>
              
                <span class="leancloud-visitors-count"></span>
            </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body han-init-context" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>书名：《密码学——密码算法与协议（第2版）》</p>
</blockquote>
<h3 id="思维导图"><a href="#思维导图" class="headerlink" title="思维导图"></a>思维导图</h3><p><img src="https://upload-images.jianshu.io/upload_images/2648731-9507307148a3de2c.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="密码学"></p>
<h3 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h3><ul>
<li><a href="https://github.com/matt-wu/AES" target="_blank" rel="noopener">AES 简介</a></li>
</ul>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://andy0570.com/2018/10/23/OpenSSL-无法使用-RSA-非对称加密算法加密大文件/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="独木舟的木">
      <meta itemprop="description" content="有时候阳光很好 有时候阳光很暗">
      <meta itemprop="image" content="https://ws1.sinaimg.cn/large/006tNc79gy1g22m14458rj30u014xu0x.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="独木舟的木">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2018/10/23/OpenSSL-无法使用-RSA-非对称加密算法加密大文件/" class="post-title-link" itemprop="url">OpenSSL-无法使用-RSA-非对称加密算法加密大文件</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2018-10-23 21:05:00" itemprop="dateCreated datePublished" datetime="2018-10-23T21:05:00+08:00">2018-10-23</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2019-04-15 17:37:13" itemprop="dateModified" datetime="2019-04-15T17:37:13+08:00">2019-04-15</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/PKI-密码学/" itemprop="url" rel="index"><span itemprop="name">PKI&密码学</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          
            <span id="/2018/10/23/OpenSSL-无法使用-RSA-非对称加密算法加密大文件/" class="leancloud_visitors" data-flag-title="OpenSSL-无法使用-RSA-非对称加密算法加密大文件">
              <span class="post-meta-divider">|</span>
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              
                <span class="post-meta-item-text">阅读次数：</span>
              
                <span class="leancloud-visitors-count"></span>
            </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body han-init-context" itemprop="articleBody">

      
      

      
        
          
            <h3 id="Shell-示例代码"><a href="#Shell-示例代码" class="headerlink" title="Shell 示例代码"></a>Shell 示例代码</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> 使用 genrsa 命令生成 RSA-2048 位的密钥（rsa_private.key）</span><br><span class="line">openssl genrsa -out rsa_private.key 2048</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> 解析私钥结构，查看密钥内容</span><br><span class="line">openssl rsa -text -in rsa_private.key</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> 生成密钥的公钥（rsa_private.key）</span><br><span class="line">openssl rsa -in rsa_private.key -pubout -out rsa_public.key</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> 使用生成的公钥加密文件</span><br><span class="line"><span class="meta">#</span> -pubin 表明用纯公钥文件加密</span><br><span class="line"><span class="meta">#</span> -inkey 指定密钥（rsa_private.key）</span><br><span class="line"><span class="meta">#</span> -in 指定要加密的文件（test.pdf，3.2M）</span><br><span class="line"><span class="meta">#</span> -out 加密后的文件（encrypted.en）</span><br><span class="line">openssl rsautl -encrypt -pubin -inkey rsa_public.key  -in test.pdf -out encrypted.en</span><br><span class="line">RSA operation error</span><br><span class="line">4475450988:error:04FFF06E:rsa routines:CRYPTO_internal:data too large for key size:/BuildRoot/Library/Caches/com.apple.xbs/Sources/libressl/libressl-22.200.4/libressl-2.6/crypto/rsa/rsa_pk1.c:151:</span><br></pre></td></tr></table></figure>
<ul>
<li><a href="https://stackoverflow.com/questions/7143514/how-to-encrypt-a-large-file-in-openssl-using-public-key" target="_blank" rel="noopener">How to encrypt a large file in openssl using public key</a></li>
</ul>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://andy0570.com/2018/09/13/OpenSSL/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="独木舟的木">
      <meta itemprop="description" content="有时候阳光很好 有时候阳光很暗">
      <meta itemprop="image" content="https://ws1.sinaimg.cn/large/006tNc79gy1g22m14458rj30u014xu0x.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="独木舟的木">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2018/09/13/OpenSSL/" class="post-title-link" itemprop="url">OpenSSL</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2018-09-13 10:04:00" itemprop="dateCreated datePublished" datetime="2018-09-13T10:04:00+08:00">2018-09-13</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2019-04-15 17:36:39" itemprop="dateModified" datetime="2019-04-15T17:36:39+08:00">2019-04-15</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/PKI-密码学/" itemprop="url" rel="index"><span itemprop="name">PKI&密码学</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          
            <span id="/2018/09/13/OpenSSL/" class="leancloud_visitors" data-flag-title="OpenSSL">
              <span class="post-meta-divider">|</span>
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              
                <span class="post-meta-item-text">阅读次数：</span>
              
                <span class="leancloud-visitors-count"></span>
            </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body han-init-context" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<blockquote>
<p>💡以下内容参考学习自<a href="http://www.ituring.com.cn/book/1734" target="_blank" rel="noopener">《OpenSSL攻略》</a>，右侧随书下载。</p>
</blockquote>
<p>原文：<a href="https://www.feistyduck.com/library/openssl-cookbook/online/" target="_blank" rel="noopener">https://www.feistyduck.com/library/openssl-cookbook/online/</a></p>
</blockquote>
<h3 id="加密基元"><a href="#加密基元" class="headerlink" title="加密基元"></a>加密基元</h3><p><img src="http://upload-images.jianshu.io/upload_images/2648731-0c7cd1314e5f87e5.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="密码学加密基元"></p>
<p>说明：</p>
<ul>
<li><strong>散列函数（散列（hash）、指纹、消息摘要、摘要算法、杂凑函数）</strong>：把任意长度的输入消息数据转化成固定长度的输出数据的一种密码算法。</li>
<li><strong>消息验证代码</strong>：验证数据完整性。</li>
<li><strong>数字签名</strong>：RSA私钥加密，公钥解密，结合散列函数。验证消息真实性。</li>
<li><strong>伪随机函数（PRF）</strong>：生成任意数量的伪随机数据 </li>
<li><strong>RSA</strong>：可以同时用于密钥交换和身份验证。 </li>
<li><strong>DHE_RSA</strong>：DHE：密钥交换，RSA：身份验证。</li>
<li><strong>ECDHE_RSA</strong>： ECDHE：密钥交换，RSA：身份验证。</li>
<li><strong>ECDHE_ECDSA</strong> ：ECDHE：密钥交换，ECDSA：身份验证。</li>
</ul>
<h4 id="补充：分组密码工作模式-操作模式"><a href="#补充：分组密码工作模式-操作模式" class="headerlink" title="补充：分组密码工作模式/操作模式"></a>补充：分组密码工作模式/操作模式</h4><blockquote>
<p>分组密码都有固定的分组长度，实际应用中需要加密的明文都大大长于这个分组长度。如何对明文进行分组、填充，分组后的明文组和密文组之间有没有关系，这些要素形成了分组密码的不同工作模式。在实际应用中，分组密码主要有4种运行模式：</p>
<ul>
<li>电子密码本模式（ECB）：不适用于长报文、高度结构化报文。</li>
<li>密文块链接模式（CBC）</li>
<li>密文反馈模式（CFB）：分组密码转换为流密码</li>
<li>输出反馈模式（OFB）：缺点：难以检测对密文的篡改。</li>
</ul>
</blockquote>
<h4 id="分组加密的操作模式"><a href="#分组加密的操作模式" class="headerlink" title="分组加密的操作模式"></a>分组加密的操作模式</h4><ol>
<li>加密操作模式：只保护数据的私密性，无需验证数据来源。<br> ECB、CBC、OFB、CFB、<strong>CTR</strong>。</li>
<li>验证操作模式：不在乎数据的保密性，只想确保数据的发送来源。<br> <strong>CMAC</strong>。</li>
<li>验证加密操作模式：既想保密要传输的数据，还要确认数据的来源。<br> CCM、<strong>GCM</strong>、KW/KWP/TKW</li>
</ol>
<h3 id="TLS服务安全部署"><a href="#TLS服务安全部署" class="headerlink" title="TLS服务安全部署"></a>TLS服务安全部署</h3><p><img src="http://upload-images.jianshu.io/upload_images/2648731-a7658afa0e290eef.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="TLS服务安全部署"></p>
<h2 id="OpenSSL-的结构及目录功能"><a href="#OpenSSL-的结构及目录功能" class="headerlink" title="OpenSSL 的结构及目录功能"></a><a href="https://www.openssl.org/" target="_blank" rel="noopener">OpenSSL</a> 的结构及目录功能</h2><p><a href="http://linux.51yip.com/search/openssl" target="_blank" rel="noopener">OpenSSL linux 命令在线中文手册</a><br><img src="https://upload-images.jianshu.io/upload_images/2648731-e930899f7dcda3f9.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/620" alt="OpenSSL 的结构"></p>
<h3 id="OpenSSL-目录功能对照表"><a href="#OpenSSL-目录功能对照表" class="headerlink" title="OpenSSL 目录功能对照表"></a>OpenSSL 目录功能对照表</h3><table>
<thead>
<tr>
<th>目录名</th>
<th>功能描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>Crypto</td>
<td>存放 OpenSSL 所有加密算法源码文件和相关标注如 X.509 源码文件，是 OpenSSL 中最重要的目录，包含了 OpenSSL 密码算法库的所有内容</td>
</tr>
<tr>
<td>SSL</td>
<td>存放 OpenSSL 中 SSL 协议各个版本和 TLS 1.0 协议源码文件，包含了 OpenSSL 协议库的所有内容</td>
</tr>
<tr>
<td>Apps</td>
<td>存放 OpenSSL 中所有应用程序源码文件，如 CA、X509 等应用程序的源文件就存放在这里</td>
</tr>
<tr>
<td>Doc</td>
<td>存放了 OpenSSL 中所有的使用说明文档，包含三个部分：应用程序说明文档、加密算法库 API 说明文档及 SSL 协议API说明文档</td>
</tr>
<tr>
<td>Demos</td>
<td>存放了一些基于 OpenSSL 的应用程序例子，这些例子一般都很简单，演示怎么使用 OpenSSL 中的一个功能</td>
</tr>
<tr>
<td>Include</td>
<td>存放了使用 OpenSSL 的库时需要的头文件</td>
</tr>
<tr>
<td>Test</td>
<td>存放了 OpenSSL 自身功能测试程序的源码文件</td>
</tr>
</tbody>
</table>
<h3 id="构建-OpenSSL"><a href="#构建-OpenSSL" class="headerlink" title="构建 OpenSSL"></a>构建 OpenSSL</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> 查看当前系统使用的 OpenSSL 版本</span><br><span class="line"><span class="meta">$</span> openssl version</span><br><span class="line">OpenSSL 1.0.2g  1 Mar 2016</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> 获取完整的版本信息</span><br><span class="line"><span class="meta">$</span> openssl version -a </span><br><span class="line">...</span><br><span class="line">OPENSSLDIR: "/usr/lib/ssl" # OpenSSL 默认查找和配置证书目录</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> 下载 OpenSSL</span><br><span class="line"><span class="meta">$</span> wget https://www.openssl.org/source/openssl-1.0.2o.tar.gz</span><br><span class="line"><span class="meta">$</span> wget https://www.openssl.org/source/openssl-1.1.1.tar.gz</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> 解压缩</span><br><span class="line"><span class="meta">$</span> tar -xzvf openssl-1.0.2o.tar.gz ## 先调用 gzip 解压缩，再解开文件。</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> 配置</span><br><span class="line"><span class="meta">$</span> cd openssl-1.0.2o/</span><br><span class="line"><span class="meta">$</span> ./config \</span><br><span class="line">--prefix=/opt/openssl \</span><br><span class="line">--openssldir=/opt/openssl \ # 安装目录</span><br><span class="line">enable-ec_nistp_64_gcc_128  # 使用优化后的常用椭圆曲线算法</span><br><span class="line"></span><br><span class="line"><span class="meta">$</span> make depend       # 生成可执行文件</span><br><span class="line"><span class="meta">$</span> make              # 编译</span><br><span class="line"><span class="meta">$</span> sudo make install # 安装</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> OpenSSL 安装在 /opt/openssl/ 目录下</span><br><span class="line"><span class="meta">$</span> cd /opt/openssl/</span><br><span class="line"><span class="meta">$</span> ls -l</span><br><span class="line">total 40</span><br><span class="line">drwxr-xr-x 2 root root  4096 Jun 15 08:08 bin</span><br><span class="line">drwxr-xr-x 2 root root  4096 Jun 15 08:08 certs # 根证书目录、可信证书库</span><br><span class="line">drwxr-xr-x 3 root root  4096 Jun 15 08:08 include</span><br><span class="line">drwxr-xr-x 4 root root  4096 Jun 15 08:08 lib</span><br><span class="line">drwxr-xr-x 6 root root  4096 Jun 15 08:08 man</span><br><span class="line">drwxr-xr-x 2 root root  4096 Jun 15 08:08 misc # 补充脚本</span><br><span class="line">-rw-r--r-- 1 root root 10835 Jun 15 08:08 openssl.cnf</span><br><span class="line">drwxr-xr-x 2 root root  4096 Jun 15 08:08 private # 私钥目录</span><br></pre></td></tr></table></figure>
<h3 id="查看可用命令：openssl-help"><a href="#查看可用命令：openssl-help" class="headerlink" title="查看可用命令：openssl help"></a>查看可用命令：<code>openssl help</code></h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> ------ 所有可用工具 ------</span><br><span class="line">Standard commands </span><br><span class="line">asn1parse         ca                ciphers           cms</span><br><span class="line">crl               crl2pkcs7         dgst              dh</span><br><span class="line">dhparam           dsa               dsaparam          ec</span><br><span class="line">ecparam           enc               engine            errstr</span><br><span class="line">gendh             gendsa            genpkey           genrsa</span><br><span class="line">nseq              ocsp              passwd            pkcs12</span><br><span class="line">pkcs7             pkcs8             pkey              pkeyparam</span><br><span class="line">pkeyutl           prime             rand              req</span><br><span class="line">rsa               rsautl            s_client          s_server</span><br><span class="line">s_time            sess_id           smime             speed</span><br><span class="line">spkac             srp               ts                verify</span><br><span class="line">version           x509</span><br><span class="line"><span class="meta">#</span> man + 工具名称，显示某一命令的详细信息</span><br><span class="line"><span class="meta">#</span> man ciphers,显示如何配置密码套件</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> ------ 消息摘要命令 ------</span><br><span class="line">Message Digest commands (see the `dgst' command for more details)</span><br><span class="line">md4               md5               rmd160            sha</span><br><span class="line">sha1</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> ------ 加密命令 ------</span><br><span class="line">Cipher commands (see the `enc' command for more details)</span><br><span class="line">aes-128-cbc       aes-128-ecb       aes-192-cbc       aes-192-ecb</span><br><span class="line">aes-256-cbc       aes-256-ecb       base64            bf</span><br><span class="line">bf-cbc            bf-cfb            bf-ecb            bf-ofb</span><br><span class="line">camellia-128-cbc  camellia-128-ecb  camellia-192-cbc  camellia-192-ecb</span><br><span class="line">camellia-256-cbc  camellia-256-ecb  cast              cast-cbc</span><br><span class="line">cast5-cbc         cast5-cfb         cast5-ecb         cast5-ofb</span><br><span class="line">des               des-cbc           des-cfb           des-ecb</span><br><span class="line">des-ede           des-ede-cbc       des-ede-cfb       des-ede-ofb</span><br><span class="line">des-ede3          des-ede3-cbc      des-ede3-cfb      des-ede3-ofb</span><br><span class="line">des-ofb           des3              desx              rc2</span><br><span class="line">rc2-40-cbc        rc2-64-cbc        rc2-cbc           rc2-cfb</span><br><span class="line">rc2-ecb           rc2-ofb           rc4               rc4-40</span><br><span class="line">seed              seed-cbc          seed-cfb          seed-ecb</span><br><span class="line">seed-ofb</span><br></pre></td></tr></table></figure>
<h3 id="创建可信证书库"><a href="#创建可信证书库" class="headerlink" title="创建可信证书库"></a>创建可信证书库</h3><ol>
<li><p>从 <a href="https://www.mozilla.org/en-US/about/governance/policies/security-group/certs/" target="_blank" rel="noopener">Mozilla CA Certificate Store</a> 获取开源的可信证书库：<a href="https://hg.mozilla.org/mozilla-central/raw-file/tip/security/nss/lib/ckfw/builtins/certdata.txt" target="_blank" rel="noopener">Source file with all of the included root certificates</a>。下载完成后，可以使用 Perl 脚本或者 Go 脚本将 certdata.txt 文件转换为 PEM 格式。</p>
</li>
<li><p>从 Curl 获取最新的 PEM 格式的可信证书库：<a href="https://curl.haxx.se/docs/caextract.html" target="_blank" rel="noopener">CA certificates extracted from Mozilla</a>。</p>
</li>
</ol>
<h3 id="密钥和证书管理"><a href="#密钥和证书管理" class="headerlink" title="密钥和证书管理"></a>密钥和证书管理</h3><p><img src="http://upload-images.jianshu.io/upload_images/2648731-75a7cc75605adb76.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image"></p>
<p>首先，使用 OpenSSL 生成一个非对称加密算法的私钥，可选的密钥算法及密钥长度如下：</p>
<p><img src="http://upload-images.jianshu.io/upload_images/2648731-b4315cb588e8bb27.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="非对称加密算法"></p>
<h4 id="1-1-生成-RSA-2048-密钥-（-pem文件）"><a href="#1-1-生成-RSA-2048-密钥-（-pem文件）" class="headerlink" title="1.1 生成 RSA-2048 密钥 （.pem文件）"></a>1.1 生成 RSA-2048 密钥 （.pem文件）</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> 使用 genrsa 命令生成 RSA-2048 位的密钥</span><br><span class="line"><span class="meta">$</span> openssl genrsa -out rsa_private.key 2048</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> 使用 genrsa 命令生成 RSA-2048 位的密钥，并使用 AES-128 位算法保存密钥。</span><br><span class="line"><span class="meta">#</span> **********************************************************</span><br><span class="line"><span class="meta">#</span> 使用密码方式保护私钥只有在私钥并没有被放在生产环境服务器上的时候才有用。</span><br><span class="line"><span class="meta">#</span> **********************************************************</span><br><span class="line"><span class="meta">$</span> openssl genrsa -aes128 -out fd.key 2048</span><br><span class="line">Generating RSA private key, 2048 bit long modulus</span><br><span class="line">....+++</span><br><span class="line">..........................+++</span><br><span class="line">e is 65537 (0x10001) # e 表示公用指数，默认情况下会被设置为65 537。这是所谓的短公用指数(short public exponent)，它可以显著提高RSA的验证性能。</span><br><span class="line">Enter pass phrase for fd.key:huqilin0321</span><br><span class="line">Verifying - Enter pass phrase for fd.key:huqilin0321</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> 私钥以 PEM 格式存储</span><br><span class="line"><span class="meta">$</span> cat /opt/openssl/private/fd.key</span><br><span class="line">-----BEGIN RSA PRIVATE KEY----- # 第一行，表明它是一个私钥文件</span><br><span class="line">Proc-Type: 4,ENCRYPTED</span><br><span class="line">DEK-Info: AES-128-CBC,AEDB3A0F4369376615B5AB3D9E4E5FEA</span><br><span class="line"></span><br><span class="line">j9CwxBMf08WKTkQvM3Vi1W6TOQV6uEpfHtYxjy8/JhYsvhqH+EdMyB1ZSMPz+W8e</span><br><span class="line">...</span><br><span class="line">jZoL/+0fcuzX1O5oQkTpaoh1ZafJJROHSZh0nPiuGdIRWJtHUlmt1GgzXvOyIqzm</span><br><span class="line">-----END RSA PRIVATE KEY-----</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> 解析私钥结构</span><br><span class="line"><span class="meta">$</span> openssl rsa -text -in fd.key</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> 生成密钥的公开部分</span><br><span class="line"><span class="meta">$</span> openssl rsa -in fd.key -pubout -out fd-public.key</span><br><span class="line">Enter pass phrase for fd.key:</span><br><span class="line">writing RSA key</span><br><span class="line">root@ip-172-31-8-201:/opt/openssl/private# ls -l</span><br><span class="line">total 8</span><br><span class="line">-rw-r--r-- 1 root root  451 Jun 15 10:08 fd-public.key # 生成的密钥公开部分文件(公钥)</span><br><span class="line">-rw-r--r-- 1 root root 1766 Jun 15 09:39 fd.key        # 私钥</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> 查看密钥的公开部分</span><br><span class="line"><span class="meta">$</span> cat fd-public.key</span><br><span class="line">-----BEGIN PUBLIC KEY-----</span><br><span class="line">MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEA1M4fNC/NgH0bnb/oXcXH</span><br><span class="line">9hudaPYk2+xwDnMxzZBhhuPrOpq6wGkJMPl/5cN2zZRGE7wtdLa2Y1gPVlkVd7zv</span><br><span class="line">mSnZYLcXr1CW/Ipzs4Zqavz4aWIi3DiKElLG2lcR2YQY3d4YjEnHvzDotyvuQ7km</span><br><span class="line">rXwKx0TNr3xo0tQ8qwsGHMuyE6FSD9JxwpGHeLd4r9X9qrsGVTfx5yRdRTrgb+d0</span><br><span class="line">YFR+hV6Cv1JQVGHw5UTACioQ4WziABG8mZY1zzAENmB73zWB6NqunCr00R7RwwDP</span><br><span class="line">jfOt5cNRYdEBRy79FG/7RVY+QVvYwm/bv9nOnT2Kjdm/elLkHTcLCgO6M0QDmR/F</span><br><span class="line">oQIDAQAB</span><br><span class="line">-----END PUBLIC KEY-----</span><br></pre></td></tr></table></figure>
<h4 id="1-2-生成-ECDSA-256-密钥（-pem文件）"><a href="#1-2-生成-ECDSA-256-密钥（-pem文件）" class="headerlink" title="1.2 生成 ECDSA-256 密钥（.pem文件）"></a>1.2 生成 ECDSA-256 密钥（.pem文件）</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> 使用 secp256r1 命名曲线创建一个256位长度的 ECDSA 密钥，并使用 AES-128 位算法保存密钥。</span><br><span class="line"><span class="meta">$</span> openssl ecparam -genkey -name secp256r1 | openssl ec -out ec.key -aes128</span><br></pre></td></tr></table></figure>
<h4 id="2-创建证书签名申请（CSR文件）"><a href="#2-创建证书签名申请（CSR文件）" class="headerlink" title="2 创建证书签名申请（CSR文件）"></a>2 创建证书签名申请（CSR文件）</h4><p>参考：<a href="http://service.oray.com/question/4985.html" target="_blank" rel="noopener">SSL 证书请求文件 (CSR) 生成指南</a></p>
<p>CSR 是要求 CA 给证书签名的一种正式申请，该申请包含申请证书的实体的公钥以及该实体的某些信息。</p>
<ol>
<li><p>交互方式生成 CSR 文件：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> 使用私钥（fd.key）生成 CSR 文件（fd.csr）</span><br><span class="line"><span class="meta">$</span> sudo openssl req -new -key fd.key -out fd.csr</span><br><span class="line">Enter pass phrase for fd.key:</span><br><span class="line">You are about to be asked to enter information that will be incorporated</span><br><span class="line">into your certificate request.</span><br><span class="line">What you are about to enter is what is called a Distinguished Name or a DN.</span><br><span class="line">There are quite a few fields but you can leave some blank</span><br><span class="line">For some fields there will be a default value,</span><br><span class="line">If you enter '.', the field will be left blank.</span><br><span class="line"><span class="meta">#</span> ⚠️ 输入一个点（.）,该字段为空。键入回车键，则设置为默认值。</span><br><span class="line">-----</span><br><span class="line">Country Name (2 letter code) [AU]:CN # 国家</span><br><span class="line">State or Province Name (full name) [Some-State]:Shanghai # 省市</span><br><span class="line">Locality Name (eg, city) []:Shanghai # 地区</span><br><span class="line">Organization Name (eg, company) [Internet Widgits Pty Ltd]:Shanghai Clumsiest Information Co., Ltd. # 组织机构</span><br><span class="line">Organizational Unit Name (eg, section) []: # 单位部门</span><br><span class="line">Common Name (e.g. server FQDN or YOUR name) []: # 通用名</span><br><span class="line">Email Address []:clumsiest@outlook.com # 邮箱地址</span><br><span class="line"></span><br><span class="line">Please enter the following 'extra' attributes # 质询密码，留空</span><br><span class="line">to be sent with your certificate request</span><br><span class="line">A challenge password []:.</span><br><span class="line">An optional company name []:.</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> 检查 CSR 格式</span><br><span class="line"><span class="meta">$</span> openssl req -text -noout -in fd.csr</span><br></pre></td></tr></table></figure>
</li>
<li><p>用当前证书生成 CSR 文件：</p>
<p>更新一张证书，并且不想对里面的信息作任何更改。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span> openssl x509 -x509toreq -in fd.crt -out fd.csr -signkey fd.key</span><br></pre></td></tr></table></figure>
</li>
<li><p>非交互方式生成 CSR 文件：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> 3.1如果想自动生成www.feistyduck.com的CSR文件，可以先创建一个fd.cnf文件：</span><br><span class="line">[req]</span><br><span class="line">prompt = no</span><br><span class="line">distinguished_name = dn</span><br><span class="line">req_extensions = ext</span><br><span class="line">input_password = PASSPHRASE</span><br><span class="line"></span><br><span class="line">[dn]</span><br><span class="line">CN = www.feistyduck.com</span><br><span class="line">emailAddress = webmaster@feistyduck.com</span><br><span class="line">0 = Feisty Duck Ltd</span><br><span class="line">L = London</span><br><span class="line">C = GB</span><br><span class="line"></span><br><span class="line">[ext]</span><br><span class="line">subjectAltName = DNS:www.feistyduck.com,NDS:feistyduck.com</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> 3.2 使用如下命令直接创建 CSR 文件</span><br><span class="line"><span class="meta">$</span> openssl req -new -config fd.cnf -key fd.key -out fd.csr</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h4 id="3-1-自签名证书"><a href="#3-1-自签名证书" class="headerlink" title="3.1 自签名证书"></a>3.1 自签名证书</h4><ol>
<li><p>使用 CSR 创建自签名证书：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span> sudo openssl x509 -req -days 365 -in fd.csr -signkey fd.key -out fd.crt</span><br></pre></td></tr></table></figure>
</li>
<li><p>直接使用私钥创建自签名证书：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span> sudo openssl req -new -x509 -days 365 -key fd.key -out fd.crt</span><br><span class="line">Enter pass phrase for fd.key:</span><br><span class="line">You are about to be asked to enter information that will be incorporated</span><br><span class="line">into your certificate request.</span><br><span class="line">What you are about to enter is what is called a Distinguished Name or a DN.</span><br><span class="line">There are quite a few fields but you can leave some blank</span><br><span class="line">For some fields there will be a default value,</span><br><span class="line">If you enter '.', the field will be left blank.</span><br><span class="line">-----</span><br><span class="line">Country Name (2 letter code) [AU]:</span><br><span class="line">State or Province Name (full name) [Some-State]:</span><br><span class="line">Locality Name (eg, city) []:</span><br><span class="line">Organization Name (eg, company) [Internet Widgits Pty Ltd]:</span><br><span class="line">Organizational Unit Name (eg, section) []:</span><br><span class="line">Common Name (e.g. server FQDN or YOUR name) []:</span><br><span class="line">Email Address []:</span><br></pre></td></tr></table></figure>
</li>
<li><p>使用私钥非交互式创建自签名证书：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span> sudo openssl req -new -x509 -days 365 -key fd.key -out fd.crt -subj "/C=GB/L=London/O=Feisty Duck Ltd/CN=www.feistyduck.com"</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h4 id="3-2-创建对多个主机名有效的证书"><a href="#3-2-创建对多个主机名有效的证书" class="headerlink" title="3.2 创建对多个主机名有效的证书"></a>3.2 创建对多个主机名有效的证书</h4><p>默认情况下，OpenSSL 创建的证书只包含一个公用名而且只能设置一个主机名。</p>
<p>在一张证书中支持多主机名的两种方式：</p>
<ol>
<li><p>在 X.509 的使用者可选名称（SAN）扩展字段里面列出所有要使用的主机名；</p>
<ul>
<li><p>将扩展信息放在单独的文本文件中（fd.ext）,在该文件中指定扩展的名称:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">subjectAltName = DNS:*.feistyduck.com, DNS:feistyduck.com</span><br></pre></td></tr></table></figure>
</li>
<li><p>签发证书时，使用 <strong>-extfile</strong> 开关引用上述文件：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openssl x509 -req -days 365 -in fd.csr -signkey fd.key -out fd.crt -extfile fd.ext</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>使用泛域名证书；</p>
</li>
</ol>
<h4 id="3-3-检查证书"><a href="#3-3-检查证书" class="headerlink" title="3.3 检查证书"></a>3.3 检查证书</h4><p>x509 命令可以帮助我们解析并查看证书内容：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> -text:打印证书内容</span><br><span class="line"><span class="meta">#</span> -noout：不打印编码后的证书内容，以减少信息干扰</span><br><span class="line"><span class="meta">$</span> openssl x509 -text -noout -in fd.crt</span><br></pre></td></tr></table></figure>
<h4 id="使用-OpenSSL-快速创建自签名证书"><a href="#使用-OpenSSL-快速创建自签名证书" class="headerlink" title="使用 OpenSSL 快速创建自签名证书"></a>使用 OpenSSL 快速创建自签名证书</h4><blockquote>
<p>⚠️ 请勿在生产环境中使用自签名证书，自签名证书的唯一目的是测试。</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> 1.使用 genrsa 命令生成 RSA-2048 位私钥</span><br><span class="line"><span class="meta">$</span> openssl genrsa -out rsa_private.key 2048</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> 2.通过私钥生成证书</span><br><span class="line"><span class="meta">$</span> openssl req -new -x509 -days 365 -key rsa_private.key -out rsa_public.crt</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> 3.查看打印证书</span><br><span class="line"><span class="meta">$</span> openssl x509 -text -noout -in rsa_public.crt</span><br></pre></td></tr></table></figure>
<h4 id="密钥和证书格式转换"><a href="#密钥和证书格式转换" class="headerlink" title="密钥和证书格式转换"></a>密钥和证书格式转换</h4><h5 id="证书文件的类型"><a href="#证书文件的类型" class="headerlink" title="证书文件的类型"></a>证书文件的类型</h5><p>参考：<a href="https://help.aliyun.com/knowledge_detail/42214.html?spm=5176.2020520163.cas.58.2dba2b7aDehVwA&amp;accounttraceid=ffd6c2ba-4d55-4849-8553-9964575343da" target="_blank" rel="noopener">主流字证书都有哪些格式？</a></p>
<blockquote>
<ul>
<li><em>.DER 或 </em>.CER 文件： 这样的证书文件是二进制格式，只含有证书信息，不包含私钥。</li>
<li><em>.CRT 文件： 这样的证书文件可以是二进制格式，也可以是文本格式，一般均为文本格式，功能与 </em>.DER 及 *.CER 证书文件相同。</li>
<li><em>.PEM 文件： 这样的证书文件一般是文本格式，可以存放证书或私钥，或者两者都包含。 </em>.PEM 文件如果只包含私钥，一般用 *.KEY 文件代替。</li>
<li><em>.PFX 或 </em>.P12 文件： 这样的证书文件是二进制格式，同时包含证书和私钥，且一般有密码保护。</li>
</ul>
</blockquote>
<h5 id="PEM-和-DER-转换"><a href="#PEM-和-DER-转换" class="headerlink" title="PEM 和 DER 转换"></a>PEM 和 DER 转换</h5><p>使用x509工具进行PEM和DER格式之间的证书转换：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> 1. 从 PEM 转换到 DER：</span><br><span class="line"><span class="meta">$</span> openssl x509 -inform PEM -in fd.pem -outform DER -out fd.der</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> 2. 从 DER 转换到 PEM：</span><br><span class="line"><span class="meta">$</span> openssl x509 -infrom DER -in fd.der -outform PEM -out fd.pem</span><br></pre></td></tr></table></figure>
<h5 id="PKCS-12（PFX）转换"><a href="#PKCS-12（PFX）转换" class="headerlink" title="PKCS#12（PFX）转换"></a>PKCS#12（PFX）转换</h5><h5 id="PKCS-7转换"><a href="#PKCS-7转换" class="headerlink" title="PKCS#7转换"></a>PKCS#7转换</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> 1. 将 PEM 转换成 PKCS#7 格式：</span><br><span class="line"><span class="meta">$</span> openssl crl2pkcs7 -nocrl -out fd.p7b -certfile fd.crt -certfile fd-chain.crt</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> 2. 将 PKCS#7 转换成 PEM 格式：</span><br><span class="line"><span class="meta">$</span> openssl pkcs7 -in fd.p7b -print_certs -out fd.pem</span><br></pre></td></tr></table></figure>
<h3 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h3><h4 id="密码套件的配置"><a href="#密码套件的配置" class="headerlink" title="密码套件的配置"></a>密码套件的配置</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> 密码套件名称构成：密钥交换算法-身份验证算法-加密算法（加密方法-加密强度-模式）-MAC或PRF</span><br><span class="line"><span class="meta">#</span> 密钥交换方法：ECDHE &gt; DHE &gt; RSA</span><br><span class="line"><span class="meta">#</span> 身份验证方法：ECDSA 256 &gt; RSA 2048</span><br><span class="line"><span class="meta">#</span> 加密算法：AES-256-GCM、</span><br><span class="line"><span class="meta">#</span> PRF（伪随机函数）：HMAC、SHA256</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> 如：TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256</span><br><span class="line"><span class="meta">#</span> 如：TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384</span><br></pre></td></tr></table></figure>
<p>列出所有支持的套件列表</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span> openssl ciphers -V 'ALL:COMPLEMENTOFALL'</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> 推荐的配置，同时满足强加密和高性能</span><br><span class="line">ECDHE-ECDSA-AES128-GCM-SHA256 </span><br><span class="line">ECDHE-ECDSA-AES256-GCM-SHA384 </span><br><span class="line">ECDHE-ECDSA-AES128-SHA </span><br><span class="line">ECDHE-ECDSA-AES256-SHA </span><br><span class="line">ECDHE-ECDSA-AES128-SHA256 </span><br><span class="line">ECDHE-ECDSA-AES256-SHA384 </span><br><span class="line">ECDHE-RSA-AES128-GCM-SHA256 </span><br><span class="line">ECDHE-RSA-AES256-GCM-SHA384 </span><br><span class="line">ECDHE-RSA-AES128-SHA </span><br><span class="line">ECDHE-RSA-AES256-SHA </span><br><span class="line">ECDHE-RSA-AES128-SHA256 </span><br><span class="line">ECDHE-RSA-AES256-SHA384 </span><br><span class="line">DHE-RSA-AES128-GCM-SHA256 </span><br><span class="line">DHE-RSA-AES256-GCM-SHA384 </span><br><span class="line">DHE-RSA-AES128-SHA </span><br><span class="line">DHE-RSA-AES256-SHA </span><br><span class="line">DHE-RSA-AES128-SHA256 </span><br><span class="line">DHE-RSA-AES256-SHA256 </span><br><span class="line">EDH-RSA-DES-CBC3-SHA</span><br></pre></td></tr></table></figure>
<h4 id="性能评测"><a href="#性能评测" class="headerlink" title="性能评测"></a>性能评测</h4><p>使用 speed 命令评测系统的能力和上限</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span> openssl speed rc4 aes rsa ecdh sha</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> 让speed命令并发使用4核测试</span><br><span class="line"><span class="meta">$</span> openssl speed -multi 4 rsa</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> 支持AES-NI指令的服务器可以加速AES计算，使用-evp开关激活硬件加速卡</span><br><span class="line"><span class="meta">$</span> openssl speed -evp aes-128-cbc</span><br></pre></td></tr></table></figure>
<h3 id="创建私有证书颁发机构"><a href="#创建私有证书颁发机构" class="headerlink" title="创建私有证书颁发机构"></a>创建私有证书颁发机构</h3><h4 id="运行私有CA的最大挑战"><a href="#运行私有CA的最大挑战" class="headerlink" title="运行私有CA的最大挑战"></a>运行私有CA的最大挑战</h4><p>如何保证基础结构的安全？</p>
<ol>
<li>根密钥必须离线保存。</li>
<li>CRL和OSCP响应程序证书必须定期进行更新，而这会要求根密钥保持联机。</li>
</ol>
<p>创建全新CA的步骤：</p>
<ol>
<li>根CA配置；</li>
<li>创建根CA的目录结构和初始化密钥文件；</li>
<li>生成根CA的密钥和证书；</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> CA 中心生成自身私钥</span><br><span class="line">root@ip-172-31-8-201:/opt/openssl# (umask 077; openssl genrsa -out private/cakey.pem 2048)</span><br><span class="line">Generating RSA private key, 2048 bit long modulus</span><br><span class="line">...............+++</span><br><span class="line">...............................................................+++</span><br><span class="line">e is 65537 (0x10001)</span><br><span class="line">// 为了保证CA机构私钥的安全，需要把私钥文件权限设置为077</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> CA 签发自身公钥</span><br><span class="line">root@ip-172-31-8-201:/opt/openssl# openssl req -new -x509 -key private/cakey.pem -out cacert.pem -days 365</span><br><span class="line">You are about to be asked to enter information that will be incorporated</span><br><span class="line">into your certificate request.</span><br><span class="line">What you are about to enter is what is called a Distinguished Name or a DN.</span><br><span class="line">There are quite a few fields but you can leave some blank</span><br><span class="line">For some fields there will be a default value,</span><br><span class="line">If you enter '.', the field will be left blank.</span><br><span class="line">-----</span><br><span class="line">Country Name (2 letter code) [AU]:CN</span><br><span class="line">State or Province Name (full name) [Some-State]:Shanghai</span><br><span class="line">Locality Name (eg, city) []:Shanghai</span><br><span class="line">Organization Name (eg, company) [Internet Widgits Pty Ltd]:shanghai Clumsiest Information Co., Ltd.</span><br><span class="line">Organizational Unit Name (eg, section) []:Development Team</span><br><span class="line">Common Name (e.g. server FQDN or YOUR name) []:arlingbc.com</span><br><span class="line">Email Address []:clumsiest@outlook.com</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> 创建数据库文件及证书序列文件</span><br><span class="line">root@ip-172-31-8-201:/opt/openssl# ls -l</span><br><span class="line">total 52</span><br><span class="line">drwxr-xr-x 2 root root  4096 Jun 15 08:08 bin</span><br><span class="line">-rw-r--r-- 1 root root  1558 Aug 24 03:21 cacert.pem # CA 自身证书文件</span><br><span class="line">drwxr-xr-x 2 root root  4096 Jun 15 09:24 certs      # 客户端证书存放目录</span><br><span class="line">drwxr-xr-x 2 root root  4096 Aug 24 05:54 crl        # CA 吊销的客户端证书存放目录*</span><br><span class="line">drwxr-xr-x 3 root root  4096 Jun 15 08:08 include</span><br><span class="line">-rw-r--r-- 1 root root     0 Aug 24 05:56 index.txt  # 存放客户端证书信息*</span><br><span class="line">drwxr-xr-x 4 root root  4096 Jun 15 08:08 lib</span><br><span class="line">drwxr-xr-x 6 root root  4096 Jun 15 08:08 man</span><br><span class="line">drwxr-xr-x 2 root root  4096 Jun 15 08:08 misc</span><br><span class="line">drwxr-xr-x 2 root root  4096 Aug 24 05:55 newcerts   # 生成新证书存放目录*</span><br><span class="line">-rw-r--r-- 1 root root 10835 Jun 15 08:08 openssl.cnf</span><br><span class="line">drwxr-xr-x 2 root root  4096 Aug 24 03:11 private    # 存放 CA 自身私钥的目录</span><br><span class="line">-rw-r--r-- 1 root root     0 Aug 24 05:57 serial     # 客户端证书编号（编号可以自定义），用于识别客户端证书*</span><br></pre></td></tr></table></figure>
<h3 id="Let’s-Encrypt"><a href="#Let’s-Encrypt" class="headerlink" title="Let’s Encrypt"></a><a href="https://letsencrypt.org/" target="_blank" rel="noopener">Let’s Encrypt</a></h3><p><a href="https://imququ.com/post/letsencrypt-certificate.html" target="_blank" rel="noopener">Let’s Encrypt，免费好用的 HTTPS 证书</a></p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://andy0570.com/2018/08/15/PKI 体系/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="独木舟的木">
      <meta itemprop="description" content="有时候阳光很好 有时候阳光很暗">
      <meta itemprop="image" content="https://ws1.sinaimg.cn/large/006tNc79gy1g22m14458rj30u014xu0x.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="独木舟的木">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2018/08/15/PKI 体系/" class="post-title-link" itemprop="url">PKI 体系</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2018-08-15 14:39:00" itemprop="dateCreated datePublished" datetime="2018-08-15T14:39:00+08:00">2018-08-15</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2019-04-15 17:36:06" itemprop="dateModified" datetime="2019-04-15T17:36:06+08:00">2019-04-15</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/PKI-密码学/" itemprop="url" rel="index"><span itemprop="name">PKI&密码学</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          
            <span id="/2018/08/15/PKI 体系/" class="leancloud_visitors" data-flag-title="PKI 体系">
              <span class="post-meta-divider">|</span>
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              
                <span class="post-meta-item-text">阅读次数：</span>
              
                <span class="leancloud-visitors-count"></span>
            </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body han-init-context" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>CA中心——CA系统——数字证书</p>
<p>CA 中心管理并运营 CA 系统，CA 系统负责颁发数字证书。</p>
<p>专门负责颁发数字证书的系统称为 CA 系统，负责管理并运营 CA 系统的机构称为 CA 中心。所有与数字证书相关的各种概念和技术，统称为 PKI（Public Key Infrastructure）。</p>
</blockquote>
<h3 id="传统密码学"><a href="#传统密码学" class="headerlink" title="传统密码学"></a>传统密码学</h3><ul>
<li>换位加密法；</li>
<li>替换加密法；</li>
</ul>
<h3 id="现代密码学"><a href="#现代密码学" class="headerlink" title="现代密码学"></a>现代密码学</h3><p><img src="http://upload-images.jianshu.io/upload_images/2648731-89c03684f48a6c3c.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="现代密码学"></p>
<ul>
<li><strong>对称算法/密码密钥算法/单密钥算法</strong>：加密和解密使用同一密钥或加密和解密的密钥之间存在简单的、容易计算的互推关系。<ul>
<li>流密码算法又称序列密码算法，每次加密或解密一位或一字节的明文或密文。</li>
<li>分组密码算法将明文（密文）分成固定长度的数据块（比特块或字节块），用同一密钥和算法对每一明文（密文）块加密（解密）后得到等长的密文（明文）块，然后将密文（文）块按照顺序组合起来最终得到密文（明文）。</li>
</ul>
</li>
<li><strong>非对称算法/公钥算法</strong>：加密密钥（公钥）和解密密钥（私钥）不相同的密码算法。</li>
<li><strong>摘要算法/散列函数/哈希函数/杂凑函数</strong>：把任意长的输入消息数据转化成固定长度的输出数据的一种密码算法。</li>
<li><strong>数字签名</strong>：验证消息源及数据内容的真实性；签名能够被第三方验证，并确定消息内容的真实性和签名者身份。<ul>
<li>数字签名体制包括三个算法：密钥生成算法、签名算法、验证算法。</li>
</ul>
</li>
</ul>
<h4 id="数字签名"><a href="#数字签名" class="headerlink" title="数字签名"></a>数字签名</h4><p>消息加密只是解决了传送消息的保密问题，而防止他人对传输文件进行破坏，以及确定发信人的身份需要使用数字签名。完善的数字签名应具备签字方不能抵赖、他人不能伪造、在公证人面前能够验证真伪的能力。</p>
<h5 id="常用的数字签名方法："><a href="#常用的数字签名方法：" class="headerlink" title="常用的数字签名方法："></a>常用的数字签名方法：</h5><ul>
<li>RSA 签名；</li>
<li>DSS 签名；</li>
<li>Hash 签名；</li>
</ul>
<h5 id="数字签名原理："><a href="#数字签名原理：" class="headerlink" title="数字签名原理："></a>数字签名原理：</h5><p>报文的发送方从报文文本中生成一个固定长度的散列值（报文摘要）。发送方用自己的私钥对这个散列值进行加密来形成发送方的数字签名。然后，这个数字签名将作为报文的附件和报文一起发送给报文的接收方。报文的接收方首先从接收到的原始报文中计算出散列值，接着再用发送方的公钥来对报文附加的数字签名进行解密。如果两个散列值相同，那么接收方就能确认该数字签名是发送方的。通过数字签名能够实现对原始报文的鉴别。<br><img src="https://upload-images.jianshu.io/upload_images/2648731-4bfdf47ced515611.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/620" alt="数字签名原理"><br>采用数字签名，能够保证：</p>
<ol>
<li>信息是由签名者发送的；</li>
<li>信息自签发后到收到为止未曾有过任何修改；</li>
</ol>
<h5 id="数字签名与非对称加密的关系"><a href="#数字签名与非对称加密的关系" class="headerlink" title="数字签名与非对称加密的关系"></a>数字签名与非对称加密的关系</h5><blockquote>
<p>一言以蔽之，数字签名就是将<a href="https://www.wikiwand.com/zh-hans/%E5%85%AC%E9%92%A5%E5%AF%86%E7%A0%81" target="_blank" rel="noopener">公钥密码</a>反过来使用。</p>
</blockquote>
<ul>
<li>都使用公钥体系，但实现的方法正好相反，使用的密钥对也不同。</li>
<li><strong>数字签名</strong> 使用的是发送方的密钥对，发送方用自己的私钥进行加密，接收方用发送方的公开密钥进行解密。一对多关系。</li>
<li><strong>非对称加密</strong>的加密解密则使用的是接收方的密钥对，这是多对一的关系：任何知道接收方公开密钥的人都可以向接收方发送加密信息，只有唯一拥有接收方私有密钥的人才能对信息解密。</li>
<li>在实用过程中，通常一个用户拥有两个密钥对，一个密钥对用来进行数字签名，另一个密钥对用来进行非对称加密，这种方式提供了更高的安全性。</li>
</ul>
<h3 id="密钥管理"><a href="#密钥管理" class="headerlink" title="密钥管理"></a>密钥管理</h3><p><img src="http://upload-images.jianshu.io/upload_images/2648731-47a32d37d5491925.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image"></p>
<h3 id="密钥管理模式"><a href="#密钥管理模式" class="headerlink" title="密钥管理模式"></a>密钥管理模式</h3><ul>
<li>无中心模式；</li>
<li>有中心模式；</li>
</ul>
<h3 id="PKI-的本质是把非对称密钥管理标准化"><a href="#PKI-的本质是把非对称密钥管理标准化" class="headerlink" title="PKI 的本质是把非对称密钥管理标准化"></a>PKI 的本质是把非对称密钥管理标准化</h3><p>PKI 是 Public Key Infrastructure 的缩写，其主要功能是绑定证书持有者的身份和相关的密钥对（通过为公钥及相关的用户身份信息签发数字证书），为用户提供方便的证书申请、证书作废、证书获取、证书状态查询的途径，并利用数字证书及相关的各种服务（证书发布，黑名单发布，时间戳服务等）实现通信中各实体的身份认证、完整性、抗抵赖性和保密性。</p>
<p><img src="http://upload-images.jianshu.io/upload_images/2648731-248d8cbb3257e59d.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image"></p>
<ul>
<li><strong>数字证书</strong>：解决公钥与用户映射关系问题；</li>
<li><strong>CA</strong>：解决数字证书签发问题；<br><img src="http://upload-images.jianshu.io/upload_images/2648731-2022dcdcebc24edd.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image"></li>
<li><strong>KMC</strong>：解决私钥的备份与恢复问题；</li>
<li><strong>双证书机制</strong>：「签名证书及私钥」只用于签名验签，「加密证书及私钥」只用于加密解密。</li>
<li><strong>LDAP</strong>：解决数字证书查询和下载的性能问题，避免 CA 中心成为性能瓶颈。</li>
<li><strong>CRL（证书作废列表）</strong> 和 <strong>OSCP（在线证书状态协议）</strong>：方便用户快速获得证书状态。</li>
<li><strong>RA</strong>：方便证书业务远程办理、方便证书管理流程与应用系统结合。</li>
<li><strong>电子认证服务机构</strong>：保证 CA 系统在数字证书管理方面的规范性、合规性和安全性。</li>
</ul>
<h3 id="基于数字证书可以实现四种基本安全功能："><a href="#基于数字证书可以实现四种基本安全功能：" class="headerlink" title="基于数字证书可以实现四种基本安全功能："></a>基于数字证书可以实现四种基本安全功能：</h3><ol>
<li>身份认证；</li>
<li>保密性；</li>
<li>完整性；</li>
<li>抗抵赖性；</li>
</ol>
<h3 id="数字证书分类"><a href="#数字证书分类" class="headerlink" title="数字证书分类"></a>数字证书分类</h3><p><img src="http://upload-images.jianshu.io/upload_images/2648731-3b40c81976c04e57.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image"></p>
<h3 id="PKI-基本组件"><a href="#PKI-基本组件" class="headerlink" title="PKI 基本组件"></a>PKI 基本组件</h3><p>完整的 PKI 系统必须具有数字证书、认证中心（CA）、证书资料库、证书吊销系统、密钥备份及恢复系统、PKI 应用接口系统等构成部分。</p>
<table>
<thead>
<tr>
<th>组件</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>数字证书</td>
<td>包含了用于签名和加密数据的公钥的电子凭证，是PKI的核心元素</td>
</tr>
<tr>
<td>认证中心（CA）</td>
<td>数字证书的申请及签发机关，CA必须具备权威性</td>
</tr>
<tr>
<td>证书资料库</td>
<td>存储已签发的数字证书和公钥，以及相关证书目录，用户可由此获得所需的其他用户的证书及公钥</td>
</tr>
<tr>
<td>证书吊销列表（CRL）/OCSP</td>
<td>在有效期内吊销的证书列表，在线证书状态协议OCSP是获得证书状态的国际协议</td>
</tr>
<tr>
<td>密钥备份及恢复</td>
<td>为避免因用户丢失解密密钥而无法解密合法数据的情况，PKI提供备份与恢复密钥的机制。必须由可信的机构来完成。并且，密钥备份与恢复只能针对解密密钥，签名私钥不能够作备份</td>
</tr>
<tr>
<td>PKI应用接口（API）</td>
<td>为各种各样的应用提供安全、一致、 可信的方式与PKI交互，确保建立起来的网络环境安全可靠，并降低管理成本</td>
</tr>
</tbody>
</table>
<h3 id="PKI-画外音"><a href="#PKI-画外音" class="headerlink" title="PKI 画外音"></a>PKI 画外音</h3><ul>
<li><a href="http://www.jiemian.com/article/231843.html" target="_blank" rel="noopener">OpenSSL 隐形战友</a></li>
<li><a href="https://www.zhihu.com/question/21838720/answer/62574832" target="_blank" rel="noopener">知乎：为什么 SSL 证书那么贵?</a></li>
<li><a href="https://www.zhihu.com/question/19578422" target="_blank" rel="noopener">知乎：SSL 证书服务，大家用哪家的？</a></li>
<li><a href="https://www.cnblogs.com/LittleHann/p/3738141.html" target="_blank" rel="noopener">openSSL 命令、PKI、CA、SSL 证书原理</a></li>
<li><a href="https://blog.csdn.net/xiyuan1999/article/details/6416948" target="_blank" rel="noopener">OpenSSL 中文手册 之一 OpenSSL 简介－证书</a></li>
</ul>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://andy0570.com/2017/11/01/笔记：密码学/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="独木舟的木">
      <meta itemprop="description" content="有时候阳光很好 有时候阳光很暗">
      <meta itemprop="image" content="https://ws1.sinaimg.cn/large/006tNc79gy1g22m14458rj30u014xu0x.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="独木舟的木">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2017/11/01/笔记：密码学/" class="post-title-link" itemprop="url">密码学笔记</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2017-11-01 16:47:00" itemprop="dateCreated datePublished" datetime="2017-11-01T16:47:00+08:00">2017-11-01</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2019-04-15 17:17:56" itemprop="dateModified" datetime="2019-04-15T17:17:56+08:00">2019-04-15</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/PKI-密码学/" itemprop="url" rel="index"><span itemprop="name">PKI&密码学</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          
            <span id="/2017/11/01/笔记：密码学/" class="leancloud_visitors" data-flag-title="密码学笔记">
              <span class="post-meta-divider">|</span>
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              
                <span class="post-meta-item-text">阅读次数：</span>
              
                <span class="leancloud-visitors-count"></span>
            </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body han-init-context" itemprop="articleBody">

      
      

      
        
          
            <p>视频笔记:加密算法之— —密码学详解</p>
<h2 id="密码学概论-讲述密码学运用领域和使用场景"><a href="#密码学概论-讲述密码学运用领域和使用场景" class="headerlink" title="密码学概论,讲述密码学运用领域和使用场景"></a>密码学概论,讲述密码学运用领域和使用场景</h2><p>网络安全&amp;&amp;数据安全</p>
<p>示例：控制台 —&gt;  /var/log —&gt; apache2 服务器 （明文传输数据，不安全！）</p>
<p>原则：</p>
<ol>
<li><strong>在网络上不允许明文传输用户隐私信息；</strong></li>
<li><strong>在本地不允许明文保存用户隐私信息；</strong></li>
</ol>
<p>加密 — 密码学</p>
<h3 id="base64-编码"><a href="#base64-编码" class="headerlink" title="base64 编码 "></a><a href="https://en.wikipedia.org/wiki/Base64" target="_blank" rel="noopener">base64 编码 </a></h3><p>可以将<strong>二进制数据</strong>进行编码，编码成只有<strong>65个字符</strong>的<strong>文本文件</strong>（字符）！</p>
<p>字符：0 ～9, a~z, A~Z, +/=</p>
<p>编码后文件数据会比原有文件大1/3左右。</p>
<h4 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h4><p>base64编码：<strong>8位的二进制ASCII编码 —&gt; 6位的base64编码</strong></p>
<p>base64编码表：</p>
<p>0～63，64个字符，还有 = 表示空格，总共65个字符。</p>
<p><img src="http://upload-images.jianshu.io/upload_images/2648731-ce9a5abf9bbc4092.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt></p>
<p>示例：</p>
<p><img src="http://upload-images.jianshu.io/upload_images/2648731-4a9b63ce70fb6afb.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt></p>
<p>Man 转换为 base64 编码：TWFu</p>
<p>M 的 <a href="https://baike.baidu.com/item/ASCII/309296?fr=aladdin&amp;fromid=19660475&amp;fromtitle=ascii码表" target="_blank" rel="noopener">ASCII编码</a> 十进制为 77 ，二进制为 01001101：</p>
<p><img src="http://upload-images.jianshu.io/upload_images/2648731-8a4afbc8714b78be.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt></p>
<p>前6位二进制 010011 （十进制为19）在上面的base64编码表中为 T 。</p>
<p>因此 M ➡ T 。</p>
<h4 id="空格情况"><a href="#空格情况" class="headerlink" title="空格情况"></a>空格情况</h4><p>因为是把8个字节转换为6个字节进行编码，势必会产生位数不对应的问题。因此会使用 0 来补齐，用=表示全0的情况。（注意到base64 总会编码补齐为4个字符一组）</p>
<p><img src="http://upload-images.jianshu.io/upload_images/2648731-2ae8f0ea2c71aa4a.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt></p>
<p>因此，单独的 M 用base64编码 ➡ TQ==</p>
<h3 id="Objective-C-代码"><a href="#Objective-C-代码" class="headerlink" title="Objective-C 代码"></a>Objective-C 代码</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">// base64编码</span><br><span class="line">- (NSString *)base64Encode:(NSString *)string &#123;</span><br><span class="line">    // 1.将字符串转换为二进制</span><br><span class="line">    NSData *data = [string dataUsingEncoding:NSUTF8StringEncoding];</span><br><span class="line">    // 2.二进制数据进行编码</span><br><span class="line">    return [data base64EncodedStringWithOptions:0];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// base64解码</span><br><span class="line">- (NSString *)base64Decode:(NSString *)string &#123;</span><br><span class="line">    // 1.字符串转换为二进制</span><br><span class="line">    NSData *data = [[NSData alloc] initWithBase64EncodedString:string options:0];</span><br><span class="line">    // 2.解码</span><br><span class="line">    return [[NSString alloc] initWithData:data encoding:NSUTF8StringEncoding];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>##哈希算法\对称加密\非对称加密 算法简介</p>
<p>上世纪70年代开始 RSA — 非对称加密算法</p>
<p>RSA — 非对称加密算法</p>
<ul>
<li>公钥加密，私钥解密；</li>
<li>私钥加密，公钥解密；</li>
</ul>
<p>哈希（散列）函数</p>
<ul>
<li>MD5</li>
<li>SHA1\SHA256\SHA512</li>
<li>HMAC</li>
</ul>
<p>对称加密算法</p>
<ul>
<li>DES</li>
<li>3DES</li>
<li>RC2、RC4</li>
<li>AES(高级密码标准，美国国家安全局使用、Apple 钥匙串访问使用、Lastpass 使用了256位的AES密钥)，以目前现阶段计算机的运行效率，要暴力破解AES加密算法，需要上千万年。</li>
</ul>
<h3 id="散列函数"><a href="#散列函数" class="headerlink" title="散列函数"></a>散列函数</h3><p>算法都是公开的。</p>
<ul>
<li>对相同的数据加密，得到的结果是一样的。</li>
<li>对不同的数据加密，得到的结果是定长的。（比如MD5对不同的数据加密，得到32个字符）</li>
<li>加密之后的数据是没法解密的。（<strong>不可逆运算</strong>）</li>
</ul>
<h4 id="MD5加密"><a href="#MD5加密" class="headerlink" title="MD5加密"></a>MD5加密</h4><p><a href="https://github.com/jerolimov/NSHash" target="_blank" rel="noopener">GitHub源码：jerilimov/<strong>NSHash</strong></a>——NSData、NSString 的分类，添加了MD5、SHA1、SHA256、SHA512 加密算法</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">NSString *pwd = @&quot;123456&quot;;</span><br><span class="line">pwd = [pwd MD5];</span><br><span class="line">NSLog(@&quot;MD5 = %@&quot;,pwd);</span><br><span class="line">// MD5 = e10adc3949ba59abbe56e057f20f883e</span><br></pre></td></tr></table></figure>
<p>像 MD5 这样的加密算法是<strong>无法反向解密</strong>的，但是对相同的数据加密，得到的结果是一样的。</p>
<p>于是 <a href="http://www.cmd5.com" target="_blank" rel="noopener">CMD5</a> 利用散列函数的这种特性，将加密前的数据和加密后的数据进行映射保存，可以实现反向查询。</p>
<p>将刚才 123456 加密后的 MD5 输入，可以反向查询出原始数据：</p>
<p><img src="http://upload-images.jianshu.io/upload_images/2648731-485d8e0cda61ddfe.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt></p>
<h4 id="MD5加盐：对数据先加盐，再进行MD5加密，可以增加结果的复杂度"><a href="#MD5加盐：对数据先加盐，再进行MD5加密，可以增加结果的复杂度" class="headerlink" title="MD5加盐：对数据先加盐，再进行MD5加密，可以增加结果的复杂度"></a>MD5加盐：对数据先加盐，再进行MD5加密，可以增加结果的复杂度</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">/* 盐，足够长，足够复杂，足够咸*/</span><br><span class="line">static NSString *slat = @&quot;5O9Jc!9%N^6Kd*dcS9Or$&amp;fSVWmC^xku2@Lg0xd8CL0Sl$omN6zQS7c7YrHhtwn@&quot;;</span><br><span class="line"></span><br><span class="line">NSString *pwd = @&quot;123456&quot;;</span><br><span class="line">pwd = [[pwd stringByAppendingString:slat] MD5];</span><br><span class="line">NSLog(@&quot;MD5 = %@&quot;,pwd);</span><br><span class="line">// MD5 = 04f60881265e2b240b217f8deaaa8e12</span><br></pre></td></tr></table></figure>
<p>再将此MD5密码放到该网站上进行查询：</p>
<p><img src="http://upload-images.jianshu.io/upload_images/2648731-21e14f89f0661e9a.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt></p>
<blockquote>
<p>没有查到，结果显示，被反向查询出来的难度就会加大。</p>
</blockquote>
<p>缺点：盐是固定的，如果盐被泄露，数据就会不安全。</p>
<h4 id="HMAC加密"><a href="#HMAC加密" class="headerlink" title="HMAC加密"></a>HMAC加密</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line">//-----------------------------------------------------</span><br><span class="line">#import &lt;Foundation/Foundation.h&gt;</span><br><span class="line"></span><br><span class="line">@interface NSString (Hash)</span><br><span class="line">- (NSString *)hmacMD5StringWithKey:(NSString *)key;</span><br><span class="line">- (NSString *)hmacSHA1StringWithKey:(NSString *)key;</span><br><span class="line">- (NSString *)hmacSHA256StringWithKey:(NSString *)key;</span><br><span class="line">- (NSString *)hmacSHA512StringWithKey:(NSString *)key;</span><br><span class="line">@end</span><br><span class="line">  </span><br><span class="line">#import &quot;NSString+Hash.h&quot;</span><br><span class="line">#import &lt;CommonCrypto/CommonHMAC.h&gt;</span><br><span class="line">@implementation NSString (Hash)</span><br><span class="line"></span><br><span class="line">- (NSString *)hmacMD5StringWithKey:(NSString *)key</span><br><span class="line">&#123;</span><br><span class="line">    return [self hmacStringUsingAlg:kCCHmacAlgMD5 withKey:key];</span><br><span class="line">&#125;</span><br><span class="line">- (NSString *)hmacSHA1StringWithKey:(NSString *)key</span><br><span class="line">&#123;</span><br><span class="line">    return [self hmacStringUsingAlg:kCCHmacAlgSHA1 withKey:key];</span><br><span class="line">&#125;</span><br><span class="line">- (NSString *)hmacSHA256StringWithKey:(NSString *)key</span><br><span class="line">&#123;</span><br><span class="line">    return [self hmacStringUsingAlg:kCCHmacAlgSHA256 withKey:key];</span><br><span class="line">&#125;</span><br><span class="line">- (NSString *)hmacSHA512StringWithKey:(NSString *)key</span><br><span class="line">&#123;</span><br><span class="line">    return [self hmacStringUsingAlg:kCCHmacAlgSHA512 withKey:key];</span><br><span class="line">&#125;</span><br><span class="line">#pragma mark - Helpers</span><br><span class="line">- (NSString *)hmacStringUsingAlg:(CCHmacAlgorithm)alg withKey:(NSString *)key</span><br><span class="line">&#123;</span><br><span class="line">    size_t size;</span><br><span class="line">    switch (alg) &#123;</span><br><span class="line">        case kCCHmacAlgMD5:</span><br><span class="line">            size = CC_MD5_DIGEST_LENGTH;</span><br><span class="line">            break;</span><br><span class="line">        case kCCHmacAlgSHA1:</span><br><span class="line">            size = CC_SHA1_DIGEST_LENGTH;</span><br><span class="line">            break;</span><br><span class="line">        case kCCHmacAlgSHA224:</span><br><span class="line">            size = CC_SHA224_DIGEST_LENGTH;</span><br><span class="line">            break;</span><br><span class="line">        case kCCHmacAlgSHA256:</span><br><span class="line">            size = CC_SHA256_DIGEST_LENGTH;</span><br><span class="line">            break;</span><br><span class="line">        case kCCHmacAlgSHA384:</span><br><span class="line">            size = CC_SHA384_DIGEST_LENGTH;</span><br><span class="line">            break;</span><br><span class="line">        case kCCHmacAlgSHA512:</span><br><span class="line">            size = CC_SHA512_DIGEST_LENGTH;</span><br><span class="line">            break;</span><br><span class="line">        default:</span><br><span class="line">            return nil;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    NSData *keyData = [key dataUsingEncoding:NSUTF8StringEncoding];</span><br><span class="line">    NSData *messageData = [self dataUsingEncoding:NSUTF8StringEncoding];</span><br><span class="line">    NSMutableData *mutableData = [NSMutableData dataWithLength:size];</span><br><span class="line">    CCHmac(alg, keyData.bytes, keyData.length, messageData.bytes, messageData.length, mutableData.mutableBytes);</span><br><span class="line">    return [self stringFromBytes:(unsigned char *)mutableData.bytes length:(int)mutableData.length];</span><br><span class="line">&#125;</span><br><span class="line">- (NSString *)stringFromBytes:(unsigned char *)bytes length:(int)length</span><br><span class="line">&#123;</span><br><span class="line">    NSMutableString *mutableString = @&quot;&quot;.mutableCopy;</span><br><span class="line">    for (int i = 0; i &lt; length; i++)</span><br><span class="line">        [mutableString appendFormat:@&quot;%02x&quot;, bytes[i]];</span><br><span class="line">    return [NSString stringWithString:mutableString];</span><br><span class="line">&#125;</span><br><span class="line">@end</span><br></pre></td></tr></table></figure>
<p>测试</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">// HMAC 用一个密钥加密，并且做了两次散列。</span><br><span class="line">// 在实际的开发中，密钥来自于服务器。——对应一个帐号，一个KEY</span><br><span class="line">NSString *pwd = @&quot;123456&quot;;</span><br><span class="line">pwd = [pwd hmacMD5StringWithKey:@&quot;Key&quot;];</span><br><span class="line">NSLog(@&quot;MD5 = %@&quot;,pwd);</span><br><span class="line">// MD5 = a7cac7471d2c9eb7a944e07d44d305ca</span><br></pre></td></tr></table></figure>
<p>将此MD5密码放到该网站上查询也是查不到的。</p>
<p>项目实际使用流程：</p>
<ol>
<li>服务器根据用户帐号生成KEY，发送给客户端；</li>
<li>客户端获得KEY并保存到本地，使用KEY对数据进行HMAC加密，将加密后的数据发送给服务器；</li>
<li>服务器对加密后对数据进行验证。</li>
</ol>
<p>客户端登录时，没有KEY就先根据帐号从服务器获取KEY保存到本地，再将获得的KEY对密码进行加密。</p>
<p>防止KEY泄露，对KEY进行非对称加密、定期更换KEY。</p>
<p>QQ设备锁：</p>
<ul>
<li>本地有KEY——为授权手机。</li>
<li>本地没有KEY，未授权设备，需要允许服务器发送KEY。允许一次登录，本地不保存KEY，允许多次登录，保存KEY到本地。</li>
<li>短信验证码登录获取KEY。</li>
<li>申诉获取KEY。</li>
</ul>
<h4 id="HMAC加密-时间戳（不加秒）"><a href="#HMAC加密-时间戳（不加秒）" class="headerlink" title="HMAC加密+时间戳（不加秒）"></a>HMAC加密+时间戳（不加秒）</h4><p>之前：</p>
<p>验证方式：HMAC密码直接匹配是否正确。</p>
<p>现在：</p>
<p>客户端：（HMAC密码+“201711010358”）.MD5校验</p>
<p>服务器：</p>
<ol>
<li>（HMAC密码+“201711010359”）.MD5校验</li>
<li>（HMAC密码+“201711010358”）.MD5校验</li>
</ol>
<p><strong>密码验证有效期最长2分钟</strong>，超过2分钟，验证失败。</p>
<p>有经验的服务器人员，会在返回数据时，返回时间戳。</p>
<p>登录等待时间，不要超过6秒！！！提示用户：你的网络不稳定，请稍后再试！</p>
<p>终端测试命令：</p>
<p><code>md5 -s &quot;string&quot; #这是 Apple 用的 openssl 标准进行的MD5加密</code></p>
<h2 id="MD5使用场景-百度搜索引擎-拆词搜索思路-运用-以及百度云盘文件识别运用"><a href="#MD5使用场景-百度搜索引擎-拆词搜索思路-运用-以及百度云盘文件识别运用" class="headerlink" title="MD5使用场景,百度搜索引擎(拆词搜索思路)运用 以及百度云盘文件识别运用"></a>MD5使用场景,百度搜索引擎(拆词搜索思路)运用 以及百度云盘文件识别运用</h2><h4 id="搜索引擎的拆词搜索-amp-amp-词库"><a href="#搜索引擎的拆词搜索-amp-amp-词库" class="headerlink" title="搜索引擎的拆词搜索 &amp;&amp; 词库"></a>搜索引擎的拆词搜索 &amp;&amp; 词库</h4><p>无论搜索 <code>Apple Blue Sky</code>,还是搜索<code>Sky Blue Apple</code>,得到的返回结果是一样的。</p>
<h5 id="原理-1"><a href="#原理-1" class="headerlink" title="原理"></a>原理</h5><p>先计算各个单词的MD5</p>
<ul>
<li>MD5 (“Apple”) = 9f6290f4436e5a2351f12e03b6433c3c</li>
<li>MD5 (“Blue”) = 9594eec95be70e7b1710f730fdda33d9</li>
<li>MD5 (“Sky”) = 03462a41aec357b74c89eb8d272532f7</li>
</ul>
<hr>
<p>然后再对MD5值进行按位相加，得到的结果是一样的。</p>
<p>再去搜索匹配结果的数据。</p>
<h4 id="散列碰撞：两个不同的数据，哈希之后，得到相同的哈希值！"><a href="#散列碰撞：两个不同的数据，哈希之后，得到相同的哈希值！" class="headerlink" title="散列碰撞：两个不同的数据，哈希之后，得到相同的哈希值！"></a>散列碰撞：两个不同的数据，哈希之后，得到相同的哈希值！</h4><p>从理论的角度出发，有无限个碰撞可能！</p>
<p>MD5 32为字符，它能表达的数据个数是有限的，而被加密的数据是无限个。 </p>
<p>SHA512/</p>
<p>####其他使用场景</p>
<p>通过数据的散列值，判断数据是否相等，保存云盘数据（相同的数据在云上保存一份）。</p>
<p>正版软件使用哈希进行文件识别。</p>
<p>对下载后的软件安装版进行MD5校验，判断安装包是否被污染。</p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  


          </div>
          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <div class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image" src="https://ws1.sinaimg.cn/large/006tNc79gy1g22m14458rj30u014xu0x.jpg" alt="独木舟的木">
            
              <p class="site-author-name" itemprop="name">独木舟的木</p>
              <div class="site-description motion-element" itemprop="description">有时候阳光很好 有时候阳光很暗</div>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/">
                
                    <span class="site-state-item-count">10</span>
                    <span class="site-state-item-name">日志</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-categories">
                  
                    
                      <a href="/categories/">
                    
                  
                    
                    
                      
                    
                    <span class="site-state-item-count">1</span>
                    <span class="site-state-item-name">分类</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-tags">
                  
                    
                      <a href="/tags/">
                    
                  
                    
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">2</span>
                    <span class="site-state-item-name">标签</span>
                  </a>
                </div>
              
            </nav>
          

          
            <div class="feed-link motion-element">
              <a href="/atom.xml" rel="alternate">
                <i class="fa fa-rss"></i>
                RSS
              </a>
            </div>
          

          

          
            <div class="links-of-author motion-element">
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                    
                  
                  <a href="https://github.com/Andy0570" title="GitHub &rarr; https://github.com/Andy0570" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i>GitHub</a>
                </span>
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                    
                  
                  <a href="mailto:andywhm@163.com" title="E-Mail &rarr; mailto:andywhm@163.com" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                </span>
              
            </div>
          

          
             <div class="cc-license motion-element" itemprop="license">
              
              
                
              
              
              
              <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" class="cc-opacity" rel="noopener" target="_blank"><img src="/images/cc-by-nc-sa.svg" alt="Creative Commons"></a>
             </div>
          

          
          

          
            
          
          

        </div>
      </div>

      

      

    </div>
  </aside>
  


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">独木舟的木</span>

  

  
</div>


  <div class="powered-by">由 <a href="https://hexo.io" class="theme-link" rel="noopener" target="_blank">Hexo</a> 强力驱动 v3.8.0</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 – <a href="https://theme-next.org" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> v7.1.0</div>




        








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

    

    
  </div>

  

<script>
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>





  



  






  



  
    
    
      
    
  
  <script color="17,119,176" opacity="0.5" zindex="-1" count="99" src="//cdn.jsdelivr.net/gh/theme-next/theme-next-canvas-nest@1/canvas-nest.min.js"></script>













  
  <script src="//cdn.jsdelivr.net/npm/jquery@2/dist/jquery.min.js"></script>

  
  <script src="//cdn.jsdelivr.net/npm/fastclick@1/lib/fastclick.min.js"></script>

  
  <script src="//cdn.jsdelivr.net/npm/jquery-lazyload@1/jquery.lazyload.min.js"></script>

  
  <script src="//cdn.jsdelivr.net/npm/velocity-animate@1/velocity.min.js"></script>

  
  <script src="//cdn.jsdelivr.net/npm/velocity-animate@1/velocity.ui.min.js"></script>

  
  <script src="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.js"></script>


  


  <script src="/js/utils.js?v=7.1.0"></script>

  <script src="/js/motion.js?v=7.1.0"></script>



  
  


  <script src="/js/affix.js?v=7.1.0"></script>

  <script src="/js/schemes/pisces.js?v=7.1.0"></script>




  

  


  <script src="/js/next-boot.js?v=7.1.0"></script>


  

  

  
  
  
    
  

  
    
      
    
  

  
  
  
    <script src="//cdn.jsdelivr.net/npm/quicklink@1/dist/quicklink.umd.js"></script>
    <script>
      
        window.addEventListener('load', () => {
      
        quicklink({
          timeout: 3000,
          priority: true,
          ignores: [uri => uri.includes('#'),uri => uri == 'https://andy0570.com/',]
        });
      
        });
      
    </script>
  


  



  



  
  
  
    
  
  <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/instantsearch.js@2/dist/instantsearch.min.css">

  
  
    
  
  <script src="//cdn.jsdelivr.net/npm/instantsearch.js@2/dist/instantsearch.js"></script>
  

  <script src="/js/algolia-search.js?v=7.1.0"></script>



  
  
  <script>
    
    function showTime(Counter) {
      var entries = [];
      var $visitors = $('.leancloud_visitors');

      $visitors.each(function() {
        entries.push( $(this).attr('id').trim() );
      });

      Counter('get', '/classes/Counter', { where: JSON.stringify({ url: { '$in': entries } }) })
        .done(function({ results }) {
          var COUNT_CONTAINER_REF = '.leancloud-visitors-count';

          if (results.length === 0) {
            $visitors.find(COUNT_CONTAINER_REF).text(0);
            return;
          }

          for (var i = 0; i < results.length; i++) {
            var item = results[i];
            var url = item.url;
            var time = item.time;
            var element = document.getElementById(url);

            $(element).find(COUNT_CONTAINER_REF).text(time);
          }
          for (var i = 0; i < entries.length; i++) {
            var url = entries[i];
            var element = document.getElementById(url);
            var countSpan = $(element).find(COUNT_CONTAINER_REF);
            if (countSpan.text() == '') {
              countSpan.text(0);
            }
          }
        })
        .fail(function ({ responseJSON }) {
          console.log('LeanCloud Counter Error: ' + responseJSON.code + ' ' + responseJSON.error);
        });
    }
    

    $(function() {
      $.get('https://app-router.leancloud.cn/2/route?appId=' + 'S7i1Y8YorMKFPaYbJbekD5el-gzGzoHsz')
        .done(function({ api_server }) {
          var Counter = function(method, url, data) {
            return $.ajax({
              method: method,
              url: 'https://' + api_server + '/1.1' + url,
              headers: {
                'X-LC-Id': 'S7i1Y8YorMKFPaYbJbekD5el-gzGzoHsz',
                'X-LC-Key': 'brOnU8mOQvSjpipJvdKUAIbU',
                'Content-Type': 'application/json',
              },
              data: data
            });
          };
          
            if ($('.post-title-link').length >= 1) {
              showTime(Counter);
            }
          
        });
    });
  </script>



  

  

  

  

  

  

  

  

  
  
  
    
  
  <script src="//cdn.jsdelivr.net/npm/pangu@4/dist/browser/pangu.min.js"></script>
  <script>pangu.spacingPage();</script>


  
  
  
    
  
  <script src="//cdn.jsdelivr.net/gh/theme-next/theme-next-bookmark@1/bookmark.min.js"></script>
  <script>
  
    bookmark.loadBookmark();
  
  </script>


  

  

  


  <!-- red heart -->
  <script type="text/javascript" src="/js/src/love.js"></script>
  
</body>
</html>
