<!DOCTYPE html>












  


<html class="theme-next gemini use-motion" lang="zh-CN">
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">




  
  
    
      
    
    
      
    
  <script src="//cdn.jsdelivr.net/npm/pace-js@1/pace.min.js"></script>
  <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/pace-js@1/themes/blue/pace-theme-minimal.css">



  
  
    
  
  <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/han-css@3/dist/han.min.css">













  
  
    
  
  <link rel="stylesheet" href="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.css">







  

<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/font-awesome@4/css/font-awesome.min.css">

<link rel="stylesheet" href="/css/main.css?v=7.1.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/panda/apple-touch-icon.png?v=7.1.0">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/panda/favicon-32x32.png?v=7.1.0">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/panda/favicon-16x16.png?v=7.1.0">


  <link rel="mask-icon" href="/images/panda/safari-pinned-tab.svg?v=7.1.0" color="#222">


  <link rel="manifest" href="/images/panda/site.webmanifest">


  <meta name="msapplication-config" content="/images/panda/browserconfig.xml">





<script id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '7.1.0',
    sidebar: {"position":"left","display":"post","offset":12,"onmobile":false,"dimmer":false},
    back2top: true,
    back2top_sidebar: false,
    fancybox: true,
    fastclick: true,
    lazyload: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  <meta name="description" content="æœ‰æ—¶å€™é˜³å…‰å¾ˆå¥½ æœ‰æ—¶å€™é˜³å…‰å¾ˆæš—">
<meta name="keywords" content="ç‹¬æœ¨èˆŸçš„æœ¨">
<meta property="og:type" content="website">
<meta property="og:title" content="ç‹¬æœ¨èˆŸçš„æœ¨">
<meta property="og:url" content="https://andy0570.com/page/6/index.html">
<meta property="og:site_name" content="ç‹¬æœ¨èˆŸçš„æœ¨">
<meta property="og:description" content="æœ‰æ—¶å€™é˜³å…‰å¾ˆå¥½ æœ‰æ—¶å€™é˜³å…‰å¾ˆæš—">
<meta property="og:locale" content="zh-CN">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="ç‹¬æœ¨èˆŸçš„æœ¨">
<meta name="twitter:description" content="æœ‰æ—¶å€™é˜³å…‰å¾ˆå¥½ æœ‰æ—¶å€™é˜³å…‰å¾ˆæš—">



  <link rel="alternate" href="/atom.xml" title="ç‹¬æœ¨èˆŸçš„æœ¨" type="application/atom+xml">



  
  
  <link rel="canonical" href="https://andy0570.com/page/6/">



<script id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>ç‹¬æœ¨èˆŸçš„æœ¨</title>
  






  <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?8229a094facca297f211d61323fd9fde";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>







  <noscript>
  <style>
  .use-motion .motion-element,
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-title { opacity: initial; }

  .use-motion .logo,
  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-CN">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <a href="https://github.com/andy0570" class="github-corner" aria-label="View source on GitHub"><svg width="80" height="80" viewbox="0 0 250 250" style="fill:#151513; color:#fff; position: absolute; top: 0; border: 0; right: 0;" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"/><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"/><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"/></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style>
    
    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">ç‹¬æœ¨èˆŸçš„æœ¨</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
      
        <p class="site-subtitle">iOS Developer</p>
      
    
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="åˆ‡æ¢å¯¼èˆªæ ">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home">

    
    
    
      
    

    
      
    

    <a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i> <br>é¦–é¡µ</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-categories">

    
    
    
      
    

    
      
    

    <a href="/categories/" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i> <br>åˆ†ç±»<span class="badge">15</span></a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-tags">

    
    
    
      
    

    
      
    

    <a href="/tags/" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i> <br>æ ‡ç­¾<span class="badge">76</span></a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">

    
    
    
      
    

    
      
    

    <a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i> <br>å½’æ¡£<span class="badge">311</span></a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-about">

    
    
    
      
    

    
      
    

    <a href="/about/" rel="section"><i class="menu-item-icon fa fa-fw fa-user"></i> <br>å…³äº</a>

  </li>

      
      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br>æœç´¢</a>
        </li>
      
    </ul>
  

  

  
    <div class="site-search">
      
  
  <div class="algolia-popup popup search-popup">
    <div class="algolia-search">
      <div class="algolia-search-input-icon">
        <i class="fa fa-search"></i>
      </div>
      <div class="algolia-search-input" id="algolia-search-input"></div>
    </div>

    <div class="algolia-results">
      <div id="algolia-stats"></div>
      <div id="algolia-hits"></div>
      <div id="algolia-pagination" class="algolia-pagination"></div>
    </div>

    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
  </div>




    </div>
  
</nav>



  



</div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
            

          
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://andy0570.com/2018/11/01/Node.jså®æˆ˜_1 Node åŸºç¡€/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ç‹¬æœ¨èˆŸçš„æœ¨">
      <meta itemprop="description" content="æœ‰æ—¶å€™é˜³å…‰å¾ˆå¥½ æœ‰æ—¶å€™é˜³å…‰å¾ˆæš—">
      <meta itemprop="image" content="https://ws1.sinaimg.cn/large/006tNc79gy1g22m14458rj30u014xu0x.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ç‹¬æœ¨èˆŸçš„æœ¨">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2018/11/01/Node.jså®æˆ˜_1 Node åŸºç¡€/" class="post-title-link" itemprop="url">Node.jså®æˆ˜_1 Node åŸºç¡€</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              

              
                
              

              <time title="åˆ›å»ºæ—¶é—´ï¼š2018-11-01 14:07:00" itemprop="dateCreated datePublished" datetime="2018-11-01T14:07:00+08:00">2018-11-01</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">æ›´æ–°äº</span>
                
                <time title="ä¿®æ”¹æ—¶é—´ï¼š2019-04-17 02:10:31" itemprop="dateModified" datetime="2019-04-17T02:10:31+08:00">2019-04-17</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Node-js/" itemprop="url" rel="index"><span itemprop="name">Node.js</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          
            <span id="/2018/11/01/Node.jså®æˆ˜_1 Node åŸºç¡€/" class="leancloud_visitors" data-flag-title="Node.jså®æˆ˜_1 Node åŸºç¡€">
              <span class="post-meta-divider">|</span>
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              
                <span class="post-meta-item-text">é˜…è¯»æ¬¡æ•°ï¼š</span>
              
                <span class="leancloud-visitors-count"></span>
            </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body han-init-context" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Node-åŸºç¡€"><a href="#Node-åŸºç¡€" class="headerlink" title="Node åŸºç¡€"></a>Node åŸºç¡€</h1><p>ğŸ’¡<strong>JavaScript æ˜¯ç¼–ç¨‹è¯­è¨€ï¼Œè€Œ Node.js æ˜¯æ‰§è¡Œç¯å¢ƒã€‚</strong></p>
<blockquote>
<p>Node.js æ˜¯ä¸€ä¸ªåŸºäº Chrome V8 å¼•æ“çš„ JavaScript è¿è¡Œç¯å¢ƒã€‚<br>Node.js ä½¿ç”¨äº†ä¸€ä¸ªäº‹ä»¶é©±åŠ¨ã€éé˜»å¡å¼ I/O çš„æ¨¡å‹ï¼Œä½¿å…¶è½»é‡åˆé«˜æ•ˆã€‚<br>Node.js ç‰¹æ€§ï¼šäº‹ä»¶ã€å¼‚æ­¥ APIã€éé˜»å¡ I/Oã€‚<br>Node.js æ˜¯ä¸“ä¸ºæ•°æ®å¯†é›†å‹å®æ—¶ç¨‹åºï¼ˆDITRï¼‰è®¾è®¡çš„ã€‚<br>Node.js é€šè¿‡<strong>äº‹ä»¶è½®è¯¢ï¼ˆevent loopï¼‰</strong>æ¥å®ç°éé˜»å¡I/Oç½‘ç»œçš„è°ƒç”¨ï¼Œè€Œäº‹ä»¶è½®è¯¢æ˜¯å•å‘è¿è¡Œçš„å…ˆå…¥å…ˆå‡ºé˜Ÿåˆ—ã€‚</p>
</blockquote>
<h3 id="Node-js-æ¶æ„"><a href="#Node-js-æ¶æ„" class="headerlink" title="Node.js æ¶æ„"></a>Node.js æ¶æ„</h3><p><img src="http://upload-images.jianshu.io/upload_images/2648731-8302aa06119c1dce.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="Node.js çš„è½¯ä»¶æ ˆ"></p>
<p><img src="http://upload-images.jianshu.io/upload_images/2648731-8e077e34c4226b78.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="Node.js æ¶æ„"></p>
<p>è¯´æ˜ï¼š</p>
<ul>
<li>libuv æ˜¯æä¾›å¿«é€Ÿã€è·¨å¹³å°ã€éé˜»å¡I/Oçš„æœ¬åœ°åº“ï¼›</li>
<li>V8 è´Ÿè´£ JavaScript ä»£ç çš„è§£é‡Šå’Œæ‰§è¡Œï¼›</li>
<li>C++ ç»‘å®šå±‚å¯ä»¥å°† libuv å’Œ V8 ç»“åˆèµ·æ¥ã€‚</li>
</ul>
<h3 id="Node-çš„ä½¿ç”¨åœºæ™¯"><a href="#Node-çš„ä½¿ç”¨åœºæ™¯" class="headerlink" title="Node çš„ä½¿ç”¨åœºæ™¯"></a>Node çš„ä½¿ç”¨åœºæ™¯</h3><p>Node ç¨‹åºä¸»è¦å¯ä»¥åˆ†æˆä¸‰ç§ç±»å‹ï¼šWeb åº”ç”¨ç¨‹åºã€å‘½ä»¤è¡Œå·¥å…·ã€å’Œåå°ç¨‹åºã€æ¡Œé¢ç¨‹åºã€‚</p>
<p><img src="http://upload-images.jianshu.io/upload_images/2648731-531b599fd19fc82e.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="Node çš„ä½¿ç”¨åœºæ™¯"></p>
<h2 id="Node-åŠŸèƒ½çš„ç»„ç»‡åŠé‡ç”¨"><a href="#Node-åŠŸèƒ½çš„ç»„ç»‡åŠé‡ç”¨" class="headerlink" title="Node åŠŸèƒ½çš„ç»„ç»‡åŠé‡ç”¨"></a>Node åŠŸèƒ½çš„ç»„ç»‡åŠé‡ç”¨</h2><p>Node æ¨¡å—æ‰“åŒ…ä»£ç æ˜¯ä¸ºäº†é‡ç”¨ï¼Œä½†å®ƒä»¬ä¸ä¼šæ”¹å˜å…¨å±€ä½œç”¨åŸŸã€‚</p>
<p>Node çš„æ¨¡å—ç³»ç»Ÿé¿å…äº†å¯¹å…¨å±€ä½œç”¨åŸŸçš„æ±¡æŸ“ï¼Œä»è€Œä¹Ÿå°±é¿å…äº†å‘½åå†²çªï¼Œå¹¶ç®€åŒ–äº†ä»£ç çš„é‡ç”¨ã€‚</p>
<h4 id="currency-js"><a href="#currency-js" class="headerlink" title="currency.js"></a>currency.js</h4><p>è‡ªå®šä¹‰æ¨¡å—ï¼Œåœ¨è¯¥æ–‡ä»¶ä¸­æ·»åŠ ä¸¤ä¸ªè´§å¸è½¬æ¢å‡½æ•°ï¼š<br>æ–¹æ³•ï¼šé€šè¿‡è®¾å®š <code>exports</code> å¯¹è±¡çš„å±æ€§æ¥æŒ‡æ˜è¦æš´éœ²çš„å‡½æ•°æˆ–å˜é‡ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ç§æœ‰å˜é‡ï¼Œå¤–ç•Œæ— æ³•è®¿é—®åˆ°ã€‚</span></span><br><span class="line"><span class="keyword">var</span> candaianDollar = <span class="number">0.91</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">roundTwoDecimals</span>(<span class="params">amount</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Math</span>.round(amount * <span class="number">100</span>) / <span class="number">100</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// canadianToUS() å‡½æ•°è®¾å®šåœ¨ exports æ¨¡å—ä¸­ï¼Œæ‰€ä»¥å¼•å…¥è¿™ä¸ªæ¨¡å—çš„ä»£ç å¯ä»¥ä½¿ç”¨å®ƒã€‚</span></span><br><span class="line">exports.canadianToUS = <span class="function"><span class="keyword">function</span> (<span class="params">canadian</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> roundTwoDecimals(canadian * candaianDollar);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// USToCanadian() å‡½æ•°ä¹Ÿè®¾å®šåœ¨ exports æ¨¡å—ä¸­ã€‚</span></span><br><span class="line">exports.USToCanadian = <span class="function"><span class="keyword">function</span> (<span class="params">us</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> roundTwoDecimals(us / candaianDollar);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="test-currency-js"><a href="#test-currency-js" class="headerlink" title="test-currency.js"></a>test-currency.js</h4><p>å¼•å…¥æ¨¡å—</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// require() å‡½æ•°æ˜¯ä¸€ä¸ªåŒæ­¥I/Oå‡½æ•°ï¼Œä¸€èˆ¬åœ¨æ–‡ä»¶é¡¶ç«¯å¼•å…¥ã€‚</span></span><br><span class="line"><span class="comment">// ç›¸å¯¹è·¯å¾„ ./ è¡¨ç¤ºå½“å‰åŒä¸€ç›®å½•ä¸‹ã€‚</span></span><br><span class="line"><span class="keyword">const</span> currency = <span class="built_in">require</span>(<span class="string">'./currency'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä½¿ç”¨ currency æ¨¡å—çš„ canadianToUS() å‡½æ•°</span></span><br><span class="line"><span class="built_in">console</span>.log(currency.canadianToUS(<span class="number">50</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä½¿ç”¨ currency æ¨¡å—çš„ USToCanadian() å‡½æ•°</span></span><br><span class="line"><span class="built_in">console</span>.log(currency.USToCanadian(<span class="number">30</span>));</span><br></pre></td></tr></table></figure>
<h3 id="ç”¨-module-exports-å¾®è°ƒæ¨¡å—çš„åˆ›å»º"><a href="#ç”¨-module-exports-å¾®è°ƒæ¨¡å—çš„åˆ›å»º" class="headerlink" title="ç”¨ module.exports å¾®è°ƒæ¨¡å—çš„åˆ›å»º"></a>ç”¨ module.exports å¾®è°ƒæ¨¡å—çš„åˆ›å»º</h3><ul>
<li>å¦‚æœåªéœ€è¦ä»æ¨¡å—ä¸­å¾—åˆ°ä¸€ä¸ªå‡½æ•°ï¼Œé‚£ä¹ˆä» require ä¸­è¿”å›ä¸€ä¸ªå‡½æ•°çš„ä»£ç æ¯”è¿”å›ä¸€ä¸ªå¯¹è±¡çš„ä»£ç æ›´ä¼˜é›…ã€‚</li>
<li><p>ä¸èƒ½ç”¨ä»»ä½•å…¶ä»–å¯¹è±¡ã€å‡½æ•°æˆ–è€…å˜é‡ç»™ <strong>exports</strong> èµ‹å€¼ã€‚</p>
<blockquote>
<p>æˆ‘çš„ç†è§£ï¼šå¯ä»¥æŠŠå‡½æ•°æˆ–è€…å¯¹è±¡è®¾ç½®ä¸º exports çš„å±æ€§ï¼ˆ<code>exports.function = {...}</code>ï¼‰ï¼Œä½†æ˜¯ä¸èƒ½æŠŠå‡½æ•°æˆ–è€…å¯¹è±¡èµ‹å€¼ï¼ˆ<code>exports = function</code>ï¼‰ç»™ exportsã€‚</p>
</blockquote>
</li>
<li>ç”¨ <strong>module.exports</strong> å¯ä»¥å¯¹å¤–æä¾›å•ä¸ªå˜é‡ã€å‡½æ•°æˆ–è€…å¯¹è±¡ã€‚</li>
<li>å¦‚æœä½ åˆ›å»ºäº†ä¸€ä¸ªæ—¢æœ‰ <strong>exports</strong> åˆæœ‰ <strong>module.exports</strong> çš„æ¨¡å—ï¼Œé‚£å®ƒä¼šè¿”å› <strong>module.exports</strong>ï¼Œè€Œ <strong>exports</strong> ä¼šè¢«å¿½ç•¥ã€‚</li>
</ul>
<blockquote>
<p><strong>exports ä¸ module.exports</strong> </p>
<p>æœ€ç»ˆåœ¨ç¨‹åºé‡Œå¯¼å‡ºçš„æ˜¯module.exportsã€‚<strong>exportsåªæ˜¯å¯¹module.exportsçš„ä¸€ä¸ªå…¨å±€å¼•ç”¨</strong>ï¼Œæœ€åˆè¢«å®šä¹‰ä¸ºä¸€ä¸ªå¯ä»¥æ·»åŠ å±æ€§çš„ç©ºå¯¹è±¡ã€‚æ‰€ä»¥exports.myFuncåªæ˜¯module.exports.myFuncçš„ç®€å†™ã€‚</p>
<p>æ‰€ä»¥ï¼Œå¦‚æœæŠŠexportsè®¾å®šä¸ºåˆ«çš„ï¼Œå°±æ‰“ç ´äº†module.exportså’Œexportsä¹‹é—´çš„å¼•ç”¨å…³ç³»ã€‚</p>
</blockquote>
<ul>
<li>æ ¹æ®éœ€è¦ä½¿ç”¨ <strong>exports</strong> æˆ– <strong>module.exports</strong> å¯ä»¥å°†åŠŸèƒ½ç»„ç»‡æˆæ¨¡å—ï¼Œè§„é¿æ‰ç¨‹åºè„šæœ¬ä¸€ç›´å¢é•¿äº§ç”Ÿçš„å¼Šç«¯ã€‚ </li>
</ul>
<h3 id="ç”¨-node-modules-é‡ç”¨æ¨¡å—"><a href="#ç”¨-node-modules-é‡ç”¨æ¨¡å—" class="headerlink" title="ç”¨ node_modules é‡ç”¨æ¨¡å—"></a>ç”¨ node_modules é‡ç”¨æ¨¡å—</h3><p><img src="http://upload-images.jianshu.io/upload_images/2648731-df1b18512aee674d.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="Node æŸ¥æ‰¾æ¨¡å—çš„æ­¥éª¤"></p>
<ul>
<li>ç”¨ç¯å¢ƒå˜é‡ <strong>NODE_PATH</strong> å¯ä»¥æ”¹å˜ Node æ¨¡å—çš„é»˜è®¤è·¯å¾„ã€‚</li>
</ul>
<h3 id="æ³¨æ„äº‹é¡¹"><a href="#æ³¨æ„äº‹é¡¹" class="headerlink" title="æ³¨æ„äº‹é¡¹"></a>æ³¨æ„äº‹é¡¹</h3><ol>
<li>å¦‚æœæ¨¡å—æ˜¯ç›®å½•ï¼Œåœ¨æ¨¡å—ç›®å½•ä¸­å®šä¹‰æ¨¡å—çš„æ–‡ä»¶å¿…é¡»è¢«å‘½åä¸º <strong>index.js</strong>ï¼Œé™¤éä½ åœ¨è¿™ä¸ªç›®å½•ä¸‹ä¸€ä¸ªå«<strong>package.json</strong> çš„æ–‡ä»¶é‡Œç‰¹åˆ«æŒ‡æ˜ã€‚</li>
<li>Node èƒ½æŠŠæ¨¡å—ä½œä¸ºå¯¹è±¡ç¼“å­˜èµ·æ¥ã€‚Node åŠ å¯†æ¨¡å—çš„é¡ºåºï¼šç¼“å­˜æ¨¡å—&gt;æ ¸å¿ƒæ¨¡å—&gt;å½“å‰ç›®å½•æ¨¡å—&gt;node_modulesæ¨¡å—ã€‚</li>
<li>æœ‰äº›å¸¸ç”¨çš„ Node æ ¸å¿ƒæ¨¡å—åœ¨ Node åˆå§‹åŒ–æ—¶å°±è¢«åŠ è½½ç¼“å­˜èµ·æ¥äº†ï¼Œæ‰€ä»¥åŠ è½½é€Ÿåº¦ç›¸å¯¹ä¹Ÿä¼šæ›´å¿«ã€‚</li>
</ol>
<h2 id="å¼‚æ­¥ç¼–ç¨‹æŠ€æœ¯"><a href="#å¼‚æ­¥ç¼–ç¨‹æŠ€æœ¯" class="headerlink" title="å¼‚æ­¥ç¼–ç¨‹æŠ€æœ¯"></a>å¼‚æ­¥ç¼–ç¨‹æŠ€æœ¯</h2><p>Node ä¸­ä¸¤ç§å“åº”é€»è¾‘ç®¡ç†æ–¹å¼ï¼šå›è°ƒå’Œäº‹ä»¶ç›‘å¬ã€‚</p>
<ul>
<li><p>å›è°ƒï¼šé€‚ç”¨äºä¸€æ¬¡æ€§å¼‚æ­¥é€»è¾‘ã€‚</p>
</li>
<li><p>äº‹ä»¶å‘å°„å™¨ï¼šæŠŠå¼‚æ­¥é€»è¾‘è·Ÿä¸€ä¸ªæ¦‚å¿µå®ä½“å…³è”èµ·æ¥ï¼Œå¯ä»¥é€šè¿‡ç›‘å¬å™¨è½»æ¾ç®¡ç†ã€‚</p>
</li>
<li>æµç¨‹æ§åˆ¶ï¼šå¯ä»¥ç®¡ç†å¼‚æ­¥ä»»åŠ¡çš„æ‰§è¡Œé¡ºåºï¼Œä¸²è¡Œæ‰§è¡Œæˆ–è€…å¹¶è¡Œæ‰§è¡Œã€‚</li>
</ul>
<h3 id="1-ç”¨å›è°ƒå¤„ç†ä¸€æ¬¡æ€§äº‹ä»¶"><a href="#1-ç”¨å›è°ƒå¤„ç†ä¸€æ¬¡æ€§äº‹ä»¶" class="headerlink" title="1. ç”¨å›è°ƒå¤„ç†ä¸€æ¬¡æ€§äº‹ä»¶"></a>1. ç”¨å›è°ƒå¤„ç†ä¸€æ¬¡æ€§äº‹ä»¶</h3><p>å›è°ƒæ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œå®ƒè¢«å½“åšå‚æ•°ä¼ ç»™å¼‚æ­¥å‡½æ•°ï¼Œå®ƒæè¿°äº†å¼‚æ­¥æ“ä½œå®Œæˆä¹‹åè¦åšä»€ä¹ˆã€‚</p>
<p><img src="http://upload-images.jianshu.io/upload_images/2648731-470836902154286c.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="HTMLç¤ºä¾‹"></p>
<h4 id="title-json"><a href="#title-json" class="headerlink" title="title.json"></a>title.json</h4><p>JSON æ–‡ä»¶ä¼šè¢«æ ¼å¼åŒ–æˆä¸€ä¸ªåŒ…å«æ–‡ç« æ ‡é¢˜çš„å­—ç¬¦ä¸²æ•°ç»„ã€‚</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[</span><br><span class="line">    <span class="string">"Kazakhstan is a huge country...what goes on there?"</span>,</span><br><span class="line">    <span class="string">"This weather is making me craaazy"</span>,</span><br><span class="line">    <span class="string">"My neighbor sort of howls at night"</span></span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<h4 id="template-html"><a href="#template-html" class="headerlink" title="template.html"></a>template.html</h4><p>HTML æ¨¡ç‰ˆæ–‡ä»¶ï¼Œ% ä¼šè¢«æ›¿æ¢ä¸ºåšå®¢æ–‡ç« çš„æ ‡é¢˜ã€‚</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"utf-8"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"X-UA-Compatible"</span> <span class="attr">content</span>=<span class="string">"IE=edge"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Page Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"viewport"</span> <span class="attr">content</span>=<span class="string">"width=device-width, initial-scale=1"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>Latest Posts<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ul</span>&gt;</span><span class="tag">&lt;<span class="name">li</span>&gt;</span>%<span class="tag">&lt;/<span class="name">li</span>&gt;</span><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="blog-recent-js"><a href="#blog-recent-js" class="headerlink" title="blog_recent.js"></a>blog_recent.js</h4><p>åŠŸèƒ½å¦‚ä¸‹ï¼š</p>
<ul>
<li>å¼‚æ­¥è·å–å­˜æ”¾åœ¨ JSON æ–‡ä»¶ä¸­çš„æ–‡ç« çš„æ ‡é¢˜ï¼›</li>
<li>å¼‚æ­¥è·å–ç®€å•çš„ HTML æ¨¡ç‰ˆï¼›</li>
<li>æŠŠæ ‡é¢˜ç»„è£…åœ¨ HTML æ¨¡ç‰ˆä¸­ï¼›</li>
<li>æŠŠ HTML é¡µé¢å‘é€ç»™ç”¨æˆ·ã€‚</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è·å– JSON æ–‡ä»¶ä¸­çš„æ ‡é¢˜ï¼Œå¹¶æ¸²æŸ“ Web é¡µé¢</span></span><br><span class="line"><span class="meta">'use strict'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">'http'</span>);</span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>);</span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆ›å»º HTTP æœåŠ¡å™¨ï¼Œå¹¶ç”¨å›è°ƒå®šä¹‰å“åº”é€»è¾‘</span></span><br><span class="line">http.createServer(<span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>) </span>&#123; </span><br><span class="line">    <span class="keyword">if</span> (req.url == <span class="string">'/'</span>) &#123;</span><br><span class="line">        <span class="comment">// è¯»å– JSON æ–‡ä»¶å¹¶ç”¨å›è°ƒå®šä¹‰å¦‚ä½•å¤„ç†å…¶ä¸­çš„å†…å®¹</span></span><br><span class="line">        <span class="comment">// fs.readFile() ç›´æ¥è¯»å–æ–‡ä»¶çš„ç›¸å¯¹è·¯å¾„ä¼šæŠ¥é”™ï¼Œè¿™é‡Œç”¨ path æ‹¼æ¥ã€‚</span></span><br><span class="line">        fs.readFile(path.join(__dirname, <span class="string">'./titles.json'</span>), <span class="function"><span class="keyword">function</span> (<span class="params">err, data</span>) </span>&#123;</span><br><span class="line">            <span class="comment">// å¦‚æœå‡ºé”™ï¼Œè¾“å…¥é”™è¯¯æ—¥å¿—ï¼Œå¹¶ç»™å®¢æˆ·ç«¯è¿”å›é”™è¯¯</span></span><br><span class="line">            <span class="keyword">if</span> (err) &#123; </span><br><span class="line">                <span class="built_in">console</span>.error(err);</span><br><span class="line">                res.end(<span class="string">'Server Error: Read JSON File Error'</span>);</span><br><span class="line">            &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="comment">// ä» JSON æ–‡æœ¬ä¸­è§£ææ•°æ®</span></span><br><span class="line">                <span class="keyword">var</span> titles = <span class="built_in">JSON</span>.parse(data.toString());</span><br><span class="line"></span><br><span class="line">                <span class="comment">// è¯»å– HTML æ¨¡ç‰ˆï¼Œå¹¶åœ¨åŠ è½½å®Œæˆåä½¿ç”¨å›è°ƒ</span></span><br><span class="line">                fs.readFile(path.join(__dirname, <span class="string">'./template.html'</span>), <span class="function"><span class="keyword">function</span> (<span class="params">err, data</span>) </span>&#123;</span><br><span class="line">                    <span class="keyword">if</span> (err) &#123;</span><br><span class="line">                        <span class="built_in">console</span>.error(err);</span><br><span class="line">                        res.end(<span class="string">'Server Error: Read html Error'</span>);</span><br><span class="line">                    &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">                        <span class="keyword">var</span> tmp1 = data.toString();</span><br><span class="line"></span><br><span class="line">                        <span class="comment">// ç»„è£… HTML é¡µé¢ä»¥æ˜¾ç¤ºåšå®¢æ ‡é¢˜</span></span><br><span class="line">                        <span class="keyword">var</span> html = tmp1.replace(<span class="string">'%'</span>, titles.join(<span class="string">'&lt;/li&gt;&lt;li&gt;'</span>));</span><br><span class="line">                        res.writeHead(<span class="number">200</span>, &#123;<span class="string">'Content-Type'</span>: <span class="string">'text/html'</span>&#125;);</span><br><span class="line">                        <span class="comment">// å°† HTML é¡µé¢å‘é€ç»™ç”¨æˆ·</span></span><br><span class="line">                        res.end(html);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;).listen(<span class="number">8000</span>, <span class="string">'127.0.0.1'</span>);</span><br></pre></td></tr></table></figure>
<p>è¿™ä¸ªç¤ºä¾‹åµŒå…¥äº†ä¸‰å±‚å›è°ƒï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">http.createServer(<span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>) </span>&#123; </span><br><span class="line">    fs.readFile(path.join(__dirname, <span class="string">'./titles.json'</span>), <span class="function"><span class="keyword">function</span> (<span class="params">err, data</span>) </span>&#123;</span><br><span class="line">        fs.readFile(path.join(__dirname, <span class="string">'./template.html'</span>), <span class="function"><span class="keyword">function</span> (<span class="params">err, data</span>) </span>&#123;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>ä¼˜åŒ–æ–¹å¼ï¼šåˆ›å»ºä¸­é—´å‡½æ•°ä»¥å‡å°‘åµŒå¥—ï¼ˆä¹Ÿå¯ä»¥ç†è§£ä¸ºï¼šå°†ä»£ç æ¨¡å—åŒ–ï¼‰ã€‚</p>
<p>å°±æ˜¯æŠŠæ­¥éª¤ä¸­çš„å•ä¸€åŠŸèƒ½æŠ½è±¡ä¸ºå•ç‹¬çš„ä¸­é—´å‡½æ•°ã€‚</p>
<p>â€¦</p>
<p>ä¼˜åŒ–æ–¹å¼ï¼šé€šè¿‡å°½æ—©è¿”å›å‡å°‘åµŒå¥—ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">'http'</span>);</span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>);</span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> server = http.createServer(<span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">    getTitles(res);</span><br><span class="line">&#125;).listen(<span class="number">8000</span>, <span class="string">"127.0.0.1"</span>);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getTitles</span>(<span class="params">res</span>) </span>&#123;</span><br><span class="line">    fs.readFile(path.join(__dirname, <span class="string">'./titles.json'</span>), <span class="function"><span class="keyword">function</span> (<span class="params">err, data</span>) </span>&#123;</span><br><span class="line">        <span class="comment">// ä¸å†åˆ›å»º else åˆ†æ”¯ï¼Œè€Œæ˜¯ç›´æ¥returnï¼Œå› ä¸ºå¦‚æœå‡ºé”™çš„è¯ï¼Œä¹Ÿæ²¡æœ‰å¿…è¦ç»§ç»­æ‰§è¡Œè¿™ä¸ªå‡½æ•°äº†ã€‚</span></span><br><span class="line">        <span class="keyword">if</span> (err) <span class="keyword">return</span> hadError(err, res);</span><br><span class="line">        getTemplate(<span class="built_in">JSON</span>.parse(data.toString()), res);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getTemplate</span>(<span class="params">titles, res</span>) </span>&#123;</span><br><span class="line">    fs.readFile(path.join(__dirname, <span class="string">'./template.html'</span>), <span class="function"><span class="keyword">function</span> (<span class="params">err, data</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (err) <span class="keyword">return</span> hadError(err, res);</span><br><span class="line">        formatHtml(titles, data.toString(), res);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">formatHtml</span>(<span class="params">titles, tmp1, res</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> html = tmp1.replace(<span class="string">'%'</span>, titles.join(<span class="string">'&lt;/li&gt;&lt;li&gt;'</span>));</span><br><span class="line">    res.writeHead(<span class="number">200</span>, &#123;<span class="string">'Content-Type'</span>: <span class="string">'text/html'</span>&#125;);</span><br><span class="line">    res.end(html);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">hadError</span>(<span class="params">err, res</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.error(err);</span><br><span class="line">    res.end(<span class="string">'Server Error'</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p><strong>Node çš„å¼‚æ­¥å›è°ƒæƒ¯ä¾‹</strong></p>
<p>Node ä¸­çš„å¤§å¤šæ•°å†…ç½®æ¨¡å—åœ¨ä½¿ç”¨å›è°ƒæ—¶éƒ½ä¼šå¸¦ä¸¤ä¸ªå‚æ•°ï¼šç¬¬ä¸€ä¸ªç”¨æ¥æ”¾å¯èƒ½ä¼šå‘ç”Ÿçš„é”™è¯¯ï¼Œç¬¬äºŒä¸ªæ”¾ç»“æœã€‚é”™è¯¯å‚æ•°ç»å¸¸è¢«ç¼©å†™ä¸º errã€‚ </p>
<p>ä¸‹é¢æ˜¯è¿™ä¸ªå¸¸ç”¨çš„å‡½æ•°ç­¾åçš„å…¸å‹ç¤ºä¾‹:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>);</span><br><span class="line">&gt; fs.readFile(<span class="string">'./titles.json'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">err, data</span>) </span>&#123;</span><br><span class="line">&gt;     <span class="keyword">if</span> (err) <span class="keyword">throw</span> err;</span><br><span class="line">&gt;     <span class="comment">// do something with data if no error has occurred</span></span><br><span class="line">&gt; &#125;)</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>
</blockquote>
<h3 id="2-ç”¨äº‹ä»¶å‘å°„å™¨å¤„ç†é‡å¤æ€§äº‹ä»¶"><a href="#2-ç”¨äº‹ä»¶å‘å°„å™¨å¤„ç†é‡å¤æ€§äº‹ä»¶" class="headerlink" title="2. ç”¨äº‹ä»¶å‘å°„å™¨å¤„ç†é‡å¤æ€§äº‹ä»¶"></a>2. ç”¨äº‹ä»¶å‘å°„å™¨å¤„ç†é‡å¤æ€§äº‹ä»¶</h3><p>äº‹ä»¶å‘å°„å™¨ä¼šè§¦å‘äº‹ä»¶ï¼Œå¹¶ä¸”åœ¨é‚£äº›äº‹ä»¶è¢«è§¦å‘æ—¶èƒ½å¤„ç†å®ƒä»¬ã€‚</p>
<p>äº‹ä»¶æ˜¯é€šè¿‡<strong>ç›‘å¬å™¨</strong>è¿›è¡Œå¤„ç†çš„ã€‚</p>
<p><strong>ç›‘å¬å™¨</strong>æ˜¯è·Ÿäº‹ä»¶ç›¸å…³è”çš„ã€å½“æœ‰äº‹ä»¶å‡ºç°æ—¶å°±ä¼šè¢«è§¦å‘çš„å›è°ƒå‡½æ•°ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> net = <span class="built_in">require</span>(<span class="string">'net'</span>);</span><br><span class="line"><span class="keyword">var</span> server = net.createServer(<span class="function"><span class="keyword">function</span> (<span class="params">socket</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// å½“æœ‰å®¢æˆ·ç«¯è¿æ¥ä¸Šæ¥æ—¶ï¼Œå®ƒå°±ä¼šåˆ›å»ºä¸€ä¸ªsocketã€‚</span></span><br><span class="line">    <span class="comment">// ç”¨ on æ–¹æ³•æ·»åŠ ç›‘å¬å™¨å“åº” data äº‹ä»¶ã€‚</span></span><br><span class="line">    socket.on(<span class="string">'data'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">data</span>) </span>&#123;</span><br><span class="line">        socket.write(data);</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// once æ–¹æ³•ï¼Œdata äº‹ä»¶åªæ˜¯åœ¨ç¬¬ä¸€æ¬¡ä¼šè¢«å¤„ç†</span></span><br><span class="line">    socket.once(<span class="string">'data'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">data</span>) </span>&#123;</span><br><span class="line">        socket.write(data);</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;).listen(<span class="number">8888</span>);</span><br></pre></td></tr></table></figure>
<p>ç”¨ Node å†…ç½®çš„äº‹ä»¶æ¨¡ç‰ˆåˆ›å»ºè‡ªå·±çš„äº‹ä»¶å‘å°„å™¨ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å®šä¹‰ä¸€ä¸ªchanneläº‹ä»¶å‘å°„å™¨ï¼Œå¸¦æœ‰ä¸€ä¸ªç›‘å¬å™¨ï¼Œå¯ä»¥å‘åŠ å…¥é¢‘é“çš„äººåšå‡ºå“åº”ã€‚</span></span><br><span class="line"><span class="keyword">var</span> EventEmitter = <span class="built_in">require</span>(<span class="string">'events'</span>).EventEmitter;</span><br><span class="line"><span class="keyword">var</span> channel = <span class="keyword">new</span> EventEmitter();</span><br><span class="line"><span class="comment">// ç”¨on(æˆ–è€…ç”¨æ¯”è¾ƒé•¿çš„addListener)æ–¹æ³•ç»™äº‹ä»¶å‘å°„å™¨æ·»åŠ äº†ç›‘å¬å™¨:</span></span><br><span class="line">channel.on(<span class="string">'join'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'Welcome!'</span>);</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç”¨emitå‡½æ•°å‘å°„è¿™ä¸ªäº‹ä»¶</span></span><br><span class="line">channel.emit(<span class="string">'join'</span>);</span><br></pre></td></tr></table></figure>
<h4 id="é”™è¯¯å¤„ç†"><a href="#é”™è¯¯å¤„ç†" class="headerlink" title="é”™è¯¯å¤„ç†"></a>é”™è¯¯å¤„ç†</h4><p>åˆ›å»ºå‘å‡º error ç±»å‹äº‹ä»¶çš„äº‹ä»¶å‘å°„å™¨ï¼Œè€Œä¸æ˜¯ç›´æ¥æŠ›å‡ºé”™è¯¯ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åˆ›å»ºä¸€ä¸ªé”™è¯¯ç›‘å¬å™¨ï¼Œå°†è¢«å‘å‡ºçš„é”™è¯¯è¾“å‡ºåˆ°æ§åˆ¶å°ä¸­:</span></span><br><span class="line"><span class="keyword">const</span> events = <span class="built_in">require</span>(<span class="string">'events'</span>);</span><br><span class="line"><span class="keyword">var</span> myEmitter = <span class="keyword">new</span> events.EventEmitter();</span><br><span class="line">myEmitter.on(<span class="string">'error'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">err</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'ERROR: '</span> + err.message);</span><br><span class="line">&#125;);</span><br><span class="line">myEmitter.emit(<span class="string">'error'</span>, <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'Something is wrong.'</span>));</span><br></pre></td></tr></table></figure>
<h3 id="å¼‚æ­¥å¼€å‘çš„éš¾é¢˜"><a href="#å¼‚æ­¥å¼€å‘çš„éš¾é¢˜" class="headerlink" title="å¼‚æ­¥å¼€å‘çš„éš¾é¢˜"></a>å¼‚æ­¥å¼€å‘çš„éš¾é¢˜</h3><p>åˆ›å»ºå¼‚æ­¥ç¨‹åºæ—¶ï¼Œå¿…é¡»å¯†åˆ‡å…³æ³¨ç¨‹åºçš„æ‰§è¡Œæµç¨‹ã€ç¨‹åºçš„æ‰§è¡ŒçŠ¶æ€â€¦</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ç¤ºä¾‹ï¼šä½œç”¨åŸŸæ˜¯å¦‚ä½•å¯¼è‡´ bug å‡ºç°çš„ï¼š</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">asyncFunction</span>(<span class="params">callback</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// 200ms åï¼Œæ‰§è¡Œå›è°ƒå‡½æ•°</span></span><br><span class="line">  setTimeout(callback, <span class="number">200</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> color = <span class="string">'blue'</span>;</span><br><span class="line">asyncFunction(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">`The color is <span class="subst">$&#123;color&#125;</span>`</span>);</span><br><span class="line">&#125;);</span><br><span class="line">color = <span class="string">'green'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è¾“å‡ºç»“æœï¼š</span></span><br><span class="line"><span class="comment">// [Running] node "/Users/andy/Desktop/node/test_async.js"</span></span><br><span class="line"><span class="comment">// The color is green</span></span><br></pre></td></tr></table></figure>
<p>ç”¨åŒ¿åå‡½æ•°ä¿ç•™å…¨å±€å˜é‡çš„å€¼ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ç”¨é—­åŒ…æ§åˆ¶ç¨‹åºçš„çŠ¶æ€</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">asyncFunction</span>(<span class="params">callbback</span>) </span>&#123;</span><br><span class="line">    setTimeout(callbback, <span class="number">200</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> conlor = <span class="string">'blue'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å°† color çš„å€¼ä¼ ç»™åŒ¿åå‡½æ•°</span></span><br><span class="line"><span class="comment">// color å˜æˆäº†åŒ¿åå‡½æ•°çš„å‚æ•°ï¼Œä¹Ÿå°±æ˜¯è¿™ä¸ªåŒ¿åå‡½æ•°å†…éƒ¨çš„æœ¬åœ°å˜é‡ï¼Œ</span></span><br><span class="line"><span class="comment">// å½“åŒ¿åå‡½æ•°å¤–é¢çš„colorå€¼å‘ç”Ÿå˜åŒ–æ—¶ï¼Œæœ¬åœ°ç‰ˆçš„colorä¸ä¼šå—å½±å“ã€‚</span></span><br><span class="line">(<span class="function"><span class="keyword">function</span>(<span class="params">color</span>) </span>&#123;</span><br><span class="line">    asyncFunction(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'The color is'</span> + color);</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)(color);</span><br><span class="line"></span><br><span class="line">color = <span class="string">'green'</span>;</span><br></pre></td></tr></table></figure>
<p><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Closures" target="_blank" rel="noopener">MDN web docs: JavaScript é—­åŒ…</a></p>
<h3 id="å¼‚æ­¥é€»è¾‘çš„é¡ºåºåŒ–"><a href="#å¼‚æ­¥é€»è¾‘çš„é¡ºåºåŒ–" class="headerlink" title="å¼‚æ­¥é€»è¾‘çš„é¡ºåºåŒ–"></a>å¼‚æ­¥é€»è¾‘çš„é¡ºåºåŒ–</h3><p><strong>æµç¨‹æ§åˆ¶</strong>ï¼šè®©ä¸€ç»„å¼‚æ­¥ä»»åŠ¡æŒ‰ç…§é¡ºåºæ‰§è¡Œã€‚ä¸²è¡Œ/å¹¶è¡Œã€‚</p>
<p>éœ€è¦ä¸€ä¸ªæ¥ç€ä¸€ä¸ªåšçš„ä»»åŠ¡å«åš<strong>ä¸²è¡Œä»»åŠ¡</strong>ã€‚</p>
<p>ä¸éœ€è¦ä¸€ä¸ªæ¥ç€ä¸€ä¸ªåšçš„ä»»åŠ¡å«åš<strong>å¹¶è¡Œä»»åŠ¡</strong>ã€‚</p>
<p><img src="http://upload-images.jianshu.io/upload_images/2648731-3ea584da7886360b.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="ä¸²è¡Œä»»åŠ¡ä¸å¹¶è¡Œä»»åŠ¡"></p>
<h3 id="å®ç°ä¸²è¡ŒåŒ–æµç¨‹æ§åˆ¶"><a href="#å®ç°ä¸²è¡ŒåŒ–æµç¨‹æ§åˆ¶" class="headerlink" title="å®ç°ä¸²è¡ŒåŒ–æµç¨‹æ§åˆ¶"></a>å®ç°ä¸²è¡ŒåŒ–æµç¨‹æ§åˆ¶</h3><p>ä½¿ç”¨å›è°ƒè®©å‡ ä¸ªå¼‚æ­¥ä»»åŠ¡é¡ºåºæ‰§è¡Œï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'1'</span>);</span><br><span class="line">    setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'2'</span>);</span><br><span class="line">        setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">'3'</span>);</span><br><span class="line">        &#125;, <span class="number">100</span>); <span class="comment">// ä»»åŠ¡3ï¼ŒèŠ±è´¹ 0.1 ç§’</span></span><br><span class="line">    &#125;, <span class="number">500</span>); <span class="comment">// ä»»åŠ¡2ï¼ŒèŠ±è´¹ 0.5 ç§’</span></span><br><span class="line">&#125;, <span class="number">1000</span>); <span class="comment">// ä»»åŠ¡1ï¼ŒèŠ±è´¹ 1 ç§’</span></span><br></pre></td></tr></table></figure>
<p>ç¬¬ä¸‰æ–¹æ¨¡å—ï¼š<a href="http://caolan.github.io/nimble/" target="_blank" rel="noopener">Nimble</a>ï¼šè¿™ä¸ªæ¨¡å—å®˜ç½‘ä¸Šæ˜¾ç¤º7å¹´æ²¡æ›´æ–°äº†ğŸ˜‚ğŸ˜‚ğŸ˜‚ï¼Œè€Œä¸”ç°åœ¨æµè¡Œç”¨ Promise æˆ–è€… async æ¥å®ç°ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ã€ŠNode.js å®æˆ˜ï¼ˆç¬¬äºŒç‰ˆï¼‰ã€‹Async ç¤ºä¾‹ï¼š</span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">async</span> = <span class="built_in">require</span>(<span class="string">'async'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç»™ Async ä¸€ä¸ªå‡½æ•°æ•°ç»„ï¼Œè®©å®ƒä¸€ä¸ªæ¥ä¸€ä¸ªåœ°æ‰§è¡Œ</span></span><br><span class="line"><span class="keyword">async</span>.series([</span><br><span class="line">  callback =&gt; &#123;</span><br><span class="line">    setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">'I execute first.'</span>);</span><br><span class="line">      callback();</span><br><span class="line">    &#125;, <span class="number">1000</span>);</span><br><span class="line">  &#125;,</span><br><span class="line">  callback =&gt; &#123;</span><br><span class="line">    setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">'I execute next.'</span>);</span><br><span class="line">      callback();</span><br><span class="line">    &#125;, <span class="number">500</span>);</span><br><span class="line">  &#125;,</span><br><span class="line">  callback =&gt; &#123;</span><br><span class="line">    setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">'I execute last.'</span>);</span><br><span class="line">      callback();</span><br><span class="line">    &#125;, <span class="number">100</span>);</span><br><span class="line">  &#125;,</span><br><span class="line">]);</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ‰§è¡Œç»“æœï¼š</span></span><br><span class="line"><span class="comment">// [Running] node "/Users/andy/Desktop/node/test_async.js"</span></span><br><span class="line"><span class="comment">// I execute first.</span></span><br><span class="line"><span class="comment">// I execute next.</span></span><br><span class="line"><span class="comment">// I execute last.</span></span><br></pre></td></tr></table></figure>
<p>ä¸²è¡ŒåŒ–æµç¨‹æ§åˆ¶çš„å·¥ä½œæœºåˆ¶ï¼š</p>
<p>ä¸ºäº†ç”¨ä¸²è¡ŒåŒ–æµç¨‹æ§åˆ¶è®©å‡ ä¸ªå¼‚æ­¥ä»»åŠ¡æŒ‰é¡ºåºæ‰§è¡Œï¼Œéœ€è¦å…ˆæŠŠè¿™äº›ä»»åŠ¡æŒ‰é¢„æœŸçš„æ‰§è¡Œé¡ºåºæ”¾åˆ°ä¸€ä¸ªæ•°ç»„ä¸­ã€‚</p>
<p>è¿™ä¸ªæ•°ç»„å°†èµ·åˆ°é˜Ÿåˆ—çš„ä½œç”¨ï¼šå®Œæˆä¸€ä¸ªä»»åŠ¡åæŒ‰é¡ºåºä»æ•°ç»„ä¸­å–å‡ºä¸‹ä¸€ä¸ªã€‚</p>
<p>Demoç¤ºä¾‹ï¼šå®ç°ä¸²è¡ŒåŒ–æµç¨‹æ§åˆ¶ã€‚</p>
<h3 id="å®ç°å¹¶è¡ŒåŒ–æµç¨‹æ§åˆ¶"><a href="#å®ç°å¹¶è¡ŒåŒ–æµç¨‹æ§åˆ¶" class="headerlink" title="å®ç°å¹¶è¡ŒåŒ–æµç¨‹æ§åˆ¶"></a>å®ç°å¹¶è¡ŒåŒ–æµç¨‹æ§åˆ¶</h3><p>ä¸ºäº†è®©å¼‚æ­¥ä»»åŠ¡å¹¶è¡Œæ‰§è¡Œï¼Œä»ç„¶æ˜¯è¦æŠŠä»»åŠ¡æ”¾åˆ°æ•°ç»„ä¸­ï¼Œä½†ä»»åŠ¡çš„å­˜æ”¾é¡ºåºæ— å…³ç´§è¦ã€‚æ¯ä¸ªä»»åŠ¡éƒ½åº”è¯¥è°ƒç”¨å¤„ç†å™¨å‡½æ•°å¢åŠ å·²å®Œæˆä»»åŠ¡çš„è®¡æ•°å€¼ã€‚å½“æ‰€æœ‰ä»»åŠ¡éƒ½å®Œæˆåï¼Œå¤„ç†å™¨å‡½æ•°åº”è¯¥æ‰§è¡Œåç»­çš„é€»è¾‘ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">'use strict'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">async</span> = <span class="built_in">require</span>(<span class="string">'async'</span>);</span><br><span class="line"><span class="keyword">const</span> exec = <span class="built_in">require</span>(<span class="string">'child_process'</span>).exec;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è¾…åŠ©å‡½æ•°ï¼šä¸‹è½½æŒ‡å®šç‰ˆæœ¬çš„ Node.js æºç </span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">downloadNodeVersion</span>(<span class="params">version, destination, callback</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> url = <span class="string">`http://nodejs.org/dist/v<span class="subst">$&#123;version&#125;</span>/node-v<span class="subst">$&#123;version&#125;</span>.tar.gz`</span>;</span><br><span class="line">  <span class="keyword">const</span> filepath = <span class="string">`<span class="subst">$&#123;destination&#125;</span>/<span class="subst">$&#123;version&#125;</span>.tgz`</span>;</span><br><span class="line">  exec(<span class="string">`curl <span class="subst">$&#123;url&#125;</span> &gt; <span class="subst">$&#123;filepath&#125;</span>`</span>, callback);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä¸²è¡Œæ‰§è¡Œä¸¤ä¸ªä»»åŠ¡ï¼š</span></span><br><span class="line"><span class="comment">// ä»»åŠ¡ä¸€ï¼šå¹¶è¡Œä¸‹è½½ä¸¤ä¸ªç‰ˆæœ¬çš„æºç ï¼›</span></span><br><span class="line"><span class="comment">// ä»»åŠ¡äºŒï¼šå°†ä¸‹è½½å¥½çš„ç‰ˆæœ¬å½’æ¡£åˆ°ä¸€ä¸ªæ–°æ–‡ä»¶ä¸­ã€‚</span></span><br><span class="line"><span class="keyword">async</span>.series([</span><br><span class="line">  callback =&gt; &#123;</span><br><span class="line">    <span class="keyword">async</span>.parallel([</span><br><span class="line">      callback =&gt; &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'Downloading Node V4.4.7...'</span>);</span><br><span class="line">        downloadNodeVersion(<span class="string">'4.4.7'</span>, <span class="string">'/tmp'</span>, callback);</span><br><span class="line">      &#125;,</span><br><span class="line">      callback =&gt; &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'Downloading Node v6.3.0'</span>);</span><br><span class="line">        downloadNodeVersion(<span class="string">'6.3.0'</span>, <span class="string">'/tmp'</span>, callback);</span><br><span class="line">      &#125;,</span><br><span class="line">    ], callback);</span><br><span class="line">  &#125;,</span><br><span class="line">  callback =&gt; &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'Creating archive of download files ...'</span>);</span><br><span class="line">    exec(</span><br><span class="line">      <span class="string">'tar cvf node_distros.tar /tmp/4.4.7.tgz /tmp/6.3.0.tgz'</span>,</span><br><span class="line">      err =&gt; &#123;</span><br><span class="line">        <span class="keyword">if</span> (err) <span class="keyword">throw</span> err;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'All down!'</span>);</span><br><span class="line">        callback();</span><br><span class="line">      &#125;</span><br><span class="line">    );</span><br><span class="line">  &#125;,</span><br><span class="line">], (err, results) =&gt; &#123;</span><br><span class="line">  <span class="keyword">if</span> (err) <span class="keyword">throw</span> err;</span><br><span class="line">  <span class="built_in">console</span>.log(results);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://andy0570.com/2018/10/28/æ·±å…¥æµ…å‡ºNode.js_Buffer/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ç‹¬æœ¨èˆŸçš„æœ¨">
      <meta itemprop="description" content="æœ‰æ—¶å€™é˜³å…‰å¾ˆå¥½ æœ‰æ—¶å€™é˜³å…‰å¾ˆæš—">
      <meta itemprop="image" content="https://ws1.sinaimg.cn/large/006tNc79gy1g22m14458rj30u014xu0x.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ç‹¬æœ¨èˆŸçš„æœ¨">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2018/10/28/æ·±å…¥æµ…å‡ºNode.js_Buffer/" class="post-title-link" itemprop="url">æ·±å…¥æµ…å‡ºNode.js_Buffer</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              

              
                
              

              <time title="åˆ›å»ºæ—¶é—´ï¼š2018-10-28 14:25:00" itemprop="dateCreated datePublished" datetime="2018-10-28T14:25:00+08:00">2018-10-28</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">æ›´æ–°äº</span>
                
                <time title="ä¿®æ”¹æ—¶é—´ï¼š2019-04-17 02:11:46" itemprop="dateModified" datetime="2019-04-17T02:11:46+08:00">2019-04-17</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Node-js/" itemprop="url" rel="index"><span itemprop="name">Node.js</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          
            <span id="/2018/10/28/æ·±å…¥æµ…å‡ºNode.js_Buffer/" class="leancloud_visitors" data-flag-title="æ·±å…¥æµ…å‡ºNode.js_Buffer">
              <span class="post-meta-divider">|</span>
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              
                <span class="post-meta-item-text">é˜…è¯»æ¬¡æ•°ï¼š</span>
              
                <span class="leancloud-visitors-count"></span>
            </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body han-init-context" itemprop="articleBody">

      
      

      
        
          
            <p>åœ¨ç½‘ç»œæµå’Œæ–‡ä»¶çš„æ“ä½œä¸­ï¼Œéœ€è¦å¤„ç†å¤§é‡çš„äºŒè¿›åˆ¶æ•°æ®ï¼ŒJavaScriptè‡ªæœ‰çš„å­—ç¬¦ä¸²æ— æ³•æ»¡è¶³éœ€æ±‚ï¼ˆECAMScript 2015 å¼•å…¥äº† <strong><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/TypedArray" target="_blank" rel="noopener">TypedArray</a></strong>ï¼‰ï¼ŒBuffer å¯¹è±¡åº”è¿è€Œç”Ÿã€‚</p>
<p><a href="http://nodejs.cn/api/buffer.html" target="_blank" rel="noopener">Node.js Buffer API</a></p>
<h2 id="Buffer-ç»“æ„"><a href="#Buffer-ç»“æ„" class="headerlink" title="Buffer ç»“æ„"></a>Buffer ç»“æ„</h2><p>Buffer æ˜¯ä¸€ä¸ªåƒ Array çš„å¯¹è±¡ï¼Œä½†å®ƒä¸»è¦ç”¨äºæ“ä½œå­—èŠ‚ã€‚<br>Buffer çš„è¿ç”¨åœºæ™¯ï¼š<strong>æ–‡ä»¶I/O</strong>ã€<strong>ç½‘ç»œI/O</strong>ã€‚<br>Buffer æ˜¯äºŒè¿›åˆ¶æ•°æ®ï¼Œå­—ç¬¦ä¸²ä¸Bufferä¹‹é—´å­˜åœ¨ç¼–ç å…³ç³»ã€‚</p>
<h3 id="æ¨¡å—ç»“æ„"><a href="#æ¨¡å—ç»“æ„" class="headerlink" title="æ¨¡å—ç»“æ„"></a>æ¨¡å—ç»“æ„</h3><p>Bufferä¸­ï¼Œæ€§èƒ½ç›¸å…³éƒ¨åˆ†ï¼Œä½¿ç”¨C++å®ç°ï¼›éæ€§èƒ½ç›¸å…³éƒ¨åˆ†ï¼Œä½¿ç”¨JavaScriptå®ç°ã€‚</p>
<p><img src="http://upload-images.jianshu.io/upload_images/2648731-28d2c0fd49208b7c.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image"></p>
<ul>
<li>Buffer æ‰€å ç”¨çš„å†…å­˜ä¸æ˜¯é€šè¿‡ V8 åˆ†é…çš„ï¼Œå±äº==å †å¤–å†…å­˜==ã€‚</li>
<li>Node åœ¨è¿›ç¨‹å¯åŠ¨æ—¶å·²ç»åŠ è½½äº† Bufferï¼Œå¹¶å°†å…¶æ”¾åœ¨äº†å…¨å±€å¯¹è±¡ï¼ˆglobalï¼‰ä¸Šã€‚æ‰€ä»¥åœ¨ä½¿ç”¨ Buffer æ—¶ï¼Œæ— é¡»é€šè¿‡ <code>require()</code> å³å¯ç›´æ¥ä½¿ç”¨ã€‚</li>
</ul>
<h3 id="Buffer-å¯¹è±¡"><a href="#Buffer-å¯¹è±¡" class="headerlink" title="Buffer å¯¹è±¡"></a>Buffer å¯¹è±¡</h3><p>Buffer å¯¹è±¡ç±»ä¼¼äºæ•°ç»„ï¼Œå®ƒçš„å…ƒç´ ä¸º 16 è¿›åˆ¶çš„ä¸¤ä½æ•°ï¼Œå³0åˆ°255çš„æ•°å€¼ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> str = <span class="string">'æ·±å…¥æµ…å‡º node.js'</span>;</span><br><span class="line"><span class="keyword">var</span> buf = Buffer.from(str, <span class="string">'utf-8'</span>);</span><br><span class="line"><span class="built_in">console</span>.log(buf); <span class="comment">// &lt;Buffer e6 b7 b1 e5 85 a5 e6 b5 85 e5 87 ba 20 6e 6f 64 65 2e 6a 73&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> buf2 = Buffer.alloc(<span class="number">100</span>);</span><br><span class="line"><span class="comment">// é€šè¿‡ length è·å–é•¿åº¦</span></span><br><span class="line"><span class="built_in">console</span>.log(buf2.length); <span class="comment">// 100</span></span><br><span class="line"><span class="comment">// é€šè¿‡ä¸‹æ ‡è®¿é—®å…ƒç´ ã€èµ‹å€¼</span></span><br><span class="line"><span class="built_in">console</span>.log(buf2[<span class="number">10</span>]); <span class="comment">// 0</span></span><br></pre></td></tr></table></figure>
<p>ç»™å…ƒç´ çš„èµ‹å€¼ï¼ˆ0ï½255ï¼‰è§„åˆ™ï¼š</p>
<ul>
<li>èµ‹å€¼&lt;0ï¼Œé€æ¬¡åŠ 256ï¼›</li>
<li>èµ‹å€¼&gt;255ï¼Œé€æ¬¡å‡256ï¼›</li>
<li>æœ‰å°æ•°ï¼Œèˆå¼ƒå°æ•°éƒ¨åˆ†ï¼›</li>
</ul>
<h3 id="Buffer-å†…å­˜åˆ†é…"><a href="#Buffer-å†…å­˜åˆ†é…" class="headerlink" title="Buffer å†…å­˜åˆ†é…"></a>Buffer å†…å­˜åˆ†é…</h3><ul>
<li><p>Buffer å¯¹è±¡çš„å†…å­˜åˆ†é…æ˜¯åœ¨ Node çš„ C++ å±‚é¢ä¸Šå®ç°çš„å†…å­˜ç”³è¯·ã€‚</p>
</li>
<li><p>Nodeé‡‡ç”¨äº† slab åˆ†é…æœºåˆ¶ï¼Œslab æ˜¯ä¸€ç§åŠ¨æ€å†…å­˜ç®¡ç†æœºåˆ¶ã€‚slab æ˜¯ä¸€å—ç”³è¯·å¥½çš„å›ºå®šå¤§å°çš„å†…å­˜åŒºåŸŸï¼Œslabçš„3ç§çŠ¶æ€ï¼š</p>
<ul>
<li>fullï¼šå®Œå…¨åˆ†é…çŠ¶æ€ï¼›</li>
<li>partialï¼šéƒ¨åˆ†åˆ†é…çŠ¶æ€ï¼›</li>
<li>emptyï¼šæ²¡æœ‰è¢«åˆ†é…çŠ¶æ€ï¼›</li>
</ul>
</li>
<li>Node ä»¥ 8KB æ¥åŒºåˆ† Buffer æ˜¯å¤§å¯¹è±¡è¿˜æ˜¯å°å¯¹è±¡ã€‚</li>
</ul>
<p>ç®€å•è€Œè¨€ï¼ŒçœŸæ­£çš„å†…å­˜æ˜¯åœ¨Nodeçš„C++å±‚é¢æä¾›çš„ï¼ŒJavaScriptå±‚é¢åªæ˜¯ä½¿ç”¨å®ƒã€‚</p>
<ul>
<li>å½“è¿›è¡Œå°è€Œé¢‘ç¹çš„ Buffer æ“ä½œæ—¶ï¼Œé‡‡ç”¨ slab çš„æœºåˆ¶è¿›è¡Œé¢„å…ˆç”³è¯·å’Œäº‹ååˆ†é…ï¼Œä½¿å¾— JavaScript åˆ°æ“ä½œç³»ç»Ÿä¹‹é—´ä¸å¿…æœ‰è¿‡å¤šçš„å†…å­˜ç”³è¯·æ–¹é¢çš„ç³»ç»Ÿè°ƒç”¨ã€‚</li>
<li>å¯¹äºå¤§å—çš„ Buffer è€Œè¨€ï¼Œåˆ™ç›´æ¥ä½¿ç”¨C++å±‚é¢æä¾›çš„å†…å­˜ï¼Œè€Œæ— éœ€ç»†è…»çš„åˆ†é…æ“ä½œã€‚</li>
</ul>
<h2 id="Buffer-çš„è½¬æ¢"><a href="#Buffer-çš„è½¬æ¢" class="headerlink" title="Buffer çš„è½¬æ¢"></a>Buffer çš„è½¬æ¢</h2><p>Buffer å¯¹è±¡å¯ä»¥ä¸å­—ç¬¦ä¸²ä¹‹é—´ç›¸äº’è½¬æ¢ã€‚</p>
<p>æ”¯æŒçš„å­—ç¬¦ä¸²ç¼–ç ç±»å‹æœ‰ï¼šASCIIã€UTF-8ã€UTF-16LE/UCS-2ã€Base64ã€Latin1ã€Binaryã€Hexã€‚</p>
<p>åˆ¤æ–­ç¼–ç æ˜¯å¦æ”¯æŒè½¬æ¢ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Buffer.isEncoding(ecoding); <span class="comment">// true/false</span></span><br></pre></td></tr></table></figure>
<p>ç¬¬ä¸‰æ–¹æ¨¡å—ï¼š</p>
<ul>
<li>iconvï¼šé€šè¿‡ C++ è°ƒç”¨ libiconv åº“å®Œæˆã€‚</li>
<li>iconv-liteï¼šé€šè¿‡ JavaScript å®ç°ã€‚</li>
</ul>
<h3 id="å®½å­—èŠ‚ä¸­æ–‡ä¹±ç "><a href="#å®½å­—èŠ‚ä¸­æ–‡ä¹±ç " class="headerlink" title="å®½å­—èŠ‚ä¸­æ–‡ä¹±ç "></a>å®½å­—èŠ‚ä¸­æ–‡ä¹±ç </h3><ul>
<li><code>buf.toString([encoding[, start[, end]]])</code> </li>
<li>æ–‡ä»¶å¯è¯»æµåœ¨è¯»å–æ—¶ä¼šé€ä¸ªè¯»å–Bufferã€‚</li>
<li>å®½å­—èŠ‚å­—ç¬¦ä¸²åœ¨UTF-8ç¼–ç ä¸‹æ˜¯ä»¥3ä¸ªå­—èŠ‚çš„æ–¹å¼å­˜å‚¨çš„ã€‚</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Buffer çš„æ‹¼æ¥</span></span><br><span class="line"><span class="keyword">var</span> chunks = []; <span class="comment">// ç”¨æ•°ç»„æ¥å­˜å‚¨æ¥æ”¶åˆ°çš„æ‰€æœ‰Bufferç‰‡æ®µ</span></span><br><span class="line"><span class="keyword">var</span> size = <span class="number">0</span>;    <span class="comment">// è®°å½•ä¸‹æ‰€æœ‰ç‰‡æ®µçš„æ€»é•¿åº¦</span></span><br><span class="line">res.on(<span class="string">'data'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">chunk</span>) </span>&#123;</span><br><span class="line">    chunks.push(chunk);</span><br><span class="line">    size += chunk.length;</span><br><span class="line">&#125;);</span><br><span class="line">res.on(<span class="string">'end'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// Buffer.concat() ç”Ÿæˆä¸€ä¸ªåˆå¹¶çš„ Buffer å¯¹è±¡</span></span><br><span class="line">    <span class="keyword">var</span> buf = Buffer.concat(chunks, size);</span><br><span class="line">    vr str = iconv.decode(buf, <span class="string">'utf8'</span>);</span><br><span class="line">    <span class="built_in">console</span>.log(str);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h2 id="Buffer-ä¸æ€§èƒ½"><a href="#Buffer-ä¸æ€§èƒ½" class="headerlink" title="Buffer ä¸æ€§èƒ½"></a>Buffer ä¸æ€§èƒ½</h2><ul>
<li>é€šè¿‡é¢„å…ˆè½¬æ¢é™æ€å†…å®¹ä¸ºBufferå¯¹è±¡ï¼Œå¯ä»¥æœ‰æ•ˆåœ°å‡å°‘CPUçš„é‡å¤ä½¿ç”¨ï¼ŒèŠ‚çœæœåŠ¡å™¨èµ„æºã€‚</li>
<li>åœ¨æ–‡ä»¶è¯»å–æ—¶ï¼Œ<strong>highWaterMark</strong> çš„è®¾ç½®å¯¹æ€§èƒ½è‡³å…³é‡è¦ã€‚è¯¥å€¼è¶Šå¤§ï¼Œè¯»å–é€Ÿåº¦è¶Šå¿«ã€‚</li>
</ul>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://andy0570.com/2018/10/26/æ·±å…¥æµ…å‡ºNode.js_å†…å­˜æ§åˆ¶/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ç‹¬æœ¨èˆŸçš„æœ¨">
      <meta itemprop="description" content="æœ‰æ—¶å€™é˜³å…‰å¾ˆå¥½ æœ‰æ—¶å€™é˜³å…‰å¾ˆæš—">
      <meta itemprop="image" content="https://ws1.sinaimg.cn/large/006tNc79gy1g22m14458rj30u014xu0x.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ç‹¬æœ¨èˆŸçš„æœ¨">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2018/10/26/æ·±å…¥æµ…å‡ºNode.js_å†…å­˜æ§åˆ¶/" class="post-title-link" itemprop="url">æ·±å…¥æµ…å‡ºNode.js_å†…å­˜æ§åˆ¶</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              

              
                
              

              <time title="åˆ›å»ºæ—¶é—´ï¼š2018-10-26 14:33:00" itemprop="dateCreated datePublished" datetime="2018-10-26T14:33:00+08:00">2018-10-26</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">æ›´æ–°äº</span>
                
                <time title="ä¿®æ”¹æ—¶é—´ï¼š2019-04-17 02:12:27" itemprop="dateModified" datetime="2019-04-17T02:12:27+08:00">2019-04-17</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Node-js/" itemprop="url" rel="index"><span itemprop="name">Node.js</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          
            <span id="/2018/10/26/æ·±å…¥æµ…å‡ºNode.js_å†…å­˜æ§åˆ¶/" class="leancloud_visitors" data-flag-title="æ·±å…¥æµ…å‡ºNode.js_å†…å­˜æ§åˆ¶">
              <span class="post-meta-divider">|</span>
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              
                <span class="post-meta-item-text">é˜…è¯»æ¬¡æ•°ï¼š</span>
              
                <span class="leancloud-visitors-count"></span>
            </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body han-init-context" itemprop="articleBody">

      
      

      
        
          
            <h1 id="å†…å­˜æ§åˆ¶"><a href="#å†…å­˜æ§åˆ¶" class="headerlink" title="å†…å­˜æ§åˆ¶"></a>å†…å­˜æ§åˆ¶</h1><p>å†…å­˜æ§åˆ¶æ˜¯åœ¨<strong>æµ·é‡è¯·æ±‚</strong>å’Œ<strong>é•¿æ—¶é—´è¿è¡Œ</strong>çš„å‰æä¸‹è¿›è¡Œæ¢è®¨çš„ã€‚</p>
<p>åœ¨Nodeä¸­å¦‚ä½•é«˜æ•ˆåœ°ä½¿ç”¨å†…å­˜ï¼Ÿ</p>
<h2 id="V8-çš„åƒåœ¾å›æ”¶æœºåˆ¶ä¸å†…å­˜é™åˆ¶"><a href="#V8-çš„åƒåœ¾å›æ”¶æœºåˆ¶ä¸å†…å­˜é™åˆ¶" class="headerlink" title="V8 çš„åƒåœ¾å›æ”¶æœºåˆ¶ä¸å†…å­˜é™åˆ¶"></a>V8 çš„åƒåœ¾å›æ”¶æœºåˆ¶ä¸å†…å­˜é™åˆ¶</h2><h3 id="V8-çš„å†…å­˜é™åˆ¶"><a href="#V8-çš„å†…å­˜é™åˆ¶" class="headerlink" title="V8 çš„å†…å­˜é™åˆ¶"></a>V8 çš„å†…å­˜é™åˆ¶</h3><ul>
<li>Nodeé€šè¿‡ JavaScript ä½¿ç”¨å†…å­˜çš„é™åˆ¶ï¼š64ä½ç³»ç»Ÿä¸‹çº¦ä¸º 1.4 GBï¼Œ32ä½ç³»ç»Ÿä¸‹çº¦ä¸º 0.7 GBã€‚</li>
<li>Node åŸºäº V8 æ„å»ºï¼Œæ‰€ä»¥åœ¨Nodeä¸­ä½¿ç”¨çš„ JavaScript å¯¹è±¡åŸºæœ¬ä¸Šéƒ½æ˜¯é€šè¿‡V8è‡ªå·±çš„æ–¹å¼æ¥è¿›è¡Œç®¡ç†å’Œåˆ†é…çš„ã€‚</li>
</ul>
<h3 id="V8-çš„å¯¹è±¡åˆ†é…"><a href="#V8-çš„å¯¹è±¡åˆ†é…" class="headerlink" title="V8 çš„å¯¹è±¡åˆ†é…"></a>V8 çš„å¯¹è±¡åˆ†é…</h3><ul>
<li>åœ¨ V8 ä¸­ï¼Œæ‰€æœ‰çš„ JavaScript å¯¹è±¡éƒ½æ˜¯é€šè¿‡==å †==æ¥åˆ†é…çš„ã€‚</li>
<li>V8 é™åˆ¶å †å†…å­˜ï¼Œæ˜¯åŸºäºåƒåœ¾å›æ”¶æœºåˆ¶ä¸åº”ç”¨æ€§èƒ½çš„è€ƒé‡ï¼Œï¼ˆåƒåœ¾å›æ”¶ä¼šå¼•èµ· JS çº¿ç¨‹æš‚åœæ‰§è¡Œï¼‰ã€‚</li>
</ul>
<p>æŸ¥çœ‹Node çš„å†…å­˜ä½¿ç”¨é‡ï¼š</p>
<h4 id="æŸ¥çœ‹è¿›ç¨‹çš„å†…å­˜å ç”¨ï¼šprocess-memoryUsage"><a href="#æŸ¥çœ‹è¿›ç¨‹çš„å†…å­˜å ç”¨ï¼šprocess-memoryUsage" class="headerlink" title="æŸ¥çœ‹è¿›ç¨‹çš„å†…å­˜å ç”¨ï¼šprocess.memoryUsage()"></a>æŸ¥çœ‹è¿›ç¨‹çš„å†…å­˜å ç”¨ï¼šprocess.memoryUsage()</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> node</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> process.memoryUsage();</span></span><br><span class="line">&#123; rss: 23175168,      # è¿›ç¨‹çš„å¸¸é©»å†…å­˜éƒ¨åˆ†</span><br><span class="line">  heapTotal: 9682944, # å·²ç”³è¯·åˆ°çš„å †å†…å­˜</span><br><span class="line">  heapUsed: 5283000,  # å †å†…å­˜å½“å‰ä½¿ç”¨é‡</span><br><span class="line">  external: 11777 &#125;</span><br><span class="line"><span class="meta">&gt;</span><span class="bash"></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> å †ä¸­çš„å†…å­˜æ€»é‡&lt;è¿›ç¨‹çš„å¸¸é©»å†…å­˜ç”¨é‡</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> å †å¤–å†…å­˜ï¼šä¸æ˜¯é€šè¿‡V8åˆ†é…çš„å†…å­˜ã€‚</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Buffer å¯¹è±¡ä¸ç»è¿‡ V8 çš„å†…å­˜åˆ†é…æœºåˆ¶ã€‚</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Node çš„å†…å­˜æ„æˆï¼šé€šè¿‡ V8 åˆ†é…çš„éƒ¨åˆ† + Node è‡ªè¡Œåˆ†é…çš„éƒ¨åˆ†ã€‚</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> å› æ­¤ï¼Œå—åˆ° V8 çš„åƒåœ¾å›æ”¶æœºåˆ¶é™åˆ¶çš„ä¸»è¦æ˜¯ V8 çš„å †å†…å­˜ã€‚</span></span><br></pre></td></tr></table></figure>
<h4 id="æŸ¥çœ‹ç³»ç»Ÿçš„å†…å­˜å ç”¨ï¼šos-totalmem-å’Œ-freemem"><a href="#æŸ¥çœ‹ç³»ç»Ÿçš„å†…å­˜å ç”¨ï¼šos-totalmem-å’Œ-freemem" class="headerlink" title="æŸ¥çœ‹ç³»ç»Ÿçš„å†…å­˜å ç”¨ï¼šos.totalmem() å’Œ freemem()"></a>æŸ¥çœ‹ç³»ç»Ÿçš„å†…å­˜å ç”¨ï¼šos.totalmem() å’Œ freemem()</h4><p>æŸ¥çœ‹æ“ä½œç³»ç»Ÿçš„å†…å­˜ä½¿ç”¨æƒ…å†µï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> node</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> os.totalmem() <span class="comment"># è¿”å›ç³»ç»Ÿæ€»å†…å­˜</span></span></span><br><span class="line">17179869184</span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> os.freemem() <span class="comment"># è¿”å›ç³»ç»Ÿé—²ç½®å†…å­˜</span></span></span><br><span class="line">4516331520</span><br></pre></td></tr></table></figure>
<p>Node å¯åŠ¨æ—¶å¯ä»¥è°ƒæ•´å†…å­˜ä½¿ç”¨é‡ï¼š</p>
<figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">node</span> <span class="title">--max-old-space-size</span>=<span class="number">1700</span> test.js // å•ä½ä¸ºMBï¼Œè®¾ç½®è€ç”Ÿä»£å†…å­˜ç©ºé—´æœ€å¤§å€¼</span><br><span class="line"><span class="keyword">node</span> <span class="title">--max-new-space-size</span>=<span class="number">1024</span> test.js // å•ä½ä¸ºKBï¼Œè®¾ç½®æ–°ç”Ÿä»£å†…å­˜ç©ºé—´å¤§å°</span><br></pre></td></tr></table></figure>
<h3 id="V8-çš„åƒåœ¾å›æ”¶æœºåˆ¶"><a href="#V8-çš„åƒåœ¾å›æ”¶æœºåˆ¶" class="headerlink" title="V8 çš„åƒåœ¾å›æ”¶æœºåˆ¶"></a>V8 çš„åƒåœ¾å›æ”¶æœºåˆ¶</h3><ul>
<li><p>V8 çš„åƒåœ¾å›æ”¶ç­–ç•¥ä¸»è¦åŸºäº==åˆ†ä»£å¼åƒåœ¾å›æ”¶æœºåˆ¶==ã€‚</p>
</li>
<li><p>V8 çš„å†…å­˜åˆ†ä»£ï¼š</p>
<ul>
<li>V8 å †å†…å­˜ï¼šæ–°ç”Ÿä»£å†…å­˜+è€ç”Ÿä»£å†…å­˜ã€‚</li>
<li>æ–°ç”Ÿä»£çš„å†…å­˜ç©ºé—´ä¸­çš„å¯¹è±¡ï¼šå­˜æ´»æ—¶é—´çŸ­ã€‚</li>
<li>è€ç”Ÿä»£çš„å†…å­˜ç©ºé—´ä¸­çš„å¯¹è±¡ï¼šå­˜æ´»æ—¶é—´é•¿ã€å¸¸é©»å†…å­˜å¯¹è±¡ã€‚</li>
</ul>
<p>| V8å¼•æ“ä¸‹çš„å †å†…å­˜åˆ†é… | 64ä½ç³»ç»Ÿ           | 32ä½ç³»ç»Ÿ         |<br>| â€”â€”â€”â€”â€”â€”â€“ | â€”â€”â€”â€”â€”â€” | â€”â€”â€”â€”â€”- |<br>| é»˜è®¤è€ç”Ÿä»£å†…å­˜æœ€å¤§å€¼ | 1400 MB            | 700 MB           |<br>| é»˜è®¤æ–°ç”Ÿä»£å†…å­˜æœ€å¤§å€¼ | 32 MB              | 16 MB            |<br>| V8 å †å†…å­˜çš„æœ€å¤§å€¼    | 1464 MB ï¼ˆ1.4 GBï¼‰ | 732 MBï¼ˆ0.7 GBï¼‰ |</p>
</li>
<li><p>æ–°ç”Ÿä»£ä¸­çš„å¯¹è±¡ä¸»è¦é€šè¿‡ Scavenge ç®—æ³•è¿›è¡Œåƒåœ¾å›æ”¶ï¼ŒScavenge ç®—æ³•ä¸»è¦é‡‡ç”¨ Cheney ç®—æ³•ï¼ˆé‡‡ç”¨å¤åˆ¶çš„æ–¹å¼å®ç°åƒåœ¾å›æ”¶From-Toï¼‰å®ç°ã€‚</p>
</li>
<li><p>è€ç”Ÿä»£ä¸­çš„å¯¹è±¡ä¸»è¦é‡‡ç”¨äº†Mark-Sweepï¼ˆæ ‡è®°æ¸…é™¤ï¼‰å’ŒMarl-Compactï¼ˆæ ‡è®°æ•´ç†ï¼‰ç›¸ç»“åˆçš„æ–¹å¼è¿›è¡Œåƒåœ¾å›æ”¶ã€‚</p>
<p><img src="http://upload-images.jianshu.io/upload_images/2648731-f004f825fab12a86.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image"></p>
</li>
</ul>
<h3 id="æŸ¥çœ‹åƒåœ¾å›æ”¶æ—¥å¿—ï¼š-trach-gc"><a href="#æŸ¥çœ‹åƒåœ¾å›æ”¶æ—¥å¿—ï¼š-trach-gc" class="headerlink" title="æŸ¥çœ‹åƒåœ¾å›æ”¶æ—¥å¿—ï¼š--trach_gc"></a>æŸ¥çœ‹åƒåœ¾å›æ”¶æ—¥å¿—ï¼š<code>--trach_gc</code></h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> åœ¨ gc.log æ–‡ä»¶ä¸­å¾—åˆ°æ‰€æœ‰çš„åƒåœ¾å›æ”¶ä¿¡æ¯ã€‚</span></span><br><span class="line">node --trach_gc -e "var a = [];for (var i = 0; i &lt; 1000000; i++) a.push(new Array(100));" &gt; gc.log</span><br></pre></td></tr></table></figure>
<h3 id="æŸ¥çœ‹æ€§èƒ½åˆ†ææ•°æ®ï¼š-prof"><a href="#æŸ¥çœ‹æ€§èƒ½åˆ†ææ•°æ®ï¼š-prof" class="headerlink" title="æŸ¥çœ‹æ€§èƒ½åˆ†ææ•°æ®ï¼š--prof"></a>æŸ¥çœ‹æ€§èƒ½åˆ†ææ•°æ®ï¼š<code>--prof</code></h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">node --prof test.js</span><br></pre></td></tr></table></figure>
<ul>
<li><p>V8 æä¾›äº† linux-tick-processor å·¥å…·ï¼ˆNodeè·¯å¾„ï¼šdeps/v8/toolsï¼‰ç”¨äºç»Ÿè®¡æ—¥å¿—ä¿¡æ¯ã€‚</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> å°†è¯¥å·¥å…·çš„ç›®å½•æ·»åŠ åˆ°ç¯å¢ƒå˜é‡ PATH ä¸­ï¼Œæ‰§è¡Œåˆ†ææ—¥å¿—å‘½ä»¤ï¼š</span></span><br><span class="line">linux-tick-processor v8.log</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="é«˜æ•ˆä½¿ç”¨å†…å­˜"><a href="#é«˜æ•ˆä½¿ç”¨å†…å­˜" class="headerlink" title="é«˜æ•ˆä½¿ç”¨å†…å­˜"></a>é«˜æ•ˆä½¿ç”¨å†…å­˜</h2><p>å¦‚ä½•è®©åƒåœ¾å›æ”¶æœºåˆ¶æ›´é«˜æ•ˆåœ°å·¥ä½œï¼Ÿ</p>
<h3 id="ä½œç”¨åŸŸ"><a href="#ä½œç”¨åŸŸ" class="headerlink" title="ä½œç”¨åŸŸ"></a>ä½œç”¨åŸŸ</h3><ul>
<li><p>JavaScript ä¸­èƒ½å½¢æˆä½œç”¨åŸŸçš„æ–¹å¼ï¼šå‡½æ•°è°ƒç”¨ã€withã€å…¨å±€ä½œç”¨åŸŸã€‚</p>
</li>
<li><p>æ ‡è¯†ç¬¦æŸ¥æ‰¾ï¼Œå˜é‡åªèƒ½å‘å¤–è®¿é—®ï¼Œè€Œä¸èƒ½å‘å†…è®¿é—®ï¼›</p>
</li>
<li><p>ä½œç”¨åŸŸé“¾ï¼›</p>
</li>
<li><p>å˜é‡çš„ä¸»åŠ¨é‡Šæ”¾ï¼šdelete æ“ä½œã€å°†å˜é‡é‡æ–°èµ‹å€¼ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å…¨å±€å˜é‡ï¼Œè¿›ç¨‹é€€å‡ºæ‰ä¼šé‡Šæ”¾</span></span><br><span class="line">global.foo = <span class="string">'I am global object'</span>;</span><br><span class="line"><span class="built_in">console</span>.log(global.foo); <span class="comment">// =&gt; 'I am global object'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 1. delete æ“ä½œåˆ é™¤å…¨å±€å˜é‡</span></span><br><span class="line"><span class="keyword">delete</span> global.foo; </span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. é‡æ–°èµ‹å€¼</span></span><br><span class="line">global.foo = <span class="literal">undefined</span>; <span class="comment">// or null</span></span><br><span class="line"><span class="built_in">console</span>.log(global.foo); <span class="comment">// =&gt; 'undefined'</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>ğŸ’¡ åœ¨ V8 ä¸­é€šè¿‡ delete åˆ é™¤å¯¹è±¡çš„å±æ€§æœ‰å¯èƒ½å¹²æ‰° V8 çš„ä¼˜åŒ–ï¼Œæ‰€ä»¥<strong>é€šè¿‡èµ‹å€¼æ–¹å¼è§£é™¤å¼•ç”¨</strong>æ›´å¥½ã€‚</p>
</blockquote>
</li>
</ul>
<h3 id="é—­åŒ…ï¼šå®ç°å¤–éƒ¨ä½œç”¨åŸŸè®¿é—®å†…éƒ¨ä½œç”¨åŸŸä¸­å˜é‡çš„æ–¹æ³•"><a href="#é—­åŒ…ï¼šå®ç°å¤–éƒ¨ä½œç”¨åŸŸè®¿é—®å†…éƒ¨ä½œç”¨åŸŸä¸­å˜é‡çš„æ–¹æ³•" class="headerlink" title="é—­åŒ…ï¼šå®ç°å¤–éƒ¨ä½œç”¨åŸŸè®¿é—®å†…éƒ¨ä½œç”¨åŸŸä¸­å˜é‡çš„æ–¹æ³•"></a>é—­åŒ…ï¼šå®ç°å¤–éƒ¨ä½œç”¨åŸŸè®¿é—®å†…éƒ¨ä½œç”¨åŸŸä¸­å˜é‡çš„æ–¹æ³•</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> foo = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> bar = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> local = <span class="string">'å±€éƒ¨å˜é‡'</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123; <span class="comment">// å‡½æ•°ä½œä¸ºè¿”å›å€¼ï¼Œä¸”è¯¥åŒ¿åå‡½æ•°å¯ä»¥è®¿é—®local</span></span><br><span class="line">            <span class="keyword">return</span> local; <span class="comment">// å†…éƒ¨ä½œç”¨åŸŸå¯ä»¥è®¿é—®å¤–éƒ¨å¯¹è±¡</span></span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">var</span> baz = bar(); <span class="comment">// bar() å‡½æ•°è¿”å›çš„æ˜¯ä¸€ä¸ªåŒ¿åå‡½æ•°ï¼Œä¸”å¯ä»¥è®¿é—®local</span></span><br><span class="line">    <span class="built_in">console</span>.log(baz());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åœ¨æ­£å¸¸çš„ JavaScript æ‰§è¡Œä¸­ï¼Œæ— æ³•ç«‹å³å›æ”¶çš„å†…å­˜ï¼š</p>
<ol>
<li>é—­åŒ…ï¼›</li>
<li>å…¨å±€å˜é‡ï¼›</li>
</ol>
<h3 id="æ…å°†å†…å­˜å½“ç¼“å­˜"><a href="#æ…å°†å†…å­˜å½“ç¼“å­˜" class="headerlink" title="æ…å°†å†…å­˜å½“ç¼“å­˜"></a>æ…å°†å†…å­˜å½“ç¼“å­˜</h3><ul>
<li>åœ¨Nodeä¸­ï¼Œä»»ä½•è¯•å›¾æ‹¿å†…å­˜å½“ç¼“å­˜çš„è¡Œä¸ºéƒ½åº”å½“è¢«é™åˆ¶ã€‚</li>
<li><a href="https://github.com/isaacs/node-lru-cache" target="_blank" rel="noopener">Iru cache</a></li>
</ul>
<h4 id="ç¼“å­˜çš„è§£å†³æ–¹æ¡ˆ"><a href="#ç¼“å­˜çš„è§£å†³æ–¹æ¡ˆ" class="headerlink" title="ç¼“å­˜çš„è§£å†³æ–¹æ¡ˆ"></a>ç¼“å­˜çš„è§£å†³æ–¹æ¡ˆ</h4><p>è¿›ç¨‹ä¹‹é—´æ— æ³•å…±äº«å†…å­˜ï¼Œä½¿ç”¨å¤§é‡ç¼“å­˜çš„è§£å†³æ–¹æ¡ˆï¼šé‡‡ç”¨è¿›ç¨‹å¤–çš„ç¼“å­˜ï¼Œè¿›ç¨‹è‡ªèº«ä¸å­˜å‚¨çŠ¶æ€ã€‚</p>
<p>è§£å†³æ–¹æ¡ˆï¼š</p>
<ul>
<li><a href="https://github.com/NodeRedis/node_redis" target="_blank" rel="noopener">redis</a></li>
<li><a href="https://github.com/3rd-Eden/memcached" target="_blank" rel="noopener">Memcached</a></li>
</ul>
<h3 id="å…³æ³¨é˜Ÿåˆ—çŠ¶æ€"><a href="#å…³æ³¨é˜Ÿåˆ—çŠ¶æ€" class="headerlink" title="å…³æ³¨é˜Ÿåˆ—çŠ¶æ€"></a>å…³æ³¨é˜Ÿåˆ—çŠ¶æ€</h3><p>æ¶ˆè´¹é€Ÿåº¦ &lt; ç”Ÿäº§é€Ÿåº¦æ—¶ï¼Œå°†ä¼šå½¢æˆå †ç§¯ï¼š</p>
<p>æ—¥å¿—æ”¶é›†æ—¶ï¼Œé€‰æ‹©æ›´é«˜æ•ˆçš„æ–‡ä»¶å†™å…¥æ—¥å¿—ï¼Œè€Œä¸æ˜¯æ•°æ®åº“å†™å…¥æ—¥å¿—ã€‚</p>
<p>æ·±åº¦çš„è§£å†³æ–¹æ¡ˆï¼š1. ç›‘æ§é˜Ÿåˆ—çš„é•¿åº¦ï¼›2.ä»»æ„å¼‚æ­¥è°ƒç”¨éƒ½åº”è¯¥åŒ…å«è¶…æ—¶æœºåˆ¶ã€‚</p>
<p>Bagpipe çš„è¶…æ—¶æ¨¡å¼å’Œæ‹’ç»æ¨¡å¼ã€‚</p>
<h3 id="å†…å­˜æ³„æ¼æ’æŸ¥"><a href="#å†…å­˜æ³„æ¼æ’æŸ¥" class="headerlink" title="å†…å­˜æ³„æ¼æ’æŸ¥"></a>å†…å­˜æ³„æ¼æ’æŸ¥</h3><p>Nodeå†…å­˜æ³„æ¼æ£€æµ‹å·¥å…·ï¼š</p>
<ul>
<li><del>v8-profilerã€‚ç”±Danny Coastesæä¾›ï¼Œå®ƒå¯ä»¥ç”¨äºå¯¹V8å †å†…å­˜æŠ“å–å¿«ç…§å’Œå¯¹CPUè¿›è¡Œåˆ†æï¼Œè¯¥é¡¹ç›®å·²æœ‰3å¹´æ²¡ç»´æŠ¤äº†</del></li>
<li>node-heapdumpã€‚è¿™æ˜¯Nodeæ ¸å¿ƒè´¡çŒ®è€…ä¹‹ä¸€Ben Noordhuisç¼–å†™çš„æ¨¡å—ï¼Œå®ƒå…è®¸å¯¹V8å †å†…å­˜æŠ“å–å¿«ç…§ï¼Œç”¨äºäº‹ååˆ†æã€‚</li>
<li>node-mtraceã€‚ç”±Jimb Esseræä¾›ï¼Œå®ƒä½¿ç”¨äº†GCCçš„mtraceå·¥å…·æ¥åˆ†æå †çš„ä½¿ç”¨ã€‚</li>
<li>dtaceã€‚åœ¨Joyentçš„SmartOSç³»ç»Ÿä¸Šï¼Œæœ‰å®Œå–„çš„dtraceå·¥å…·ç”¨æ¥åˆ†æå†…å­˜æ³„æ¼ã€‚</li>
<li>node-memwatchã€‚æ¥è‡ªMozillaçš„Lloyd Hilaielè´¡çŒ®çš„æ¨¡å—ï¼Œé‡‡ç”¨WTFPLè®¸å¯å‘å¸ƒã€‚</li>
</ul>
<h3 id="å¤§å†…å­˜åº”ç”¨"><a href="#å¤§å†…å­˜åº”ç”¨" class="headerlink" title="å¤§å†…å­˜åº”ç”¨"></a>å¤§å†…å­˜åº”ç”¨</h3><p>Node æä¾›äº† <strong>stream</strong> æ¨¡å—ç”¨äºå¤„ç†å¤§æ–‡ä»¶ã€‚</p>
<p>fs æ¨¡å—çš„<code>createReadStream()</code> å’Œ <code>createWriteStream()</code> æ–¹æ³•å¯ä»¥åˆ†åˆ«ç”¨äºåˆ›å»ºæ–‡ä»¶çš„å¯è¯»æµä¸å¯å†™æµã€‚</p>
<p>process æ¨¡å—ä¸­çš„ stdin å’Œ stdout åˆ†åˆ«æ˜¯å¯è¯»æµå’Œå¯å†™æµçš„ç¤ºä¾‹ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// è¯»å–ä¸€ä¸ªæ–‡ä»¶ï¼Œç„¶åå°†æ•°æ®å†™å…¥åˆ°å¦ä¸€ä¸ªæ–‡ä»¶ä¸­</span></span><br><span class="line"><span class="comment">// æµå¤„ç†çš„æ–¹å¼ä¸ä¼šå—åˆ°V8å†…å­˜é™åˆ¶çš„å½±å“ã€‚</span></span><br><span class="line"><span class="keyword">var</span> reader = fs.createReadStream(<span class="string">'in.txt'</span>);</span><br><span class="line"><span class="keyword">var</span> writer = fs.createWriteStream(<span class="string">'out.txt'</span>);</span><br><span class="line">reader.on(<span class="string">'data'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">chunk</span>) </span>&#123;</span><br><span class="line">    writer.write(chunk);</span><br><span class="line">&#125;);</span><br><span class="line">reader.on(<span class="string">'end'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    writer.end();</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä¸Šè¿°ä»£ç çš„ç®€å†™æ–¹æ³•ï¼š</span></span><br><span class="line"><span class="keyword">var</span> reader = fs.createReadStream(<span class="string">'in.txt'</span>);</span><br><span class="line"><span class="keyword">var</span> writer = fs.createWriteStream(<span class="string">'out.txt'</span>);</span><br><span class="line">reader.pipe(writer);</span><br></pre></td></tr></table></figure>
<blockquote>
<p> ğŸ’¡</p>
<p>å¦‚æœä¸éœ€è¦è¿›è¡Œå­—ç¬¦ä¸²å±‚é¢çš„æ“ä½œï¼Œåˆ™ä¸éœ€è¦å€ŸåŠ© V8 æ¥å¤„ç†ï¼Œå¯ä»¥å°è¯•è¿›è¡Œçº¯ç²¹çš„ ==Buffer== æ“ä½œï¼Œè¿™ä¸ä¼šå—åˆ° V8 å †å†…å­˜çš„é™åˆ¶ã€‚</p>
</blockquote>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://andy0570.com/2018/10/26/æ·±å…¥æµ…å‡ºNode.js_å¼‚æ­¥ç¼–ç¨‹/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ç‹¬æœ¨èˆŸçš„æœ¨">
      <meta itemprop="description" content="æœ‰æ—¶å€™é˜³å…‰å¾ˆå¥½ æœ‰æ—¶å€™é˜³å…‰å¾ˆæš—">
      <meta itemprop="image" content="https://ws1.sinaimg.cn/large/006tNc79gy1g22m14458rj30u014xu0x.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ç‹¬æœ¨èˆŸçš„æœ¨">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2018/10/26/æ·±å…¥æµ…å‡ºNode.js_å¼‚æ­¥ç¼–ç¨‹/" class="post-title-link" itemprop="url">æ·±å…¥æµ…å‡ºNode.js_å¼‚æ­¥ç¼–ç¨‹</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              

              
                
              

              <time title="åˆ›å»ºæ—¶é—´ï¼š2018-10-26 14:32:00" itemprop="dateCreated datePublished" datetime="2018-10-26T14:32:00+08:00">2018-10-26</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">æ›´æ–°äº</span>
                
                <time title="ä¿®æ”¹æ—¶é—´ï¼š2019-04-17 02:13:06" itemprop="dateModified" datetime="2019-04-17T02:13:06+08:00">2019-04-17</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Node-js/" itemprop="url" rel="index"><span itemprop="name">Node.js</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          
            <span id="/2018/10/26/æ·±å…¥æµ…å‡ºNode.js_å¼‚æ­¥ç¼–ç¨‹/" class="leancloud_visitors" data-flag-title="æ·±å…¥æµ…å‡ºNode.js_å¼‚æ­¥ç¼–ç¨‹">
              <span class="post-meta-divider">|</span>
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              
                <span class="post-meta-item-text">é˜…è¯»æ¬¡æ•°ï¼š</span>
              
                <span class="leancloud-visitors-count"></span>
            </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body han-init-context" itemprop="articleBody">

      
      

      
        
          
            <h3 id="Node-çš„ç‰¹ç‚¹ï¼šäº‹ä»¶é©±åŠ¨ã€éé˜»å¡I-O"><a href="#Node-çš„ç‰¹ç‚¹ï¼šäº‹ä»¶é©±åŠ¨ã€éé˜»å¡I-O" class="headerlink" title="Node çš„ç‰¹ç‚¹ï¼šäº‹ä»¶é©±åŠ¨ã€éé˜»å¡I/O"></a>Node çš„ç‰¹ç‚¹ï¼šäº‹ä»¶é©±åŠ¨ã€éé˜»å¡I/O</h3><ol>
<li>å¼‚æ­¥I/Oï¼›</li>
<li>äº‹ä»¶ï¼ˆè½»é‡çº§ã€æ¾è€¦åˆã€åªå…³æ³¨äº‹åŠ¡ç‚¹ï¼‰ä¸å›è°ƒå‡½æ•°ï¼›</li>
<li>å•çº¿ç¨‹ï¼šchild_process å­è¿›ç¨‹ï¼›</li>
<li>è·¨å¹³å°ï¼šlibuvï¼›</li>
</ol>
<h3 id="Node-çš„åº”ç”¨åœºæ™¯"><a href="#Node-çš„åº”ç”¨åœºæ™¯" class="headerlink" title="Node çš„åº”ç”¨åœºæ™¯"></a>Node çš„åº”ç”¨åœºæ™¯</h3><ul>
<li>I/Oå¯†é›†å‹ï¼›</li>
<li>CPUå¯†é›†å‹ï¼Ÿï¼ˆå……åˆ†åˆ©ç”¨CPUçš„æ–¹æ³•ï¼šç¼–å†™ C/C++ æ‰©å±•é«˜æ•ˆåˆ©ç”¨CPUã€ä½¿ç”¨å­è¿›ç¨‹ï¼‰ï¼›</li>
</ul>
<h1 id="å¼‚æ­¥I-O"><a href="#å¼‚æ­¥I-O" class="headerlink" title="å¼‚æ­¥I/O"></a>å¼‚æ­¥I/O</h1><ul>
<li>å•çº¿ç¨‹åŒæ­¥ç¼–ç¨‹æ¨¡å‹ä¼šå› é˜»å¡I/Oå¯¼è‡´ç¡¬ä»¶èµ„æºå¾—ä¸åˆ°æ›´ä¼˜çš„ä½¿ç”¨ã€‚</li>
<li>å¤šçº¿ç¨‹ç¼–ç¨‹æ¨¡å‹ä¹Ÿå› ä¸ºç¼–ç¨‹ä¸­çš„æ­»é”ã€çŠ¶æ€åŒæ­¥ç­‰é—®é¢˜è®©å¼€å‘äººå‘˜å¤´ç–¼ã€‚</li>
<li>Nodeåœ¨ä¸¤è€…ä¹‹é—´ç»™å‡ºäº†å®ƒçš„æ–¹æ¡ˆï¼šåˆ©ç”¨å•çº¿ç¨‹ï¼Œè¿œç¦»å¤šçº¿ç¨‹æ­»é”ã€çŠ¶æ€åŒæ­¥ç­‰é—®é¢˜ï¼›åˆ©ç”¨å¼‚æ­¥I/Oï¼Œè®©å•çº¿ç¨‹è¿œç¦»é˜»å¡ï¼Œä»¥æ›´å¥½åœ°ä½¿ç”¨CPUã€‚</li>
</ul>
<h3 id="è½®è¯¢"><a href="#è½®è¯¢" class="headerlink" title="è½®è¯¢"></a>è½®è¯¢</h3><ul>
<li>è½®è¯¢ï¼šé‡å¤è°ƒç”¨åˆ¤æ–­æ“ä½œæ˜¯å¦å®Œæˆã€‚</li>
<li>è½®è¯¢æŠ€æœ¯ï¼šreadã€selectã€pollã€epollã€kqeueã€‚</li>
<li>è½®è¯¢æŠ€æœ¯æ»¡è¶³äº†éé˜»å¡I/Oç¡®ä¿è·å–å®Œæ•´æ•°æ®çš„éœ€æ±‚ã€‚</li>
</ul>
<h3 id="Node-çš„å¼‚æ­¥I-O"><a href="#Node-çš„å¼‚æ­¥I-O" class="headerlink" title="Node çš„å¼‚æ­¥I/O"></a>Node çš„å¼‚æ­¥I/O</h3><p><img src="http://upload-images.jianshu.io/upload_images/2648731-740979549b11cb59.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image"></p>
<p>Nodeå¼‚æ­¥I/Oæ¨¡å‹çš„åŸºæœ¬è¦ç´ ï¼šäº‹ä»¶å¾ªç¯ã€è§‚å¯Ÿè€…ã€è¯·æ±‚å¯¹è±¡ã€I/Oçº¿ç¨‹æ± ã€‚</p>
<p>å¼‚æ­¥å®ç°çš„æ ¸å¿ƒæ˜¯<strong>äº‹ä»¶å¾ªç¯</strong>ã€‚</p>
<p>äº‹ä»¶é©±åŠ¨çš„æœ¬è´¨ï¼šé€šè¿‡ä¸»å¾ªç¯åŠ äº‹ä»¶è§¦å‘çš„æ–¹å¼æ¥è¿è¡Œç¨‹åºã€‚</p>
<blockquote>
<p>ğŸ’¡ğŸ’¡ğŸ’¡</p>
<ul>
<li><p>åœ¨Nodeä¸­ï¼Œé™¤äº† JavaScript æ˜¯å•çº¿ç¨‹å¤–ï¼ŒNodeè‡ªèº«å…¶å®æ˜¯å¤šçº¿ç¨‹çš„ï¼Œåªæ˜¯I/Oçº¿ç¨‹ä½¿ç”¨çš„CPUè¾ƒå°‘ã€‚</p>
</li>
<li><p>é™¤äº†ç”¨æˆ·ä»£ç æ— æ³•å¹¶è¡Œæ‰§è¡Œå¤–ï¼Œæ‰€æœ‰çš„I/Oï¼ˆç£ç›˜I/Oå’Œç½‘ç»œI/Oç­‰ï¼‰åˆ™å¯ä»¥æ˜¯å¹¶è¡Œèµ·æ¥çš„ã€‚</p>
</li>
</ul>
</blockquote>
<h3 id="éI-Oçš„å¼‚æ­¥API"><a href="#éI-Oçš„å¼‚æ­¥API" class="headerlink" title="éI/Oçš„å¼‚æ­¥API"></a>éI/Oçš„å¼‚æ­¥API</h3><ul>
<li><code>setTimeout()</code>ï¼Œå•æ¬¡æ‰§è¡Œå®šæ—¶ä»»åŠ¡ã€‚</li>
<li><code>setInterval()</code>ï¼Œé‡å¤æ‰§è¡Œå®šæ—¶ä»»åŠ¡ã€‚</li>
<li><code>setImmediate()</code>ï¼Œå°†å›è°ƒå‡½æ•°å»¶è¿Ÿæ‰§è¡Œã€‚</li>
<li><code>process.nextTick()</code>ï¼Œå°†å›è°ƒå‡½æ•°å»¶è¿Ÿæ‰§è¡Œã€‚</li>
</ul>
<h1 id="å¼‚æ­¥ç¼–ç¨‹"><a href="#å¼‚æ­¥ç¼–ç¨‹" class="headerlink" title="å¼‚æ­¥ç¼–ç¨‹"></a>å¼‚æ­¥ç¼–ç¨‹</h1><blockquote>
<p>å¼‚æ­¥ç¼–ç¨‹åœ¨æµç¨‹æ§åˆ¶ä¸­ï¼Œä¸šåŠ¡è¡¨è¾¾å¹¶ä¸å¤ªé€‚åˆè‡ªç„¶è¯­è¨€çš„çº¿å½¢æ€ç»´ä¹ æƒ¯ã€‚</p>
</blockquote>
<h3 id="é«˜é˜¶å‡½æ•°"><a href="#é«˜é˜¶å‡½æ•°" class="headerlink" title="é«˜é˜¶å‡½æ•°"></a>é«˜é˜¶å‡½æ•°</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// é€šå¸¸çš„è¯­è¨€</span></span><br><span class="line"><span class="comment">// å‡½æ•°çš„å‚æ•°ï¼šåŸºæœ¬æ•°æ®ç±»å‹ã€å¯¹è±¡å¼•ç”¨</span></span><br><span class="line"><span class="comment">// å‡½æ•°çš„è¿”å›å€¼ï¼šåŸºæœ¬æ•°æ®ç±»å‹ã€å¯¹è±¡å¼•ç”¨</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">functionName</span>(<span class="params">params</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> params;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// é«˜é˜¶å‡½æ•°ï¼šå¯ä»¥æŠŠå‡½æ•°ä½œä¸ºå‚æ•°æˆ–è¿”å›å€¼</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">functionName</span>(<span class="params">params</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// è¿”å›ä¸€ä¸ªå‡½æ•°</span></span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> params;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// åç»­ä¼ é€’é£æ ¼</span></span><br><span class="line"><span class="comment">// å°†ä¸šåŠ¡çš„é‡ç‚¹ä»è¿”å›å€¼è½¬ç§»åˆ°äº†å›è°ƒå‡½æ•°ä¸­</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">functionName</span>(<span class="params">x, bar</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> bar(x);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="åå‡½æ•°ç”¨æ³•"><a href="#åå‡½æ•°ç”¨æ³•" class="headerlink" title="åå‡½æ•°ç”¨æ³•"></a>åå‡½æ•°ç”¨æ³•</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ç±»å‹åˆ¤æ–­</span></span><br><span class="line"><span class="keyword">var</span> toString = <span class="built_in">Object</span>.prototype.toString;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> isString = <span class="function"><span class="keyword">function</span> (<span class="params">obj</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> toString.call(obj) == <span class="string">'[object String]'</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> isFunction = <span class="function"><span class="keyword">function</span> (<span class="params">obj</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> toString.call(obj) == <span class="string">'[object Function]'</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// åå‡½æ•°ç”¨æ³•</span></span><br><span class="line"><span class="comment">// åˆ›å»ºä¸€ä¸ªè°ƒç”¨å¦å¤–ä¸€ä¸ªéƒ¨åˆ†â€”â€”å‚æ•°æˆ–å˜é‡å·²ç»é¢„ç½®çš„å‡½æ•°â€”â€”çš„å‡½æ•°</span></span><br><span class="line"><span class="keyword">var</span> isType = <span class="function"><span class="keyword">function</span> (<span class="params">type</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params">obj</span>) </span>&#123;</span><br><span class="line">        <span class="comment">// é€šè¿‡æŒ‡å®šéƒ¨åˆ†å‚æ•°æ¥äº§ç”Ÿä¸€ä¸ªæ–°çš„å®šåˆ¶å‡½æ•°</span></span><br><span class="line">        <span class="keyword">return</span> toString.call(obj) == <span class="string">'[object '</span> + type + <span class="string">']'</span>;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> isString = isType(<span class="string">'String'</span>);</span><br><span class="line"><span class="keyword">var</span> isFunction = isType(<span class="string">'Function'</span>);</span><br></pre></td></tr></table></figure>
<h3 id="éš¾ç‚¹1ï¼šå¼‚å¸¸å¤„ç†"><a href="#éš¾ç‚¹1ï¼šå¼‚å¸¸å¤„ç†" class="headerlink" title="éš¾ç‚¹1ï¼šå¼‚å¸¸å¤„ç†"></a>éš¾ç‚¹1ï¼šå¼‚å¸¸å¤„ç†</h3><p>Nodeåœ¨å¤„ç†å¼‚å¸¸æ—¶çš„çº¦å®šï¼š<strong>å°†å¼‚å¸¸ä½œä¸ºå›è°ƒå‡½æ•°çš„ç¬¬ä¸€ä¸ªå®å‚ä¼ å›ï¼Œå¦‚æœä¸ºç©ºå€¼ï¼Œåˆ™è¡¨æ˜å¼‚æ­¥è°ƒç”¨æ²¡æœ‰æŠ›å‡ºå¼‚å¸¸ã€‚</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span>(<span class="function"><span class="keyword">function</span> (<span class="params">err, results</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// TODO</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>ç¼–å†™å¼‚æ­¥æ–¹æ³•éœ€è¦éµå¾ªçš„åŸåˆ™ï¼š</p>
<ol>
<li>å¿…é¡»æ‰§è¡Œè°ƒç”¨è€…ä¼ å…¥çš„å›è°ƒå‡½æ•°ï¼›</li>
<li>æ­£ç¡®ä¼ é€’å›å¼‚å¸¸ä¾›è°ƒç”¨è€…åˆ¤æ–­ï¼›</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> <span class="keyword">async</span> = <span class="function"><span class="keyword">function</span> (<span class="params">callback</span>) </span>&#123;</span><br><span class="line">    process.nextTick(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> results = something;</span><br><span class="line">        <span class="keyword">if</span> (error) &#123;</span><br><span class="line">            <span class="keyword">return</span> callback(error); <span class="comment">// 2. æ­£ç¡®ä¼ é€’å›å¼‚å¸¸ä¾›è°ƒç”¨è€…åˆ¤æ–­</span></span><br><span class="line">        &#125;</span><br><span class="line">        callback(<span class="literal">null</span>, results); <span class="comment">// 1. å¿…é¡»æ‰§è¡Œè°ƒç”¨è€…ä¼ å…¥çš„å›è°ƒå‡½æ•°</span></span><br><span class="line">    &#125;);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h3 id="éš¾ç‚¹2ï¼šå‡½æ•°åµŒå¥—è¿‡æ·±"><a href="#éš¾ç‚¹2ï¼šå‡½æ•°åµŒå¥—è¿‡æ·±" class="headerlink" title="éš¾ç‚¹2ï¼šå‡½æ•°åµŒå¥—è¿‡æ·±"></a>éš¾ç‚¹2ï¼šå‡½æ•°åµŒå¥—è¿‡æ·±</h3><p>å¼‚æ­¥ç¼–ç¨‹ä¸­ï¼Œå‡½æ•°åµŒå¥—è¿‡æ·±çš„é—®é¢˜æ˜¯ï¼šæ²¡æœ‰å……åˆ†åˆ©ç”¨å¼‚æ­¥I/Oå¸¦æ¥çš„å¹¶è¡Œä¼˜åŠ¿ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åœ¨Nodeä¸­ï¼Œäº‹ä»¶ä¸­å­˜åœ¨å¤šä¸ªå¼‚æ­¥è°ƒç”¨çš„åœºæ™¯ï¼Œå°±ä¼šäº§ç”ŸåµŒå¥—</span></span><br><span class="line"><span class="comment">// éå†ä¸€ä¸ªç›®å½•</span></span><br><span class="line">fs.readdir(path.join(__dirname, <span class="string">'..'</span>), <span class="function"><span class="keyword">function</span> (<span class="params">err, files</span>) </span>&#123;</span><br><span class="line">    files.forEach(<span class="function"><span class="keyword">function</span> (<span class="params">filename, index</span>) </span>&#123;</span><br><span class="line">        fs.readFile(filename, <span class="string">'utf8'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">err, file</span>) </span>&#123;</span><br><span class="line">            <span class="comment">// TODO</span></span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h3 id="éš¾ç‚¹3ï¼šé˜»å¡ä»£ç "><a href="#éš¾ç‚¹3ï¼šé˜»å¡ä»£ç " class="headerlink" title="éš¾ç‚¹3ï¼šé˜»å¡ä»£ç "></a>éš¾ç‚¹3ï¼šé˜»å¡ä»£ç </h3><p>é‡åˆ°éœ€è¦é˜»å¡ä»£ç çš„éœ€æ±‚æ—¶ï¼Œåœ¨ç»Ÿä¸€è§„åˆ’ä¸šåŠ¡é€»è¾‘ä¹‹åï¼Œè°ƒç”¨ <code>setTimeout()</code> çš„æ•ˆæœä¼šæ›´å¥½ã€‚</p>
<h3 id="éš¾ç‚¹4ï¼šå¤šçº¿ç¨‹ç¼–ç¨‹"><a href="#éš¾ç‚¹4ï¼šå¤šçº¿ç¨‹ç¼–ç¨‹" class="headerlink" title="éš¾ç‚¹4ï¼šå¤šçº¿ç¨‹ç¼–ç¨‹"></a>éš¾ç‚¹4ï¼šå¤šçº¿ç¨‹ç¼–ç¨‹</h3><p>å¯¹äºæœåŠ¡å™¨æ¥è¯´ï¼Œå¦‚æœæœåŠ¡å™¨æ˜¯å¤šæ ¸CPUï¼Œå•ä¸ªNodeè¿›ç¨‹å®è´¨ä¸Šæ˜¯æ²¡æœ‰å……åˆ†åˆ©ç”¨å¤šæ ¸CPUçš„ã€‚</p>
<p>Nodeçš„å¤šçº¿ç¨‹å®ç°ï¼šchild_process æ˜¯å…¶åŸºç¡€APIï¼Œ<a href="http://nodejs.cn/api/cluster.html" target="_blank" rel="noopener">cluster</a> æ¨¡å—æ˜¯æ›´æ·±å±‚æ¬¡çš„åº”ç”¨ã€‚</p>
<h3 id="éš¾ç‚¹5ï¼šå¼‚æ­¥è½¬åŒæ­¥"><a href="#éš¾ç‚¹5ï¼šå¼‚æ­¥è½¬åŒæ­¥" class="headerlink" title="éš¾ç‚¹5ï¼šå¼‚æ­¥è½¬åŒæ­¥"></a>éš¾ç‚¹5ï¼šå¼‚æ­¥è½¬åŒæ­¥</h3><h2 id="å¼‚æ­¥ç¼–ç¨‹è§£å†³æ–¹æ¡ˆ"><a href="#å¼‚æ­¥ç¼–ç¨‹è§£å†³æ–¹æ¡ˆ" class="headerlink" title="å¼‚æ­¥ç¼–ç¨‹è§£å†³æ–¹æ¡ˆ"></a>å¼‚æ­¥ç¼–ç¨‹è§£å†³æ–¹æ¡ˆ</h2><ul>
<li>äº‹ä»¶å‘å¸ƒ/è®¢é˜…æ¨¡å¼ï¼›</li>
<li>Promise/Deferredæ¨¡å¼ï¼ˆQã€whenï¼‰ï¼›</li>
<li>æµç¨‹æ§åˆ¶æ¨¡å¼ï¼›<ul>
<li>å°¾è§¦å‘ä¸Nextï¼ˆConnetcï¼‰ï¼›</li>
<li><a href="https://github.com/caolan/async" target="_blank" rel="noopener">async</a>ï¼›</li>
<li>Stepï¼›</li>
<li>windï¼›</li>
</ul>
</li>
</ul>
<h3 id="äº‹ä»¶å‘å¸ƒ-è®¢é˜…æ¨¡å¼"><a href="#äº‹ä»¶å‘å¸ƒ-è®¢é˜…æ¨¡å¼" class="headerlink" title="äº‹ä»¶å‘å¸ƒ/è®¢é˜…æ¨¡å¼"></a>äº‹ä»¶å‘å¸ƒ/è®¢é˜…æ¨¡å¼</h3><ul>
<li>äº‹ä»¶ç›‘å¬æ¨¡å¼ï¼ˆevents æ¨¡å—ï¼‰ï¼šå®ç°ä¸€ä¸ªäº‹ä»¶ä¸å¤šä¸ªå›è°ƒå‡½æ•°çš„å…³è”ã€‚</li>
<li>å¹¿æ³›ç”¨äºå¼‚æ­¥ç¼–ç¨‹ã€‚</li>
<li>å¸¸ç”¨äºè§£è€¦ä¸šåŠ¡é€»è¾‘ã€‚</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> EventEmitter = <span class="built_in">require</span>(<span class="string">'events'</span>);</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyEmitter</span> <span class="keyword">extends</span> <span class="title">EventEmitter</span> </span>&#123;&#125;</span><br><span class="line"><span class="keyword">const</span> myEmitter = <span class="keyword">new</span> MyEmitter();</span><br><span class="line"><span class="comment">// on() æ³¨å†Œç›‘å¬å™¨</span></span><br><span class="line">myEmitter.on(<span class="string">'event'</span>, () =&gt; &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'è§¦å‘äº‹ä»¶'</span>);</span><br><span class="line">&#125;);</span><br><span class="line">myEmitter.emit(<span class="string">'event'</span>); <span class="comment">// emit() è§¦å‘äº‹ä»¶</span></span><br></pre></td></tr></table></figure>
<ol>
<li><p>ç»§æ‰¿eventsæ¨¡å—ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Node ä¸­ Stream å¯¹è±¡ç»§æ‰¿ EventEmitter çš„ç¤ºä¾‹ï¼š</span></span><br><span class="line"><span class="keyword">var</span> events = <span class="built_in">require</span>(<span class="string">'events'</span>);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Stream</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    event.EventEmitter.call(<span class="keyword">this</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">Uint8ClampedArray</span>.inherits(Stream, events.EventEmitter);</span><br></pre></td></tr></table></figure>
</li>
<li><p>åˆ©ç”¨äº‹ä»¶é˜Ÿåˆ—è§£å†³é›ªå´©é—®é¢˜ï¼ˆé«˜è®¿é—®é‡ã€å¤§å¹¶å‘çš„æƒ…å†µä¸‹ç¼“å­˜å¤±æ•ˆçš„æƒ…æ™¯ï¼‰:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ·»åŠ çŠ¶æ€é”</span></span><br><span class="line"><span class="keyword">var</span> proxy = <span class="keyword">new</span> events.EventEmitter();</span><br><span class="line"><span class="keyword">var</span> status = <span class="string">'ready'</span>;</span><br><span class="line"><span class="keyword">var</span> select = <span class="function"><span class="keyword">function</span> (<span class="params">callback</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// once()ï¼Œæ‰§è¡Œä¸€æ¬¡å°±ä¼šå°†ç›‘è§†å™¨ç§»é™¤ï¼Œä¿è¯æ¯ä¸€ä¸ªå›è°ƒåªä¼šè¢«æ‰§è¡Œä¸€æ¬¡ã€‚</span></span><br><span class="line">    proxy.once(<span class="string">'selected'</span>, callback);</span><br><span class="line">    <span class="keyword">if</span> (status === <span class="string">'ready'</span>) &#123;</span><br><span class="line">        status = <span class="string">'pending'</span>;</span><br><span class="line">        db.select(<span class="string">'SQL'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">results</span>) </span>&#123;</span><br><span class="line">            proxy.emit(<span class="string">'selected'</span>, results);</span><br><span class="line">            status = <span class="string">'ready'</span>;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
</li>
<li><p>å¤šå¼‚æ­¥ä¹‹é—´çš„åä½œæ–¹æ¡ˆ</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä¸€èˆ¬è€Œè¨€ï¼Œäº‹ä»¶ä¸ä¾¦å¬å™¨çš„å…³ç³»æ˜¯ä¸€å¯¹å¤šï¼Œ</span></span><br><span class="line"><span class="comment">// ä½†åœ¨å¼‚æ­¥ç¼–ç¨‹ä¸­ï¼Œä¹Ÿä¼šå‡ºç°äº‹ä»¶ä¸ä¾¦å¬å™¨çš„å…³ç³»æ˜¯å¤šå¯¹ä¸€çš„æƒ…å†µï¼š</span></span><br><span class="line"><span class="keyword">var</span> after = <span class="function"><span class="keyword">function</span> (<span class="params">times, callback</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> count = <span class="number">0</span>, results = &#123;&#125;;</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params">key, value</span>) </span>&#123;</span><br><span class="line">        results[key] = value;</span><br><span class="line">        count ++;</span><br><span class="line">        <span class="comment">// å“¨å…µå˜é‡ï¼šcount æ˜¯ç”¨äºæ£€æµ‹æ¬¡æ•°çš„å˜é‡</span></span><br><span class="line">        <span class="keyword">if</span> (count === times) &#123;</span><br><span class="line">            callback(results);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> done = after(times, render);</span><br></pre></td></tr></table></figure>
<ul>
<li>ç¬¬ä¸‰æ–¹æ¨¡å—ï¼šEventProxyã€‚</li>
</ul>
</li>
</ol>
<h3 id="Promise-Deferred-æ¨¡å¼"><a href="#Promise-Deferred-æ¨¡å¼" class="headerlink" title="Promise/Deferred æ¨¡å¼"></a>Promise/Deferred æ¨¡å¼</h3><p><strong>å…ˆæ‰§è¡Œå¼‚æ­¥è°ƒç”¨ï¼Œå»¶è¿Ÿä¼ é€’å¤„ç†ã€‚</strong></p>
<h4 id="Promises-A"><a href="#Promises-A" class="headerlink" title="Promises/A"></a>Promises/A</h4><p><img src="http://upload-images.jianshu.io/upload_images/2648731-21eef8596c4dba58.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image"></p>
<ul>
<li>Promise æ“ä½œçš„3ç§çŠ¶æ€ï¼šæœªå®Œæˆæ€ã€å®Œæˆæ€å’Œå¤±è´¥æ€ã€‚</li>
<li>Promise çš„çŠ¶æ€åªä¼šå‡ºç°ä»æœªå®Œæˆæ€å‘å®Œæˆæ€æˆ–å¤±è´¥æ€è½¬åŒ–ï¼Œä¸èƒ½é€†åã€‚å®Œæˆæ€å’Œå¤±è´¥æ€ä¸èƒ½äº’ç›¸è½¬åŒ–ã€‚</li>
<li>Promise çš„çŠ¶æ€ä¸€æ—¦è½¬åŒ–ï¼Œå°†ä¸èƒ½æ›´æ”¹ã€‚</li>
<li><a href="https://github.com/kriskowal/q" target="_blank" rel="noopener">A promise library for javascriptï¼šq</a></li>
</ul>
<p>ç¤ºä¾‹ä»£ç ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> <span class="built_in">Promise</span> = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    EventEmitter.call(<span class="keyword">this</span>);</span><br><span class="line">&#125;;</span><br><span class="line">util.inherits(<span class="built_in">Promise</span>, EventEmitter);</span><br><span class="line"></span><br><span class="line"><span class="comment">// then() æ–¹æ³•å°†å›è°ƒå‡½æ•°å­˜æ”¾èµ·æ¥</span></span><br><span class="line"><span class="built_in">Promise</span>.prototype.then = <span class="function"><span class="keyword">function</span> (<span class="params">fulfilledHander, errorHandler, progressHandler</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> fulfilledHander === <span class="string">'function'</span>) &#123;</span><br><span class="line">        <span class="comment">// åˆ©ç”¨ once() æ–¹æ³•ï¼Œä¿è¯æˆåŠŸå›è°ƒåªæ‰§è¡Œä¸€æ¬¡</span></span><br><span class="line">        <span class="keyword">this</span>.once(<span class="string">'success'</span>, fulfilledHander);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> errorHandler === <span class="string">'function'</span>) &#123;</span><br><span class="line">        <span class="comment">// åˆ©ç”¨ once() æ–¹æ³•ï¼Œä¿è¯å¼‚å¸¸å›è°ƒåªæ‰§è¡Œä¸€æ¬¡</span></span><br><span class="line">        <span class="keyword">this</span>.once(<span class="string">'error'</span>, errorHandler);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> progressHandler === <span class="string">'function'</span>) &#123;</span><br><span class="line">        <span class="keyword">this</span>.once(<span class="string">'progress'</span>, progressHandler);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Deferredï¼Œå»¶è¿Ÿå¯¹è±¡ï¼Œè§¦å‘æ‰§è¡Œå›è°ƒ</span></span><br><span class="line"><span class="keyword">var</span> Deferred = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.state = <span class="string">'unfulfilled'</span>;</span><br><span class="line">    <span class="keyword">this</span>.promise = <span class="keyword">new</span> <span class="built_in">Promise</span>();</span><br><span class="line">&#125;;</span><br><span class="line">Deferred.prototype.resolve = <span class="function"><span class="keyword">function</span> (<span class="params">obj</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.state = <span class="string">'fulfilled'</span>;</span><br><span class="line">    <span class="keyword">this</span>.promise.emit(<span class="string">'success'</span>, obj);</span><br><span class="line">&#125;;</span><br><span class="line">Deferred.prototype.reject = <span class="function"><span class="keyword">function</span> (<span class="params">obj</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.state = <span class="string">'failed'</span>;</span><br><span class="line">    <span class="keyword">this</span>.promise.emit(<span class="string">'error'</span>, obj);</span><br><span class="line">&#125;;</span><br><span class="line">Deferred.prototype.progress = <span class="function"><span class="keyword">function</span> (<span class="params">obj</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.promise.emit(<span class="string">'progress'</span>, obj);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å¯¹ä¸€ä¸ªå…¸å‹çš„å“åº”å¯¹è±¡è¿›è¡Œå°è£…</span></span><br><span class="line">res.setEncoding(<span class="string">'utf8'</span>);</span><br><span class="line">res.on(<span class="string">'data'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">chunk</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'BODY: '</span> + chunk);</span><br><span class="line">&#125;)</span><br><span class="line">res.on(<span class="string">'end'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// Done</span></span><br><span class="line">&#125;)</span><br><span class="line">res.on(<span class="string">'error'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">error</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// Error</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// é€šè¿‡ Promises/Aæè®®çš„æ¨¡å¼å¯ä»¥è½¬æ¢ä¸ºå¦‚ä¸‹çš„ç®€ç•¥å½¢å¼ï¼š</span></span><br><span class="line">res.then(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// Done</span></span><br><span class="line">&#125;, <span class="function"><span class="keyword">function</span> (<span class="params">error</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// Error</span></span><br><span class="line">&#125;, <span class="function"><span class="keyword">function</span> (<span class="params">chunk</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'BODY: '</span> + chunk);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>ä»¥ä¸Šç®€å†™çš„æ”¹é€ æ–¹æ³•ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å°è£…ï¼š</span></span><br><span class="line"><span class="keyword">var</span> promisify = <span class="function"><span class="keyword">function</span> (<span class="params">res</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// *ä¸šåŠ¡ä¸­ä¸å¯å˜çš„éƒ¨åˆ†å°è£…åœ¨ Deferred ä¸­ã€‚</span></span><br><span class="line">    <span class="keyword">var</span> deferred = <span class="keyword">new</span> Deferred();</span><br><span class="line">    <span class="keyword">var</span> result = <span class="string">''</span>;</span><br><span class="line">    res.on(<span class="string">'data'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">chunk</span>) </span>&#123;</span><br><span class="line">        result += chunk;</span><br><span class="line">        deferred.progress(chunk);</span><br><span class="line">    &#125;);</span><br><span class="line">    res.on(<span class="string">'end'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        deferred.resolve(result);</span><br><span class="line">    &#125;);</span><br><span class="line">    res.on(<span class="string">'error'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">error</span>) </span>&#123;</span><br><span class="line">        deferred.reject(error);</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">return</span> deferred.promise; <span class="comment">// è¿”å› deferred.promiseï¼Œä¸è®©å¤–éƒ¨ç¨‹åºç›´æ¥è°ƒç”¨ reslove()ã€reject() æ–¹æ³•ã€‚</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è°ƒç”¨ç¤ºä¾‹ï¼š</span></span><br><span class="line"><span class="comment">// *ä¸šåŠ¡ä¸­å¯å˜çš„éƒ¨åˆ†å°è£…åœ¨ Promise ä¸­ã€‚</span></span><br><span class="line">promisify(res).then(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// Done</span></span><br><span class="line">&#125;, <span class="function"><span class="keyword">function</span> (<span class="params">error</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// Error</span></span><br><span class="line">&#125;, <span class="function"><span class="keyword">function</span> (<span class="params">chunk</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// progress</span></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'BODY: '</span> + chunk);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<ul>
<li>Deferred ä¸»è¦ç”¨äºå†…éƒ¨ï¼Œç”¨äºç»´æŠ¤å¼‚æ­¥æ¨¡å‹çš„çŠ¶æ€ã€‚</li>
<li>Promise ä¸»è¦ä½œç”¨äºå¤–éƒ¨ï¼Œé€šè¿‡ <code>then()</code> æ–¹æ³•æš´éœ²ç»™å¤–éƒ¨ä»¥æ·»åŠ è‡ªå®šä¹‰é€»è¾‘.</li>
</ul>
<p><img src="http://upload-images.jianshu.io/upload_images/2648731-0c695b04135df1f3.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="Promise å’Œ Deferred æ•´ä½“å…³ç³»ç¤ºæ„å›¾"></p>
<h3 id="Promise-ä¸­çš„å¤šå¼‚æ­¥åä½œ"><a href="#Promise-ä¸­çš„å¤šå¼‚æ­¥åä½œ" class="headerlink" title="Promise ä¸­çš„å¤šå¼‚æ­¥åä½œ"></a>Promise ä¸­çš„å¤šå¼‚æ­¥åä½œ</h3><h2 id="æµç¨‹æ§åˆ¶åº“"><a href="#æµç¨‹æ§åˆ¶åº“" class="headerlink" title="æµç¨‹æ§åˆ¶åº“"></a>æµç¨‹æ§åˆ¶åº“</h2><h3 id="å°¾è§¦å‘ä¸Next"><a href="#å°¾è§¦å‘ä¸Next" class="headerlink" title="å°¾è§¦å‘ä¸Next"></a>å°¾è§¦å‘ä¸Next</h3><p>å°¾è§¦å‘ï¼šéœ€è¦æ‰‹å·¥è°ƒç”¨æ‰èƒ½æŒç»­æ‰§è¡Œåç»­è°ƒç”¨çš„æ–¹æ³•ã€‚</p>
<p>å°¾è§¦å‘ç›®å‰åº”ç”¨æœ€å¤šçš„åœ°æ–¹æ˜¯ <a href="https://www.npmjs.com/package/connect" target="_blank" rel="noopener">Connect</a> çš„ä¸­é—´ä»¶ã€‚</p>
<p>åœ¨ <a href="https://www.npmjs.com/package/connect" target="_blank" rel="noopener">Connect</a> ä¸­ï¼Œå°¾è§¦å‘ååˆ†é€‚åˆå¤„ç†ç½‘ç»œè¯·æ±‚çš„åœºæ™¯ã€‚å°†å¤æ‚çš„å¤„ç†é€»è¾‘æ‹†è§£ä¸ºç®€æ´ã€å•ä¸€çš„å¤„ç†å•å…ƒï¼Œé€æ¬¡åœ°å¤„ç†è¯·æ±‚å¯¹è±¡å’Œå“åº”å¯¹è±¡ã€‚</p>
<h3 id="async"><a href="#async" class="headerlink" title="async"></a><a href="https://www.npmjs.com/package/async" target="_blank" rel="noopener">async</a></h3><h5 id="å¼‚æ­¥çš„ä¸²è¡Œæ‰§è¡Œ"><a href="#å¼‚æ­¥çš„ä¸²è¡Œæ‰§è¡Œ" class="headerlink" title="å¼‚æ­¥çš„ä¸²è¡Œæ‰§è¡Œ"></a>å¼‚æ­¥çš„ä¸²è¡Œæ‰§è¡Œ</h5><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å‡½æ•°ä½œç”¨ï¼šè¯»å–2ä¸ªæ–‡ä»¶</span></span><br><span class="line"><span class="comment">// async æä¾›äº† series() æ–¹æ³•æ¥å®ç°ä¸€ç»„ä»»åŠ¡çš„ä¸²è¡Œæ‰§è¡Œ</span></span><br><span class="line"><span class="comment">// æ¯ä¸ªcallback() æ‰§è¡Œæ—¶ä¼šå°†ç»“æœä¿å­˜èµ·æ¥ï¼Œç„¶åæ‰§è¡Œä¸‹ä¸€ä¸ªè°ƒç”¨ï¼Œç›´åˆ°ç»“æŸæ‰€æœ‰è°ƒç”¨ã€‚</span></span><br><span class="line"><span class="keyword">async</span>.series([</span><br><span class="line">    <span class="function"><span class="keyword">function</span> (<span class="params">callback</span>) </span>&#123;</span><br><span class="line">        fs.readFile(<span class="string">'file1.txt'</span>, <span class="string">'utf-8'</span>, callback);</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="function"><span class="keyword">function</span> (<span class="params">callback</span>) </span>&#123;</span><br><span class="line">        fs.readFile(<span class="string">'file2.txt'</span>, <span class="string">'utf-8'</span>, callback);</span><br><span class="line">    &#125;</span><br><span class="line">], <span class="function"><span class="keyword">function</span> (<span class="params">err, results</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// results =&gt; [file1.txt, file2.txt]</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä»¥ä¸Šä»£ç ç­‰ä»·äº</span></span><br><span class="line">fs.readFile(<span class="string">'file1.txt'</span>, <span class="string">'utf-8'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">err, content</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (err) &#123;</span><br><span class="line">        <span class="keyword">return</span> callback(err);</span><br><span class="line">    &#125;</span><br><span class="line">    fs.readFile(<span class="string">'file2.txt'</span>, <span class="string">'utf-8'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">err, data</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (err) &#123;</span><br><span class="line">            <span class="keyword">return</span> callback(err);</span><br><span class="line">        &#125;</span><br><span class="line">        callback(<span class="literal">null</span>, [content, data]);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h5 id="å¼‚æ­¥çš„å¹¶è¡Œæ‰§è¡Œ"><a href="#å¼‚æ­¥çš„å¹¶è¡Œæ‰§è¡Œ" class="headerlink" title="å¼‚æ­¥çš„å¹¶è¡Œæ‰§è¡Œ"></a>å¼‚æ­¥çš„å¹¶è¡Œæ‰§è¡Œ</h5><p><code>parallel()</code> æ–¹æ³•å¯¹äºå¼‚å¸¸çš„åˆ¤æ–­ä¾ç„¶æ˜¯ä¸€æ—¦æŸä¸ªå¼‚æ­¥è°ƒç”¨äº§ç”Ÿäº†å¼‚å¸¸ï¼Œå°±ä¼šå°†å¼‚å¸¸ä½œä¸ºç¬¬ä¸€ä¸ªå‚æ•°ä¼ å…¥ç»™æœ€ç»ˆçš„å›è°ƒå‡½æ•°ã€‚åªæœ‰æ‰€æœ‰å¼‚æ­¥è°ƒç”¨éƒ½æ­£å¸¸å®Œæˆæ—¶ï¼Œæ‰ä¼šå°†ç»“æœä»¥æ•°ç»„çš„æ–¹å¼ä¼ å…¥ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// parallel() æ–¹æ³•ï¼Œå¹¶è¡Œæ‰§è¡Œå¼‚æ­¥æ“ä½œ</span></span><br><span class="line"><span class="comment">// è¯»å–ä¸¤ä¸ªæ–‡ä»¶çš„å¹¶è¡Œç‰ˆæœ¬</span></span><br><span class="line"><span class="keyword">async</span>.parallel([</span><br><span class="line">    <span class="function"><span class="keyword">function</span>(<span class="params">callback</span>) </span>&#123;</span><br><span class="line">        fs.readFile(<span class="string">'file1.txt'</span>, <span class="string">'utf-8'</span>, callback);</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="function"><span class="keyword">function</span>(<span class="params">callback</span>) </span>&#123;</span><br><span class="line">        fs.readFile(<span class="string">'file2.txt'</span>, <span class="string">'utf-8'</span>, callback);</span><br><span class="line">    &#125;</span><br><span class="line">], <span class="function"><span class="keyword">function</span> (<span class="params">err, results</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// results =&gt; [file1.txt, file2.txt]</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä»¥ä¸Šä»£ç ç­‰ä»·äºä¸‹é¢çš„ä»£ç </span></span><br><span class="line"><span class="keyword">var</span> counter = <span class="number">2</span>;</span><br><span class="line"><span class="keyword">var</span> results = [];</span><br><span class="line"><span class="keyword">var</span> done = <span class="function"><span class="keyword">function</span> (<span class="params">index, value</span>) </span>&#123;</span><br><span class="line">    results[index] = value;</span><br><span class="line">    counter--;</span><br><span class="line">    <span class="keyword">if</span> (counter === <span class="number">0</span>) &#123;</span><br><span class="line">        callback(<span class="literal">null</span>, results);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// åªä¼ é€’ç¬¬ä¸€ä¸ªå¼‚å¸¸</span></span><br><span class="line"><span class="keyword">var</span> hasErr = <span class="literal">false</span>;</span><br><span class="line"><span class="keyword">var</span> fail = <span class="function"><span class="keyword">function</span> (<span class="params">err</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!hasErr) &#123;</span><br><span class="line">        hasErr = <span class="literal">true</span>;</span><br><span class="line">        callback(err);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">fs.readFile(<span class="string">'file1.txt'</span>, <span class="string">'utf-8'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">err, content</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (err) &#123;</span><br><span class="line">        <span class="keyword">return</span> fail(err);</span><br><span class="line">    &#125;</span><br><span class="line">    done(<span class="number">0</span>, content);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">fs.readFile(<span class="string">'file2.txt'</span>, <span class="string">'utf-8'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">err, data</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (err) &#123;</span><br><span class="line">        <span class="keyword">return</span> fail(err);</span><br><span class="line">    &#125;</span><br><span class="line">    done(<span class="number">1</span>, data);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h5 id="å¼‚æ­¥è°ƒç”¨çš„ä¾èµ–å¤„ç†"><a href="#å¼‚æ­¥è°ƒç”¨çš„ä¾èµ–å¤„ç†" class="headerlink" title="å¼‚æ­¥è°ƒç”¨çš„ä¾èµ–å¤„ç†"></a>å¼‚æ­¥è°ƒç”¨çš„ä¾èµ–å¤„ç†</h5><p><code>series()</code> é€‚åˆ<strong>æ— ä¾èµ–çš„å¼‚æ­¥ä¸²è¡Œæ‰§è¡Œ</strong>ï¼Œä½†å½“å‰ä¸€ä¸ªç»“æœæ˜¯åä¸€ä¸ªè°ƒç”¨çš„è¾“å…¥æ—¶ï¼Œ<code>series()</code> æ–¹æ³•å°±æ— æ³•æ»¡è¶³éœ€æ±‚äº†ã€‚async æä¾›äº† <code>waterfall()</code>  æ–¹æ³•æ¥æ»¡è¶³ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span>.waterfall([</span><br><span class="line">    <span class="function"><span class="keyword">function</span> (<span class="params">callback</span>) </span>&#123;</span><br><span class="line">        fs.readFile(<span class="string">'file1.txt'</span>, <span class="string">'utf-8'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">err, content</span>) </span>&#123;</span><br><span class="line">            callback(err, content);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="function"><span class="keyword">function</span> (<span class="params">arg1, callback</span>) </span>&#123;</span><br><span class="line">        <span class="comment">// arg1 =&gt; file2.txt</span></span><br><span class="line">        fs.readFile(arg1, <span class="string">'utf-8'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">err, content</span>) </span>&#123;</span><br><span class="line">            callback(err, content);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="function"><span class="keyword">function</span> (<span class="params">arg1, callback</span>) </span>&#123;</span><br><span class="line">        <span class="comment">// arg1 =&gt; file3.txt</span></span><br><span class="line">        fs.readFile(arg1, <span class="string">'utf-8'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">err, content</span>) </span>&#123;</span><br><span class="line">            callback(err, content);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">], <span class="function"><span class="keyword">function</span> (<span class="params">err, result</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// result =&gt; file4.txt</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä»¥ä¸Šä»£ç ç­‰ä»·äº</span></span><br><span class="line">fs.readFile(<span class="string">'file1.txt'</span>, <span class="string">'utf-8'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">err, data1</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (err) &#123;</span><br><span class="line">        <span class="keyword">return</span> callback(err);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// data1ä½œä¸ºä¸‹ä¸ªå‡½æ•°çš„å…¥å‚</span></span><br><span class="line">    fs.readFile(data1, <span class="string">'utf-8'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">err, data2</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (err) &#123;</span><br><span class="line">            <span class="keyword">return</span> callback(err);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// data2 ä½œä¸ºä¸‹ä¸ªå‡½æ•°çš„å…¥å‚</span></span><br><span class="line">        fs.readFile(data2, <span class="string">'utf-8'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">err, data3</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">if</span> (err) &#123;</span><br><span class="line">                <span class="keyword">return</span> callback(err);</span><br><span class="line">            &#125;</span><br><span class="line">            callback(<span class="literal">null</span>, data3);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h5 id="è‡ªåŠ¨ä¾èµ–å¤„ç†"><a href="#è‡ªåŠ¨ä¾èµ–å¤„ç†" class="headerlink" title="è‡ªåŠ¨ä¾èµ–å¤„ç†"></a>è‡ªåŠ¨ä¾èµ–å¤„ç†</h5><p><code>auto()</code> å®ç°å¤æ‚çš„ä¸šåŠ¡å¤„ç†ï¼Œå®ƒå¯ä»¥æ ¹æ®ä¾èµ–å…³ç³»è‡ªåŠ¨åˆ†æï¼Œä»¥æœ€ä½³çš„é¡ºåºæ‰§è¡Œä¸šåŠ¡æµã€‚</p>
<h2 id="å¼‚æ­¥å¹¶å‘æ§åˆ¶"><a href="#å¼‚æ­¥å¹¶å‘æ§åˆ¶" class="headerlink" title="å¼‚æ­¥å¹¶å‘æ§åˆ¶"></a>å¼‚æ­¥å¹¶å‘æ§åˆ¶</h2><ul>
<li><a href="https://github.com/JacksonTian/bagpipe" target="_blank" rel="noopener">bagpipe</a> çš„è§£å†³æ–¹æ¡ˆï¼›</li>
<li>async çš„è§£å†³æ–¹æ¡ˆï¼š<code>parallelLimit()</code> æ–¹æ³•ï¼›</li>
<li><a href="https://github.com/JeffreyZhao/wind" target="_blank" rel="noopener">wind</a></li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å¢åŠ é™åˆ¶å¹¶å‘æ•°é‡çš„å‚æ•°ï¼Œä½¿å¾—ä»»åŠ¡åªèƒ½åŒæ—¶å¹¶å‘ä¸€å®šæ•°é‡ï¼Œè€Œä¸æ˜¯æ— é™åˆ¶å¹¶å‘ã€‚</span></span><br><span class="line"><span class="keyword">async</span>.parallelLimit([</span><br><span class="line">    <span class="function"><span class="keyword">function</span> (<span class="params">callback</span>) </span>&#123;</span><br><span class="line">        fs.readFile(<span class="string">'file1.txt'</span>, <span class="string">'utf-8'</span>, callback);</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="function"><span class="keyword">function</span> (<span class="params">callback</span>) </span>&#123;</span><br><span class="line">        fs.readFile(<span class="string">'file2.txt'</span>, <span class="string">'utf-8'</span>, callback);</span><br><span class="line">    &#125;</span><br><span class="line">], <span class="number">1</span>, <span class="function"><span class="keyword">function</span> (<span class="params">err, results</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// TODO</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// queue() æ–¹æ³•ï¼Œè§£å†³ parallelLiment() æ— æ³•åŠ¨æ€åœ°å¢åŠ å¹¶è¡Œä»»åŠ¡ã€‚</span></span><br><span class="line"><span class="keyword">var</span> q = <span class="keyword">async</span>.queue(<span class="function"><span class="keyword">function</span> (<span class="params">file, callback</span>) </span>&#123;</span><br><span class="line">    fs.readFile(file, <span class="string">'utf-8'</span>, callback);</span><br><span class="line">&#125;, <span class="number">2</span>);</span><br><span class="line">q.drain = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// å®Œæˆäº†é˜Ÿåˆ—ä¸­çš„æ‰€æœ‰ä»»åŠ¡</span></span><br><span class="line">&#125;;</span><br><span class="line">fs.readdirSync(<span class="string">'.'</span>).forEach(<span class="function"><span class="keyword">function</span> (<span class="params">file</span>) </span>&#123;</span><br><span class="line">    q.push(file, <span class="function"><span class="keyword">function</span> (<span class="params">err, data</span>) </span>&#123;</span><br><span class="line">        <span class="comment">// TODO</span></span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://andy0570.com/2018/10/23/OpenSSL-æ— æ³•ä½¿ç”¨-RSA-éå¯¹ç§°åŠ å¯†ç®—æ³•åŠ å¯†å¤§æ–‡ä»¶/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ç‹¬æœ¨èˆŸçš„æœ¨">
      <meta itemprop="description" content="æœ‰æ—¶å€™é˜³å…‰å¾ˆå¥½ æœ‰æ—¶å€™é˜³å…‰å¾ˆæš—">
      <meta itemprop="image" content="https://ws1.sinaimg.cn/large/006tNc79gy1g22m14458rj30u014xu0x.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ç‹¬æœ¨èˆŸçš„æœ¨">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2018/10/23/OpenSSL-æ— æ³•ä½¿ç”¨-RSA-éå¯¹ç§°åŠ å¯†ç®—æ³•åŠ å¯†å¤§æ–‡ä»¶/" class="post-title-link" itemprop="url">OpenSSL-æ— æ³•ä½¿ç”¨-RSA-éå¯¹ç§°åŠ å¯†ç®—æ³•åŠ å¯†å¤§æ–‡ä»¶</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              

              
                
              

              <time title="åˆ›å»ºæ—¶é—´ï¼š2018-10-23 21:05:00" itemprop="dateCreated datePublished" datetime="2018-10-23T21:05:00+08:00">2018-10-23</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">æ›´æ–°äº</span>
                
                <time title="ä¿®æ”¹æ—¶é—´ï¼š2019-04-15 17:37:13" itemprop="dateModified" datetime="2019-04-15T17:37:13+08:00">2019-04-15</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/PKI-å¯†ç å­¦/" itemprop="url" rel="index"><span itemprop="name">PKI&å¯†ç å­¦</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          
            <span id="/2018/10/23/OpenSSL-æ— æ³•ä½¿ç”¨-RSA-éå¯¹ç§°åŠ å¯†ç®—æ³•åŠ å¯†å¤§æ–‡ä»¶/" class="leancloud_visitors" data-flag-title="OpenSSL-æ— æ³•ä½¿ç”¨-RSA-éå¯¹ç§°åŠ å¯†ç®—æ³•åŠ å¯†å¤§æ–‡ä»¶">
              <span class="post-meta-divider">|</span>
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              
                <span class="post-meta-item-text">é˜…è¯»æ¬¡æ•°ï¼š</span>
              
                <span class="leancloud-visitors-count"></span>
            </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body han-init-context" itemprop="articleBody">

      
      

      
        
          
            <h3 id="Shell-ç¤ºä¾‹ä»£ç "><a href="#Shell-ç¤ºä¾‹ä»£ç " class="headerlink" title="Shell ç¤ºä¾‹ä»£ç "></a>Shell ç¤ºä¾‹ä»£ç </h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> ä½¿ç”¨ genrsa å‘½ä»¤ç”Ÿæˆ RSA-2048 ä½çš„å¯†é’¥ï¼ˆrsa_private.keyï¼‰</span></span><br><span class="line">openssl genrsa -out rsa_private.key 2048</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> è§£æç§é’¥ç»“æ„ï¼ŒæŸ¥çœ‹å¯†é’¥å†…å®¹</span></span><br><span class="line">openssl rsa -text -in rsa_private.key</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> ç”Ÿæˆå¯†é’¥çš„å…¬é’¥ï¼ˆrsa_private.keyï¼‰</span></span><br><span class="line">openssl rsa -in rsa_private.key -pubout -out rsa_public.key</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> ä½¿ç”¨ç”Ÿæˆçš„å…¬é’¥åŠ å¯†æ–‡ä»¶</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> -pubin è¡¨æ˜ç”¨çº¯å…¬é’¥æ–‡ä»¶åŠ å¯†</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> -inkey æŒ‡å®šå¯†é’¥ï¼ˆrsa_private.keyï¼‰</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> -<span class="keyword">in</span> æŒ‡å®šè¦åŠ å¯†çš„æ–‡ä»¶ï¼ˆtest.pdfï¼Œ3.2Mï¼‰</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> -out åŠ å¯†åçš„æ–‡ä»¶ï¼ˆencrypted.enï¼‰</span></span><br><span class="line">openssl rsautl -encrypt -pubin -inkey rsa_public.key  -in test.pdf -out encrypted.en</span><br><span class="line">RSA operation error</span><br><span class="line">4475450988:error:04FFF06E:rsa routines:CRYPTO_internal:data too large for key size:/BuildRoot/Library/Caches/com.apple.xbs/Sources/libressl/libressl-22.200.4/libressl-2.6/crypto/rsa/rsa_pk1.c:151:</span><br></pre></td></tr></table></figure>
<ul>
<li><a href="https://stackoverflow.com/questions/7143514/how-to-encrypt-a-large-file-in-openssl-using-public-key" target="_blank" rel="noopener">How to encrypt a large file in openssl using public key</a></li>
</ul>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://andy0570.com/2018/10/23/OpenLDAP/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ç‹¬æœ¨èˆŸçš„æœ¨">
      <meta itemprop="description" content="æœ‰æ—¶å€™é˜³å…‰å¾ˆå¥½ æœ‰æ—¶å€™é˜³å…‰å¾ˆæš—">
      <meta itemprop="image" content="https://ws1.sinaimg.cn/large/006tNc79gy1g22m14458rj30u014xu0x.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ç‹¬æœ¨èˆŸçš„æœ¨">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2018/10/23/OpenLDAP/" class="post-title-link" itemprop="url">OpenLDAP</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              

              
                
              

              <time title="åˆ›å»ºæ—¶é—´ï¼š2018-10-23 21:05:00" itemprop="dateCreated datePublished" datetime="2018-10-23T21:05:00+08:00">2018-10-23</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">æ›´æ–°äº</span>
                
                <time title="ä¿®æ”¹æ—¶é—´ï¼š2019-04-15 17:57:59" itemprop="dateModified" datetime="2019-04-15T17:57:59+08:00">2019-04-15</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/PKI-å¯†ç å­¦/" itemprop="url" rel="index"><span itemprop="name">PKI&å¯†ç å­¦</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          
            <span id="/2018/10/23/OpenLDAP/" class="leancloud_visitors" data-flag-title="OpenLDAP">
              <span class="post-meta-divider">|</span>
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              
                <span class="post-meta-item-text">é˜…è¯»æ¬¡æ•°ï¼š</span>
              
                <span class="leancloud-visitors-count"></span>
            </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body han-init-context" itemprop="articleBody">

      
      

      
        
          
            <h1 id="OpenLDAP"><a href="#OpenLDAP" class="headerlink" title="OpenLDAP"></a>OpenLDAP</h1><ul>
<li><a href="https://wiki.archlinux.org/index.php/OpenLDAP_(%E7%AE%80%E4%BD%93%E4%B8%AD%E6%96%87" target="_blank" rel="noopener">openLDAPï¼ˆç®€ä½“ä¸­æ–‡ï¼‰</a>)</li>
</ul>
<h1 id="Docker-OpenLDAP"><a href="#Docker-OpenLDAP" class="headerlink" title="Docker-OpenLDAP"></a>Docker-OpenLDAP</h1><ul>
<li><a href="https://github.com/osixia/docker-openldap" target="_blank" rel="noopener">GitHub: osixia/docker-openldap</a></li>
<li><a href="https://github.com/osixia/docker-phpLDAPadmin" target="_blank" rel="noopener">GitHub:osixia/docker-phpLDAPadmin</a></li>
</ul>
<h1 id="OpenLDAP-1"><a href="#OpenLDAP-1" class="headerlink" title="OpenLDAP"></a>OpenLDAP</h1><ul>
<li><a href="https://www.howtoing.com/how-to-install-and-configure-openldap-and-phpldapadmin-on-ubuntu-16-04" target="_blank" rel="noopener">å¦‚ä½•åœ¨ Ubuntu 16.04 ä¸Šå®‰è£…å’Œé…ç½® OpenLDAP å’Œ phpLDAPadmins</a></li>
<li><a href="https://www.howtoing.com/how-to-install-and-configure-a-basic-ldap-server-on-an-ubuntu-12-04-vps/#add-organizational-units-groups-and-users" target="_blank" rel="noopener">å¦‚ä½•åœ¨ Ubuntu 12.04 VPS ä¸Šå®‰è£…å’Œé…ç½®åŸºæœ¬ LDAP æœåŠ¡å™¨</a>â€”â€” åœ¨ phpLDAPadmin ä¸Šæ·»åŠ ç»„ç»‡å•ä½ï¼Œç»„å’Œç”¨æˆ·</li>
<li><a href="https://www.howtoing.com/how-to-secure-apache-with-let-s-encrypt-on-ubuntu-16-04/" target="_blank" rel="noopener">å¦‚ä½•åœ¨ Ubuntu 16.04 ä½¿ç”¨å®‰å…¨åŠ å¯†çš„ Apache</a></li>
<li><a href="https://mp.weixin.qq.com/s/k7Gda7CWmI38dF4ZJ-BPVA" target="_blank" rel="noopener">OpenLDAP ç®¡ç†å·¥å…· Phpldapadmin çš„å®‰è£…åŠä½¿ç”¨</a></li>
<li><a href="https://mp.weixin.qq.com/s/pnSmdhy74_HJN6LC7-BPkQ" target="_blank" rel="noopener">ä¸€é”®æ·»åŠ  OpenLDAP ç”¨æˆ·åŠ Kerberos è´¦å·</a></li>
<li><a href="https://www.jb51.net/article/115258.htm" target="_blank" rel="noopener">ubuntu ä¸´æ—¶æˆ–æ°¸ä¹…ä¿®æ”¹ hostname çš„æ–¹æ³•</a></li>
<li><a href="http://blog.51cto.com/jiangche00/1925454" target="_blank" rel="noopener">51cto: Ubuntu ç³»ç»Ÿä¸‹ OpenLDAP çš„å®‰è£…åŠé…ç½®</a></li>
<li><a href="https://www.cnblogs.com/kungfupanda/p/4704421.html" target="_blank" rel="noopener">ubuntu 12.04 ä¸‹å®‰è£… openldapï¼Œslapd.conf æ‰¾ä¸åˆ°çš„è§£å†³æ–¹æ³•</a></li>
<li><a href="https://segmentfault.com/a/1190000014683418" target="_blank" rel="noopener">æˆ‘èŠ±äº†ä¸€ä¸ªäº”ä¸€ç»ˆäºææ‡‚äº† OpenLDAP</a></li>
</ul>
<p>è½»é‡çº§ç›®å½•è®¿é—®åè®®ï¼ˆLightweight Directory Access Protocolï¼ŒLDAPï¼‰æ˜¯ç”¨äºé€šè¿‡ç½‘ç»œç®¡ç†å’Œè®¿é—®åˆ†å±‚ç›®å½•ä¿¡æ¯çš„æ ‡å‡†åè®®ã€‚ å®ƒå¯ä»¥ç”¨äºå­˜å‚¨ä»»ä½•ç±»å‹çš„ä¿¡æ¯ï¼Œå°½ç®¡å®ƒé€šå¸¸ç”¨ä½œé›†ä¸­å¼èº«ä»½éªŒè¯ç³»ç»Ÿæˆ–å…¬å¸ç”µå­é‚®ä»¶å’Œç”µè¯ç›®å½•ã€‚</p>
<p>OpenLDAP æ˜¯ LDAP åè®®çš„ä¸€ä¸ªå¼€æºå®ç°ã€‚LDAP æœåŠ¡å™¨æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªä¸ºåªè¯»è®¿é—®è€Œä¼˜åŒ–çš„éå…³ç³»å‹æ•°æ®åº“ã€‚å®ƒä¸»è¦ç”¨ä½œåœ°å€ç°¿æŸ¥è¯¢ï¼ˆå¦‚ email å®¢æˆ·ç«¯ï¼‰æˆ–å¯¹å„ç§æœåŠ¡è®¿é—®åšåå°è®¤è¯ä»¥åŠç”¨æˆ·æ•°æ®æƒé™ç®¡æ§ã€‚ï¼ˆä¾‹å¦‚ï¼Œè®¿é—® Samba æ—¶ï¼ŒLDAP å¯ä»¥èµ·åˆ°åŸŸæ§åˆ¶å™¨çš„ä½œç”¨ï¼›æˆ–è€… <a href="https://wiki.archlinux.org/index.php/LDAP_authentication" target="_blank" rel="noopener">Linux ç³»ç»Ÿè®¤è¯</a> æ—¶ä»£æ›¿ <code>/etc/passwd</code> çš„ä½œç”¨ã€‚ï¼‰</p>
<blockquote>
<p>âš ï¸ <strong>æ³¨æ„:</strong></p>
<p>ä»¥ <code>slap</code> å¼€å¤´çš„å‘½ä»¤ï¼ˆå¦‚ï¼š <code>slapcat</code> <code>slapcat</code>ï¼‰æ˜¯<strong>æœåŠ¡ç«¯</strong>å·¥å…·ã€‚</p>
<p>ä»¥ <code>ldap</code> å¼€å¤´çš„å‘½ä»¤ï¼ˆå¦‚ï¼š <code>ldapsearch</code>ï¼‰æ˜¯<strong>å®¢æˆ·ç«¯</strong>å·¥å…·;</p>
</blockquote>
<h3 id="ç¬¬ä¸€æ­¥ï¼šå®‰è£…å’Œé…ç½®-OpenLDAP-æœåŠ¡å™¨"><a href="#ç¬¬ä¸€æ­¥ï¼šå®‰è£…å’Œé…ç½®-OpenLDAP-æœåŠ¡å™¨" class="headerlink" title="ç¬¬ä¸€æ­¥ï¼šå®‰è£…å’Œé…ç½® OpenLDAP æœåŠ¡å™¨"></a>ç¬¬ä¸€æ­¥ï¼šå®‰è£…å’Œé…ç½® OpenLDAP æœåŠ¡å™¨</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> å®‰è£… OpenLDAP:</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> slapd:OpenLDAP æœåŠ¡ç«¯ç¨‹åºç»„ä»¶ã€‚</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> ldap-utils:OpenLDAP å‘½ä»¤è¡Œå·¥å…·é›†ã€‚</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> sudo apt-get update</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> sudo apt-get install -y slapd ldap-utils</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> é‡æ–°é…ç½®</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> sudo dpkg-reconfigure slapd</span></span><br><span class="line">Domain Name:arling.com</span><br><span class="line">Organization Name:tonintech</span><br><span class="line">Password:paradise</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> æ‰“å¼€é˜²ç«å¢™LDAPç«¯å£ï¼ˆ389ã€636ï¼‰</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> sudo ufw allow ldap</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> LDAPè¿›ç¨‹ slapd ç”Ÿå‘½å‘¨æœŸç®¡ç†</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> sudo service slapd start   <span class="comment"># å¼€å¯</span></span></span><br><span class="line"><span class="meta">$</span><span class="bash"> sudo serviec slapd stop    <span class="comment"># å…³é—­</span></span></span><br><span class="line"><span class="meta">$</span><span class="bash"> sudo service slapd restart <span class="comment"># é‡å¯</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> è·å– OpenLDAP é»˜è®¤ç›‘å¬çš„ç«¯å£</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> doc</span></span><br><span class="line">tcp        0      0 0.0.0.0:389             0.0.0.0:*               LISTEN      25135/slapd</span><br><span class="line">tcp6       0      0 :::389                  :::*                    LISTEN      25135/slapd</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> è·å– OpenLDAP è¿›ç¨‹çš„çŠ¶æ€</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> ps aux | grep slapd | grep -v grep</span></span><br><span class="line">openldap 25135  0.0  0.0 1249408 7068 ?        Ssl  03:06   0:00 /usr/sbin/slapd -h ldap:/// ldapi:/// -g openldap -u openldap -F /etc/ldap/slapd.d</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> æµ‹è¯•ä¸ ldapwhoami çš„ LDAP è¿æ¥</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> ldapwhoami -H ldap://18.217.226.78 -x</span></span><br><span class="line">anonymous</span><br></pre></td></tr></table></figure>
<h4 id="LDAP-é…ç½®æ–‡ä»¶"><a href="#LDAP-é…ç½®æ–‡ä»¶" class="headerlink" title="LDAP é…ç½®æ–‡ä»¶"></a>LDAP é…ç½®æ–‡ä»¶</h4><ul>
<li>é€šè¿‡ apt-get å‘½åå®‰è£… OpenLDAP åï¼Œé…ç½®æ–‡ä»¶è·¯å¾„ä¸ºï¼š<code>/etc/ldap</code></li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">/etc/ldap$ ls -l</span><br><span class="line">total 16</span><br><span class="line">-rw-r--r-- 1 root     root      332 May 24 21:06 ldap.conf # å®¢æˆ·ç«¯é…ç½®æ–‡ä»¶</span><br><span class="line">drwxr-xr-x 2 root     root     4096 May 24 21:06 sasl2</span><br><span class="line">drwxr-xr-x 2 root     root     4096 Sep 14 09:32 schema</span><br><span class="line">drwxr-xr-x 3 openldap openldap 4096 Sep 17 08:27 slapd.d # æœåŠ¡ç«¯é…ç½®æ–‡ä»¶</span><br></pre></td></tr></table></figure>
<blockquote>
<p>âš ï¸</p>
<ul>
<li>ä» OpenLDAP 2.4 ç‰ˆæœ¬å¼€å§‹æ‰€æœ‰é…ç½®æ•°æ®éƒ½ä¿å­˜åœ¨ <code>/etc/openldap/slapd.d/</code>ä¸­ï¼Œå»ºè®®ä¸å†ä½¿ç”¨ <code>slapd.conf</code> ä½œä¸ºé…ç½®æ–‡ä»¶ã€‚</li>
<li>é…ç½® OpenLDAP æœ€æ­£ç¡®çš„å§¿åŠ¿æ˜¯é€šè¿‡<code>ldapmodify</code>å‘½ä»¤æ‰§è¡Œ<strong>ä¸€ç³»åˆ—è‡ªå·±å†™å¥½çš„</strong> ldif æ–‡ä»¶ï¼Œè€Œ<strong>ä¸è¦ä¿®æ”¹ä»»ä½• OpenLDAP è£…å¥½çš„é…ç½®æ–‡ä»¶</strong>ã€‚</li>
</ul>
</blockquote>
<h3 id="ç¬¬äºŒæ­¥ï¼šå®‰è£…å’Œé…ç½®-phpLDAPadmin-Web-é¡µé¢"><a href="#ç¬¬äºŒæ­¥ï¼šå®‰è£…å’Œé…ç½®-phpLDAPadmin-Web-é¡µé¢" class="headerlink" title="ç¬¬äºŒæ­¥ï¼šå®‰è£…å’Œé…ç½® phpLDAPadmin Web é¡µé¢"></a>ç¬¬äºŒæ­¥ï¼šå®‰è£…å’Œé…ç½® phpLDAPadmin Web é¡µé¢</h3><p>å®‰è£… phpLDAPadminï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> sudo apt-get install phpldapadmin</span></span><br></pre></td></tr></table></figure>
<p>ä¿®æ”¹ phpLDAPadmin é…ç½®æ–‡ä»¶ <code>/etc/phpldapadmin/config.php</code>ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> sudo vim /etc/phpldapadmin/config.php</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> ------ é…ç½®å†…å®¹å¦‚ä¸‹ ------</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 1.LDAP æœåŠ¡å™¨åç§°</span></span><br><span class="line"><span class="meta">$</span><span class="bash">servers-&gt;setValue(<span class="string">'server'</span>,<span class="string">'name'</span>,<span class="string">'My LDAP Server'</span>); </span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 2.phpLDAPadmin LDAP å±‚æ¬¡ç»“æ„çš„æ ¹ç›®å½•</span></span><br><span class="line"><span class="meta">$</span><span class="bash">servers-&gt;setValue(<span class="string">'server'</span>,<span class="string">'base'</span>,array(<span class="string">'dc=arling,dc=com'</span>)); </span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 3.æ³¨é‡Šæ‰ç™»å½•bind_idé…ç½®è¡Œ</span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="variable">$servers</span>-&gt;setValue(<span class="string">'login'</span>,<span class="string">'bind_id'</span>,<span class="string">'cn=admin,dc=example,dc=com'</span>);</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> å‘½ä»¤è¡Œæ¨¡å¼ä¸‹æœç´¢ï¼š/hide_template_warning</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 4.éšè— phpLDAPadmin è­¦å‘Šæ¶ˆæ¯</span></span><br><span class="line"><span class="meta">$</span><span class="bash">config-&gt;custom-&gt;appearance[<span class="string">'hide_template_warning'</span>] = <span class="literal">true</span>;</span></span><br></pre></td></tr></table></figure>
<p>å…³é—­ Apache2 æœåŠ¡</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> sudo /etc/init.d/apache2 stop</span></span><br></pre></td></tr></table></figure>
<h3 id="ç¬¬ä¸‰æ­¥ï¼šç™»å½•åˆ°-phpLDAPadmin-Web-é¡µé¢ï¼š"><a href="#ç¬¬ä¸‰æ­¥ï¼šç™»å½•åˆ°-phpLDAPadmin-Web-é¡µé¢ï¼š" class="headerlink" title="ç¬¬ä¸‰æ­¥ï¼šç™»å½•åˆ° phpLDAPadmin Web é¡µé¢ï¼š"></a>ç¬¬ä¸‰æ­¥ï¼šç™»å½•åˆ° phpLDAPadmin Web é¡µé¢ï¼š</h3><p>ç™»å½•åˆ° phpLDAPadmin ç•Œé¢ï¼Œæ·»åŠ ç”¨æˆ·ï¼Œç»„ç»‡å•ä½ï¼Œç»„å’Œå…³ç³»ã€‚å‚è€ƒï¼š<a href="https://www.howtoing.com/how-to-install-and-configure-a-basic-ldap-server-on-an-ubuntu-12-04-vps/#add-organizational-units-groups-and-users" target="_blank" rel="noopener">æ·»åŠ ç»„ç»‡å•ä½ï¼Œç»„å’Œç”¨æˆ·</a></p>
<ul>
<li><a href="http://18.217.226.78/phpldapadmin/index.php" target="_blank" rel="noopener">http://18.217.226.78/phpldapadmin/index.php</a></li>
<li>Login DN:cn=admin,dc=arling,dc=com</li>
<li>Password:paradise</li>
</ul>
<p>â€‹    <img src="https://ws4.sinaimg.cn/large/006tNbRwly1fvdttyt7itj30hs0ms78u.jpg" alt></p>
<p>â€‹    1. æ·»åŠ ç»„ç»‡ï¼šGeneric: Organisational Unit</p>
<p>â€‹    2. æ·»åŠ ç»„ï¼šGeneric: Posix Group</p>
<p>â€‹    3. æ·»åŠ ç”¨æˆ·ï¼šGeneric: User Account</p>
<h3 id="ç¬¬å››æ­¥ï¼šé…ç½®-StartTLS-LDAP-åŠ å¯†"><a href="#ç¬¬å››æ­¥ï¼šé…ç½®-StartTLS-LDAP-åŠ å¯†" class="headerlink" title="ç¬¬å››æ­¥ï¼šé…ç½® StartTLS LDAP åŠ å¯†"></a>ç¬¬å››æ­¥ï¼šé…ç½® StartTLS LDAP åŠ å¯†</h3>
          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://andy0570.com/2018/10/13/Node.js æ¡†æ¶/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ç‹¬æœ¨èˆŸçš„æœ¨">
      <meta itemprop="description" content="æœ‰æ—¶å€™é˜³å…‰å¾ˆå¥½ æœ‰æ—¶å€™é˜³å…‰å¾ˆæš—">
      <meta itemprop="image" content="https://ws1.sinaimg.cn/large/006tNc79gy1g22m14458rj30u014xu0x.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ç‹¬æœ¨èˆŸçš„æœ¨">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2018/10/13/Node.js æ¡†æ¶/" class="post-title-link" itemprop="url">Node.js æ¡†æ¶</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              

              
                
              

              <time title="åˆ›å»ºæ—¶é—´ï¼š2018-10-13 00:41:00" itemprop="dateCreated datePublished" datetime="2018-10-13T00:41:00+08:00">2018-10-13</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">æ›´æ–°äº</span>
                
                <time title="ä¿®æ”¹æ—¶é—´ï¼š2019-04-17 02:13:59" itemprop="dateModified" datetime="2019-04-17T02:13:59+08:00">2019-04-17</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Node-js/" itemprop="url" rel="index"><span itemprop="name">Node.js</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          
            <span id="/2018/10/13/Node.js æ¡†æ¶/" class="leancloud_visitors" data-flag-title="Node.js æ¡†æ¶">
              <span class="post-meta-divider">|</span>
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              
                <span class="post-meta-item-text">é˜…è¯»æ¬¡æ•°ï¼š</span>
              
                <span class="leancloud-visitors-count"></span>
            </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body han-init-context" itemprop="articleBody">

      
      

      
        
          
            <h2 id="nodeframework-ä¸Šçš„æ¡†æ¶åˆ†ç±»"><a href="#nodeframework-ä¸Šçš„æ¡†æ¶åˆ†ç±»" class="headerlink" title="nodeframework ä¸Šçš„æ¡†æ¶åˆ†ç±»"></a><a href="http://nodeframework.com/" target="_blank" rel="noopener">nodeframework</a> ä¸Šçš„æ¡†æ¶åˆ†ç±»</h2><p><img src="http://upload-images.jianshu.io/upload_images/2648731-8ccc4b3dde2e47b9.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="Node.js æ¡†æ¶"></p>
<h3 id="æ¡†æ¶çš„å®šä¹‰"><a href="#æ¡†æ¶çš„å®šä¹‰" class="headerlink" title="æ¡†æ¶çš„å®šä¹‰"></a>æ¡†æ¶çš„å®šä¹‰</h3><ul>
<li><strong>API æ¡†æ¶</strong>â€”â€”ç”¨äºæ­å»º Web API çš„åº“ï¼Œæœ‰ååŠ©ç»„ç»‡ç¨‹åºç»“æ„çš„æ¡†æ¶æ”¯æŒã€‚LoopBackå°†è‡ªå·±å®šä¹‰ä¸ºè¿™ç±»æ¡†æ¶ã€‚</li>
<li><strong>HTTP æœåŠ¡å™¨åº“</strong>â€”â€”æ‰€æœ‰åŸºäº Express çš„é¡¹ç›®éƒ½å¯ä»¥å½’ä¸ºè¿™ä¸€ç±»ï¼ŒåŒ…æ‹¬ Koa å’Œ Kraken.js ã€‚è¿™äº›åº“å¸®æˆ‘ä»¬å›´ç»• HTTP åŠ¨è¯å’Œè·¯ç”±æ­å»ºç¨‹åºã€‚</li>
<li><strong>HTTPæœåŠ¡å™¨æ¡†æ¶</strong>â€”â€”ç”¨æ¥æ­å»ºæ¨¡å—åŒ– HTTP æœåŠ¡å™¨çš„æ¡†æ¶ã€‚hapi å°±æ˜¯è¿™ç§æ¡†æ¶ã€‚</li>
<li><strong>Web MVC æ¡†æ¶</strong>â€”â€”æ¨¡å‹-è§†å›¾-æ§åˆ¶å™¨æ¡†æ¶ï¼ŒSail.js å°±æ˜¯è¿™ç§æ¡†æ¶ã€‚</li>
<li><strong>å…¨æ ˆæ¡†æ¶</strong>â€”â€”è¿™äº›æ¡†æ¶åœ¨æœåŠ¡å™¨ç«¯å’Œæµè§ˆå™¨ä¸Šç”¨çš„éƒ½æ˜¯  JavaScriptï¼Œå¹¶ä¸”ä¸¤ç«¯å¯ä»¥å…±äº«ä»£ç ã€‚è¿™è¢«ç§°ä¸º<strong>åŒæ„ä»£ç </strong>ã€‚ DerbyJS æ˜¯ä¸ªå…¨æ ˆ MVC æ¡†æ¶ã€‚</li>
</ul>
<h3 id="Koa"><a href="#Koa" class="headerlink" title="Koa"></a>Koa</h3><table>
<thead>
<tr>
<th>åº“ç±»åˆ«</th>
<th>HTTP æœåŠ¡å™¨åº“</th>
</tr>
</thead>
<tbody>
<tr>
<td>åŠŸèƒ½ç‰¹æ€§</td>
<td>åŸºäºç”Ÿæˆå™¨çš„ä¸­é—´ä»¶ï¼Œè¯·æ±‚/å“åº”æ¨¡å‹</td>
</tr>
<tr>
<td>å»ºè®®åº”ç”¨</td>
<td>è½»å‹ Web ç¨‹åºã€ä¸ä¸¥æ ¼çš„ HTTP APIã€å•é¡µ Web ç¨‹åº</td>
</tr>
<tr>
<td>æ’ä»¶æ¶æ„</td>
<td>ä¸­é—´ä»¶</td>
</tr>
<tr>
<td>æ–‡æ¡£</td>
<td><a href="https://koa.bootcss.com/" target="_blank" rel="noopener">https://koa.bootcss.com/</a></td>
</tr>
<tr>
<td>çƒ­é—¨ç¨‹åº¦</td>
<td><a href="https://github.com/koajs/koa" target="_blank" rel="noopener">GitHub</a> 24198 â­ï¸</td>
</tr>
<tr>
<td>æˆæƒè®¸å¯</td>
<td>MIT</td>
</tr>
</tbody>
</table>
<blockquote>
<p>Koa è½»ä¾¿ã€æç®€ï¼Œåœ¨ä¸­é—´ä»¶ä¸­ä½¿ç”¨ ES2015 ç”Ÿæˆå™¨è¯­æ³•ã€‚é€‚åˆä¾èµ–å¤–éƒ¨ Web API çš„å•é¡µ Web ç¨‹åºã€‚</p>
</blockquote>
<h3 id="Kraken"><a href="#Kraken" class="headerlink" title="Kraken"></a>Kraken</h3><table>
<thead>
<tr>
<th>åº“ç±»åˆ«</th>
<th>HTTP æœåŠ¡å™¨åº“</th>
</tr>
</thead>
<tbody>
<tr>
<td>åŠŸèƒ½ç‰¹æ€§</td>
<td>å¯¹é¡¹ç›®ç»“æ„è¦æ±‚ä¸¥æ ¼ã€æ¨¡å‹ã€æ¨¡ç‰ˆï¼ˆDustï¼‰ã€å®‰å…¨å¼ºåŒ–ï¼ˆLuscaï¼‰ã€é…ç½®ç®¡ç†ã€å›½é™…åŒ–</td>
</tr>
<tr>
<td>å»ºè®®åº”ç”¨</td>
<td>ä¼ä¸š Web ç¨‹åº</td>
</tr>
<tr>
<td>æ’ä»¶æ¶æ„</td>
<td>Express ä¸­é—´ä»¶</td>
</tr>
<tr>
<td>æ–‡æ¡£</td>
<td><a href="https://www.kraken.com/help/api" target="_blank" rel="noopener">https://www.kraken.com/help/api</a></td>
</tr>
<tr>
<td>çƒ­é—¨ç¨‹åº¦</td>
<td><a href="https://github.com/krakenjs/kraken-js" target="_blank" rel="noopener">GitHub</a> 4698 â­ï¸</td>
</tr>
<tr>
<td>æˆæƒè®¸å¯</td>
<td>Apache 2.0</td>
</tr>
</tbody>
</table>
<blockquote>
<p> Kraken æ˜¯åŸºäº Express çš„ï¼Œæ·»åŠ äº†å®‰å…¨ç‰¹æ€§ã€‚å¯ä»¥ç”¨äº MVCã€‚</p>
</blockquote>
<h3 id="hapi"><a href="#hapi" class="headerlink" title="hapi"></a>hapi</h3><table>
<thead>
<tr>
<th>åº“ç±»åˆ«</th>
<th>HTTP æœåŠ¡å™¨åº“</th>
</tr>
</thead>
<tbody>
<tr>
<td>åŠŸèƒ½ç‰¹æ€§</td>
<td>é«˜å±‚æœåŠ¡å™¨å®¹å™¨æŠ½è±¡ï¼Œå®‰å…¨çš„å¤´éƒ¨ä¿¡æ¯</td>
</tr>
<tr>
<td>å»ºè®®åº”ç”¨</td>
<td>å•é¡µ Web ç¨‹åºã€HTTP API</td>
</tr>
<tr>
<td>æ’ä»¶æ¶æ„</td>
<td>hapi æ’ä»¶</td>
</tr>
<tr>
<td>æ–‡æ¡£</td>
<td><a href="https://hapijs.com/" target="_blank" rel="noopener">https://hapijs.com/</a></td>
</tr>
<tr>
<td>çƒ­é—¨ç¨‹åº¦</td>
<td><a href="https://github.com/hapijs/hapi" target="_blank" rel="noopener">GitHub</a> 10000 â­ï¸</td>
</tr>
<tr>
<td>æˆæƒè®¸å¯</td>
<td>BSD 3</td>
</tr>
</tbody>
</table>
<blockquote>
<p>hapi çš„é‡ç‚¹æ˜¯ HTTP æœåŠ¡å™¨å’Œè·¯ç”±ã€‚é€‚åˆç”±å¾ˆå¤šå°æœåŠ¡å™¨ç»„æˆçš„è½»ä¾¿åå°ã€‚</p>
</blockquote>
<h3 id="Sails-js"><a href="#Sails-js" class="headerlink" title="Sails.js"></a>Sails.js</h3><table>
<thead>
<tr>
<th>åº“ç±»åˆ«</th>
<th>MVC æ¡†æ¶</th>
</tr>
</thead>
<tbody>
<tr>
<td>åŠŸèƒ½ç‰¹æ€§</td>
<td>æœ‰æ”¯æŒæ•°æ®åº“çš„ ORMï¼Œç”Ÿæˆ REST APIï¼ŒWebSocket</td>
</tr>
<tr>
<td>å»ºè®®åº”ç”¨</td>
<td>Rails é£æ ¼çš„ MVC ç¨‹åº</td>
</tr>
<tr>
<td>æ’ä»¶æ¶æ„</td>
<td>Express ä¸­é—´ä»¶</td>
</tr>
<tr>
<td>æ–‡æ¡£</td>
<td><a href="http://sailsjs.org/" target="_blank" rel="noopener">http://sailsjs.org/</a></td>
</tr>
<tr>
<td>çƒ­é—¨ç¨‹åº¦</td>
<td><a href="https://github.com/balderdashy/sails/" target="_blank" rel="noopener">GitHub</a> 19976 â­ï¸</td>
</tr>
<tr>
<td>æˆæƒè®¸å¯</td>
<td>BSD 3</td>
</tr>
</tbody>
</table>
<blockquote>
<p> Sails.js æ˜¯ Rails/Django é£æ ¼çš„ MVC æ¡†æ¶ã€‚æœ‰ ORM å’Œæ¨¡æ¿ç³»ç»Ÿã€‚</p>
</blockquote>
<h3 id="DerbyJS"><a href="#DerbyJS" class="headerlink" title="DerbyJS"></a>DerbyJS</h3><table>
<thead>
<tr>
<th>åº“ç±»åˆ«</th>
<th>å…¨æ ˆæ¡†æ¶</th>
</tr>
</thead>
<tbody>
<tr>
<td>åŠŸèƒ½ç‰¹æ€§</td>
<td>æœ‰æ”¯æŒæ•°æ®åº“çš„ ORMï¼ˆRacerï¼‰ï¼ŒåŒæ„</td>
</tr>
<tr>
<td>å»ºè®®åº”ç”¨</td>
<td>æœ‰æœåŠ¡å™¨ç«¯æ”¯æŒçš„å•é¡µ Web ç¨‹åº</td>
</tr>
<tr>
<td>æ’ä»¶æ¶æ„</td>
<td>DerbyJS æ’ä»¶</td>
</tr>
<tr>
<td>æ–‡æ¡£</td>
<td><a href="https://derbyjs.com/" target="_blank" rel="noopener">https://derbyjs.com/</a></td>
</tr>
<tr>
<td>çƒ­é—¨ç¨‹åº¦</td>
<td><a href="https://github.com/derbyjs/derby/" target="_blank" rel="noopener">GitHub</a> 4358 â­ï¸</td>
</tr>
<tr>
<td>æˆæƒè®¸å¯</td>
<td>MIT</td>
</tr>
</tbody>
</table>
<blockquote>
<p> DerbyJS æ˜¯ä¸ªåŒæ„æ¡†æ¶ï¼Œé€‚åˆå®æ—¶ç¨‹åºã€‚</p>
</blockquote>
<h3 id="Flatiron-js"><a href="#Flatiron-js" class="headerlink" title="Flatiron.js"></a>Flatiron.js</h3><table>
<thead>
<tr>
<th>åº“ç±»åˆ«</th>
<th>æ¨¡å—åŒ– MVC æ¡†æ¶</th>
</tr>
</thead>
<tbody>
<tr>
<td>åŠŸèƒ½ç‰¹æ€§</td>
<td>æ•°æ®åº“ç®¡ç†å±‚ï¼ˆResourcefulï¼‰ï¼Œè§£è€¦çš„å¯é‡ç”¨æ¨¡å—</td>
</tr>
<tr>
<td>å»ºè®®åº”ç”¨</td>
<td>è½»é‡çš„ MVC ç¨‹åºï¼Œåœ¨å…¶ä»–æ¡†æ¶ä¸­ä½¿ç”¨ Flatiron æ¨¡å—</td>
</tr>
<tr>
<td>æ’ä»¶æ¶æ„</td>
<td>Broadway æ’ä»¶ API</td>
</tr>
<tr>
<td>æ–‡æ¡£</td>
<td><a href="https://github.com/flatiron/flatiron" target="_blank" rel="noopener">https://github.com/flatiron/flatiron</a></td>
</tr>
<tr>
<td>çƒ­é—¨ç¨‹åº¦</td>
<td><a href="https://github.com/flatiron/flatiron" target="_blank" rel="noopener">GitHub</a> 1338 â­ï¸</td>
</tr>
<tr>
<td>æˆæƒè®¸å¯</td>
<td>MIT</td>
</tr>
</tbody>
</table>
<blockquote>
<p>Flatiron æ˜¯ä¸€ç»„è§£è€¦çš„æ¨¡å—ï¼Œæ—¢å¯ä»¥å½“ä½œ Web MVC æ¡†æ¶æ¥ç”¨ï¼Œä¹Ÿå¯ä»¥å½“ä½œæ›´è½»ä¾¿çš„ Expressåº“ã€‚ Flatiron è·Ÿ Connect ä¸­é—´ä»¶æ˜¯å…¼å®¹çš„ã€‚</p>
</blockquote>
<h3 id="LoopBack"><a href="#LoopBack" class="headerlink" title="LoopBack"></a>LoopBack</h3><table>
<thead>
<tr>
<th>åº“ç±»åˆ«</th>
<th>API æ¡†æ¶</th>
</tr>
</thead>
<tbody>
<tr>
<td>åŠŸèƒ½ç‰¹æ€§</td>
<td>ORMã€API ç”¨æˆ·ç•Œé¢ã€WebScoketã€å®¢æˆ·ç«¯ SDKï¼ˆåŒ…æ‹¬ iOSï¼‰</td>
</tr>
<tr>
<td>å»ºè®®åº”ç”¨</td>
<td>æ”¯æŒå¤šå®¢æˆ·ç«¯çš„ APIï¼ˆç§»åŠ¨ç«¯ã€æ¡Œé¢ç«¯ã€Webï¼‰</td>
</tr>
<tr>
<td>æ’ä»¶æ¶æ„</td>
<td>Express ä¸­é—´ä»¶</td>
</tr>
<tr>
<td>æ–‡æ¡£</td>
<td><a href="https://loopback.io/" target="_blank" rel="noopener">https://loopback.io/</a></td>
</tr>
<tr>
<td>çƒ­é—¨ç¨‹åº¦</td>
<td><a href="https://github.com/strongloop/loopback" target="_blank" rel="noopener">GitHub</a> 12092 â­ï¸</td>
</tr>
<tr>
<td>æˆæƒè®¸å¯</td>
<td>åŒè®¸å¯ï¼šMIT å’Œ StrongLoop è®¤è´­åè®®</td>
</tr>
</tbody>
</table>
<blockquote>
<p> LoopBack å¸®æˆ‘ä»¬çœæ‰äº†å†™å¥—è·¯åŒ–ä»£ç çš„å·¥ä½œã€‚å®ƒå¯ä»¥å¿«é€Ÿç”Ÿæˆå¸¦æœ‰æ•°æ®åº“æ”¯æŒçš„ REST APIï¼Œå¹¶æœ‰ä¸ª API ç®¡ç†ç•Œé¢ã€‚</p>
</blockquote>
<h3 id="å¦‚ä½•é€‰æ‹©-Node-æ¡†æ¶"><a href="#å¦‚ä½•é€‰æ‹©-Node-æ¡†æ¶" class="headerlink" title="å¦‚ä½•é€‰æ‹© Node æ¡†æ¶"></a>å¦‚ä½•é€‰æ‹© Node æ¡†æ¶</h3><p><img src="https://upload-images.jianshu.io/upload_images/2648731-0a2c2e7344bde422.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é€‰æ‹© Node æ¡†æ¶"></p>
<h3 id="æå‡åº”ç”¨å®‰å…¨æ€§çš„-Node-æ¨¡å—"><a href="#æå‡åº”ç”¨å®‰å…¨æ€§çš„-Node-æ¨¡å—" class="headerlink" title="æå‡åº”ç”¨å®‰å…¨æ€§çš„ Node æ¨¡å—"></a>æå‡åº”ç”¨å®‰å…¨æ€§çš„ Node æ¨¡å—</h3><ul>
<li>Luscaï¼š<a href="http://krakenjs.com" target="_blank" rel="noopener">krakenjs</a> ä¸­çš„ä¸€ä¸ªå®‰å…¨æ¨¡å—ã€‚</li>
<li><a href="https://helmetjs.github.io/" target="_blank" rel="noopener">Helmet</a>ï¼šé€šè¿‡è®¾ç½®å„ç§ HTTP å¤´æ¥å¸®åŠ©æ‚¨ä¿æŠ¤ Express åº”ç”¨ç¨‹åºã€‚</li>
<li>nsp æ¨¡å—ï¼šå®¡è®¡ Node åº”ç”¨çš„ <code>package.json</code> å’Œ <code>npm- shrinkwrap.json</code>æ–‡ä»¶ï¼Œæ£€æŸ¥æœ‰æ²¡æœ‰å·²çŸ¥æ¼æ´ã€‚</li>
</ul>
<h3 id="æ–‡ç« èµ„æº"><a href="#æ–‡ç« èµ„æº" class="headerlink" title="æ–‡ç« èµ„æº"></a>æ–‡ç« èµ„æº</h3><ul>
<li><a href="https://i5ting.github.io/How-to-learn-node-correctly/" target="_blank" rel="noopener">ã€çŸ¥ä¹ Liveã€‘ç‹¼å”ï¼šå¦‚ä½•æ­£ç¡®çš„å­¦ä¹  Node.js</a></li>
<li><a href="http://okj45byt5.bkt.clouddn.com/%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BANode.js.pdf" target="_blank" rel="noopener">PDFï¼šæ·±å…¥æµ…å‡º Node.js</a></li>
<li><a href="https://github.com/atian25/blog/issues/19" target="_blank" rel="noopener">å¦‚ä½•æŒ‘é€‰é«˜è´¨é‡çš„ Node.js æ¨¡å—</a></li>
<li><a href="https://www.jianshu.com/p/fbf4a7c94e61" target="_blank" rel="noopener">node.js</a> - åŸºç¡€ç§‘æ™®æ€§æ–‡ç« ï¼Œå€¼å¾—è§‚çœ‹â­ï¸â­ï¸â­ï¸</li>
<li><a href="https://github.com/aisuhua/restful-api-design-references" target="_blank" rel="noopener">RESTful API å®Œæ•´ä»‹ç»</a></li>
<li><a href="https://github.com/ElemeFE/node-interview/blob/master/sections/zh-cn/process.md" target="_blank" rel="noopener">GitHub: process</a> - node.js è¿›ç¨‹çš„ä¸€ç¯‡æ–‡ç« </li>
</ul>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://andy0570.com/2018/10/12/Node.js æ•°æ®åº“å¼€å‘/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ç‹¬æœ¨èˆŸçš„æœ¨">
      <meta itemprop="description" content="æœ‰æ—¶å€™é˜³å…‰å¾ˆå¥½ æœ‰æ—¶å€™é˜³å…‰å¾ˆæš—">
      <meta itemprop="image" content="https://ws1.sinaimg.cn/large/006tNc79gy1g22m14458rj30u014xu0x.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ç‹¬æœ¨èˆŸçš„æœ¨">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2018/10/12/Node.js æ•°æ®åº“å¼€å‘/" class="post-title-link" itemprop="url">Node.js æ•°æ®åº“å¼€å‘</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              

              
                
              

              <time title="åˆ›å»ºæ—¶é—´ï¼š2018-10-12 15:42:00" itemprop="dateCreated datePublished" datetime="2018-10-12T15:42:00+08:00">2018-10-12</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">æ›´æ–°äº</span>
                
                <time title="ä¿®æ”¹æ—¶é—´ï¼š2019-04-17 02:14:37" itemprop="dateModified" datetime="2019-04-17T02:14:37+08:00">2019-04-17</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Node-js/" itemprop="url" rel="index"><span itemprop="name">Node.js</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          
            <span id="/2018/10/12/Node.js æ•°æ®åº“å¼€å‘/" class="leancloud_visitors" data-flag-title="Node.js æ•°æ®åº“å¼€å‘">
              <span class="post-meta-divider">|</span>
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              
                <span class="post-meta-item-text">é˜…è¯»æ¬¡æ•°ï¼š</span>
              
                <span class="leancloud-visitors-count"></span>
            </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body han-init-context" itemprop="articleBody">

      
      

      
        
          
            <h2 id="MongoDB-æ•°æ®åº“"><a href="#MongoDB-æ•°æ®åº“" class="headerlink" title="MongoDB æ•°æ®åº“"></a>MongoDB æ•°æ®åº“</h2><p><img src="http://upload-images.jianshu.io/upload_images/2648731-3629ccc16d58c8a4.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="MongoDB æ•°æ®åº“ç»“æ„"></p>
<ul>
<li>mongoose ä¸­çš„ä¸€åˆ‡ç”± <strong>schema</strong> å¼€å§‹ã€‚ <strong>schema</strong> æ˜¯ä¸€ç§ä»¥æ–‡ä»¶å½¢å¼å­˜å‚¨çš„æ•°æ®åº“æ¨¡å‹éª¨æ¶ï¼Œå¹¶ä¸å…·å¤‡æ•°æ®åº“çš„æ“ä½œèƒ½åŠ›ã€‚ </li>
<li><strong>Schema</strong> å®šä¹‰äº† <strong>model</strong> ä¸­çš„æ‰€æœ‰å±æ€§ï¼Œè€Œ <strong>model</strong> åˆ™æ˜¯å¯¹åº”ä¸€ä¸ª MongoDB ä¸­çš„ <strong>collection</strong>ã€‚</li>
<li><strong>Schema</strong> ç”Ÿæˆ <strong>Model</strong>ï¼Œ<strong>Model</strong> åˆ›é€  <strong>Entity</strong>ï¼Œ<strong>Model</strong> å’Œ <strong>Entity</strong> éƒ½å¯å¯¹æ•°æ®åº“æ“ä½œé€ æˆå½±å“ï¼Œä½† <strong>Model</strong> æ¯” <strong>Entity</strong> æ›´å…·æ“ä½œæ€§ã€‚</li>
</ul>
<h2 id="ä½¿ç”¨-mongoose-è¿æ¥-MongoDB"><a href="#ä½¿ç”¨-mongoose-è¿æ¥-MongoDB" class="headerlink" title="ä½¿ç”¨ mongoose è¿æ¥ MongoDB"></a>ä½¿ç”¨ <a href="https://github.com/Automattic/mongoose" target="_blank" rel="noopener">mongoose</a> è¿æ¥ MongoDB</h2><p>è¿æ¥æ•°æ®åº“ï¼Œå®ç°å¢ã€åˆ ã€æ”¹ã€æŸ¥æ“ä½œï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">'use strict'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¼•å…¥ mongoose æ¨¡å—</span></span><br><span class="line"><span class="keyword">const</span> mongoose = <span class="built_in">require</span>(<span class="string">'mongoose'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// å®šä¹‰æ•°æ®åº“åœ°å€</span></span><br><span class="line"><span class="comment">// uriï¼šmongodb://user:pass@localhost:port/database</span></span><br><span class="line"><span class="keyword">const</span> uri = <span class="string">'mongodb://user:pass@localhost:port/database?authSource=admin'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è¿æ¥ mongoDB æ•°æ®åº“</span></span><br><span class="line">mongoose.connect(uri, &#123;<span class="attr">useNewUrlParser</span>: <span class="literal">true</span>&#125;);</span><br><span class="line"><span class="keyword">const</span> db = mongoose.connection;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å°†è¿æ¥ç»‘å®šåˆ°é”™è¯¯äº‹ä»¶</span></span><br><span class="line">db.on(<span class="string">'error'</span>, <span class="built_in">console</span>.error.bind(<span class="built_in">console</span>, <span class="string">'MongoDB connection error'</span>));</span><br><span class="line"></span><br><span class="line">db.once(<span class="string">'open'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'ä¸€æ¬¡æ‰“å¼€è®°å½•'</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// å®šä¹‰ Schema</span></span><br><span class="line"><span class="keyword">const</span> Schema = mongoose.Schema;</span><br><span class="line"><span class="comment">// ä½¿ç”¨ Schema æ„é€ å‡½æ•°ï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„ Schema å®ä¾‹</span></span><br><span class="line"><span class="comment">// å®ä¾‹åŒ– mongoose.Schema å¯¹è±¡å¹¶å®šä¹‰ Model çš„å±æ€§</span></span><br><span class="line"><span class="keyword">const</span> ArticleScheme = <span class="keyword">new</span> Schema(&#123;</span><br><span class="line">    title: <span class="built_in">String</span>,</span><br><span class="line">    author: <span class="built_in">String</span>,</span><br><span class="line">    content: <span class="built_in">String</span>,</span><br><span class="line">    publishTime: <span class="built_in">Date</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// å°† Schema æ³¨å†Œæˆ Model</span></span><br><span class="line">mongoose.model(<span class="string">'Article'</span>, ArticleScheme);</span><br><span class="line"><span class="comment">// å¦‚æœ ModelæˆåŠŸæ³¨å†Œï¼Œå°±å¯ä»¥é€šè¿‡å¦‚ä¸‹æ–¹å¼è®¿é—®æ¨¡å‹</span></span><br><span class="line"><span class="keyword">const</span> ArticleModel = mongoose.model(<span class="string">'Article'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// é€šè¿‡ Model å®šä¹‰ Entity</span></span><br><span class="line"><span class="keyword">var</span> ArticleEntity = <span class="keyword">new</span> ArticleModel(&#123;</span><br><span class="line">    title: <span class="string">'node.js'</span>,</span><br><span class="line">    author: <span class="string">'node'</span>,</span><br><span class="line">    content: <span class="string">'node.js is great!'</span>,</span><br><span class="line">    publishTime: <span class="keyword">new</span> <span class="built_in">Date</span>()</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// ã€å°†æ–‡æ¡£æ’å…¥åˆ°é›†åˆä¸­ã€‘</span></span><br><span class="line">ArticleEntity.save(<span class="function"><span class="keyword">function</span>(<span class="params">err</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (err) &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'save failed '</span> + err);</span><br><span class="line">    &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'save successed'</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// ã€æŸ¥è¯¢ã€‘</span></span><br><span class="line"><span class="comment">// find() æ–¹æ³•ï¼ŒæŸ¥è¯¢æ‰€æœ‰ç¬¦åˆè¦æ±‚çš„æ•°æ®</span></span><br><span class="line"><span class="comment">// findOne() æ–¹æ³•ï¼ŒæŸ¥è¯¢ç¬¦å·è¦æ±‚çš„ç¬¬ä¸€æ¡æ•°æ®</span></span><br><span class="line">ArticleModel.find(&#123;<span class="attr">title</span>:<span class="string">'node.js'</span>&#125;, <span class="function"><span class="keyword">function</span>(<span class="params">err, docs</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (err) &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'error'</span>);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'result: '</span> + docs); <span class="comment">// æ‰“å°å®ä½“</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ã€æŸ¥è¯¢çºªå½•åï¼Œä¿®æ”¹è®°å½•çš„å€¼ã€‘</span></span><br><span class="line">    docs[<span class="number">0</span>].title = <span class="string">'javascript'</span>; <span class="comment">// ä¿®æ”¹æ•°æ®</span></span><br><span class="line">    docs[<span class="number">0</span>].save(); <span class="comment">// ä¿å­˜ä¿®æ”¹åçš„æ•°æ®</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// ã€åˆ é™¤æ•°æ®ã€‘</span></span><br><span class="line">    <span class="keyword">if</span> (docs) &#123;</span><br><span class="line">        <span class="comment">// éå†æ–‡æ¡£ï¼Œé€æ¡åˆ é™¤</span></span><br><span class="line">        docs.forEach(<span class="function"><span class="keyword">function</span>(<span class="params">ele</span>) </span>&#123;</span><br><span class="line">            <span class="comment">// åªæœ‰å•ä¸ªæ–‡æ¡£å¯ä»¥ä½¿ç”¨ remove() æ–¹æ³•</span></span><br><span class="line">            ele.remove();</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>å¯ä»¥å°† Model æå–æˆå•ç‹¬çš„ä¸€ä¸ªç±»ï¼š</p>
<h4 id="article-js"><a href="#article-js" class="headerlink" title="article.js"></a>article.js</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">'use strict'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¯¼å…¥ mongoo æ¨¡å—</span></span><br><span class="line"><span class="keyword">const</span> mongoose = <span class="built_in">require</span>(<span class="string">'mongoose'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// å®šä¹‰ Schema</span></span><br><span class="line"><span class="keyword">const</span> Schema = mongoose.Schema;</span><br><span class="line"><span class="keyword">const</span> ObjectId = Schema.ObjectId; <span class="comment">// ä¸»é”®</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> ArticleSchema = <span class="keyword">new</span> Schema(&#123;</span><br><span class="line">    id: ObjectId,</span><br><span class="line">    title: &#123;<span class="attr">type</span>: <span class="built_in">String</span>, <span class="attr">required</span>: <span class="literal">true</span>, <span class="attr">max</span>: <span class="number">100</span>&#125;,</span><br><span class="line">    name: &#123;<span class="attr">type</span>: <span class="built_in">String</span>, <span class="attr">required</span>: <span class="literal">true</span>, <span class="attr">max</span>: <span class="number">100</span>&#125;,</span><br><span class="line">    date: &#123;<span class="attr">type</span>: date&#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¯¼å‡ºæ¨¡å‹</span></span><br><span class="line"><span class="built_in">module</span>.exports = mongoose.model(<span class="string">'Article'</span>, ArticleSchema);</span><br></pre></td></tr></table></figure>
<h3 id="å¸¸è§é”™è¯¯"><a href="#å¸¸è§é”™è¯¯" class="headerlink" title="å¸¸è§é”™è¯¯"></a>å¸¸è§é”™è¯¯</h3><h4 id="1-å¸¸è§é”™è¯¯ï¼šè¿æ¥-MongdDB-æ•°æ®åº“æ—¶æç¤ºå­—ç¬¦ä¸²å‚æ•°å¤±æ•ˆ"><a href="#1-å¸¸è§é”™è¯¯ï¼šè¿æ¥-MongdDB-æ•°æ®åº“æ—¶æç¤ºå­—ç¬¦ä¸²å‚æ•°å¤±æ•ˆ" class="headerlink" title="1. å¸¸è§é”™è¯¯ï¼šè¿æ¥ MongdDB æ•°æ®åº“æ—¶æç¤ºå­—ç¬¦ä¸²å‚æ•°å¤±æ•ˆ"></a>1. å¸¸è§é”™è¯¯ï¼šè¿æ¥ MongdDB æ•°æ®åº“æ—¶æç¤ºå­—ç¬¦ä¸²å‚æ•°å¤±æ•ˆ</h4><p>ç¤ºä¾‹ä»£ç â€œ</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è¿æ¥ mongoDB æ•°æ®åº“</span></span><br><span class="line">mongoose.connect(uri, <span class="function"><span class="keyword">function</span>(<span class="params">err</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (err) &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'connect failed'</span> + err);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'connect success'</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>é”™è¯¯æç¤ºå†…å®¹ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DeprecationWarning: current URL string parser is deprecated, and will be removed in a future version. To use the new parser, pass option &#123; useNewUrlParser: true &#125; to MongoClient.connect.</span><br></pre></td></tr></table></figure>
<p>è§£å†³æ–¹æ³•ï¼šè¿æ¥æ—¶ä¼ é€’å‚æ•°ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è¿æ¥ mongoDB æ•°æ®åº“</span></span><br><span class="line">mongoose.connect(uri, &#123;<span class="attr">useNewUrlParser</span>: <span class="literal">true</span>&#125;);</span><br><span class="line"><span class="keyword">const</span> db = mongoose.connection;</span><br><span class="line"><span class="comment">// å°†è¿æ¥ç»‘å®šåˆ°é”™è¯¯äº‹ä»¶</span></span><br><span class="line">db.on(<span class="string">'error'</span>, <span class="built_in">console</span>.error.bind(<span class="built_in">console</span>, <span class="string">'MongoDB connection error'</span>));</span><br></pre></td></tr></table></figure>
<h4 id="2-å¸¸è§é”™è¯¯ï¼šè¿æ¥-MongoDB-æ•°æ®åº“æ—¶æˆæƒå¤±è´¥ï¼Œæç¤ºï¼šerrmsg-â€˜Authentication-failed-â€™-code-18"><a href="#2-å¸¸è§é”™è¯¯ï¼šè¿æ¥-MongoDB-æ•°æ®åº“æ—¶æˆæƒå¤±è´¥ï¼Œæç¤ºï¼šerrmsg-â€˜Authentication-failed-â€™-code-18" class="headerlink" title="2. å¸¸è§é”™è¯¯ï¼šè¿æ¥ MongoDB æ•°æ®åº“æ—¶æˆæƒå¤±è´¥ï¼Œæç¤ºï¼šerrmsg: â€˜Authentication failed.â€™,  code: 18"></a>2. å¸¸è§é”™è¯¯ï¼šè¿æ¥ MongoDB æ•°æ®åº“æ—¶æˆæƒå¤±è´¥ï¼Œæç¤ºï¼š<strong>errmsg: â€˜Authentication failed.â€™,  code: 18</strong></h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// uri åé¢æ·»åŠ  authDatabase å‚æ•°</span></span><br><span class="line">mongoose.connect(<span class="string">'mongodb://user:password@host:port/dbname?authSource=admin'</span>)</span><br></pre></td></tr></table></figure>
<p>è§£å†³å‚è€ƒï¼š<a href="https://stackoverflow.com/questions/31398367/authentication-in-mongoose-using-scram-sha-1" target="_blank" rel="noopener">Authentication in mongoose using SCRAM-SHA-1</a></p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://andy0570.com/2018/10/11/Node.js ç½‘ç»œå¼€å‘/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ç‹¬æœ¨èˆŸçš„æœ¨">
      <meta itemprop="description" content="æœ‰æ—¶å€™é˜³å…‰å¾ˆå¥½ æœ‰æ—¶å€™é˜³å…‰å¾ˆæš—">
      <meta itemprop="image" content="https://ws1.sinaimg.cn/large/006tNc79gy1g22m14458rj30u014xu0x.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ç‹¬æœ¨èˆŸçš„æœ¨">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2018/10/11/Node.js ç½‘ç»œå¼€å‘/" class="post-title-link" itemprop="url">Node.js ç½‘ç»œå¼€å‘</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              

              
                
              

              <time title="åˆ›å»ºæ—¶é—´ï¼š2018-10-11 18:07:00" itemprop="dateCreated datePublished" datetime="2018-10-11T18:07:00+08:00">2018-10-11</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">æ›´æ–°äº</span>
                
                <time title="ä¿®æ”¹æ—¶é—´ï¼š2019-04-17 02:15:16" itemprop="dateModified" datetime="2019-04-17T02:15:16+08:00">2019-04-17</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Node-js/" itemprop="url" rel="index"><span itemprop="name">Node.js</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          
            <span id="/2018/10/11/Node.js ç½‘ç»œå¼€å‘/" class="leancloud_visitors" data-flag-title="Node.js ç½‘ç»œå¼€å‘">
              <span class="post-meta-divider">|</span>
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              
                <span class="post-meta-item-text">é˜…è¯»æ¬¡æ•°ï¼š</span>
              
                <span class="leancloud-visitors-count"></span>
            </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body han-init-context" itemprop="articleBody">

      
      

      
        
          
            <p>Node.js çš„ç½‘ç»œé€šä¿¡æ¨¡å—ï¼š</p>
<table>
<thead>
<tr>
<th>Node.js ç½‘ç»œé€šä¿¡æ¨¡å—</th>
<th>å®ç°çš„é€šä¿¡æ–¹å¼</th>
</tr>
</thead>
<tbody>
<tr>
<td>net</td>
<td>TCP</td>
</tr>
<tr>
<td>http</td>
<td>HTTP</td>
</tr>
<tr>
<td>http2</td>
<td>HTTP/2</td>
</tr>
<tr>
<td>https</td>
<td>HTTPS</td>
</tr>
<tr>
<td>dgram</td>
<td>UDP</td>
</tr>
</tbody>
</table>
<h2 id="æ„å»º-TCP-æœåŠ¡å™¨"><a href="#æ„å»º-TCP-æœåŠ¡å™¨" class="headerlink" title="æ„å»º TCP æœåŠ¡å™¨"></a>æ„å»º TCP æœåŠ¡å™¨</h2><h3 id="ä½¿ç”¨-Node-js-åˆ›å»º-TCP-æœåŠ¡å™¨"><a href="#ä½¿ç”¨-Node-js-åˆ›å»º-TCP-æœåŠ¡å™¨" class="headerlink" title="ä½¿ç”¨ Node.js åˆ›å»º TCP æœåŠ¡å™¨"></a>ä½¿ç”¨ Node.js åˆ›å»º TCP æœåŠ¡å™¨</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å¼•å…¥ net æ¨¡å—</span></span><br><span class="line"><span class="keyword">const</span> net = <span class="built_in">require</span>(<span class="string">'net'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆ›å»º TCP æœåŠ¡å™¨</span></span><br><span class="line"><span class="keyword">let</span> server = net.createServer(<span class="function"><span class="keyword">function</span>(<span class="params">socket</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'someone connects'</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// è®¾ç½®ç›‘å¬ç«¯å£</span></span><br><span class="line"><span class="comment">// server.listen() æ–¹æ³•ä¼šè§¦å‘ server ä¸‹çš„ listening äº‹ä»¶ã€‚</span></span><br><span class="line">server.listen(<span class="number">18001</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'server is listening'</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>åŒä¸Š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å¼•å…¥ net æ¨¡å—</span></span><br><span class="line"><span class="keyword">const</span> net = <span class="built_in">require</span>(<span class="string">'net'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆ›å»º TCP æœåŠ¡å™¨</span></span><br><span class="line"><span class="keyword">let</span> server = net.createServer(<span class="function"><span class="keyword">function</span>(<span class="params">socket</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'someone connects'</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// è®¾ç½®ç›‘å¬ç«¯å£</span></span><br><span class="line">server.listen(<span class="number">18001</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ‰‹åŠ¨ç›‘å¬ listening äº‹ä»¶</span></span><br><span class="line"><span class="comment">// è®¾ç½®ç›‘å¬æ—¶çš„å›è°ƒå‡½æ•°</span></span><br><span class="line">server.on(<span class="string">'listening'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'server is listening'</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>é™¤äº† listening äº‹ä»¶å¤–ï¼ŒTCP æœåŠ¡å™¨è¿˜æ”¯æŒä»¥ä¸‹äº‹ä»¶:</p>
<ul>
<li>connectionï¼šå½“æœ‰æ–°çš„é“¾æ¥åˆ›å»ºæ—¶è§¦å‘ï¼Œå›è°ƒå‡½æ•°çš„å‚æ•°ä¸º socket è¿æ¥å¯¹è±¡ã€‚</li>
<li>closeï¼šTCPæœåŠ¡å™¨å…³é—­çš„æ—¶å€™è§¦å‘ï¼Œå›è°ƒå‡½æ•°æ²¡æœ‰å‚æ•°ã€‚</li>
<li>errorï¼šTCPæœåŠ¡å™¨å‘ç”Ÿé”™è¯¯çš„æ—¶å€™è§¦å‘ï¼Œå›è°ƒå‡½æ•°çš„å‚æ•°ä¸º error å¯¹è±¡ï¼›</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å¼•å…¥ net æ¨¡å—</span></span><br><span class="line"><span class="keyword">const</span> net = <span class="built_in">require</span>(<span class="string">'net'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// å®ä¾‹è¯ä¸€ä¸ªæœåŠ¡å™¨å¯¹è±¡</span></span><br><span class="line"><span class="keyword">let</span> server = <span class="keyword">new</span> net.server();</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç›‘å¬ connection äº‹ä»¶</span></span><br><span class="line">server.on(<span class="string">'connection'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">socket</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'someone connects'</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// è®¾ç½®ç›‘å¬ç«¯å£</span></span><br><span class="line">server.listen(<span class="number">18001</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// è®¾ç½®ç›‘å¬æ—¶çš„å›è°ƒå‡½æ•°</span></span><br><span class="line">server.on(<span class="string">'listening'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'server is listening'</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// è®¾ç½®å…³é—­æ—¶çš„å›è°ƒå‡½æ•°</span></span><br><span class="line">server.on(<span class="string">'close'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'server closed'</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// è®¾ç½®å‡ºé”™æ—¶çš„å›è°ƒå‡½æ•°</span></span><br><span class="line">server.on(<span class="string">'error'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">error</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(error);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h3 id="æŸ¥çœ‹æœåŠ¡å™¨ç›‘å¬çš„åœ°å€"><a href="#æŸ¥çœ‹æœåŠ¡å™¨ç›‘å¬çš„åœ°å€" class="headerlink" title="æŸ¥çœ‹æœåŠ¡å™¨ç›‘å¬çš„åœ°å€"></a>æŸ¥çœ‹æœåŠ¡å™¨ç›‘å¬çš„åœ°å€</h3><p>é€šè¿‡ <strong>server.address()</strong> æ–¹æ³•æŸ¥çœ‹ TCP æœåŠ¡å™¨ç›‘å¬çš„åœ°å€ï¼Œå¹¶è¿”å›ä¸€ä¸ª JSON å¯¹è±¡ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å¼•å…¥ net æ¨¡å—</span></span><br><span class="line"><span class="keyword">const</span> net = <span class="built_in">require</span>(<span class="string">'net'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆ›å»º TCP æœåŠ¡å™¨</span></span><br><span class="line"><span class="keyword">let</span> server = net.createServer(<span class="function"><span class="keyword">function</span>(<span class="params">socket</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'someone connects'</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// è®¾ç½®ç›‘å¬ç«¯å£</span></span><br><span class="line">server.listen(<span class="number">18001</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">// è·å–åœ°å€ä¿¡æ¯</span></span><br><span class="line">  <span class="keyword">let</span> address = server.address();</span><br><span class="line">  <span class="comment">// è·å–ç«¯å£åœ°å€</span></span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'the port server is '</span> + address.port);</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'the address server is '</span> + address.address);</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'the family server is '</span> + address.family);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">the port server is 18001</span></span><br><span class="line"><span class="comment">the address server is ::</span></span><br><span class="line"><span class="comment">the family server is IPv6</span></span><br><span class="line"><span class="comment"> */</span></span><br></pre></td></tr></table></figure>
<h3 id="è¿æ¥æœåŠ¡å™¨çš„å®¢æˆ·ç«¯æ•°é‡"><a href="#è¿æ¥æœåŠ¡å™¨çš„å®¢æˆ·ç«¯æ•°é‡" class="headerlink" title="è¿æ¥æœåŠ¡å™¨çš„å®¢æˆ·ç«¯æ•°é‡"></a>è¿æ¥æœåŠ¡å™¨çš„å®¢æˆ·ç«¯æ•°é‡</h3><p>é€šè¿‡ server.getConnections() æ–¹æ³•è·å–è¿æ¥åˆ°è¿™ä¸ª TCP æœåŠ¡å™¨çš„å®¢æˆ·ç«¯æ•°é‡ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å¼•å…¥ net æ¨¡å—</span></span><br><span class="line"><span class="keyword">const</span> net = <span class="built_in">require</span>(<span class="string">'net'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆ›å»º TCP æœåŠ¡å™¨</span></span><br><span class="line"><span class="keyword">let</span> server = net.createServer(<span class="function"><span class="keyword">function</span>(<span class="params">socket</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'someone connects'</span>);</span><br><span class="line">  <span class="comment">// è®¾ç½®æœ€å¤§è¿æ¥æ•°ï¼Œè¿æ¥æ•°è¶…è¿‡åï¼ŒæœåŠ¡å™¨å°†æ‹’ç»æ–°çš„è¿æ¥ã€‚</span></span><br><span class="line">  server.maxConnections = <span class="number">10</span>;</span><br><span class="line">  server.getConnections(<span class="function"><span class="keyword">function</span> (<span class="params">err, count</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'the count of client is: '</span> + count);</span><br><span class="line">  )&#125;;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// è®¾ç½®ç›‘å¬ç«¯å£</span></span><br><span class="line">server.listen(<span class="number">18001</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">//...</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h3 id="è·å–å®¢æˆ·ç«¯å‘é€çš„æ•°æ®"><a href="#è·å–å®¢æˆ·ç«¯å‘é€çš„æ•°æ®" class="headerlink" title="è·å–å®¢æˆ·ç«¯å‘é€çš„æ•°æ®"></a>è·å–å®¢æˆ·ç«¯å‘é€çš„æ•°æ®</h3><ul>
<li>socket å¯¹è±¡å¯ä»¥ç”¨æ¥è·å–å®¢æˆ·ç«¯å‘é€çš„æ•°æ®æµï¼Œæ¯æ¬¡æ¥æ”¶åˆ°æ•°æ®çš„æ—¶å€™è§¦å‘ data äº‹ä»¶ï¼Œé€šè¿‡ç›‘å¬è¿™ä¸ªäº‹ä»¶å°±å¯ä»¥åœ¨å›è°ƒå‡½æ•°ä¸­è·å–åˆ°å®¢æˆ·ç«¯å‘é€çš„æ•°æ®äº†ã€‚</li>
<li>socket äº‹ä»¶ï¼šdataã€connectã€endã€errorã€timeout ç­‰</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å¼•å…¥ net æ¨¡å—</span></span><br><span class="line"><span class="keyword">const</span> net = <span class="built_in">require</span>(<span class="string">'net'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆ›å»º TCP æœåŠ¡å™¨</span></span><br><span class="line"><span class="keyword">let</span> server = net.createServer(<span class="function"><span class="keyword">function</span>(<span class="params">socket</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// ç›‘å¬ data äº‹ä»¶</span></span><br><span class="line">  socket.on(<span class="string">'data'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">data</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(data.toString); <span class="comment">// æ‰“å° data æ•°æ®</span></span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// è®¾ç½®ç›‘å¬ç«¯å£</span></span><br><span class="line">server.listen(<span class="number">18001</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'server is listening'</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h3 id="å‘é€æ•°æ®ç»™å®¢æˆ·ç«¯"><a href="#å‘é€æ•°æ®ç»™å®¢æˆ·ç«¯" class="headerlink" title="å‘é€æ•°æ®ç»™å®¢æˆ·ç«¯"></a>å‘é€æ•°æ®ç»™å®¢æˆ·ç«¯</h3><p>åˆ©ç”¨ <code>socket.write()</code> å¯ä»¥è®© TCP æœåŠ¡å™¨å‘é€æ•°æ®ç»™å®¢æˆ·ç«¯ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å¼•å…¥ net æ¨¡å—</span></span><br><span class="line"><span class="keyword">const</span> net = <span class="built_in">require</span>(<span class="string">'net'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆ›å»º TCP æœåŠ¡å™¨</span></span><br><span class="line"><span class="keyword">let</span> server = net.createServer(<span class="function"><span class="keyword">function</span>(<span class="params">socket</span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// è·å–åœ°å€ä¿¡æ¯</span></span><br><span class="line">  <span class="keyword">let</span> address = server.address();</span><br><span class="line">  <span class="keyword">let</span> message = <span class="string">'client, the server addresss is'</span> + <span class="built_in">JSON</span>.stringify(address);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// å‘é€æ•°æ®</span></span><br><span class="line">  socket.write(message, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> writeSize = socket.bytesWritten; <span class="comment">// å‘é€æ•°æ®çš„å­—èŠ‚æ•°</span></span><br><span class="line">    <span class="built_in">console</span>.log(message + <span class="string">'has send'</span>);</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'the size of message is '</span> + writeSize);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ç›‘å¬ data äº‹ä»¶</span></span><br><span class="line">  socket.on(<span class="string">'data'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">data</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(data.toString); <span class="comment">// æ‰“å° data æ•°æ®</span></span><br><span class="line">    <span class="keyword">let</span> readSize = socket.bytesRead; <span class="comment">// æ¥æ”¶æ•°æ®çš„å­—èŠ‚æ•°</span></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'the size of data is '</span> + readSize);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// è®¾ç½®ç›‘å¬ç«¯å£</span></span><br><span class="line">server.listen(<span class="number">18001</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'server is listening'</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h4 id="socket-çš„å±æ€§"><a href="#socket-çš„å±æ€§" class="headerlink" title="socket çš„å±æ€§"></a>socket çš„å±æ€§</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å¼•å…¥ net æ¨¡å—</span></span><br><span class="line"><span class="keyword">const</span> net = <span class="built_in">require</span>(<span class="string">'net'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆ›å»º TCP æœåŠ¡å™¨</span></span><br><span class="line"><span class="keyword">let</span> server = net.createServer(<span class="function"><span class="keyword">function</span>(<span class="params">socket</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'bytesWritten '</span> + socket.bytesWritten); <span class="comment">// å‘é€æ•°æ®å­—èŠ‚æ•°</span></span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'bytesRead '</span> + socket.bytesRead); <span class="comment">// æ¥æ”¶æ•°æ®å­—èŠ‚æ•°</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'localPort '</span> + socket.localPort); <span class="comment">// æœ¬åœ°ç«¯å£åœ°å€</span></span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'localAddress '</span> + socket.localAddress); <span class="comment">// æœ¬åœ° IP åœ°å€</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'remotePort '</span> + socket.remotePort); <span class="comment">// è¿œç¨‹ç«¯å£åœ°å€</span></span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'remoteAddress '</span> + socket.remoteAddress); <span class="comment">// è¿œç¨‹ IP åœ°å€</span></span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'remoteFamily '</span> + socket.remoteFamily); <span class="comment">// è¿œç¨‹ IP åè®®ç°‡</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// è®¾ç½®ç›‘å¬ç«¯å£</span></span><br><span class="line">server.listen(<span class="number">18001</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'server is listening'</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h2 id="æ„å»º-TCP-å®¢æˆ·ç«¯"><a href="#æ„å»º-TCP-å®¢æˆ·ç«¯" class="headerlink" title="æ„å»º TCP å®¢æˆ·ç«¯"></a>æ„å»º TCP å®¢æˆ·ç«¯</h2><h3 id="ä½¿ç”¨-Node-js-åˆ›å»º-TCP-å®¢æˆ·ç«¯"><a href="#ä½¿ç”¨-Node-js-åˆ›å»º-TCP-å®¢æˆ·ç«¯" class="headerlink" title="ä½¿ç”¨ Node.js åˆ›å»º TCP å®¢æˆ·ç«¯"></a>ä½¿ç”¨ Node.js åˆ›å»º TCP å®¢æˆ·ç«¯</h3><ul>
<li>åˆ›å»ºä¸€ä¸ª TCP å®¢æˆ·ç«¯åªéœ€è¦åˆ›å»ºä¸€ä¸ªè¿æ¥ TCP å®¢æˆ·ç«¯çš„ <strong>socket</strong> å¯¹è±¡å³å¯ã€‚</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å¼•å…¥ net æ¨¡å—</span></span><br><span class="line"><span class="keyword">const</span> net = <span class="built_in">require</span>(<span class="string">'net'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆ›å»ºå®¢æˆ·ç«¯</span></span><br><span class="line"><span class="keyword">let</span> client = <span class="keyword">new</span> net.Socket();</span><br><span class="line"></span><br><span class="line"><span class="comment">// è¿æ¥æœåŠ¡å™¨</span></span><br><span class="line">client.connect(<span class="number">18001</span>, <span class="string">'127.0.0.1'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'connect the server'</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// å‘é€æ•°æ®åˆ° TCP æœåŠ¡å™¨</span></span><br><span class="line">  client.write(<span class="string">'message from client'</span>);</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç›‘å¬ data äº‹ä»¶ï¼Œè·å–ä» TCP æœåŠ¡å™¨å‘é€çš„æ•°æ®</span></span><br><span class="line">client.on(<span class="string">'data'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">data</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'data of server is '</span> +  data.toString);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç›‘å¬ end äº‹ä»¶</span></span><br><span class="line">client.on(<span class="string">'end'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'data end'</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h2 id="æ„å»º-HTTP-æœåŠ¡å™¨"><a href="#æ„å»º-HTTP-æœåŠ¡å™¨" class="headerlink" title="æ„å»º HTTP æœåŠ¡å™¨"></a>æ„å»º HTTP æœåŠ¡å™¨</h2><h3 id="åˆ›å»ºHTTPæœåŠ¡å™¨"><a href="#åˆ›å»ºHTTPæœåŠ¡å™¨" class="headerlink" title="åˆ›å»ºHTTPæœåŠ¡å™¨"></a>åˆ›å»ºHTTPæœåŠ¡å™¨</h3><p>ç¤ºä¾‹ä¸€ï¼šå°†ä¸€è¡Œå­—ç¬¦ä¸²æ•°æ®å‘é€ç»™æµè§ˆå™¨ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å¼•å…¥ http æ¨¡å—</span></span><br><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">'http'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆ›å»º http æœåŠ¡å™¨</span></span><br><span class="line"><span class="comment">// http.createServer() æ–¹æ³•æ·»åŠ äº†ä¸€ä¸ª request äº‹ä»¶ç›‘å¬</span></span><br><span class="line"><span class="keyword">const</span> server = http.createServer(<span class="function"><span class="keyword">function</span>(<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// è®¾ç½®å“åº”å¤´</span></span><br><span class="line">    res.writeHead(<span class="number">200</span>, &#123;</span><br><span class="line">        <span class="string">'content-type'</span>: <span class="string">'text/plain'</span> <span class="comment">// è®¾ç½®ä¼ è¾“æ•°æ®ç±»å‹ï¼ŒæœåŠ¡å™¨æˆ–å®¢æˆ·ç«¯ä¼šæ ¹æ®è¯¥å€¼æ¥è§£æä¼ è¾“æ•°æ®</span></span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="comment">// è®¾ç½®å“åº”çš„æ•°æ®</span></span><br><span class="line">    res.end(<span class="string">'hello, Node.js'</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// è®¾ç½®æœåŠ¡å™¨ç›‘å¬ç«¯å£</span></span><br><span class="line">server.listen(<span class="number">3000</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'listening port 3000'</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>ç¤ºä¾‹äºŒï¼šé€šè¿‡æ–‡ä»¶æ¨¡å—å°†æ–‡ä»¶è¯»å–å¹¶å‘é€ç»™æµè§ˆå™¨ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å¼•å…¥ http æ¨¡å—</span></span><br><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">'http'</span>);</span><br><span class="line"><span class="comment">// å¼•å…¥ fs æ¨¡å—</span></span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆ›å»º http æœåŠ¡å™¨</span></span><br><span class="line"><span class="comment">// http.createServer() æ–¹æ³•æ·»åŠ äº†ä¸€ä¸ª request äº‹ä»¶ç›‘å¬</span></span><br><span class="line"><span class="keyword">const</span> server = http.createServer(<span class="function"><span class="keyword">function</span>(<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// è®¾ç½®å“åº”å¤´</span></span><br><span class="line">    res.writeHead(<span class="number">200</span>, &#123;</span><br><span class="line">        <span class="string">'content-type'</span>: <span class="string">'text/html'</span></span><br><span class="line">    &#125;); </span><br><span class="line">    <span class="comment">// è¯»å–æ–‡ä»¶æ•°æ®</span></span><br><span class="line">    <span class="keyword">let</span> data = fs.readFileSync(<span class="string">'./index.html'</span>);</span><br><span class="line">    <span class="comment">// å“åº”æ•°æ®</span></span><br><span class="line">    res.write(data);</span><br><span class="line">    res.end();</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// è®¾ç½®æœåŠ¡å™¨ç›‘å¬ç«¯å£</span></span><br><span class="line">server.listen(<span class="number">3000</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'listening port 3000'</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h3 id="HTTP-æœåŠ¡å™¨çš„è·¯ç”±æ§åˆ¶"><a href="#HTTP-æœåŠ¡å™¨çš„è·¯ç”±æ§åˆ¶" class="headerlink" title="HTTP æœåŠ¡å™¨çš„è·¯ç”±æ§åˆ¶"></a>HTTP æœåŠ¡å™¨çš„è·¯ç”±æ§åˆ¶</h3><ul>
<li>è·¯ç”±å°±æ˜¯ URL åˆ°å‡½æ•°çš„æ˜ å°„ã€‚</li>
<li>ç”¨æˆ·é€šè¿‡ URL åœ°å€è®¿é—®æœåŠ¡å™¨ï¼ŒæœåŠ¡ç«¯é€šè¿‡ <strong>req.url</strong> å±æ€§è·å–åˆ° URL åå¯¹è·¯ç”±è¿›è¡Œæ§åˆ¶ã€‚</li>
</ul>
<p>ç¤ºä¾‹ä»£ç ï¼šé€šè¿‡ req.url å¯¹è·¯å¾„å¤„ç†åˆ¤æ–­æ¥è¿”å›ä¸åŒçš„èµ„æºï¼Œä»è€Œåšåˆ°ç®€å•çš„è·¯ç”±æ§åˆ¶ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">'http'</span>);</span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>);</span><br><span class="line"><span class="keyword">const</span> url = <span class="built_in">require</span>(<span class="string">'url'</span>);</span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>);</span><br><span class="line"><span class="keyword">const</span> mime = <span class="built_in">require</span>(<span class="string">'./mime'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆ›å»º http æœåŠ¡å™¨</span></span><br><span class="line"><span class="keyword">const</span> server = http.createServer(<span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> filePath = <span class="string">'.'</span> + url.parse(req.url).pathname;</span><br><span class="line">    <span class="keyword">if</span> (filePath === <span class="string">'./'</span>) &#123;</span><br><span class="line">        filePath = <span class="string">'./index.html'</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åˆ¤æ–­ç›¸åº”çš„æ–‡ä»¶æ˜¯å¦å­˜åœ¨</span></span><br><span class="line">    fs.exists(filePath, <span class="function"><span class="keyword">function</span> (<span class="params">exists</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (exists) &#123;</span><br><span class="line">            <span class="comment">// 1.å­˜åœ¨åˆ™è¿”å›ç›¸åº”çš„æ•°æ®</span></span><br><span class="line">            <span class="keyword">let</span> data = fs.readFileSync(filePath);</span><br><span class="line">            <span class="keyword">let</span> contentType = mime[path.extname(filePath)];</span><br><span class="line">            <span class="comment">// è®¾ç½®å“åº”å¤´</span></span><br><span class="line">            res.writeHead(<span class="number">200</span>, &#123;</span><br><span class="line">                <span class="string">'content-type'</span>: contentType</span><br><span class="line">            &#125;);</span><br><span class="line">            <span class="comment">// å“åº”æ•°æ®</span></span><br><span class="line">            res.write(data);</span><br><span class="line">            res.end();</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// 2.ä¸å­˜åœ¨åˆ™è¿”å› 404</span></span><br><span class="line">            res.end(<span class="string">'404'</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// è®¾ç½®æœåŠ¡å™¨ç›‘å¬ç«¯å£</span></span><br><span class="line">server.listen(<span class="number">3000</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'listening port 3000'</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h2 id="åˆ©ç”¨-UDP-åè®®ä¼ è¾“æ•°æ®ä¸å‘é€æ¶ˆæ¯"><a href="#åˆ©ç”¨-UDP-åè®®ä¼ è¾“æ•°æ®ä¸å‘é€æ¶ˆæ¯" class="headerlink" title="åˆ©ç”¨ UDP åè®®ä¼ è¾“æ•°æ®ä¸å‘é€æ¶ˆæ¯"></a>åˆ©ç”¨ UDP åè®®ä¼ è¾“æ•°æ®ä¸å‘é€æ¶ˆæ¯</h2><p>ä½¿ç”¨ Node.js åˆ›å»ºæœåŠ¡å™¨ï¼Œéœ€è¦ä½¿ç”¨ dgram æ¨¡å—ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> dgram = <span class="built_in">require</span>(<span class="string">'dgram'</span>);</span><br></pre></td></tr></table></figure>
<blockquote>
<p>æœªå®Œå¾…ç»­â€¦</p>
</blockquote>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://andy0570.com/2018/10/11/Node.jsç¤ºä¾‹_åˆ©ç”¨ Node.js çˆ¬å–ç½‘é¡µå›¾ç‰‡/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ç‹¬æœ¨èˆŸçš„æœ¨">
      <meta itemprop="description" content="æœ‰æ—¶å€™é˜³å…‰å¾ˆå¥½ æœ‰æ—¶å€™é˜³å…‰å¾ˆæš—">
      <meta itemprop="image" content="https://ws1.sinaimg.cn/large/006tNc79gy1g22m14458rj30u014xu0x.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ç‹¬æœ¨èˆŸçš„æœ¨">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2018/10/11/Node.jsç¤ºä¾‹_åˆ©ç”¨ Node.js çˆ¬å–ç½‘é¡µå›¾ç‰‡/" class="post-title-link" itemprop="url">Node.jsç¤ºä¾‹_åˆ©ç”¨ Node.js çˆ¬å–ç½‘é¡µå›¾ç‰‡</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              

              
                
              

              <time title="åˆ›å»ºæ—¶é—´ï¼š2018-10-11 11:17:00" itemprop="dateCreated datePublished" datetime="2018-10-11T11:17:00+08:00">2018-10-11</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">æ›´æ–°äº</span>
                
                <time title="ä¿®æ”¹æ—¶é—´ï¼š2019-04-17 02:16:10" itemprop="dateModified" datetime="2019-04-17T02:16:10+08:00">2019-04-17</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Node-js/" itemprop="url" rel="index"><span itemprop="name">Node.js</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          
            <span id="/2018/10/11/Node.jsç¤ºä¾‹_åˆ©ç”¨ Node.js çˆ¬å–ç½‘é¡µå›¾ç‰‡/" class="leancloud_visitors" data-flag-title="Node.jsç¤ºä¾‹_åˆ©ç”¨ Node.js çˆ¬å–ç½‘é¡µå›¾ç‰‡">
              <span class="post-meta-divider">|</span>
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              
                <span class="post-meta-item-text">é˜…è¯»æ¬¡æ•°ï¼š</span>
              
                <span class="leancloud-visitors-count"></span>
            </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body han-init-context" itemprop="articleBody">

      
      

      
        
          
            <p>åˆ©ç”¨ Node.js çˆ¬å–ä¸€ä¸ªç½‘é¡µï¼Œé€šè¿‡ç¬¬ä¸‰æ–¹æ¨¡å— cheerio.js åˆ†æè¿™ä¸ªç½‘é¡µçš„å†…å®¹ï¼Œæœ€åå°†è¿™ä¸ªç½‘é¡µçš„å›¾ç‰‡ä¿å­˜åœ¨æœ¬åœ°ã€‚</p>
<h3 id="æ•´ä½“æ€è·¯"><a href="#æ•´ä½“æ€è·¯" class="headerlink" title="æ•´ä½“æ€è·¯"></a>æ•´ä½“æ€è·¯</h3><ul>
<li>é€šè¿‡ç¬¬ä¸‰æ–¹æ¨¡å— request è¯·æ±‚ç½‘é¡µåœ°å€ï¼Œä»è€Œå¾—åˆ°æ•´ä¸ªç½‘é¡µçš„DOMç»“æ„ã€‚</li>
<li>æ ¹æ®DOMç»“æ„åˆ©ç”¨ cheerio æ¨¡å—åˆ†æå‡ºå›¾ç‰‡æ–‡ä»¶çš„åœ°å€ï¼Œå†æ¬¡è¯·æ±‚è¿™ä¸ªåœ°å€ï¼Œæœ€åå°†å¾—åˆ°çš„å›¾ç‰‡æ•°æ®å‚¨å­˜åœ¨æœ¬åœ°ã€‚</li>
</ul>
<h3 id="é¡¹ç›®ç›®å½•"><a href="#é¡¹ç›®ç›®å½•" class="headerlink" title="é¡¹ç›®ç›®å½•"></a>é¡¹ç›®ç›®å½•</h3><p><img src="http://upload-images.jianshu.io/upload_images/2648731-46d65a59e8aea0a3.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image"></p>
<ul>
<li>img æ–‡ä»¶å¤¹ç”¨æ¥å­˜å‚¨å›¾ç‰‡æ–‡ä»¶ã€‚</li>
<li>node_modules æ–‡ä»¶å¤¹æ˜¯æ¨¡å—é»˜è®¤çš„ä¿å­˜ä½ç½®ã€‚</li>
<li>index.js æ–‡ä»¶æ˜¯æ•´ä¸ªé¡¹ç›®çš„å…¥å£åœ°å€ã€‚</li>
<li>config.js æ–‡ä»¶æ˜¯é…ç½®æ–‡ä»¶ã€‚</li>
<li>analyze.js æ–‡ä»¶ç”¨æ¥å­˜å‚¨åˆ†æ DOM çš„æ–¹æ³•ã€‚</li>
</ul>
<h3 id="config-js-æ–‡ä»¶"><a href="#config-js-æ–‡ä»¶" class="headerlink" title="config.js æ–‡ä»¶"></a>config.js æ–‡ä»¶</h3><p>é…ç½®ç½‘é¡µåœ°å€åŠå›¾ç‰‡å­˜æ”¾è·¯å¾„</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ç½‘é¡µåœ°å€</span></span><br><span class="line"><span class="keyword">const</span> url = <span class="string">'https://unsplash.com/photos/RDDYS5DFo08'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å›¾ç‰‡æ–‡ä»¶å¤¹è·¯å¾„</span></span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>);</span><br><span class="line"><span class="keyword">const</span> imgDir = path.join(__dirname, <span class="string">'img'</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports.url = url;</span><br><span class="line"><span class="built_in">module</span>.exports.imgDir = imgDir;</span><br></pre></td></tr></table></figure>
<h3 id="analyze-js-æ–‡ä»¶"><a href="#analyze-js-æ–‡ä»¶" class="headerlink" title="analyze.js æ–‡ä»¶"></a>analyze.js æ–‡ä»¶</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> cheerio = <span class="built_in">require</span>(<span class="string">'cheerio'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è§£æ DOM å¾—åˆ°å›¾ç‰‡åœ°å€</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * @param &#123;*&#125; dom</span></span><br><span class="line"><span class="comment"> * @param &#123;*&#125; callback</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">findImg</span>(<span class="params">dom, callback</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> $ = cheerio.load(dom);</span><br><span class="line">  $(<span class="string">'img'</span>).each(<span class="function"><span class="keyword">function</span>(<span class="params">i, elem</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> imgSrc = $(<span class="keyword">this</span>).attr(<span class="string">'src'</span>);</span><br><span class="line">    callback(imgSrc, i);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports.findImg = findImg;</span><br></pre></td></tr></table></figure>
<h3 id="index-js-æ–‡ä»¶"><a href="#index-js-æ–‡ä»¶" class="headerlink" title="index.js æ–‡ä»¶"></a>index.js æ–‡ä»¶</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> request = <span class="built_in">require</span>(<span class="string">'request'</span>);</span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>);</span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>);</span><br><span class="line"><span class="keyword">const</span> config = <span class="built_in">require</span>(<span class="string">'./config'</span>);</span><br><span class="line"><span class="keyword">const</span> analyze = <span class="built_in">require</span>(<span class="string">'./analyze'</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è¯·æ±‚å›¾ç‰‡åœ°å€</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">start</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">// å‘èµ·è¯·æ±‚è·å– DOM</span></span><br><span class="line">  request(config.url, <span class="function"><span class="keyword">function</span>(<span class="params">err, res, body</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'start'</span>);</span><br><span class="line">    <span class="keyword">if</span> (!err &amp;&amp; res) &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">'start'</span>);</span><br><span class="line">      <span class="comment">// å°† downLoad å‡½æ•°ä½œä¸ºå‚æ•°ä¼ é€’ç»™ analyze æ¨¡å—çš„ findImg æ–¹æ³•</span></span><br><span class="line">      analyze.findImg(body, downLoad);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è·å–åˆ° findImg å‡½æ•°è¿”å›çš„å›¾ç‰‡åœ°å€åï¼Œåˆ©ç”¨ request å†æ¬¡å‘èµ·è¯·æ±‚ï¼Œå°†æ•°æ®å†™å…¥æœ¬åœ°ã€‚</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * @param &#123;*&#125; imgUrl</span></span><br><span class="line"><span class="comment"> * @param &#123;*&#125; i</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">downLoad</span>(<span class="params">imgUrl, i</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> ext = imgUrl.split(<span class="string">'.'</span>).pop();</span><br><span class="line"></span><br><span class="line">  <span class="comment">// å†æ¬¡å‘èµ·è¯·æ±‚ï¼Œå†™æ–‡ä»¶</span></span><br><span class="line">  request(imgUrl).pipe(fs.createWriteStream(path.join(config.imgDir, i + <span class="string">'.'</span> + ext), &#123;</span><br><span class="line">    <span class="string">'encoding'</span>: <span class="string">'utf8'</span>,</span><br><span class="line">  &#125;));</span><br><span class="line">  <span class="built_in">console</span>.log(i);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">start();</span><br></pre></td></tr></table></figure>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/5/"><i class="fa fa-angle-left" aria-label="ä¸Šä¸€é¡µ"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/5/">5</a><span class="page-number current">6</span><a class="page-number" href="/page/7/">7</a><span class="space">&hellip;</span><a class="page-number" href="/page/32/">32</a><a class="extend next" rel="next" href="/page/7/"><i class="fa fa-angle-right" aria-label="ä¸‹ä¸€é¡µ"></i></a>
  </nav>



          </div>
          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <div class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image" src="https://ws1.sinaimg.cn/large/006tNc79gy1g22m14458rj30u014xu0x.jpg" alt="ç‹¬æœ¨èˆŸçš„æœ¨">
            
              <p class="site-author-name" itemprop="name">ç‹¬æœ¨èˆŸçš„æœ¨</p>
              <div class="site-description motion-element" itemprop="description">æœ‰æ—¶å€™é˜³å…‰å¾ˆå¥½ æœ‰æ—¶å€™é˜³å…‰å¾ˆæš—</div>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/">
                
                    <span class="site-state-item-count">311</span>
                    <span class="site-state-item-name">æ—¥å¿—</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-categories">
                  
                    
                      <a href="/categories/">
                    
                  
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">15</span>
                    <span class="site-state-item-name">åˆ†ç±»</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-tags">
                  
                    
                      <a href="/tags/">
                    
                  
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">74</span>
                    <span class="site-state-item-name">æ ‡ç­¾</span>
                  </a>
                </div>
              
            </nav>
          

          
            <div class="feed-link motion-element">
              <a href="/atom.xml" rel="alternate">
                <i class="fa fa-rss"></i>
                RSS
              </a>
            </div>
          

          

          
            <div class="links-of-author motion-element">
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                    
                  
                  <a href="https://github.com/Andy0570" title="GitHub &rarr; https://github.com/Andy0570" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i>GitHub</a>
                </span>
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                    
                  
                  <a href="mailto:andywhm@163.com" title="E-Mail &rarr; mailto:andywhm@163.com" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                </span>
              
            </div>
          

          
             <div class="cc-license motion-element" itemprop="license">
              
              
                
              
              
              
              <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" class="cc-opacity" rel="noopener" target="_blank"><img src="/images/cc-by-nc-sa.svg" alt="Creative Commons"></a>
             </div>
          

          
          

          
            
          
          

        </div>
      </div>

      

      

    </div>
  </aside>
  


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">ç‹¬æœ¨èˆŸçš„æœ¨</span>

  

  
</div>


  <div class="powered-by">ç”± <a href="https://hexo.io" class="theme-link" rel="noopener" target="_blank">Hexo</a> å¼ºåŠ›é©±åŠ¨ v3.8.0</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">ä¸»é¢˜ â€“ <a href="https://theme-next.org" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> v7.1.0</div>




        








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

    

    
  </div>

  

<script>
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>





  



  






  



  
    
    
      
    
  
  <script color="17,119,176" opacity="0.5" zindex="-1" count="99" src="//cdn.jsdelivr.net/gh/theme-next/theme-next-canvas-nest@1/canvas-nest.min.js"></script>













  
  <script src="//cdn.jsdelivr.net/npm/jquery@2/dist/jquery.min.js"></script>

  
  <script src="//cdn.jsdelivr.net/npm/fastclick@1/lib/fastclick.min.js"></script>

  
  <script src="//cdn.jsdelivr.net/npm/jquery-lazyload@1/jquery.lazyload.min.js"></script>

  
  <script src="//cdn.jsdelivr.net/npm/velocity-animate@1/velocity.min.js"></script>

  
  <script src="//cdn.jsdelivr.net/npm/velocity-animate@1/velocity.ui.min.js"></script>

  
  <script src="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.js"></script>


  


  <script src="/js/utils.js?v=7.1.0"></script>

  <script src="/js/motion.js?v=7.1.0"></script>



  
  


  <script src="/js/affix.js?v=7.1.0"></script>

  <script src="/js/schemes/pisces.js?v=7.1.0"></script>




  

  


  <script src="/js/next-boot.js?v=7.1.0"></script>


  

  

  
  
  
    
  

  
    
      
    
  

  
  
  
    <script src="//cdn.jsdelivr.net/npm/quicklink@1/dist/quicklink.umd.js"></script>
    <script>
      
        window.addEventListener('load', () => {
      
        quicklink({
          timeout: 3000,
          priority: true,
          ignores: [uri => uri.includes('#'),uri => uri == 'https://andy0570.com/page/6/',]
        });
      
        });
      
    </script>
  


  



  



  
  
  
    
  
  <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/instantsearch.js@2/dist/instantsearch.min.css">

  
  
    
  
  <script src="//cdn.jsdelivr.net/npm/instantsearch.js@2/dist/instantsearch.js"></script>
  

  <script src="/js/algolia-search.js?v=7.1.0"></script>



  
  
  <script>
    
    function showTime(Counter) {
      var entries = [];
      var $visitors = $('.leancloud_visitors');

      $visitors.each(function() {
        entries.push( $(this).attr('id').trim() );
      });

      Counter('get', '/classes/Counter', { where: JSON.stringify({ url: { '$in': entries } }) })
        .done(function({ results }) {
          var COUNT_CONTAINER_REF = '.leancloud-visitors-count';

          if (results.length === 0) {
            $visitors.find(COUNT_CONTAINER_REF).text(0);
            return;
          }

          for (var i = 0; i < results.length; i++) {
            var item = results[i];
            var url = item.url;
            var time = item.time;
            var element = document.getElementById(url);

            $(element).find(COUNT_CONTAINER_REF).text(time);
          }
          for (var i = 0; i < entries.length; i++) {
            var url = entries[i];
            var element = document.getElementById(url);
            var countSpan = $(element).find(COUNT_CONTAINER_REF);
            if (countSpan.text() == '') {
              countSpan.text(0);
            }
          }
        })
        .fail(function ({ responseJSON }) {
          console.log('LeanCloud Counter Error: ' + responseJSON.code + ' ' + responseJSON.error);
        });
    }
    

    $(function() {
      $.get('https://app-router.leancloud.cn/2/route?appId=' + 'S7i1Y8YorMKFPaYbJbekD5el-gzGzoHsz')
        .done(function({ api_server }) {
          var Counter = function(method, url, data) {
            return $.ajax({
              method: method,
              url: 'https://' + api_server + '/1.1' + url,
              headers: {
                'X-LC-Id': 'S7i1Y8YorMKFPaYbJbekD5el-gzGzoHsz',
                'X-LC-Key': 'brOnU8mOQvSjpipJvdKUAIbU',
                'Content-Type': 'application/json',
              },
              data: data
            });
          };
          
            if ($('.post-title-link').length >= 1) {
              showTime(Counter);
            }
          
        });
    });
  </script>



  

  

  

  

  

  

  

  

  
  
  
    
  
  <script src="//cdn.jsdelivr.net/npm/pangu@4/dist/browser/pangu.min.js"></script>
  <script>pangu.spacingPage();</script>


  
  
  
    
  
  <script src="//cdn.jsdelivr.net/gh/theme-next/theme-next-bookmark@1/bookmark.min.js"></script>
  <script>
  
    bookmark.loadBookmark();
  
  </script>


  

  

  


  <!-- red heart -->
  <script type="text/javascript" src="/js/src/love.js"></script>
  
</body>
</html>
