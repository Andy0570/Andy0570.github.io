<!DOCTYPE html>












  


<html class="theme-next gemini use-motion" lang="zh-CN">
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">




  
  
    
      
    
    
      
    
  <script src="//cdn.jsdelivr.net/npm/pace-js@1/pace.min.js"></script>
  <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/pace-js@1/themes/blue/pace-theme-minimal.css">



  
  
    
  
  <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/han-css@3/dist/han.min.css">













  
  
    
  
  <link rel="stylesheet" href="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.css">







  

<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/font-awesome@4/css/font-awesome.min.css">

<link rel="stylesheet" href="/css/main.css?v=7.1.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/panda/apple-touch-icon.png?v=7.1.0">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/panda/favicon-32x32.png?v=7.1.0">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/panda/favicon-16x16.png?v=7.1.0">


  <link rel="mask-icon" href="/images/panda/safari-pinned-tab.svg?v=7.1.0" color="#222">


  <link rel="manifest" href="/images/panda/site.webmanifest">


  <meta name="msapplication-config" content="/images/panda/browserconfig.xml">





<script id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '7.1.0',
    sidebar: {"position":"left","display":"post","offset":12,"onmobile":false,"dimmer":false},
    back2top: true,
    back2top_sidebar: false,
    fancybox: true,
    fastclick: true,
    lazyload: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  <meta name="description" content="有时候阳光很好 有时候阳光很暗">
<meta name="keywords" content="独木舟的木">
<meta property="og:type" content="website">
<meta property="og:title" content="独木舟的木">
<meta property="og:url" content="https://andy0570.com/page/20/index.html">
<meta property="og:site_name" content="独木舟的木">
<meta property="og:description" content="有时候阳光很好 有时候阳光很暗">
<meta property="og:locale" content="zh-CN">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="独木舟的木">
<meta name="twitter:description" content="有时候阳光很好 有时候阳光很暗">



  <link rel="alternate" href="/atom.xml" title="独木舟的木" type="application/atom+xml">



  
  
  <link rel="canonical" href="https://andy0570.com/page/20/">



<script id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>独木舟的木</title>
  






  <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?8229a094facca297f211d61323fd9fde";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>







  <noscript>
  <style>
  .use-motion .motion-element,
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-title { opacity: initial; }

  .use-motion .logo,
  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-CN">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <a href="https://github.com/andy0570" class="github-corner" aria-label="View source on GitHub"><svg width="80" height="80" viewbox="0 0 250 250" style="fill:#151513; color:#fff; position: absolute; top: 0; border: 0; right: 0;" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"/><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"/><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"/></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style>
    
    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">独木舟的木</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
      
        <p class="site-subtitle">iOS Developer</p>
      
    
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="切换导航栏">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home">

    
    
    
      
    

    
      
    

    <a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i> <br>首页</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-categories">

    
    
    
      
    

    
      
    

    <a href="/categories/" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i> <br>分类<span class="badge">14</span></a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-tags">

    
    
    
      
    

    
      
    

    <a href="/tags/" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i> <br>标签<span class="badge">39</span></a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">

    
    
    
      
    

    
      
    

    <a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i> <br>归档<span class="badge">314</span></a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-about">

    
    
    
      
    

    
      
    

    <a href="/about/" rel="section"><i class="menu-item-icon fa fa-fw fa-user"></i> <br>关于</a>

  </li>

      
      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br>搜索</a>
        </li>
      
    </ul>
  

  

  
    <div class="site-search">
      
  
  <div class="algolia-popup popup search-popup">
    <div class="algolia-search">
      <div class="algolia-search-input-icon">
        <i class="fa fa-search"></i>
      </div>
      <div class="algolia-search-input" id="algolia-search-input"></div>
    </div>

    <div class="algolia-results">
      <div id="algolia-stats"></div>
      <div id="algolia-hits"></div>
      <div id="algolia-pagination" class="algolia-pagination"></div>
    </div>

    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
  </div>




    </div>
  
</nav>



  



</div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
            

          
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://andy0570.com/2017/06/11/iOS 编程：轻量化视图控制器/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="独木舟的木">
      <meta itemprop="description" content="有时候阳光很好 有时候阳光很暗">
      <meta itemprop="image" content="https://ws1.sinaimg.cn/large/006tNc79gy1g22m14458rj30u014xu0x.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="独木舟的木">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2017/06/11/iOS 编程：轻量化视图控制器/" class="post-title-link" itemprop="url">iOS 编程：轻量化视图控制器</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2017-06-11 16:06:00" itemprop="dateCreated datePublished" datetime="2017-06-11T16:06:00+08:00">2017-06-11</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2019-04-17 15:32:54" itemprop="dateModified" datetime="2019-04-17T15:32:54+08:00">2019-04-17</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/iOS/" itemprop="url" rel="index"><span itemprop="name">iOS</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          
            <span id="/2017/06/11/iOS 编程：轻量化视图控制器/" class="leancloud_visitors" data-flag-title="iOS 编程：轻量化视图控制器">
              <span class="post-meta-divider">|</span>
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              
                <span class="post-meta-item-text">阅读次数：</span>
              
                <span class="leancloud-visitors-count"></span>
            </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body han-init-context" itemprop="articleBody">

      
      

      
        
          
            <a id="more"></a>
<blockquote>
<p>⭐️⭐️⭐️</p>
<p>这是一篇轻量化视图控制器的笔记，针对原文有所更改，加了自己的一些理解。</p>
<p>参考的文章如下：</p>
<ul>
<li><a href="https://www.objccn.io/issue-1-1/" target="_blank" rel="noopener">更轻量的 View Controllers @ObjC 中国</a></li>
<li><a href="https://www.objccn.io/issue-1-2/" target="_blank" rel="noopener">整洁的 Table View 代码 @ObjC 中国</a></li>
<li><a href="https://objccn.io/issue-1-4/" target="_blank" rel="noopener">View Controller 容器 @ObjC中国</a></li>
</ul>
<p>也推荐给你，建议对着<a href="https://github.com/objcio/issue-1-lighter-view-controllers" target="_blank" rel="noopener">源码</a>斟酌推敲，确实大有裨益。</p>
</blockquote>
<p>[TOC]</p>
<h1 id="整洁的-Table-View-代码"><a href="#整洁的-Table-View-代码" class="headerlink" title="整洁的 Table View 代码"></a>整洁的 Table View 代码</h1><h2 id="Table-View-Controller-的限制"><a href="#Table-View-Controller-的限制" class="headerlink" title="Table View Controller 的限制"></a>Table View Controller 的限制</h2><p>UITableViewController 对象 的 view 属性永远都是一个 tableView。如果你稍后决定在 tableView 旁边显示一些东西（比如一个地图），或者在视图底部显示一个固定位置的 Button 控件，这时候 UITableViewController  就无能为力了，要实现该需求只能把父类改成 UIViewController，然后把 tableView 设置为 subView ，再调整子视图之间的布局…总之，就是新建一个类，全部推倒重来。</p>
<h3 id="使用-Child-View-Controllers"><a href="#使用-Child-View-Controllers" class="headerlink" title="使用 Child View Controllers"></a>使用 Child View Controllers</h3><p>和完全抛弃 UITableViewController 对象不同，你还可以将它作为 child view controller 添加到其他 view controller 中（<a href="http://objccn.io/issue-1-4" target="_blank" rel="noopener">关于此话题的文章</a>）。这样，parent view controller 在管理其他的你需要的新加的界面元素的同时，table view controller 还可以继续管理它的 tableView。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">- (void)addPhotoDetailsTableView &#123;</span><br><span class="line">  </span><br><span class="line">    DetailsViewController *details = [[DetailsViewController alloc] init];</span><br><span class="line">    details.photo = self.photo;</span><br><span class="line">    details.delegate = self;</span><br><span class="line">    [self addChildViewController:details];</span><br><span class="line">  </span><br><span class="line">    CGRect frame = self.view.bounds;</span><br><span class="line">    frame.origin.y = 110;</span><br><span class="line">    details.view.frame = frame;</span><br><span class="line">    [self.view addSubview:details.view];</span><br><span class="line">  </span><br><span class="line">    [details didMoveToParentViewController:self];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>❇️ 优化原理：把 自定义的 <strong>UITableViewController</strong> 子类对象设置为视图控制器的 <code>childViewController</code>。</p>
<p>如果你使用这个解决方案，你就必须在 child view controller 和 parent view controller 之间建立消息传递的渠道。比如，如果用户选择了一个 tableView 中的 cell，parent view controller 需要知道这个事件来推入其他 view controller。根据使用习惯，<strong>通常最清晰的方式是为这个 table view controller 定义一个 delegate protocol，然后到 parent view controller 中去实现</strong>。</p>
<p>❇️ 当选择 DetailsViewController 中的某一行时，通过 Delegate 让 parentViewController 中去实现具体的行为方法：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">// ============================== </span><br><span class="line">// DetailsViewController.h</span><br><span class="line">#import &lt;UIKit/UIKit.h&gt;</span><br><span class="line">@class Photo;</span><br><span class="line"></span><br><span class="line">@protocol DetailsViewControllerDelegate</span><br><span class="line">- (void)didSelectPhotoAttributeWithKey:(NSString *)key;</span><br><span class="line">@end</span><br><span class="line"></span><br><span class="line">@interface DetailsViewController : UITableViewController</span><br><span class="line">@property (nonatomic, strong) Photo *photo;</span><br><span class="line">@property (nonatomic, weak) id &lt;DetailsViewControllerDelegate&gt; delegate;</span><br><span class="line">@end</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line">// ============================== </span><br><span class="line">// DetailsViewController.h</span><br><span class="line">@implementation DetailsViewController</span><br><span class="line">  </span><br><span class="line">// ...</span><br><span class="line">  </span><br><span class="line">#pragma mark UITableViewDelegate</span><br><span class="line">- (void)tableView:(UITableView *)tableView didSelectRowAtIndexPath:(NSIndexPath *)indexPath &#123;</span><br><span class="line">    NSString *key = self.keys[(NSUInteger) indexPath.row];</span><br><span class="line">    [self.delegate didSelectPhotoAttributeWithKey:key];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">// ============================== </span><br><span class="line">// parentViewController 的实现文件</span><br><span class="line">@interface PhotoViewController () &lt;DetailsViewControllerDelegate&gt;</span><br><span class="line">@end</span><br><span class="line"></span><br><span class="line">@implementation PhotoViewController</span><br><span class="line"></span><br><span class="line">// ...</span><br><span class="line">  </span><br><span class="line">#pragma mark DetailsViewControllerDelegate</span><br><span class="line">- (void)didSelectPhotoAttributeWithKey:(NSString *)key</span><br><span class="line">&#123;</span><br><span class="line">    // 实现点击 childViewController 某一行后的行为</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="分离关注点（Separating-Concerns）"><a href="#分离关注点（Separating-Concerns）" class="headerlink" title="分离关注点（Separating Concerns）"></a>分离关注点（Separating Concerns）</h2><h3 id="搭建-Model-对象和-Cell-之间的桥梁"><a href="#搭建-Model-对象和-Cell-之间的桥梁" class="headerlink" title="搭建 Model 对象和 Cell 之间的桥梁"></a>搭建 Model 对象和 Cell 之间的桥梁</h3><p>在 Cell 上显示 Model 层数据，通常的做法是这样的：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">// 通常做法：</span><br><span class="line">- (UITableViewCell *)tableView:(UITableView *)tableView</span><br><span class="line">         cellForRowAtIndexPath:(NSIndexPath *)indexPath &#123;</span><br><span class="line">    PhotoCell *cell = [tableView dequeueReusableCellWithIdentifier:@&quot;PhotoCell&quot;</span><br><span class="line">                                                      forIndexPath:indexPath];</span><br><span class="line">    Photo *photo = items[indexPath.row];</span><br><span class="line">    cell.photoTitleLabel.text = photo.name;</span><br><span class="line">    NSString* date = [self.dateFormatter stringFromDate:photo.creationDate];</span><br><span class="line">    cell.photoDateLabel.text = date;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>但是这样的代码会让 data source 变得混乱，因为它向 data source 暴露了 Cell 的设计。</p>
<p>❇️❇️ 优化原理：为 Cell 创建一个范畴（<strong>Category</strong>）类来配置 Model：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">// ============================== </span><br><span class="line">// PhotoCell+ConfigureForPhoto.h</span><br><span class="line">#import &lt;Foundation/Foundation.h&gt;</span><br><span class="line">#import &quot;PhotoCell.h&quot;</span><br><span class="line">@class Photo;</span><br><span class="line"></span><br><span class="line">@interface PhotoCell (ConfigureForPhoto)</span><br><span class="line">// Apple 官方的推荐的做法：为避免方法冲突，在 Category 类中的方法要加前缀_</span><br><span class="line">- (void)hql_configureForPhoto:(Photo *)photo;</span><br><span class="line">@end</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line">// ============================== </span><br><span class="line">// PhotoCell+ConfigureForPhoto.m</span><br><span class="line">#import &quot;PhotoCell+ConfigureForPhoto.h&quot;</span><br><span class="line">#import &quot;Photo.h&quot;</span><br><span class="line"></span><br><span class="line">@implementation PhotoCell (ConfigureForPhoto)</span><br><span class="line"></span><br><span class="line">- (void)hql_configureForPhoto:(Photo *)photo &#123;</span><br><span class="line">    self.photoTitleLabel.text = photo.name;</span><br><span class="line">    self.photoDateLabel.text =</span><br><span class="line">        [self.dateFormatter stringFromDate:photo.creationDate];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (NSDateFormatter *)dateFormatter &#123;</span><br><span class="line">    static NSDateFormatter *dateFormatter;</span><br><span class="line">    if (!dateFormatter) &#123;</span><br><span class="line">        dateFormatter = [[NSDateFormatter alloc] init];</span><br><span class="line">        dateFormatter.timeStyle = NSDateFormatterMediumStyle;</span><br><span class="line">        dateFormatter.dateStyle = NSDateFormatterMediumStyle;</span><br><span class="line">    &#125;</span><br><span class="line">    return dateFormatter;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@end</span><br></pre></td></tr></table></figure>
<p>有了上述代码后，视图控制器中的 data source 方法就变得简单了：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">// 优化做法：</span><br><span class="line">- (UITableViewCell *)tableView:(UITableView *)tableView</span><br><span class="line">         cellForRowAtIndexPath:(NSIndexPath *)indexPath &#123;</span><br><span class="line">    PhotoCell *cell = [tableView dequeueReusableCellWithIdentifier:@&quot;PhotoCell&quot;</span><br><span class="line">                                                      forIndexPath:indexPath];</span><br><span class="line">    Photo *photo = items[indexPath.row];</span><br><span class="line">    [cell hql_configureForPhoto:photo];</span><br><span class="line">    return cell;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="让-Cell-可复用"><a href="#让-Cell-可复用" class="headerlink" title="让 Cell 可复用"></a>让 Cell 可复用</h3><blockquote>
<p>❇️</p>
<p>关于如何让 cell 可以接收任何类型的 Model  一开始没理解</p>
<p>参考了人家的笔记：<a href="http://devtian.me/2015/03/23/objc-io-studynotes-ViewController-slim/" target="_blank" rel="noopener">objc.io 学习笔记-ViewController瘦身记</a></p>
</blockquote>
<p>有时多种 model 对象需要用同一类型的 cell 来表示，这种情况下，我们可以进一步让 cell 可以复用。</p>
<p>首先，我们给 cell 定义一个 protocol，需要用这个 cell 显示的对象必须遵循这个 protocol。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">@protocol HQLTableViewCellConfigureDelegate &lt;NSObject&gt;</span><br><span class="line">- (NSString *)imageName;</span><br><span class="line">- (NSString *)mainTitle;</span><br><span class="line">- (NSString *)detailTitle;</span><br><span class="line">@end</span><br></pre></td></tr></table></figure>
<p>然后简单修改 category 中的设置方法，让它可以接受遵循这个 protocol 的任何对象。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">- (void)setContent:(id&lt;CellConfigDelegate&gt;)model;</span><br></pre></td></tr></table></figure>
<p>需要使用该 cell 的 Model 就必须遵守 cell 中的 Delegate ，返回设置 cell 所需要的模型对象：</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// HQLModel.h</span></span><br><span class="line"><span class="meta">#import <span class="meta-string">&lt;Foundation/Foundation.h&gt;</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"HQLTableViewCell.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">HQLModel</span> : <span class="title">NSObject</span> &lt;<span class="title">HQLTableViewCellConfigureDelegate</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">copy</span>) <span class="built_in">NSString</span> *icon;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">copy</span>) <span class="built_in">NSString</span> *name;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">copy</span>) <span class="built_in">NSString</span> *ModelDescription;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// HQLModel.m</span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"HQLModel.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">HQLModel</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#pragma mark - HQLTableViewCellConfigureDelegate</span></span><br><span class="line"></span><br><span class="line">- (<span class="built_in">NSString</span> *)imageName &#123;</span><br><span class="line">    <span class="keyword">return</span> _icon;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="built_in">NSString</span> *)mainTitle &#123;</span><br><span class="line">    <span class="keyword">return</span> _name;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="built_in">NSString</span> *)detailTitle &#123;</span><br><span class="line">    <span class="keyword">return</span> _ModelDescription;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p>这些简单的步骤让 cell 和任何特殊的 model 对象之间得以解耦，让它可适应不同的数据类型。</p>
<h3 id="在-Cell-内部控制-Cell-的状态"><a href="#在-Cell-内部控制-Cell-的状态" class="headerlink" title="在 Cell 内部控制 Cell 的状态"></a>在 Cell 内部控制 Cell 的状态</h3><p>如果你想自定义 tableView 默认的高亮或选择行为，你可以实现两个 delegate 方法，把点击的 cell 修改成我们想要的样子。例如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">// 通常做法，在视图控制器中修改点击选择 cell 的高亮行为</span><br><span class="line">- (void)tableView:(UITableView *)tableView</span><br><span class="line">        didHighlightRowAtIndexPath:(NSIndexPath *)indexPath &#123;</span><br><span class="line">    PhotoCell *cell = [tableView cellForRowAtIndexPath:indexPath];</span><br><span class="line">    cell.photoTitleLabel.shadowColor = [UIColor darkGrayColor];</span><br><span class="line">    cell.photoTitleLabel.shadowOffset = CGSizeMake(3, 3);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (void)tableView:(UITableView *)tableView</span><br><span class="line">        didUnhighlightRowAtIndexPath:(NSIndexPath *)indexPath &#123;</span><br><span class="line">    PhotoCell *cell = [tableView cellForRowAtIndexPath:indexPath];</span><br><span class="line">    cell.photoTitleLabel.shadowColor = nil;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>然而，这两个 delegate 方法的实现又基于 view controller 知晓 cell 实现的具体细节。如果我们想替换或重新设计 cell，我们必须改写 delegate 代码。View 的实现细节和 delegate 的实现交织在一起了。我们应该把这些细节移到 cell 自身中去。</p>
<p>❇️ 优化原理：让 cell 自己的 .m 文件中去实现修改 Cell 状态的方法 ，来达到分离代码的目的。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">@implementation PhotoCell</span><br><span class="line">// ...</span><br><span class="line">- (void)setHighlighted:(BOOL)highlighted animated:(BOOL)animated &#123;</span><br><span class="line">    [super setHighlighted:highlighted animated:animated];</span><br><span class="line">    if (highlighted) &#123;</span><br><span class="line">        self.photoTitleLabel.shadowColor = [UIColor darkGrayColor];</span><br><span class="line">        self.photoTitleLabel.shadowOffset = CGSizeMake(3, 3);</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        self.photoTitleLabel.shadowColor = nil;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>总的来说，我们在努力<strong>把 view 层和 controller 层的实现细节分离开</strong>。delegate 肯定得清楚一个 view 该显示什么状态，但是它不应该了解如何修改 view 结构或者给某些 subviews 设置某些属性以获得正确的状态。所有这些逻辑都应该封装到 view 内部，然后给外部提供一个简单的 API。</p>
<h3 id="控制多个-Cell-类型"><a href="#控制多个-Cell-类型" class="headerlink" title="控制多个 Cell 类型"></a>控制多个 Cell 类型</h3><p>如果一个 tableView 里面有多种类型的 cell，data source 方法很快就难以控制了。在我们示例程序中，DetailsViewController 有两种不同类型的 cell：一种用于显示几个星，另一种用来显示一个键值对。为了划分处理不同 cell 类型的代码，data source 方法简单地<strong>通过判断 cell 的类型，把任务派发给其他指定的方法</strong>。</p>
<p>❇️ 优化原理：看源码就很容易理解，根据不同类型的 Cell ，配置方法分开写在指定的方法中：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">- (UITableViewCell *)tableView:(UITableView *)tableView</span><br><span class="line">         cellForRowAtIndexPath:(NSIndexPath *)indexPath</span><br><span class="line">&#123;</span><br><span class="line">    NSString *key = self.keys[(NSUInteger) indexPath.row];</span><br><span class="line">    id value = [self.photo valueForKey:key];</span><br><span class="line">    UITableViewCell *cell;</span><br><span class="line">    if ([key isEqual:PhotoRatingKey]) &#123;</span><br><span class="line">        cell = [self cellForRating:value indexPath:indexPath];</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        cell = [self detailCellForKey:key value:value];</span><br><span class="line">    &#125;</span><br><span class="line">    return cell;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (RatingCell *)cellForRating:(NSNumber *)rating</span><br><span class="line">                    indexPath:(NSIndexPath *)indexPath</span><br><span class="line">&#123;</span><br><span class="line">    // ...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (UITableViewCell *)detailCellForKey:(NSString *)key</span><br><span class="line">                                value:(id)value</span><br><span class="line">&#123;</span><br><span class="line">    // ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>Table view controllers（以及其他的 controller 对象）应该在 model 和 view 对象之间扮演<a href="http://developer.apple.com/library/mac/#documentation/General/Conceptual/DevPedia-CocoaCore/ControllerObject.html" target="_blank" rel="noopener">协调者和调解者的角色</a>。它不应该关心明显属于 view 层或 model 层的任务。你应该始终记住这点，这样 delegate 和 data source 方法会变得更小巧，最多包含一些简单的样板代码。</p>
<p>这不仅减少了 table view controllers 的大小和复杂性，而且还把业务逻辑和 view 的逻辑放到了更合适的地方。Controller 层的里里外外的实现细节都被封装成了简单的 API，最终，它变得更加容易理解，也更利于团队协作。</p>
<h1 id="更轻量的-View-Controllers"><a href="#更轻量的-View-Controllers" class="headerlink" title="更轻量的 View Controllers"></a>更轻量的 View Controllers</h1><h2 id="把-Data-Source-和其他-Protocols-分离出来"><a href="#把-Data-Source-和其他-Protocols-分离出来" class="headerlink" title="把 Data Source 和其他 Protocols 分离出来"></a>把 Data Source 和其他 Protocols 分离出来</h2><blockquote>
<p>❇️ ❇️ </p>
<p>之前的理解有些偏差，我明白作者轻量化 table view controller 的目的是为了复用。</p>
<p>之前以为是复用 控制器 类；</p>
<p>后来才明白是为了复用 <strong>UITableViewDataSource</strong> 协议的两个实现方法：</p>
<ul>
<li>tableView:numberOfRowsInSection:</li>
<li>tableView:cellForRowAtIndexPath:</li>
</ul>
<p>把 <strong>UITableViewDataSource</strong> 协议需要实现的两个方法写在一个单独的类（创建一个 ArrayDataSource 类作为通用的数据源类）中。我们就不用在每个含有 tableView 的 ViewController 里边都实现一遍 <strong>UITableViewDataSource</strong> 协议了，只要创建 ArrayDataSource 类并传入指定的几个参数。</p>
</blockquote>
<p>把 <code>UITableViewDataSource</code> 的代码提取出来放到一个单独的类中，是为 view controller 瘦身的强大技术之一。</p>
<p>示例项目中，有个 <code>PhotosViewController</code> 类，它有以下几个方法：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">// 通常的做法：</span><br><span class="line"># pragma mark - UITableViewDataSource</span><br><span class="line"></span><br><span class="line">- (Photo*)photoAtIndexPath:(NSIndexPath*)indexPath &#123;</span><br><span class="line">    return photos[(NSUInteger)indexPath.row];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (NSInteger)tableView:(UITableView*)tableView</span><br><span class="line"> numberOfRowsInSection:(NSInteger)section &#123;</span><br><span class="line">    return photos.count;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (UITableViewCell*)tableView:(UITableView*)tableView</span><br><span class="line">        cellForRowAtIndexPath:(NSIndexPath*)indexPath &#123;</span><br><span class="line">    PhotoCell* cell =</span><br><span class="line">        [tableView dequeueReusableCellWithIdentifier:PhotoCellIdentifier</span><br><span class="line">                                        forIndexPath:indexPath];</span><br><span class="line">    Photo* photo = [self photoAtIndexPath:indexPath];</span><br><span class="line">    cell.label.text = photo.name;</span><br><span class="line">    return cell;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这些代码基本都是围绕数组做一些事情，更针对地说，是围绕 view controller 所管理的 photos 数组做一些事情。我们可以尝试把数组相关的代码移到<a href="https://github.com/objcio/issue-1-lighter-view-controllers/blob/master/PhotoData/ArrayDataSource.h" target="_blank" rel="noopener">单独的类</a>中。我们使用一个 block 来设置 cell，也可以用 delegate 来做这件事，这取决于你的习惯。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br></pre></td><td class="code"><pre><span class="line">// ============================== </span><br><span class="line">// ArrayDataSource.h</span><br><span class="line">#import &lt;Foundation/Foundation.h&gt;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> 配置cell的Block对象</span><br><span class="line"></span><br><span class="line"> @param cell cell 对象类</span><br><span class="line"> @param item item 模型类</span><br><span class="line"> */</span><br><span class="line">typedef void (^TableViewCellConfigureBlock)(id cell, id item);</span><br><span class="line"></span><br><span class="line">@interface ArrayDataSource : NSObject &lt;UITableViewDataSource&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> ArrayDataSource 的指定初始化方法</span><br><span class="line"></span><br><span class="line"> @param anItems             参数一：数组模型</span><br><span class="line"> @param aCellIdentifier     参数二：cell复用标识符</span><br><span class="line"> @param aConfigureCellBlock 参数三：配置cell的Block对象</span><br><span class="line"> @return 返回值：ArrayDataSource实例对象</span><br><span class="line"> */</span><br><span class="line">- (id)initWithItems:(NSArray *)anItems</span><br><span class="line">     cellIdentifier:(NSString *)aCellIdentifier</span><br><span class="line"> configureCellBlock:(TableViewCellConfigureBlock)aConfigureCellBlock;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> 根据 index 找到 item 模型</span><br><span class="line"> </span><br><span class="line"> 这是一个公共方法，用到的地方主要有两处：</span><br><span class="line"> 1.配置 cell 时，根据 index 索引显示 model 数据；</span><br><span class="line"> 2.当用户点击 cell 时，根据 index 索引 找到对应的 model 作出响应</span><br><span class="line"> </span><br><span class="line"> @param indexPath index 索引</span><br><span class="line"> @return item 模型</span><br><span class="line"> */</span><br><span class="line">- (id)itemAtIndexPath:(NSIndexPath *)indexPath;</span><br><span class="line"></span><br><span class="line">@end</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">// ============================== </span><br><span class="line">// ArrayDataSource.m</span><br><span class="line">#import &quot;ArrayDataSource.h&quot;</span><br><span class="line"></span><br><span class="line">@interface ArrayDataSource ()</span><br><span class="line"></span><br><span class="line">@property (nonatomic, strong) NSArray *items;</span><br><span class="line">@property (nonatomic, copy) NSString *cellIdentifier;</span><br><span class="line">@property (nonatomic, copy) TableViewCellConfigureBlock configureCellBlock;</span><br><span class="line"></span><br><span class="line">@end</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">@implementation ArrayDataSource</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#pragma mark - Init</span><br><span class="line"></span><br><span class="line">- (id)init &#123;</span><br><span class="line">    return nil;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (id)initWithItems:(NSArray *)anItems</span><br><span class="line">     cellIdentifier:(NSString *)aCellIdentifier</span><br><span class="line"> configureCellBlock:(TableViewCellConfigureBlock)aConfigureCellBlock</span><br><span class="line">&#123;</span><br><span class="line">    self = [super init];</span><br><span class="line">    if (self) &#123;</span><br><span class="line">        self.items = anItems;</span><br><span class="line">        self.cellIdentifier = aCellIdentifier;</span><br><span class="line">        self.configureCellBlock = [aConfigureCellBlock copy];</span><br><span class="line">    &#125;</span><br><span class="line">    return self;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#pragma mark - Public</span><br><span class="line"></span><br><span class="line">- (id)itemAtIndexPath:(NSIndexPath *)indexPath &#123;</span><br><span class="line">    return self.items[(NSUInteger) indexPath.row];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#pragma mark UITableViewDataSource</span><br><span class="line"></span><br><span class="line">- (NSInteger)tableView:(UITableView *)tableView numberOfRowsInSection:(NSInteger)section &#123;</span><br><span class="line">    return self.items.count;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (UITableViewCell *)tableView:(UITableView *)tableView cellForRowAtIndexPath:(NSIndexPath *)indexPath &#123;</span><br><span class="line">    UITableViewCell *cell =</span><br><span class="line">        [tableView dequeueReusableCellWithIdentifier:self.cellIdentifier</span><br><span class="line">                                        forIndexPath:indexPath];</span><br><span class="line">    id item = [self itemAtIndexPath:indexPath];</span><br><span class="line">    // 调用 Block 方法配置 cell</span><br><span class="line">    self.configureCellBlock(cell, item);</span><br><span class="line">    return cell;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@end</span><br></pre></td></tr></table></figure>
<p>现在，你可以把 view controller 中的这 3 个方法去掉了，取而代之，你可以创建一个 <code>ArrayDataSource</code> 类的实例作为 table view 的 data source。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">- (void)setupTableView &#123;</span><br><span class="line">    // 参数一：数据源数组</span><br><span class="line">    NSArray *photos = [AppDelegate sharedDelegate].store.sortedPhotos;</span><br><span class="line">    // 参数三：配置 cell 的 Block 对象</span><br><span class="line">    TableViewCellConfigureBlock configureCell = ^(PhotoCell *cell, Photo *photo) &#123;</span><br><span class="line">        // 内部实现的是 cell 的范畴方法：根据 model 显示 cell</span><br><span class="line">        [cell configureForPhoto:photo];</span><br><span class="line">    &#125;;</span><br><span class="line">    self.photosArrayDataSource =</span><br><span class="line">        [[ArrayDataSource alloc] initWithItems:photos</span><br><span class="line">                                cellIdentifier:PhotoCellIdentifier</span><br><span class="line">                            configureCellBlock:configureCell];</span><br><span class="line">    self.tableView.dataSource = self.photosArrayDataSource;</span><br><span class="line">    </span><br><span class="line">    [self.tableView registerNib:[PhotoCell nib]</span><br><span class="line">         forCellReuseIdentifier:PhotoCellIdentifier];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>现在你不用担心把一个 index path 映射到数组中的位置了，每次你想把这个数组显示到一个 table view 中时，你都可以复用这些代码。你也可以实现一些额外的方法，比如 <code>tableView:commitEditingStyle:forRowAtIndexPath:</code>，在 table view controllers 之间共享。</p>
<p>此外，这种方法也可以扩展到其他 protocols 上面。最明显的一个就是 <code>UICollectionViewDataSource</code>。这给了你极大的灵活性；如果在开发的某个时候，你想用 <code>UICollectionView</code> 代替 <code>UITableView</code>，你几乎不需要对 view controller 作任何修改。你甚至可以让你的 data source 同时支持这两个协议。</p>
<h2 id="将业务逻辑移到-Model-中"><a href="#将业务逻辑移到-Model-中" class="headerlink" title="将业务逻辑移到 Model 中"></a>将业务逻辑移到 Model 中</h2><p>❇️ ❇️ 优化原理：把处理<u>业务逻辑</u>的代码移动到 Model 类的 category 中会变得更加清晰。</p>
<h2 id="创建-Store-类"><a href="#创建-Store-类" class="headerlink" title="创建 Store 类"></a>创建 Store 类</h2><p>❇️ ❇️优化原理：Store 对象会关心<u>数据加载</u>、<u>缓存</u>和设置<u>数据栈</u>。它也经常被称为<strong>服务层</strong>或者<strong>仓库</strong>。通过分离，我们就可以复用这些代码，单独测试他们，并且让 view controller 保持小巧。</p>
<h2 id="把网络请求逻辑移到-Model-层"><a href="#把网络请求逻辑移到-Model-层" class="headerlink" title="把网络请求逻辑移到 Model 层"></a>把网络请求逻辑移到 Model 层</h2><p>和上面的主题相似：不要在 view controller 中做网络请求的逻辑。取而代之，你应该将它们封装到另一个类中。这样，你的 view controller 就可以在之后通过使用回调（比如一个 completion 的 block）来请求网络了。这样的好处是，缓存和错误控制也可以在这个类里面完成。</p>
<p>❇️ ❇️ 优化原理：就是把处理网络请求的方法封装在单独的类库中，比如猿题库的开源框架 <a href="https://github.com/yuantiku/YTKNetwork" target="_blank" rel="noopener">YTKNetwork</a>。</p>
<h2 id="把-View-代码移到-View-层"><a href="#把-View-代码移到-View-层" class="headerlink" title="把 View 代码移到 View 层"></a>把 View 代码移到 View 层</h2><p>不应该在 view controller 中构建复杂的 view 层次结构。你可以使用 Interface Builder 或者把 views 封装到一个 <code>UIView</code> 子类当中。例如，如果你要创建一个选择日期的控件，把它放到一个名为 <code>DatePickerView</code> 的类中会比把所有的事情都在 view controller 中做好好得多。再一次，这样增加了可复用性并保持了简单。</p>
<h2 id="总结-1"><a href="#总结-1" class="headerlink" title="总结"></a>总结</h2><p>我们已经看到一些用来创建更小巧的 view controllers 的技术。我们并不是想把这些技术应用到每一个可能的角落，只是我们有一个目标：<strong>写可维护的代码。</strong>知道这些模式后，我们就更有可能把那些笨重的 view controllers 变得更整洁。</p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://andy0570.com/2017/06/07/MJExtension——模型转换框架/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="独木舟的木">
      <meta itemprop="description" content="有时候阳光很好 有时候阳光很暗">
      <meta itemprop="image" content="https://ws1.sinaimg.cn/large/006tNc79gy1g22m14458rj30u014xu0x.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="独木舟的木">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2017/06/07/MJExtension——模型转换框架/" class="post-title-link" itemprop="url">MJExtension——模型转换框架</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2017-06-07 14:01:00" itemprop="dateCreated datePublished" datetime="2017-06-07T14:01:00+08:00">2017-06-07</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2019-04-17 01:33:09" itemprop="dateModified" datetime="2019-04-17T01:33:09+08:00">2019-04-17</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/iOS-开源框架/" itemprop="url" rel="index"><span itemprop="name">iOS 开源框架</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          
            <span id="/2017/06/07/MJExtension——模型转换框架/" class="leancloud_visitors" data-flag-title="MJExtension——模型转换框架">
              <span class="post-meta-divider">|</span>
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              
                <span class="post-meta-item-text">阅读次数：</span>
              
                <span class="leancloud-visitors-count"></span>
            </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body han-init-context" itemprop="articleBody">

      
      

      
        
          
            <ul>
<li>GitHub源码:<a href="https://github.com/CoderMJLee/MJExtension" target="_blank" rel="noopener">MJExtension</a></li>
<li>star:6900+</li>
</ul>
<blockquote>
<pre><code>⭐️⭐️⭐️ 
</code></pre><p>以下内容来源于官方源码、 README 文档、测试 Demo或个人使用总结 ！</p>
</blockquote>
<p><img src="http://upload-images.jianshu.io/upload_images/2648731-add91c17711ff38a.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="Logo"></p>
<h1 id="MJExtension"><a href="#MJExtension" class="headerlink" title="MJExtension"></a>MJExtension</h1><ul>
<li>转换速度快、使用简单方便的字典转模型框架</li>
</ul>
<p>GitHub：<a href="https://github.com/CoderMJLee" target="_blank" rel="noopener">CoderMJLee</a> ｜ Blog：<a href="http://www.cnblogs.com/mjios" target="_blank" rel="noopener">mjios(Chinese)</a> ｜ PR is welcome，or <a href="mailto:richermj123go@vip.qq.com" target="_blank" rel="noopener">feedback</a></p>
<h2 id="Contents"><a href="#Contents" class="headerlink" title="Contents"></a>Contents</h2><ul>
<li><a href="#Getting_Started">Getting Started 【开始使用】</a><ul>
<li><a href="#Features">Features 【能做什么】</a></li>
<li><a href="#Installation">Installation 【安装】</a></li>
</ul>
</li>
<li><a href="#Examples">Examples 【示例】</a><ul>
<li><a href="#JSON_Model">JSON -&gt; Model</a></li>
<li><a href="#JSONString_Model">JSONString -&gt; Model</a></li>
<li><a href="#Model_contains_model">Model contains model</a></li>
<li><a href="#Model_contains_model_array">Model contains model-array</a></li>
<li><a href="#Model_name_JSON_key_mapping">Model name - JSON key mapping</a></li>
<li><a href="#JSON_array_model_array">JSON array -&gt; model array</a></li>
<li><a href="#Model_JSON">Model -&gt; JSON</a></li>
<li><a href="#Model_array_JSON_array">Model array -&gt; JSON array</a></li>
<li><a href="#Core_Data">Core Data</a></li>
<li><a href="#Coding">Coding</a></li>
<li><a href="#Camel_underline">Camel -&gt; underline</a></li>
<li><a href="#NSString_NSDate">NSString -&gt; NSDate, nil -&gt; @””</a></li>
<li><a href="#More_use_cases">More use cases</a></li>
</ul>
</li>
</ul>
<hr>
<h1 id="Getting-Started【开始使用】"><a href="#Getting-Started【开始使用】" class="headerlink" title="Getting Started【开始使用】"></a>Getting Started【开始使用】</h1><h2 id="Features【能做什么】"><a href="#Features【能做什么】" class="headerlink" title="Features【能做什么】"></a>Features【能做什么】</h2><ul>
<li>MJExtension是一套字典和模型之间互相转换的超轻量级框架</li>
</ul>
<ul>
<li><code>JSON</code> → <code>Model</code>、<code>Core Data Model</code></li>
<li><code>JSONString</code> → <code>Model</code>、<code>Core Data Model</code></li>
<li><code>Model</code>、<code>Core Data Model</code> → <code>JSON</code></li>
<li><code>JSON Array</code> → <code>Model Array</code>、<code>Core Data Model Array</code></li>
<li><code>JSONString</code> → <code>Model Array</code>、<code>Core Data Model Array</code></li>
<li><code>Model Array</code>、<code>Core Data Model Array</code> → <code>JSON Array</code></li>
<li>Coding all properties of model in one line code.<ul>
<li>只需要一行代码，就能实现模型的所有属性进行Coding（归档和解档）</li>
</ul>
</li>
</ul>
<h2 id="Installation【安装】"><a href="#Installation【安装】" class="headerlink" title="Installation【安装】"></a>Installation【安装】</h2><h3 id="From-CocoaPods【使用CocoaPods】"><a href="#From-CocoaPods【使用CocoaPods】" class="headerlink" title="From CocoaPods【使用CocoaPods】"></a>From CocoaPods【使用CocoaPods】</h3><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pod <span class="string">'MJExtension'</span></span><br></pre></td></tr></table></figure>
<h3 id="Manually【手动导入】"><a href="#Manually【手动导入】" class="headerlink" title="Manually【手动导入】"></a>Manually【手动导入】</h3><ul>
<li>Drag all source files under floder <code>MJExtension</code> to your project.【将<code>MJExtension</code>文件夹中的所有源代码拽入项目中】</li>
<li>Import the main header file：<code>#import &quot;MJExtension.h&quot;</code>【导入主头文件：<code>#import &quot;MJExtension.h&quot;</code>】</li>
</ul>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">MJExtension.h</span><br><span class="line">MJConst.h               MJConst.m</span><br><span class="line">MJFoundation.h          MJFoundation.m</span><br><span class="line">MJProperty.h            MJProperty.m</span><br><span class="line">MJType.h                MJType.m</span><br><span class="line"><span class="built_in">NSObject</span>+MJCoding.h     <span class="built_in">NSObject</span>+MJCoding.m</span><br><span class="line"><span class="built_in">NSObject</span>+MJProperty.h   <span class="built_in">NSObject</span>+MJProperty.m</span><br><span class="line"><span class="built_in">NSObject</span>+MJKeyValue.h   <span class="built_in">NSObject</span>+MJKeyValue.m</span><br></pre></td></tr></table></figure>
<h1 id="Examples【示例】"><a href="#Examples【示例】" class="headerlink" title="Examples【示例】"></a>Examples【示例】</h1><h3 id="The-most-simple-JSON-→-Model【最简单的字典转模型】"><a href="#The-most-simple-JSON-→-Model【最简单的字典转模型】" class="headerlink" title="The most simple JSON → Model【最简单的字典转模型】"></a>The most simple JSON → Model【最简单的字典转模型】</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">typedef enum &#123;</span><br><span class="line">    SexMale,</span><br><span class="line">    SexFemale</span><br><span class="line">&#125; Sex;</span><br><span class="line"></span><br><span class="line">@interface User : NSObject</span><br><span class="line">@property (copy, nonatomic) NSString *name;</span><br><span class="line">@property (copy, nonatomic) NSString *icon;</span><br><span class="line">@property (assign, nonatomic) unsigned int age;</span><br><span class="line">@property (copy, nonatomic) NSString *height;</span><br><span class="line">@property (strong, nonatomic) NSNumber *money;</span><br><span class="line">@property (assign, nonatomic) Sex sex;</span><br><span class="line">@property (assign, nonatomic, getter=isGay) BOOL gay;</span><br><span class="line">@end</span><br><span class="line"></span><br><span class="line">/***********************************************/</span><br><span class="line"></span><br><span class="line">NSDictionary *dict = @&#123;</span><br><span class="line">    @&quot;name&quot; : @&quot;Jack&quot;,</span><br><span class="line">    @&quot;icon&quot; : @&quot;lufy.png&quot;,</span><br><span class="line">    @&quot;age&quot; : @20,</span><br><span class="line">    @&quot;height&quot; : @&quot;1.55&quot;,</span><br><span class="line">    @&quot;money&quot; : @100.9,</span><br><span class="line">    @&quot;sex&quot; : @(SexFemale),</span><br><span class="line">    @&quot;gay&quot; : @&quot;true&quot;</span><br><span class="line">//   @&quot;gay&quot; : @&quot;1&quot;</span><br><span class="line">//   @&quot;gay&quot; : @&quot;NO&quot;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">// ❇️ JSON → Model</span><br><span class="line">User *user = [User mj_objectWithKeyValues:dict];</span><br><span class="line"></span><br><span class="line">NSLog(@&quot;name=%@, icon=%@, age=%zd, height=%@, money=%@, sex=%d, gay=%d&quot;, user.name, user.icon, user.age, user.height, user.money, user.sex, user.gay);</span><br><span class="line">// name=Jack, icon=lufy.png, age=20, height=1.550000, money=100.9, sex=1</span><br></pre></td></tr></table></figure>
<h3 id="JSONString-→-Model【JSON字符串转模型】"><a href="#JSONString-→-Model【JSON字符串转模型】" class="headerlink" title="JSONString → Model【JSON字符串转模型】"></a>JSONString → Model【JSON字符串转模型】</h3><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1.Define a JSONString</span></span><br><span class="line"><span class="built_in">NSString</span> *jsonString = <span class="string">@"&#123;\"name\":\"Jack\", \"icon\":\"lufy.png\", \"age\":20&#125;"</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2.JSONString → Model</span></span><br><span class="line">User *user = [User mj_objectWithKeyValues:jsonString];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3.Print user's properties</span></span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"name=%@, icon=%@, age=%d"</span>, user.name, user.icon, user.age);</span><br><span class="line"><span class="comment">// name=Jack, icon=lufy.png, age=20</span></span><br></pre></td></tr></table></figure>
<h3 id="Model-contains-model【模型中嵌套模型】"><a href="#Model-contains-model【模型中嵌套模型】" class="headerlink" title="Model contains model【模型中嵌套模型】"></a>Model contains model【模型中嵌套模型】</h3><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">Status</span> : <span class="title">NSObject</span></span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">copy</span>, <span class="keyword">nonatomic</span>) <span class="built_in">NSString</span> *text;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">strong</span>, <span class="keyword">nonatomic</span>) User *user;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">strong</span>, <span class="keyword">nonatomic</span>) Status *retweetedStatus;</span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/***********************************************/</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">NSDictionary</span> *dict = @&#123;</span><br><span class="line">    <span class="string">@"text"</span> : <span class="string">@"Agree!Nice weather!"</span>,</span><br><span class="line">    <span class="string">@"user"</span> : @&#123;</span><br><span class="line">        <span class="string">@"name"</span> : <span class="string">@"Jack"</span>,</span><br><span class="line">        <span class="string">@"icon"</span> : <span class="string">@"lufy.png"</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">@"retweetedStatus"</span> : @&#123;</span><br><span class="line">        <span class="string">@"text"</span> : <span class="string">@"Nice weather!"</span>,</span><br><span class="line">        <span class="string">@"user"</span> : @&#123;</span><br><span class="line">            <span class="string">@"name"</span> : <span class="string">@"Rose"</span>,</span><br><span class="line">            <span class="string">@"icon"</span> : <span class="string">@"nami.png"</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// JSON → Status</span></span><br><span class="line">Status *status = [Status mj_objectWithKeyValues:dict];</span><br><span class="line"></span><br><span class="line"><span class="built_in">NSString</span> *text = status.text;</span><br><span class="line"><span class="built_in">NSString</span> *name = status.user.name;</span><br><span class="line"><span class="built_in">NSString</span> *icon = status.user.icon;</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"text=%@, name=%@, icon=%@"</span>, text, name, icon);</span><br><span class="line"><span class="comment">// text=Agree!Nice weather!, name=Jack, icon=lufy.png</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">NSString</span> *text2 = status.retweetedStatus.text;</span><br><span class="line"><span class="built_in">NSString</span> *name2 = status.retweetedStatus.user.name;</span><br><span class="line"><span class="built_in">NSString</span> *icon2 = status.retweetedStatus.user.icon;</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"text2=%@, name2=%@, icon2=%@"</span>, text2, name2, icon2);</span><br><span class="line"><span class="comment">// text2=Nice weather!, name2=Rose, icon2=nami.png</span></span><br></pre></td></tr></table></figure>
<h3 id="Model-contains-model-array【模型中有个数组属性，数组里面又要装着其他模型】"><a href="#Model-contains-model-array【模型中有个数组属性，数组里面又要装着其他模型】" class="headerlink" title="Model contains model-array【模型中有个数组属性，数组里面又要装着其他模型】"></a>Model contains model-array【模型中有个数组属性，数组里面又要装着其他模型】</h3><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">Ad</span> : <span class="title">NSObject</span></span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">copy</span>, <span class="keyword">nonatomic</span>) <span class="built_in">NSString</span> *image;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">copy</span>, <span class="keyword">nonatomic</span>) <span class="built_in">NSString</span> *url;</span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">StatusResult</span> : <span class="title">NSObject</span></span></span><br><span class="line"><span class="comment">/** Contatins status model */</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">strong</span>, <span class="keyword">nonatomic</span>) <span class="built_in">NSMutableArray</span> *statuses;</span><br><span class="line"><span class="comment">/** Contatins ad model */</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">strong</span>, <span class="keyword">nonatomic</span>) <span class="built_in">NSArray</span> *ads;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">strong</span>, <span class="keyword">nonatomic</span>) <span class="built_in">NSNumber</span> *totalNumber;</span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/***********************************************/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ❇️ Tell MJExtension what type model will be contained in statuses and ads.</span></span><br><span class="line">[StatusResult mj_setupObjectClassInArray:^<span class="built_in">NSDictionary</span> *&#123;</span><br><span class="line">    <span class="keyword">return</span> @&#123;</span><br><span class="line">               <span class="string">@"statuses"</span> : <span class="string">@"Status"</span>,</span><br><span class="line">               <span class="comment">// @"statuses" : [Status class],</span></span><br><span class="line">               <span class="string">@"ads"</span> : <span class="string">@"Ad"</span></span><br><span class="line">               <span class="comment">// @"ads" : [Ad class]</span></span><br><span class="line">           &#125;;</span><br><span class="line">&#125;];</span><br><span class="line"><span class="comment">// Equals: StatusResult.m implements +mj_objectClassInArray method.</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">NSDictionary</span> *dict = @&#123;</span><br><span class="line">    <span class="string">@"statuses"</span> : @[</span><br><span class="line">                      @&#123;</span><br><span class="line">                          <span class="string">@"text"</span> : <span class="string">@"Nice weather!"</span>,</span><br><span class="line">                          <span class="string">@"user"</span> : @&#123;</span><br><span class="line">                              <span class="string">@"name"</span> : <span class="string">@"Rose"</span>,</span><br><span class="line">                              <span class="string">@"icon"</span> : <span class="string">@"nami.png"</span></span><br><span class="line">                          &#125;</span><br><span class="line">                      &#125;,</span><br><span class="line">                      @&#123;</span><br><span class="line">                          <span class="string">@"text"</span> : <span class="string">@"Go camping tomorrow!"</span>,</span><br><span class="line">                          <span class="string">@"user"</span> : @&#123;</span><br><span class="line">                              <span class="string">@"name"</span> : <span class="string">@"Jack"</span>,</span><br><span class="line">                              <span class="string">@"icon"</span> : <span class="string">@"lufy.png"</span></span><br><span class="line">                          &#125;</span><br><span class="line">                      &#125;</span><br><span class="line">                  ],</span><br><span class="line">    <span class="string">@"ads"</span> : @[</span><br><span class="line">                 @&#123;</span><br><span class="line">                     <span class="string">@"image"</span> : <span class="string">@"ad01.png"</span>,</span><br><span class="line">                     <span class="string">@"url"</span> : <span class="string">@"http://www.ad01.com"</span></span><br><span class="line">                 &#125;,</span><br><span class="line">                 @&#123;</span><br><span class="line">                     <span class="string">@"image"</span> : <span class="string">@"ad02.png"</span>,</span><br><span class="line">                     <span class="string">@"url"</span> : <span class="string">@"http://www.ad02.com"</span></span><br><span class="line">                 &#125;</span><br><span class="line">             ],</span><br><span class="line">    <span class="string">@"totalNumber"</span> : <span class="string">@"2014"</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ❇️ JSON → StatusResult</span></span><br><span class="line">StatusResult *result = [StatusResult mj_objectWithKeyValues:dict];</span><br><span class="line"></span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"totalNumber=%@"</span>, result.totalNumber);</span><br><span class="line"><span class="comment">// totalNumber=2014</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Printing</span></span><br><span class="line"><span class="keyword">for</span> (Status *status <span class="keyword">in</span> result.statuses) &#123;</span><br><span class="line">    <span class="built_in">NSString</span> *text = status.text;</span><br><span class="line">    <span class="built_in">NSString</span> *name = status.user.name;</span><br><span class="line">    <span class="built_in">NSString</span> *icon = status.user.icon;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"text=%@, name=%@, icon=%@"</span>, text, name, icon);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// text=Nice weather!, name=Rose, icon=nami.png</span></span><br><span class="line"><span class="comment">// text=Go camping tomorrow!, name=Jack, icon=lufy.png</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Printing</span></span><br><span class="line"><span class="keyword">for</span> (Ad *ad <span class="keyword">in</span> result.ads) &#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"image=%@, url=%@"</span>, ad.image, ad.url);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// image=ad01.png, url=http://www.ad01.com</span></span><br><span class="line"><span class="comment">// image=ad02.png, url=http://www.ad02.com</span></span><br></pre></td></tr></table></figure>
<h3 id="Model-name-JSON-key-mapping【模型中的属性名和字典中的key不相同-或者需要多级映射-】"><a href="#Model-name-JSON-key-mapping【模型中的属性名和字典中的key不相同-或者需要多级映射-】" class="headerlink" title="Model name - JSON key mapping【模型中的属性名和字典中的key不相同(或者需要多级映射)】"></a>Model name - JSON key mapping【模型中的属性名和字典中的key不相同(或者需要多级映射)】</h3><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">Bag</span> : <span class="title">NSObject</span></span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">copy</span>, <span class="keyword">nonatomic</span>) <span class="built_in">NSString</span> *name;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">assign</span>, <span class="keyword">nonatomic</span>) <span class="keyword">double</span> price;</span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">Student</span> : <span class="title">NSObject</span></span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">copy</span>, <span class="keyword">nonatomic</span>) <span class="built_in">NSString</span> *ID;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">copy</span>, <span class="keyword">nonatomic</span>) <span class="built_in">NSString</span> *desc;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">copy</span>, <span class="keyword">nonatomic</span>) <span class="built_in">NSString</span> *nowName;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">copy</span>, <span class="keyword">nonatomic</span>) <span class="built_in">NSString</span> *oldName;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">copy</span>, <span class="keyword">nonatomic</span>) <span class="built_in">NSString</span> *nameChangedTime;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">strong</span>, <span class="keyword">nonatomic</span>) Bag *bag;</span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/***********************************************/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ❇️ How to map</span></span><br><span class="line">[Student mj_setupReplacedKeyFromPropertyName:^<span class="built_in">NSDictionary</span> *&#123;</span><br><span class="line">    <span class="keyword">return</span> @&#123;</span><br><span class="line">               <span class="string">@"ID"</span> : <span class="string">@"id"</span>,</span><br><span class="line">               <span class="string">@"desc"</span> : <span class="string">@"desciption"</span>,</span><br><span class="line">               <span class="string">@"oldName"</span> : <span class="string">@"name.oldName"</span>,</span><br><span class="line">               <span class="string">@"nowName"</span> : <span class="string">@"name.newName"</span>,</span><br><span class="line">               <span class="string">@"nameChangedTime"</span> : <span class="string">@"name.info[1].nameChangedTime"</span>,</span><br><span class="line">               <span class="string">@"bag"</span> : <span class="string">@"other.bag"</span></span><br><span class="line">           &#125;;</span><br><span class="line">&#125;];</span><br><span class="line"><span class="comment">// Equals: Student.m implements +mj_replacedKeyFromPropertyName method.</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">NSDictionary</span> *dict = @&#123;</span><br><span class="line">    <span class="string">@"id"</span> : <span class="string">@"20"</span>,</span><br><span class="line">    <span class="string">@"desciption"</span> : <span class="string">@"kids"</span>,</span><br><span class="line">    <span class="string">@"name"</span> : @&#123;</span><br><span class="line">        <span class="string">@"newName"</span> : <span class="string">@"lufy"</span>,</span><br><span class="line">        <span class="string">@"oldName"</span> : <span class="string">@"kitty"</span>,</span><br><span class="line">        <span class="string">@"info"</span> : @[</span><br><span class="line">        		 <span class="string">@"test-data"</span>,</span><br><span class="line">        		 @&#123;</span><br><span class="line">            	             <span class="string">@"nameChangedTime"</span> : <span class="string">@"2013-08"</span></span><br><span class="line">                         &#125;</span><br><span class="line">                  ]</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">@"other"</span> : @&#123;</span><br><span class="line">        <span class="string">@"bag"</span> : @&#123;</span><br><span class="line">            <span class="string">@"name"</span> : <span class="string">@"a red bag"</span>,</span><br><span class="line">            <span class="string">@"price"</span> : @<span class="number">100.7</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ❇️ JSON → Student</span></span><br><span class="line">Student *stu = [Student mj_objectWithKeyValues:dict];</span><br><span class="line"></span><br><span class="line"><span class="comment">// Printing</span></span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"ID=%@, desc=%@, oldName=%@, nowName=%@, nameChangedTime=%@"</span>,</span><br><span class="line">      stu.ID, stu.desc, stu.oldName, stu.nowName, stu.nameChangedTime);</span><br><span class="line"><span class="comment">// ID=20, desc=kids, oldName=kitty, nowName=lufy, nameChangedTime=2013-08</span></span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"bagName=%@, bagPrice=%f"</span>, stu.bag.name, stu.bag.price);</span><br><span class="line"><span class="comment">// bagName=a red bag, bagPrice=100.700000</span></span><br></pre></td></tr></table></figure>
<h3 id="JSON-array-→-model-array【将一个字典数组转成模型数组】"><a href="#JSON-array-→-model-array【将一个字典数组转成模型数组】" class="headerlink" title="JSON array → model array【将一个字典数组转成模型数组】"></a>JSON array → model array【将一个字典数组转成模型数组】</h3><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">NSArray</span> *dictArray = @[</span><br><span class="line">                         @&#123;</span><br><span class="line">                             <span class="string">@"name"</span> : <span class="string">@"Jack"</span>,</span><br><span class="line">                             <span class="string">@"icon"</span> : <span class="string">@"lufy.png"</span></span><br><span class="line">                         &#125;,</span><br><span class="line">                         @&#123;</span><br><span class="line">                             <span class="string">@"name"</span> : <span class="string">@"Rose"</span>,</span><br><span class="line">                             <span class="string">@"icon"</span> : <span class="string">@"nami.png"</span></span><br><span class="line">                         &#125;</span><br><span class="line">                     ];</span><br><span class="line"></span><br><span class="line"><span class="comment">// ❇️❇️ JSON array → User array</span></span><br><span class="line"><span class="built_in">NSArray</span> *userArray = [User mj_objectArrayWithKeyValuesArray:dictArray];</span><br><span class="line"></span><br><span class="line"><span class="comment">// Printing</span></span><br><span class="line"><span class="keyword">for</span> (User *user <span class="keyword">in</span> userArray) &#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"name=%@, icon=%@"</span>, user.name, user.icon);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// name=Jack, icon=lufy.png</span></span><br><span class="line"><span class="comment">// name=Rose, icon=nami.png</span></span><br></pre></td></tr></table></figure>
<h3 id="Model-→-JSON【将一个模型转成字典】"><a href="#Model-→-JSON【将一个模型转成字典】" class="headerlink" title="Model → JSON【将一个模型转成字典】"></a>Model → JSON【将一个模型转成字典】</h3><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// New model</span></span><br><span class="line">User *user = [[User alloc] init];</span><br><span class="line">user.name = <span class="string">@"Jack"</span>;</span><br><span class="line">user.icon = <span class="string">@"lufy.png"</span>;</span><br><span class="line"></span><br><span class="line">Status *status = [[Status alloc] init];</span><br><span class="line">status.user = user;</span><br><span class="line">status.text = <span class="string">@"Nice mood!"</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ❇️ Status → JSON</span></span><br><span class="line"><span class="built_in">NSDictionary</span> *statusDict = status.mj_keyValues;</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"%@"</span>, statusDict);</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> &#123;</span></span><br><span class="line"><span class="comment"> text = "Nice mood!";</span></span><br><span class="line"><span class="comment"> user =     &#123;</span></span><br><span class="line"><span class="comment"> icon = "lufy.png";</span></span><br><span class="line"><span class="comment"> name = Jack;</span></span><br><span class="line"><span class="comment"> &#125;;</span></span><br><span class="line"><span class="comment"> &#125;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// More complex situation</span></span><br><span class="line">Student *stu = [[Student alloc] init];</span><br><span class="line">stu.ID = <span class="string">@"123"</span>;</span><br><span class="line">stu.oldName = <span class="string">@"rose"</span>;</span><br><span class="line">stu.nowName = <span class="string">@"jack"</span>;</span><br><span class="line">stu.desc = <span class="string">@"handsome"</span>;</span><br><span class="line">stu.nameChangedTime = <span class="string">@"2018-09-08"</span>;</span><br><span class="line"></span><br><span class="line">Bag *bag = [[Bag alloc] init];</span><br><span class="line">bag.name = <span class="string">@"a red bag"</span>;</span><br><span class="line">bag.price = <span class="number">205</span>;</span><br><span class="line">stu.bag = bag;</span><br><span class="line"></span><br><span class="line"><span class="built_in">NSDictionary</span> *stuDict = stu.mj_keyValues;</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"%@"</span>, stuDict);</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">&#123;</span></span><br><span class="line"><span class="comment">    ID = 123;</span></span><br><span class="line"><span class="comment">    bag =     &#123;</span></span><br><span class="line"><span class="comment">        name = "\U5c0f\U4e66\U5305";</span></span><br><span class="line"><span class="comment">        price = 205;</span></span><br><span class="line"><span class="comment">    &#125;;</span></span><br><span class="line"><span class="comment">    desc = handsome;</span></span><br><span class="line"><span class="comment">    nameChangedTime = "2018-09-08";</span></span><br><span class="line"><span class="comment">    nowName = jack;</span></span><br><span class="line"><span class="comment">    oldName = rose;</span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment"> */</span></span><br></pre></td></tr></table></figure>
<h3 id="Model-array-→-JSON-array【将一个模型数组转成字典数组】"><a href="#Model-array-→-JSON-array【将一个模型数组转成字典数组】" class="headerlink" title="Model array → JSON array【将一个模型数组转成字典数组】"></a>Model array → JSON array【将一个模型数组转成字典数组】</h3><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// New model array</span></span><br><span class="line">User *user1 = [[User alloc] init];</span><br><span class="line">user1.name = <span class="string">@"Jack"</span>;</span><br><span class="line">user1.icon = <span class="string">@"lufy.png"</span>;</span><br><span class="line"></span><br><span class="line">User *user2 = [[User alloc] init];</span><br><span class="line">user2.name = <span class="string">@"Rose"</span>;</span><br><span class="line">user2.icon = <span class="string">@"nami.png"</span>;</span><br><span class="line"></span><br><span class="line"><span class="built_in">NSArray</span> *userArray = @[user1, user2];</span><br><span class="line"></span><br><span class="line"><span class="comment">// ❇️ Model array → JSON array</span></span><br><span class="line"><span class="built_in">NSArray</span> *dictArray = [User mj_keyValuesArrayWithObjectArray:userArray];</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"%@"</span>, dictArray);</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> (</span></span><br><span class="line"><span class="comment"> &#123;</span></span><br><span class="line"><span class="comment"> icon = "lufy.png";</span></span><br><span class="line"><span class="comment"> name = Jack;</span></span><br><span class="line"><span class="comment"> &#125;,</span></span><br><span class="line"><span class="comment"> &#123;</span></span><br><span class="line"><span class="comment"> icon = "nami.png";</span></span><br><span class="line"><span class="comment"> name = Rose;</span></span><br><span class="line"><span class="comment"> &#125;</span></span><br><span class="line"><span class="comment"> )</span></span><br><span class="line"><span class="comment"> */</span></span><br></pre></td></tr></table></figure>
<h3 id="Core-Data"><a href="#Core-Data" class="headerlink" title="Core Data"></a>Core Data</h3><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">NSDictionary</span> *dict = @&#123;</span><br><span class="line">                         <span class="string">@"name"</span> : <span class="string">@"Jack"</span>,</span><br><span class="line">                         <span class="string">@"icon"</span> : <span class="string">@"lufy.png"</span>,</span><br><span class="line">                         <span class="string">@"age"</span> : @<span class="number">20</span>,</span><br><span class="line">                         <span class="string">@"height"</span> : @<span class="number">1.55</span>,</span><br><span class="line">                         <span class="string">@"money"</span> : <span class="string">@"100.9"</span>,</span><br><span class="line">                         <span class="string">@"sex"</span> : @(SexFemale),</span><br><span class="line">                         <span class="string">@"gay"</span> : <span class="string">@"true"</span></span><br><span class="line">                     &#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ❇️ This demo just provide simple steps</span></span><br><span class="line"><span class="built_in">NSManagedObjectContext</span> *context = <span class="literal">nil</span>;</span><br><span class="line">User *user = [User mj_objectWithKeyValues:dict context:context];</span><br><span class="line"></span><br><span class="line">[context save:<span class="literal">nil</span>];</span><br></pre></td></tr></table></figure>
<h3 id="Coding"><a href="#Coding" class="headerlink" title="Coding"></a>Coding</h3><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"MJExtension.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">Bag</span></span></span><br><span class="line"><span class="comment">// NSCoding Implementation</span></span><br><span class="line">MJExtensionCodingImplementation</span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/***********************************************/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ❇️ what properties not to be coded</span></span><br><span class="line">[Bag mj_setupIgnoredCodingPropertyNames:^<span class="built_in">NSArray</span> *&#123;</span><br><span class="line">    <span class="keyword">return</span> @[<span class="string">@"name"</span>];</span><br><span class="line">&#125;];</span><br><span class="line"><span class="comment">// Equals: Bag.m implements +mj_ignoredCodingPropertyNames method.</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Create model</span></span><br><span class="line">Bag *bag = [[Bag alloc] init];</span><br><span class="line">bag.name = <span class="string">@"Red bag"</span>;</span><br><span class="line">bag.price = <span class="number">200.8</span>;</span><br><span class="line"></span><br><span class="line"><span class="built_in">NSString</span> *file = [<span class="built_in">NSHomeDirectory</span>() stringByAppendingPathComponent:<span class="string">@"Desktop/bag.data"</span>];</span><br><span class="line"><span class="comment">// Encoding</span></span><br><span class="line">[<span class="built_in">NSKeyedArchiver</span> archiveRootObject:bag toFile:file];</span><br><span class="line"></span><br><span class="line"><span class="comment">// Decoding</span></span><br><span class="line">Bag *decodedBag = [<span class="built_in">NSKeyedUnarchiver</span> unarchiveObjectWithFile:file];</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"name=%@, price=%f"</span>, decodedBag.name, decodedBag.price);</span><br><span class="line"><span class="comment">// name=(null), price=200.800000</span></span><br></pre></td></tr></table></figure>
<h3 id="Camel-→-underline【统一转换属性名（比如驼峰转下划线）】"><a href="#Camel-→-underline【统一转换属性名（比如驼峰转下划线）】" class="headerlink" title="Camel → underline【统一转换属性名（比如驼峰转下划线）】"></a>Camel → underline【统一转换属性名（比如驼峰转下划线）】</h3><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Dog</span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"MJExtension.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">Dog</span></span></span><br><span class="line">+ (<span class="built_in">NSString</span> *)mj_replacedKeyFromPropertyName121:(<span class="built_in">NSString</span> *)propertyName</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// nickName -&gt; nick_name</span></span><br><span class="line">    <span class="keyword">return</span> [propertyName mj_underlineFromCamel];</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// NSDictionary</span></span><br><span class="line"><span class="built_in">NSDictionary</span> *dict = @&#123;</span><br><span class="line">                       <span class="string">@"nick_name"</span> : <span class="string">@"旺财"</span>,</span><br><span class="line">                       <span class="string">@"sale_price"</span> : <span class="string">@"10.5"</span>,</span><br><span class="line">                       <span class="string">@"run_speed"</span> : <span class="string">@"100.9"</span></span><br><span class="line">                       &#125;;</span><br><span class="line"><span class="comment">// ❇️ NSDictionary -&gt; Dog</span></span><br><span class="line">Dog *dog = [Dog mj_objectWithKeyValues:dict];</span><br><span class="line"></span><br><span class="line"><span class="comment">// printing</span></span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"nickName=%@, scalePrice=%f runSpeed=%f"</span>, dog.nickName, dog.salePrice, dog.runSpeed);</span><br></pre></td></tr></table></figure>
<h3 id="NSString-→-NSDate-nil-→-””【过滤字典的值（比如字符串日期处理为NSDate、字符串nil处理为-””）】"><a href="#NSString-→-NSDate-nil-→-””【过滤字典的值（比如字符串日期处理为NSDate、字符串nil处理为-””）】" class="headerlink" title="NSString → NSDate, nil → @””【过滤字典的值（比如字符串日期处理为NSDate、字符串nil处理为@””）】"></a>NSString → NSDate, nil → @””【过滤字典的值（比如字符串日期处理为NSDate、字符串nil处理为@””）】</h3><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Book</span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"MJExtension.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">Book</span></span></span><br><span class="line">- (<span class="keyword">id</span>)mj_newValueFromOldValue:(<span class="keyword">id</span>)oldValue property:(MJProperty *)property</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> ([property.name isEqualToString:<span class="string">@"publisher"</span>]) &#123;</span><br><span class="line">        <span class="keyword">if</span> (oldValue == <span class="literal">nil</span>) <span class="keyword">return</span> <span class="string">@""</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (property.type.typeClass == [<span class="built_in">NSDate</span> <span class="keyword">class</span>]) &#123;</span><br><span class="line">        <span class="built_in">NSDateFormatter</span> *fmt = [[<span class="built_in">NSDateFormatter</span> alloc] init];</span><br><span class="line">        fmt.dateFormat = <span class="string">@"yyyy-MM-dd"</span>;</span><br><span class="line">        <span class="keyword">return</span> [fmt dateFromString:oldValue];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> oldValue;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// NSDictionary</span></span><br><span class="line"><span class="built_in">NSDictionary</span> *dict = @&#123;</span><br><span class="line">                       <span class="string">@"name"</span> : <span class="string">@"5分钟突破iOS开发"</span>,</span><br><span class="line">                       <span class="string">@"publishedTime"</span> : <span class="string">@"2011-09-10"</span></span><br><span class="line">                       &#125;;</span><br><span class="line"><span class="comment">// NSDictionary → Book</span></span><br><span class="line">Book *book = [Book mj_objectWithKeyValues:dict];</span><br><span class="line"></span><br><span class="line"><span class="comment">// printing</span></span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"name=%@, publisher=%@, publishedTime=%@"</span>, book.name, book.publisher, book.publishedTime);</span><br></pre></td></tr></table></figure>
<h3 id="More-use-cases【更多用法】"><a href="#More-use-cases【更多用法】" class="headerlink" title="More use cases【更多用法】"></a>More use cases【更多用法】</h3><ul>
<li>Please reference to <code>NSObject+MJKeyValue.h</code> and <code>NSObject+MJCoding.h</code></li>
</ul>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://andy0570.com/2017/06/07/《Effective Objective-C 2.0》1.熟悉 Objectice-C/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="独木舟的木">
      <meta itemprop="description" content="有时候阳光很好 有时候阳光很暗">
      <meta itemprop="image" content="https://ws1.sinaimg.cn/large/006tNc79gy1g22m14458rj30u014xu0x.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="独木舟的木">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2017/06/07/《Effective Objective-C 2.0》1.熟悉 Objectice-C/" class="post-title-link" itemprop="url">《Effective Objective-C 2.0》1.熟悉 Objectice-C</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2017-06-07 12:03:00" itemprop="dateCreated datePublished" datetime="2017-06-07T12:03:00+08:00">2017-06-07</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2019-04-18 00:44:20" itemprop="dateModified" datetime="2019-04-18T00:44:20+08:00">2019-04-18</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/《Effective-Objective-C-2-0》/" itemprop="url" rel="index"><span itemprop="name">《Effective Objective-C 2.0》</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          
            <span id="/2017/06/07/《Effective Objective-C 2.0》1.熟悉 Objectice-C/" class="leancloud_visitors" data-flag-title="《Effective Objective-C 2.0》1.熟悉 Objectice-C">
              <span class="post-meta-divider">|</span>
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              
                <span class="post-meta-item-text">阅读次数：</span>
              
                <span class="leancloud-visitors-count"></span>
            </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body han-init-context" itemprop="articleBody">

      
      

      
        
          <p><img src="http://upload-images.jianshu.io/upload_images/2648731-75376d7d3815cd54.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt></p>
          <!--noindex-->
          
            <div class="post-button text-center">
              <a class="btn" href="/2017/06/07/《Effective Objective-C 2.0》1.熟悉 Objectice-C/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          
          <!--/noindex-->
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://andy0570.com/2017/06/05/《Effective Objective-C 2.0》目录/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="独木舟的木">
      <meta itemprop="description" content="有时候阳光很好 有时候阳光很暗">
      <meta itemprop="image" content="https://ws1.sinaimg.cn/large/006tNc79gy1g22m14458rj30u014xu0x.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="独木舟的木">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2017/06/05/《Effective Objective-C 2.0》目录/" class="post-title-link" itemprop="url">《Effective Objective-C 2.0》目录</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2017-06-05 16:27:00" itemprop="dateCreated datePublished" datetime="2017-06-05T16:27:00+08:00">2017-06-05</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2019-04-18 00:42:52" itemprop="dateModified" datetime="2019-04-18T00:42:52+08:00">2019-04-18</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/《Effective-Objective-C-2-0》/" itemprop="url" rel="index"><span itemprop="name">《Effective Objective-C 2.0》</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          
            <span id="/2017/06/05/《Effective Objective-C 2.0》目录/" class="leancloud_visitors" data-flag-title="《Effective Objective-C 2.0》目录">
              <span class="post-meta-divider">|</span>
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              
                <span class="post-meta-item-text">阅读次数：</span>
              
                <span class="leancloud-visitors-count"></span>
            </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body han-init-context" itemprop="articleBody">

      
      

      
        
          
            <a id="more"></a>
<h2 id="《Effective-Objective-C-2-0-编写高质量iOS与OS-X代码的52个有效方法-》"><a href="#《Effective-Objective-C-2-0-编写高质量iOS与OS-X代码的52个有效方法-》" class="headerlink" title="《Effective Objective-C 2.0  编写高质量iOS与OS X代码的52个有效方法 》"></a>《Effective Objective-C 2.0  编写高质量iOS与OS X代码的52个有效方法 》</h2><p><a href="https://book.douban.com/subject/25829244/" target="_blank" rel="noopener">🔗 书本链接</a></p>
<h3 id="一、熟悉-Objectice-C"><a href="#一、熟悉-Objectice-C" class="headerlink" title="一、熟悉 Objectice-C"></a><a href="https://www.jianshu.com/p/9429036dfaf7" target="_blank" rel="noopener">一、熟悉 Objectice-C</a></h3><p><img src="http://upload-images.jianshu.io/upload_images/2648731-75376d7d3815cd54.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt></p>
<h3 id="二、对象、消息、运行期"><a href="#二、对象、消息、运行期" class="headerlink" title="二、对象、消息、运行期"></a><a href="https://www.jianshu.com/p/4b86fdd1b276" target="_blank" rel="noopener">二、对象、消息、运行期</a></h3><p><img src="http://upload-images.jianshu.io/upload_images/2648731-30062a72b4270bc7.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt></p>
<h3 id="三、接口与-API-设计"><a href="#三、接口与-API-设计" class="headerlink" title="三、接口与 API 设计"></a><a href="https://www.jianshu.com/p/8cac3aa0dd18" target="_blank" rel="noopener">三、接口与 API 设计</a></h3><p><img src="http://upload-images.jianshu.io/upload_images/2648731-b51b9bc68621d04e.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt></p>
<h3 id="四、协议与分类"><a href="#四、协议与分类" class="headerlink" title="四、协议与分类"></a><a href="https://www.jianshu.com/p/45bcac5402ce" target="_blank" rel="noopener">四、协议与分类</a></h3><p><img src="http://upload-images.jianshu.io/upload_images/2648731-6096cbfd905b1eb0.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt></p>
<h3 id="五、内存管理"><a href="#五、内存管理" class="headerlink" title="五、内存管理"></a><a href="https://www.jianshu.com/p/a393c63cf761" target="_blank" rel="noopener">五、内存管理</a></h3><p><img src="http://upload-images.jianshu.io/upload_images/2648731-bc415805a22122ac.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt></p>
<h3 id="六、块与大中枢派发"><a href="#六、块与大中枢派发" class="headerlink" title="六、块与大中枢派发"></a><a href="https://www.jianshu.com/p/67492063fd49" target="_blank" rel="noopener">六、块与大中枢派发</a></h3><p><img src="http://upload-images.jianshu.io/upload_images/2648731-87bda0c1063653a9.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt></p>
<h3 id="七、系统框架"><a href="#七、系统框架" class="headerlink" title="七、系统框架"></a><a href="https://www.jianshu.com/p/e74f6c771205" target="_blank" rel="noopener">七、系统框架</a></h3><p><img src="http://upload-images.jianshu.io/upload_images/2648731-7dcb0ad568b4fb8b.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt></p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://andy0570.com/2017/06/05/YYModel——模型转换框架/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="独木舟的木">
      <meta itemprop="description" content="有时候阳光很好 有时候阳光很暗">
      <meta itemprop="image" content="https://ws1.sinaimg.cn/large/006tNc79gy1g22m14458rj30u014xu0x.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="独木舟的木">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2017/06/05/YYModel——模型转换框架/" class="post-title-link" itemprop="url">YYModel——模型转换框架</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2017-06-05 15:21:00" itemprop="dateCreated datePublished" datetime="2017-06-05T15:21:00+08:00">2017-06-05</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2019-04-17 01:33:54" itemprop="dateModified" datetime="2019-04-17T01:33:54+08:00">2019-04-17</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/iOS-开源框架/" itemprop="url" rel="index"><span itemprop="name">iOS 开源框架</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          
            <span id="/2017/06/05/YYModel——模型转换框架/" class="leancloud_visitors" data-flag-title="YYModel——模型转换框架">
              <span class="post-meta-divider">|</span>
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              
                <span class="post-meta-item-text">阅读次数：</span>
              
                <span class="leancloud-visitors-count"></span>
            </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body han-init-context" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>以下内容来源于官方源码、 README 文档、测试 Demo或个人使用总结 ！</p>
</blockquote>
<h1 id="YYModel"><a href="#YYModel" class="headerlink" title="YYModel"></a>YYModel</h1><p><a href="http://cocoadocs.org/docsets/YYModel/1.0.4/" target="_blank" rel="noopener"><strong>查看在线文档</strong></a></p>
<p>高性能 iOS/OSX 模型转换框架。<br>(该项目是 <a href="https://github.com/ibireme/YYKit" target="_blank" rel="noopener">YYKit</a> 组件之一)</p>
<h1 id="性能"><a href="#性能" class="headerlink" title="性能"></a>性能</h1><p>处理 GithubUser 数据 10000 次耗时统计 (iPhone 6):</p>
<p><img src="http://upload-images.jianshu.io/upload_images/2648731-86bf06b3b6e4064b.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt></p>
<p>更多测试代码和用例见 <code>Benchmark/ModelBenchmark.xcodeproj</code>。</p>
<h1 id="特性"><a href="#特性" class="headerlink" title="特性"></a>特性</h1><ul>
<li><strong>高性能</strong>: 模型转换性能接近手写解析代码。</li>
<li><strong>自动类型转换</strong>: 对象类型可以自动转换，详情见下方表格。</li>
<li><strong>类型安全</strong>: 转换过程中，所有的数据类型都会被检测一遍，以保证类型安全，避免崩溃问题。</li>
<li><strong>无侵入性</strong>: 模型无需继承自其他基类。</li>
<li><strong>轻量</strong>: 该框架只有 5 个文件 (包括.h文件)。</li>
<li><strong>文档和单元测试</strong>: 文档覆盖率100%, 代码覆盖率99.6%。</li>
</ul>
<h1 id="使用方法"><a href="#使用方法" class="headerlink" title="使用方法"></a>使用方法</h1><p>###简单的 Model 与 JSON 相互转换</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">// JSON:</span><br><span class="line">&#123;</span><br><span class="line">    &quot;uid&quot;:123456,</span><br><span class="line">    &quot;name&quot;:&quot;Harry&quot;,</span><br><span class="line">    &quot;created&quot;:&quot;1965-07-31T00:00:00+0000&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// Model:</span><br><span class="line">@interface User : NSObject</span><br><span class="line">@property UInt64 uid;</span><br><span class="line">@property NSString *name;</span><br><span class="line">@property NSDate *created;</span><br><span class="line">@end</span><br><span class="line">@implementation User</span><br><span class="line">@end</span><br><span class="line"></span><br><span class="line">// ❇️ 将 JSON (NSData,NSString,NSDictionary) 转换为 Model:</span><br><span class="line">User *user = [User yy_modelWithJSON:json];</span><br><span class="line"></span><br><span class="line">// ❇️ 将 Model 转换为 JSON 对象:</span><br><span class="line">NSDictionary *json = [user yy_modelToJSONObject];</span><br></pre></td></tr></table></figure>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1️⃣ JSON → Model</span></span><br><span class="line">+ (<span class="keyword">nullable</span> <span class="keyword">instancetype</span>)yy_modelWithJSON:(<span class="keyword">id</span>)json;</span><br><span class="line"><span class="comment">//    NSDictionary → Model</span></span><br><span class="line">+ (<span class="keyword">nullable</span> <span class="keyword">instancetype</span>)yy_modelWithDictionary:(<span class="built_in">NSDictionary</span> *)dictionary;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2️⃣ 是否使用 JSON 对象设置接收者的属性。</span></span><br><span class="line">- (<span class="built_in">BOOL</span>)yy_modelSetWithJSON:(<span class="keyword">id</span>)json;</span><br><span class="line"><span class="comment">//  是否使用 NSDictionary 对象设置接收者的属性。</span></span><br><span class="line">- (<span class="built_in">BOOL</span>)yy_modelSetWithDictionary:(<span class="built_in">NSDictionary</span> *)dic;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3️⃣  Model → JSON 对象:</span></span><br><span class="line">- (<span class="keyword">nullable</span> <span class="keyword">id</span>)yy_modelToJSONObject;</span><br><span class="line"><span class="comment">//     Model → JSONData:</span></span><br><span class="line">- (<span class="keyword">nullable</span> <span class="built_in">NSData</span> *)yy_modelToJSONData;</span><br><span class="line"><span class="comment">//     Model → JSONString:</span></span><br><span class="line">- (<span class="keyword">nullable</span> <span class="built_in">NSString</span> *)yy_modelToJSONString;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>⚠️</p>
<p><del>实测 Bug：Model 中的  <code>@property</code>  属性不可以声明为 <code>readonly</code>。</del> （截止2017-06-05 ）</p>
<p>更新 （2017-10-25）<br>经过与源码作者沟通后了解到：<br>在 .h 文件中<code>@property</code> 声明为 <code>readonly</code>后，需要在 .m 文件中的 extension 中重新将属性声明为 <code>readwrite</code>。<br>这也是《Effective Objective-C 2.0》书中第18条（尽量使用不可变对象）所推崇的做法。</p>
</blockquote>
<p>当 JSON/Dictionary 中的对象类型与 Model 属性不一致时，<strong>YYModel</strong> 将会进行如下自动转换。自动转换不支持的值将会被忽略，以避免各种潜在的崩溃问题。</p>
<table>
<thead>
<tr>
<th style="text-align:center">JSON/Dictionary</th>
<th style="text-align:center">Model</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">NSString</td>
<td style="text-align:center">NSNumber,NSURL,SEL,Class</td>
</tr>
<tr>
<td style="text-align:center">NSNumber</td>
<td style="text-align:center">NSString</td>
</tr>
<tr>
<td style="text-align:center">NSString/NSNumber</td>
<td style="text-align:center">基础类型 (BOOL,int,float,NSUInteger,UInt64,…)  <br> NaN 和 Inf 会被忽略</td>
</tr>
<tr>
<td style="text-align:center">NSString</td>
<td style="text-align:center">NSDate 以下列格式解析: <br> yyyy-MM-dd <br> yyyy-MM-dd HH:mm:ss<br>yyyy-MM-dd’T’HH:mm:ss<br>yyyy-MM-dd’T’HH:mm:ssZ<br>EEE MMM dd HH:mm:ss Z yyyy</td>
</tr>
<tr>
<td style="text-align:center">NSDate</td>
<td style="text-align:center">NSString 格式化为 ISO8601:<br>  “YYYY-MM-dd’T’HH:mm:ssZ”</td>
</tr>
<tr>
<td style="text-align:center">NSValue</td>
<td style="text-align:center">struct (CGRect,CGSize,…)</td>
</tr>
<tr>
<td style="text-align:center">NSNull</td>
<td style="text-align:center">nil,0</td>
</tr>
<tr>
<td style="text-align:center">“no”,”false”,…</td>
<td style="text-align:center">@(NO),0</td>
</tr>
<tr>
<td style="text-align:center">“yes”,”true”,…</td>
<td style="text-align:center">@(YES),1</td>
</tr>
</tbody>
</table>
<p>###Model 属性名和 JSON 中的 Key 不相同</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">// JSON:</span><br><span class="line">&#123;</span><br><span class="line">    &quot;n&quot;:&quot;Harry Pottery&quot;,</span><br><span class="line">    &quot;p&quot;: 256,</span><br><span class="line">    &quot;ext&quot; : &#123;</span><br><span class="line">        &quot;desc&quot; : &quot;A book written by J.K.Rowing.&quot;</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;ID&quot; : 100010</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// Model:</span><br><span class="line">@interface Book : NSObject</span><br><span class="line">@property NSString *name;</span><br><span class="line">@property NSInteger page;</span><br><span class="line">@property NSString *desc;</span><br><span class="line">@property NSString *bookID;</span><br><span class="line">@end</span><br><span class="line">@implementation Book</span><br><span class="line"></span><br><span class="line">// ❇️ 返回一个 Dict，将 Model 属性名对映射到 JSON 的 Key。</span><br><span class="line">+ (NSDictionary *)modelCustomPropertyMapper &#123;</span><br><span class="line">    return @&#123;@&quot;name&quot; : @&quot;n&quot;,</span><br><span class="line">             @&quot;page&quot; : @&quot;p&quot;,</span><br><span class="line">             @&quot;desc&quot; : @&quot;ext.desc&quot;,</span><br><span class="line">             @&quot;bookID&quot; : @[@&quot;id&quot;,@&quot;ID&quot;,@&quot;book_id&quot;]&#125;;</span><br><span class="line">&#125;</span><br><span class="line">@end</span><br></pre></td></tr></table></figure>
<p>你可以把一个或一组 json key (key path) 映射到一个或多个属性。如果一个属性没有映射关系，那默认会使用相同属性名作为映射。</p>
<ul>
<li>在 json → model 的过程中：如果一个属性对应了多个 json key，那么转换过程会按顺序查找，并使用第一个不为空的值。</li>
</ul>
<ul>
<li>在 model → json 的过程中：如果一个属性对应了多个 json key (key path)，那么转换过程仅会处理第一个 json key (key path)；如果多个属性对应了同一个 json key，则转换过过程会使用其中任意一个不为空的值。</li>
</ul>
<p>###Model 包含其他 Model</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">// JSON</span><br><span class="line">&#123;</span><br><span class="line">    &quot;author&quot;:&#123;</span><br><span class="line">        &quot;name&quot;:&quot;J.K.Rowling&quot;,</span><br><span class="line">        &quot;birthday&quot;:&quot;1965-07-31T00:00:00+0000&quot;</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;name&quot;:&quot;Harry Potter&quot;,</span><br><span class="line">    &quot;pages&quot;:256</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// Model: 什么都不用做，转换会自动完成</span><br><span class="line">@interface Author : NSObject</span><br><span class="line">@property NSString *name;</span><br><span class="line">@property NSDate *birthday;</span><br><span class="line">@end</span><br><span class="line">@implementation Author</span><br><span class="line">@end</span><br><span class="line"></span><br><span class="line">@interface Book : NSObject</span><br><span class="line">@property NSString *name;</span><br><span class="line">@property NSUInteger pages;</span><br><span class="line">@property Author *author; //Book 包含 Author 属性</span><br><span class="line">@end</span><br><span class="line">@implementation Book</span><br><span class="line">@end</span><br></pre></td></tr></table></figure>
<p>​    </p>
<p>###容器类属性</p>
<blockquote>
<p>含义：<br>模型类的属性是 Collection 类（NSArray、NSDictionary、NSSet等）,Collection 类中的项是其他模型</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">#import &lt;Foundation/Foundation.h&gt;</span><br><span class="line">@class Shadow, Border, Attachment;</span><br><span class="line"></span><br><span class="line">@interface Attributes</span><br><span class="line">@property NSString *name;</span><br><span class="line">@property NSArray *shadows; //Array&lt;Shadow&gt;</span><br><span class="line">@property NSSet *borders;   //Set&lt;Border&gt;</span><br><span class="line">@property NSMutableDictionary *attachments; //Dict&lt;NSString,Attachment&gt;</span><br><span class="line">@end</span><br><span class="line"></span><br><span class="line">@implementation Attributes</span><br><span class="line">// ❇️ 返回容器类中的所需要存放的数据类型 (以 Class 或 Class Name 的形式)。</span><br><span class="line">+ (NSDictionary *)modelContainerPropertyGenericClass &#123;</span><br><span class="line">    return @&#123;@&quot;shadows&quot; : [Shadow class],</span><br><span class="line">             @&quot;borders&quot; : Border.class,</span><br><span class="line">             @&quot;attachments&quot; : @&quot;Attachment&quot; &#125;;</span><br><span class="line">&#125;</span><br><span class="line">@end</span><br></pre></td></tr></table></figure>
<p>###黑名单与白名单</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">@interface User</span><br><span class="line">@property NSString *name;</span><br><span class="line">@property NSUInteger age;</span><br><span class="line">@end</span><br><span class="line"></span><br><span class="line">@implementation Attributes</span><br><span class="line">// ❇️ 如果实现了该方法，则处理过程中会忽略该列表内的所有属性</span><br><span class="line">+ (NSArray *)modelPropertyBlacklist &#123;</span><br><span class="line">    return @[@&quot;test1&quot;, @&quot;test2&quot;];</span><br><span class="line">&#125;</span><br><span class="line">// ❇️ 如果实现了该方法，则处理过程中不会处理该列表外的属性。</span><br><span class="line">+ (NSArray *)modelPropertyWhitelist &#123;</span><br><span class="line">    return @[@&quot;name&quot;];</span><br><span class="line">&#125;</span><br><span class="line">@end</span><br></pre></td></tr></table></figure>
<p>###数据校验与自定义转换</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">// JSON:</span><br><span class="line">&#123;</span><br><span class="line">	&quot;name&quot;:&quot;Harry&quot;,</span><br><span class="line">	&quot;timestamp&quot; : 1445534567</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// Model:</span><br><span class="line">@interface User</span><br><span class="line">@property NSString *name;</span><br><span class="line">@property NSDate *createdAt;</span><br><span class="line">@end</span><br><span class="line"></span><br><span class="line">@implementation User</span><br><span class="line">// ❇️ 当 JSON 转为 Model 完成后，该方法会被调用。</span><br><span class="line">// 你可以在这里对数据进行校验，如果校验不通过，可以返回 NO，则该 Model 会被忽略。</span><br><span class="line">// 你也可以在这里做一些自动转换不能完成的工作。</span><br><span class="line">- (BOOL)modelCustomTransformFromDictionary:(NSDictionary *)dic &#123;</span><br><span class="line">    NSNumber *timestamp = dic[@&quot;timestamp&quot;];</span><br><span class="line">    if (![timestamp isKindOfClass:[NSNumber class]]) return NO;</span><br><span class="line">    _createdAt = [NSDate dateWithTimeIntervalSince1970:timestamp.floatValue];</span><br><span class="line">    return YES;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// ❇️ 当 Model 转为 JSON 完成后，该方法会被调用。</span><br><span class="line">// 你可以在这里对数据进行校验，如果校验不通过，可以返回 NO，则该 Model 会被忽略。</span><br><span class="line">// 你也可以在这里做一些自动转换不能完成的工作。</span><br><span class="line">- (BOOL)modelCustomTransformToDictionary:(NSMutableDictionary *)dic &#123;</span><br><span class="line">    if (!_createdAt) return NO;</span><br><span class="line">    dic[@&quot;timestamp&quot;] = @(n.timeIntervalSince1970);</span><br><span class="line">    return YES;</span><br><span class="line">&#125;</span><br><span class="line">@end</span><br></pre></td></tr></table></figure>
<p>###Coding/Copying/hash/equal/description</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">@interface YYShadow :NSObject &lt;NSCoding, NSCopying&gt;</span><br><span class="line">@property (nonatomic, copy) NSString *name;</span><br><span class="line">@property (nonatomic, assign) CGSize size;</span><br><span class="line">@end</span><br><span class="line"></span><br><span class="line">@implementation YYShadow</span><br><span class="line">// 直接添加以下代码即可自动完成</span><br><span class="line">- (void)encodeWithCoder:(NSCoder *)aCoder &#123; [self yy_modelEncodeWithCoder:aCoder]; &#125;</span><br><span class="line">- (id)initWithCoder:(NSCoder *)aDecoder &#123; self = [super init]; return [self yy_modelInitWithCoder:aDecoder]; &#125;</span><br><span class="line">- (id)copyWithZone:(NSZone *)zone &#123; return [self yy_modelCopy]; &#125;</span><br><span class="line">- (NSUInteger)hash &#123; return [self yy_modelHash]; &#125;</span><br><span class="line">- (BOOL)isEqual:(id)object &#123; return [self yy_modelIsEqual:object]; &#125;</span><br><span class="line">- (NSString *)description &#123; return [self yy_modelDescription]; &#125;</span><br><span class="line">@end</span><br></pre></td></tr></table></figure>
<h3 id="JSON-Array-→-Model-Array【将字典数组转成模型数组】"><a href="#JSON-Array-→-Model-Array【将字典数组转成模型数组】" class="headerlink" title="JSON Array → Model Array【将字典数组转成模型数组】"></a>JSON Array → Model Array【将字典数组转成模型数组】</h3><p><a href="https://github.com/CoderMJLee/MJExtension" target="_blank" rel="noopener">MJExtension</a> 框架中有一个方法 <code>mj_objectArrayWithKeyValuesArray:</code> 可以将一个字典数组转换成模型数组，即 NSArray 中的项是模型指针，查看 <a href="https://github.com/ibireme/YYModel" target="_blank" rel="noopener">YYModel</a> 源码，发现也有相同的方法：<code>+ (NSArray *)modelArrayWithClass:(Class)cls json:(id)json;</code></p>
<p>示例：<br><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 读取property list数据</span></span><br><span class="line"><span class="built_in">NSString</span> *path = [[<span class="built_in">NSBundle</span> mainBundle] pathForResource:<span class="string">@"navigationButton"</span></span><br><span class="line">                                                 ofType:<span class="string">@"plist"</span>];</span><br><span class="line"><span class="built_in">NSArray</span> *rootArray = [<span class="built_in">NSArray</span> arrayWithContentsOfFile:path];</span><br><span class="line"></span><br><span class="line"><span class="comment">// MJExtension:</span></span><br><span class="line"><span class="built_in">NSArray</span> *squareModelArray =</span><br><span class="line">    [Model mj_objectArrayWithKeyValuesArray:rootArray];</span><br><span class="line"><span class="comment">// YYModel:</span></span><br><span class="line"><span class="built_in">NSArray</span> *squareModelArray = [<span class="built_in">NSArray</span> modelArrayWithClass:[Model <span class="keyword">class</span>]</span><br><span class="line">                                                    json:rootArray];</span><br></pre></td></tr></table></figure></p>
<h3 id="JSON-Dictioanry-→-Model-Dictionary【-JSON-字典转成-字典模型】"><a href="#JSON-Dictioanry-→-Model-Dictionary【-JSON-字典转成-字典模型】" class="headerlink" title="JSON Dictioanry → Model Dictionary【 JSON 字典转成 字典模型】"></a>JSON Dictioanry → Model Dictionary【 JSON 字典转成 字典模型】</h3><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> 从 JSON 对象中创建并返回 NSDictionary 模型.</span><br><span class="line"> This method <span class="keyword">is</span> thread-safe.</span><br><span class="line"> </span><br><span class="line"> @param cls  The value instance's <span class="built_in">class</span> <span class="keyword">in</span> dictionary.</span><br><span class="line"> @param json  A json dictionary <span class="keyword">of</span> `NSDictionary`, `NSString` <span class="keyword">or</span> `NSData`.</span><br><span class="line">              Example: &#123;<span class="string">"user1"</span>:&#123;<span class="string">"name"</span>,<span class="string">"Mary"</span>&#125;, <span class="string">"user2"</span>: &#123;<span class="built_in">name</span>:<span class="string">"Joe"</span>&#125;&#125;</span><br><span class="line"> </span><br><span class="line"> @<span class="literal">return</span> A dictionary, <span class="keyword">or</span> nil <span class="keyword">if</span> an <span class="keyword">error</span> occurs.</span><br><span class="line"> */</span><br><span class="line">+ (nullable NSDictionary *)yy_modelDictionaryWithClass:(Class)cls json:(<span class="built_in">id</span>)json;</span><br></pre></td></tr></table></figure>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://andy0570.com/2017/06/02/AFViewShaker——为视图添加抖动效果/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="独木舟的木">
      <meta itemprop="description" content="有时候阳光很好 有时候阳光很暗">
      <meta itemprop="image" content="https://ws1.sinaimg.cn/large/006tNc79gy1g22m14458rj30u014xu0x.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="独木舟的木">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2017/06/02/AFViewShaker——为视图添加抖动效果/" class="post-title-link" itemprop="url">AFViewShaker——为视图添加抖动效果</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2017-06-02 14:49:00" itemprop="dateCreated datePublished" datetime="2017-06-02T14:49:00+08:00">2017-06-02</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2019-04-18 01:07:08" itemprop="dateModified" datetime="2019-04-18T01:07:08+08:00">2019-04-18</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/iOS-开源框架/" itemprop="url" rel="index"><span itemprop="name">iOS 开源框架</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          
            <span id="/2017/06/02/AFViewShaker——为视图添加抖动效果/" class="leancloud_visitors" data-flag-title="AFViewShaker——为视图添加抖动效果">
              <span class="post-meta-divider">|</span>
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              
                <span class="post-meta-item-text">阅读次数：</span>
              
                <span class="leancloud-visitors-count"></span>
            </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body han-init-context" itemprop="articleBody">

      
      

      
        
          
            <a id="more"></a>
<ul>
<li>GitHub源码:<a href="https://github.com/ArtFeel/AFViewShaker" target="_blank" rel="noopener">AFViewShaker</a></li>
<li>star:1100+</li>
</ul>
<blockquote>
<pre><code>⭐️⭐️⭐️ 
</code></pre><p>以下内容来源于官方源码、 README 文档、测试 Demo或个人使用总结 ！</p>
</blockquote>
<h1 id="AFViewShaker"><a href="#AFViewShaker" class="headerlink" title="AFViewShaker"></a>AFViewShaker</h1><p><a href="http://cocoapods.org" target="_blank" rel="noopener">[图片上传失败…(image-a1b1a5-1510132021807)]</a><br><a href="https://github.com/Carthage/Carthage" target="_blank" rel="noopener">[图片上传失败…(image-914a1b-1510132021807)]</a><br><a href>[图片上传失败…(image-3b1e4c-1510132021807)]</a></p>
<h2 id="About"><a href="#About" class="headerlink" title="About"></a>About</h2><p><strong>AFViewShaker</strong> 实现了简单的 <strong>UIView</strong> 砖块抖动效果。</p>
<p><img src="http://upload-images.jianshu.io/upload_images/2648731-2c1cdf7f5fc952df.gif?imageMogr2/auto-orient/strip" alt></p>
<h2 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h2><h5 id="为一个视图创建抖动效果"><a href="#为一个视图创建抖动效果" class="headerlink" title="为一个视图创建抖动效果"></a>为一个视图创建抖动效果</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">AFViewShaker * viewShaker = [[AFViewShaker alloc] initWithView:self.formView];</span><br></pre></td></tr></table></figure>
<h5 id="为多个视图创建抖动效果"><a href="#为多个视图创建抖动效果" class="headerlink" title="为多个视图创建抖动效果"></a>为多个视图创建抖动效果</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">NSArray * allFields = @[self.emailField, self.passwordField];</span><br><span class="line">AFViewShaker * viewShaker = [[AFViewShaker alloc] initWithViewsArray:allFields];</span><br></pre></td></tr></table></figure>
<h5 id="使用默认参数抖动"><a href="#使用默认参数抖动" class="headerlink" title="使用默认参数抖动"></a>使用默认参数抖动</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">// 抖动 AFViewShaker 实例中的所有视图</span><br><span class="line">[self.viewShaker shake];</span><br><span class="line"></span><br><span class="line">// 抖动指定的视图</span><br><span class="line">[[[AFViewShaker alloc] initWithView:self.allButtons[0]] shake];</span><br></pre></td></tr></table></figure>
<h5 id="使用附带参数配置抖动"><a href="#使用附带参数配置抖动" class="headerlink" title="使用附带参数配置抖动"></a>使用附带参数配置抖动</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[self.viewShaker shakeWithDuration:0.6 completion:^&#123;</span><br><span class="line">    NSLog(@&quot;Hello World!&quot;);</span><br><span class="line">&#125;];</span><br></pre></td></tr></table></figure>
<h2 id="源码"><a href="#源码" class="headerlink" title="源码"></a>源码</h2><h5 id="AFViewShaker-h"><a href="#AFViewShaker-h" class="headerlink" title="AFViewShaker.h"></a><strong>AFViewShaker.h</strong></h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">// 2个初始化方法</span><br><span class="line">- (instancetype)initWithView:(UIView *)view;</span><br><span class="line">- (instancetype)initWithViewsArray:(NSArray *)viewsArray;</span><br><span class="line"></span><br><span class="line">// 2个抖动方法</span><br><span class="line">- (void)shake;</span><br><span class="line">- (void)shakeWithDuration:(NSTimeInterval)duration completion:(void (^)())completion;</span><br></pre></td></tr></table></figure>
<h5 id="AFViewShaker-m"><a href="#AFViewShaker-m" class="headerlink" title="AFViewShaker.m"></a>AFViewShaker.m</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br></pre></td><td class="code"><pre><span class="line">//</span><br><span class="line">//  AFViewShaker</span><br><span class="line">//  AFViewShaker</span><br><span class="line">//</span><br><span class="line">//  Created by Philip Vasilchenko on 03.12.13.</span><br><span class="line">//  Copyright (c) 2014 okolodev. All rights reserved.</span><br><span class="line">//</span><br><span class="line"></span><br><span class="line">#import &quot;AFViewShaker.h&quot;</span><br><span class="line"></span><br><span class="line">// 默认延时</span><br><span class="line">static NSTimeInterval const kAFViewShakerDefaultDuration = 0.5;</span><br><span class="line">static NSString * const kAFViewShakerAnimationKey = @&quot;kAFViewShakerAnimationKey&quot;;</span><br><span class="line"></span><br><span class="line">#if __IPHONE_OS_VERSION_MAX_ALLOWED &lt; 100000</span><br><span class="line">// CAAnimationDelegate is not available before iOS 10 SDK</span><br><span class="line">@interface AFViewShaker ()</span><br><span class="line">#else</span><br><span class="line">@interface AFViewShaker () &lt;CAAnimationDelegate&gt;</span><br><span class="line">#endif</span><br><span class="line"></span><br><span class="line">/** 包含视图的数组 */</span><br><span class="line">@property (nonatomic, strong) NSArray * views;</span><br><span class="line">/** 完成动画 */</span><br><span class="line">@property (nonatomic, assign) NSUInteger completedAnimations;</span><br><span class="line">/** 完成后调用 Block 对象 */</span><br><span class="line">@property (nonatomic, copy) void (^completionBlock)();</span><br><span class="line"></span><br><span class="line">@end</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">@implementation AFViewShaker</span><br><span class="line"></span><br><span class="line">- (instancetype)initWithView:(UIView *)view &#123;</span><br><span class="line">    // 这里只是调用了指定初始化方法，往数组里扔了一个 View</span><br><span class="line">    return [self initWithViewsArray:@[view]];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 指定初始化方法</span><br><span class="line">- (instancetype)initWithViewsArray:(NSArray *)viewsArray &#123;</span><br><span class="line">    self = [super init];</span><br><span class="line">    if (self) &#123;</span><br><span class="line">        self.views = viewsArray;</span><br><span class="line">    &#125;</span><br><span class="line">    return self;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#pragma mark - Public methods</span><br><span class="line"></span><br><span class="line">- (void)shake &#123;</span><br><span class="line">    // 这里调用了下面的默认指定动画方法，传入的延时是全局静态变量</span><br><span class="line">    [self shakeWithDuration:kAFViewShakerDefaultDuration completion:nil];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 指定动画方法</span><br><span class="line">- (void)shakeWithDuration:(NSTimeInterval)duration completion:(void (^)())completion &#123;</span><br><span class="line">    self.completionBlock = completion;</span><br><span class="line">    for (UIView * view in self.views) &#123;</span><br><span class="line">        // 遍历视图，为每个视图添加动画</span><br><span class="line">        [self addShakeAnimationForView:view withDuration:duration];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#pragma mark - Shake Animation</span><br><span class="line"></span><br><span class="line">- (void)addShakeAnimationForView:(UIView *)view withDuration:(NSTimeInterval)duration &#123;</span><br><span class="line">    CAKeyframeAnimation * animation = [CAKeyframeAnimation animationWithKeyPath:@&quot;transform.translation.x&quot;];</span><br><span class="line">    CGFloat currentTx = view.transform.tx;</span><br><span class="line">    </span><br><span class="line">    animation.delegate = self;</span><br><span class="line">    animation.duration = duration;</span><br><span class="line">    // 偏移量</span><br><span class="line">    animation.values = @[@(currentTx),</span><br><span class="line">                         @(currentTx + 10),</span><br><span class="line">                         @(currentTx - 8),</span><br><span class="line">                         @(currentTx + 8),</span><br><span class="line">                         @(currentTx - 5),</span><br><span class="line">                         @(currentTx + 5),</span><br><span class="line">                         @(currentTx)];</span><br><span class="line">    // 动画时间</span><br><span class="line">    animation.keyTimes = @[@(0), @(0.225), @(0.425), @(0.6), @(0.75), @(0.875), @(1)];</span><br><span class="line">    animation.timingFunction = [CAMediaTimingFunction functionWithName:kCAMediaTimingFunctionEaseInEaseOut];</span><br><span class="line">    [view.layer addAnimation:animation forKey:kAFViewShakerAnimationKey];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#pragma mark - CAAnimation Delegate</span><br><span class="line"></span><br><span class="line">- (void)animationDidStop:(CAAnimation *)animation finished:(BOOL)flag &#123;</span><br><span class="line">    self.completedAnimations += 1;</span><br><span class="line">    if (self.completedAnimations &gt;= self.views.count) &#123;</span><br><span class="line">        self.completedAnimations = 0;</span><br><span class="line">        if (self.completionBlock) &#123;</span><br><span class="line">            // 遍历视图，当所有视图的动画完成以后就调用 Block 对象</span><br><span class="line">            self.completionBlock();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">@end</span><br></pre></td></tr></table></figure>
<ul>
<li>配合 MBProgressHUD 使用：<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//--------------------------------</span></span><br><span class="line"><span class="comment">// .h</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> 输入文本框抖动效果</span></span><br><span class="line"><span class="comment"> </span></span><br><span class="line"><span class="comment"> <span class="doctag">@param</span> view 需要抖动的文本框视图</span></span><br><span class="line"><span class="comment"> <span class="doctag">@param</span> text 抖动结束后显示的 HUD 提示</span></span><br><span class="line"><span class="comment"> <span class="doctag">@param</span> HUDView 呈现 HUD 的视图</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">- (<span class="keyword">void</span>) <span class="string">shakeWithView:</span>(UIView *)view</span><br><span class="line"><span class="symbol">               HUDText:</span>(NSString *)text</span><br><span class="line"><span class="symbol">             addToView:</span>(UIView *)HUDView;</span><br><span class="line"></span><br><span class="line"><span class="comment">//--------------------------------</span></span><br><span class="line"><span class="comment">// .m</span></span><br><span class="line">- (<span class="keyword">void</span>) <span class="string">shakeWithView:</span>(UIView *)view</span><br><span class="line"><span class="symbol">               HUDText:</span>(NSString *)text</span><br><span class="line"><span class="symbol">             addToView:</span>(UIView *)HUDView &#123;</span><br><span class="line">    AFViewShaker *viewShaker = [[AFViewShaker alloc] <span class="string">initWithView:</span>view];</span><br><span class="line">    [viewShaker <span class="string">shakeWithDuration:</span>KAFViewShakerDuration</span><br><span class="line"><span class="symbol">                       completion:</span>^&#123;</span><br><span class="line">        [MBProgressHUD <span class="string">hql_showTextHUD:</span>text <span class="string">toView:</span>HUDView];</span><br><span class="line">    &#125;];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://andy0570.com/2017/06/02/IconFont——通过字体文件来构建纯色图的方案/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="独木舟的木">
      <meta itemprop="description" content="有时候阳光很好 有时候阳光很暗">
      <meta itemprop="image" content="https://ws1.sinaimg.cn/large/006tNc79gy1g22m14458rj30u014xu0x.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="独木舟的木">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2017/06/02/IconFont——通过字体文件来构建纯色图的方案/" class="post-title-link" itemprop="url">IconFont——通过字体文件来构建纯色图的方案</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2017-06-02 14:19:00" itemprop="dateCreated datePublished" datetime="2017-06-02T14:19:00+08:00">2017-06-02</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2019-04-18 01:09:44" itemprop="dateModified" datetime="2019-04-18T01:09:44+08:00">2019-04-18</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/iOS-开源框架/" itemprop="url" rel="index"><span itemprop="name">iOS 开源框架</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          
            <span id="/2017/06/02/IconFont——通过字体文件来构建纯色图的方案/" class="leancloud_visitors" data-flag-title="IconFont——通过字体文件来构建纯色图的方案">
              <span class="post-meta-divider">|</span>
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              
                <span class="post-meta-item-text">阅读次数：</span>
              
                <span class="leancloud-visitors-count"></span>
            </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body han-init-context" itemprop="articleBody">

      
      

      
        
          
            <a id="more"></a>
<ul>
<li>GitHub源码:<a href="https://github.com/JohnWong/IconFont" target="_blank" rel="noopener">IconFont</a></li>
<li>star:50+</li>
</ul>
<blockquote>
<pre><code>⭐️⭐️⭐️ 
</code></pre><p>以下内容来源于官方源码、 README 文档、测试 Demo或个人使用总结 ！</p>
</blockquote>
<h1 id="IconFont"><a href="#IconFont" class="headerlink" title="IconFont "></a>IconFont <a href="http://badge.fury.io/co/IconFont" target="_blank" rel="noopener"><img src="https://badge.fury.io/co/IconFont.svg" alt="Pod version"></a></h1><p>IconFont is a way to build lossless images of pure color with font file.</p>
<h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>IconFont是一种通过字体文件来构建纯色图的方案。更详细的介绍参见<a href="http://johnwong.github.io/mobile/2015/04/03/using-icon-font-in-ios.html" target="_blank" rel="noopener">使用IconFont减小iOS应用体积</a>。简单说来其目的是：</p>
<ol>
<li>减小应用体积，字体文件比图片要小</li>
<li>图标保真缩放，解决2x/3x乃至将来nx图问题</li>
<li>方便更改颜色大小，图片复用</li>
</ol>
<p>局限性在于只支持纯色图，但是在扁平化的今天纯色图变得越来越多。目前这套方案在点点iOS客户端上做了广泛的应用，对于应用体积压缩很有帮助。</p>
<p><img src="http://upload-images.jianshu.io/upload_images/2648731-db1dc2a24aa0ca07.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="Screenshot"></p>
<h2 id="使用指南"><a href="#使用指南" class="headerlink" title="使用指南"></a>使用指南</h2><h3 id="安装IconFont"><a href="#安装IconFont" class="headerlink" title="安装IconFont"></a>安装IconFont</h3><h4 id="必要条件"><a href="#必要条件" class="headerlink" title="必要条件"></a>必要条件</h4><p>Xcode 5<br>iOS 6.0 +<br>ARC enabled<br>CoreText framework</p>
<h4 id="使用CocoaPods安装"><a href="#使用CocoaPods安装" class="headerlink" title="使用CocoaPods安装"></a>使用CocoaPods安装</h4><p>添加<code>pod &#39;IconFont&#39;, &#39;~&gt; 0.0.2&#39;</code>到你项目的Podfile中。</p>
<p>运行<code>pod install</code>或者<code>pod update</code>来安装。</p>
<h4 id="手动安装"><a href="#手动安装" class="headerlink" title="手动安装"></a>手动安装</h4><p>下载源码，将IconFont目录拖到你的项目中，并添加CoreText框架到你的项目中。</p>
<h3 id="得到字体文件"><a href="#得到字体文件" class="headerlink" title="得到字体文件"></a>得到字体文件</h3><p>强烈建议用<a href="http://iconfont.cn/" target="_blank" rel="noopener">iconfont.cn</a>平台管理字体，资源多，易用。或者使用字体工具自行编辑字体，比如<a href="http://fontforge.github.io/en-US/" target="_blank" rel="noopener">FontForge</a>。如果想了解FontForge的使用，可以看我翻译的官方文档<a href="http://designwithfontforge.com/zh-CN/index.html" target="_blank" rel="noopener">FontForge与字体设计</a>。</p>
<p>这里需要注意的是字体内包含的字体名要与字体文件名一致。从iconfont.cn下载的字体可能需要重命名。点击下图字体项目的<code>编辑项目</code>按钮，Font Family一栏就是字体内包含的字体名，将下载解压后的ttf文件名修改为这个字体名。当然，也可以在下载后使用FontForge工具修改ttf文件内包含的字体名。</p>
<p><img src="http://upload-images.jianshu.io/upload_images/2648731-5a499f86f167e3cc.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="Screenshot"></p>
<h3 id="引用头文件"><a href="#引用头文件" class="headerlink" title="引用头文件"></a>引用头文件</h3><p>在需要使用的地方引用头文件，或者在预编译pch文件中做全局引用：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#import &quot;TBCityIconFont.h&quot;</span><br></pre></td></tr></table></figure>
<h3 id="设置字体名称"><a href="#设置字体名称" class="headerlink" title="设置字体名称"></a>设置字体名称</h3><p>系统会默认加载字体名称LLIconfont，如果字体名不是这个，则需要在使用字体之前设置字体的名称。例如在AppDelegate的<code>-application:didFinishLaunchingWithOptions:</code>方法中添加：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[TBCityIconFont setFontName:@&quot;LLIconfont&quot;];</span><br></pre></td></tr></table></figure>
<h3 id="创建UIImage"><a href="#创建UIImage" class="headerlink" title="创建UIImage"></a>创建UIImage</h3><p>使用UIImage的category方法从字体创建UIImage：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[UIImage iconWithInfo:TBCityIconInfoMake(@&quot;\U0000e601&quot;, 24, [UIColor blackColor])]</span><br></pre></td></tr></table></figure>
<p>其中<code>e601</code>图标在字体中存放的Unicode字符位。如果字体从iconfont.cn网站下载，这个值可以在页面上图标下方找到。可能更好的方法是在另一个文件中将图标预定义好，方便管理，使用的时候也更加简洁。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">// TBCityIconDefine.h</span><br><span class="line"></span><br><span class="line">#define kTBCityIconCheck TBCityIconInfoMake(@&quot;\U0000e601&quot;, 24, [UIColor blackColor])</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[UIImage iconWithInfo:kTBCityIconAppreciate]</span><br></pre></td></tr></table></figure>
<h3 id="代码结构"><a href="#代码结构" class="headerlink" title="代码结构"></a>代码结构</h3><p>核心代码在工程的IconFont目录下，结构为：</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">IconFont</span><br><span class="line">├── TBCityIconFont.h</span><br><span class="line">├── TBCityIconFont.m</span><br><span class="line">├── TBCityIconInfo.h</span><br><span class="line">├── TBCityIconInfo.m</span><br><span class="line">├── UIImage+TBCityIconFont.h</span><br><span class="line">└── UIImage+TBCityIconFont.m</span><br><span class="line">└── HQFontImage.h</span><br><span class="line">└── HQFontImage.m</span><br></pre></td></tr></table></figure>
<h2 id="新的引用方式说明"><a href="#新的引用方式说明" class="headerlink" title="新的引用方式说明"></a>新的引用方式说明</h2><h3 id="关于HQFontImage"><a href="#关于HQFontImage" class="headerlink" title="关于HQFontImage"></a>关于HQFontImage</h3><p>HQFontImage是扩展和加强原来的使用方式，增加字体定义，名称到图标数据映射，用文字做图片，自定义背景颜色等。<br>使用时需要定义子类使用，示例工程里有，可以参考使用。</p>
<h3 id="1-获取字体文件和相应的网页文件"><a href="#1-获取字体文件和相应的网页文件" class="headerlink" title="1 获取字体文件和相应的网页文件"></a>1 获取字体文件和相应的网页文件</h3><p>强烈建议用<a href="http://iconfont.cn/" target="_blank" rel="noopener">iconfont.cn</a>平台管理字体，资源多，易用。<br>下载的zip文件，包含网页样例，我们可以从网页样例转换为我们需要用的数据</p>
<h3 id="2-转换数据"><a href="#2-转换数据" class="headerlink" title="2 转换数据"></a>2 转换数据</h3><p>我们只是增加了字体映射关系，方便使用，所以需要做一次转换，iconfont.cn 官方提供这样的转换会更好。<br>目前官方没有，所以可以参考这个网页小工具：<br><a href="http://www.aslibra.com/iconFont/" target="_blank" rel="noopener">http://www.aslibra.com/iconFont/</a><br>把demo.html用浏览器打开，按提示处理即可，官方数据格式不变的情况下可用。<br>我们把官方用在css的类名作为唯一名称做映射关系。</p>
<h3 id="3-做一个HQFontImage的子类"><a href="#3-做一个HQFontImage的子类" class="headerlink" title="3 做一个HQFontImage的子类"></a>3 做一个HQFontImage的子类</h3><p>定义映射关系或者自定义字体文件，上面提供的网页可以方便得到下面的数据</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">+ (NSDictionary*)IconDictionary</span><br><span class="line">&#123;</span><br><span class="line">    return @&#123;</span><br><span class="line">             @&quot;delete&quot;:@&quot;\U0000e610&quot;, // 删除</span><br><span class="line">             @&quot;shezhi&quot;:@&quot;\U0000e60f&quot;, // 设置</span><br><span class="line">             @&quot;order&quot;:@&quot;\U0000e600&quot;, // order</span><br><span class="line">             @&quot;jikediancanicon02&quot;:@&quot;\U0000e601&quot;, // 订单</span><br><span class="line">             @&quot;yinleyinpin&quot;:@&quot;\U0000e602&quot;, // 音乐音频</span><br><span class="line">             @&quot;luyin&quot;:@&quot;\U0000e603&quot;, // 录音</span><br><span class="line">             @&quot;tianjia&quot;:@&quot;\U0000e604&quot;, // 添加</span><br><span class="line">             @&quot;dingdan&quot;:@&quot;\U0000e605&quot;, // 订单</span><br><span class="line">             @&quot;tianjia1&quot;:@&quot;\U0000e606&quot;, // 添加</span><br><span class="line">             @&quot;shezhi1&quot;:@&quot;\U0000e611&quot;, // 设置</span><br><span class="line">             @&quot;8080pxtubiaokuozhan100&quot;:@&quot;\U0000e615&quot;, // stop</span><br><span class="line">             @&quot;socialconnect&quot;:@&quot;\U0000e612&quot;, // social-connect</span><br><span class="line">             @&quot;record&quot;:@&quot;\U0000e616&quot;, // record</span><br><span class="line">             @&quot;bookaskicon1417&quot;:@&quot;\U0000e607&quot;, // setting</span><br><span class="line">             @&quot;tixing&quot;:@&quot;\U0000e608&quot;, // 提醒</span><br><span class="line">             @&quot;iconmenubarorder&quot;:@&quot;\U0000e609&quot;, // order</span><br><span class="line">             @&quot;wifi&quot;:@&quot;\U0000e60a&quot;, // WIFI</span><br><span class="line">             @&quot;shezhi2&quot;:@&quot;\U0000e60b&quot;, // 设置</span><br><span class="line">             @&quot;gerenzhongxin01&quot;:@&quot;\U0000e60c&quot;, // 个人中心 </span><br><span class="line">             @&quot;group&quot;:@&quot;\U0000e613&quot;, // Group </span><br><span class="line">             @&quot;help&quot;:@&quot;\U0000e614&quot;, // help </span><br><span class="line">             @&quot;play&quot;:@&quot;\U0000e617&quot;, // play </span><br><span class="line">             @&quot;tixing1&quot;:@&quot;\U0000e60d&quot;, // 提醒 </span><br><span class="line">             @&quot;yuyin&quot;:@&quot;\U0000e60e&quot;, // 语音 </span><br><span class="line">             @&quot;&quot;:@&quot;&quot;&#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//单独定义一个字体文件，方便管理多个字体库</span><br><span class="line">+ (NSString*)fontName</span><br><span class="line">&#123;</span><br><span class="line">    return @&quot;iconfont&quot;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="4-使用示例"><a href="#4-使用示例" class="headerlink" title="4 使用示例"></a>4 使用示例</h3><p>引用自定义的子类文件<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#import &quot;HQFontImageDictionary.h&quot;</span><br><span class="line">#import &quot;HQFontImageList.h&quot;</span><br></pre></td></tr></table></figure></p>
<p>使用图片<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">//使用名字的方式引用</span><br><span class="line">_appreciateIcon.image = [HQFontImageDictionary iconWithName:@&quot;pause&quot; fontSize:48 color:[UIColor redColor] inset:UIEdgeInsetsMake(10, 10, 10, 10)];</span><br><span class="line">_checkIcon.image = [HQFontImageDictionary iconWithName:@&quot;pause&quot; fontSize:48 color:[UIColor blueColor] padding:0.3 withBackgroundColor:[UIColor yellowColor]];</span><br><span class="line">_closeIcon.image = [HQFontImageDictionary iconWithName:@&quot;汉&quot; fontSize:48 color:[UIColor redColor]];</span><br><span class="line">//自定义，但两个字体会有上下偏移不同，不知道是否字体文件问题</span><br><span class="line">_editIcon.image = [HQFontImageList iconWithName:@&quot;汉&quot; fontSize:48 color:[UIColor redColor]];</span><br><span class="line">_emojiIcon.image = [HQFontImageDictionary iconWithName:@&quot;pause&quot; fontSize:48 color:[UIColor redColor] withBackgroundColor:[UIColor blackColor]];</span><br></pre></td></tr></table></figure></p>
<p><img src="http://upload-images.jianshu.io/upload_images/2648731-1a44ce397fbe88c3.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="Screenshot"></p>
<h3 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h3><ul>
<li><a href="http://johnwong.github.io/mobile/2015/04/03/using-icon-font-in-ios.html" target="_blank" rel="noopener">使用IconFont减小iOS应用体积</a></li>
<li><a href="http://www.jianshu.com/p/3b10bb95b332" target="_blank" rel="noopener">在iOS开发中使用iconfont图标</a></li>
<li><a href="http://designwithfontforge.com/zh-CN/" target="_blank" rel="noopener">FontForge 与字体设计</a></li>
</ul>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://andy0570.com/2017/06/01/iOS 编程：GCD 编程笔记/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="独木舟的木">
      <meta itemprop="description" content="有时候阳光很好 有时候阳光很暗">
      <meta itemprop="image" content="https://ws1.sinaimg.cn/large/006tNc79gy1g22m14458rj30u014xu0x.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="独木舟的木">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2017/06/01/iOS 编程：GCD 编程笔记/" class="post-title-link" itemprop="url">iOS 编程：GCD 编程笔记</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2017-06-01 15:33:00" itemprop="dateCreated datePublished" datetime="2017-06-01T15:33:00+08:00">2017-06-01</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2019-04-17 15:34:08" itemprop="dateModified" datetime="2019-04-17T15:34:08+08:00">2019-04-17</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/iOS/" itemprop="url" rel="index"><span itemprop="name">iOS</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          
            <span id="/2017/06/01/iOS 编程：GCD 编程笔记/" class="leancloud_visitors" data-flag-title="iOS 编程：GCD 编程笔记">
              <span class="post-meta-divider">|</span>
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              
                <span class="post-meta-item-text">阅读次数：</span>
              
                <span class="leancloud-visitors-count"></span>
            </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body han-init-context" itemprop="articleBody">

      
      

      
        
          
            <a id="more"></a>
<h3 id="GCD-函数"><a href="#GCD-函数" class="headerlink" title="GCD 函数"></a>GCD 函数</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line">// ===============================================================</span><br><span class="line">// 异步后台执行</span><br><span class="line">dispatch_async(dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_HIGH, 0), ^&#123;</span><br><span class="line">    // do something</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">// ===============================================================</span><br><span class="line">// 异步主线程执行</span><br><span class="line">dispatch_async(dispatch_get_main_queue(), ^&#123;</span><br><span class="line">   // do something</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">// ===============================================================</span><br><span class="line">// 一次性执行:单例</span><br><span class="line">static dispatch_once_t onceToken;</span><br><span class="line">dispatch_once(&amp;onceToken, ^&#123;</span><br><span class="line">    // code to be executed once</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">// ===============================================================</span><br><span class="line">// 延迟2秒执行</span><br><span class="line">double delayInSeconds = 2.0;</span><br><span class="line">dispatch_time_t popTime = dispatch_time(DISPATCH_TIME_NOW, (int64_t)(delayInSeconds * NSEC_PER_SEC));</span><br><span class="line">dispatch_after(popTime, dispatch_get_main_queue(), ^&#123;</span><br><span class="line">    // code to be executed on the main queue after delay</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">// ===============================================================</span><br><span class="line">// 使用 dispatch_queue_create() 自定义 dispatch_queue_t,</span><br><span class="line">// 第一个参数是反向DNS样式命名惯例;</span><br><span class="line">// 第二个参数指定你的队列是串行还是并发;</span><br><span class="line">// 注意：当你在网上搜索例子时，你会经常看人们传递 0 或者 NULL 给 dispatch_queue_create 的第二个参数。这是一个创建串行队列的过时方式；明确你的参数总是更好。</span><br><span class="line">dispatch_queue_t urls_quene = dispatch_queue_create(&quot;com.selander.GooglyPuff.photoQueue&quot;, NULL);</span><br><span class="line">dispatch_async(urls_quene, ^&#123;</span><br><span class="line">    // your code</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">// ===============================================================</span><br><span class="line">// 并行执行线程</span><br><span class="line">dispatch_group_t group = dispatch_group_create();</span><br><span class="line">dispatch_group_async(group, dispatch_get_global_queue(0, 0), ^&#123;</span><br><span class="line">    // 并行执行的线程一</span><br><span class="line">&#125;);</span><br><span class="line">dispatch_group_async(group, dispatch_get_global_queue(0, 0), ^&#123;</span><br><span class="line">    // 并行执行的线程二</span><br><span class="line">&#125;);</span><br><span class="line">dispatch_group_notify(group, dispatch_get_global_queue(0, 0), ^&#123;</span><br><span class="line">    // 汇总结果</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">// ===============================================================</span><br><span class="line">// 每秒执行</span><br><span class="line">-(void)startTime&#123;</span><br><span class="line">    </span><br><span class="line">    __block int timeout = 60; // 倒计时时间</span><br><span class="line">    NSTimeInterval intervalInSeconds = 1.0; // 执行时间间隔</span><br><span class="line">    </span><br><span class="line">    //获取后台队列</span><br><span class="line">    dispatch_queue_t queue = dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0);</span><br><span class="line">    </span><br><span class="line">    // 以下代码可以使用代码片段库： dispatch_source_t timer</span><br><span class="line">    // 创建一个timer放到队列中</span><br><span class="line">    dispatch_source_t timer = dispatch_source_create(DISPATCH_SOURCE_TYPE_TIMER, 0, 0, queue);</span><br><span class="line">    // 设置timer的首次执行时间、执行时间间隔、精确度</span><br><span class="line">    dispatch_source_set_timer(timer, DISPATCH_TIME_NOW, intervalInSeconds * NSEC_PER_SEC, 0 * NSEC_PER_SEC);</span><br><span class="line">    dispatch_source_set_event_handler(timer, ^&#123;</span><br><span class="line">        // 设置timer执行的事件</span><br><span class="line">        if (timeout &lt;= 0) &#123;</span><br><span class="line">            dispatch_source_cancel(timer); // 关闭timer</span><br><span class="line">            dispatch_async(dispatch_get_main_queue(), ^&#123;</span><br><span class="line">                // 倒计时结束，回到主线程更新UI</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;else &#123;</span><br><span class="line">            dispatch_async(dispatch_get_main_queue(), ^&#123;</span><br><span class="line">                // 倒计时进行中，更新UI</span><br><span class="line">                NSLog(@&quot;===%ds===&quot;,timeout);</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">        timeout --;</span><br><span class="line">    &#125;);</span><br><span class="line">    // 激活timer</span><br><span class="line">    dispatch_resume(timer);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="队列的四个优先级"><a href="#队列的四个优先级" class="headerlink" title="队列的四个优先级"></a>队列的四个优先级</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">*  - DISPATCH_QUEUE_PRIORITY_HIGH:         QOS_CLASS_USER_INITIATED</span><br><span class="line">*  - DISPATCH_QUEUE_PRIORITY_DEFAULT:      QOS_CLASS_DEFAULT</span><br><span class="line">*  - DISPATCH_QUEUE_PRIORITY_LOW:          QOS_CLASS_UTILITY</span><br><span class="line">*  - DISPATCH_QUEUE_PRIORITY_BACKGROUND:   QOS_CLASS_BACKGROUND</span><br></pre></td></tr></table></figure>
<h3 id="引用"><a href="#引用" class="headerlink" title="引用"></a>引用</h3><p>下面是一个关于在 <code>dispatch_async</code> 上如何以及何时使用不同的队列类型的快速指导：</p>
<ul>
<li>自定义串行队列：当你想串行执行后台任务并追踪它时就是一个好选择。这消除了资源争用，因为你知道一次只有一个任务在执行。注意若你需要来自某个方法的数据，你必须内联另一个 Block 来找回它或考虑使用 <code>dispatch_sync</code>。</li>
<li>主队列（串行）：这是在一个并发队列上完成任务后更新 UI 的共同选择。要这样做，你将在一个 Block 内部编写另一个 Block 。以及，如果你在主队列调用 <code>dispatch_async</code> 到主队列，你能确保这个新任务将在当前方法完成后的某个时间执行。</li>
<li>并发队列：这是在后台执行非 UI 工作的共同选择。</li>
</ul>
<p>不知道何时适合使用 <code>dispatch_after</code> ？</p>
<ul>
<li>自定义串行队列：在一个自定义串行队列上使用 <code>dispatch_after</code> 要小心。你最好坚持使用主队列。</li>
<li>主队列（串行）：是使用 <code>dispatch_after</code> 的好选择；Xcode 提供了一个不错的自动完成模版。</li>
<li>并发队列：在并发队列上使用 <code>dispatch_after</code> 也要小心；你会这样做就比较罕见。还是在主队列做这些操作吧。</li>
</ul>
<p>下面是你何时会——和不会——使用障碍函数 <code>Dispatch barriers</code> 的情况：</p>
<ul>
<li>自定义串行队列：一个很坏的选择；障碍不会有任何帮助，因为不管怎样，一个串行队列一次都只执行一个操作。</li>
<li>全局并发队列：要小心；这可能不是最好的主意，因为其它系统可能在使用队列而且你不能垄断它们只为你自己的目的。</li>
<li>自定义并发队列：这对于原子或临界区代码来说是极佳的选择。任何你在设置或实例化的需要线程安全的事物都是使用障碍的最佳候选。</li>
</ul>
<p>下面是一个快速总览，关于在何时以及何处使用 <code>dispatch_sync</code> ：</p>
<ul>
<li>自定义串行队列：在这个状况下要非常小心！如果你正运行在一个队列并调用 <code>dispatch_sync</code> 放在同一个队列，那你就百分百地创建了一个死锁。</li>
<li>主队列（串行）：同上面的理由一样，必须非常小心！这个状况同样有潜在的导致死锁的情况。</li>
<li>并发队列：这才是做同步工作的好选择，不论是通过调度障碍，或者需要等待一个任务完成才能执行进一步处理的情况。</li>
</ul>
<h3 id="Dispatch-Groups"><a href="#Dispatch-Groups" class="headerlink" title="Dispatch Groups"></a>Dispatch Groups</h3><p>关于何时以及怎样使用有着不同的队列类型的 Dispatch Group ：</p>
<ul>
<li>自定义串行队列：它很适合当一组任务完成时发出通知。</li>
<li>主队列（串行）：它也很适合这样的情况。但如果你要同步地等待所有工作地完成，那你就不应该使用它，因为你不能阻塞主线程。然而，异步模型是一个很有吸引力的能用于在几个较长任务（例如网络调用）完成后更新 UI 的方式。</li>
<li>并发队列：它也很适合 Dispatch Group 和完成时通知。</li>
</ul>
<h4 id="①-dispatch-group-wait"><a href="#①-dispatch-group-wait" class="headerlink" title="① dispatch_group_wait"></a>① <code>dispatch_group_wait</code></h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">- (void)downloadPhotosWithCompletionBlock:(BatchPhotoDownloadingCompletionBlock)completionBlock</span><br><span class="line">&#123;</span><br><span class="line">    //  因为你在使用的是同步的 dispatch_group_wait ，它会阻塞当前线程，所以你要用 dispatch_async 将整个方法放入后台队列以避免阻塞主线程。</span><br><span class="line">    dispatch_async(dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_HIGH, 0), ^&#123; // 1</span><br><span class="line">        </span><br><span class="line">        __block NSError *error;</span><br><span class="line">        //  创建一个新的 Dispatch Group，它的作用就像一个用于未完成任务的计数器。</span><br><span class="line">        dispatch_group_t downloadGroup = dispatch_group_create(); // 2</span><br><span class="line">        </span><br><span class="line">        for (NSInteger i = 0; i &lt; 3; i++) &#123;</span><br><span class="line">            NSURL *url;</span><br><span class="line">            switch (i) &#123;</span><br><span class="line">                case 0:</span><br><span class="line">                    url = [NSURL URLWithString:kOverlyAttachedGirlfriendURLString];</span><br><span class="line">                    break;</span><br><span class="line">                case 1:</span><br><span class="line">                    url = [NSURL URLWithString:kSuccessKidURLString];</span><br><span class="line">                    break;</span><br><span class="line">                case 2:</span><br><span class="line">                    url = [NSURL URLWithString:kLotsOfFacesURLString];</span><br><span class="line">                    break;</span><br><span class="line">                default:</span><br><span class="line">                    break;</span><br><span class="line">            &#125;</span><br><span class="line">            //  dispatch_group_enter 手动通知 Dispatch Group 任务已经开始。你必须保证 dispatch_group_enter 和 dispatch_group_leave 成对出现，否则你可能会遇到诡异的崩溃问题。</span><br><span class="line">            dispatch_group_enter(downloadGroup); // 3</span><br><span class="line">            Photo *photo = [[Photo alloc] initwithURL:url</span><br><span class="line">                                  withCompletionBlock:^(UIImage *image, NSError *_error) &#123;</span><br><span class="line">                                      if (_error) &#123;</span><br><span class="line">                                          error = _error;</span><br><span class="line">                                      &#125;</span><br><span class="line">                                      //    手动通知 Group 它的工作已经完成。再次说明，你必须要确保进入 Group 的次数和离开 Group 的次数相等。</span><br><span class="line">                                      dispatch_group_leave(downloadGroup); // 4</span><br><span class="line">                                  &#125;];</span><br><span class="line">            </span><br><span class="line">            [[PhotoManager sharedManager] addPhoto:photo];</span><br><span class="line">        &#125;</span><br><span class="line">        // dispatch_group_wait 会一直等待，直到任务全部完成或者超时。如果在所有任务完成前超时了，该函数会返回一个非零值。你可以对此返回值做条件判断以确定是否超出等待周期；然而，你在这里用 DISPATCH_TIME_FOREVER 让它永远等待。它的意思，勿庸置疑就是，永－远－等－待！这样很好，因为图片的创建工作总是会完成的。</span><br><span class="line">        dispatch_group_wait(downloadGroup, DISPATCH_TIME_FOREVER); // 5</span><br><span class="line">        //  此时此刻，你已经确保了，要么所有的图片任务都已完成，要么发生了超时。然后，你在主线程上运行 completionBlock 回调。这会将工作放到主线程上，并在稍后执行。</span><br><span class="line">        dispatch_async(dispatch_get_main_queue(), ^&#123; // 6</span><br><span class="line">            // 最后，检查 completionBlock 是否为 nil，如果不是，那就运行它。</span><br><span class="line">            if (completionBlock) &#123; // 7</span><br><span class="line">                completionBlock(error);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="②-dispatch-group-notify"><a href="#②-dispatch-group-notify" class="headerlink" title="② dispatch_group_notify"></a>② <code>dispatch_group_notify</code></h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">- (void)downloadPhotosWithCompletionBlock:(BatchPhotoDownloadingCompletionBlock)completionBlock</span><br><span class="line">&#123;</span><br><span class="line">    // 1</span><br><span class="line">    //  在新的实现里，因为你没有阻塞主线程，所以你并不需要将方法包裹在 async 调用中。</span><br><span class="line">    __block NSError *error;</span><br><span class="line">    dispatch_group_t downloadGroup = dispatch_group_create();</span><br><span class="line">    </span><br><span class="line">    for (NSInteger i = 0; i &lt; 3; i++) &#123;</span><br><span class="line">        NSURL *url;</span><br><span class="line">        switch (i) &#123;</span><br><span class="line">            case 0:</span><br><span class="line">                url = [NSURL URLWithString:kOverlyAttachedGirlfriendURLString];</span><br><span class="line">                break;</span><br><span class="line">            case 1:</span><br><span class="line">                url = [NSURL URLWithString:kSuccessKidURLString];</span><br><span class="line">                break;</span><br><span class="line">            case 2:</span><br><span class="line">                url = [NSURL URLWithString:kLotsOfFacesURLString];</span><br><span class="line">                break;</span><br><span class="line">            default:</span><br><span class="line">                break;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        // 同样的 enter 方法，没做任何修改。</span><br><span class="line">        dispatch_group_enter(downloadGroup); // 2</span><br><span class="line">        Photo *photo = [[Photo alloc] initwithURL:url</span><br><span class="line">                              withCompletionBlock:^(UIImage *image, NSError *_error) &#123;</span><br><span class="line">                                  if (_error) &#123;</span><br><span class="line">                                      error = _error;</span><br><span class="line">                                  &#125;</span><br><span class="line">                                  // 同样的 leave 方法，也没做任何修改。</span><br><span class="line">                                  dispatch_group_leave(downloadGroup); // 3</span><br><span class="line">                              &#125;];</span><br><span class="line">        </span><br><span class="line">        [[PhotoManager sharedManager] addPhoto:photo];</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    //  dispatch_group_notify 以异步的方式工作。当 Dispatch Group 中没有任何任务时，它就会执行其代码，那么 completionBlock 便会运行。你还指定了运行 completionBlock 的队列，此处，主队列就是你所需要的。</span><br><span class="line">    dispatch_group_notify(downloadGroup, dispatch_get_main_queue(), ^&#123; // 4</span><br><span class="line">        if (completionBlock) &#123;</span><br><span class="line">            completionBlock(error);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>那何时才适合用 <code>dispatch_apply</code> 呢？</p>
<ul>
<li>自定义串行队列：串行队列会完全抵消 <code>dispatch_apply</code> 的功能；你还不如直接使用普通的 <code>for</code> 循环。</li>
<li>主队列（串行）：与上面一样，在串行队列上不适合使用 <code>dispatch_apply</code> 。还是用普通的 <code>for</code> 循环吧。</li>
<li>并发队列：对于并发循环来说是很好选择，特别是当你需要追踪任务的进度时。</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">- (void)downloadPhotosWithCompletionBlock:(BatchPhotoDownloadingCompletionBlock)completionBlock</span><br><span class="line">&#123;</span><br><span class="line">    __block NSError *error;</span><br><span class="line">    dispatch_group_t downloadGroup = dispatch_group_create();</span><br><span class="line"> </span><br><span class="line">    dispatch_apply(3, dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_HIGH, 0), ^(size_t i) &#123;</span><br><span class="line"> </span><br><span class="line">        NSURL *url;</span><br><span class="line">        switch (i) &#123;</span><br><span class="line">            case 0:</span><br><span class="line">                url = [NSURL URLWithString:kOverlyAttachedGirlfriendURLString];</span><br><span class="line">                break;</span><br><span class="line">            case 1:</span><br><span class="line">                url = [NSURL URLWithString:kSuccessKidURLString];</span><br><span class="line">                break;</span><br><span class="line">            case 2:</span><br><span class="line">                url = [NSURL URLWithString:kLotsOfFacesURLString];</span><br><span class="line">                break;</span><br><span class="line">            default:</span><br><span class="line">                break;</span><br><span class="line">        &#125;</span><br><span class="line"> </span><br><span class="line">        dispatch_group_enter(downloadGroup);</span><br><span class="line">        Photo *photo = [[Photo alloc] initwithURL:url</span><br><span class="line">                              withCompletionBlock:^(UIImage *image, NSError *_error) &#123;</span><br><span class="line">                                  if (_error) &#123;</span><br><span class="line">                                      error = _error;</span><br><span class="line">                                  &#125;</span><br><span class="line">                                  dispatch_group_leave(downloadGroup);</span><br><span class="line">                              &#125;];</span><br><span class="line"> </span><br><span class="line">        [[PhotoManager sharedManager] addPhoto:photo];</span><br><span class="line">    &#125;);</span><br><span class="line"> </span><br><span class="line">    dispatch_group_notify(downloadGroup, dispatch_get_main_queue(), ^&#123;</span><br><span class="line">        if (completionBlock) &#123;</span><br><span class="line">            completionBlock(error);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h3><ul>
<li><a href="http://blog.devtang.com/2012/02/22/use-gcd/" target="_blank" rel="noopener">使用GCD @唐巧</a></li>
<li><a href="https://www.raywenderlich.com/4295/multithreading-and-grand-central-dispatch-on-ios-for-beginners-tutorial" target="_blank" rel="noopener">Multithreading and Grand Central Dispatch on iOS for Beginners Tutorial</a></li>
<li><a href="https://justinyan.me/post/2077" target="_blank" rel="noopener">如何使用 NSOperations 和 NSOperationQueues</a></li>
<li><a href="https://github.com/nixzhu/dev-blog/blob/master/2014-04-19-grand-central-dispatch-in-depth-part-1.md" target="_blank" rel="noopener">GCD 深入理解：第一部分</a></li>
<li><a href="https://github.com/nixzhu/dev-blog/blob/master/2014-05-14-grand-central-dispatch-in-depth-part-2.md" target="_blank" rel="noopener">GCD 深入理解：第二部分</a></li>
<li><a href="http://subscribe.mail.10086.cn/subscribe/readAll.do?columnId=563&amp;itemId=3130310" target="_blank" rel="noopener">ios多线程操作（六）—— GCD全局队列与主队列</a></li>
</ul>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://andy0570.com/2017/05/31/iOS 编程：半模态视图/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="独木舟的木">
      <meta itemprop="description" content="有时候阳光很好 有时候阳光很暗">
      <meta itemprop="image" content="https://ws1.sinaimg.cn/large/006tNc79gy1g22m14458rj30u014xu0x.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="独木舟的木">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2017/05/31/iOS 编程：半模态视图/" class="post-title-link" itemprop="url">iOS 编程：半模态视图</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2017-05-31 11:24:00" itemprop="dateCreated datePublished" datetime="2017-05-31T11:24:00+08:00">2017-05-31</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2019-04-17 15:35:04" itemprop="dateModified" datetime="2019-04-17T15:35:04+08:00">2019-04-17</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/iOS/" itemprop="url" rel="index"><span itemprop="name">iOS</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          
            <span id="/2017/05/31/iOS 编程：半模态视图/" class="leancloud_visitors" data-flag-title="iOS 编程：半模态视图">
              <span class="post-meta-divider">|</span>
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              
                <span class="post-meta-item-text">阅读次数：</span>
              
                <span class="leancloud-visitors-count"></span>
            </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body han-init-context" itemprop="articleBody">

      
      

      
        
          
            <a id="more"></a>
<h3 id="UIModalPresentationStyle"><a href="#UIModalPresentationStyle" class="headerlink" title="UIModalPresentationStyle"></a>UIModalPresentationStyle</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">typedef enum UIModalPresentationStyle : NSInteger &#123;</span><br><span class="line"> UIModalPresentationFullScreen = 0,</span><br><span class="line"> // UIModalPresentationFullScreen 代表弹出VC时，presented VC充满全屏，如果弹出VC的wantsFullScreenLayout 属性设置为YES的，则会填充到状态栏下边，否则不会填充到状态栏之下。</span><br><span class="line"> </span><br><span class="line"> UIModalPresentationPageSheet,</span><br><span class="line"> //	UIModalPresentationPageSheet 代表弹出VC时，presented VC的高度和当前屏幕高度相同，宽度和竖屏模式下屏幕宽度相同，剩余未覆盖区域将会变暗并阻止用户点击，这种弹出模式下，竖屏时跟 UIModalPresentationFullScreen 的效果一样，横屏时候两边则会留下变暗的区域。</span><br><span class="line"> </span><br><span class="line"> UIModalPresentationFormSheet,</span><br><span class="line"> //	UIModalPresentationFormSheet 这种模式下，presented VC的高度和宽度均会小于屏幕尺寸，presented VC居中显示，四周留下变暗区域。</span><br><span class="line"> </span><br><span class="line"> UIModalPresentationCurrentContext,</span><br><span class="line"> // UIModalPresentationCurrentContext 这种模式下，presented VC 的弹出方式和 presenting VC的父VC的方式相同。</span><br><span class="line"> </span><br><span class="line"> UIModalPresentationCustom,</span><br><span class="line"> //	自定义视图展示风格,由一个自定义演示控制器和一个或多个自定义动画对象组成。符合UIViewControllerTransitioningDelegate 协议。使用视图控制器的 transitioningDelegate设定您的自定义转换。</span><br><span class="line"> </span><br><span class="line"> UIModalPresentationOverFullScreen,</span><br><span class="line"> //	如果视图没有被填满,底层视图可以透过</span><br><span class="line"> </span><br><span class="line"> UIModalPresentationOverCurrentContext,</span><br><span class="line"> //	视图全部被透过</span><br><span class="line"> </span><br><span class="line"> UIModalPresentationPopover,</span><br><span class="line"> // 弹窗样式</span><br><span class="line">  </span><br><span class="line"> UIModalPresentationNone = -1</span><br><span class="line"> &#125; UIModalPresentationStyle;</span><br></pre></td></tr></table></figure>
<h3 id="UIModalTransitionStyle"><a href="#UIModalTransitionStyle" class="headerlink" title="UIModalTransitionStyle"></a>UIModalTransitionStyle</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">typedef enum UIModalTransitionStyle : NSInteger &#123;</span><br><span class="line">    UIModalTransitionStyleCoverVertical = 0,	// 垂直覆盖</span><br><span class="line">    UIModalTransitionStyleFlipHorizontal,		// 水平翻转</span><br><span class="line">    UIModalTransitionStyleCrossDissolve,		// 淡入淡出</span><br><span class="line">    UIModalTransitionStylePartialCurl			// 翻页卷曲</span><br><span class="line">&#125; UIModalTransitionStyle;</span><br></pre></td></tr></table></figure>
<h3 id="显示半模态视图"><a href="#显示半模态视图" class="headerlink" title="显示半模态视图"></a>显示半模态视图</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">ModelViewController *vc = [[ModelViewController alloc] init];</span><br><span class="line"></span><br><span class="line">// 是否由当前视图控制器的视图显示被模态推出的视图，否则默认由根视图控制器来显示</span><br><span class="line">//    vc.definesPresentationContext = YES;</span><br><span class="line"></span><br><span class="line">// 设置模态显示样式</span><br><span class="line">vc.modalPresentationStyle = UIModalPresentationOverCurrentContext;</span><br><span class="line">// 设置视图转换动画样式,默认垂直覆盖</span><br><span class="line">vc.modalTransitionStyle = UIModalTransitionStyleCoverVertical;</span><br><span class="line"></span><br><span class="line">vc.dismissBlock = ^&#123;</span><br><span class="line">    // 恢复 presenting VC 视图的背景</span><br><span class="line">    UIColor *backColor = [UIColor whiteColor];</span><br><span class="line">    self.view.backgroundColor = backColor;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">// 设置 presenting VC 视图的背景</span><br><span class="line">UIColor *whiteColor = [UIColor whiteColor];</span><br><span class="line">self.view.backgroundColor =</span><br><span class="line">    [whiteColor colorWithAlphaComponent:0.7];</span><br><span class="line">[self presentViewController:vc animated:YES completion:nil];</span><br></pre></td></tr></table></figure>
<p>ModelViewController.m:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">#import &quot;ModelViewController.h&quot;</span><br><span class="line"></span><br><span class="line">@interface ModelViewController ()</span><br><span class="line">  </span><br><span class="line">@property (weak, nonatomic) IBOutlet UIView *coverView;</span><br><span class="line"></span><br><span class="line">@end</span><br><span class="line"></span><br><span class="line">@implementation ModelViewController</span><br><span class="line"></span><br><span class="line">- (void)viewDidLoad &#123;</span><br><span class="line">    [super viewDidLoad];</span><br><span class="line">    // Do any additional setup after loading the view from its nib.</span><br><span class="line">    </span><br><span class="line">    // 单击手势</span><br><span class="line">    UITapGestureRecognizer *tapRecognizer =</span><br><span class="line">    [[UITapGestureRecognizer alloc] initWithTarget:self</span><br><span class="line">                                            action:@selector(tap:)];</span><br><span class="line">    </span><br><span class="line">    [self.coverView addGestureRecognizer:tapRecognizer];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (void)didReceiveMemoryWarning &#123;</span><br><span class="line">    [super didReceiveMemoryWarning];</span><br><span class="line">    // Dispose of any resources that can be recreated.</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (IBAction)dismissViewController:(id)sender &#123;</span><br><span class="line">    self.dismissBlock();</span><br><span class="line">    [self.presentingViewController dismissViewControllerAnimated:YES</span><br><span class="line">                                                      completion:nil];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (void)tap:(id)sender &#123;</span><br><span class="line">    self.dismissBlock();</span><br><span class="line">    [self.presentingViewController dismissViewControllerAnimated:YES</span><br><span class="line">                                                      completion:nil];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="http://upload-images.jianshu.io/upload_images/2648731-2933635cff90c51d.gif?imageMogr2/auto-orient/strip" alt></p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://andy0570.com/2017/05/27/KNSemiModalViewController——呈现半模态视图/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="独木舟的木">
      <meta itemprop="description" content="有时候阳光很好 有时候阳光很暗">
      <meta itemprop="image" content="https://ws1.sinaimg.cn/large/006tNc79gy1g22m14458rj30u014xu0x.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="独木舟的木">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2017/05/27/KNSemiModalViewController——呈现半模态视图/" class="post-title-link" itemprop="url">未命名</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2017-05-27 15:50:00" itemprop="dateCreated datePublished" datetime="2017-05-27T15:50:00+08:00">2017-05-27</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2019-04-17 01:36:09" itemprop="dateModified" datetime="2019-04-17T01:36:09+08:00">2019-04-17</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/iOS-开源框架/" itemprop="url" rel="index"><span itemprop="name">iOS 开源框架</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          
            <span id="/2017/05/27/KNSemiModalViewController——呈现半模态视图/" class="leancloud_visitors" data-flag-title>
              <span class="post-meta-divider">|</span>
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              
                <span class="post-meta-item-text">阅读次数：</span>
              
                <span class="leancloud-visitors-count"></span>
            </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body han-init-context" itemprop="articleBody">

      
      

      
        
          
            <ul>
<li><strong>GitHub 地址</strong>： <a href="https://github.com/kentnguyen/KNSemiModalViewController" target="_blank" rel="noopener"><strong>KNSemiModalViewController</strong></a></li>
<li><strong>star:</strong>1700+</li>
</ul>
<blockquote>
<pre><code>⭐️⭐️⭐️ 
</code></pre><p>以下内容来源于官方源码、 README 文档、测试 Demo或个人使用总结 ！</p>
</blockquote>
<h2 id="UIViewController-KNSemiModal-Category"><a href="#UIViewController-KNSemiModal-Category" class="headerlink" title="UIViewController+KNSemiModal Category"></a>UIViewController+KNSemiModal Category</h2><p>UIViewController+KNSemiModal is an effort to make a replica of <strong>semi-modal view with pushed-back stacked animation</strong> found in the beautiful <a href="http://itunes.apple.com/us/app/national-parks-by-national/id518426085?mt=8" target="_blank" rel="noopener">Park Guides by National Geographic</a> app. You can see this original semi-modal view below.</p>
<p>This library (ARC) is designed as a Category to UIViewController so you don’t have to subclass and you can simply drop in any project and it will just work!</p>
<p><strong>UIViewController+KNSemiModal</strong> 可以实现半模态视图的堆叠效果，使用范畴（Category）实现，代码侵入性较小。</p>
<p><em>Original screenshot</em></p>
<p><img src="http://upload-images.jianshu.io/upload_images/2648731-6b4606f4fea3c475.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt> . <img src="http://upload-images.jianshu.io/upload_images/2648731-3363437d3a52e8e3.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt></p>
<p>Replica (view demo video to see the beautiful animation)*</p>
<p><img src="http://upload-images.jianshu.io/upload_images/2648731-5b2f8198409fccfa.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt> . <img src="http://upload-images.jianshu.io/upload_images/2648731-496d38bbce991e8d.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt></p>
<p>On iPad</p>
<p><img src="http://upload-images.jianshu.io/upload_images/2648731-779a80a297c8a038.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt> </p>
<h3 id="Features"><a href="#Features" class="headerlink" title="Features"></a>Features</h3><ul>
<li>Works with bare UIViewController</li>
<li>Works with UIViewController contained inside UINavigationController</li>
<li>Works with UIViewController contained inside UINavigationController, contained inside UITabbarController</li>
<li>Auto handling of modal frame size</li>
<li>Auto handling of touch area for dismissal</li>
<li>Resizable after presenting so that keyboard related interactions are possible</li>
<li>Easy to understand and very small code base, only 2 files</li>
<li>Trivial to implement as subclass</li>
<li>Landscape support (not during presentation)</li>
<li>Only use basic CAAnimation</li>
<li>iPad support (experimental)</li>
<li>Minimum iOS 5.0 (if you need 4.x support, use older commits before Jan 2013)</li>
</ul>
<h3 id="Optional-parameters"><a href="#Optional-parameters" class="headerlink" title="Optional parameters"></a>Optional parameters</h3><ul>
<li>animation duration</li>
<li>parent alpha</li>
<li>optional push-back</li>
<li>shadow opacity</li>
<li>disabling the cancel action</li>
<li>transition style: slide up, fade</li>
</ul>
<p>Easily extend this to anything you would want to make configurable. Feel free to submit pull requests.</p>
<p>可选参数：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line">// 结构，相关的配置参数</span><br><span class="line">extern const struct KNSemiModalOptionKeys &#123;</span><br><span class="line">	__unsafe_unretained NSString *traverseParentHierarchy; // 遍历父层次结构，BOOL类型. default is YES.</span><br><span class="line">	__unsafe_unretained NSString *pushParentBack;		   // 推回父视图，BOOL类型. default is YES.</span><br><span class="line">	__unsafe_unretained NSString *animationDuration; // 动画延时，double 类型, in seconds. default is 0.5.</span><br><span class="line">	__unsafe_unretained NSString *parentAlpha;       // 父视图透明度，float 类型.值越小越暗. default is 0.5.</span><br><span class="line">    __unsafe_unretained NSString *parentScale;       // 父视图缩放比例，double 类型 default is 0.8</span><br><span class="line">	__unsafe_unretained NSString *shadowOpacity;     // 阴影不透明度，default is 0.8</span><br><span class="line">	__unsafe_unretained NSString *transitionStyle;	 // 动画类型，NSNumber 类型</span><br><span class="line">    __unsafe_unretained NSString *disableCancel;     // 是否禁用取消，BOOL 类型，default is NO.</span><br><span class="line">    __unsafe_unretained NSString *backgroundView;    // 自定义背景视图，UIView 类型</span><br><span class="line">&#125; KNSemiModalOptionKeys;</span><br><span class="line"></span><br><span class="line">// 动画类型</span><br><span class="line">NS_ENUM(NSUInteger, KNSemiModalTransitionStyle) &#123;</span><br><span class="line">	KNSemiModalTransitionStyleSlideUp,      // 向上滑动</span><br><span class="line">	KNSemiModalTransitionStyleFadeInOut,    // 淡入淡出</span><br><span class="line">	KNSemiModalTransitionStyleFadeIn,       // 淡入</span><br><span class="line">	KNSemiModalTransitionStyleFadeOut,      // 淡出</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">// 使用时要根据指定类型封装</span><br><span class="line">-(void)kn_registerDefaultsAndOptions:(NSDictionary*)options &#123;</span><br><span class="line">	[self ym_registerOptions:options defaults:@&#123;</span><br><span class="line">     KNSemiModalOptionKeys.traverseParentHierarchy : @(YES),</span><br><span class="line">     KNSemiModalOptionKeys.pushParentBack : @(YES),</span><br><span class="line">     KNSemiModalOptionKeys.animationDuration : @(0.5),</span><br><span class="line">     KNSemiModalOptionKeys.parentAlpha : @(0.5),</span><br><span class="line">     KNSemiModalOptionKeys.parentScale : @(0.8),     </span><br><span class="line">     KNSemiModalOptionKeys.shadowOpacity : @(0.8),</span><br><span class="line">     KNSemiModalOptionKeys.transitionStyle : @(KNSemiModalTransitionStyleSlideUp),</span><br><span class="line">     KNSemiModalOptionKeys.disableCancel : @(NO),</span><br><span class="line">	 &#125;];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">    NSDictionary *options = @&#123;</span><br><span class="line">                  // 遍历父层次结构，BOOL类型. default is YES.</span><br><span class="line">                  KNSemiModalOptionKeys.traverseParentHierarchy:@(YES),</span><br><span class="line">                  // 父视图后移动画，BOOL类型. default is YES.</span><br><span class="line">                  KNSemiModalOptionKeys.pushParentBack:@(NO),</span><br><span class="line">                  // 动画延时，double 类型. in seconds. default is 0.5.</span><br><span class="line">                  KNSemiModalOptionKeys.animationDuration:@(0.25),</span><br><span class="line">                  // 父视图透明度，float 类型.值越小越暗. default is 0.5.</span><br><span class="line">                  KNSemiModalOptionKeys.parentAlpha:@(0.5),</span><br><span class="line">                  // 父视图缩放比例，double 类型 default is 0.8</span><br><span class="line">                  KNSemiModalOptionKeys.parentScale:@(1),</span><br><span class="line">                  // 阴影不透明度，default is 0.8</span><br><span class="line">                  KNSemiModalOptionKeys.shadowOpacity:@(0.6),</span><br><span class="line">                  // 动画类型，NSNumber 类型</span><br><span class="line">                  KNSemiModalOptionKeys.transitionStyle:        @(KNSemiModalTransitionStyleFadeInOut),</span><br><span class="line">                  // 是否禁用取消，BOOL 类型，default is NO.</span><br><span class="line">                  KNSemiModalOptionKeys.disableCancel:@(NO),</span><br><span class="line">                  // 自定义背景视图，UIView 类型</span><br><span class="line">                  KNSemiModalOptionKeys.backgroundView:[UIView new]</span><br><span class="line">                              &#125;;</span><br></pre></td></tr></table></figure>
<h3 id="Installation-How-to-use"><a href="#Installation-How-to-use" class="headerlink" title="Installation / How to use"></a>Installation / How to use</h3><ul>
<li>Copy 4 files in <code>Source</code> folder to your project</li>
<li>Add <code>QuartzCore.framework</code> to your project</li>
<li><code>#import &quot;UIViewController+KNSemiModal.h&quot;</code> in your ViewController</li>
<li>Call <code>[self presentSemiModalView:myView]</code></li>
<li>Call <code>[self dismissSemiModalView]</code> either from parent/presenting or child/presented controller</li>
</ul>
<h1 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h1><h2 id="官方-Demo1"><a href="#官方-Demo1" class="headerlink" title="官方 Demo1"></a>官方 Demo1</h2><p>显示视图</p>
<p><img src="http://upload-images.jianshu.io/upload_images/2648731-b19c42e4e9ceb671.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">- (IBAction)buttonDidTouch:(id)sender &#123;</span><br><span class="line">  // 你可以呈现一个简单的 UIImageView 或任何其他的 UIView ，而且不需要关心关闭方法</span><br><span class="line">  UIImageView * imagev = [[UIImageView alloc] initWithImage:[UIImage imageNamed:@&quot;temp.jpg&quot;]];</span><br><span class="line">  UIImageView * bgimgv = [[UIImageView alloc] initWithImage:[UIImage imageNamed:@&quot;background_01&quot;]];</span><br><span class="line">  [self presentSemiView:imagev</span><br><span class="line">            withOptions:@&#123;</span><br><span class="line">                          KNSemiModalOptionKeys.backgroundView:bgimgv</span><br><span class="line">                          &#125;];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="官方-Demo2："><a href="#官方-Demo2：" class="headerlink" title="官方 Demo2："></a>官方 Demo2：</h2><p>显示大小可以改变的视图</p>
<p><img src="http://upload-images.jianshu.io/upload_images/2648731-ccf241a7a3175ff4.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt></p>
<p>部分代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line">@implementation KNSecondViewController</span><br><span class="line"></span><br><span class="line">- (id)initWithNibName:(NSString *)nibNameOrNil bundle:(NSBundle *)nibBundleOrNil &#123;</span><br><span class="line">    self = [super initWithNibName:nibNameOrNil bundle:nibBundleOrNil];</span><br><span class="line">    if (self) &#123;</span><br><span class="line">      self.title = @&quot;Second&quot;;</span><br><span class="line">      self.tabBarItem.image = [UIImage imageNamed:@&quot;second&quot;];</span><br><span class="line"></span><br><span class="line">      // 请注意，你需要拥有正在呈现的ViewController的所有权</span><br><span class="line">      semiVC = [[KNThirdViewController alloc] initWithNibName:@&quot;KNThirdViewController&quot; bundle:nil];</span><br><span class="line"></span><br><span class="line">      // 您可以选择收听通知</span><br><span class="line">      // 视图显示完成后</span><br><span class="line">      [[NSNotificationCenter defaultCenter] addObserver:self</span><br><span class="line">                                               selector:@selector(semiModalPresented:)</span><br><span class="line">                                                   name:kSemiModalDidShowNotification</span><br><span class="line">                                                 object:nil];</span><br><span class="line">      // 视图隐藏后</span><br><span class="line">      [[NSNotificationCenter defaultCenter] addObserver:self</span><br><span class="line">                                               selector:@selector(semiModalDismissed:)</span><br><span class="line">                                                   name:kSemiModalDidHideNotification</span><br><span class="line">                                                 object:nil];</span><br><span class="line">      // 视图被重新调整大小后</span><br><span class="line">      [[NSNotificationCenter defaultCenter] addObserver:self</span><br><span class="line">                                               selector:@selector(semiModalResized:)</span><br><span class="line">                                                   name:kSemiModalWasResizedNotification</span><br><span class="line">                                                 object:nil];</span><br><span class="line">    &#125;</span><br><span class="line">    return self;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#pragma mark - Demo</span><br><span class="line"></span><br><span class="line">- (IBAction)buttonDidTouch:(id)sender &#123;</span><br><span class="line"></span><br><span class="line">  // You can also present a UIViewController with complex views in it</span><br><span class="line">  // and optionally containing an explicit dismiss button for semi modal</span><br><span class="line">  [self presentSemiViewController:semiVC withOptions:@&#123;</span><br><span class="line">		 KNSemiModalOptionKeys.pushParentBack    : @(YES),</span><br><span class="line">		 KNSemiModalOptionKeys.animationDuration : @(2.0),</span><br><span class="line">		 KNSemiModalOptionKeys.shadowOpacity     : @(0.3),</span><br><span class="line">	 &#125;];</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#pragma mark - Optional notifications</span><br><span class="line"></span><br><span class="line">- (void) semiModalResized:(NSNotification *) notification &#123;</span><br><span class="line">  if(notification.object == self)&#123;</span><br><span class="line">    NSLog(@&quot;The view controller presented was been resized&quot;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (void)semiModalPresented:(NSNotification *) notification &#123;</span><br><span class="line">  if (notification.object == self) &#123;</span><br><span class="line">    NSLog(@&quot;This view controller just shown a view with semi modal annimation&quot;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">- (void)semiModalDismissed:(NSNotification *) notification &#123;</span><br><span class="line">  if (notification.object == self) &#123;</span><br><span class="line">    NSLog(@&quot;A view controller was dismissed with semi modal annimation&quot;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">-(void)dealloc &#123;</span><br><span class="line">  [[NSNotificationCenter defaultCenter] removeObserver:self];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>被呈现视图控制器中的动作方法</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">// 关闭视图</span><br><span class="line">- (IBAction)dismissButtonDidTouch:(id)sender &#123;</span><br><span class="line"></span><br><span class="line">  // 调用父控件ViewController 以关闭视图</span><br><span class="line">  // 视图层次结构要小心</span><br><span class="line">  UIViewController * parent = [self.view containingViewController];</span><br><span class="line">  if ([parent respondsToSelector:@selector(dismissSemiModalView)]) &#123;</span><br><span class="line">    [parent dismissSemiModalView];</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 重新设置大小</span><br><span class="line">- (IBAction)resizeSemiModalView:(id)sender &#123;</span><br><span class="line">  UIViewController * parent = [self.view containingViewController];</span><br><span class="line">  if ([parent respondsToSelector:@selector(resizeSemiView:)]) &#123;</span><br><span class="line">    [parent resizeSemiView:CGSizeMake(320, arc4random() % 280 + 180)];</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="官方-Demo3："><a href="#官方-Demo3：" class="headerlink" title="官方 Demo3："></a>官方 Demo3：</h2><p>显示 tableView 列表：</p>
<p><img src="http://upload-images.jianshu.io/upload_images/2648731-f0f8df6d928b1c27.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">- (void)tableView:(UITableView *)tableView didSelectRowAtIndexPath:(NSIndexPath *)indexPath &#123;</span><br><span class="line">  [tableView deselectRowAtIndexPath:indexPath animated:NO];</span><br><span class="line"></span><br><span class="line">  // You have to retain the ownership of ViewController that you are presenting</span><br><span class="line">  // ⚠️必须要保留被呈现视图控制器的拥有权</span><br><span class="line">  // ⚠️就是说被呈现的视图控制器要设置成它的属性或者实例对象</span><br><span class="line">  [self presentSemiViewController:modalVC</span><br><span class="line">                      withOptions:@&#123;</span><br><span class="line">                     KNSemiModalOptionKeys.pushParentBack : @(NO),</span><br><span class="line">                     KNSemiModalOptionKeys.parentAlpha : @(0.8)</span><br><span class="line">                                    &#125;];</span><br><span class="line">  </span><br><span class="line">  // 以下的代码是无效的</span><br><span class="line">//  KNModalTableViewController * vc = [[KNModalTableViewController alloc] initWithStyle:UITableViewStylePlain];</span><br><span class="line">//  [self presentSemiViewController:vc];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>TableView 的 <code>frame</code> 属性在其指定初始化方法中设置：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">- (id)initWithStyle:(UITableViewStyle)style &#123;</span><br><span class="line">  self = [super initWithStyle:style];</span><br><span class="line">  if (self) &#123;</span><br><span class="line">    // 设置 frame</span><br><span class="line">    self.view.frame = CGRectMake(0, 0, 320, 200);</span><br><span class="line">  &#125;</span><br><span class="line">  return self;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="以模态方式显示一张图片"><a href="#以模态方式显示一张图片" class="headerlink" title="以模态方式显示一张图片"></a>以模态方式显示一张图片</h2><p><img src="http://upload-images.jianshu.io/upload_images/2648731-095bbe9100785ad7.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt></p>
<p>实现代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">- (IBAction)buttonDidClicked:(id)sender &#123;</span><br><span class="line">    </span><br><span class="line">    // 加载图片方式一，有缓存</span><br><span class="line">    UIImageView *imageView = [[UIImageView alloc] initWithImage:[UIImage imageNamed:@&quot;boat&quot;]];</span><br><span class="line">    // 加载图片方式二，无缓存</span><br><span class="line">    // NSString *path = [[NSBundle mainBundle] pathForResource:@&quot;boat&quot; ofType:@&quot;png&quot;];</span><br><span class="line">    // UIImage *fileImage = [UIImage imageWithContentsOfFile:path];</span><br><span class="line"></span><br><span class="line">    NSDictionary *options = @&#123;</span><br><span class="line">                  // 父视图后移动画，BOOL类型. default is YES.</span><br><span class="line">                  KNSemiModalOptionKeys.pushParentBack:         @(NO),</span><br><span class="line">                  // 动画延时，double 类型. in seconds. default is 0.5.</span><br><span class="line">                  KNSemiModalOptionKeys.animationDuration:      @(0.25),</span><br><span class="line">                  // 父视图透明度，float 类型.值越小越暗. default is 0.5.</span><br><span class="line">                  KNSemiModalOptionKeys.parentAlpha:            @(0.5),</span><br><span class="line">                  // 父视图缩放比例，double 类型 default is 0.8</span><br><span class="line">                  KNSemiModalOptionKeys.parentScale:            @(1),</span><br><span class="line">                  // 阴影不透明度，default is 0.8</span><br><span class="line">                  KNSemiModalOptionKeys.shadowOpacity:          @(0.6),</span><br><span class="line">                  // 动画类型，NSNumber 类型</span><br><span class="line">                  KNSemiModalOptionKeys.transitionStyle:        @(KNSemiModalTransitionStyleFadeInOut),</span><br><span class="line">                  // 是否禁用取消，BOOL 类型，default is NO.</span><br><span class="line">                  KNSemiModalOptionKeys.disableCancel:          @(NO),</span><br><span class="line">                              &#125;;</span><br><span class="line">    [self presentSemiView:imageView withOptions:options completion:^&#123;</span><br><span class="line">        NSLog(@&quot;completion!&quot;);</span><br><span class="line">    &#125;];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/19/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/19/">19</a><span class="page-number current">20</span><a class="page-number" href="/page/21/">21</a><span class="space">&hellip;</span><a class="page-number" href="/page/32/">32</a><a class="extend next" rel="next" href="/page/21/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <div class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image" src="https://ws1.sinaimg.cn/large/006tNc79gy1g22m14458rj30u014xu0x.jpg" alt="独木舟的木">
            
              <p class="site-author-name" itemprop="name">独木舟的木</p>
              <div class="site-description motion-element" itemprop="description">有时候阳光很好 有时候阳光很暗</div>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/">
                
                    <span class="site-state-item-count">314</span>
                    <span class="site-state-item-name">日志</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-categories">
                  
                    
                      <a href="/categories/">
                    
                  
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">14</span>
                    <span class="site-state-item-name">分类</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-tags">
                  
                    
                      <a href="/tags/">
                    
                  
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">38</span>
                    <span class="site-state-item-name">标签</span>
                  </a>
                </div>
              
            </nav>
          

          
            <div class="feed-link motion-element">
              <a href="/atom.xml" rel="alternate">
                <i class="fa fa-rss"></i>
                RSS
              </a>
            </div>
          

          

          
            <div class="links-of-author motion-element">
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                    
                  
                  <a href="https://github.com/Andy0570" title="GitHub &rarr; https://github.com/Andy0570" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i>GitHub</a>
                </span>
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                    
                  
                  <a href="mailto:andywhm@163.com" title="E-Mail &rarr; mailto:andywhm@163.com" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                </span>
              
            </div>
          

          
             <div class="cc-license motion-element" itemprop="license">
              
              
                
              
              
              
              <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" class="cc-opacity" rel="noopener" target="_blank"><img src="/images/cc-by-nc-sa.svg" alt="Creative Commons"></a>
             </div>
          

          
          

          
            
          
          

        </div>
      </div>

      

      

    </div>
  </aside>
  


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">独木舟的木</span>

  

  
</div>


  <div class="powered-by">由 <a href="https://hexo.io" class="theme-link" rel="noopener" target="_blank">Hexo</a> 强力驱动 v3.8.0</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 – <a href="https://theme-next.org" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> v7.1.0</div>




        








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

    

    
  </div>

  

<script>
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>





  



  






  



  
    
    
      
    
  
  <script color="17,119,176" opacity="0.5" zindex="-1" count="99" src="//cdn.jsdelivr.net/gh/theme-next/theme-next-canvas-nest@1/canvas-nest.min.js"></script>













  
  <script src="//cdn.jsdelivr.net/npm/jquery@2/dist/jquery.min.js"></script>

  
  <script src="//cdn.jsdelivr.net/npm/fastclick@1/lib/fastclick.min.js"></script>

  
  <script src="//cdn.jsdelivr.net/npm/jquery-lazyload@1/jquery.lazyload.min.js"></script>

  
  <script src="//cdn.jsdelivr.net/npm/velocity-animate@1/velocity.min.js"></script>

  
  <script src="//cdn.jsdelivr.net/npm/velocity-animate@1/velocity.ui.min.js"></script>

  
  <script src="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.js"></script>


  


  <script src="/js/utils.js?v=7.1.0"></script>

  <script src="/js/motion.js?v=7.1.0"></script>



  
  


  <script src="/js/affix.js?v=7.1.0"></script>

  <script src="/js/schemes/pisces.js?v=7.1.0"></script>




  

  


  <script src="/js/next-boot.js?v=7.1.0"></script>


  

  

  
  
  
    
  

  
    
      
    
  

  
  
  
    <script src="//cdn.jsdelivr.net/npm/quicklink@1/dist/quicklink.umd.js"></script>
    <script>
      
        window.addEventListener('load', () => {
      
        quicklink({
          timeout: 3000,
          priority: true,
          ignores: [uri => uri.includes('#'),uri => uri == 'https://andy0570.com/page/20/',]
        });
      
        });
      
    </script>
  


  



  



  
  
  
    
  
  <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/instantsearch.js@2/dist/instantsearch.min.css">

  
  
    
  
  <script src="//cdn.jsdelivr.net/npm/instantsearch.js@2/dist/instantsearch.js"></script>
  

  <script src="/js/algolia-search.js?v=7.1.0"></script>



  
  
  <script>
    
    function showTime(Counter) {
      var entries = [];
      var $visitors = $('.leancloud_visitors');

      $visitors.each(function() {
        entries.push( $(this).attr('id').trim() );
      });

      Counter('get', '/classes/Counter', { where: JSON.stringify({ url: { '$in': entries } }) })
        .done(function({ results }) {
          var COUNT_CONTAINER_REF = '.leancloud-visitors-count';

          if (results.length === 0) {
            $visitors.find(COUNT_CONTAINER_REF).text(0);
            return;
          }

          for (var i = 0; i < results.length; i++) {
            var item = results[i];
            var url = item.url;
            var time = item.time;
            var element = document.getElementById(url);

            $(element).find(COUNT_CONTAINER_REF).text(time);
          }
          for (var i = 0; i < entries.length; i++) {
            var url = entries[i];
            var element = document.getElementById(url);
            var countSpan = $(element).find(COUNT_CONTAINER_REF);
            if (countSpan.text() == '') {
              countSpan.text(0);
            }
          }
        })
        .fail(function ({ responseJSON }) {
          console.log('LeanCloud Counter Error: ' + responseJSON.code + ' ' + responseJSON.error);
        });
    }
    

    $(function() {
      $.get('https://app-router.leancloud.cn/2/route?appId=' + 'S7i1Y8YorMKFPaYbJbekD5el-gzGzoHsz')
        .done(function({ api_server }) {
          var Counter = function(method, url, data) {
            return $.ajax({
              method: method,
              url: 'https://' + api_server + '/1.1' + url,
              headers: {
                'X-LC-Id': 'S7i1Y8YorMKFPaYbJbekD5el-gzGzoHsz',
                'X-LC-Key': 'brOnU8mOQvSjpipJvdKUAIbU',
                'Content-Type': 'application/json',
              },
              data: data
            });
          };
          
            if ($('.post-title-link').length >= 1) {
              showTime(Counter);
            }
          
        });
    });
  </script>



  

  

  

  

  

  

  

  

  
  
  
    
  
  <script src="//cdn.jsdelivr.net/npm/pangu@4/dist/browser/pangu.min.js"></script>
  <script>pangu.spacingPage();</script>


  
  
  
    
  
  <script src="//cdn.jsdelivr.net/gh/theme-next/theme-next-bookmark@1/bookmark.min.js"></script>
  <script>
  
    bookmark.loadBookmark();
  
  </script>


  

  

  


  <!-- red heart -->
  <script type="text/javascript" src="/js/src/love.js"></script>
  
</body>
</html>
