<!DOCTYPE html>












  


<html class="theme-next gemini use-motion" lang="zh-CN">
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">




  
  
    
      
    
    
      
    
  <script src="//cdn.jsdelivr.net/npm/pace-js@1/pace.min.js"></script>
  <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/pace-js@1/themes/blue/pace-theme-minimal.css">



  
  
    
  
  <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/han-css@3/dist/han.min.css">













  
  
    
  
  <link rel="stylesheet" href="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.css">







  

<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/font-awesome@4/css/font-awesome.min.css">

<link rel="stylesheet" href="/css/main.css?v=7.1.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/panda/apple-touch-icon.png?v=7.1.0">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/panda/favicon-32x32.png?v=7.1.0">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/panda/favicon-16x16.png?v=7.1.0">


  <link rel="mask-icon" href="/images/panda/safari-pinned-tab.svg?v=7.1.0" color="#222">


  <link rel="manifest" href="/images/panda/site.webmanifest">


  <meta name="msapplication-config" content="/images/panda/browserconfig.xml">





<script id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '7.1.0',
    sidebar: {"position":"left","display":"post","offset":12,"onmobile":false,"dimmer":false},
    back2top: true,
    back2top_sidebar: false,
    fancybox: true,
    fastclick: true,
    lazyload: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  <meta name="description" content="æœ‰æ—¶å€™é˜³å…‰å¾ˆå¥½ æœ‰æ—¶å€™é˜³å…‰å¾ˆæš—">
<meta name="keywords" content="ç‹¬æœ¨èˆŸçš„æœ¨">
<meta property="og:type" content="website">
<meta property="og:title" content="ç‹¬æœ¨èˆŸçš„æœ¨">
<meta property="og:url" content="https://andy0570.com/page/5/index.html">
<meta property="og:site_name" content="ç‹¬æœ¨èˆŸçš„æœ¨">
<meta property="og:description" content="æœ‰æ—¶å€™é˜³å…‰å¾ˆå¥½ æœ‰æ—¶å€™é˜³å…‰å¾ˆæš—">
<meta property="og:locale" content="zh-CN">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="ç‹¬æœ¨èˆŸçš„æœ¨">
<meta name="twitter:description" content="æœ‰æ—¶å€™é˜³å…‰å¾ˆå¥½ æœ‰æ—¶å€™é˜³å…‰å¾ˆæš—">



  <link rel="alternate" href="/atom.xml" title="ç‹¬æœ¨èˆŸçš„æœ¨" type="application/atom+xml">



  
  
  <link rel="canonical" href="https://andy0570.com/page/5/">



<script id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>ç‹¬æœ¨èˆŸçš„æœ¨</title>
  






  <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?8229a094facca297f211d61323fd9fde";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>







  <noscript>
  <style>
  .use-motion .motion-element,
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-title { opacity: initial; }

  .use-motion .logo,
  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-CN">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <a href="https://github.com/andy0570" class="github-corner" aria-label="View source on GitHub"><svg width="80" height="80" viewbox="0 0 250 250" style="fill:#151513; color:#fff; position: absolute; top: 0; border: 0; right: 0;" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"/><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"/><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"/></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style>
    
    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">ç‹¬æœ¨èˆŸçš„æœ¨</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
      
        <p class="site-subtitle">iOS Developer</p>
      
    
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="åˆ‡æ¢å¯¼èˆªæ ">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home">

    
    
    
      
    

    
      
    

    <a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i> <br>é¦–é¡µ</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-categories">

    
    
    
      
    

    
      
    

    <a href="/categories/" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i> <br>åˆ†ç±»<span class="badge">14</span></a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-tags">

    
    
    
      
    

    
      
    

    <a href="/tags/" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i> <br>æ ‡ç­¾<span class="badge">57</span></a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">

    
    
    
      
    

    
      
    

    <a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i> <br>å½’æ¡£<span class="badge">312</span></a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-about">

    
    
    
      
    

    
      
    

    <a href="/about/" rel="section"><i class="menu-item-icon fa fa-fw fa-user"></i> <br>å…³äº</a>

  </li>

      
      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br>æœç´¢</a>
        </li>
      
    </ul>
  

  

  
    <div class="site-search">
      
  
  <div class="algolia-popup popup search-popup">
    <div class="algolia-search">
      <div class="algolia-search-input-icon">
        <i class="fa fa-search"></i>
      </div>
      <div class="algolia-search-input" id="algolia-search-input"></div>
    </div>

    <div class="algolia-results">
      <div id="algolia-stats"></div>
      <div id="algolia-hits"></div>
      <div id="algolia-pagination" class="algolia-pagination"></div>
    </div>

    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
  </div>




    </div>
  
</nav>



  



</div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
            

          
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://andy0570.com/2018/12/05/å…¨çƒç½‘ç»œèº«ä»½ç®¡ç†çš„ç°çŠ¶ä¸å‘å±•/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ç‹¬æœ¨èˆŸçš„æœ¨">
      <meta itemprop="description" content="æœ‰æ—¶å€™é˜³å…‰å¾ˆå¥½ æœ‰æ—¶å€™é˜³å…‰å¾ˆæš—">
      <meta itemprop="image" content="https://ws1.sinaimg.cn/large/006tNc79gy1g22m14458rj30u014xu0x.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ç‹¬æœ¨èˆŸçš„æœ¨">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2018/12/05/å…¨çƒç½‘ç»œèº«ä»½ç®¡ç†çš„ç°çŠ¶ä¸å‘å±•/" class="post-title-link" itemprop="url">å…¨çƒç½‘ç»œèº«ä»½ç®¡ç†çš„ç°çŠ¶ä¸å‘å±•</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              

              
                
              

              <time title="åˆ›å»ºæ—¶é—´ï¼š2018-12-05 10:52:00" itemprop="dateCreated datePublished" datetime="2018-12-05T10:52:00+08:00">2018-12-05</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">æ›´æ–°äº</span>
                
                <time title="ä¿®æ”¹æ—¶é—´ï¼š2019-04-15 17:52:19" itemprop="dateModified" datetime="2019-04-15T17:52:19+08:00">2019-04-15</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/PKI-å¯†ç å­¦/" itemprop="url" rel="index"><span itemprop="name">PKI&å¯†ç å­¦</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          
            <span id="/2018/12/05/å…¨çƒç½‘ç»œèº«ä»½ç®¡ç†çš„ç°çŠ¶ä¸å‘å±•/" class="leancloud_visitors" data-flag-title="å…¨çƒç½‘ç»œèº«ä»½ç®¡ç†çš„ç°çŠ¶ä¸å‘å±•">
              <span class="post-meta-divider">|</span>
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              
                <span class="post-meta-item-text">é˜…è¯»æ¬¡æ•°ï¼š</span>
              
                <span class="leancloud-visitors-count"></span>
            </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body han-init-context" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>ä¹¦åï¼šã€Šå…¨çƒç½‘ç»œèº«ä»½ç®¡ç†çš„ç°çŠ¶ä¸å‘å±•ã€‹</p>
</blockquote>
<blockquote>
<p>æåŠç½‘ç»œèº«ä»½ç®¡ç†ï¼Œæˆ‘ä»¬å¾ˆå®¹æ˜“å°†ä¹‹ç­‰æ•ˆäºâ€œç½‘ç»œå®ååˆ¶â€ã€‚</p>
<p><strong>ç½‘ç»œå®ååˆ¶</strong>æ˜¯ä¸€ç§æ”¿ç­–ï¼Œæ˜¯æ”¿åºœéƒ¨é—¨å¯¹ç½‘ç»œç®¡ç†æ‰€é‡‡å–çš„ä¸€ç§æ¨¡å¼ï¼Œæ˜¯å°†ç½‘ç»œè™šæ‹Ÿèº«ä»½ä¸ç¤¾ä¼šç‰©ç†èº«ä»½ç›¸å¯¹åº”çš„ä¸€ç§è¦æ±‚ï¼›</p>
<p><strong>ç½‘ç»œèº«ä»½ç®¡ç†</strong>åˆ™æ˜¯å¯¹ç½‘ç»œèº«ä»½å”¯ä¸€æ€§åˆ¤å®šã€çœŸå®æ€§é‰´åˆ«çš„ä¸€ç§èƒ½åŠ›è¦æ±‚ã€‚</p>
<p>ç½‘ç»œèº«ä»½ç®¡ç†åœ¨å¯¹ç½‘ç»œç”¨æˆ·ç®¡ç†æ—¶ï¼Œå¯ä»¥é‡‡ç”¨åŸºäºå…¬æ°‘ç½‘ç»œç”µå­èº«ä»½æ ‡è¯†ï¼ˆeIDï¼‰çš„ç®¡ç†æ¨¡å¼æ¥æ”¯æŒç½‘ç»œå®ååˆ¶çš„ç®¡ç†è¦æ±‚ã€‚åŒæ—¶ï¼Œç½‘ç»œèº«ä»½ç®¡ç†æ‰€é¢å¯¹çš„è¿˜å¯ä»¥æ˜¯ç½‘ç»œè®¾å¤‡ã€ä¼äº‹ä¸šæ³•äººã€å®˜æ–¹ä»£è¡¨ç­‰å…·æœ‰ç‰¹å®šç½‘ç»œèº«ä»½çš„è§’è‰²ã€‚</p>
<p>å› æ­¤ï¼Œç½‘ç»œèº«ä»½ç®¡ç†ä¸ç½‘ç»œå®ååˆ¶ä¹‹é—´è™½æœ‰äº›ç›¸é€šä¹‹å¤„ï¼Œä½†æ›´å¤šçš„æ˜¯åŒºåˆ«ã€‚</p>
</blockquote>
<h1 id="ä¸€ã€ç½‘ç»œèº«ä»½ç®¡ç†ç»¼è¿°"><a href="#ä¸€ã€ç½‘ç»œèº«ä»½ç®¡ç†ç»¼è¿°" class="headerlink" title="ä¸€ã€ç½‘ç»œèº«ä»½ç®¡ç†ç»¼è¿°"></a>ä¸€ã€ç½‘ç»œèº«ä»½ç®¡ç†ç»¼è¿°</h1><h3 id="ç½‘ç»œèº«ä»½ç®¡ç†çš„èŒƒå›´"><a href="#ç½‘ç»œèº«ä»½ç®¡ç†çš„èŒƒå›´" class="headerlink" title="ç½‘ç»œèº«ä»½ç®¡ç†çš„èŒƒå›´"></a>ç½‘ç»œèº«ä»½ç®¡ç†çš„èŒƒå›´</h3><ol>
<li>ç½‘ç»œèº«ä»½çš„<strong>äº§ç”Ÿ</strong>â€”â€”ç”¨æˆ·å¦‚ä½•è·å–è‡ªå·±çš„ç½‘ç»œèº«ä»½ï¼Ÿ</li>
<li>ç½‘ç»œèº«ä»½çš„<strong>ä¿æŠ¤</strong>â€”â€”å¦‚ä½•é˜²æ­¢ç½‘ç»œèº«ä»½è¢«ç›—ç”¨æˆ–å†’ç”¨ï¼Ÿå¯†ç å£ä»¤ã€ç”Ÿç‰©è¯†åˆ«æŠ€æœ¯ã€æ•°å­—è¯ä¹¦ã€å®‰å…¨çš„ç½‘ç»œåè®®ã€‚</li>
<li>ç½‘ç»œèº«ä»½çš„<strong>ä½¿ç”¨</strong>â€”â€”ç½‘ç»œèº«ä»½éªŒè¯ã€‚</li>
<li>ç½‘ç»œèº«ä»½çš„<strong>ç»´æŠ¤</strong>â€”â€”ç½‘ç»œèº«ä»½ç”Ÿå‘½å‘¨æœŸçš„ç®¡ç†ã€‚</li>
</ol>
<h3 id="ç½‘ç»œèº«ä»½ç®¡ç†çš„å‚ä¸æ–¹"><a href="#ç½‘ç»œèº«ä»½ç®¡ç†çš„å‚ä¸æ–¹" class="headerlink" title="ç½‘ç»œèº«ä»½ç®¡ç†çš„å‚ä¸æ–¹"></a>ç½‘ç»œèº«ä»½ç®¡ç†çš„å‚ä¸æ–¹</h3><ul>
<li>ä¸ªä½“ï¼›</li>
<li>èº«ä»½æœåŠ¡æä¾›æ–¹/èº«ä»½æä¾›å•†ï¼›</li>
<li>èº«ä»½æ ‡è¯†åŠè½½ä½“ï¼›</li>
<li>ä¾èµ–æ–¹ï¼›</li>
<li>å±æ€§æœåŠ¡æä¾›æ–¹ï¼›</li>
</ul>
<h3 id="ç½‘ç»œèº«ä»½ç®¡ç†éœ€æ±‚"><a href="#ç½‘ç»œèº«ä»½ç®¡ç†éœ€æ±‚" class="headerlink" title="ç½‘ç»œèº«ä»½ç®¡ç†éœ€æ±‚"></a>ç½‘ç»œèº«ä»½ç®¡ç†éœ€æ±‚</h3><h4 id="ä¸€ã€ä¸ªäºº-ä¼ä¸š"><a href="#ä¸€ã€ä¸ªäºº-ä¼ä¸š" class="headerlink" title="ä¸€ã€ä¸ªäºº/ä¼ä¸š"></a>ä¸€ã€ä¸ªäºº/ä¼ä¸š</h4><ol>
<li>ä¾¿åˆ©ï¼›</li>
<li>å®‰å…¨ï¼›</li>
<li>éšç§ï¼›</li>
</ol>
<h4 id="äºŒã€äº’è”ç½‘æœåŠ¡æä¾›æ–¹"><a href="#äºŒã€äº’è”ç½‘æœåŠ¡æä¾›æ–¹" class="headerlink" title="äºŒã€äº’è”ç½‘æœåŠ¡æä¾›æ–¹"></a>äºŒã€äº’è”ç½‘æœåŠ¡æä¾›æ–¹</h4><ol>
<li>ç¡®è®¤ç”¨æˆ·èº«ä»½çš„çœŸå®æ€§å’Œæœ‰æ•ˆæ€§ã€‚</li>
<li>èº«ä»½ç®¡ç†æ–¹æ¡ˆçš„ç»æµæ€§ã€‚</li>
</ol>
<h4 id="ä¸‰ã€æ”¿åºœ"><a href="#ä¸‰ã€æ”¿åºœ" class="headerlink" title="ä¸‰ã€æ”¿åºœ"></a>ä¸‰ã€æ”¿åºœ</h4><ol>
<li>ç»´æŠ¤å›½å®¶å®‰å…¨å’Œç¤¾ä¼šå®‰å…¨ï¼Œæœ‰æ•ˆéåˆ¶ç½‘ç»œæ¬ºè¯ˆã€èº«ä»½ç›—çªƒå’Œåœ¨çº¿ä¿¡æ¯æ»¥ç”¨çš„å¢é•¿ï¼Œé˜²æ­¢ç”±æ­¤é€ æˆçš„ä¸ªäººæˆ–ç»„ç»‡çš„è´¢äº§ã€åèª‰ç­‰å„ç±»æŸå¤±ã€‚</li>
<li>æ¨åŠ¨ä¸ªäººå’Œç»„ç»‡ä½¿ç”¨æƒå¨ã€é«˜æ•ˆã€æ˜“ç”¨å’Œäº’æ“ä½œæ€§çš„èº«ä»½ç®¡ç†è§£å†³æ–¹æ¡ˆå®‰å…¨è®¿é—®åœ¨çº¿æœåŠ¡ã€‚</li>
<li>ä¿æŠ¤å…¬æ°‘éšç§ï¼Œé˜²æ­¢å…¬æ°‘èº«ä»½ä¿¡æ¯è¢«éæ³•è·å–ï¼Œé˜²èŒƒå¤§è§„æ¨¡ç½‘ç»œèº«ä»½ä¿¡æ¯çš„æ³„æ¼ã€‚</li>
</ol>
<h3 id="ç½‘ç»œèº«ä»½ç®¡ç†ä¸ç½‘ç»œå®ååˆ¶çš„åŒºåˆ«"><a href="#ç½‘ç»œèº«ä»½ç®¡ç†ä¸ç½‘ç»œå®ååˆ¶çš„åŒºåˆ«" class="headerlink" title="ç½‘ç»œèº«ä»½ç®¡ç†ä¸ç½‘ç»œå®ååˆ¶çš„åŒºåˆ«"></a>ç½‘ç»œèº«ä»½ç®¡ç†ä¸ç½‘ç»œå®ååˆ¶çš„åŒºåˆ«</h3><ol>
<li>èº«ä»½ä¿¡æ¯çš„é‡‡é›†ã€ä¼ è¾“ã€å­˜å‚¨å’Œä½¿ç”¨å¿…é¡»ä¸¥æ ¼å—æ§ã€‚</li>
<li>å¹¶ä¸æ˜¯æ‰€æœ‰çš„ç½‘ç»œæ´»åŠ¨éƒ½éœ€è¦å®åã€‚</li>
<li>ç½‘ç»œèº«ä»½ç®¡ç†çš„å…³é”®ä½œç”¨æ˜¯<strong>å»ºç«‹ç½‘ç»œä¸Šå„å‚ä¸æ–¹ä¹‹é—´çš„ä¿¡ä»»å…³ç³»</strong>ã€‚</li>
</ol>
<p>ç½‘ç»œå®ååˆ¶çš„åˆè¡·ï¼šé˜²æ­¢åŒ¿åæƒ…å†µä¸‹çš„ç½‘ç»œçŠ¯ç½ªã€‚</p>
<p>ç½‘ç»œå®ååˆ¶å­˜åœ¨çš„é—®é¢˜ï¼šå‹ç¼©å…¬æ°‘è¯‰æ±‚è¡¨è¾¾çš„æ¸ é“ã€ä¸ªäººéšç§æ³„éœ²ã€‚</p>
<h3 id="ç½‘ç»œèº«ä»½ç®¡ç†çš„å…³é”®ä½œç”¨"><a href="#ç½‘ç»œèº«ä»½ç®¡ç†çš„å…³é”®ä½œç”¨" class="headerlink" title="ç½‘ç»œèº«ä»½ç®¡ç†çš„å…³é”®ä½œç”¨"></a>ç½‘ç»œèº«ä»½ç®¡ç†çš„å…³é”®ä½œç”¨</h3><ol>
<li>ä¿éšœç½‘ç»œç©ºé—´å®‰å…¨ã€‚</li>
<li>ä¿æŠ¤ä¸ªäººè´¢äº§å®‰å…¨ä¸éšç§ã€‚</li>
<li>æé«˜ç¤¾ä¼šç®¡ç†å’ŒæœåŠ¡æ•ˆç‡ã€‚</li>
</ol>
<h3 id="èº«ä»½è®¤è¯çš„æ¦‚å¿µçš„æ–¹å¼"><a href="#èº«ä»½è®¤è¯çš„æ¦‚å¿µçš„æ–¹å¼" class="headerlink" title="èº«ä»½è®¤è¯çš„æ¦‚å¿µçš„æ–¹å¼"></a>èº«ä»½è®¤è¯çš„æ¦‚å¿µçš„æ–¹å¼</h3><p>ç½‘ç»œèº«ä»½è®¤è¯çš„ä¸»è¦æ–¹å¼ï¼š</p>
<ol>
<li>ç”¨æˆ·å/å¯†ç ç»„åˆè®¤è¯ï¼›</li>
<li>åŠ¨æ€å£ä»¤è®¤è¯ï¼›</li>
<li>æ™ºèƒ½å¡è®¤è¯ï¼›</li>
<li>çŸ­ä¿¡å¯†ç è®¤è¯ï¼›</li>
<li>æ™ºèƒ½å¯†ç é’¥åŒ™ï¼ˆUSBKeyï¼‰è®¤è¯ï¼›</li>
<li>åŸºäºç”Ÿç‰©ç‰¹æ€§è®¤è¯ï¼›</li>
</ol>
<blockquote>
<p>æœªå®Œå¾…ç»­â€¦</p>
</blockquote>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://andy0570.com/2018/12/04/å¯†ç å­¦â€”å¯†ç ç®—æ³•ä¸åè®®/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ç‹¬æœ¨èˆŸçš„æœ¨">
      <meta itemprop="description" content="æœ‰æ—¶å€™é˜³å…‰å¾ˆå¥½ æœ‰æ—¶å€™é˜³å…‰å¾ˆæš—">
      <meta itemprop="image" content="https://ws1.sinaimg.cn/large/006tNc79gy1g22m14458rj30u014xu0x.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ç‹¬æœ¨èˆŸçš„æœ¨">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2018/12/04/å¯†ç å­¦â€”å¯†ç ç®—æ³•ä¸åè®®/" class="post-title-link" itemprop="url">å¯†ç å­¦â€”å¯†ç ç®—æ³•ä¸åè®®</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              

              
                
              

              <time title="åˆ›å»ºæ—¶é—´ï¼š2018-12-04 15:42:00" itemprop="dateCreated datePublished" datetime="2018-12-04T15:42:00+08:00">2018-12-04</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">æ›´æ–°äº</span>
                
                <time title="ä¿®æ”¹æ—¶é—´ï¼š2019-04-16 00:07:32" itemprop="dateModified" datetime="2019-04-16T00:07:32+08:00">2019-04-16</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/PKI-å¯†ç å­¦/" itemprop="url" rel="index"><span itemprop="name">PKI&å¯†ç å­¦</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          
            <span id="/2018/12/04/å¯†ç å­¦â€”å¯†ç ç®—æ³•ä¸åè®®/" class="leancloud_visitors" data-flag-title="å¯†ç å­¦â€”å¯†ç ç®—æ³•ä¸åè®®">
              <span class="post-meta-divider">|</span>
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              
                <span class="post-meta-item-text">é˜…è¯»æ¬¡æ•°ï¼š</span>
              
                <span class="leancloud-visitors-count"></span>
            </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body han-init-context" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>ä¹¦åï¼šã€Šå¯†ç å­¦â€”â€”å¯†ç ç®—æ³•ä¸åè®®ï¼ˆç¬¬2ç‰ˆï¼‰ã€‹</p>
</blockquote>
<h3 id="æ€ç»´å¯¼å›¾"><a href="#æ€ç»´å¯¼å›¾" class="headerlink" title="æ€ç»´å¯¼å›¾"></a>æ€ç»´å¯¼å›¾</h3><p><img src="https://upload-images.jianshu.io/upload_images/2648731-9507307148a3de2c.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="å¯†ç å­¦"></p>
<h3 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h3><ul>
<li><a href="https://github.com/matt-wu/AES" target="_blank" rel="noopener">AES ç®€ä»‹</a></li>
</ul>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://andy0570.com/2018/11/29/PerfOps-CLI-å¤šåœ°ç‚¹ç½‘ç»œæµ‹è¯•å·¥å…·/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ç‹¬æœ¨èˆŸçš„æœ¨">
      <meta itemprop="description" content="æœ‰æ—¶å€™é˜³å…‰å¾ˆå¥½ æœ‰æ—¶å€™é˜³å…‰å¾ˆæš—">
      <meta itemprop="image" content="https://ws1.sinaimg.cn/large/006tNc79gy1g22m14458rj30u014xu0x.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ç‹¬æœ¨èˆŸçš„æœ¨">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2018/11/29/PerfOps-CLI-å¤šåœ°ç‚¹ç½‘ç»œæµ‹è¯•å·¥å…·/" class="post-title-link" itemprop="url">PerfOps CLI å¤šåœ°ç‚¹ç½‘ç»œæµ‹è¯•å·¥å…·</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              

              
                
              

              <time title="åˆ›å»ºæ—¶é—´ï¼š2018-11-29 13:51:00" itemprop="dateCreated datePublished" datetime="2018-11-29T13:51:00+08:00">2018-11-29</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">æ›´æ–°äº</span>
                
                <time title="ä¿®æ”¹æ—¶é—´ï¼š2019-04-18 09:41:36" itemprop="dateModified" datetime="2019-04-18T09:41:36+08:00">2019-04-18</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/å¼€å‘å·¥å…·-Macåº”ç”¨/" itemprop="url" rel="index"><span itemprop="name">å¼€å‘å·¥å…·&Macåº”ç”¨</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          
            <span id="/2018/11/29/PerfOps-CLI-å¤šåœ°ç‚¹ç½‘ç»œæµ‹è¯•å·¥å…·/" class="leancloud_visitors" data-flag-title="PerfOps CLI å¤šåœ°ç‚¹ç½‘ç»œæµ‹è¯•å·¥å…·">
              <span class="post-meta-divider">|</span>
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              
                <span class="post-meta-item-text">é˜…è¯»æ¬¡æ•°ï¼š</span>
              
                <span class="leancloud-visitors-count"></span>
            </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body han-init-context" itemprop="articleBody">

      
      

      
        
          
            <h1 id="perfops-cli-ä¸€æ¬¾ITè¿ç»´å·¥å…·"><a href="#perfops-cli-ä¸€æ¬¾ITè¿ç»´å·¥å…·" class="headerlink" title="perfops-cli - ä¸€æ¬¾ITè¿ç»´å·¥å…·"></a><a href="https://perfops.net/cli" target="_blank" rel="noopener">perfops-cli</a> - ä¸€æ¬¾ITè¿ç»´å·¥å…·</h1><p><a href="https://github.com/ProspectOne/perfops-cli" target="_blank" rel="noopener">GitHubï¼šperfops-cli</a></p>
<p>PerfOps CLI æ˜¯ä¸€æ¬¾é€‚åˆäºè¿ç»´äººå‘˜ä½¿ç”¨çš„å‘½ä»¤è¡Œå·¥å…·ï¼Œæ–¹ä¾¿ä»å¤šåœ°ç‚¹æ‰§è¡Œ pingã€tracerouteã€mtr ç­‰ç½‘ç»œåŸºå‡†æµ‹è¯•ã€‚<br>PerfOps ä½¿ç”¨ç®€å•ï¼Œä½ å¯ä»¥ä»ä½äºå…¨ä¸–ç•Œçš„æ•°ç™¾ä¸ªèŠ‚ç‚¹å‘ç›®æ ‡åœ°å€å‘èµ·ç½‘ç»œæµ‹è¯•ã€‚åœ¨ä¸è®¾ç½® API å¯†é’¥çš„æ¡ä»¶ä¸‹ï¼Œå®ƒå…è®¸æ¯å°æ—¶è¿›è¡Œ 10 æ¬¡æµ‹è¯•ï¼Œå…è´¹æ³¨å†Œç”¨æˆ·åˆ™å¯ä»¥åœ¨æ¯å°æ—¶å†…å‘èµ·æœ€å¤š 200 æ¬¡æµ‹è¯•ã€‚</p>
<h2 id="Homebrew-MacOS-å®‰è£…æ–¹æ³•"><a href="#Homebrew-MacOS-å®‰è£…æ–¹æ³•" class="headerlink" title="Homebrew - MacOS å®‰è£…æ–¹æ³•"></a>Homebrew - MacOS å®‰è£…æ–¹æ³•</h2><p>ä½¿ç”¨ Homebrew å®‰è£…ï¼š<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">brew tap ProspectOne/perfops</span><br><span class="line">brew install perfops</span><br><span class="line">perfops --help</span><br></pre></td></tr></table></figure></p>
<h2 id="ä½¿ç”¨æ–¹æ³•"><a href="#ä½¿ç”¨æ–¹æ³•" class="headerlink" title="ä½¿ç”¨æ–¹æ³•"></a>ä½¿ç”¨æ–¹æ³•</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> perfops --<span class="built_in">help</span></span></span><br><span class="line">perfops is a simple command line tool to interact with hunderds of servers around the world. Run benchmarks and debug your infrastructure without leaving your console.</span><br><span class="line">perfops æ˜¯ä¸€ä¸ªç®€å•çš„å‘½ä»¤è¡Œå·¥å…·ï¼Œå¯ä¸ä¸–ç•Œå„åœ°çš„æ•°ç™¾å°æœåŠ¡å™¨è¿›è¡Œäº¤äº’ã€‚ æ— éœ€ç¦»å¼€æ§åˆ¶å°å³å¯è¿è¡ŒåŸºå‡†æµ‹è¯•å¹¶è°ƒè¯•åŸºç¡€æ¶æ„ã€‚</span><br><span class="line"></span><br><span class="line">Usage:</span><br><span class="line">  perfops [flags]</span><br><span class="line">  perfops [command]</span><br><span class="line"></span><br><span class="line">Examples:</span><br><span class="line">perfops traceroute --from "New York" google.com</span><br><span class="line"></span><br><span class="line">Available Commands:</span><br><span class="line">  credits     Displays the remaing credits</span><br><span class="line">  curl        Run a curl test on a domain name or IP address</span><br><span class="line">  dnsperf     Find the time it takes to resolve a DNS record on a target</span><br><span class="line">  help        Help about any command</span><br><span class="line">  latency     Run a ICMP latency test on a domain name or IP address</span><br><span class="line">  mtr         Run a MTR test on a domain name or IP address</span><br><span class="line">  ping        Run a ping test on a domain name or IP address</span><br><span class="line">  resolve     Resolve a DNS record on a domain name</span><br><span class="line">  traceroute  Run a traceroute test on a domain name or IP address</span><br><span class="line"></span><br><span class="line">Flags:</span><br><span class="line">      --debug             Enables debug output</span><br><span class="line">  -F, --from string       A continent, region (e.g eastern europe), country, US state or city</span><br><span class="line">  -h, --help              help for perfops</span><br><span class="line">  -J, --json              Print the result of a command in JSON format</span><br><span class="line">  -K, --key string        The PerfOps API key (default is $PERFOPS_API_KEY)</span><br><span class="line">  -N, --nodeid intSlice   A comma separated list of node IDs to run a test from</span><br><span class="line">  -v, --version           Prints the version information of perfops</span><br><span class="line"></span><br><span class="line">Use "perfops [command] --help" for more information about a command.</span><br></pre></td></tr></table></figure>
<h3 id="ping-æµ‹è¯•ç½‘ç»œè¿é€šæ€§"><a href="#ping-æµ‹è¯•ç½‘ç»œè¿é€šæ€§" class="headerlink" title="ping - æµ‹è¯•ç½‘ç»œè¿é€šæ€§"></a>ping - æµ‹è¯•ç½‘ç»œè¿é€šæ€§</h3><ol>
<li><p>ä»äºšæ´²ï¼ˆAsiaï¼‰çš„éšæœºä¸€å°æœåŠ¡å™¨ä¸Š Ping baidu.comï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> perfops ping --from Asia baidu.com</span></span><br><span class="line">Node203, AS45102, Dubai, United Arab Emirates # Node203ï¼ŒAS45102ï¼Œè¿ªæ‹œï¼Œé˜¿æ‹‰ä¼¯è”åˆé…‹é•¿å›½</span><br><span class="line">PING baidu.com (220.181.57.216) 56(84) bytes of data.</span><br><span class="line">64 bytes from 220.181.57.216: icmp_seq=1 ttl=47 time=341 ms</span><br><span class="line">64 bytes from 220.181.57.216: icmp_seq=2 ttl=47 time=342 ms</span><br><span class="line">64 bytes from 220.181.57.216: icmp_seq=3 ttl=47 time=342 ms</span><br><span class="line"></span><br><span class="line">--- baidu.com ping statistics ---</span><br><span class="line">3 packets transmitted, 3 received, 0% packet loss, time 800ms</span><br><span class="line">rtt min/avg/max/mdev = 341.865/342.230/342.800/0.789 ms</span><br></pre></td></tr></table></figure>
</li>
<li><p>ä»äºšæ´²ï¼ˆAsiaï¼‰çš„éšæœºä¸¤å°æœåŠ¡å™¨ä¸Š Ping æŸä¸€ä¸ªIPåœ°å€ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> perfops ping --from Asia 52.14.183.223 --<span class="built_in">limit</span> 2</span></span><br><span class="line">Node297, AS199524, Seoul, South Korea # éŸ©å›½é¦–å°”çš„èŠ‚ç‚¹</span><br><span class="line">PING 52.14.183.223 (52.14.183.223) 56(84) bytes of data.</span><br><span class="line">64 bytes from 52.14.183.223: icmp_seq=1 ttl=39 time=193 ms</span><br><span class="line">64 bytes from 52.14.183.223: icmp_seq=2 ttl=39 time=193 ms</span><br><span class="line">64 bytes from 52.14.183.223: icmp_seq=3 ttl=39 time=193 ms</span><br><span class="line"></span><br><span class="line">--- 52.14.183.223 ping statistics ---</span><br><span class="line">3 packets transmitted, 3 received, 0% packet loss, time 802ms</span><br><span class="line">rtt min/avg/max/mdev = 193.768/193.786/193.814/0.020 ms</span><br><span class="line"></span><br><span class="line">Node112, AS14061, Bangalore, India # Node112ï¼ŒAS14061ï¼Œç­åŠ ç½—å°”ï¼Œå°åº¦</span><br><span class="line">PING 52.14.183.223 (52.14.183.223) 56(84) bytes of data.</span><br><span class="line">64 bytes from 52.14.183.223: icmp_seq=1 ttl=41 time=233 ms</span><br><span class="line">64 bytes from 52.14.183.223: icmp_seq=2 ttl=41 time=232 ms</span><br><span class="line">64 bytes from 52.14.183.223: icmp_seq=3 ttl=41 time=232 ms</span><br><span class="line"></span><br><span class="line">--- 52.14.183.223 ping statistics ---</span><br><span class="line">3 packets transmitted, 3 received, 0% packet loss, time 801ms</span><br><span class="line">rtt min/avg/max/mdev = 232.727/232.975/233.375/0.486 ms</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h3 id="traceroute-å¯¹åŸŸåæˆ–-IP-åœ°å€è¿è¡Œè·¯ç”±è·Ÿè¸ªæµ‹è¯•"><a href="#traceroute-å¯¹åŸŸåæˆ–-IP-åœ°å€è¿è¡Œè·¯ç”±è·Ÿè¸ªæµ‹è¯•" class="headerlink" title="traceroute - å¯¹åŸŸåæˆ– IP åœ°å€è¿è¡Œè·¯ç”±è·Ÿè¸ªæµ‹è¯•"></a>traceroute - å¯¹åŸŸåæˆ– IP åœ°å€è¿è¡Œè·¯ç”±è·Ÿè¸ªæµ‹è¯•</h3><p>ä»ä¸Šæµ·çš„æŸä¸€å°æœåŠ¡å™¨æµ‹è¯• baidu.com çš„è·¯ç”±è·Ÿè¸ªï¼š<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> perfops traceroute --from <span class="string">"Shanghai"</span> baidu.com</span></span><br><span class="line">Node276, AS37963, Shanghai, China</span><br><span class="line">traceroute to baidu.com (123.125.115.110), 20 hops max, 60 byte packets</span><br><span class="line"> 2  11.222.252.181 (11.222.252.181)  5.770 ms  5.911 ms</span><br><span class="line"> 3  11.222.252.10 (11.222.252.10)  5.519 ms  52.961 ms</span><br><span class="line"> 4  11.220.159.58 (11.220.159.58)  1.760 ms  1.863 ms</span><br><span class="line"> 5  116.251.106.157 (116.251.106.157)  2.412 ms  2.402 ms</span><br><span class="line"> 6  140.205.50.225 (140.205.50.225)  2.185 ms  2.189 ms</span><br><span class="line"> 7  140.206.207.205 (140.206.207.205)  3.937 ms  4.036 ms</span><br><span class="line"> 8  140.206.207.29 (140.206.207.29)  4.209 ms  4.247 ms</span><br><span class="line"> 9  * *</span><br><span class="line">10  139.226.227.33 (139.226.227.33)  9.367 ms  9.365 ms</span><br><span class="line">11  219.158.6.165 (219.158.6.165)  30.609 ms  30.525 ms</span><br><span class="line">12  * *</span><br><span class="line">13  61.51.113.246 (61.51.113.246)  25.389 ms  25.578 ms</span><br><span class="line">14  202.106.43.38 (202.106.43.38)  25.545 ms  25.531 ms</span><br><span class="line">15  * *</span><br><span class="line">16  * *</span><br><span class="line">17  123.125.115.110 (123.125.115.110)  25.586 ms  25.594 ms</span><br></pre></td></tr></table></figure></p>
<h3 id="latency-å¯¹åŸŸåæˆ–-IP-åœ°å€è¿è¡Œ-ICMP-å»¶è¿Ÿæµ‹è¯•"><a href="#latency-å¯¹åŸŸåæˆ–-IP-åœ°å€è¿è¡Œ-ICMP-å»¶è¿Ÿæµ‹è¯•" class="headerlink" title="latency - å¯¹åŸŸåæˆ– IP åœ°å€è¿è¡Œ ICMP å»¶è¿Ÿæµ‹è¯•"></a>latency - å¯¹åŸŸåæˆ– IP åœ°å€è¿è¡Œ ICMP å»¶è¿Ÿæµ‹è¯•</h3><p>åˆ†åˆ«åœ¨ä½äºä¸­å›½çš„éšæœº10å°æœåŠ¡å™¨ä¸Šæµ‹è¯• google.com çš„ICMPå»¶è¿Ÿï¼š<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">perfops latency --from China google.com --limit 10</span><br><span class="line">Node208, AS37963, Hangzhou, China # æ­å·ï¼Œ100%ä¸¢åŒ…ğŸ˜‚</span><br><span class="line"><span class="meta">100%</span><span class="bash"> packet loss</span></span><br><span class="line">Node329, AS37963, Hohhot, China # å‘¼å’Œæµ©ç‰¹ï¼Œ100%ä¸¢åŒ…ğŸ˜‚</span><br><span class="line"><span class="meta">100%</span><span class="bash"> packet loss</span></span><br><span class="line">Node207, AS37963, Beijing, China # åŒ—äº¬ã€‚ã€‚ã€‚ğŸ˜‚</span><br><span class="line"><span class="meta">100%</span><span class="bash"> packet loss</span></span><br><span class="line">Node276, AS37963, Shanghai, China # ä¸Šæµ·ã€‚ã€‚ã€‚ğŸ˜‚</span><br><span class="line"><span class="meta">100%</span><span class="bash"> packet loss</span></span><br></pre></td></tr></table></figure></p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://andy0570.com/2018/11/15/Node.js å¼‚æ­¥ç¼–ç¨‹ç¬”è®°/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ç‹¬æœ¨èˆŸçš„æœ¨">
      <meta itemprop="description" content="æœ‰æ—¶å€™é˜³å…‰å¾ˆå¥½ æœ‰æ—¶å€™é˜³å…‰å¾ˆæš—">
      <meta itemprop="image" content="https://ws1.sinaimg.cn/large/006tNc79gy1g22m14458rj30u014xu0x.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ç‹¬æœ¨èˆŸçš„æœ¨">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2018/11/15/Node.js å¼‚æ­¥ç¼–ç¨‹ç¬”è®°/" class="post-title-link" itemprop="url">Node.js å¼‚æ­¥ç¼–ç¨‹ç¬”è®°</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              

              
                
              

              <time title="åˆ›å»ºæ—¶é—´ï¼š2018-11-15 18:00:00" itemprop="dateCreated datePublished" datetime="2018-11-15T18:00:00+08:00">2018-11-15</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">æ›´æ–°äº</span>
                
                <time title="ä¿®æ”¹æ—¶é—´ï¼š2019-04-18 11:09:50" itemprop="dateModified" datetime="2019-04-18T11:09:50+08:00">2019-04-18</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Node-js/" itemprop="url" rel="index"><span itemprop="name">Node.js</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          
            <span id="/2018/11/15/Node.js å¼‚æ­¥ç¼–ç¨‹ç¬”è®°/" class="leancloud_visitors" data-flag-title="Node.js å¼‚æ­¥ç¼–ç¨‹ç¬”è®°">
              <span class="post-meta-divider">|</span>
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              
                <span class="post-meta-item-text">é˜…è¯»æ¬¡æ•°ï¼š</span>
              
                <span class="leancloud-visitors-count"></span>
            </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body han-init-context" itemprop="articleBody">

      
      

      
        
          
            <a id="more"></a>
<h1 id="ä»-Callback-Hell-åˆ°-Promise-åˆ°-Async-Await"><a href="#ä»-Callback-Hell-åˆ°-Promise-åˆ°-Async-Await" class="headerlink" title="ä» Callback Hell åˆ° Promise åˆ° Async/Await"></a>ä» Callback Hell åˆ° Promise åˆ° Async/Await</h1><h3 id="ã€çŸ¥ä¹-Liveã€‘ç‹¼å”ï¼šå¦‚ä½•æ­£ç¡®çš„å­¦ä¹ -Node-js"><a href="#ã€çŸ¥ä¹-Liveã€‘ç‹¼å”ï¼šå¦‚ä½•æ­£ç¡®çš„å­¦ä¹ -Node-js" class="headerlink" title="ã€çŸ¥ä¹ Liveã€‘ç‹¼å”ï¼šå¦‚ä½•æ­£ç¡®çš„å­¦ä¹  Node.js"></a><a href="https://i5ting.github.io/How-to-learn-node-correctly/" target="_blank" rel="noopener">ã€çŸ¥ä¹ Liveã€‘ç‹¼å”ï¼šå¦‚ä½•æ­£ç¡®çš„å­¦ä¹  Node.js</a></h3><p>Node.js å¼‚æ­¥æµç¨‹æ§åˆ¶çš„å­¦ä¹ é‡ç‚¹ï¼š</p>
<ol>
<li>API å†™æ³•ï¼šError-first Callback å’Œ EventEmitterï¼›</li>
<li>ä¸­æµç ¥æŸ±ï¼š<a href="https://github.com/then/promise#readme" target="_blank" rel="noopener">Promise</a>ï¼›</li>
<li>ç»ˆæè§£å†³æ–¹æ¡ˆï¼šAsync/Await</li>
</ol>
<h4 id="å›è°ƒåœ°ç‹±ï¼ˆCallback-Hell-ï¼‰"><a href="#å›è°ƒåœ°ç‹±ï¼ˆCallback-Hell-ï¼‰" class="headerlink" title="å›è°ƒåœ°ç‹±ï¼ˆCallback Hell ï¼‰"></a>å›è°ƒåœ°ç‹±ï¼ˆCallback Hell ï¼‰</h4><p>Node.js é»˜è®¤ä½¿ç”¨å›è°ƒå‡½æ•°ï¼ˆcallbackï¼‰é£æ ¼è¯­æ³•æ¥å®ç°å¼‚æ­¥ç¼–ç¨‹ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Node.js é»˜è®¤çš„å›è°ƒå‡½æ•°é£æ ¼å†™æ³•ï¼ŒCallback Hell</span></span><br><span class="line">step1(<span class="function"><span class="keyword">function</span>(<span class="params">value1</span>) </span>&#123;</span><br><span class="line">  step2(value1, <span class="function"><span class="keyword">function</span>(<span class="params">value2</span>) </span>&#123;</span><br><span class="line">    step3(value2, <span class="function"><span class="keyword">function</span>(<span class="params">value3</span>) </span>&#123;</span><br><span class="line">      step4(value3, <span class="function"><span class="keyword">function</span>(<span class="params">value4</span>) </span>&#123;</span><br><span class="line">        <span class="comment">// Do something with value 4.</span></span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// ES6 ç®­å¤´å‡½æ•°è¯­æ³•ï¼š</span></span><br><span class="line">step1(<span class="function"><span class="params">value1</span> =&gt;</span> &#123;</span><br><span class="line">  step2(value1, value2 =&gt; &#123;</span><br><span class="line">    step3(value2, value3 =&gt; &#123;</span><br><span class="line">      step4(value3, value4 =&gt; &#123;</span><br><span class="line">        <span class="comment">// Do something with value4.</span></span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h4 id="Promise-è¯­æ³•"><a href="#Promise-è¯­æ³•" class="headerlink" title="Promise è¯­æ³•"></a>Promise è¯­æ³•</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">return</span> step1().then(step2).then(step3).then(step4).catch(<span class="function"><span class="keyword">function</span>(<span class="params">err</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// do something with error.</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h3 id="InfoQï¼šå¼‚æ­¥-JavaScript-çš„æ¼”åŒ–å²ï¼šä»å›è°ƒåˆ°-Promise-å†åˆ°-Async-Await-â­ï¸â­ï¸â­ï¸â­ï¸"><a href="#InfoQï¼šå¼‚æ­¥-JavaScript-çš„æ¼”åŒ–å²ï¼šä»å›è°ƒåˆ°-Promise-å†åˆ°-Async-Await-â­ï¸â­ï¸â­ï¸â­ï¸" class="headerlink" title="InfoQï¼šå¼‚æ­¥ JavaScript çš„æ¼”åŒ–å²ï¼šä»å›è°ƒåˆ° Promise å†åˆ° Async/Await â­ï¸â­ï¸â­ï¸â­ï¸"></a><a href="https://www.infoq.cn/article/JQxzWt7FqDc9p7jJ_1hs" target="_blank" rel="noopener">InfoQï¼šå¼‚æ­¥ JavaScript çš„æ¼”åŒ–å²ï¼šä»å›è°ƒåˆ° Promise å†åˆ° Async/Await</a> â­ï¸â­ï¸â­ï¸â­ï¸</h3><h4 id="ä»€ä¹ˆæ˜¯å›è°ƒå‡½æ•°ï¼ˆcallbackï¼‰ï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯å›è°ƒå‡½æ•°ï¼ˆcallbackï¼‰ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯å›è°ƒå‡½æ•°ï¼ˆcallbackï¼‰ï¼Ÿ"></a>ä»€ä¹ˆæ˜¯å›è°ƒå‡½æ•°ï¼ˆcallbackï¼‰ï¼Ÿ</h4><blockquote>
<p>é¦–å…ˆï¼Œå°±åƒå¯ä»¥å°†å­—ç¬¦ä¸²æˆ–æ•°å­—ä»¥å‚æ•°çš„å½¢å¼ä¼ é€’ç»™å‡½æ•°ä¸€æ ·ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥å°†å‡½æ•°çš„å¼•ç”¨ä½œä¸ºå‚æ•°è¿›è¡Œä¼ é€’ã€‚ä½†æˆ‘ä»¬è¿™æ ·åšçš„æ—¶å€™ï¼Œä½œä¸ºå‚æ•°ä¼ é€’çš„å‡½æ•°è¢«ç§°ä¸ºå›è°ƒå‡½æ•°ï¼ˆcallback functionï¼‰ï¼Œè€Œæ¥æ”¶å›è°ƒå‡½æ•°ä¼ å…¥çš„é‚£ä¸ªå‡½æ•°åˆ™è¢«ç§°ä¸ºé«˜é˜¶å‡½æ•°ï¼ˆhigher order functionï¼‰ã€‚</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">add</span>(<span class="params">x, y</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> x + y;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">higherOrderFunction</span>(<span class="params">x, callback</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> callback(x, <span class="number">5</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">higherOrderFunction(<span class="number">10</span>, add);</span><br></pre></td></tr></table></figure>
<p>å›è°ƒçš„ä½¿ç”¨åœºæ™¯ï¼šå°†å‡½æ•°çš„æ‰§è¡Œå»¶è¿Ÿè‡³ä¸€ä¸ªç‰¹å®šçš„æ—¶é—´ã€‚</p>
<h4 id="Promise"><a href="#Promise" class="headerlink" title="Promise"></a>Promise</h4><p><code>Promise</code>ä¼šå¤„äºå¦‚ä¸‹ä¸‰ç§çŠ¶æ€ä¸­çš„æŸä¸€ç§ï¼š <code>pending</code>ã€<code>fulfilled</code>æˆ–<code>rejected</code>ã€‚</p>
<p>å¦‚æœå¼‚æ­¥è¯·æ±‚ä¾ç„¶è¿˜åœ¨è¿›è¡Œï¼Œé‚£ä¹ˆ<code>Promise</code>çš„çŠ¶æ€ä¼šæ˜¯<code>pending</code>ã€‚å¦‚æœå¼‚æ­¥è¯·æ±‚æˆåŠŸå®Œæˆçš„è¯ï¼Œé‚£ä¹ˆ<code>Promise</code>ä¼šå°†çŠ¶æ€è½¬æ¢ä¸º<code>fulfilled</code>ã€‚å¦‚æœå¼‚æ­¥è¯·æ±‚å¤±è´¥çš„è¯ï¼Œ<code>Promise</code>ä¼šå°†çŠ¶æ€è½¬æ¢ä¸º<code>rejected</code>ã€‚</p>
<hr>
<p><code>Promise</code>çš„æ„é€ å‡½æ•°ä¼šæ¥æ”¶ä¸€ä¸ªå‚æ•°ï¼Œè¿™ä¸ªå‚æ•°æ˜¯ä¸€ä¸ªï¼ˆå›è°ƒï¼‰å‡½æ•°ã€‚è¯¥å‡½æ•°ä¼šè¢«ä¼ å…¥ä¸¤ä¸ªå‚æ•°<code>resolve</code>å’Œ<code>reject</code>ã€‚</p>
<p><code>resolve</code>ï¼šä¸€ä¸ªèƒ½å°† Promise çŠ¶æ€å˜ä¸º<code>fulfilled</code>çš„å‡½æ•°ï¼›</p>
<p><code>reject</code>ï¼šä¸€ä¸ªèƒ½å°† Promise çŠ¶æ€å˜ä¸º<code>rejected</code>çš„å‡½æ•°ï¼›</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> promise = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">  setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    resolve(); <span class="comment">// å°†çŠ¶æ€å˜ä¸º"fulfilled"</span></span><br><span class="line">  &#125;, <span class="number">2000</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>å½“ Promise çš„çŠ¶æ€å˜ä¸º<code>fulfilled</code>çš„æ—¶å€™ï¼Œä¼ é€’ç»™<code>.then</code>çš„å‡½æ•°å°†ä¼šè¢«è°ƒç”¨ã€‚å¦‚æœ Promise çš„çŠ¶æ€å˜ä¸º<code>rejected</code>ï¼Œä¼ é€’ç»™<code>.catch</code>çš„å‡½æ•°å°†ä¼šè¢«è°ƒç”¨ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">onSuccess</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'Success'</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">onError</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'Error'</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> promise = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">  setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    resolve(); <span class="comment">// å°†çŠ¶æ€å˜ä¸º"fulfilled"</span></span><br><span class="line">  &#125;, <span class="number">2000</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">promise.then(onSuccess);</span><br><span class="line">promise.catch(onError);</span><br></pre></td></tr></table></figure>
<p>Promise çš„é“¾å¼è¯­æ³•ã€‚</p>
<h4 id="Async-Await"><a href="#Async-Await" class="headerlink" title="Async/Await"></a>Async/Await</h4><p>å¦‚ä½•å®Œå…¨æŒ‰ç…§ç¼–å†™åŒæ­¥ä»£ç çš„æ–¹å¼æ¥ç¼–å†™å¼‚æ­¥ä»£ç ï¼Ÿ</p>
<ol>
<li>é¦–å…ˆï¼Œåªè¦ä½ ä¸ºå‡½æ•°æ·»åŠ <code>async</code>ï¼Œå®ƒå°±ä¼šéšå¼çš„è¿”å›ä¸€ä¸ª Promise å¯¹è±¡ï¼š</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">getPromise</span>(<span class="params"></span>) </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> promise = getPromise();</span><br></pre></td></tr></table></figure>
<ol start="2">
<li>å…¶æ¬¡ï¼Œå¦‚æœ<code>async</code>å‡½æ•°æœ‰è¿”å›å€¼çš„è¯ï¼Œå®ƒä¹Ÿå°†ä¼šåŒ…è£…åˆ°ä¸€ä¸ª Promise ä¸­ã€‚è¿™æ„å‘³ç€ï¼Œä½ å¿…é¡»è¦ä½¿ç”¨<code>.then</code>æ¥è®¿é—®å®ƒã€‚</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">add</span>(<span class="params">x, y</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> x + y;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">add(<span class="number">2</span>, <span class="number">3</span>).then(<span class="function"><span class="params">result</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(result); <span class="comment">// 5</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<ol start="3">
<li><p>ä¸èƒ½å°† <code>await</code> ç”¨åˆ°é <code>async</code> çš„å‡½æ•°ä¸­ã€‚</p>
<p>å½“ä½ å°† <code>await</code> æ·»åŠ åˆ°ä¸€ä¸ªå‡½æ•°ä¸Šçš„æ—¶å€™ï¼šé¦–å…ˆï¼Œå®ƒä¼šè®©è¿™ä¸ªå‡½æ•°æœ¬èº«è¿”å›ä¸€ä¸ª Promiseï¼ˆæˆ–è€…å°†è¿”å›çš„å†…å®¹åŒ…è£…åˆ° Promise ä¸­ï¼‰ï¼›å…¶æ¬¡ï¼Œå®ƒä¼šç¡®ä¿ä½ èƒ½å¤Ÿåœ¨è¿™ä¸ªå‡½æ•°ä¸­ä½¿ç”¨<code>await</code>ã€‚</p>
</li>
</ol>
<h3 id="Node-js-å¼‚æ­¥æœ€ä½³å®è·µ-amp-é¿å…å›è°ƒåœ°ç‹±-RisingStack"><a href="#Node-js-å¼‚æ­¥æœ€ä½³å®è·µ-amp-é¿å…å›è°ƒåœ°ç‹±-RisingStack" class="headerlink" title="Node.js å¼‚æ­¥æœ€ä½³å®è·µ &amp; é¿å…å›è°ƒåœ°ç‹± | @RisingStack"></a><a href="https://juejin.im/entry/589401b68fd9c57277376470" target="_blank" rel="noopener">Node.js å¼‚æ­¥æœ€ä½³å®è·µ &amp; é¿å…å›è°ƒåœ°ç‹± | @RisingStack</a></h3><blockquote>
<p> è¦æˆä¸ºä¸€ä¸ªé«˜æ•ˆçš„ Node.js å¼€å‘è€…ï¼Œä½ å¿…é¡»é¿å…ä¸æ–­å¢åŠ çš„ç¼©è¿›çº§åˆ«ï¼Œä¹¦å†™ç®€æ´ä¸”æ˜“è¯»çš„ä»£ç ï¼Œä»¥åŠå¤„ç†å¤æ‚çš„æµç¨‹ã€‚</p>
<p>å°½å¯èƒ½ä½¿ç”¨å¼‚æ­¥ API è€Œä¸æ˜¯åŒæ­¥ APIã€‚å› ä¸ºéé˜»å¡çš„æ–¹å¼æ¯”åŒæ­¥çš„æ–¹å¼æ€§èƒ½æ›´å¥½ã€‚</p>
</blockquote>
<h3 id="InfoQï¼šJavaScript-å¼‚æ­¥ç¼–ç¨‹çš„-Promise-æ¨¡å¼"><a href="#InfoQï¼šJavaScript-å¼‚æ­¥ç¼–ç¨‹çš„-Promise-æ¨¡å¼" class="headerlink" title="InfoQï¼šJavaScript å¼‚æ­¥ç¼–ç¨‹çš„ Promise æ¨¡å¼"></a><a href="https://www.infoq.cn/article/2011%2F09%2Fjs-promise" target="_blank" rel="noopener">InfoQï¼šJavaScript å¼‚æ­¥ç¼–ç¨‹çš„ Promise æ¨¡å¼</a></h3><p>å…³é”®å­—ï¼š2011 å¹´ 9 æœˆ 15 æ—¥ã€JavaScriptã€Ajax ç¤ºä¾‹ã€‚</p>
<h2 id="Promise-1"><a href="#Promise-1" class="headerlink" title="Promise"></a>Promise</h2><ul>
<li><a href="https://cnodejs.org/topic/560dbc826a1ed28204a1e7de" target="_blank" rel="noopener">Node.js æœ€æ–°æŠ€æœ¯æ ˆä¹‹ Promise ç¯‡</a> â­ï¸â­ï¸â­ï¸</li>
<li><a href="https://cnodejs.org/topic/569c8226adf526da2aeb23fd" target="_blank" rel="noopener">ç†è§£ Promise çš„å·¥ä½œåŸç†</a> â­ï¸</li>
<li><a href="http://liubin.github.io/promises-book/" target="_blank" rel="noopener">Promise è¿·ä½ ä¹¦</a> â­ï¸</li>
<li><a href="https://github.com/petkaantonov/bluebird" target="_blank" rel="noopener">promiseæ¨¡å—ï¼šbluebird</a></li>
<li><a href="https://github.com/kriskowal/q" target="_blank" rel="noopener">promiseæ¨¡å—: q</a></li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å›è°ƒåœ°ç‹±</span></span><br><span class="line">asyncOperation(<span class="function"><span class="keyword">function</span>(<span class="params">data1</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// å¤„ç† data1</span></span><br><span class="line">  anotherAsync(<span class="function"><span class="keyword">function</span>(<span class="params">data2</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// å¤„ç† data2</span></span><br><span class="line">    yetAnotherAsync(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="comment">// å®Œæˆ</span></span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Promise è¯­æ³•</span></span><br><span class="line">promiseSomething()</span><br><span class="line">  .then(<span class="function"><span class="keyword">function</span>(<span class="params">data1</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// å¤„ç† data1</span></span><br><span class="line">    <span class="keyword">return</span> anotherAsync();</span><br><span class="line">  &#125;)</span><br><span class="line">  .then(<span class="function"><span class="keyword">function</span>(<span class="params">data2</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// å¤„ç† data2</span></span><br><span class="line">    <span class="keyword">return</span> yetAnotherAsync();</span><br><span class="line">  &#125;)</span><br><span class="line">  .then(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// å®Œæˆ</span></span><br><span class="line">  &#125;);</span><br></pre></td></tr></table></figure>
<h3 id="Promise-A-è§„èŒƒ"><a href="#Promise-A-è§„èŒƒ" class="headerlink" title="Promise/A è§„èŒƒ"></a>Promise/A è§„èŒƒ</h3><p>promise è¡¨ç¤ºä¸€ä¸ªæœ€ç»ˆå€¼ï¼Œè¯¥å€¼ç”±ä¸€ä¸ªæ“ä½œå®Œæˆæ—¶è¿”å›ã€‚</p>
<ul>
<li>promise æœ‰3ç§çŠ¶æ€ï¼š<strong>æœªå®Œæˆï¼ˆPendingï¼‰</strong>ã€<strong>å®Œæˆï¼ˆFulfilledï¼‰</strong>ã€<strong>å¤±è´¥ï¼ˆRejectedï¼‰</strong>ã€‚</li>
<li>promise çš„çŠ¶æ€è½¬æ¢ï¼š<ul>
<li>æœªå®Œæˆ â¡ï¸ å®Œæˆã€‚</li>
<li>æœªå®Œæˆ â¡ï¸ å¤±è´¥ã€‚</li>
</ul>
</li>
<li>promise çš„çŠ¶æ€è½¬æ¢åªå‘ç”Ÿä¸€æ¬¡ã€‚</li>
</ul>
<p>promise çš„ <code>then()</code> æ–¹æ³•å¯ä»¥æ¥å—3ä¸ªå‡½æ•°ä½œä¸ºå‚æ•°ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">promiseSomething().then(<span class="function"><span class="keyword">function</span>(<span class="params">fulfilled</span>) </span>&#123;</span><br><span class="line"><span class="comment">// å½“ promise çŠ¶æ€å˜æˆ fulfilled æ—¶ï¼Œè°ƒç”¨æ­¤å‡½æ•°ã€‚</span></span><br><span class="line">&#125;, <span class="function"><span class="keyword">function</span>(<span class="params">rejected</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// å½“ promise çŠ¶æ€å˜æˆ rejected æ—¶ï¼Œè°ƒç”¨æ­¤å‡½æ•°</span></span><br><span class="line">&#125;, <span class="function"><span class="keyword">function</span>(<span class="params">progress</span>) </span>&#123;</span><br><span class="line">  <span class="comment">//å½“è¿”å›è¿›åº¦ä¿¡æ¯æ—¶ï¼Œè°ƒç”¨æ­¤å‡½æ•°ï¼ˆå¯é€‰ï¼‰</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h2 id="Async"><a href="#Async" class="headerlink" title="Async"></a>Async</h2><ul>
<li><a href="https://github.com/caolan/async" target="_blank" rel="noopener">async</a></li>
<li><a href="https://caolan.github.io/async/index.html" target="_blank" rel="noopener">Document: async</a></li>
</ul>
<h3 id="async-å‡½æ•°çš„å«ä¹‰å’Œç”¨æ³•-é˜®ä¸€å³°"><a href="#async-å‡½æ•°çš„å«ä¹‰å’Œç”¨æ³•-é˜®ä¸€å³°" class="headerlink" title="async å‡½æ•°çš„å«ä¹‰å’Œç”¨æ³• @é˜®ä¸€å³°"></a><a href="http://es6.ruanyifeng.com/#docs/async" target="_blank" rel="noopener">async å‡½æ•°çš„å«ä¹‰å’Œç”¨æ³• @é˜®ä¸€å³°</a></h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> asyncMethod = <span class="keyword">async</span> () =&gt; &#123;  <span class="comment">// async ç”¨äºå£°æ˜ä¸€ä¸ªå‡½æ•°æ˜¯å¼‚æ­¥çš„ã€‚</span></span><br><span class="line">  <span class="keyword">const</span> f1 = <span class="keyword">await</span> firstMethod();  <span class="comment">// await ç”¨äºç­‰å¾…ä¸€ä¸ªå¼‚æ­¥æ–¹æ³•æ‰§è¡Œå®Œæˆã€‚</span></span><br><span class="line">  <span class="keyword">const</span> f2 = <span class="keyword">await</span> anotherMethod();</span><br><span class="line">  <span class="built_in">console</span>.log(f1, f2);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>async å‡½æ•°å°±æ˜¯ Generator å‡½æ•°çš„è¯­æ³•ç³–ã€‚</p>
<p>async å‡½æ•°å°±æ˜¯å°† Generator å‡½æ•°çš„æ˜Ÿå·ï¼ˆ<code>*</code>ï¼‰æ›¿æ¢æˆ asyncï¼Œå°† yield æ›¿æ¢æˆ awaitï¼Œä»…æ­¤è€Œå·²ã€‚</p>
<p>await å‘½ä»¤åé¢çš„ Promise å¯¹è±¡ï¼Œè¿è¡Œç»“æœå¯èƒ½æ˜¯ rejectedï¼Œæ‰€ä»¥æœ€å¥½æŠŠ await å‘½ä»¤æ”¾åœ¨ tryâ€¦catch ä»£ç å—ä¸­ã€‚</p>
<p>async å‡½æ•°è¿”å›çš„æ˜¯ä¸€ä¸ª Promise å¯¹è±¡ã€‚</p>
<p>await å‘½ä»¤åªèƒ½ç”¨åœ¨ async å‡½æ•°ä¹‹ä¸­ï¼Œå¦‚æœç”¨åœ¨æ™®é€šå‡½æ•°ï¼Œå°±ä¼šæŠ¥é”™ã€‚</p>
</blockquote>
<h3 id="ç†è§£-JavaScript-çš„-async-await-â­ï¸â­ï¸â­ï¸"><a href="#ç†è§£-JavaScript-çš„-async-await-â­ï¸â­ï¸â­ï¸" class="headerlink" title="ç†è§£ JavaScript çš„ async/await â­ï¸â­ï¸â­ï¸"></a><a href="https://segmentfault.com/a/1190000007535316" target="_blank" rel="noopener">ç†è§£ JavaScript çš„ async/await</a> â­ï¸â­ï¸â­ï¸</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">testAsync</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="string">'Hello World'</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> result = testAsync();</span><br><span class="line"><span class="built_in">console</span>.log(result); <span class="comment">// Promise &#123; 'Hello World' &#125;</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>async å‡½æ•°ï¼ˆåŒ…å«å‡½æ•°è¯­å¥ã€å‡½æ•°è¡¨è¾¾å¼ã€Lambda è¡¨è¾¾å¼ï¼‰ä¼šè¿”å›ä¸€ä¸ª Promise å¯¹è±¡ï¼Œå¦‚æœåœ¨å‡½æ•°ä¸­ <code>return</code> ä¸€ä¸ªç›´æ¥é‡ï¼Œasync ä¼šæŠŠè¿™ä¸ªç›´æ¥é‡é€šè¿‡ <code>Promise.resolve()</code> å°è£…æˆ Promise å¯¹è±¡ã€‚</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">testAsync</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="string">'Hello World'</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">testAsync().then(<span class="function"><span class="params">result</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(result); <span class="comment">// Hello World</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h4 id="ç”¨-setTimeout-æ¨¡æ‹Ÿè€—æ—¶æ“ä½œçš„ç¤ºä¾‹"><a href="#ç”¨-setTimeout-æ¨¡æ‹Ÿè€—æ—¶æ“ä½œçš„ç¤ºä¾‹" class="headerlink" title="ç”¨ setTimeout æ¨¡æ‹Ÿè€—æ—¶æ“ä½œçš„ç¤ºä¾‹"></a>ç”¨ <code>setTimeout</code> æ¨¡æ‹Ÿè€—æ—¶æ“ä½œçš„ç¤ºä¾‹</h4><p>Promise è¯­æ³•ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">takeLongTime</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="params">resolve</span> =&gt;</span> &#123;</span><br><span class="line">    setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      resolve(<span class="string">'long_time_value'</span>);</span><br><span class="line">    &#125;, <span class="number">1000</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">takeLongTime().then(<span class="function"><span class="params">result</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(result); <span class="comment">// long_time_value</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>async/await è¯­æ³•ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">takeLongTime</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="params">resolve</span> =&gt;</span> &#123;</span><br><span class="line">    setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      resolve(<span class="string">'long_time_value'</span>);</span><br><span class="line">    &#125;, <span class="number">1000</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">test</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> result = <span class="keyword">await</span> takeLongTime();</span><br><span class="line">  <span class="built_in">console</span>.log(result);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">test();</span><br></pre></td></tr></table></figure>
<h4 id="async-await-çš„ä¼˜åŠ¿åœ¨äºå¤„ç†-then-é“¾ã€‚"><a href="#async-await-çš„ä¼˜åŠ¿åœ¨äºå¤„ç†-then-é“¾ã€‚" class="headerlink" title="async/await çš„ä¼˜åŠ¿åœ¨äºå¤„ç† then é“¾ã€‚"></a>async/await çš„ä¼˜åŠ¿åœ¨äºå¤„ç† then é“¾ã€‚</h4><p>å‡è®¾ä¸€ä¸ªä¸šåŠ¡ï¼Œåˆ†å¤šä¸ªæ­¥éª¤å®Œæˆï¼Œæ¯ä¸ªæ­¥éª¤éƒ½æ˜¯å¼‚æ­¥çš„ï¼Œè€Œä¸”ä¾èµ–äºä¸Šä¸€ä¸ªæ­¥éª¤çš„ç»“æœã€‚æˆ‘ä»¬ä»ç„¶ç”¨ <code>setTimeout</code> æ¥æ¨¡æ‹Ÿå¼‚æ­¥æ“ä½œï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è¿”å›å€¼ï¼štime+200</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">takeLongTime</span>(<span class="params">time</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="params">resolve</span> =&gt;</span> &#123;</span><br><span class="line">    setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> resolve(time + <span class="number">200</span>), time);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">step1</span>(<span class="params">time</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">`step1 with <span class="subst">$&#123;time&#125;</span>`</span>);</span><br><span class="line">  <span class="keyword">return</span> takeLongTime(time);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">step2</span>(<span class="params">time</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">`step2 with <span class="subst">$&#123;time&#125;</span>`</span>);</span><br><span class="line">  <span class="keyword">return</span> takeLongTime(time);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">step3</span>(<span class="params">time</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">`step3 with <span class="subst">$&#123;time&#125;</span>`</span>);</span><br><span class="line">  <span class="keyword">return</span> takeLongTime(time);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>promise è¯­æ³•ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">promiseMethod</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> time = <span class="number">300</span>;</span><br><span class="line">  step1(time)</span><br><span class="line">    .then(<span class="function"><span class="params">time2</span> =&gt;</span> step2(time2))</span><br><span class="line">    .then(<span class="function"><span class="params">time3</span> =&gt;</span> step3(time3))</span><br><span class="line">    .then(<span class="function"><span class="params">result</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">`result is <span class="subst">$&#123;result&#125;</span>`</span>);</span><br><span class="line">    &#125;)</span><br><span class="line">    .catch(<span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">// ä»»ä½•ä¸€ä¸ªæ­¥éª¤æœ‰é”™è¯¯ï¼Œç¨‹åºè·³è½¬åˆ°è¿™é‡Œæ‰§è¡Œã€‚</span></span><br><span class="line">      <span class="built_in">console</span>.log(err);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">promiseMethod();</span><br></pre></td></tr></table></figure>
<p>async/await è¯­æ³•ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">asyncMethod</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> time1 = <span class="number">300</span>;</span><br><span class="line">  <span class="keyword">const</span> time2 = <span class="keyword">await</span> step1(time1);</span><br><span class="line">  <span class="keyword">const</span> time3 = <span class="keyword">await</span> step2(time2);</span><br><span class="line">  <span class="keyword">const</span> result = <span class="keyword">await</span> step3(time3);</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">`result is <span class="subst">$&#123;result&#125;</span>`</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">asyncMethod();</span><br></pre></td></tr></table></figure>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://andy0570.com/2018/11/14/Node.jsç¤ºä¾‹_ä¸²è¡Œ:å¹¶è¡Œæµç¨‹æ§åˆ¶/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ç‹¬æœ¨èˆŸçš„æœ¨">
      <meta itemprop="description" content="æœ‰æ—¶å€™é˜³å…‰å¾ˆå¥½ æœ‰æ—¶å€™é˜³å…‰å¾ˆæš—">
      <meta itemprop="image" content="https://ws1.sinaimg.cn/large/006tNc79gy1g22m14458rj30u014xu0x.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ç‹¬æœ¨èˆŸçš„æœ¨">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2018/11/14/Node.jsç¤ºä¾‹_ä¸²è¡Œ:å¹¶è¡Œæµç¨‹æ§åˆ¶/" class="post-title-link" itemprop="url">Node.jsç¤ºä¾‹_ä¸²è¡Œ/å¹¶è¡Œæµç¨‹æ§åˆ¶</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              

              
                
              

              <time title="åˆ›å»ºæ—¶é—´ï¼š2018-11-14 16:21:00" itemprop="dateCreated datePublished" datetime="2018-11-14T16:21:00+08:00">2018-11-14</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">æ›´æ–°äº</span>
                
                <time title="ä¿®æ”¹æ—¶é—´ï¼š2019-04-20 13:49:01" itemprop="dateModified" datetime="2019-04-20T13:49:01+08:00">2019-04-20</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Node-js/" itemprop="url" rel="index"><span itemprop="name">Node.js</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          
            <span id="/2018/11/14/Node.jsç¤ºä¾‹_ä¸²è¡Œ:å¹¶è¡Œæµç¨‹æ§åˆ¶/" class="leancloud_visitors" data-flag-title="Node.jsç¤ºä¾‹_ä¸²è¡Œ/å¹¶è¡Œæµç¨‹æ§åˆ¶">
              <span class="post-meta-divider">|</span>
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              
                <span class="post-meta-item-text">é˜…è¯»æ¬¡æ•°ï¼š</span>
              
                <span class="leancloud-visitors-count"></span>
            </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body han-init-context" itemprop="articleBody">

      
      

      
        
          <blockquote>
<p>æœ¬æ–‡å†…å®¹ï¼š<br>ç”¨ç®€å•çš„ç¤ºä¾‹ç¨‹åºæè¿° Node.js ä¸²è¡Œå’Œå¹¶è¡ŒåŒ–æµç¨‹æ§åˆ¶çš„åº•å±‚æœºåˆ¶ã€‚<br>å®é™…åº”ç”¨å¼€å‘ä¸­ä»¥ç¤¾åŒºä¸­çš„å·¥å…·ä¸ºä¸»ã€‚æ¯”è¾ƒæµè¡Œçš„æœ‰ <a href="https://caolan.github.io/async/index.html" target="_blank" rel="noopener">Async</a>ã€Stepã€Seq ç­‰ã€‚</p>
</blockquote>
          <!--noindex-->
          
            <div class="post-button text-center">
              <a class="btn" href="/2018/11/14/Node.jsç¤ºä¾‹_ä¸²è¡Œ:å¹¶è¡Œæµç¨‹æ§åˆ¶/#more" rel="contents">
                é˜…è¯»å…¨æ–‡ &raquo;
              </a>
            </div>
          
          <!--/noindex-->
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://andy0570.com/2018/11/13/Node.jsç¤ºä¾‹_CNode RESTful API/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ç‹¬æœ¨èˆŸçš„æœ¨">
      <meta itemprop="description" content="æœ‰æ—¶å€™é˜³å…‰å¾ˆå¥½ æœ‰æ—¶å€™é˜³å…‰å¾ˆæš—">
      <meta itemprop="image" content="https://ws1.sinaimg.cn/large/006tNc79gy1g22m14458rj30u014xu0x.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ç‹¬æœ¨èˆŸçš„æœ¨">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2018/11/13/Node.jsç¤ºä¾‹_CNode RESTful API/" class="post-title-link" itemprop="url">Node.jsç¤ºä¾‹_CNode RESTful API</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              

              
                
              

              <time title="åˆ›å»ºæ—¶é—´ï¼š2018-11-13 13:53:00" itemprop="dateCreated datePublished" datetime="2018-11-13T13:53:00+08:00">2018-11-13</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">æ›´æ–°äº</span>
                
                <time title="ä¿®æ”¹æ—¶é—´ï¼š2019-04-20 13:50:11" itemprop="dateModified" datetime="2019-04-20T13:50:11+08:00">2019-04-20</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Node-js/" itemprop="url" rel="index"><span itemprop="name">Node.js</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          
            <span id="/2018/11/13/Node.jsç¤ºä¾‹_CNode RESTful API/" class="leancloud_visitors" data-flag-title="Node.jsç¤ºä¾‹_CNode RESTful API">
              <span class="post-meta-divider">|</span>
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              
                <span class="post-meta-item-text">é˜…è¯»æ¬¡æ•°ï¼š</span>
              
                <span class="leancloud-visitors-count"></span>
            </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body han-init-context" itemprop="articleBody">

      
      

      
        
          
            <a id="more"></a>
<h2 id="åˆ›å»ºä¸»é¢˜"><a href="#åˆ›å»ºä¸»é¢˜" class="headerlink" title="åˆ›å»ºä¸»é¢˜"></a>åˆ›å»ºä¸»é¢˜</h2><ul>
<li><code>POST /api/v2/topics</code></li>
<li><p>è¯·æ±‚ä½“ï¼š</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  accesstoken: 'string',</span><br><span class="line">  title: 'string',</span><br><span class="line">  tab: &#123; type: 'enum', values: [ 'ask', 'share', 'job' ], required: false &#125;,</span><br><span class="line">  content: 'string',</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>å“åº”çŠ¶æ€ç ï¼š201</p>
</li>
<li>å“åº”ä½“ï¼š<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"topic_id"</span>: <span class="string">"57ea257b3670ca3f44c5beb6"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="å®ç°"><a href="#å®ç°" class="headerlink" title="å®ç°"></a>å®ç°</h2><h3 id="åˆå§‹åŒ–é¡¹ç›®"><a href="#åˆå§‹åŒ–é¡¹ç›®" class="headerlink" title="åˆå§‹åŒ–é¡¹ç›®"></a>åˆå§‹åŒ–é¡¹ç›®</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> npm i egg-init -g    <span class="comment"># å®‰è£…Eggè„šæ‰‹æ¶</span></span></span><br><span class="line"><span class="meta">$</span><span class="bash"> egg-init cnode-api --<span class="built_in">type</span>=simple</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">cd</span> cnode-api</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> npm i</span></span><br></pre></td></tr></table></figure>
<h3 id="å¼€å¯-validate-æ’ä»¶"><a href="#å¼€å¯-validate-æ’ä»¶" class="headerlink" title="å¼€å¯ validate æ’ä»¶"></a>å¼€å¯ validate æ’ä»¶</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// config/plugin.js</span></span><br><span class="line">exports.validate = &#123;</span><br><span class="line">  enable: <span class="literal">true</span>,</span><br><span class="line">  package: <span class="string">'egg-validate'</span>,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h3 id="æ³¨å†Œè·¯ç”±"><a href="#æ³¨å†Œè·¯ç”±" class="headerlink" title="æ³¨å†Œè·¯ç”±"></a>æ³¨å†Œè·¯ç”±</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// app/router.js</span></span><br><span class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="params">app</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// app.resources('routerName', 'pathMatch', controller)</span></span><br><span class="line">  app.router.resources(<span class="string">'topics'</span>, <span class="string">'/api/v2/topics'</span>, app.controller.topics);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>é€šè¿‡ <code>app.resources</code> æ–¹æ³•ï¼Œå°† topics è¿™ä¸ªèµ„æºçš„å¢åˆ æŸ¥æ”¹æ¥å£æ˜ å°„åˆ°äº† <code>app/controller/topics.js</code> æ–‡ä»¶ã€‚</p>
<h3 id="controller-å¼€å‘"><a href="#controller-å¼€å‘" class="headerlink" title="controller å¼€å‘"></a>controller å¼€å‘</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// app/controller/topics.js</span></span><br><span class="line"><span class="keyword">const</span> Controller = <span class="built_in">require</span>(<span class="string">'egg'</span>).Controller;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TopicsController</span> <span class="keyword">extends</span> <span class="title">Controller</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>(ctx) &#123;</span><br><span class="line">    <span class="keyword">super</span>(ctx);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å®šä¹‰åˆ›å»ºæ¥å£çš„è¯·æ±‚å‚æ•°è§„åˆ™</span></span><br><span class="line">    <span class="keyword">this</span>.createRule = &#123;</span><br><span class="line">      accesstoken: <span class="string">'string'</span>,</span><br><span class="line">      title: <span class="string">'string'</span>,</span><br><span class="line">      tab: &#123; <span class="attr">type</span>: <span class="string">'enum'</span>, <span class="attr">values</span>: [ <span class="string">'ask'</span>, <span class="string">'share'</span>, <span class="string">'job'</span> ], <span class="attr">required</span>: <span class="literal">false</span> &#125;,</span><br><span class="line">      content: <span class="string">'string'</span>,</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ------ æ–°å»º ------</span></span><br><span class="line">  <span class="keyword">async</span> create() &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; ctx &#125; = <span class="keyword">this</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 1. è°ƒç”¨ validate æ–¹æ³•å¯¹è¯·æ±‚å‚æ•°è¿›è¡ŒéªŒè¯ã€‚</span></span><br><span class="line">    <span class="comment">// æ ¡éªŒ `ctx.request.body` æ˜¯å¦ç¬¦åˆæˆ‘ä»¬é¢„æœŸçš„æ ¼å¼</span></span><br><span class="line">    <span class="comment">// å¦‚æœå‚æ•°æ ¡éªŒæœªé€šè¿‡ï¼Œå°†ä¼šæŠ›å‡ºä¸€ä¸ª status = 422 çš„å¼‚å¸¸</span></span><br><span class="line">    ctx.validate(<span class="keyword">this</span>.createRule, ctx.request.body);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2. ç”¨éªŒè¯è¿‡çš„å‚æ•°è°ƒç”¨ service å°è£…çš„ä¸šåŠ¡é€»è¾‘æ¥åˆ›å»ºä¸€ä¸ª topicã€‚</span></span><br><span class="line">    <span class="comment">// è°ƒç”¨ service åˆ›å»ºä¸€ä¸ª topic</span></span><br><span class="line">    <span class="keyword">const</span> id = <span class="keyword">await</span> ctx.service.topics.create(ctx.request.body);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 3. æŒ‰ç…§æ¥å£çº¦å®šçš„æ ¼å¼è®¾ç½®å“åº”çŠ¶æ€ç å’Œå†…å®¹ã€‚</span></span><br><span class="line">    <span class="comment">// è®¾ç½®å“åº”ä½“å’ŒçŠ¶æ€ç </span></span><br><span class="line">    ctx.body = &#123;</span><br><span class="line">      topic_id: id,</span><br><span class="line">    &#125;;</span><br><span class="line">    ctx.status = <span class="number">201</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = TopicsController;</span><br></pre></td></tr></table></figure>
<h3 id="service-å¼€å‘"><a href="#service-å¼€å‘" class="headerlink" title="service å¼€å‘"></a>service å¼€å‘</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> Service = <span class="built_in">require</span>(<span class="string">'egg'</span>).Service;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TopicService</span> <span class="keyword">extends</span> <span class="title">Service</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>(ctx) &#123;</span><br><span class="line">    <span class="keyword">super</span>(ctx);</span><br><span class="line">    <span class="keyword">this</span>.root = <span class="string">'https://cnodejs.org/api/v1'</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">async</span> request(url, opts) &#123;</span><br><span class="line">    url = <span class="string">`<span class="subst">$&#123;<span class="keyword">this</span>.root&#125;</span><span class="subst">$&#123;url&#125;</span>`</span>;</span><br><span class="line">    opts = <span class="built_in">Object</span>.assign(&#123;</span><br><span class="line">      timeout: [ <span class="string">'30s'</span>, <span class="string">'30s'</span> ],</span><br><span class="line">      dataType: <span class="string">'json'</span>,</span><br><span class="line">    &#125;, opts);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.ctx.curl(url, opts);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">async</span> create(params) &#123;</span><br><span class="line">    <span class="comment">// è°ƒç”¨ CNode V1 ç‰ˆæœ¬ API</span></span><br><span class="line">    <span class="keyword">const</span> result = <span class="keyword">await</span> <span class="keyword">this</span>.request(<span class="string">'/topics'</span>, &#123;</span><br><span class="line">      method: <span class="string">'post'</span>,</span><br><span class="line">      data: params,</span><br><span class="line">      contentType: <span class="string">'json'</span>,</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ£€æŸ¥è°ƒç”¨æ˜¯å¦æˆåŠŸï¼Œå¦‚æœè°ƒç”¨å¤±è´¥ä¼šæŠ›å‡ºå¼‚å¸¸</span></span><br><span class="line">    <span class="keyword">this</span>.checkSuccess(result);</span><br><span class="line">    <span class="comment">// è¿”å›åˆ›å»ºçš„ topic çš„ id</span></span><br><span class="line">    <span class="keyword">return</span> result.data.topic_id;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// å°è£…ç»Ÿä¸€çš„è°ƒç”¨æ£€æŸ¥å‡½æ•°ï¼Œå¯ä»¥åœ¨æŸ¥è¯¢ã€åˆ›å»ºå’Œæ›´æ–°ç­‰ Service ä¸­å¤ç”¨</span></span><br><span class="line">  checkSuccess(result) &#123;</span><br><span class="line">    <span class="keyword">if</span> (result.status !== <span class="number">200</span>) &#123;</span><br><span class="line">      <span class="keyword">const</span> errorMsg = result.data &amp;&amp; result.data.error_msg ? result.data.error_msg : <span class="string">'unknown error'</span>;</span><br><span class="line">      <span class="keyword">this</span>.ctx.throw(result.status, errorMsg);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (!result.data.success) &#123;</span><br><span class="line">      <span class="comment">// è¿œç¨‹è°ƒç”¨è¿”å›æ ¼å¼é”™è¯¯</span></span><br><span class="line">      <span class="keyword">this</span>.ctx.throw(<span class="number">500</span>, <span class="string">'remote response error'</span>, &#123; <span class="attr">data</span>: result.data &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = TopicService;</span><br></pre></td></tr></table></figure>
<h3 id="ç»Ÿä¸€é”™è¯¯å¤„ç†"><a href="#ç»Ÿä¸€é”™è¯¯å¤„ç†" class="headerlink" title="ç»Ÿä¸€é”™è¯¯å¤„ç†"></a>ç»Ÿä¸€é”™è¯¯å¤„ç†</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// app/middleware/error_handler.js</span></span><br><span class="line"><span class="built_in">module</span>.exports = <span class="function">(<span class="params">option, app</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">errorHandler</span>(<span class="params">ctx, next</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="keyword">await</span> next();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// æ‰€æœ‰çš„å¼‚å¸¸éƒ½åœ¨ app ä¸Šè§¦å‘ä¸€ä¸ª error äº‹ä»¶ï¼Œæ¡†æ¶ä¼šè®°å½•ä¸€æ¡é”™è¯¯æ—¥å¿—</span></span><br><span class="line">      app.emit(<span class="string">'error'</span>, err, <span class="keyword">this</span>);</span><br><span class="line"></span><br><span class="line">      <span class="keyword">const</span> status = err.status || <span class="number">500</span>;</span><br><span class="line">      <span class="comment">// ç”Ÿäº§ç¯å¢ƒæ—¶ 500 é”™è¯¯çš„è¯¦ç»†é”™è¯¯å†…å®¹ä¸è¿”å›ç»™å®¢æˆ·ç«¯ï¼Œå› ä¸ºå¯èƒ½åŒ…å«æ•æ„Ÿä¿¡æ¯</span></span><br><span class="line">      <span class="keyword">const</span> error = (( status === <span class="number">500</span> ) &amp;&amp; ( app.config.env === <span class="string">'prod'</span> ))</span><br><span class="line">        ? <span class="string">'Internal Server Error'</span></span><br><span class="line">        : err.message;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// ä» error å¯¹è±¡ä¸Šè¯»å‡ºå„ä¸ªå±æ€§ï¼Œè®¾ç½®åˆ°å“åº”ä¸­</span></span><br><span class="line">      ctx.body = &#123; error &#125;;</span><br><span class="line">      <span class="keyword">if</span> (status === <span class="number">422</span>) &#123;</span><br><span class="line">        ctx.body.detail = err.errors;</span><br><span class="line">      &#125;</span><br><span class="line">      ctx.status = status;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>é€šè¿‡é…ç½®æ–‡ä»¶ï¼ˆ<code>config/config.default.js</code>ï¼‰åŠ è½½ä¸­é—´ä»¶ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="params">appInfo</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> config = &#123;&#125;;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// should change to your own</span></span><br><span class="line">  config.keys = appInfo.name + <span class="string">'_1490750627161_5967'</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// åŠ è½½ errorHandler ä¸­é—´ä»¶</span></span><br><span class="line">  config.middleware = [ <span class="string">'errorHandler'</span> ];</span><br><span class="line"></span><br><span class="line">  <span class="comment">// é…ç½® errorHandler ä¸­é—´ä»¶ï¼šåªå¯¹ /api å‰ç¼€çš„ url è·¯å¾„ç”Ÿæ•ˆ</span></span><br><span class="line">  config.errorHandler = &#123;</span><br><span class="line">    match: <span class="string">'/api'</span>,</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> config;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><ul>
<li><a href="https://eggjs.org/zh-cn/tutorials/restful.html" target="_blank" rel="noopener">Egg.js æ•™ç¨‹ï¼šå®ç° RESTful API</a></li>
<li><a href="https://cnodejs.org/api" target="_blank" rel="noopener">CNode ç¤¾åŒº API</a></li>
</ul>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://andy0570.com/2018/11/08/Node.jså®æˆ˜_5.Connect è‡ªå¸¦çš„ä¸­é—´ä»¶/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ç‹¬æœ¨èˆŸçš„æœ¨">
      <meta itemprop="description" content="æœ‰æ—¶å€™é˜³å…‰å¾ˆå¥½ æœ‰æ—¶å€™é˜³å…‰å¾ˆæš—">
      <meta itemprop="image" content="https://ws1.sinaimg.cn/large/006tNc79gy1g22m14458rj30u014xu0x.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ç‹¬æœ¨èˆŸçš„æœ¨">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2018/11/08/Node.jså®æˆ˜_5.Connect è‡ªå¸¦çš„ä¸­é—´ä»¶/" class="post-title-link" itemprop="url">Node.jså®æˆ˜_5.Connect è‡ªå¸¦çš„ä¸­é—´ä»¶</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              

              
                
              

              <time title="åˆ›å»ºæ—¶é—´ï¼š2018-11-08 18:42:00" itemprop="dateCreated datePublished" datetime="2018-11-08T18:42:00+08:00">2018-11-08</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">æ›´æ–°äº</span>
                
                <time title="ä¿®æ”¹æ—¶é—´ï¼š2019-04-18 15:07:05" itemprop="dateModified" datetime="2019-04-18T15:07:05+08:00">2019-04-18</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Node-js/" itemprop="url" rel="index"><span itemprop="name">Node.js</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          
            <span id="/2018/11/08/Node.jså®æˆ˜_5.Connect è‡ªå¸¦çš„ä¸­é—´ä»¶/" class="leancloud_visitors" data-flag-title="Node.jså®æˆ˜_5.Connect è‡ªå¸¦çš„ä¸­é—´ä»¶">
              <span class="post-meta-divider">|</span>
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              
                <span class="post-meta-item-text">é˜…è¯»æ¬¡æ•°ï¼š</span>
              
                <span class="leancloud-visitors-count"></span>
            </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body han-init-context" itemprop="articleBody">

      
      

      
        
          
            <a id="more"></a>
<blockquote>
<p>ğŸ’¡<br>è¿™ä¸€ç« æ˜¯ã€ŠNode.js å®æˆ˜ã€‹ç¬”è®°ï¼Œä½†æ˜¯ä¹¦ä¸­çš„æºç å®ç°ä¸å®˜æ–¹æ–‡æ¡£æœ‰å‡ºå…¥ï¼ŒConnect â€œè‡ªå¸¦â€çš„ä¸­é—´ä»¶å¥½åƒæ˜¯éœ€è¦å•ä¸ªç‹¬ç«‹å¯¼å…¥æ‰èƒ½ä½¿ç”¨ã€‚<br>ä»¥ä¸‹ä»…ä½œä¸ºè®°å½•ï¼Œå®é™…é¡¹ç›®ä½¿ç”¨å¾…ç ”ç©¶éªŒè¯ã€‚</p>
</blockquote>
<h1 id="Connect-è‡ªå¸¦çš„ä¸­é—´ä»¶"><a href="#Connect-è‡ªå¸¦çš„ä¸­é—´ä»¶" class="headerlink" title="Connect è‡ªå¸¦çš„ä¸­é—´ä»¶"></a>Connect è‡ªå¸¦çš„ä¸­é—´ä»¶</h1><p>Connect è‡ªå¸¦çš„ä¸­é—´ä»¶å¯ä»¥æ»¡è¶³å¸¸è§çš„Webç¨‹åºå¼€å‘éœ€æ±‚ï¼š</p>
<ul>
<li>ä¼šè¯ç®¡ç†ï¼›</li>
<li>cookie è§£æï¼›</li>
<li>è¯·æ±‚ä¸»ä½“è§£æ</li>
<li>è¯·æ±‚æ—¥å¿—</li>
<li>â€¦</li>
</ul>
<p>ä¸‹é¢çš„è¿™äº›ä¸­é—´ä»¶æ˜¯ç‹¬ç«‹å‘ˆç°çš„ï¼Œéœ€è¦npmå•ç‹¬å¯¼å…¥</p>
<p><img src="http://upload-images.jianshu.io/upload_images/2648731-5d679f520048c40b.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="Connect ä¸­é—´ä»¶"></p>
<p><img src="http://upload-images.jianshu.io/upload_images/2648731-d01e3a9ab1d854d4.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image"></p>
<h2 id="è§£æ-cookieã€è¯·æ±‚ä¸»ä½“å’ŒæŸ¥è¯¢å­—ç¬¦ä¸²çš„ä¸­é—´ä»¶"><a href="#è§£æ-cookieã€è¯·æ±‚ä¸»ä½“å’ŒæŸ¥è¯¢å­—ç¬¦ä¸²çš„ä¸­é—´ä»¶" class="headerlink" title="è§£æ cookieã€è¯·æ±‚ä¸»ä½“å’ŒæŸ¥è¯¢å­—ç¬¦ä¸²çš„ä¸­é—´ä»¶"></a>è§£æ cookieã€è¯·æ±‚ä¸»ä½“å’ŒæŸ¥è¯¢å­—ç¬¦ä¸²çš„ä¸­é—´ä»¶</h2><h3 id="cookieParser-ï¼šè§£æHTTP-cookie"><a href="#cookieParser-ï¼šè§£æHTTP-cookie" class="headerlink" title="cookieParser()ï¼šè§£æHTTP cookie"></a>cookieParser()ï¼šè§£æHTTP cookie</h3><p>Connect çš„ cookie è§£æå™¨æ”¯æŒå¸¸è§„cookieã€ç­¾åcookieå’Œç‰¹æ®Šçš„JSON cookieã€‚<br>req.cookiesé»˜è®¤æ˜¯ç”¨å¸¸è§„æœªç­¾åcookieç»„è£…è€Œæˆçš„ã€‚å¦‚æœä½ æƒ³æ”¯æŒsession()ä¸­é—´ä»¶è¦æ±‚çš„ç­¾åcookieï¼Œåœ¨åˆ›å»ºcookieParser()å®ä¾‹æ—¶è¦ä¼ å…¥ä¸€ä¸ªåŠ å¯†ç”¨çš„å­—ç¬¦ä¸²ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> connect = <span class="built_in">require</span>(<span class="string">'connect'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä½œä¸ºå‚æ•°ä¼ ç»™cookieParser()çš„ç§˜é’¥ç”¨æ¥å¯¹cookieç­¾åå’Œè§£ç­¾</span></span><br><span class="line"><span class="keyword">var</span> app = connect()</span><br><span class="line">    .use(connect.cookieParser(<span class="string">'tobi is a cook ferret'</span>)) </span><br><span class="line">    .use(<span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(req.cookies);</span><br><span class="line">        <span class="built_in">console</span>.log(req.signedCookies);</span><br><span class="line">        res.end(<span class="string">'hello\n'</span>);</span><br><span class="line">    &#125;)</span><br><span class="line">    .listen(<span class="number">3000</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä¸å¸¦cookie</span></span><br><span class="line"><span class="comment">// curl http://localhost:3000/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// å¸¸è§„cookie</span></span><br><span class="line"><span class="comment">// curl http://localhost:3000/ -H "Cookie: foo=bar, bar=baz"</span></span><br></pre></td></tr></table></figure>
<h4 id="ç­¾åcookie"><a href="#ç­¾åcookie" class="headerlink" title="ç­¾åcookie"></a>ç­¾åcookie</h4><p>ç­¾åcookieæ›´é€‚åˆæ•æ„Ÿæ•°æ®ï¼Œå› ä¸ºç”¨å®ƒå¯ä»¥éªŒè¯cookieæ•°æ®çš„å®Œæ•´æ€§ï¼Œæœ‰åŠ©äºé˜²æ­¢ä¸­é—´äººæ”»å‡»ã€‚æœ‰æ•ˆçš„ç­¾åcookieæ”¾åœ¨req.signedCookieså¯¹è±¡ä¸­ã€‚</p>
<p>å‡è®¾ä½ è®¾å®šäº†ä¸€ä¸ªé”®ä¸ºnameï¼Œå€¼ä¸ºlunaçš„ç­¾åcookieã€‚cookieParserä¼šå°†cookieç¼–ç ä¸ºluna.PQLM0wNvqOQEObZXUkWbS5m6Wlgã€‚æ¯ä¸ªè¯·æ±‚ä¸­çš„å“ˆå¸Œå€¼éƒ½ä¼šæ£€æŸ¥ï¼Œå¦‚æœcookieå®Œå¥½æ— æŸåœ°ä¼ ä¸Šæ¥ï¼Œå®ƒä¼šè¢«è§£æä¸ºreq.signedCookies.name:</p>
<h4 id="JSON-cookie"><a href="#JSON-cookie" class="headerlink" title="JSON cookie"></a>JSON cookie</h4><p>ç‰¹åˆ«çš„JSON cookieå¸¦æœ‰å‰ç¼€j:ï¼Œå‘Šè¯‰Connectå®ƒæ˜¯ä¸€ä¸ªä¸²è¡ŒåŒ–çš„JSONã€‚ JSON cookieæ—¢å¯ä»¥æ˜¯ç­¾åçš„ï¼Œä¹Ÿå¯ä»¥æ˜¯æœªç­¾åçš„ã€‚</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl http://localhost:3000/ -H 'Cookie: foo=bar, bar=j:&#123;"foo":"bar"&#125;'</span><br></pre></td></tr></table></figure>
<h4 id="è®¾å®šå‡ºç«™cookie"><a href="#è®¾å®šå‡ºç«™cookie" class="headerlink" title="è®¾å®šå‡ºç«™cookie"></a>è®¾å®šå‡ºç«™cookie</h4><p>cookieParser() ä¸­é—´ä»¶æ²¡æœ‰æä¾›ä»»ä½•é€šè¿‡ Set-Cookie å“åº”å¤´å‘HTTPå®¢æˆ·ç«¯å†™å‡ºç«™cookieçš„åŠŸèƒ½ã€‚ä½†Connectå¯ä»¥é€šè¿‡ res.setHeader()å‡½æ•°å†™å…¥å¤šä¸ªSet-Cookieå“åº”å¤´ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> connect = <span class="built_in">require</span>(<span class="string">'connect'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> app = connect()</span><br><span class="line">    .use(<span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">        res.setHeader(<span class="string">'Set-Cookie'</span>, <span class="string">'foo=bar'</span>); <span class="comment">// è®¾å®šcookieï¼šfoo=bar</span></span><br><span class="line">        res.setHeader(<span class="string">'Set-Cookie'</span>, <span class="string">'tobi=ferret; Expires=Tue, 08 Jun 2021 10:18:14 GMT'</span>); <span class="comment">// è®¾å®šcookieæœ‰æ•ˆæœŸ</span></span><br><span class="line">        res.end();</span><br><span class="line">    &#125;).listen(<span class="number">3000</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// curl http://localhost:3000/ --head</span></span><br></pre></td></tr></table></figure>
<h3 id="bodyParser-ï¼šè§£æè¯·æ±‚ä¸»ä½“"><a href="#bodyParser-ï¼šè§£æè¯·æ±‚ä¸»ä½“" class="headerlink" title="bodyParser()ï¼šè§£æè¯·æ±‚ä¸»ä½“"></a>bodyParser()ï¼šè§£æè¯·æ±‚ä¸»ä½“</h3><p>bodyParser() ç»„ä»¶ä¸ºä½ æä¾›äº†req.body å±æ€§ï¼Œå¯ä»¥ç”¨æ¥è§£æ JSONã€x-www-form-urlencoded å’Œmultipart/form-dataè¯·æ±‚ã€‚å¦‚æœæ˜¯ multipart/form-data è¯·æ±‚ï¼Œæ¯”å¦‚æ–‡ä»¶ä¸Šä¼ ï¼Œåˆ™è¿˜æœ‰req.files å¯¹è±¡ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> app = connect()</span><br><span class="line">    .use(connect.bodyParser())</span><br><span class="line">    .use(<span class="function"><span class="keyword">function</span>(<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">        <span class="comment">// ...æ³¨å†Œç”¨æˆ·</span></span><br><span class="line">        res.end(<span class="string">'Registered new user: '</span> + req.body.username);</span><br><span class="line">    &#125;).listen(<span class="number">3000</span>);</span><br></pre></td></tr></table></figure>
<p>å› ä¸º bodyParser() æ˜¯æ ¹æ® Content-Type è§£ææ•°æ®çš„ï¼Œè¾“å…¥å½¢å¼æ˜¯æŠ½è±¡çš„ï¼Œæ‰€ä»¥ä½ çš„ç¨‹åºä¸­åªéœ€è¦å…³å¿ƒreq.bodyæ•°æ®å¯¹è±¡çš„ç»“æœã€‚</p>
<h3 id="limit-ï¼šè¯·æ±‚ä¸»ä½“çš„é™åˆ¶"><a href="#limit-ï¼šè¯·æ±‚ä¸»ä½“çš„é™åˆ¶" class="headerlink" title="limit()ï¼šè¯·æ±‚ä¸»ä½“çš„é™åˆ¶"></a>limit()ï¼šè¯·æ±‚ä¸»ä½“çš„é™åˆ¶</h3><p>ç›®çš„ï¼šå¸®åŠ©è¿‡æ»¤å·¨å‹çš„è¯·æ±‚ã€‚</p>
<h3 id="query-ï¼šæŸ¥è¯¢å­—ç¬¦ä¸²è§£æ"><a href="#query-ï¼šæŸ¥è¯¢å­—ç¬¦ä¸²è§£æ" class="headerlink" title="query()ï¼šæŸ¥è¯¢å­—ç¬¦ä¸²è§£æ"></a>query()ï¼šæŸ¥è¯¢å­—ç¬¦ä¸²è§£æ</h3><ul>
<li>bodyParser()ï¼šè§£æ POST è¯·æ±‚</li>
<li>query()ï¼šè§£æ GET è¯·æ±‚ã€‚</li>
</ul>
<p>queryä¸­é—´ä»¶å¯ä»¥å°†è¯·æ±‚å‘é€è¿‡æ¥çš„æŸ¥è¯¢å­—ç¬¦ä¸²ä»¥JSONæ ¼å¼ä½œä¸ºå“åº”è¿”å›å»ã€‚</p>
<h2 id="å®ç°-Web-ç¨‹åºæ ¸å¿ƒåŠŸèƒ½çš„ä¸­é—´ä»¶"><a href="#å®ç°-Web-ç¨‹åºæ ¸å¿ƒåŠŸèƒ½çš„ä¸­é—´ä»¶" class="headerlink" title="å®ç° Web ç¨‹åºæ ¸å¿ƒåŠŸèƒ½çš„ä¸­é—´ä»¶"></a>å®ç° Web ç¨‹åºæ ¸å¿ƒåŠŸèƒ½çš„ä¸­é—´ä»¶</h2><ul>
<li>logger()ï¼šæä¾›çµæ´»çš„è¯·æ±‚æ—¥å¿—;</li>
<li>favicon()ï¼šå¸®ä½ å¤„ç†/favicon.icoè¯·æ±‚ï¼ˆfavicon æ˜¯ç½‘ç«™çš„å°å›¾æ ‡ï¼‰;</li>
<li>methodOverride()ï¼šè®©æ²¡æœ‰èƒ½åŠ›çš„å®¢æˆ·ç«¯é€æ˜åœ°é‡å†™req.method;</li>
<li>vhost()ï¼šåœ¨ä¸€ä¸ªæœåŠ¡å™¨ä¸Šè®¾ç½®å¤šä¸ªç½‘ç«™(è™šæ‹Ÿä¸»æœº);</li>
<li>session()ï¼šç®¡ç†ä¼šè¯æ•°æ®ã€‚</li>
</ul>
<h2 id="å¤„ç†-Web-ç¨‹åºå®‰å…¨çš„ä¸­é—´ä»¶"><a href="#å¤„ç†-Web-ç¨‹åºå®‰å…¨çš„ä¸­é—´ä»¶" class="headerlink" title="å¤„ç† Web ç¨‹åºå®‰å…¨çš„ä¸­é—´ä»¶"></a>å¤„ç† Web ç¨‹åºå®‰å…¨çš„ä¸­é—´ä»¶</h2><ul>
<li>basicAuth()ï¼šä¸ºä¿æŠ¤æ•°æ®æä¾›äº†HTTPåŸºæœ¬è®¤è¯;</li>
<li>csrf()ï¼šå®ç°å¯¹è·¨ç«™è¯·æ±‚ä¼ªé€ (CSRF)æ”»å‡»çš„é˜²æŠ¤;</li>
<li>errorhandler()ï¼šå¸®ä½ åœ¨å¼€å‘è¿‡ç¨‹ä¸­è¿›è¡Œè°ƒè¯•ã€‚</li>
</ul>
<h2 id="æä¾›é™æ€æ–‡ä»¶æœåŠ¡çš„ä¸­é—´ä»¶"><a href="#æä¾›é™æ€æ–‡ä»¶æœåŠ¡çš„ä¸­é—´ä»¶" class="headerlink" title="æä¾›é™æ€æ–‡ä»¶æœåŠ¡çš„ä¸­é—´ä»¶"></a>æä¾›é™æ€æ–‡ä»¶æœåŠ¡çš„ä¸­é—´ä»¶</h2><ul>
<li>static()ï¼šå°†æ–‡ä»¶ç³»ç»Ÿä¸­ç»™å®šæ ¹ç›®å½•ä¸‹çš„æ–‡ä»¶è¿”å›ç»™å®¢æˆ·ç«¯;</li>
<li>compress()ï¼šå‹ç¼©å“åº”ï¼Œå¾ˆé€‚åˆè·Ÿstatic()ä¸€èµ·ä½¿ç”¨;</li>
<li>directory()ï¼šå½“è¯·æ±‚çš„æ˜¯ç›®å½•æ—¶ï¼Œè¿”å›é‚£ä¸ªç›®å½•çš„åˆ—è¡¨ã€‚</li>
</ul>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://andy0570.com/2018/11/08/Node.jså®æˆ˜_4.Connect æ¡†æ¶/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ç‹¬æœ¨èˆŸçš„æœ¨">
      <meta itemprop="description" content="æœ‰æ—¶å€™é˜³å…‰å¾ˆå¥½ æœ‰æ—¶å€™é˜³å…‰å¾ˆæš—">
      <meta itemprop="image" content="https://ws1.sinaimg.cn/large/006tNc79gy1g22m14458rj30u014xu0x.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ç‹¬æœ¨èˆŸçš„æœ¨">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2018/11/08/Node.jså®æˆ˜_4.Connect æ¡†æ¶/" class="post-title-link" itemprop="url">Node.jså®æˆ˜_4.Connect æ¡†æ¶</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              

              
                
              

              <time title="åˆ›å»ºæ—¶é—´ï¼š2018-11-08 17:08:00" itemprop="dateCreated datePublished" datetime="2018-11-08T17:08:00+08:00">2018-11-08</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">æ›´æ–°äº</span>
                
                <time title="ä¿®æ”¹æ—¶é—´ï¼š2019-04-18 15:06:47" itemprop="dateModified" datetime="2019-04-18T15:06:47+08:00">2019-04-18</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Node-js/" itemprop="url" rel="index"><span itemprop="name">Node.js</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          
            <span id="/2018/11/08/Node.jså®æˆ˜_4.Connect æ¡†æ¶/" class="leancloud_visitors" data-flag-title="Node.jså®æˆ˜_4.Connect æ¡†æ¶">
              <span class="post-meta-divider">|</span>
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              
                <span class="post-meta-item-text">é˜…è¯»æ¬¡æ•°ï¼š</span>
              
                <span class="leancloud-visitors-count"></span>
            </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body han-init-context" itemprop="articleBody">

      
      

      
        
          
            <a id="more"></a>
<h1 id="Connect"><a href="#Connect" class="headerlink" title="Connect"></a>Connect</h1><p><a href="https://www.npmjs.com/package/connect" target="_blank" rel="noopener">Connect</a>æ˜¯ä¸€ä¸ªæ¡†æ¶ï¼Œå®ƒä½¿ç”¨è¢«ç§°ä¸ºä¸­é—´ä»¶çš„æ¨¡å—åŒ–ç»„ä»¶ï¼Œä»¥å¯é‡ç”¨çš„æ–¹å¼å®ç°Webç¨‹åºä¸­çš„é€»è¾‘ã€‚åœ¨Connectä¸­ï¼Œä¸­é—´ä»¶ç»„ä»¶æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œå®ƒæ‹¦æˆªHTTPæœåŠ¡å™¨æä¾›çš„è¯·æ±‚å’Œå“åº”å¯¹è±¡ï¼Œæ‰§è¡Œé€»è¾‘ï¼Œç„¶åæˆ–è€…ç»“æŸå“åº”ï¼Œæˆ–è€…æŠŠå®ƒä¼ é€’ç»™ä¸‹ä¸€ä¸ªä¸­é—´ä»¶ç»„ä»¶ã€‚Connectç”¨åˆ†æ´¾å™¨æŠŠä¸­é—´ä»¶â€œè¿æ¥â€åœ¨ä¸€èµ·ã€‚</p>
<p><img src="http://upload-images.jianshu.io/upload_images/2648731-1778dea332cd065e.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image"></p>
<h1 id="ä¸€ã€æ­å»ºä¸€ä¸ª-Connect-ç¨‹åº"><a href="#ä¸€ã€æ­å»ºä¸€ä¸ª-Connect-ç¨‹åº" class="headerlink" title="ä¸€ã€æ­å»ºä¸€ä¸ª Connect ç¨‹åº"></a>ä¸€ã€æ­å»ºä¸€ä¸ª Connect ç¨‹åº</h1><p>æœ€å°çš„connectç¨‹åºï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> connect = <span class="built_in">require</span>(<span class="string">'connect'</span>);</span><br><span class="line"><span class="keyword">var</span> app = connect();</span><br><span class="line">app.listen(<span class="number">3000</span>);</span><br></pre></td></tr></table></figure>
<p>è¿™ä¸ªè£¸ç¨‹åºæ²¡æœ‰ä¸­é—´ä»¶ï¼Œæ‰€ä»¥åˆ†æ´¾å™¨ä¼šç”¨404 Not FoundçŠ¶æ€ç å“åº”å®ƒæ”¶åˆ°çš„æ‰€æœ‰HTTPè¯·æ±‚ã€‚</p>
<p>åŸç†ï¼šConnect åˆ†æ´¾å™¨ä¼šä¾æ¬¡è°ƒç”¨æ‰€æœ‰é™„ç€çš„ä¸­é—´ä»¶ç»„ä»¶ï¼Œç›´åˆ°å…¶ä¸­ä¸€ä¸ªå†³å®šå“åº”è¯¥è¯·æ±‚ã€‚å¦‚æœç›´åˆ°ä¸­é—´ä»¶åˆ—è¡¨æœ«å°¾è¿˜æ²¡æœ‰ç»„ä»¶å†³å®šå“åº”ï¼Œç¨‹åºä¼šç”¨404ä½œä¸ºå“åº”ã€‚</p>
<h1 id="äºŒã€Connect-çš„å·¥ä½œæœºåˆ¶"><a href="#äºŒã€Connect-çš„å·¥ä½œæœºåˆ¶" class="headerlink" title="äºŒã€Connect çš„å·¥ä½œæœºåˆ¶"></a>äºŒã€Connect çš„å·¥ä½œæœºåˆ¶</h1><p>åœ¨Connectä¸­ï¼Œä¸­é—´ä»¶ç»„ä»¶æ˜¯ä¸€ä¸ªJavaScriptå‡½æ•°ï¼ŒæŒ‰æƒ¯ä¾‹ä¼šæ¥å—ä¸‰ä¸ªå‚æ•°:ä¸€ä¸ªè¯·æ±‚å¯¹è±¡ï¼Œä¸€ä¸ªå“åº”å¯¹è±¡ï¼Œè¿˜æœ‰ä¸€ä¸ªé€šå¸¸å‘½åä¸ºnextçš„å‚æ•°ï¼Œå®ƒæ˜¯ä¸€ä¸ªå›è°ƒå‡½æ•°ï¼Œè¡¨æ˜è¿™ä¸ªç»„ä»¶å·²ç»å®Œæˆäº†å®ƒçš„å·¥ä½œï¼Œå¯ä»¥æ‰§è¡Œä¸‹ä¸€ä¸ªä¸­é—´ä»¶ç»„ä»¶äº†ã€‚</p>
<h3 id="1-è‡ªå®šä¹‰ä¸­é—´ä»¶"><a href="#1-è‡ªå®šä¹‰ä¸­é—´ä»¶" class="headerlink" title="1. è‡ªå®šä¹‰ä¸­é—´ä»¶"></a>1. è‡ªå®šä¹‰ä¸­é—´ä»¶</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> connect = <span class="built_in">require</span>(<span class="string">'connect'</span>);</span><br><span class="line"><span class="keyword">var</span> app = connect();</span><br><span class="line">app.use(logger);</span><br><span class="line">app.use(hello);</span><br><span class="line">app.listen(<span class="number">3000</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// logger ä¸­é—´ä»¶ç»„ä»¶</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">logger</span>(<span class="params">req, res, next</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// è¾“å‡ºæ¯ä¸ªHTTPè¯·æ±‚çš„æ–¹æ³•å’ŒURLÂ·Â·</span></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'%s %s'</span>, req.method, req.url);</span><br><span class="line">    next();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å“åº” â€œHello Worldâ€ çš„ä¸­é—´ä»¶</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">hello</span>(<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">    res.setHeader(<span class="string">'Content-Type'</span>, <span class="string">'text/plain'</span>);</span><br><span class="line">    res.end(<span class="string">'Hello World!'</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="2-use-å‡½æ•°æ”¯æŒé“¾å¼è°ƒç”¨"><a href="#2-use-å‡½æ•°æ”¯æŒé“¾å¼è°ƒç”¨" class="headerlink" title="2. use() å‡½æ•°æ”¯æŒé“¾å¼è°ƒç”¨"></a>2. use() å‡½æ•°æ”¯æŒé“¾å¼è°ƒç”¨</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> connect = <span class="built_in">require</span>(<span class="string">'connect'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// logger ä¸­é—´ä»¶ç»„ä»¶</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">logger</span>(<span class="params">req, res, next</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// è¾“å‡ºæ¯ä¸ªHTTPè¯·æ±‚çš„æ–¹æ³•å’ŒURLå¹¶è°ƒç”¨ next()</span></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'%s %s'</span>, req.method, req.url);</span><br><span class="line">    next();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å“åº” â€œHello Worldâ€ çš„ä¸­é—´ä»¶</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">hello</span>(<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">    res.setHeader(<span class="string">'Content-Type'</span>, <span class="string">'text/plain'</span>);</span><br><span class="line">    res.end(<span class="string">'Hello World!'</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// use() å‡½æ•°æ”¯æŒé“¾å¼è°ƒç”¨ã€‚ </span></span><br><span class="line">connect()</span><br><span class="line">    .use(logger)</span><br><span class="line">    .use(hello)</span><br><span class="line">    .listen(<span class="number">3000</span>);</span><br></pre></td></tr></table></figure>
<h2 id="ä¸‰ã€ä¸­é—´ä»¶çš„æ‰§è¡Œé¡ºåºå¾ˆé‡è¦"><a href="#ä¸‰ã€ä¸­é—´ä»¶çš„æ‰§è¡Œé¡ºåºå¾ˆé‡è¦" class="headerlink" title="ä¸‰ã€ä¸­é—´ä»¶çš„æ‰§è¡Œé¡ºåºå¾ˆé‡è¦"></a>ä¸‰ã€ä¸­é—´ä»¶çš„æ‰§è¡Œé¡ºåºå¾ˆé‡è¦</h2><ul>
<li>å½“ä¸€ä¸ªç»„ä»¶ä¸è°ƒç”¨ <code>next()</code> æ—¶ï¼Œå‘½ä»¤é“¾ä¸­çš„åç»­ä¸­é—´ä»¶éƒ½ä¸ä¼šè¢«è°ƒç”¨ã€‚</li>
</ul>
<h3 id="1-ç”¨ä¸­é—´ä»¶çš„é¡ºåºæ‰§è¡Œè®¤è¯"><a href="#1-ç”¨ä¸­é—´ä»¶çš„é¡ºåºæ‰§è¡Œè®¤è¯" class="headerlink" title="1. ç”¨ä¸­é—´ä»¶çš„é¡ºåºæ‰§è¡Œè®¤è¯"></a>1. ç”¨ä¸­é—´ä»¶çš„é¡ºåºæ‰§è¡Œè®¤è¯</h3><p>åˆ©ç”¨ä¸­é—´ä»¶çš„é¡ºåºæ‰§è¡Œæœºåˆ¶ï¼Œæ·»åŠ è®¤è¯ã€‚</p>
<p>å‡è®¾ä½ å·²ç»å†™äº†ä¸€ä¸ªå«åš restrictFileAccess çš„ä¸­é—´ä»¶ç»„ä»¶ï¼Œåªå…è®¸æœ‰æ•ˆçš„ç”¨æˆ·è®¿é—®æ–‡ä»¶ã€‚æœ‰æ•ˆç”¨æˆ·å¯ä»¥ç»§ç»­åˆ°ä¸‹ä¸€ä¸ªä¸­é—´ä»¶ç»„ä»¶ï¼Œå¦‚æœç”¨æˆ·æ— æ•ˆï¼Œåˆ™ä¸ä¼šè°ƒç”¨ <code>next()</code>ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> connect = <span class="built_in">require</span>(<span class="string">'connect'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆ©ç”¨ä¸­é—´ä»¶çš„ä½æ¬¡é™åˆ¶æ–‡ä»¶è®¿é—®</span></span><br><span class="line">connect()</span><br><span class="line">    .use(logger)</span><br><span class="line">    .use(restrictFileAccess) <span class="comment">// åªæœ‰æœ‰æ•ˆç”¨æˆ·æ‰ä¼šè°ƒç”¨ next()</span></span><br><span class="line">    .use(serveStaticFiles)</span><br><span class="line">    .use(hello);</span><br></pre></td></tr></table></figure>
<h2 id="å››ã€æŒ‚è½½ä¸­é—´ä»¶å’ŒæœåŠ¡å™¨"><a href="#å››ã€æŒ‚è½½ä¸­é—´ä»¶å’ŒæœåŠ¡å™¨" class="headerlink" title="å››ã€æŒ‚è½½ä¸­é—´ä»¶å’ŒæœåŠ¡å™¨"></a>å››ã€æŒ‚è½½ä¸­é—´ä»¶å’ŒæœåŠ¡å™¨</h2><p>æŒ‚è½½ï¼šç»™ä¸­é—´ä»¶æˆ–æ•´ä¸ªç¨‹åºå®šä¹‰ä¸€ä¸ªè·¯å¾„å‰ç¼€ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> connect = <span class="built_in">require</span>(<span class="string">'connect'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// å½“ .use() çš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ä¸ªå­—ç¬¦ä¸²æ—¶ï¼Œåªæœ‰ URL å‰ç¼€ä¸ä¹‹åŒ¹é…æ—¶ï¼Œconnect æ‰ä¼šè°ƒç”¨åé¢çš„ä¸­é—´ä»¶</span></span><br><span class="line"><span class="comment">// restrict ç»„ä»¶ç¡®ä¿è®¿é—®é¡µé¢çš„æ˜¯æœ‰æ•ˆç”¨æˆ·;</span></span><br><span class="line"><span class="comment">// admin ç»„ä»¶ä¼šç»™ç”¨æˆ·å‘ˆç°ç®¡ç†åŒºã€‚</span></span><br><span class="line">connect()</span><br><span class="line">    .use(logger)</span><br><span class="line">    .use(<span class="string">'/admin'</span>, restrict)</span><br><span class="line">    .use(<span class="string">'/admin'</span>, admin)</span><br><span class="line">    .use(hello)</span><br><span class="line">    .listen(<span class="number">3000</span>);</span><br></pre></td></tr></table></figure>
<h3 id="1-è®¤è¯ä¸­é—´ä»¶"><a href="#1-è®¤è¯ä¸­é—´ä»¶" class="headerlink" title="1. è®¤è¯ä¸­é—´ä»¶"></a>1. è®¤è¯ä¸­é—´ä»¶</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ç®€å•çš„ Basic è®¤è¯é€»è¾‘</span></span><br><span class="line"><span class="comment">// å€ŸåŠ©å¸¦ç€ Base64 ç¼–ç è®¤è¯ä¿¡æ¯çš„HTTPè¯·æ±‚å¤´ä¸­çš„authorizationå­—æ®µè¿›è¡Œè®¤è¯</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">restrict</span>(<span class="params">req, res, next</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> authorization = req.headers.authorization;</span><br><span class="line">    <span class="keyword">if</span> (!authorization) &#123;</span><br><span class="line">        <span class="comment">// ç”¨ Error å¯¹è±¡åšå‚æ•°è°ƒç”¨ next()ï¼Œç›¸å½“äºé€šçŸ¥Connectç¨‹åºä¸­å‡ºç°äº†é”™è¯¯</span></span><br><span class="line">        <span class="keyword">return</span> next(<span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'Unauthorized'</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> parts = authorization.split(<span class="string">' '</span>);</span><br><span class="line">    <span class="keyword">var</span> scheme = parts[<span class="number">0</span>];</span><br><span class="line">    <span class="keyword">var</span> auth = <span class="keyword">new</span> Buffer(parts[<span class="number">1</span>], <span class="string">'base64'</span>).toString().split(<span class="string">':'</span>);</span><br><span class="line">    <span class="keyword">var</span> user = auth[<span class="number">0</span>];</span><br><span class="line">    <span class="keyword">var</span> pass = auth[<span class="number">1</span>];</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ ¹æ®æ•°æ®åº“ä¸­çš„è®°å½•æ£€æŸ¥è®¤è¯ä¿¡æ¯çš„å‡½æ•°</span></span><br><span class="line">    authenticateWithDatabase(user, pass, <span class="function"><span class="keyword">function</span> (<span class="params">err</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (err) &#123;</span><br><span class="line">            <span class="keyword">return</span> next(err);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// å¦‚æœè®¤è¯ä¿¡æ¯æœ‰æ•ˆï¼Œä¸å¸¦å‚æ•°è°ƒç”¨next()</span></span><br><span class="line">        next();</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="2-æ˜¾ç¤ºç®¡ç†é¢æ¿çš„ä¸­é—´ä»¶"><a href="#2-æ˜¾ç¤ºç®¡ç†é¢æ¿çš„ä¸­é—´ä»¶" class="headerlink" title="2. æ˜¾ç¤ºç®¡ç†é¢æ¿çš„ä¸­é—´ä»¶"></a>2. æ˜¾ç¤ºç®¡ç†é¢æ¿çš„ä¸­é—´ä»¶</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è·¯ç”± admin è¯·æ±‚</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">admin</span>(<span class="params">req, res, next</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">switch</span> (req.url) &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">'/'</span>:</span><br><span class="line">            res.end(<span class="string">'try /users'</span>);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">'/users'</span>:</span><br><span class="line">            res.setHeader(<span class="string">'Content-Type'</span>, <span class="string">'application/json'</span>);</span><br><span class="line">            res.end(<span class="built_in">JSON</span>.stringify([<span class="string">'tobi'</span>, <span class="string">'loki'</span>, <span class="string">'jane'</span>]));</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ğŸ’¡ğŸ’¡ğŸ’¡</span></span><br><span class="line"><span class="comment">// case ä¸­çš„å­—ç¬¦ä¸²æ˜¯ / å’Œ /usersã€‚</span></span><br><span class="line"><span class="comment">// è€Œå®é™…è¯·æ±‚çš„å­—ç¬¦ä¸²æ˜¯ /admin å’Œ /admin/usersã€‚</span></span><br><span class="line"><span class="comment">// è¿™æ˜¯å› ä¸ºåœ¨è°ƒç”¨ä¸­é—´ä»¶ä¹‹å‰ï¼ŒConnectä»req.urlä¸­å»æ‰äº†å‰ç¼€ï¼Œå°±åƒURLæŒ‚è½½åœ¨/ä¸Šä¸€æ ·ã€‚</span></span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> connect = <span class="built_in">require</span>(<span class="string">'connect'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// åœ¨ä¸¤ä¸ªä¸åŒçš„æŒ‚è½½ç‚¹æŒ‚è½½blogç¨‹åº</span></span><br><span class="line">connect()</span><br><span class="line">    .use(logger)</span><br><span class="line">    .use(<span class="string">'/blog'</span>, blog)</span><br><span class="line">    .use(<span class="string">'/posts'</span>, blog)</span><br><span class="line">    .use(hello)</span><br><span class="line">    .listen(<span class="number">3000</span>);</span><br></pre></td></tr></table></figure>
<h2 id="äº”ã€åˆ›å»ºå¯é…ç½®ä¸­é—´ä»¶"><a href="#äº”ã€åˆ›å»ºå¯é…ç½®ä¸­é—´ä»¶" class="headerlink" title="äº”ã€åˆ›å»ºå¯é…ç½®ä¸­é—´ä»¶"></a>äº”ã€åˆ›å»ºå¯é…ç½®ä¸­é—´ä»¶</h2><p>åˆ›å»ºæ›´é€šç”¨ã€å¯é‡ç”¨çš„ä¸­é—´ä»¶ã€‚</p>
<p>ä¸ºäº†å‘å¼€å‘äººå‘˜æä¾›å¯é…ç½®çš„èƒ½åŠ›ï¼Œä¸­é—´ä»¶é€šå¸¸ä¼šéµå¾ªä¸€ä¸ªç®€å•çš„æƒ¯ä¾‹ï¼š<strong>ç”¨å‡½æ•°è¿”å›å¦ä¸€ä¸ªå‡½æ•°</strong>(è¿™æ˜¯ä¸€ä¸ªå¼ºå¤§çš„JavaScriptç‰¹æ€§ï¼Œé€šå¸¸ç§°ä¸ºé—­åŒ…)ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">setup</span>(<span class="params">options</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// è®¾ç½®é€»è¾‘</span></span><br><span class="line">    <span class="comment">// è½½è¿™é‡Œåšä¸­é—´ä»¶çš„åˆå§‹åŒ–</span></span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params">req, res, next</span>) </span>&#123;</span><br><span class="line">        <span class="comment">// ä¸­é—´ä»¶é€»è¾‘</span></span><br><span class="line">        <span class="comment">// å³ä½¿è¢«å¤–éƒ¨å‡½æ•°è¿”å›äº†ï¼Œä»ç„¶å¯ä»¥è®¿é—®options</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä½¿ç”¨å¦‚ä¸‹</span></span><br><span class="line">app.use(setup(&#123;<span class="attr">some</span>: <span class="string">'options'</span>&#125;));</span><br></pre></td></tr></table></figure>
<h3 id="1-å¯é…ç½®çš„loggerä¸­é—´ä»¶ç»„ä»¶"><a href="#1-å¯é…ç½®çš„loggerä¸­é—´ä»¶ç»„ä»¶" class="headerlink" title="1. å¯é…ç½®çš„loggerä¸­é—´ä»¶ç»„ä»¶"></a>1. å¯é…ç½®çš„loggerä¸­é—´ä»¶ç»„ä»¶</h3><p>å¯é…ç½®çš„ä¸­é—´ä»¶å¯ä»¥ä¼ å…¥é¢å¤–çš„å‚æ•°æ¥æ”¹å˜ä»–çš„è¡Œä¸º</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å¯é…ç½®çš„Connectä¸­é—´ä»¶ç»„ä»¶</span></span><br><span class="line"><span class="comment">// setup å‡½æ•°å¯ä»¥ç”¨ä¸åŒçš„é…ç½®è°ƒç”¨å¤šæ¬¡</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">setup</span>(<span class="params">format</span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// logger ç»„ä»¶ç”¨æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…è¯·æ±‚å±æ€§</span></span><br><span class="line">    <span class="keyword">var</span> regexp = <span class="regexp">/:(\w+)/g</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> <span class="title">logger</span>(<span class="params">req, res, next</span>) </span>&#123; <span class="comment">// Connectä½¿ç”¨çš„çœŸå®loggerç»„ä»¶</span></span><br><span class="line">        <span class="comment">// ç”¨æ­£åˆ™è¡¨è¾¾å¼æ ¼å¼åŒ–è¯·æ±‚çš„æ—¥å¿—æ¡ç›®</span></span><br><span class="line">        <span class="keyword">var</span> str = format.replace(regexp, <span class="function"><span class="keyword">function</span> (<span class="params">match, property</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> req[property];</span><br><span class="line">        &#125;)</span><br><span class="line">        <span class="built_in">console</span>.log(str);<span class="comment">// è¾“å‡ºæ—¥å¿—æ¡ç›®åˆ°æ§åˆ¶å°</span></span><br><span class="line">        next(); <span class="comment">// å°†æ§åˆ¶æƒäº¤ç»™ä¸‹ä¸€ä¸ªä¸­é—´ä»¶ç»„ä»¶</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = setup; <span class="comment">// å¯¼å‡º logger çš„ setup å‡½æ•°</span></span><br></pre></td></tr></table></figure>
<h3 id="2-æ„å»ºè·¯ç”±ä¸­é—´ä»¶ç»„ä»¶"><a href="#2-æ„å»ºè·¯ç”±ä¸­é—´ä»¶ç»„ä»¶" class="headerlink" title="2. æ„å»ºè·¯ç”±ä¸­é—´ä»¶ç»„ä»¶"></a>2. æ„å»ºè·¯ç”±ä¸­é—´ä»¶ç»„ä»¶</h3><p>è·¯ç”±ï¼šæŠŠè¯·æ±‚URLæ˜ å°„åˆ°å®ç°ä¸šåŠ¡é€»è¾‘çš„å‡½æ•°ä¸Šã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä½¿ç”¨ router ä¸­é—´ä»¶ç»„ä»¶</span></span><br><span class="line"><span class="keyword">const</span> connect = <span class="built_in">require</span>(<span class="string">'connect'</span>);</span><br><span class="line"><span class="keyword">const</span> router = <span class="built_in">require</span>(<span class="string">'./middleware/router'</span>); <span class="comment">// è·¯ç”±å™¨ç»„ä»¶</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// å®šä¹‰è·¯ç”±çš„å¯¹è±¡</span></span><br><span class="line"><span class="keyword">var</span> routers = &#123;</span><br><span class="line">    GET: &#123;</span><br><span class="line">        <span class="comment">// å…¶ä¸­çš„æ¯ä¸€é¡¹éƒ½æ˜¯å¯¹è¯·æ±‚URLçš„æ˜ å°„ï¼Œå¹¶åŒ…å«è¦è°ƒç”¨çš„å›è°ƒå‡½æ•°</span></span><br><span class="line">        <span class="string">'/users'</span>: <span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">            res.end(<span class="string">'tobi, loki, ferret'</span>);</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">'/user/:id'</span>: <span class="function"><span class="keyword">function</span> (<span class="params">req, res, id</span>) </span>&#123;</span><br><span class="line">            res.end(<span class="string">'users: '</span> + id);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    DELETE: &#123;</span><br><span class="line">        <span class="string">'/user/:id'</span>: <span class="function"><span class="keyword">function</span> (<span class="params">req, res, id</span>) </span>&#123;</span><br><span class="line">            res.end(<span class="string">'delete user '</span> + id);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">connect()</span><br><span class="line">    .use(router(routers)) <span class="comment">// å°†è·¯ç”±å¯¹è±¡ä¼ ç»™è·¯ç”±å™¨çš„ setup å‡½æ•°</span></span><br><span class="line">    .listen(<span class="number">3000</span>);</span><br></pre></td></tr></table></figure>
<p>è·¯ç”±å™¨ç»„ä»¶çš„å¤ç”¨ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> connect = <span class="built_in">require</span>(<span class="string">'connect'</span>);</span><br><span class="line"><span class="keyword">const</span> router = <span class="built_in">require</span>(<span class="string">'./middleware/router'</span>); <span class="comment">// è·¯ç”±å™¨ç»„ä»¶</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// æŠŠä¸ç”¨æˆ·ç›¸å…³è·¯ç”±ã€ç®¡ç†å‘˜ç›¸å…³è·¯ç”±åˆ†åˆ°ä¸åŒçš„æ¨¡å—ä¸­ï¼Œç„¶ååœ¨è·¯ç”±å™¨ç»„ä»¶ä¸­åˆ†åˆ«å¼•å…¥</span></span><br><span class="line">connect()</span><br><span class="line">    .use(router(<span class="built_in">require</span>(<span class="string">'./routes/user'</span>)))</span><br><span class="line">    .use(router(<span class="built_in">require</span>(<span class="string">'./routes/admin'</span>)))</span><br><span class="line">    .listen(<span class="number">3000</span>);</span><br></pre></td></tr></table></figure>
<p><img src="http://upload-images.jianshu.io/upload_images/2648731-1bde3f4acdbde4d5.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="Jietu20181108-111120"></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ç®€å•çš„è·¯ç”±ä¸­é—´ä»¶</span></span><br><span class="line"><span class="keyword">const</span> parse = <span class="built_in">require</span>(<span class="string">'url'</span>).parse;</span><br><span class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="keyword">function</span>  <span class="title">route</span>(<span class="params">obj</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params">req, res, next</span>) </span>&#123;</span><br><span class="line">        <span class="comment">// æ£€æŸ¥ä»¥ç¡®ä¿req.methodå®šä¹‰äº†</span></span><br><span class="line">        <span class="comment">// å¦‚æœæœªå®šä¹‰ï¼Œè°ƒç”¨next()ï¼Œå¹¶åœæ­¢ä¸€åˆ‡åç»­æ“ä½œ</span></span><br><span class="line">        <span class="comment">// ç¨‹åºä¸­è‡ªå®šä¹‰çš„æ•°ç»„ä¸­çš„æ–¹æ³•ï¼šobj[req.method]</span></span><br><span class="line">        <span class="keyword">if</span> (!obj[req.method] )&#123;</span><br><span class="line">            next();</span><br><span class="line">            <span class="keyword">return</span>; </span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">var</span> routes = obj[req.method]; <span class="comment">// æŸ¥æ‰¾req.methodå¯¹åº”çš„è·¯å¾„ ï¼ˆæ•°ç»„å¯¹è±¡ï¼‰</span></span><br><span class="line">        <span class="keyword">var</span> url = parse(req.url); <span class="comment">// è§£æ URLï¼Œä»¥ä¾¿è·Ÿ pathname åŒ¹é…</span></span><br><span class="line">        <span class="keyword">var</span> paths = <span class="built_in">Object</span>.keys(routes); <span class="comment">// å°†req.methodå¯¹åº”çš„è·¯å¾„å­˜æ”¾åˆ°æ•°ç»„ä¸­</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; paths.length; i++) &#123; <span class="comment">// éå†è·¯å¾„</span></span><br><span class="line">           <span class="keyword">var</span> path = paths[i];</span><br><span class="line">           <span class="keyword">var</span> fn = routes[path];</span><br><span class="line">           path = path.replace(<span class="regexp">/\//g</span>, <span class="string">'\\/'</span>).replace(<span class="regexp">/:(\w+)/g</span>, <span class="string">'([^\\/]+) '</span>);</span><br><span class="line">           <span class="keyword">var</span> re = <span class="keyword">new</span> <span class="built_in">RegExp</span>(<span class="string">'^'</span> + path + <span class="string">'$'</span>); <span class="comment">// æ„é€ æ­£åˆ™è¡¨è¾¾å¼</span></span><br><span class="line">           <span class="keyword">var</span> captures = url.pathname.match(re);</span><br><span class="line">           <span class="keyword">if</span> (captures) &#123;</span><br><span class="line">               <span class="comment">// ä¼ é€’è¢«æ•è·çš„åˆ†ç»„</span></span><br><span class="line">               <span class="keyword">var</span> args = [req, res].concat(captures.slice(<span class="number">1</span>));</span><br><span class="line">               fn.apply(<span class="literal">null</span>, args);</span><br><span class="line">               <span class="keyword">return</span>; <span class="comment">// å½“æœ‰ç›¸åŒ¹é…çš„å‡½æ•°æ—¶ï¼Œè¿”å›ï¼Œä»¥é˜²æ­¢åç»­çš„next()è°ƒç”¨ã€‚</span></span><br><span class="line">           &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        next();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol>
<li>é¦–å…ˆæ£€æŸ¥å½“å‰çš„req.methodåœ¨routesæ˜ å°„ä¸­æ˜¯å¦æœ‰å®šä¹‰ï¼Œå¦‚æœæ²¡æœ‰åˆ™åœæ­¢è¿›ä¸€æ­¥å¤„ç†(å³è°ƒç”¨next())ã€‚</li>
<li>ä¹‹åå®ƒä¼šå¾ªç¯éå†å·²å®šä¹‰çš„è·¯å¾„ï¼Œæ£€æŸ¥æ˜¯å¦æœ‰è·Ÿå½“å‰çš„req.urlç›¸åŒ¹é…çš„è·¯å¾„ã€‚</li>
<li>å¦‚æœæ‰¾åˆ°åŒ¹é…é¡¹ï¼Œåˆ™è°ƒç”¨åŒ¹é…é¡¹çš„å›è°ƒå‡½æ•°ï¼ŒæœŸæœ›å®Œæˆå¯¹HTTPè¯·æ±‚çš„å¤„ç†ã€‚</li>
</ol>
<h3 id="æ„å»ºä¸€ä¸ªé‡å†™URLçš„ä¸­é—´ä»¶ç»„ä»¶"><a href="#æ„å»ºä¸€ä¸ªé‡å†™URLçš„ä¸­é—´ä»¶ç»„ä»¶" class="headerlink" title="æ„å»ºä¸€ä¸ªé‡å†™URLçš„ä¸­é—´ä»¶ç»„ä»¶"></a>æ„å»ºä¸€ä¸ªé‡å†™URLçš„ä¸­é—´ä»¶ç»„ä»¶</h3><p>é‡å†™URLåŠŸèƒ½ï¼ŒæœåŠ¡ç«¯æ¥æ”¶çš„æ˜¯ /blog/posts/my-post-title çš„è¯·æ±‚ï¼ŒåŸºäºè¿™ä¸ªURLæœ€åçš„æ–‡ç« æ ‡é¢˜æŸ¥æ‰¾æ–‡ç« çš„IDï¼Œç„¶åå°†URLè½¬æ¢ä¸º  /blog/posts/idã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">'use strict'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> connect = <span class="built_in">require</span>(<span class="string">'connect'</span>);</span><br><span class="line"><span class="keyword">const</span> url = <span class="built_in">require</span>(<span class="string">'url'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> app = connect().use(rewrite).use(showPost).listen(<span class="number">3000</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// åŸºäºç¼©ç•¥åé‡å†™è¯·æ±‚URLçš„ä¸­é—´ä»¶</span></span><br><span class="line"><span class="keyword">var</span> path = url.parse(req.url).pathname;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">rewrite</span>(<span class="params">req, res, next</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> match = path.match(<span class="regexp">/^\/blog\/posts\/(.+)/</span>);</span><br><span class="line">    <span class="comment">// åªé’ˆå¯¹ /blog/posts è¯·æ±‚æ‰§è¡ŒæŸ¥æ‰¾</span></span><br><span class="line">    <span class="keyword">if</span> (match) &#123;</span><br><span class="line">        findPostIdBySlug(match[<span class="number">1</span>], <span class="function"><span class="keyword">function</span> (<span class="params">err, id</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">if</span> (err) &#123;</span><br><span class="line">                <span class="keyword">return</span> next(err);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (!id) &#123;</span><br><span class="line">                <span class="keyword">return</span> next(<span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'User not found'</span>));</span><br><span class="line">            &#125;</span><br><span class="line">            req.url = <span class="string">'/blog/posts/'</span> + id; <span class="comment">// é‡å†™req.urlå±æ€§ï¼Œä»¥ä¾¿åç»­ä¸­é—´ä»¶å¯ä»¥ä½¿ç”¨çœŸå®çš„ID</span></span><br><span class="line">            next();</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        next();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="å…­ã€ä½¿ç”¨é”™è¯¯å¤„ç†ä¸­é—´ä»¶"><a href="#å…­ã€ä½¿ç”¨é”™è¯¯å¤„ç†ä¸­é—´ä»¶" class="headerlink" title="å…­ã€ä½¿ç”¨é”™è¯¯å¤„ç†ä¸­é—´ä»¶"></a>å…­ã€ä½¿ç”¨é”™è¯¯å¤„ç†ä¸­é—´ä»¶</h2><p>Connectåˆ»æ„å°†é”™è¯¯å¤„ç†åšåˆ°æœ€ç®€ï¼Œè®©å¼€å‘äººå‘˜æŒ‡æ˜åº”è¯¥å¦‚ä½•å¤„ç†é”™è¯¯ã€‚</p>
<h3 id="1-Connect-çš„é»˜è®¤é”™è¯¯å¤„ç†å™¨"><a href="#1-Connect-çš„é»˜è®¤é”™è¯¯å¤„ç†å™¨" class="headerlink" title="1. Connect çš„é»˜è®¤é”™è¯¯å¤„ç†å™¨"></a>1. Connect çš„é»˜è®¤é”™è¯¯å¤„ç†å™¨</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> connect = <span class="built_in">require</span>(<span class="string">'connect'</span>);</span><br><span class="line"></span><br><span class="line">connect().use(<span class="function"><span class="keyword">function</span> <span class="title">hello</span>(<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">    foo(); <span class="comment">// ---&gt; ReferrenceError</span></span><br><span class="line">    res.setHeader(<span class="string">'Content-Type'</span>, <span class="string">'text/plain'</span>);</span><br><span class="line">    res.end(<span class="string">'hello world'</span>);</span><br><span class="line">&#125;).listen(<span class="number">3000</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 500, 'Internal Server Error'</span></span><br></pre></td></tr></table></figure>
<h3 id="2-è‡ªè¡Œå¤„ç†ç¨‹åºé”™è¯¯"><a href="#2-è‡ªè¡Œå¤„ç†ç¨‹åºé”™è¯¯" class="headerlink" title="2. è‡ªè¡Œå¤„ç†ç¨‹åºé”™è¯¯"></a>2. è‡ªè¡Œå¤„ç†ç¨‹åºé”™è¯¯</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Connect ä¸­çš„é”™è¯¯å¤„ç†ä¸­é—´ä»¶</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">errorHandler</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> env = process.env.NODE_ENV || <span class="string">'development'</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// é”™è¯¯å¤„ç†ä¸­é—´ä»¶å®šä¹‰å››ä¸ªå‚æ•°</span></span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params">err, req, res, next</span>) </span>&#123;</span><br><span class="line">        res.statusCode = <span class="number">500</span>;</span><br><span class="line">        <span class="keyword">switch</span> (env) &#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">'development'</span>:</span><br><span class="line">                res.setHeader(<span class="string">'Content-Type'</span>, <span class="string">'application/json'</span>);</span><br><span class="line">                res.end(<span class="built_in">JSON</span>.stringify(err));</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">default</span>:</span><br><span class="line">                res.end(<span class="string">'Server error'</span>);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä½¿ç”¨é”™è¯¯å¤„ç†</span></span><br><span class="line">connect()</span><br><span class="line">    .use(router(<span class="built_in">require</span>(<span class="string">'./routes/user'</span>))) <span class="comment">// æœ‰é”™è¯¯ä¼šè·³è¿‡</span></span><br><span class="line">    .use(router(<span class="built_in">require</span>(<span class="string">'./routes/admin'</span>))) <span class="comment">// æœ‰é”™è¯¯ä¼šè·³è¿‡</span></span><br><span class="line">    .use(errorHandler())</span><br><span class="line">    .listen(<span class="number">3000</span>);</span><br></pre></td></tr></table></figure>
<p>ç”¨ <strong>NODE_ENV</strong> è®¾å®šç¨‹åºçš„æ¨¡å¼ï¼šConnect é€šå¸¸æ˜¯ç”¨ç¯å¢ƒå˜é‡ NODE_ENVï¼ˆprocess.env.NODE_ENVï¼‰åœ¨ä¸åŒçš„æœåŠ¡å™¨ç¯å¢ƒä¹‹é—´åˆ‡æ¢ï¼Œæ¯”å¦‚ç”Ÿäº§å’Œå¼€å‘ç¯å¢ƒã€‚</p>
<h3 id="3-ä½¿ç”¨å¤šä¸ªé”™è¯¯å¤„ç†ä¸­é—´ä»¶ç»„ä»¶"><a href="#3-ä½¿ç”¨å¤šä¸ªé”™è¯¯å¤„ç†ä¸­é—´ä»¶ç»„ä»¶" class="headerlink" title="3. ä½¿ç”¨å¤šä¸ªé”™è¯¯å¤„ç†ä¸­é—´ä»¶ç»„ä»¶"></a>3. ä½¿ç”¨å¤šä¸ªé”™è¯¯å¤„ç†ä¸­é—´ä»¶ç»„ä»¶</h3><p>ç”¨ä¸­é—´ä»¶çš„å˜ä½“åšé”™è¯¯å¤„ç†å¯¹äºå°†é”™è¯¯å¤„ç†é—®é¢˜åˆ†ç¦»å‡ºæ¥å¾ˆæœ‰å¸®åŠ©ã€‚</p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://andy0570.com/2018/11/02/Node.jså®æˆ˜_3.å­˜å‚¨ Node ç¨‹åºä¸­çš„æ•°æ®/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ç‹¬æœ¨èˆŸçš„æœ¨">
      <meta itemprop="description" content="æœ‰æ—¶å€™é˜³å…‰å¾ˆå¥½ æœ‰æ—¶å€™é˜³å…‰å¾ˆæš—">
      <meta itemprop="image" content="https://ws1.sinaimg.cn/large/006tNc79gy1g22m14458rj30u014xu0x.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ç‹¬æœ¨èˆŸçš„æœ¨">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2018/11/02/Node.jså®æˆ˜_3.å­˜å‚¨ Node ç¨‹åºä¸­çš„æ•°æ®/" class="post-title-link" itemprop="url">Node.jså®æˆ˜_3.å­˜å‚¨ Node ç¨‹åºä¸­çš„æ•°æ®</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              

              
                
              

              <time title="åˆ›å»ºæ—¶é—´ï¼š2018-11-02 15:15:00" itemprop="dateCreated datePublished" datetime="2018-11-02T15:15:00+08:00">2018-11-02</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">æ›´æ–°äº</span>
                
                <time title="ä¿®æ”¹æ—¶é—´ï¼š2019-04-20 13:48:16" itemprop="dateModified" datetime="2019-04-20T13:48:16+08:00">2019-04-20</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Node-js/" itemprop="url" rel="index"><span itemprop="name">Node.js</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          
            <span id="/2018/11/02/Node.jså®æˆ˜_3.å­˜å‚¨ Node ç¨‹åºä¸­çš„æ•°æ®/" class="leancloud_visitors" data-flag-title="Node.jså®æˆ˜_3.å­˜å‚¨ Node ç¨‹åºä¸­çš„æ•°æ®">
              <span class="post-meta-divider">|</span>
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              
                <span class="post-meta-item-text">é˜…è¯»æ¬¡æ•°ï¼š</span>
              
                <span class="leancloud-visitors-count"></span>
            </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body han-init-context" itemprop="articleBody">

      
      

      
        
          <p>é€‰æ‹©åˆé€‚çš„å­˜å‚¨æœºåˆ¶çš„å› ç´ ï¼š</p>
<ul>
<li>å­˜å‚¨æ•°æ®ç±»å‹ï¼›</li>
<li>æ€§èƒ½è¦æ±‚ï¼Œæ•°æ®çš„è¯»å–å’Œå†™å…¥é€Ÿåº¦ï¼›</li>
<li>å­˜å‚¨æ•°æ®é‡ï¼›</li>
<li>æ•°æ®æŸ¥è¯¢æ–¹å¼ï¼›</li>
<li>æ•°æ®æŒä¹…åŒ–ã€å¯é æ€§è¦æ±‚ï¼›</li>
</ul>
          <!--noindex-->
          
            <div class="post-button text-center">
              <a class="btn" href="/2018/11/02/Node.jså®æˆ˜_3.å­˜å‚¨ Node ç¨‹åºä¸­çš„æ•°æ®/#more" rel="contents">
                é˜…è¯»å…¨æ–‡ &raquo;
              </a>
            </div>
          
          <!--/noindex-->
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://andy0570.com/2018/11/02/Node.jså®æˆ˜_2.æ„å»º Node Web ç¨‹åº/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ç‹¬æœ¨èˆŸçš„æœ¨">
      <meta itemprop="description" content="æœ‰æ—¶å€™é˜³å…‰å¾ˆå¥½ æœ‰æ—¶å€™é˜³å…‰å¾ˆæš—">
      <meta itemprop="image" content="https://ws1.sinaimg.cn/large/006tNc79gy1g22m14458rj30u014xu0x.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ç‹¬æœ¨èˆŸçš„æœ¨">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2018/11/02/Node.jså®æˆ˜_2.æ„å»º Node Web ç¨‹åº/" class="post-title-link" itemprop="url">Node.jså®æˆ˜_2.æ„å»º Node Web ç¨‹åº</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              

              
                
              

              <time title="åˆ›å»ºæ—¶é—´ï¼š2018-11-02 13:55:00" itemprop="dateCreated datePublished" datetime="2018-11-02T13:55:00+08:00">2018-11-02</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">æ›´æ–°äº</span>
                
                <time title="ä¿®æ”¹æ—¶é—´ï¼š2019-04-18 15:06:08" itemprop="dateModified" datetime="2019-04-18T15:06:08+08:00">2019-04-18</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Node-js/" itemprop="url" rel="index"><span itemprop="name">Node.js</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          
            <span id="/2018/11/02/Node.jså®æˆ˜_2.æ„å»º Node Web ç¨‹åº/" class="leancloud_visitors" data-flag-title="Node.jså®æˆ˜_2.æ„å»º Node Web ç¨‹åº">
              <span class="post-meta-divider">|</span>
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              
                <span class="post-meta-item-text">é˜…è¯»æ¬¡æ•°ï¼š</span>
              
                <span class="leancloud-visitors-count"></span>
            </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body han-init-context" itemprop="articleBody">

      
      

      
        
          
            <a id="more"></a>
<h2 id="ä¸€ã€HTTP-æœåŠ¡å™¨çš„åŸºç¡€çŸ¥è¯†"><a href="#ä¸€ã€HTTP-æœåŠ¡å™¨çš„åŸºç¡€çŸ¥è¯†" class="headerlink" title="ä¸€ã€HTTP æœåŠ¡å™¨çš„åŸºç¡€çŸ¥è¯†"></a>ä¸€ã€HTTP æœåŠ¡å™¨çš„åŸºç¡€çŸ¥è¯†</h2><p>Node çš„ http æ¨¡å—ï¼šCç¼–å†™ã€åº•å±‚ã€ç®€å•ã€çµæ´»ã€é«˜æ•ˆã€‚<br>Nodeçš„ç­–ç•¥æ˜¯æä¾›å°è€Œå¼ºçš„ç½‘ç»œAPIï¼Œåƒä¼šè¯ï¼ˆSessionï¼‰è¿™ç§é«˜çº§æ¦‚å¿µä»¥åŠ HTTP cookies è¿™æ ·çš„åŸºç¡€ç»„ä»¶éƒ½æ²¡æœ‰åŒ…æ‹¬åœ¨Nodeçš„å†…æ ¸ä¹‹ä¸­ã€‚é‚£äº›éƒ½è¦ç”±ç¬¬ä¸‰æ–¹æ¨¡å—æä¾›ã€‚</p>
<p><img src="http://upload-images.jianshu.io/upload_images/2648731-15f0e76e069f12d8.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="Node Webç¨‹åºåˆ†å±‚æ¦‚è§ˆ"></p>
<h3 id="1-Node-å¦‚ä½•å‘å¼€å‘è€…å‘ˆç°HTTPè¯·æ±‚"><a href="#1-Node-å¦‚ä½•å‘å¼€å‘è€…å‘ˆç°HTTPè¯·æ±‚" class="headerlink" title="1. Node å¦‚ä½•å‘å¼€å‘è€…å‘ˆç°HTTPè¯·æ±‚"></a>1. Node å¦‚ä½•å‘å¼€å‘è€…å‘ˆç°HTTPè¯·æ±‚</h3><p><img src="http://upload-images.jianshu.io/upload_images/2648731-ceb974145bce047a.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image"></p>
<p>Node æœåŠ¡å™¨æ”¶åˆ°HTTPè¯·æ±‚ä¹‹åï¼š</p>
<ol>
<li>è§£æHTTPè¯·æ±‚å¤´ï¼ˆHTTP Headï¼‰ï¼›</li>
<li>è§¦å‘å›è°ƒå‡½æ•°ï¼ˆfunction(req, res) {â€¦} ï¼‰ï¼›</li>
<li>è§£æHTTPè¯·æ±‚ä½“ï¼ˆHTTP Bodyï¼‰ï¼›</li>
<li>æ‰§è¡Œåº”ç”¨é€»è¾‘ï¼›</li>
<li>è°ƒç”¨ <code>res.end()</code> ç»“æŸå“åº”ï¼›</li>
</ol>
<h3 id="2-ä¸€ä¸ªç”¨â€œHello-Worldâ€åšå“åº”çš„HTTPæœåŠ¡å™¨"><a href="#2-ä¸€ä¸ªç”¨â€œHello-Worldâ€åšå“åº”çš„HTTPæœåŠ¡å™¨" class="headerlink" title="2. ä¸€ä¸ªç”¨â€œHello Worldâ€åšå“åº”çš„HTTPæœåŠ¡å™¨"></a>2. ä¸€ä¸ªç”¨â€œHello Worldâ€åšå“åº”çš„HTTPæœåŠ¡å™¨</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// http æ¨¡å—æä¾›äº†HTTPæœåŠ¡å™¨å’Œå®¢æˆ·ç«¯æ¥å£ã€‚</span></span><br><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">'http'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// http.createServer()ï¼šåˆ›å»ºHTTPæœåŠ¡å™¨ï¼ŒæœåŠ¡å™¨æ¯æ¬¡æ”¶åˆ°HTTPè¯·æ±‚åéƒ½ä¼šè°ƒç”¨å®ƒçš„å›è°ƒå‡½æ•°</span></span><br><span class="line"><span class="keyword">var</span> server = http.createServer(<span class="function"><span class="keyword">function</span>(<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// res.write():å°†å“åº”æ•°æ®å†™åˆ°socketä¸­</span></span><br><span class="line">    res.write(<span class="string">'Hello World'</span>);</span><br><span class="line">    <span class="comment">// res.end():ç»“æŸå“åº”</span></span><br><span class="line">    res.end(); </span><br><span class="line"></span><br><span class="line">    <span class="comment">// res.write() å’Œ res.end() å¯ä»¥åˆå¹¶ç¼©å†™ï¼š</span></span><br><span class="line">    <span class="comment">// res.end('Hello World');</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç»‘å®šç›‘å¬ç«¯å£</span></span><br><span class="line">server.listen(<span class="number">3000</span>);</span><br></pre></td></tr></table></figure>
<h3 id="3-è¯»å–ã€è®¾å®šå“åº”å¤´"><a href="#3-è¯»å–ã€è®¾å®šå“åº”å¤´" class="headerlink" title="3. è¯»å–ã€è®¾å®šå“åº”å¤´"></a>3. è¯»å–ã€è®¾å®šå“åº”å¤´</h3><p>Node ä¸­ä¿®æ”¹HTTPå“åº”å¤´çš„æ–¹æ³•ï¼š</p>
<ul>
<li><code>res.setHeader(field, value)</code></li>
<li><code>res.getHeader(field, value)</code></li>
<li><code>res.removeHeader(field)</code></li>
</ul>
<p>æ·»åŠ å’Œç§»é™¤å“åº”å¤´çš„é¡ºåºå¯ä»¥éšæ„ï¼Œä½†ä¸€å®šè¦åœ¨è°ƒç”¨ <code>res.write()</code> æˆ–<code>res.end()</code> ä¹‹å‰ã€‚</p>
<p>ç¤ºä¾‹ï¼Œä½¿ç”¨ <code>res.setHeader()</code>ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> body = <span class="string">'Hello World'</span>;</span><br><span class="line">res.setHeader(<span class="string">'Content-Length'</span>, Buffer.byteLength(body));</span><br><span class="line">res.setHeader(<span class="string">'Content-Type'</span>, <span class="string">'text/plain'</span>);</span><br><span class="line">res.end(body);</span><br></pre></td></tr></table></figure>
<h3 id="4-è®¾å®šHTTPå“åº”çš„çŠ¶æ€ç "><a href="#4-è®¾å®šHTTPå“åº”çš„çŠ¶æ€ç " class="headerlink" title="4. è®¾å®šHTTPå“åº”çš„çŠ¶æ€ç "></a>4. è®¾å®šHTTPå“åº”çš„çŠ¶æ€ç </h3><p>å“åº”çŠ¶æ€ç éœ€è¦è®¾å®š <code>res.statusCode</code> å±æ€§ã€‚åœ¨ç¨‹åºå“åº”æœŸé—´å¯ä»¥éšæ—¶ç»™è¿™ä¸ªå±æ€§èµ‹å€¼ï¼Œåªè¦æ˜¯åœ¨ç¬¬ä¸€æ¬¡è°ƒç”¨<code>res.write()</code>æˆ–<code>res.end()</code>ä¹‹å‰å°±è¡Œã€‚</p>
<p><code>res.statusCode</code> é»˜è®¤çš„å“åº”çŠ¶æ€ç æ˜¯200 OKã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> body = <span class="string">'Hello World'</span>;</span><br><span class="line">res.setHeader(<span class="string">'Content-Length'</span>, Buffer.byteLength(body));</span><br><span class="line">res.setHeader(<span class="string">'Content-Type'</span>, <span class="string">'text/plain'</span>);</span><br><span class="line">res.statusCode = <span class="number">302</span>;</span><br><span class="line">res.end(body); </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// ä»¥ä¸Šå¯ä»¥ç®€å†™å¦‚ä¸‹ï¼š</span></span><br><span class="line"><span class="keyword">const</span> body = <span class="string">'Hello World'</span>;</span><br><span class="line">res.writeHead(<span class="number">200</span>, &#123;</span><br><span class="line">    <span class="string">'Content-Length'</span>: Buffer.byteLength(body),</span><br><span class="line">    <span class="string">'Content-Type'</span>: <span class="string">'text/plain'</span></span><br><span class="line">&#125;);</span><br><span class="line">res.end();</span><br></pre></td></tr></table></figure>
<p>å‚è€ƒï¼š<a href="https://www.wikiwand.com/zh-hans/HTTP%E7%8A%B6%E6%80%81%E7%A0%81" target="_blank" rel="noopener">Wikiwandï¼šHTTP çŠ¶æ€ç </a></p>
<table>
<thead>
<tr>
<th>HTTPçŠ¶æ€ç </th>
<th>æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td>1xx</td>
<td>æ¶ˆæ¯</td>
</tr>
<tr>
<td>2xx</td>
<td>æˆåŠŸ</td>
</tr>
<tr>
<td>3xx</td>
<td>é‡å®šå‘</td>
</tr>
<tr>
<td>4xx</td>
<td>å®¢æˆ·ç«¯é”™è¯¯</td>
</tr>
<tr>
<td>5xx</td>
<td>æœåŠ¡å™¨é”™è¯¯</td>
</tr>
</tbody>
</table>
<h2 id="äºŒã€æ„å»º-RESTful-Web-æœåŠ¡"><a href="#äºŒã€æ„å»º-RESTful-Web-æœåŠ¡" class="headerlink" title="äºŒã€æ„å»º RESTful Web æœåŠ¡"></a>äºŒã€æ„å»º RESTful Web æœåŠ¡</h2><p>åˆ›å»ºæ ‡å‡†çš„RESTæœåŠ¡å™¨éœ€è¦å®ç°å››ä¸ªHTTPè°“è¯ï¼Œæ¯ä¸ªè°“è¯ä¼šè¦†ç›–ä¸€ä¸ªå¾…åŠäº‹é¡¹æ¸…å•çš„æ“ä½œä»»åŠ¡:</p>
<table>
<thead>
<tr>
<th>HTTP Method</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>POST</td>
<td>å¢ï¼Œå‘å¾…åŠäº‹é¡¹æ¸…å•ä¸­æ·»åŠ äº‹é¡¹</td>
</tr>
<tr>
<td>GET</td>
<td>æŸ¥ï¼Œæ˜¾ç¤ºå½“å‰äº‹é¡¹åˆ—è¡¨ï¼Œæˆ–è€…æ˜¾ç¤ºæŸä¸€äº‹é¡¹çš„è¯¦æƒ…;</td>
</tr>
<tr>
<td>DELETE</td>
<td>åˆ ï¼Œä»å¾…åŠäº‹é¡¹æ¸…å•ä¸­ç§»é™¤äº‹é¡¹;</td>
</tr>
<tr>
<td>PUT</td>
<td>æ”¹ï¼Œä¿®æ”¹å·²æœ‰äº‹é¡¹</td>
</tr>
</tbody>
</table>
<h3 id="1-ç”¨-POST-è¯·æ±‚åˆ›å»ºèµ„æº"><a href="#1-ç”¨-POST-è¯·æ±‚åˆ›å»ºèµ„æº" class="headerlink" title="1. ç”¨ POST è¯·æ±‚åˆ›å»ºèµ„æº"></a>1. ç”¨ POST è¯·æ±‚åˆ›å»ºèµ„æº</h3><p>å½“ Node çš„ HTTP è§£æå™¨è¯»å…¥å¹¶è§£æè¯·æ±‚æ•°æ®æ—¶ï¼Œå®ƒä¼šå°†æ•°æ®åšæˆ data äº‹ä»¶çš„å½¢å¼ï¼ŒæŠŠè§£æå¥½çš„æ•°æ®å—æ”¾å…¥å…¶ä¸­ï¼Œç­‰å¾…ç¨‹åºå¤„ç†ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">'http'</span>);</span><br><span class="line"><span class="keyword">var</span> server = http.createServer(<span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// æ•°æ®å—é»˜è®¤æ˜¯ Buffer å¯¹è±¡</span></span><br><span class="line">    <span class="comment">// å°†æµç¼–ç è®¾å®šä¸ºutf8ï¼Œè¿™æ ·dataäº‹ä»¶ä¼šç»™å‡ºå­—ç¬¦ä¸²</span></span><br><span class="line">    req.setEncoding(<span class="string">'utf8'</span>);</span><br><span class="line">    <span class="comment">// 1. åªè¦è¯»å…¥äº†æ–°çš„æ•°æ®å—ï¼Œå°±ä¼šè§¦å‘ data äº‹ä»¶ã€‚</span></span><br><span class="line">    req.on(<span class="string">'data'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">chunk</span>) </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'parsed'</span>, chunk); </span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="comment">// 2. æ•°æ®å…¨éƒ¨è¯»å–å®Œä¹‹åï¼Œè§¦å‘ end äº‹ä»¶ã€‚</span></span><br><span class="line">    req.on(<span class="string">'end'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'done parsing'</span>);</span><br><span class="line">        res.end();</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>åœ¨Nodeä¸­ï¼Œå¯ä»¥é€šè¿‡æ£€æŸ¥ <code>req.method</code> å±æ€§æŸ¥çœ‹ç”¨çš„æ˜¯å“ªä¸ªHTTPæ–¹æ³•(è°“è¯)ã€‚</p>
<p>ç¤ºä¾‹ï¼šPOSTè¯·æ±‚å­—ç¬¦ä¸²ç¼“å­˜ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">'http'</span>);</span><br><span class="line"><span class="keyword">const</span> url = <span class="built_in">require</span>(<span class="string">'url'</span>);</span><br><span class="line"><span class="keyword">var</span> items = []; <span class="comment">// ç”¨ä¸€ä¸ªJSæ•°ç»„å­˜æ”¾æ•°æ®</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> server = http.createServer(<span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">switch</span> (req.method) &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">'POST'</span>:</span><br><span class="line">            <span class="keyword">var</span> item = <span class="string">''</span>; <span class="comment">// è¿›æ¥çš„å­—ç¬¦ä¸²ç¼“å­˜</span></span><br><span class="line">            req.setEncoding(<span class="string">'utf8'</span>); <span class="comment">// å°†è¿›æ¥çš„ data äº‹ä»¶ç¼–ç ä¸º utf8</span></span><br><span class="line">            req.on(<span class="string">'data'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">chunk</span>) </span>&#123;</span><br><span class="line">                item += chunk;</span><br><span class="line">            &#125;);</span><br><span class="line">            req.on(<span class="string">'end'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">                items.push(item); <span class="comment">// å°†å®Œæ•´çš„äº‹é¡¹å‹å…¥æ•°ç»„</span></span><br><span class="line">                res.end(<span class="string">'OK\n'</span>);</span><br><span class="line">            &#125;);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">    </span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">server.listen(<span class="number">3000</span>);</span><br></pre></td></tr></table></figure>
<h3 id="2-ç”¨-GET-è¯·æ±‚è·å–èµ„æº"><a href="#2-ç”¨-GET-è¯·æ±‚è·å–èµ„æº" class="headerlink" title="2. ç”¨ GET è¯·æ±‚è·å–èµ„æº"></a>2. ç”¨ GET è¯·æ±‚è·å–èµ„æº</h3><p>switch ä¸­æ·»åŠ å¦‚ä¸‹åˆ†æ”¯ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">case</span> <span class="string">'GET'</span>:</span><br><span class="line">    items.forEach(<span class="function"><span class="keyword">function</span> (<span class="params">item, i</span>) </span>&#123;</span><br><span class="line">        res.write(i + <span class="string">') '</span> + item + <span class="string">'\n'</span>);</span><br><span class="line">    &#125;)</span><br><span class="line">    res.end;</span><br><span class="line">    <span class="keyword">break</span>;</span><br></pre></td></tr></table></figure>
<p>æµ‹è¯•ï¼š</p>
<p><a href="https://curl.haxx.se/download.html" target="_blank" rel="noopener">cURL</a>æ˜¯ä¸€ä¸ªå¼ºå¤§çš„å‘½ä»¤è¡ŒHTTPå®¢æˆ·ç«¯ï¼Œå¯ä»¥ç”¨æ¥å‘ç›®æ ‡æœåŠ¡å™¨å‘é€è¯·æ±‚ã€‚</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> -d è¡¨ç¤ºè¯·æ±‚æ–¹æ³•ä¸º POST</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> curl -d <span class="string">'buy groceries'</span> http://localhost:3000</span></span><br><span class="line">OK</span><br><span class="line"><span class="meta">$</span><span class="bash"> curl -d <span class="string">'buy node in action'</span> http://localhost:3000</span></span><br><span class="line">OK</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> GET æ˜¯é»˜è®¤çš„æ–¹æ³•</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> curl http://localhost:3000</span></span><br><span class="line">0) buy groceries</span><br><span class="line">1) buy node in action</span><br></pre></td></tr></table></figure>
<h4 id="è®¾å®š-Content-Length-å¤´"><a href="#è®¾å®š-Content-Length-å¤´" class="headerlink" title="è®¾å®š Content-Length å¤´"></a>è®¾å®š Content-Length å¤´</h4><p>åœ¨å“åº”ä¸­è®¾ç½® <strong>Content-Length</strong> å¯ä»¥æé«˜å“åº”é€Ÿåº¦ã€‚</p>
<p>è®¾å®š <strong>Content-Length</strong> åŸŸä¼šéšå«ç¦ç”¨Nodeçš„å—ç¼–ç ï¼Œå› ä¸ºè¦ä¼ è¾“çš„æ•°æ®æ›´å°‘ï¼Œæ‰€ä»¥èƒ½æå‡æ€§èƒ½ã€‚</p>
<p>ç»è¿‡ä¼˜åŒ–çš„ GET å¤„ç†å¦‚ä¸‹ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">case</span> <span class="string">'GET'</span>:</span><br><span class="line">    <span class="keyword">var</span> body = items.map(<span class="function"><span class="keyword">function</span> (<span class="params">item, i</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> i + <span class="string">') '</span> + item;</span><br><span class="line">    &#125;).join(<span class="string">'\n'</span>);</span><br><span class="line">    res.setHeader(<span class="string">'Content-Length'</span>, Buffer.byteLength(body)); <span class="comment">// âš ï¸</span></span><br><span class="line">    res.setHeader(<span class="string">'Content-Type'</span>, <span class="string">'text/plain; charset="utf-8"'</span>);</span><br><span class="line">    res.end(body);</span><br><span class="line">    <span class="keyword">break</span>;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>âš ï¸</p>
<p><strong>Buffer.byteLength()</strong></p>
<p>ä½ å¯èƒ½æƒ³ç”¨ <code>body.length</code> çš„å€¼è®¾å®š <strong>Content-Length</strong>ï¼Œä½† <strong>Content-Length</strong> çš„å€¼åº”è¯¥æ˜¯å­—èŠ‚é•¿åº¦ï¼Œä¸æ˜¯å­—ç¬¦é•¿åº¦ï¼Œå¹¶ä¸”å¦‚æœå­—ç¬¦ä¸²ä¸­æœ‰å¤šå­—èŠ‚å­—ç¬¦ï¼Œä¸¤è€…çš„é•¿åº¦æ˜¯ä¸ä¸€æ ·çš„ã€‚ä¸ºäº†è§„é¿è¿™ä¸ªé—®é¢˜ï¼ŒNodeæä¾›äº†ä¸€ä¸ª<code>Buffer.byteLength()</code> æ–¹æ³•ã€‚</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;</span><span class="bash"> <span class="comment"># Node REPL æµ‹è¯•</span></span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> â˜  ~ [master] âš¡  node</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> &gt; <span class="string">'etcå¼ ä¸‰'</span>.length</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> 5</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> &gt; Buffer.byteLength(<span class="string">'etcå¼ ä¸‰'</span>)</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> 9</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"></span></span><br></pre></td></tr></table></figure>
</blockquote>
<h4 id="Node-REPL-ç¯å¢ƒ"><a href="#Node-REPL-ç¯å¢ƒ" class="headerlink" title="Node REPL ç¯å¢ƒ"></a>Node REPL ç¯å¢ƒ</h4><blockquote>
<p>Nodeè·Ÿå¾ˆå¤šå…¶ä»–è¯­è¨€ä¸€æ ·ï¼Œæä¾›äº†ä¸€ä¸ªREPL(è¯»å–-è®¡ç®—-è¾“å‡º-å¾ªç¯)ç¯å¢ƒï¼Œåœ¨å‘½ä»¤è¡Œä¸­ä¸å¸¦ä»»ä½•å‚æ•°è¿è¡Œnodeå°±å¯ä»¥è¿›å…¥è¿™ä¸ªç¯å¢ƒã€‚ç”¨REPLå¯ä»¥ç¼–å†™ä»£ç ç‰‡æ®µï¼Œæ¯æ¡è¯­å¥å†™å¥½å¹¶æ‰§è¡Œåé©¬ä¸Šå°±èƒ½å¾—åˆ°ç»“æœã€‚å¯¹äºå­¦ä¹ ç¼–ç¨‹è¯­è¨€ã€è¿è¡Œç®€å•çš„æµ‹è¯•ï¼Œç”šè‡³æ˜¯è°ƒè¯•éƒ½å¾ˆæœ‰å¸®åŠ©ã€‚</p>
</blockquote>
<h3 id="3-ç”¨-DELETE-è¯·æ±‚ç§»é™¤èµ„æº"><a href="#3-ç”¨-DELETE-è¯·æ±‚ç§»é™¤èµ„æº" class="headerlink" title="3. ç”¨ DELETE è¯·æ±‚ç§»é™¤èµ„æº"></a>3. ç”¨ DELETE è¯·æ±‚ç§»é™¤èµ„æº</h3><p><code>req.url</code> å±æ€§ä¸­åŒ…å«äº†å®¢æˆ·ç«¯è¯·æ±‚çš„URLï¼Œæ ¹æ®è¯·æ±‚çš„ä¸åŒï¼Œå…¶ä¸­å¯èƒ½åŒ…å«å‡ ä¸ªç»„æˆéƒ¨åˆ†ã€‚</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> node</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> require(<span class="string">'url'</span>).parse(<span class="string">'http://localhost:3000/v1?key=value'</span>)</span></span><br><span class="line">Url &#123;</span><br><span class="line">  protocol: 'http:',</span><br><span class="line">  slashes: true,</span><br><span class="line">  auth: null,</span><br><span class="line">  host: 'localhost:3000',</span><br><span class="line">  port: '3000',</span><br><span class="line">  hostname: 'localhost',</span><br><span class="line">  hash: null,</span><br><span class="line">  search: '?key=value',</span><br><span class="line">  query: 'key=value',</span><br><span class="line">  pathname: '/v1',</span><br><span class="line">  path: '/v1?key=value', # è¯·æ±‚è·¯å¾„</span><br><span class="line">  href: 'http://localhost:3000/v1?key=value' &#125;</span><br></pre></td></tr></table></figure>
<p>DELETE è¯·æ±‚å¤„ç†ä»£ç ç‰‡æ®µï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">case</span> <span class="string">'DELETE'</span>:</span><br><span class="line">    <span class="keyword">var</span> path = url.parse(req.url).pathname;</span><br><span class="line">    <span class="comment">// pathnameæ˜¯å­—ç¬¦ä¸²ï¼Œéœ€è¦å°†å­—ç¬¦ä¸²è½¬æ¢ä¸ºæ•°å­—</span></span><br><span class="line">    <span class="comment">// String.slice(),æå–å­—ç¬¦ä¸²çš„ç¬¬ä¸€ä¸ªå­—ç¬¦ä¸²</span></span><br><span class="line">    <span class="comment">// parseInt(),JavaScript çš„å…¨å±€å‡½æ•°ï¼Œè§£æä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œè¿”å›æ•´æ•°ã€‚</span></span><br><span class="line">    <span class="comment">// 10 è¡¨ç¤ºå­—ç¬¦ä¸²åŸºæ•°ï¼Œåè¿›åˆ¶ã€‚</span></span><br><span class="line">    <span class="keyword">var</span> i = <span class="built_in">parseInt</span>(path.slice(<span class="number">1</span>), <span class="number">10</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">isNaN</span>(i)) &#123; <span class="comment">// æ£€æŸ¥æ•°å­—æ˜¯å¦æœ‰æ•ˆ</span></span><br><span class="line">        res.statusCode = <span class="number">400</span>;</span><br><span class="line">        res.end(<span class="string">'Invalid item id'</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (!items[i]) &#123; <span class="comment">// ç¡®ä¿è¯·æ±‚çš„ç´¢å¼•å­˜åœ¨</span></span><br><span class="line">        res.statusCode = <span class="number">400</span>;</span><br><span class="line">        res.end(<span class="string">'Item not found'</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        items.splice(i, <span class="number">1</span>); <span class="comment">// åˆ é™¤è¯·æ±‚çš„äº‹é¡¹</span></span><br><span class="line">        res.end(<span class="string">'OK\n'</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">break</span>;</span><br></pre></td></tr></table></figure>
<h2 id="ä¸‰ã€æä¾›é™æ€æ–‡ä»¶æœåŠ¡"><a href="#ä¸‰ã€æä¾›é™æ€æ–‡ä»¶æœåŠ¡" class="headerlink" title="ä¸‰ã€æä¾›é™æ€æ–‡ä»¶æœåŠ¡"></a>ä¸‰ã€æä¾›é™æ€æ–‡ä»¶æœåŠ¡</h2><p>é™æ€æ–‡ä»¶ï¼ˆCSSã€JavaScriptã€å›¾ç‰‡ï¼‰æœåŠ¡å™¨ã€‚</p>
<p>fsï¼ˆæ–‡ä»¶ç³»ç»Ÿï¼‰æ¨¡å—ï¼Œæ˜¯æä¾›é™æ€æœåŠ¡çš„å¿…å¤‡æ¨¡å—ã€‚</p>
<h3 id="1-åˆ›å»ºä¸€ä¸ªé™æ€æ–‡ä»¶æœåŠ¡å™¨"><a href="#1-åˆ›å»ºä¸€ä¸ªé™æ€æ–‡ä»¶æœåŠ¡å™¨" class="headerlink" title="1. åˆ›å»ºä¸€ä¸ªé™æ€æ–‡ä»¶æœåŠ¡å™¨"></a>1. åˆ›å»ºä¸€ä¸ªé™æ€æ–‡ä»¶æœåŠ¡å™¨</h3><p>æ¯ä¸ªé™æ€æ–‡ä»¶æœåŠ¡å™¨éƒ½æœ‰ä¸ªæ ¹ç›®å½•ï¼Œä¹Ÿå°±æ˜¯æä¾›æ–‡ä»¶æœåŠ¡çš„åŸºç¡€ç›®å½•ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">'http'</span>);</span><br><span class="line"><span class="keyword">const</span> parse = <span class="built_in">require</span>(<span class="string">'url'</span>).parse;</span><br><span class="line"><span class="keyword">const</span> join = <span class="built_in">require</span>(<span class="string">'path'</span>).join;</span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> root = __dirname; <span class="comment">// é™æ€æ–‡ä»¶æœåŠ¡å™¨çš„æ ¹ç›®å½•</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * url.pathname = /index.html</span></span><br><span class="line"><span class="comment"> * root = /var/www/example.com/public</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * path.join() =&gt; /var/www/example.com/public/index.html</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">var</span> server = http.createServer(<span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> url = parse(req.url);</span><br><span class="line">    <span class="keyword">var</span> path = join(root, url.pathname); <span class="comment">// æ„é€ ç»å¯¹è·¯å¾„</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> stream = fs.createReadStream(path); <span class="comment">// fs.ReadStream</span></span><br><span class="line">    stream.on(<span class="string">'data'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">chunk</span>) </span>&#123; </span><br><span class="line">        res.write(chunk); <span class="comment">// å°†æ–‡ä»¶æ•°æ®å†™å…¥åˆ°å“åº”ä¸­</span></span><br><span class="line">    &#125;)</span><br><span class="line">    stream.on(<span class="string">'end'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        res.end(); <span class="comment">// æ–‡ä»¶å†™å®Œåç»“æŸå“åº”</span></span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">server.listen(<span class="number">3000</span>);</span><br></pre></td></tr></table></figure>
<blockquote>
<p>âš ï¸</p>
<p><strong>ç›®å½•éå†æ”»å‡»</strong></p>
<p>ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œåº”è¯¥å…¨é¢åœ°æ£€æŸ¥è¾“å…¥çš„æœ‰æ•ˆæ€§ï¼Œä»¥é˜²ç”¨æˆ·é€šè¿‡ç›®å½•éå†æ”»å‡»è®¿é—®åˆ°ä½ æœ¬æ¥ä¸æƒ³å¼€æ”¾ç»™ä»–ä»¬çš„é‚£éƒ¨åˆ†å†…å®¹ã€‚</p>
</blockquote>
<h4 id="ç”¨-Stream-pipe-ä¼˜åŒ–æ•°æ®ä¼ è¾“"><a href="#ç”¨-Stream-pipe-ä¼˜åŒ–æ•°æ®ä¼ è¾“" class="headerlink" title="ç”¨ Stream.pipe() ä¼˜åŒ–æ•°æ®ä¼ è¾“"></a>ç”¨ Stream.pipe() ä¼˜åŒ–æ•°æ®ä¼ è¾“</h4><blockquote>
<p><strong>ç®¡é“å’Œæ°´ç®¡</strong></p>
<p>ç®¡é“å¯ä»¥è®©æ¥è‡ªæºå¤´ï¼ˆå³ReadableStreamï¼‰çš„æ•°æ®ï¼Œæµåˆ°æŸä¸ªç›®çš„åœ°ï¼ˆå³WritableStreamï¼‰ã€‚</p>
<p>ç”¨ <code>pipe()</code> æ–¹æ³•è¿æ¥ç®¡é“ã€‚</p>
<p>ReadableStream.pipe(WritableStream);</p>
<p>è¯»å–ä¸€ä¸ªæ–‡ä»¶ï¼ˆReadableStreamï¼‰å¹¶æŠŠå…¶ä¸­çš„å†…å®¹å†™åˆ°å¦ä¸€ä¸ªæ–‡ä»¶ä¸­ï¼ˆWritableStreamï¼‰ç”¨çš„å°±æ˜¯ç®¡é“:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="keyword">var</span> readStream = fs.createReadStream(<span class="string">'./original.txt'</span>);</span><br><span class="line">&gt; <span class="keyword">var</span> writeStream = fs. createWriteStream(<span class="string">'./copy.txt'</span>);</span><br><span class="line">&gt; readStream.pipe(writeStream);</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>
</blockquote>
<blockquote>
<p>æ‰€æœ‰ReadableStreaméƒ½èƒ½æ¥å…¥ä»»ä½•ä¸€ä¸ªWritableStreamã€‚æ¯”å¦‚HTTPè¯·æ±‚(req)å¯¹è±¡å°±æ˜¯ReadableStreamï¼Œä½ å¯ä»¥è®©å…¶ä¸­çš„å†…å®¹æµåŠ¨åˆ°æ–‡ä»¶ä¸­:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt; req.pipe(fs.createWriteStream(<span class="string">'./req-body.txt'</span>));</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>
</blockquote>
<p>ç”¨ pipe() ç®€åŒ–æœåŠ¡å™¨ç«¯ä»£ç ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> server = http.createServer(<span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> url = parse(req.url);</span><br><span class="line">    <span class="keyword">var</span> path = join(root, url.pathname); <span class="comment">// æ„é€ ç»å¯¹è·¯å¾„</span></span><br><span class="line">    <span class="keyword">var</span> stream = fs.createReadStream(path); <span class="comment">// fs.ReadStream</span></span><br><span class="line">    stream.pipe(res); <span class="comment">// res.end() ä¼šåœ¨ stream.pipe() å†…éƒ¨è°ƒç”¨</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h3 id="2-å¤„ç†æœåŠ¡å™¨é”™è¯¯"><a href="#2-å¤„ç†æœåŠ¡å™¨é”™è¯¯" class="headerlink" title="2. å¤„ç†æœåŠ¡å™¨é”™è¯¯"></a>2. å¤„ç†æœåŠ¡å™¨é”™è¯¯</h3><p>å¦‚ä½•è®©NodeæœåŠ¡å™¨æ›´åŠ å¥å£®ï¼Ÿ</p>
<p>é»˜è®¤æƒ…å†µä¸‹ï¼Œå¦‚æœæ²¡æœ‰è®¾ç½®ç›‘å¬å™¨ï¼Œerroräº‹ä»¶ä¼šè¢«æŠ›å‡ºã€‚ä¹Ÿå°±æ˜¯è¯´å¦‚æœä½ ä¸ç›‘å¬è¿™äº›é”™è¯¯ï¼Œé‚£å®ƒä»¬å°±ä¼šæå®ä½ çš„æœåŠ¡å™¨ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">   ...</span><br><span class="line">stream.pipe(res);</span><br><span class="line">   stream.on(<span class="string">'error'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">err</span>) </span>&#123; <span class="comment">// æ³¨å†Œerroräº‹ä»¶å¤„ç†å™¨</span></span><br><span class="line">       res.statusCode = <span class="number">500</span>;</span><br><span class="line">       res.end(<span class="string">'Internal Server Error'</span>);</span><br><span class="line">   &#125;);</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<h3 id="3-ç”¨-fs-stat-å®ç°å…ˆå‘åˆ¶äººçš„é”™è¯¯å¤„ç†"><a href="#3-ç”¨-fs-stat-å®ç°å…ˆå‘åˆ¶äººçš„é”™è¯¯å¤„ç†" class="headerlink" title="3. ç”¨ fs.stat() å®ç°å…ˆå‘åˆ¶äººçš„é”™è¯¯å¤„ç†"></a>3. ç”¨ fs.stat() å®ç°å…ˆå‘åˆ¶äººçš„é”™è¯¯å¤„ç†</h3><p><code>fs.stat()</code> ç”¨äºè·å–æ–‡ä»¶ç›¸å…³ä¿¡æ¯ã€‚</p>
<p>æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨ï¼Œå¹¶åœ¨å“åº”ä¸­æä¾›Content-Length</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> server = http.createServer(<span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> url = parse(req.url);</span><br><span class="line">    <span class="keyword">var</span> path = join(root, url.pathname); <span class="comment">// æ„é€ ç»å¯¹è·¯å¾„</span></span><br><span class="line">    fs.stat(path, <span class="function"><span class="keyword">function</span> (<span class="params">err, stat</span>) </span>&#123; <span class="comment">// æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨</span></span><br><span class="line">        <span class="keyword">if</span> (err) &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="string">'ENOENT'</span> == err.code) &#123;</span><br><span class="line">                res.statusCode = <span class="number">404</span>;</span><br><span class="line">                res.end(<span class="string">'Not Found'</span>);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123; <span class="comment">// å…¶ä»–é”™è¯¯</span></span><br><span class="line">                res.statusCode = <span class="number">500</span>;</span><br><span class="line">                res.end(<span class="string">'Internal Server Error'</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// ç”¨ stat å¯¹è±¡çš„å±æ€§è®¾ç½® Content-Length</span></span><br><span class="line">            res.setHeader(<span class="string">'Content-Length'</span>, stat.size); </span><br><span class="line">            <span class="keyword">var</span> stream = fs.createReadStream(path); <span class="comment">// fs.ReadStream</span></span><br><span class="line">            stream.pipe(res); <span class="comment">// res.end() ä¼šåœ¨ stream.pipe() å†…éƒ¨è°ƒç”¨</span></span><br><span class="line">            stream.on(<span class="string">'error'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">err</span>) </span>&#123;</span><br><span class="line">                res.statusCode = <span class="number">500</span>;</span><br><span class="line">                res.end(<span class="string">'Internal Server Error'</span>);</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<blockquote>
<p>ğŸ’¡ğŸ’¡ğŸ’¡</p>
<p>ä¸æ¨èåœ¨è°ƒç”¨<code>fs.open()</code>, <code>fs.readFile()</code> or <code>fs.writeFile()</code> å‰é€šè¿‡ä½¿ç”¨ <code>fs.stat()</code> æ¥æ£€æŸ¥æŸä¸ªæ–‡ä»¶æ˜¯å¦å­˜åœ¨ã€‚å¯¹äºè¿™ç§æƒ…å†µï¼Œå¼€å‘è€…åº”å½“é€šè¿‡ç›´æ¥ open/read/write æ–‡ä»¶å¹¶æ£€æµ‹äº§ç”Ÿçš„å¼‚å¸¸æ¥åˆ¤æ–­æ–‡ä»¶æ˜¯å¦å¯ç”¨ã€‚</p>
<p>å¦‚æœä¸éœ€è¦æ“ä½œæ–‡ä»¶åªæ˜¯æƒ³è·å–æ–‡ä»¶æ˜¯å¦å¯ç”¨ï¼Œæ¨èä½¿ç”¨ <a href="http://nodejs.cn/s/NCPsM3" target="_blank" rel="noopener"><code>fs.access()</code></a>ã€‚</p>
</blockquote>
<h2 id="å››ã€ä»è¡¨å•ä¸­æ¥å—ç”¨æˆ·è¾“å…¥"><a href="#å››ã€ä»è¡¨å•ä¸­æ¥å—ç”¨æˆ·è¾“å…¥" class="headerlink" title="å››ã€ä»è¡¨å•ä¸­æ¥å—ç”¨æˆ·è¾“å…¥"></a>å››ã€ä»è¡¨å•ä¸­æ¥å—ç”¨æˆ·è¾“å…¥</h2><p>Node ä¸ä¼šå¸®ä½ æ‰¿æ‹…å¤„ç†è¡¨å•çš„å·¥ä½œ(æ¯”å¦‚éªŒè¯æˆ–æ–‡ä»¶ä¸Šä¼ )ï¼Œå®ƒåªèƒ½æŠŠè¯·æ±‚bodyæ•°æ®äº¤ç»™ä½ ã€‚å°½ç®¡è¿™çœ‹èµ·æ¥ä¸å¤ªæ–¹ä¾¿ï¼Œä½†Nodeä¸€è´¯çš„å®—æ—¨æ˜¯æä¾›ç®€å•é«˜æ•ˆçš„åº•å±‚APIï¼ŒæŠŠå…¶ä»–æœºä¼šç•™ç»™äº†ç¬¬ä¸‰æ–¹æ¡†æ¶ã€‚</p>
<table>
<thead>
<tr>
<th>è¡¨å•æäº¤çš„ Content-Type å€¼</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>application/x-www-form-urlencoded</td>
<td>HTML è¡¨å•é»˜è®¤å€¼</td>
</tr>
<tr>
<td>multipart/form-data</td>
<td>è¡¨å•ä¸­å«æœ‰æ–‡ä»¶æˆ–éASCIIæˆ–äºŒè¿›åˆ¶æ•°æ®æ—¶ä½¿ç”¨</td>
</tr>
</tbody>
</table>
<h3 id="1-å¤„ç†æäº¤çš„è¡¨å•åŸŸ"><a href="#1-å¤„ç†æäº¤çš„è¡¨å•åŸŸ" class="headerlink" title="1. å¤„ç†æäº¤çš„è¡¨å•åŸŸ"></a>1. å¤„ç†æäº¤çš„è¡¨å•åŸŸ</h3><p>æ”¯æŒGETå’ŒPOSTçš„HTTPæœåŠ¡å™¨ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">'http'</span>);</span><br><span class="line"><span class="keyword">const</span> qs = <span class="built_in">require</span>(<span class="string">'querystring'</span>);</span><br><span class="line"><span class="keyword">var</span> items = [];</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> server = http.createServer(<span class="function"><span class="keyword">function</span>(<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="string">'/'</span> == req.url) &#123;</span><br><span class="line">        <span class="keyword">switch</span> (req.method) &#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">'GET'</span>:</span><br><span class="line">                show(res);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">'POST'</span>:</span><br><span class="line">                add(req, res);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">default</span>:</span><br><span class="line">                badRequest(res);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        notFound(res);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">server.listen(<span class="number">3000</span>);</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">show</span>(<span class="params">res</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// ç”¨æ‹¼æ¥å­—ç¬¦ä¸²çš„æ–¹æ³•ç”Ÿæˆ HTML</span></span><br><span class="line">    <span class="keyword">var</span> html = <span class="string">'&lt;html&gt;&lt;head&gt;&lt;title&gt;Todo List&lt;/title&gt;&lt;/head&gt;&lt;body&gt;'</span></span><br><span class="line">            + <span class="string">'&lt;h1&gt;Todo List&lt;/h1&gt;'</span></span><br><span class="line">            + <span class="string">'&lt;ul&gt;'</span></span><br><span class="line">            + items.map(<span class="function"><span class="keyword">function</span> (<span class="params">item</span>) </span>&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="string">'&lt;li&gt;'</span> + item + <span class="string">'&lt;/li&gt;'</span></span><br><span class="line">            &#125;).join(<span class="string">' '</span>)</span><br><span class="line">            + <span class="string">'&lt;/ul&gt;'</span></span><br><span class="line">            + <span class="string">'&lt;form method="post" action="/"&gt;'</span></span><br><span class="line">            + <span class="string">'&lt;p&gt;&lt;input type="text" name="item" /&gt;&lt;/p&gt;'</span></span><br><span class="line">            + <span class="string">'&lt;p&gt;&lt;input type="submit" value="Add Item" /&gt;&gt;&lt;/p&gt;'</span></span><br><span class="line">            + <span class="string">'&lt;/form&gt;&lt;/body&gt;&lt;/html&gt;'</span>;</span><br><span class="line">res.setHeader(<span class="string">'Content-Type'</span>, <span class="string">'text/html'</span>);</span><br><span class="line">res.setHeader(<span class="string">'Content-Length'</span>, Buffer.byteLength(html));</span><br><span class="line">res.end(html);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">add</span>(<span class="params">params</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> body = <span class="string">''</span>;</span><br><span class="line">    req.setEncoding(<span class="string">'utf8'</span>);</span><br><span class="line">    req.on(<span class="string">'data'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">chunk</span>) </span>&#123;</span><br><span class="line">        <span class="comment">// æŠŠdataäº‹ä»¶çš„æ•°æ®å—æ‹¼æ¥åˆ°ä¸€èµ·å½¢æˆå®Œæ•´çš„è¯·æ±‚bodyå­—ç¬¦ä¸²ã€‚</span></span><br><span class="line">        body += chunk;</span><br><span class="line">    &#125;);</span><br><span class="line">    req.on(<span class="string">'end'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> obj = qs.parse(body);</span><br><span class="line">        items.push(obj.item);</span><br><span class="line">        show(res);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 404 Not Found</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">notFound</span>(<span class="params">res</span>) </span>&#123;</span><br><span class="line">    res.statusCode = <span class="number">404</span>;</span><br><span class="line">    res.setHeader(<span class="string">'Content-Type'</span>, <span class="string">'text/plain'</span>);</span><br><span class="line">    res.end(<span class="string">'Not Found'</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 400 Bad Requests</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">badRequest</span>(<span class="params">res</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> body = <span class="string">'Bad Request'</span>;</span><br><span class="line">    res.writeHead(<span class="number">400</span>, &#123;</span><br><span class="line">        <span class="string">'Content-Length'</span>: Buffer.byteLength(body),</span><br><span class="line">        <span class="string">'Content-Type'</span>: <span class="string">'text/plain'</span></span><br><span class="line">    &#125;);</span><br><span class="line">    res.end(body);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="2-ç”¨formidableå¤„ç†ä¸Šä¼ çš„æ–‡ä»¶"><a href="#2-ç”¨formidableå¤„ç†ä¸Šä¼ çš„æ–‡ä»¶" class="headerlink" title="2. ç”¨formidableå¤„ç†ä¸Šä¼ çš„æ–‡ä»¶"></a>2. ç”¨formidableå¤„ç†ä¸Šä¼ çš„æ–‡ä»¶</h3><p>å®ç°Webä¸­çš„æ–‡ä»¶ä¸Šä¼ åŠŸèƒ½ã€‚</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--ä¸Šä¼ æ–‡ä»¶æ—¶ï¼Œè¡¨å•çš„ enctype å±æ€§éœ€è¦è®¾ç½®ä¸º multipart/form-data--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">method</span>=<span class="string">"POST"</span> <span class="attr">action</span>=<span class="string">"/"</span> <span class="attr">enctype</span>=<span class="string">"multipart/form-data"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"name"</span> /&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"file"</span> /&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">value</span>=<span class="string">"Upload"</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>ç¬¬ä¸‰æ–¹æ¨¡å—ï¼š<a href="https://www.npmjs.com/package/formidable" target="_blank" rel="noopener">npmï¼šformmidable</a>ï¼Œformidable çš„æµå¼è§£æå™¨æ˜¯å¤„ç†æ–‡ä»¶ä¸Šä¼ çš„ç»ä½³é€‰æ‹©ï¼Œä¹Ÿå°±æ˜¯è¯´å®ƒèƒ½éšç€æ•°æ®å—çš„ä¸Šä¼ æ¥æ”¶å®ƒä»¬ï¼Œè§£æå®ƒä»¬ï¼Œå¹¶åå‡ºç‰¹å®šçš„éƒ¨åˆ†ã€‚è¿™ç§æ–¹å¼ä¸ä»…å¿«é€Ÿï¼Œè¿˜ä¸ä¼šå› ä¸ºéœ€è¦å¤§é‡ç¼“å†²è€Œå¯¼è‡´å†…å­˜è†¨èƒ€ï¼Œå³ä¾¿åƒè§†é¢‘è¿™ç§å¤§å‹æ–‡ä»¶ï¼Œä¹Ÿä¸ä¼šæŠŠè¿›ç¨‹å‹å®ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">'http'</span>);</span><br><span class="line"><span class="keyword">const</span> formidable = <span class="built_in">require</span>(<span class="string">'formidable'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> server = http.createServer(<span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">switch</span> (req.method) &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">'GET'</span>:</span><br><span class="line">            show(req, res);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">'POST'</span>:</span><br><span class="line">            upload(req, res);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;);</span><br><span class="line">server.listen(<span class="number">3000</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// GET</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">show</span>(<span class="params">res</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// å¸¦æœ‰æ–‡ä»¶ä¸Šä¼ æ§ä»¶çš„ HTML è¡¨å•</span></span><br><span class="line">    <span class="keyword">var</span> html = <span class="string">' '</span></span><br><span class="line">            + <span class="string">'&lt;form method="post" action="/" enctype="multipart/form-data"&gt;'</span></span><br><span class="line">            + <span class="string">'&lt;p&gt;&lt;input type="text" name="name" /&gt;&lt;/p&gt;'</span></span><br><span class="line">            + <span class="string">'&lt;p&gt;&lt;input type="file" name="file" /&gt;&lt;/p&gt;'</span></span><br><span class="line">            + <span class="string">'&lt;p&gt;&lt;input type="submit" value="Upload" /&gt;&lt;/p&gt;'</span></span><br><span class="line">            + <span class="string">'&lt;/form&gt;'</span>;</span><br><span class="line">res.setHeader(<span class="string">'Content-Type'</span>, <span class="string">'text/html'</span>);</span><br><span class="line">res.setHeader(<span class="string">'Content-Length'</span>, Buffer.byteLength(html));</span><br><span class="line">res.end(html);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">upload</span>(<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!isFormData(req)) &#123;</span><br><span class="line">        res.statusCode = <span class="number">400</span>;</span><br><span class="line">        res.end(<span class="string">'Bad Request: expecting multipart/form-data'</span>);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> form = <span class="keyword">new</span> formidable.IncomingForm();</span><br><span class="line">    <span class="comment">// // æ”¶å®Œè¾“å…¥åŸŸåä¼šå‘å‡º field äº‹ä»¶</span></span><br><span class="line">    <span class="comment">// // æ¯å½“æ”¶åˆ°å­—æ®µ / å€¼å¯¹æ—¶å‘å‡ºã€‚</span></span><br><span class="line">    <span class="comment">// form.on('field', function (name, value) &#123;</span></span><br><span class="line">    <span class="comment">//     console.log(name);</span></span><br><span class="line">    <span class="comment">//     console.log(value);</span></span><br><span class="line">    <span class="comment">// &#125;);</span></span><br><span class="line">    <span class="comment">// // åœ¨æ”¶åˆ°æ–‡ä»¶å¹¶å¤„ç†å¥½åä¼šå‘å‡º file äº‹ä»¶</span></span><br><span class="line">    <span class="comment">// // æ–‡ä»¶ä¸Šä¼ å®Œæˆåå‘å‡ºäº†fileäº‹ä»¶</span></span><br><span class="line">    <span class="comment">// // æ¯å½“æ”¶åˆ°å­—æ®µ / æ–‡ä»¶å¯¹æ—¶å‘å‡ºã€‚</span></span><br><span class="line">    <span class="comment">// form.on('file', function (name, file) &#123;</span></span><br><span class="line">    <span class="comment">//     console.log(name);</span></span><br><span class="line">    <span class="comment">//     console.log(file);</span></span><br><span class="line">    <span class="comment">// &#125;);</span></span><br><span class="line">    <span class="comment">// form.on('end', function () &#123;</span></span><br><span class="line">    <span class="comment">//     res.end('upload complete');</span></span><br><span class="line">    <span class="comment">// &#125;);</span></span><br><span class="line"></span><br><span class="line">    form.parse(req, <span class="function"><span class="keyword">function</span> (<span class="params">err, fields, files</span>) </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(fields);</span><br><span class="line">        <span class="built_in">console</span>.log(files);</span><br><span class="line">        res.end(<span class="string">'upload complete'</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç”¨String.indexOf()æ–¹æ³•æ£€æŸ¥è¯·æ±‚å¤´ä¸­çš„Content-Typeå­—æ®µï¼Œ æ–­è¨€å®ƒçš„å€¼æ˜¯ä»¥multipart/form-dataå¼€å¤´çš„ã€‚</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">isFormData</span>(<span class="params">req</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> type = req.headers[<span class="string">'content-type'</span>] || <span class="string">''</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span> == type.indexOf(<span class="string">'multipart/form-data'</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="3-è®¡ç®—ä¸Šä¼ è¿›åº¦"><a href="#3-è®¡ç®—ä¸Šä¼ è¿›åº¦" class="headerlink" title="3. è®¡ç®—ä¸Šä¼ è¿›åº¦"></a>3. è®¡ç®—ä¸Šä¼ è¿›åº¦</h3><p><a href="https://github.com/felixge/node-formidable" target="_blank" rel="noopener">Formidable</a> çš„ progress äº‹ä»¶èƒ½ç»™å‡ºæ”¶åˆ°çš„å­—èŠ‚æ•°ï¼Œä»¥åŠæœŸæœ›æ”¶åˆ°çš„å­—èŠ‚æ•°ã€‚æˆ‘ä»¬å¯ä»¥å€ŸåŠ©è¿™ä¸ªåšå‡ºä¸€ä¸ªè¿›åº¦æ¡ã€‚ </p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">form.on(<span class="string">'progress'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">bytesReceived, bytesExpected</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> percent = <span class="built_in">Math</span>.floor(bytesReceived / bytesExpected * <span class="number">100</span>);</span><br><span class="line">    <span class="built_in">console</span>.log(percent);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>æ¥ä¸‹æ¥ï¼ŒæŠŠè¿™ä¸ªè¿›åº¦ä¼ å›åˆ°ç”¨æˆ·çš„æµè§ˆå™¨ä¸­ï¼Œå¯ä»¥ä½¿ç”¨ <strong>WebSocket</strong> åè®®æˆ–è€… <strong>Socket.IO</strong> è¿™æ ·çš„å®æ—¶æ¨¡å—ã€‚</p>
<h2 id="äº”ã€ç”¨-HTTPS-åŠ å¼ºç¨‹åºçš„å®‰å…¨æ€§"><a href="#äº”ã€ç”¨-HTTPS-åŠ å¼ºç¨‹åºçš„å®‰å…¨æ€§" class="headerlink" title="äº”ã€ç”¨ HTTPS åŠ å¼ºç¨‹åºçš„å®‰å…¨æ€§"></a>äº”ã€ç”¨ HTTPS åŠ å¼ºç¨‹åºçš„å®‰å…¨æ€§</h2><p>å¼€å‘ç¯å¢ƒä¸­ï¼Œç”Ÿæˆè‡ªç­¾åè¯ä¹¦ç”¨äºæµ‹è¯•ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> ä½¿ç”¨ OpenSSL ç”Ÿæˆç§é’¥</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> openssl genrsa 2048 &gt; key.pem</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> ä½¿ç”¨ç§é’¥åˆ›å»ºè¯ä¹¦</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> openssl req -x509 -new -key key.pem &gt; key-cert.pem</span></span><br></pre></td></tr></table></figure>
<p>HTTPS æœåŠ¡å™¨é…ç½®é¡¹ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">'use strict'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> https = <span class="built_in">require</span>(<span class="string">'https'</span>);</span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä½œä¸ºé…ç½®é¡¹çš„å¯†é’¥å’Œè¯ä¹¦</span></span><br><span class="line"><span class="keyword">var</span> options = &#123;</span><br><span class="line">    key: fs.readFileSync(<span class="string">'./key.pem'</span>),</span><br><span class="line">    cert: fs.readFileSync(<span class="string">'./key-cert.pem'</span>)</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// https å’Œ http æ¨¡å—çš„APIå‡ ä¹ä¸€æ ·</span></span><br><span class="line">https.createServer(options, <span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">    res.writeHead(<span class="number">200</span>);</span><br><span class="line">    res.end(<span class="string">'Hello World'</span>);</span><br><span class="line">&#125;).listen(<span class="number">3000</span>);</span><br></pre></td></tr></table></figure>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/4/"><i class="fa fa-angle-left" aria-label="ä¸Šä¸€é¡µ"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/4/">4</a><span class="page-number current">5</span><a class="page-number" href="/page/6/">6</a><span class="space">&hellip;</span><a class="page-number" href="/page/32/">32</a><a class="extend next" rel="next" href="/page/6/"><i class="fa fa-angle-right" aria-label="ä¸‹ä¸€é¡µ"></i></a>
  </nav>



          </div>
          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <div class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image" src="https://ws1.sinaimg.cn/large/006tNc79gy1g22m14458rj30u014xu0x.jpg" alt="ç‹¬æœ¨èˆŸçš„æœ¨">
            
              <p class="site-author-name" itemprop="name">ç‹¬æœ¨èˆŸçš„æœ¨</p>
              <div class="site-description motion-element" itemprop="description">æœ‰æ—¶å€™é˜³å…‰å¾ˆå¥½ æœ‰æ—¶å€™é˜³å…‰å¾ˆæš—</div>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/">
                
                    <span class="site-state-item-count">312</span>
                    <span class="site-state-item-name">æ—¥å¿—</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-categories">
                  
                    
                      <a href="/categories/">
                    
                  
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">14</span>
                    <span class="site-state-item-name">åˆ†ç±»</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-tags">
                  
                    
                      <a href="/tags/">
                    
                  
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">54</span>
                    <span class="site-state-item-name">æ ‡ç­¾</span>
                  </a>
                </div>
              
            </nav>
          

          
            <div class="feed-link motion-element">
              <a href="/atom.xml" rel="alternate">
                <i class="fa fa-rss"></i>
                RSS
              </a>
            </div>
          

          

          
            <div class="links-of-author motion-element">
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                    
                  
                  <a href="https://github.com/Andy0570" title="GitHub &rarr; https://github.com/Andy0570" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i>GitHub</a>
                </span>
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                    
                  
                  <a href="mailto:andywhm@163.com" title="E-Mail &rarr; mailto:andywhm@163.com" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                </span>
              
            </div>
          

          
             <div class="cc-license motion-element" itemprop="license">
              
              
                
              
              
              
              <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" class="cc-opacity" rel="noopener" target="_blank"><img src="/images/cc-by-nc-sa.svg" alt="Creative Commons"></a>
             </div>
          

          
          

          
            
          
          

        </div>
      </div>

      

      

    </div>
  </aside>
  


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">ç‹¬æœ¨èˆŸçš„æœ¨</span>

  

  
</div>


  <div class="powered-by">ç”± <a href="https://hexo.io" class="theme-link" rel="noopener" target="_blank">Hexo</a> å¼ºåŠ›é©±åŠ¨ v3.8.0</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">ä¸»é¢˜ â€“ <a href="https://theme-next.org" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> v7.1.0</div>




        








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

    

    
  </div>

  

<script>
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>





  



  






  



  
    
    
      
    
  
  <script color="17,119,176" opacity="0.5" zindex="-1" count="99" src="//cdn.jsdelivr.net/gh/theme-next/theme-next-canvas-nest@1/canvas-nest.min.js"></script>













  
  <script src="//cdn.jsdelivr.net/npm/jquery@2/dist/jquery.min.js"></script>

  
  <script src="//cdn.jsdelivr.net/npm/fastclick@1/lib/fastclick.min.js"></script>

  
  <script src="//cdn.jsdelivr.net/npm/jquery-lazyload@1/jquery.lazyload.min.js"></script>

  
  <script src="//cdn.jsdelivr.net/npm/velocity-animate@1/velocity.min.js"></script>

  
  <script src="//cdn.jsdelivr.net/npm/velocity-animate@1/velocity.ui.min.js"></script>

  
  <script src="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.js"></script>


  


  <script src="/js/utils.js?v=7.1.0"></script>

  <script src="/js/motion.js?v=7.1.0"></script>



  
  


  <script src="/js/affix.js?v=7.1.0"></script>

  <script src="/js/schemes/pisces.js?v=7.1.0"></script>




  

  


  <script src="/js/next-boot.js?v=7.1.0"></script>


  

  

  
  
  
    
  

  
    
      
    
  

  
  
  
    <script src="//cdn.jsdelivr.net/npm/quicklink@1/dist/quicklink.umd.js"></script>
    <script>
      
        window.addEventListener('load', () => {
      
        quicklink({
          timeout: 3000,
          priority: true,
          ignores: [uri => uri.includes('#'),uri => uri == 'https://andy0570.com/page/5/',]
        });
      
        });
      
    </script>
  


  



  



  
  
  
    
  
  <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/instantsearch.js@2/dist/instantsearch.min.css">

  
  
    
  
  <script src="//cdn.jsdelivr.net/npm/instantsearch.js@2/dist/instantsearch.js"></script>
  

  <script src="/js/algolia-search.js?v=7.1.0"></script>



  
  
  <script>
    
    function showTime(Counter) {
      var entries = [];
      var $visitors = $('.leancloud_visitors');

      $visitors.each(function() {
        entries.push( $(this).attr('id').trim() );
      });

      Counter('get', '/classes/Counter', { where: JSON.stringify({ url: { '$in': entries } }) })
        .done(function({ results }) {
          var COUNT_CONTAINER_REF = '.leancloud-visitors-count';

          if (results.length === 0) {
            $visitors.find(COUNT_CONTAINER_REF).text(0);
            return;
          }

          for (var i = 0; i < results.length; i++) {
            var item = results[i];
            var url = item.url;
            var time = item.time;
            var element = document.getElementById(url);

            $(element).find(COUNT_CONTAINER_REF).text(time);
          }
          for (var i = 0; i < entries.length; i++) {
            var url = entries[i];
            var element = document.getElementById(url);
            var countSpan = $(element).find(COUNT_CONTAINER_REF);
            if (countSpan.text() == '') {
              countSpan.text(0);
            }
          }
        })
        .fail(function ({ responseJSON }) {
          console.log('LeanCloud Counter Error: ' + responseJSON.code + ' ' + responseJSON.error);
        });
    }
    

    $(function() {
      $.get('https://app-router.leancloud.cn/2/route?appId=' + 'S7i1Y8YorMKFPaYbJbekD5el-gzGzoHsz')
        .done(function({ api_server }) {
          var Counter = function(method, url, data) {
            return $.ajax({
              method: method,
              url: 'https://' + api_server + '/1.1' + url,
              headers: {
                'X-LC-Id': 'S7i1Y8YorMKFPaYbJbekD5el-gzGzoHsz',
                'X-LC-Key': 'brOnU8mOQvSjpipJvdKUAIbU',
                'Content-Type': 'application/json',
              },
              data: data
            });
          };
          
            if ($('.post-title-link').length >= 1) {
              showTime(Counter);
            }
          
        });
    });
  </script>



  

  

  

  

  

  

  

  

  
  
  
    
  
  <script src="//cdn.jsdelivr.net/npm/pangu@4/dist/browser/pangu.min.js"></script>
  <script>pangu.spacingPage();</script>


  
  
  
    
  
  <script src="//cdn.jsdelivr.net/gh/theme-next/theme-next-bookmark@1/bookmark.min.js"></script>
  <script>
  
    bookmark.loadBookmark();
  
  </script>


  

  

  


  <!-- red heart -->
  <script type="text/javascript" src="/js/src/love.js"></script>
  
</body>
</html>
